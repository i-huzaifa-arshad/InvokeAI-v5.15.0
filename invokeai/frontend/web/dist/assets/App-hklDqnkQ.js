var OW=Object.defineProperty;var Tk=e=>{throw TypeError(e)};var NW=(e,t,n)=>t in e?OW(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var k=(e,t,n)=>NW(e,typeof t!="symbol"?t+"":t,n),By=(e,t,n)=>t.has(e)||Tk("Cannot "+n);var X=(e,t,n)=>(By(e,t,"read from private field"),n?n.call(e):t.get(e)),At=(e,t,n)=>t.has(e)?Tk("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Xe=(e,t,n,s)=>(By(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),He=(e,t,n)=>(By(e,t,"access private method"),n);var rg=(e,t,n,s)=>({set _(i){Xe(e,t,i,n)},get _(){return X(e,t,s)}});import{g as Au,a as YA,b as FW,r as u,c as BW,t as Mk,i as XA,S as $W,d as VW,e as GW,f as zW,h as Pk,j as QA,k as JA,l as HW,m as eT,n as K2,o as tT,p as WW,v as UW,q as qW,s as Cl,u as KW,w as ZW,x as Re,y as nr,z as Oe,A as ce,B as gs,I as Ek,C as ut,D as YW,E as N0,F as F0,G as nT,H as XW,J as Rs,K as _e,L as QW,M as sT,N as sf,O as Z2,P as JW,Q as Ol,R as eU,T as tU,U as rT,V as iT,W as oT,X as nU,Y as sU,Z as rU,_ as aT,$ as iU,a0 as oU,a1 as aU,a2 as lU,a3 as cU,a4 as uU,a5 as dU,a6 as hU,a7 as fU,a8 as pU,a9 as gU,aa as mU,ab as lT,ac as Nb,ad as cT,ae as uT,af as dT,ag as hT,ah as fT,ai as pT,aj as Fb,ak as gT,al as yU,am as vU,an as bU,ao as mT,ap as yT,aq as vT,ar as Y2,as as bT,at as xT,au as CT,av as ST,aw as wT,ax as X2,ay as Q2,az as jT,aA as kT,aB as _T,aC as IT,aD as ft,aE as Tu,aF as fe,aG as Ce,aH as Bb,aI as AT,aJ as ve,aK as Mu,aL as z,aM as xU,aN as B0,aO as I,aP as CU,aQ as SU,aR as ws,aS as Bf,aT as Dn,aU as $0,aV as rf,aW as TT,aX as $f,aY as Qr,aZ as Vf,a_ as r,a$ as of,b0 as ja,b1 as Pu,b2 as J2,b3 as ka,b4 as eC,b5 as Ei,b6 as Li,b7 as wU,b8 as Gf,b9 as _a,ba as Un,bb as MT,bc as Jr,bd as Ya,be as Nl,bf as nm,bg as bt,bh as jU,bi as kU,bj as pu,bk as Ys,bl as ei,bm as PT,bn as ET,bo as LT,bp as _U,bq as IU,br as AU,bs as An,bt as tC,bu as ze,bv as DT,bw as nC,bx as sC,by as xn,bz as RT,bA as OT,bB as NT,bC as rC,bD as V0,bE as Lk,bF as Eu,bG as It,bH as TU,bI as MU,bJ as Dk,bK as iC,bL as ti,bM as T,bN as K,bO as Z,bP as Fe,bQ as FT,bR as oC,bS as Fl,bT as Ia,bU as BT,bV as PU,bW as G0,bX as va,bY as Bl,bZ as zf,b_ as z0,b$ as EU,c0 as $b,c1 as Vb,c2 as Je,c3 as Aa,c4 as aC,c5 as LU,c6 as Rk,c7 as DU,c8 as RU,c9 as Mm,ca as Gb,cb as Hf,cc as OU,cd as $T,ce as rs,cf as Sl,cg as lC,ch as cC,ci as Pm,cj as zb,ck as uC,cl as dC,cm as H0,cn as NU,co as FU,cp as Ih,cq as VT,cr as me,cs as sr,ct as Ar,cu as GT,cv as ni,cw as rr,cx as si,cy as Tr,cz as lo,cA as ir,cB as ye,cC as co,cD as Wf,cE as hC,cF as te,cG as jn,cH as BU,cI as $U,cJ as fs,cK as ki,cL as Gt,cM as zT,cN as Ok,cO as VU,cP as GU,cQ as Et,cR as it,cS as W0,cT as HT,cU as ot,cV as zU,cW as U0,cX as WT,cY as fC,cZ as UT,c_ as ke,c$ as $e,d0 as Ot,d1 as qT,d2 as wl,d3 as Vn,d4 as Yn,d5 as Uf,d6 as KT,d7 as Gn,d8 as ZT,d9 as Xn,da as dn,db as nt,dc as HU,dd as WU,de as UU,df as qU,dg as qe,dh as Ae,di as pt,dj as or,dk as pC,dl as KU,dm as YT,dn as q0,dp as ZU,dq as YU,dr as XU,ds as QU,dt as JU,du as eq,dv as tq,dw as nq,dx as XT,dy as QT,dz as gC,dA as mC,dB as yC,dC as vC,dD as JT,dE as he,dF as is,dG as Le,dH as Xs,dI as qf,dJ as sq,dK as Qt,dL as Jt,dM as kt,dN as $l,dO as $o,dP as xi,dQ as kr,dR as Kf,dS as rq,dT as bC,dU as Zf,dV as er,dW as eM,dX as tM,dY as iq,dZ as os,d_ as ae,d$ as Vo,e0 as Ct,e1 as eo,e2 as oq,e3 as Di,e4 as xC,e5 as aq,e6 as lq,e7 as Us,e8 as Yf,e9 as cq,ea as nM,eb as sM,ec as uq,ed as rM,ee as dq,ef as hq,eg as fq,eh as pq,ei as gq,ej as Vl,ek as Gl,el as Sn,em as Lu,en as Pn,eo as mq,ep as yq,eq as vq,er as bq,es as xq,et as Cq,eu as Sq,ev as wq,ew as iM,ex as jq,ey as kq,ez as _q,eA as Iq,eB as CC,eC as Aq,eD as Tq,eE as gl,eF as Zn,eG as Mq,eH as Pq,eI as oM,eJ as aM,eK as zl,eL as Hl,eM as K0,eN as Eq,eO as kn,eP as Mr,eQ as Lq,eR as Xf,eS as Qf,eT as Kc,eU as Z0,eV as Es,eW as Dq,eX as Cr,eY as Rq,eZ as Oq,e_ as Nq,e$ as Fq,f0 as SC,f1 as lM,f2 as Bq,f3 as Hb,f4 as $q,f5 as qs,f6 as ca,f7 as Wb,f8 as sm,f9 as cM,fa as uM,fb as dM,fc as Vq,fd as hM,fe as fM,ff as pM,fg as gM,fh as Gq,fi as mM,fj as Y0,fk as wC,fl as Ub,fm as Kr,fn as Rt,fo as Jf,fp as zq,fq as yM,fr as ts,fs as X0,ft as as,fu as Ec,fv as vM,fw as Hq,fx as Nk,fy as Q0,fz as bM,fA as xM,fB as Wq,fC as CM,fD as SM,fE as wM,fF as jC,fG as jM,fH as Uq,fI as kM,fJ as _M,fK as qb,fL as qq,fM as Kq,fN as Zq,fO as lc,fP as Br,fQ as to,fR as Wi,fS as Yq,fT as Fk,fU as $y,fV as Bk,fW as $k,fX as Vk,fY as Gk,fZ as Kb,f_ as Xq,f$ as Em,g0 as Zb,g1 as IM,g2 as AM,g3 as ig,g4 as Qq,g5 as _o,g6 as TM,g7 as MM,g8 as PM,g9 as EM,ga as LM,gb as Jq,gc as eK,gd as Ta,ge as tK,gf as zk,gg as Hk,gh as Lm,gi as nK,gj as sK,gk as DM,gl as rK,gm as iK,gn as oK,go as aK,gp as lK,gq as RM,gr as OM,gs as Yb,gt as Lc,gu as ep,gv as cK,gw as uK,gx as dK,gy as hK,gz as fK,gA as kC,gB as pK,gC as gK,gD as mK,gE as NM,gF as yK,gG as vK,gH as bK,gI as Wk,gJ as xK,gK as J0,gL as tp,gM as _C,gN as FM,gO as CK,gP as SK,gQ as wK,gR as Ah,gS as jK,gT as kK,gU as _K,gV as IK,gW as AK,gX as TK,gY as MK,gZ as PK,g_ as EK,g$ as LK,h0 as DK,h1 as RK,h2 as OK,h3 as NK,h4 as FK,h5 as _i,h6 as Ma,h7 as np,h8 as e1,h9 as t1,ha as BK,hb as $K,hc as BM,hd as $M,he as VM,hf as sp,hg as GM,hh as zM,hi as VK,hj as Zc,hk as Xb,hl as IC,hm as HM,hn as WM,ho as AC,hp as Vy,hq as GK,hr as zK,hs as HK,ht as Th,hu as UM,hv as qM,hw as KM,hx as Wl,hy as WK,hz as UK,hA as rp,hB as qK,hC as Du,hD as Ul,hE as KK,hF as ZK,hG as YK,hH as XK,hI as ZM,hJ as n1,hK as QK,hL as YM,hM as JK,hN as Pa,hO as eZ,hP as TC,hQ as tZ,hR as XM,hS as QM,hT as nZ,hU as JM,hV as e3,hW as t3,hX as ar,hY as sZ,hZ as rZ,h_ as s1,h$ as iZ,i0 as oZ,i1 as aZ,i2 as Uk,i3 as ql,i4 as lZ,i5 as ip,i6 as cZ,i7 as uZ,i8 as dZ,i9 as hZ,ia as fZ,ib as pZ,ic as qk,id as gZ,ie as mZ,ig as yZ,ih as vZ,ii as bZ,ij as xZ,ik as CZ,il as r1,im as SZ,io as wZ,ip as jZ,iq as kZ,ir as _Z,is as IZ,it as AZ,iu as TZ,iv as MZ,iw as PZ,ix as EZ,iy as LZ,iz as n3,iA as s3,iB as DZ,iC as RZ,iD as OZ,iE as NZ,iF as FZ,iG as BZ,iH as op,iI as $Z,iJ as VZ,iK as GZ,iL as zZ,iM as HZ,iN as Kk,iO as WZ,iP as UZ,iQ as qZ,iR as KZ,iS as MC,iT as ZZ,iU as YZ,iV as XZ,iW as af,iX as Dm,iY as Ru,iZ as r3,i_ as ap,i$ as i3,j0 as QZ,j1 as PC,j2 as i1,j3 as JZ,j4 as eY,j5 as tY,j6 as nY,j7 as sY,j8 as rY,j9 as iY,ja as oY,jb as Zk,jc as aY,jd as lY,je as o3,jf as cY,jg as uY,jh as dY,ji as hY,jj as fY,jk as EC,jl as a3,jm as LC,jn as pY,jo as gY,jp as Qb,jq as mY,jr as o1,js as DC,jt as yY,ju as l3,jv as Yr,jw as a1,jx as vY,jy as c3,jz as u3,jA as bY,jB as RC,jC as vd,jD as yo,jE as ns,jF as xY,jG as CY,jH as l1,jI as OC,jJ as SY,jK as Yk,jL as d3,jM as c1,jN as Kl,jO as wY,jP as h3,jQ as jY,jR as f3,jS as kY,jT as p3,jU as _Y,jV as NC,jW as IY,jX as Ou,jY as uo,jZ as g3,j_ as m3,j$ as AY,k0 as y3,k1 as v3,k2 as TY,k3 as u1,k4 as MY,k5 as Nu,k6 as b3,k7 as PY,k8 as x3,k9 as C3,ka as EY,kb as S3,kc as w3,kd as Xk,ke as j3,kf as k3,kg as LY,kh as Qk,ki as DY,kj as Gy,kk as RY,kl as Jk,km as e_,kn as t_,ko as OY,kp as n_,kq as NY,kr as zy,ks as FY,kt as s_,ku as r_,kv as i_,kw as BY,kx as Hy,ky as _3,kz as $Y,kA as o_,kB as VY,kC as a_,kD as GY,kE as l_,kF as zY,kG as HY,kH as WY,kI as UY,kJ as qY,kK as KY,kL as ZY,kM as I3,kN as YY,kO as A3,kP as XY,kQ as QY,kR as JY,kS as eX,kT as d1,kU as tX,kV as nX,kW as sX,kX as rX,kY as iX,kZ as no,k_ as oX,k$ as aX,l0 as FC,l1 as lX,l2 as cX,l3 as uX,l4 as dX,l5 as hX,l6 as fX,l7 as pX,l8 as gX,l9 as mX,la as yX,lb as vX,lc as bX,ld as xX,le as CX,lf as SX,lg as wX,lh as jX,li as kX,lj as _X,lk as IX,ll as AX,lm as TX,ln as MX,lo as PX,lp as EX,lq as LX,lr as DX,ls as RX,lt as OX,lu as NX,lv as FX,lw as BX,lx as $X,ly as VX,lz as GX,lA as zX,lB as HX,lC as WX,lD as UX,lE as qX,lF as KX,lG as ZX,lH as YX,lI as XX,lJ as QX,lK as JX,lL as eQ,lM as tQ,lN as nQ,lO as sQ,lP as rQ,lQ as iQ,lR as oQ,lS as aQ,lT as lQ,lU as cQ,lV as uQ,lW as dQ,lX as hQ,lY as Fu,lZ as ol,l_ as T3,l$ as M3,m0 as P3,m1 as E3,m2 as L3,m3 as D3,m4 as fQ,m5 as R3,m6 as pQ,m7 as gQ,m8 as mQ,m9 as yQ,ma as vQ,mb as bQ,mc as O3,md as xQ,me as CQ,mf as SQ,mg as wQ,mh as jQ,mi as kQ,mj as ms,mk as _Q,ml as IQ,mm as AQ,mn as gu,mo as BC,mp as TQ,mq as MQ,mr as N3,ms as F3,mt as B3,mu as c_,mv as PQ,mw as EQ,mx as LQ,my as $3,mz as lp,mA as V3,mB as G3,mC as z3,mD as $C,mE as DQ,mF as Jb,mG as VC,mH as RQ,mI as Io,mJ as GC,mK as OQ,mL as NQ,mM as FQ,mN as BQ,mO as $Q,mP as VQ,mQ as GQ,mR as h1,mS as rm,mT as zQ,mU as zC,mV as cp,mW as HQ,mX as WQ,mY as UQ,mZ as qQ,m_ as KQ,m$ as H3,n0 as W3,n1 as ZQ,n2 as YQ,n3 as XQ,n4 as QQ,n5 as JQ,n6 as eJ,n7 as tJ,n8 as nJ,n9 as sJ,na as og,nb as rJ,nc as iJ,nd as oJ,ne as aJ,nf as lJ,ng as HC,nh as U3,ni as cJ,nj as uJ,nk as dJ,nl as q3,nm as K3,nn as Z3,no as hJ,np as fJ,nq as pJ,nr as Bu,ns as gJ,nt as mJ,nu as yJ,nv as vJ,nw as bJ,nx as xJ,ny as CJ,nz as SJ,nA as wJ,nB as jJ,nC as kJ,nD as up,nE as Y3,nF as _J,nG as IJ,nH as AJ,nI as TJ,nJ as MJ,nK as PJ,nL as EJ,nM as LJ,nN as DJ,nO as RJ,nP as OJ,nQ as NJ,nR as FJ,nS as BJ,nT as $J,nU as WC,nV as VJ,nW as X3,nX as f1,nY as Q3,nZ as J3,n_ as eP,n$ as tP,o0 as UC,o1 as nP,o2 as GJ,o3 as qC,o4 as KC,o5 as zJ,o6 as HJ,o7 as WJ,o8 as UJ,o9 as qJ,oa as KJ,ob as ZJ,oc as ZC,od as YJ,oe as XJ,of as dp,og as QJ,oh as JJ,oi as eee,oj as tee,ok as nee,ol as see,om as ree,on as u_,oo as sP,op as iee,oq as oee,or as aee,os as lee,ot as cee,ou as uee,ov as rP,ow as dee,ox as hee,oy as fee,oz as pee,oA as gee,oB as mee,oC as yee,oD as vee,oE as bee,oF as xee,oG as YC,oH as d_,oI as Cee,oJ as See,oK as wee,oL as jee,oM as ex,oN as iP,oO as oP,oP as h_,oQ as f_,oR as hp,oS as kee,oT as _ee,oU as cc,oV as p1,oW as tx,oX as g1,oY as Iee,oZ as Aee,o_ as fp,o$ as Tee,p0 as Mee,p1 as Pee,p2 as Eee,p3 as Lee,p4 as Dee,p5 as Ree,p6 as aP,p7 as Oee,p8 as Nee,p9 as Fee,pa as Bee,pb as $ee,pc as Vee,pd as Gee,pe as zee,pf as Rm,pg as lP,ph as cP,pi as nx,pj as Hee,pk as Wee,pl as Cc,pm as ag,pn as ra,po as XC,pp as yr,pq as QC,pr as Yc,ps as Fi,pt as fa,pu as uP,pv as Uee,pw as qee,px as Kee,py as dP,pz as hP,pA as fP,pB as m1,pC as pP,pD as gP,pE as Zee,pF as Yee,pG as Xee,pH as Qee,pI as Jee,pJ as ete,pK as tte,pL as nte,pM as JC,pN as y1,pO as Mh,pP as mP,pQ as yP,pR as vP,pS as ste,pT as eS,pU as rte,pV as bP,pW as xP,pX as Ks,pY as CP,pZ as pp,p_ as SP,p$ as v1,q0 as Dc,q1 as Rc,q2 as Om,q3 as wP,q4 as ite,q5 as ote,q6 as ate,q7 as lte,q8 as p_,q9 as g_,qa as cte,qb as ute,qc as m_,qd as y_,qe as dte,qf as hte,qg as fte,qh as pte,qi as Wy,qj as Uy,qk as gte,ql as mte,qm as yte,qn as vte,qo as bte,qp as xte,qq as jP,qr as Cte,qs as Ste,qt as wte,qu as b1,qv as jte,qw as kte,qx as _te,qy as Ite,qz as Ate,qA as Tte,qB as Mte,qC as Pte,qD as Ete,qE as Lte,qF as Dte,qG as Rte,qH as Ote,qI as Nte,qJ as Fte,qK as Bte,qL as $te,qM as Vte,qN as Gte,qO as zte,qP as Hte,qQ as Wte,qR as Ute,qS as qte,qT as Kte,qU as Zte,qV as Yte,qW as Xte,qX as kP,qY as Qte,qZ as Jte,q_ as ene,q$ as tne,r0 as nne,r1 as _P,r2 as sne,r3 as rne,r4 as ine,r5 as v_,r6 as b_,r7 as one,r8 as x_,r9 as ane,ra as lne,rb as C_,rc as Sc,rd as im,re as cne,rf as une,rg as dne,rh as hne,ri as fne,rj as pne,rk as gne,rl as IP,rm as mne,rn as yne,ro as S_,rp as w_,rq as vne,rr as bne,rs as xne,rt as Cne,ru as Sne}from"./index-CsqsSIO2.js";import{w as wne,i as lf,a as qy,b as Ph,I as jne,u as P}from"./useTranslation-BfepAMwh.js";var Ky,j_;function kne(){return j_||(j_=1,Ky={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),Ky}var _ne=kne();const Ine=Au(_ne);var Ane=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function k_(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(Ine[n[1]]||e.charAt(e.length-2)==="/")&&(t.voidElement=!0),t.name.startsWith("!--"))){var s=e.indexOf("-->");return{type:"comment",comment:s!==-1?e.slice(4,s):""}}for(var i=new RegExp(Ane),o=null;(o=i.exec(e))!==null;)if(o[0].trim())if(o[1]){var a=o[1].trim(),l=[a,""];a.indexOf("=")>-1&&(l=a.split("=")),t.attrs[l[0]]=l[1],i.lastIndex--}else o[2]&&(t.attrs[o[2]]=o[3].trim().substring(1,o[3].length-1));return t}var Tne=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,Mne=/^\s*$/,Pne=Object.create(null);function AP(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(n){var s=[];for(var i in n)s.push(i+'="'+n[i]+'"');return s.length?" "+s.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(AP,"")+"</"+t.name+">";case"comment":return e+"<!--"+t.comment+"-->"}}var Ene={parse:function(e,t){t||(t={}),t.components||(t.components=Pne);var n,s=[],i=[],o=-1,a=!1;if(e.indexOf("<")!==0){var l=e.indexOf("<");s.push({type:"text",content:l===-1?e:e.substring(0,l)})}return e.replace(Tne,function(c,d){if(a){if(c!=="</"+n.name+">")return;a=!1}var h,f=c.charAt(1)!=="/",p=c.startsWith("<!--"),g=d+c.length,m=e.charAt(g);if(p){var y=k_(c);return o<0?(s.push(y),s):((h=i[o]).children.push(y),s)}if(f&&(o++,(n=k_(c)).type==="tag"&&t.components[n.name]&&(n.type="component",a=!0),n.voidElement||a||!m||m==="<"||n.children.push({type:"text",content:e.slice(g,e.indexOf("<",g))}),o===0&&s.push(n),(h=i[o-1])&&h.children.push(n),i[o]=n),(!f||n.voidElement)&&(o>-1&&(n.voidElement||n.name===c.slice(2,-1))&&(o--,n=o===-1?s:i[o]),!a&&m!=="<"&&m)){h=o===-1?s:i[o].children;var x=e.indexOf("<",g),C=e.slice(g,x===-1?void 0:x);Mne.test(C)&&(C=" "),(x>-1&&o+h.length>=0||C!==" ")&&h.push({type:"text",content:C})}}),s},stringify:function(e){return e.reduce(function(t,n){return t+AP("",n)},"")}};const Zy=(e,t)=>{var s;if(!e)return!1;const n=((s=e.props)==null?void 0:s.children)??e.children;return t?n.length>0:!!n},Yy=e=>{var n,s;if(!e)return[];const t=((n=e.props)==null?void 0:n.children)??e.children;return(s=e.props)!=null&&s.i18nIsDynamicList?Oc(t):t},Lne=e=>Array.isArray(e)&&e.every(u.isValidElement),Oc=e=>Array.isArray(e)?e:[e],Dne=(e,t)=>{const n={...t};return n.props=Object.assign(e.props,t.props),n},TP=(e,t)=>{if(!e)return"";let n="";const s=Oc(e),i=t!=null&&t.transSupportBasicHtmlNodes?t.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((o,a)=>{if(lf(o))n+=`${o}`;else if(u.isValidElement(o)){const{props:l,type:c}=o,d=Object.keys(l).length,h=i.indexOf(c)>-1,f=l.children;if(!f&&h&&!d)n+=`<${c}/>`;else if(!f&&(!h||d)||l.i18nIsDynamicList)n+=`<${a}></${a}>`;else if(h&&d===1&&lf(f))n+=`<${c}>${f}</${c}>`;else{const p=TP(f,t);n+=`<${a}>${p}</${a}>`}}else if(o===null)qy("Trans: the passed in value is invalid - seems you passed in a null child.");else if(Ph(o)){const{format:l,...c}=o,d=Object.keys(c);if(d.length===1){const h=l?`${d[0]}, ${l}`:d[0];n+=`{{${h}}}`}else qy("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",o)}else qy("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",o)}),n},Rne=(e,t,n,s,i,o)=>{if(t==="")return[];const a=s.transKeepBasicHtmlNodesFor||[],l=t&&new RegExp(a.map(x=>`<${x}`).join("|")).test(t);if(!e&&!l&&!o)return[t];const c={},d=x=>{Oc(x).forEach(v=>{lf(v)||(Zy(v)?d(Yy(v)):Ph(v)&&!u.isValidElement(v)&&Object.assign(c,v))})};d(e);const h=Ene.parse(`<0>${t}</0>`),f={...c,...i},p=(x,C,v)=>{var w;const b=Yy(x),S=m(b,C.children,v);return Lne(b)&&S.length===0||(w=x.props)!=null&&w.i18nIsDynamicList?b:S},g=(x,C,v,b,S)=>{x.dummy?(x.children=C,v.push(u.cloneElement(x,{key:b},S?void 0:C))):v.push(...u.Children.map([x],w=>{const j={...w.props};return delete j.i18nIsDynamicList,u.createElement(w.type,{...j,key:b,ref:w.ref},S?null:C)}))},m=(x,C,v)=>{const b=Oc(x);return Oc(C).reduce((w,j,E)=>{var L,M;const A=((M=(L=j.children)==null?void 0:L[0])==null?void 0:M.content)&&n.services.interpolator.interpolate(j.children[0].content,f,n.language);if(j.type==="tag"){let O=b[parseInt(j.name,10)];v.length===1&&!O&&(O=v[0][j.name]),O||(O={});const F=Object.keys(j.attrs).length!==0?Dne({props:j.attrs},O):O,_=u.isValidElement(F),R=_&&Zy(j,!0)&&!j.voidElement,D=l&&Ph(F)&&F.dummy&&!_,$=Ph(e)&&Object.hasOwnProperty.call(e,j.name);if(lf(F)){const G=n.services.interpolator.interpolate(F,f,n.language);w.push(G)}else if(Zy(F)||R){const G=p(F,j,v);g(F,G,w,E)}else if(D){const G=m(b,j.children,v);g(F,G,w,E)}else if(Number.isNaN(parseFloat(j.name)))if($){const G=p(F,j,v);g(F,G,w,E,j.voidElement)}else if(s.transSupportBasicHtmlNodes&&a.indexOf(j.name)>-1)if(j.voidElement)w.push(u.createElement(j.name,{key:`${j.name}-${E}`}));else{const G=m(b,j.children,v);w.push(u.createElement(j.name,{key:`${j.name}-${E}`},G))}else if(j.voidElement)w.push(`<${j.name} />`);else{const G=m(b,j.children,v);w.push(`<${j.name}>${G}</${j.name}>`)}else if(Ph(F)&&!_){const G=j.children[0]?A:null;G&&w.push(G)}else g(F,A,w,E,j.children.length!==1||!A)}else if(j.type==="text"){const O=s.transWrapTextNodes,F=o?s.unescape(n.services.interpolator.interpolate(j.content,f,n.language)):n.services.interpolator.interpolate(j.content,f,n.language);O?w.push(u.createElement(O,{key:`${j.name}-${E}`},F)):w.push(F)}return w},[])},y=m([{dummy:!0,children:e||[]}],h,Oc(e||[]));return Yy(y[0])};function One({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o={},values:a,defaults:l,components:c,ns:d,i18n:h,t:f,shouldUnescape:p,...g}){var O,F,_,R,D,$;const m=h||YA();if(!m)return wne("You will need to pass in an i18next instance by using i18nextReactModule"),e;const y=f||m.t.bind(m)||(G=>G),x={...FW(),...(O=m.options)==null?void 0:O.react};let C=d||y.ns||((F=m.options)==null?void 0:F.defaultNS);C=lf(C)?[C]:C||["translation"];const v=TP(e,x),b=l||v||x.transEmptyNodeValue||s,{hashTransKey:S}=x,w=s||(S?S(v||b):v||b);(R=(_=m.options)==null?void 0:_.interpolation)!=null&&R.defaultVariables&&(a=a&&Object.keys(a).length>0?{...a,...m.options.interpolation.defaultVariables}:{...m.options.interpolation.defaultVariables});const j=a||t!==void 0&&!(($=(D=m.options)==null?void 0:D.interpolation)!=null&&$.alwaysFormat)||!e?o.interpolation:{interpolation:{...o.interpolation,prefix:"#$?",suffix:"?$#"}},E={...o,context:i||o.context,count:t,...a,...j,defaultValue:b,ns:C},A=w?y(w,E):b;c&&Object.keys(c).forEach(G=>{const ee=c[G];if(typeof ee.type=="function"||!ee.props||!ee.props.children||A.indexOf(`${G}/>`)<0&&A.indexOf(`${G} />`)<0)return;function Q(){return u.createElement(u.Fragment,null,ee)}c[G]=u.createElement(Q)});const L=Rne(c||e,A,m,x,E,p),M=n??x.defaultTransParent;return M?u.createElement(M,g,L):L}function Xt({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o={},values:a,defaults:l,components:c,ns:d,i18n:h,t:f,shouldUnescape:p,...g}){var v;const{i18n:m,defaultNS:y}=u.useContext(jne)||{},x=h||m||YA(),C=f||(x==null?void 0:x.t.bind(x));return One({children:e,count:t,parent:n,i18nKey:s,context:i,tOptions:o,values:a,defaults:l,components:c,ns:d||(C==null?void 0:C.ns)||y||((v=x==null?void 0:x.options)==null?void 0:v.defaultNS),i18n:x,t:f,shouldUnescape:p,...g})}var Xy=function(){return BW.Date.now()},Nne="Expected a function",Fne=Math.max,Bne=Math.min;function Ea(e,t,n){var s,i,o,a,l,c,d=0,h=!1,f=!1,p=!0;if(typeof e!="function")throw new TypeError(Nne);t=Mk(t)||0,XA(n)&&(h=!!n.leading,f="maxWait"in n,o=f?Fne(Mk(n.maxWait)||0,t):o,p="trailing"in n?!!n.trailing:p);function g(j){var E=s,A=i;return s=i=void 0,d=j,a=e.apply(A,E),a}function m(j){return d=j,l=setTimeout(C,t),h?g(j):a}function y(j){var E=j-c,A=j-d,L=t-E;return f?Bne(L,o-A):L}function x(j){var E=j-c,A=j-d;return c===void 0||E>=t||E<0||f&&A>=o}function C(){var j=Xy();if(x(j))return v(j);l=setTimeout(C,y(j))}function v(j){return l=void 0,p&&s?g(j):(s=i=void 0,a)}function b(){l!==void 0&&clearTimeout(l),d=0,s=c=i=l=void 0}function S(){return l===void 0?a:v(Xy())}function w(){var j=Xy(),E=x(j);if(s=arguments,i=this,c=j,E){if(l===void 0)return m(c);if(f)return clearTimeout(l),l=setTimeout(C,t),g(c)}return l===void 0&&(l=setTimeout(C,t)),a}return w.cancel=b,w.flush=S,w}var $ne=200;function Vne(e,t,n,s){var i=-1,o=VW,a=!0,l=e.length,c=[],d=t.length;if(!l)return c;t.length>=$ne&&(o=GW,a=!1,t=new $W(t));e:for(;++i<l;){var h=e[i],f=h;if(h=h!==0?h:0,a&&f===f){for(var p=d;p--;)if(t[p]===f)continue e;c.push(h)}else o(t,f,s)||c.push(h)}return c}var MP=zW(function(e,t){return Pk(e)?Vne(e,QA(t,1,Pk,!0)):[]});function Gne(e,t){var n=[];return JA(e,function(s,i,o){t(s,i,o)&&n.push(s)}),n}function __(e,t){var n=K2(e)?HW:Gne;return n(e,eT(t))}function zne(e,t){var n=-1,s=tT(e)?Array(e.length):[];return JA(e,function(i,o,a){s[++n]=t(i,o,a)}),s}function Ci(e,t){var n=K2(e)?WW:zne;return n(e,eT(t))}function Hne(e,t){return QA(Ci(e,t))}var Wne=Math.max;function Une(e,t,n,s){e=tT(e)?e:UW(e),n=n?qW(n):0;var i=e.length;return n<0&&(n=Wne(i+n,0)),Cl(e)?n<=i&&e.indexOf(t,n)>-1:!!i&&KW(e,t,n)>-1}var qne="Expected a function";function PP(e){if(typeof e!="function")throw new TypeError(qne);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}var Kne="Expected a function";function sx(e,t,n){var s=!0,i=!0;if(typeof e!="function")throw new TypeError(Kne);return XA(n)&&(s="leading"in n?!!n.leading:s,i="trailing"in n?!!n.trailing:i),Ea(e,t,{leading:s,maxWait:t,trailing:i})}function EP(e,t){return t=typeof t=="function"?t:void 0,e&&e.length?ZW(e,void 0,t):[]}function tS(e){return Object.keys(e)}function Zne(e){return Object.entries(e)}const Qy=new Set;function wt(e){u.useEffect(()=>(Re(!Qy.has(e),`There should be only one instance of ${e}`),Qy.add(e),()=>{Qy.delete(e)}),[e])}const LP=nr("system"),Xc={gallery:new Set,layers:new Set,canvas:new Set,workflows:new Set,viewer:new Set},x1=Oe(null),Yne=tS(Xc).reduce((e,t)=>(e[`$${t}`]=gs(x1,n=>n===t),e),{}),rx=e=>{x1.set(e),LP.trace(`Focus changed: ${e}`)},Go=(e,t,n)=>{u.useEffect(()=>{if(!t.current)return;const{focusOnMount:s=!1}={focusOnMount:!1,...n},i=t.current;return Xc[e].add(i),s&&rx(e),()=>{Xc[e].delete(i),Xc[e].size===0&&x1.get()===e&&rx(null)}},[n,t,e])},Ds=e=>ce(Yne[`$${e}`]),I_=e=>{var i;const t=document.activeElement;if(!(t instanceof HTMLElement))return;const n=[];for(const o of tS(Xc))for(const a of Xc[o])a.contains(t)&&n.push({region:o,element:a});if(n.length===0)return;n.sort((o,a)=>a.element.contains(o.element)?-1:o.element.contains(a.element)?1:0);const s=(i=n[0])==null?void 0:i.region;if(!s){LP.warn("No focused region found");return}rx(s)},Xne=()=>{wt("useFocusRegionWatcher"),u.useEffect(()=>(window.addEventListener("focus",I_,{capture:!0}),()=>{window.removeEventListener("focus",I_,{capture:!0})}),[])},Qne=e=>Object.keys(e),C1=(e,t)=>{var s;if(!e)throw new Ek(t||"Missing base");const n=(s=ut().getState().params.model)==null?void 0:s.base;if(n&&e!==n)throw new Ek(t||`Incompatible base models: ${e} and ${n}`)},Jne=e=>(C1("sdxl","Refiner incompatible with currently-selected model"),new Promise(t=>{t(e)})),ese=e=>(C1(e.base,"VAE incompatible with currently-selected model"),new Promise(t=>{t(e)})),tse=e=>(C1(e.model.base,"LoRA incompatible with currently-selected model"),new Promise(t=>{t(e)})),nse=e=>{const t=[];return e.forEach(n=>{try{C1(n.model.base,"LoRA incompatible with currently-selected model"),t.push(n)}catch{}}),new Promise(n=>{n(t)})},lg={refinerModel:Jne,vaeModel:ese,lora:tse,loras:nse},uc=Symbol("pending"),Xa=Symbol("failed");class sse extends Error{constructor(t){super(t),this.name=this.constructor.name}}const _t=(e,t,n=s=>!0)=>new Promise((s,i)=>{const o=Z2(e,t);n(o)&&s(o),i(new sse(`Property ${t} is not of expected type`))}),rse=e=>_t(e,"created_by",Cl),ise=e=>_t(e,"generation_mode",Cl),ose=e=>_t(e,"positive_prompt",uU),ase=e=>_t(e,"negative_prompt",dU),lse=e=>_t(e,"positive_style_prompt",lU),cse=e=>_t(e,"negative_style_prompt",cU),use=e=>_t(e,"seed",iU),dse=e=>_t(e,"cfg_scale",iT),hse=e=>_t(e,"cfg_rescale_multiplier",pU),fse=e=>_t(e,"guidance",fU),pse=e=>_t(e,"scheduler",Ol),gse=e=>_t(e,"width",rU),mse=e=>_t(e,"height",hU),yse=e=>_t(e,"steps",aT),vse=e=>_t(e,"strength",oT),bse=e=>_t(e,"seamless_x",aU),xse=e=>_t(e,"seamless_y",oU),Cse=async e=>{try{return await _t(e,"hrf_enabled",sU)}catch{return!1}},Sse=e=>_t(e,"hrf_strength",oT),wse=e=>_t(e,"hrf_method",nU),jse=e=>_t(e,"refiner_steps",aT),kse=e=>_t(e,"refiner_cfg_scale",iT),_se=e=>_t(e,"refiner_scheduler",Ol),Ise=e=>_t(e,"refiner_positive_aesthetic_score",eU),Ase=e=>_t(e,"refiner_negative_aesthetic_score",tU),Tse=e=>_t(e,"refiner_start",JW),Mse=async e=>{const t=await _t(e,"model",void 0),n=await N0(t,"main"),s=await F0(n,sf);return Rs.parse(s)},Pse=async e=>{const t=await _t(e,"refiner_model",void 0),n=await N0(t,"main"),s=await F0(n,rT);return Rs.parse(s)},Ese=async e=>{const t=await _t(e,"vae",void 0),n=await N0(t,"vae"),s=await F0(n,sT);return Rs.parse(s)},DP=async e=>{const t=await _t(e,"lora",void 0),n=await _t(e,"model",void 0),s=await _t(e,"weight",void 0),i=await N0(n??t,"lora"),o=await F0(i,nT);return{id:_e("lora"),model:Rs.parse(o),weight:QW(s)?s:XW.weight,isEnabled:!0}},Lse=async e=>{try{const t=await _t(e,"loras",K2);return(await Promise.allSettled(t.map(i=>DP(i)))).filter(i=>i.status==="fulfilled").map(i=>i.value)}catch{return[]}},Dse=async e=>{const t=await _t(e,"canvas_v2_metadata",void 0);return YW.parseAsync(t)},Mt={createdBy:rse,generationMode:ise,positivePrompt:ose,negativePrompt:ase,sdxlPositiveStylePrompt:lse,sdxlNegativeStylePrompt:cse,seed:use,cfgScale:dse,cfgRescaleMultiplier:hse,guidance:fse,scheduler:pse,width:gse,height:mse,steps:yse,strength:vse,seamlessX:bse,seamlessY:xse,hrfEnabled:Cse,hrfStrength:Sse,hrfMethod:wse,refinerSteps:jse,refinerCFGScale:kse,refinerScheduler:_se,refinerPositiveAestheticScore:Ise,refinerNegativeAestheticScore:Ase,refinerStart:Tse,mainModel:Mse,refinerModel:Pse,vaeModel:Ese,lora:DP,loras:Lse,canvasV2Metadata:Dse},Rse=e=>{ut().dispatch(X2(e))},Ose=e=>{ut().dispatch(Q2(e))},Nse=e=>{ut().dispatch(CT(e))},Fse=e=>{ut().dispatch(ST(e))},Bse=e=>{ut().dispatch(Y2(e))},$se=e=>{ut().dispatch(_T(e))},Vse=e=>{ut().dispatch(kT(e))},Gse=e=>{ut().dispatch(IT(e))},zse=e=>{ut().dispatch(wT(e))},RP={updateAspectRatio:!0,clamp:!0},Hse=e=>{ut().dispatch(mT({width:e,...RP}))},Wse=e=>{ut().dispatch(jT({height:e,...RP}))},Use=e=>{ut().dispatch(vT(e))},qse=e=>{ut().dispatch(yT(e))},Kse=e=>{ut().dispatch(xT(e))},Zse=e=>{ut().dispatch(bT(e))},Yse=e=>{ut().dispatch(bU(e))},Xse=e=>{ut().dispatch(yU(e))},Qse=e=>{ut().dispatch(vU(e))},Jse=e=>{ut().dispatch(uT(e))},ere=e=>{ut().dispatch(gT(e))},tre=e=>{ut().dispatch(hT(e))},nre=e=>{ut().dispatch(fT(e))},sre=e=>{ut().dispatch(pT(e))},rre=e=>{ut().dispatch(dT(e))},ire=e=>{ut().dispatch(cT(e))},ore=e=>{ut().dispatch(Fb(e))},are=e=>{if(!e){ut().dispatch(Nb(null));return}ut().dispatch(Nb(e))},lre=e=>{ut().dispatch(lT({lora:e}))},cre=e=>{const{dispatch:t}=ut();t(mU()),e.length&&e.forEach(n=>{t(lT({lora:n}))})},ure=e=>{if(e.controlLayers.length===0&&e.rasterLayers.length===0&&e.inpaintMasks.length===0&&e.referenceImages.length===0&&e.regionalGuidance.length===0)return;const{dispatch:t}=ut();t(gU(e))},Bt={positivePrompt:Rse,negativePrompt:Ose,sdxlPositiveStylePrompt:Nse,sdxlNegativeStylePrompt:Fse,seed:Bse,cfgScale:$se,guidance:Vse,cfgRescaleMultiplier:Gse,scheduler:zse,width:Hse,height:Wse,steps:Use,strength:qse,seamlessX:Kse,seamlessY:Zse,hrfEnabled:Yse,hrfStrength:Xse,hrfMethod:Qse,refinerSteps:Jse,refinerCFGScale:ere,refinerScheduler:tre,refinerPositiveAestheticScore:nre,refinerNegativeAestheticScore:sre,refinerStart:rre,model:ire,refinerModel:ore,vae:are,lora:lre,loras:cre,canvasV2Metadata:ure},Jy=async e=>{try{const t=await AT(e.key);return`${t.name} (${t.base.toUpperCase()})`}catch{return`${e.key} (${e.base.toUpperCase()})`}},dre=async e=>{try{const t=await AT(e.model.key);return`${t.name} (${t.base.toUpperCase()}) - ${e.weight}`}catch{return`${e.model.key} (${e.model.base.toUpperCase()}) - ${e.weight}`}},$u=e=>{fe({id:"PARAMETER_SET",title:Ce("toast.parameterSet"),description:Ce("toast.parameterSetDesc",{parameter:e}),status:"info"})},S1=(e,t)=>{fe({id:"PARAMETER_NOT_SET",title:Ce("toast.parameterNotSet"),description:t?Ce("toast.parameterNotSetDescWithMessage",{parameter:e,message:t}):Ce("toast.parameterNotSetDesc",{parameter:e}),status:"warning"})},hre=e=>async(t,n=!1)=>{try{const s=await e.parser(t);return n&&$u(e.getLabel()),s}catch(s){throw n&&S1(e.getLabel(),s.message),s}},fre=e=>async(t,n=!1)=>{try{const s=await e.itemParser(t);return n&&$u(e.getLabel()),s}catch(s){throw n&&S1(e.getLabel(),s.message),s}},pre=e=>async(t,n=!1)=>{try{e.validator&&await e.validator(t),await e.recaller(t),n&&$u(e.getLabel())}catch(s){throw n&&S1(e.getLabel(),s.message),s}},gre=e=>async(t,n=!1)=>{try{e.itemValidator&&await e.itemValidator(t),await e.itemRecaller(t),n&&$u(e.getLabel())}catch(s){throw n&&S1(e.getLabel(),s.message),s}},A_=e=>new Promise(t=>{t(String(e))}),Dt=({getLabel:e,parser:t,itemParser:n,recaller:s,itemRecaller:i,validator:o,itemValidator:a,renderValue:l,renderItemValue:c,getIsVisible:d})=>({parse:hre({parser:t,getLabel:e}),parseItem:n?fre({itemParser:n,getLabel:e}):void 0,recall:s?pre({recaller:s,validator:o,getLabel:e}):void 0,recallItem:i?gre({itemRecaller:i,itemValidator:a,getLabel:e}):void 0,getLabel:e,renderValue:l??A_,renderItemValue:c??A_,getIsVisible:d}),lt={createdBy:Dt({getLabel:()=>Ce("metadata.createdBy"),parser:Mt.createdBy}),generationMode:Dt({getLabel:()=>Ce("metadata.generationMode"),parser:Mt.generationMode}),cfgRescaleMultiplier:Dt({getLabel:()=>Ce("metadata.cfgRescaleMultiplier"),parser:Mt.cfgRescaleMultiplier,recaller:Bt.cfgRescaleMultiplier}),cfgScale:Dt({getLabel:()=>Ce("metadata.cfgScale"),parser:Mt.cfgScale,recaller:Bt.cfgScale}),guidance:Dt({getLabel:()=>Ce("metadata.guidance"),parser:Mt.guidance,recaller:Bt.guidance}),height:Dt({getLabel:()=>Ce("metadata.height"),parser:Mt.height,recaller:Bt.height}),negativePrompt:Dt({getLabel:()=>Ce("metadata.negativePrompt"),parser:Mt.negativePrompt,recaller:Bt.negativePrompt}),positivePrompt:Dt({getLabel:()=>Ce("metadata.positivePrompt"),parser:Mt.positivePrompt,recaller:Bt.positivePrompt}),scheduler:Dt({getLabel:()=>Ce("metadata.scheduler"),parser:Mt.scheduler,recaller:Bt.scheduler}),sdxlNegativeStylePrompt:Dt({getLabel:()=>Ce("sdxl.negStylePrompt"),parser:Mt.sdxlNegativeStylePrompt,recaller:Bt.sdxlNegativeStylePrompt}),sdxlPositiveStylePrompt:Dt({getLabel:()=>Ce("sdxl.posStylePrompt"),parser:Mt.sdxlPositiveStylePrompt,recaller:Bt.sdxlPositiveStylePrompt}),seamlessX:Dt({getLabel:()=>Ce("metadata.seamlessXAxis"),parser:Mt.seamlessX,recaller:Bt.seamlessX}),seamlessY:Dt({getLabel:()=>Ce("metadata.seamlessYAxis"),parser:Mt.seamlessY,recaller:Bt.seamlessY}),seed:Dt({getLabel:()=>Ce("metadata.seed"),parser:Mt.seed,recaller:Bt.seed}),steps:Dt({getLabel:()=>Ce("metadata.steps"),parser:Mt.steps,recaller:Bt.steps}),strength:Dt({getLabel:()=>Ce("metadata.strength"),parser:Mt.strength,recaller:Bt.strength}),width:Dt({getLabel:()=>Ce("metadata.width"),parser:Mt.width,recaller:Bt.width}),hrfEnabled:Dt({getLabel:()=>Ce("hrf.metadata.enabled"),parser:Mt.hrfEnabled,recaller:Bt.hrfEnabled}),hrfMethod:Dt({getLabel:()=>Ce("hrf.metadata.method"),parser:Mt.hrfMethod,recaller:Bt.hrfMethod}),hrfStrength:Dt({getLabel:()=>Ce("hrf.metadata.strength"),parser:Mt.hrfStrength,recaller:Bt.hrfStrength}),refinerCFGScale:Dt({getLabel:()=>Ce("sdxl.cfgScale"),parser:Mt.refinerCFGScale,recaller:Bt.refinerCFGScale}),refinerModel:Dt({getLabel:()=>Ce("sdxl.refinermodel"),parser:Mt.refinerModel,recaller:Bt.refinerModel,validator:lg.refinerModel,renderValue:Jy}),refinerNegativeAestheticScore:Dt({getLabel:()=>Ce("sdxl.posAestheticScore"),parser:Mt.refinerNegativeAestheticScore,recaller:Bt.refinerNegativeAestheticScore}),refinerPositiveAestheticScore:Dt({getLabel:()=>Ce("sdxl.negAestheticScore"),parser:Mt.refinerPositiveAestheticScore,recaller:Bt.refinerPositiveAestheticScore}),refinerScheduler:Dt({getLabel:()=>Ce("sdxl.scheduler"),parser:Mt.refinerScheduler,recaller:Bt.refinerScheduler}),refinerStart:Dt({getLabel:()=>Ce("sdxl.refinerStart"),parser:Mt.refinerStart,recaller:Bt.refinerStart}),refinerSteps:Dt({getLabel:()=>Ce("sdxl.refinerSteps"),parser:Mt.refinerSteps,recaller:Bt.refinerSteps}),model:Dt({getLabel:()=>Ce("metadata.model"),parser:Mt.mainModel,recaller:Bt.model,renderValue:Jy}),vae:Dt({getLabel:()=>Ce("metadata.vae"),parser:Mt.vaeModel,recaller:Bt.vae,renderValue:Jy,validator:lg.vaeModel}),loras:Dt({getLabel:()=>Ce("models.lora"),parser:Mt.loras,itemParser:Mt.lora,recaller:Bt.loras,itemRecaller:Bt.lora,validator:lg.loras,itemValidator:lg.lora,renderItemValue:dre}),canvasV2Metadata:Dt({getLabel:()=>Ce("metadata.canvasV2Metadata"),parser:Mt.canvasV2Metadata,recaller:Bt.canvasV2Metadata})},mre=async e=>{const n=await nS(["positivePrompt","negativePrompt","sdxlPositiveStylePrompt","sdxlNegativeStylePrompt"],e);Tu(n)>0&&$u(Ce("metadata.allPrompts"))},yre=e=>{const t=nS(["width","height"],e);Tu(t)>0&&$u(Ce("metadata.imageDimensions"))},vre=["strength"],bre=[],ix=async(e,t,n=[])=>{const s=ft(n);t?s.push(...vre):s.push(...bre);const i=Qne(lt).filter(a=>!s.includes(a)),o=await nS(i,e);Tu(o)>0?fe({id:"PARAMETER_SET",title:Ce("toast.parametersSet"),status:"info"}):fe({id:"PARAMETER_SET",title:Ce("toast.parametersNotSet"),status:"warning"})},nS=async(e,t)=>{const{dispatch:n}=ut(),s={},i=e.sort(o=>o==="model"?-1:0);for(const o of i){const{parse:a,recall:l}=lt[o];if(l)try{const c=await a(t);await l(c),s[o]=c}catch{}}return s.sdxlPositiveStylePrompt&&s.sdxlPositiveStylePrompt!==s.positivePrompt||s.sdxlNegativeStylePrompt&&s.sdxlNegativeStylePrompt!==s.negativePrompt?n(Bb(!1)):n(Bb(!0)),s},xre={isModalOpen:!1,updatingStylePresetId:null,prefilledFormData:null},ba=Oe(xre),On=ve(Mu,e=>e.activeTab),OP=ve(Mu,e=>e.shouldShowImageDetails),sS=ve(Mu,e=>e.shouldShowProgressInViewer),cf=ve(Mu,e=>e.activeTabCanvasRightPanel),NP=e=>{const t=z(),{t:n}=P(),[s,i]=xU();return[u.useCallback(async a=>{try{const{data:l}=await s(a);l?(t(B0({data:l,asCopy:!0})),e!=null&&e.onSuccess&&(e==null||e.onSuccess())):fe({id:"PROBLEM_RETRIEVING_WORKFLOW",title:n("toast.problemRetrievingWorkflow"),status:"error"})}catch{fe({id:"PROBLEM_RETRIEVING_WORKFLOW",title:n("toast.problemRetrievingWorkflow"),status:"error"})}},[s,t,e,n]),i]};function FP(e,t,n){var s=this,i=u.useRef(null),o=u.useRef(0),a=u.useRef(null),l=u.useRef([]),c=u.useRef(),d=u.useRef(),h=u.useRef(e),f=u.useRef(!0);h.current=e;var p=typeof window<"u",g=!t&&t!==0&&p;if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0;var m=!!(n=n||{}).leading,y=!("trailing"in n)||!!n.trailing,x="maxWait"in n,C="debounceOnServer"in n&&!!n.debounceOnServer,v=x?Math.max(+n.maxWait||0,t):null;u.useEffect(function(){return f.current=!0,function(){f.current=!1}},[]);var b=u.useMemo(function(){var S=function(M){var O=l.current,F=c.current;return l.current=c.current=null,o.current=M,d.current=h.current.apply(F,O)},w=function(M,O){g&&cancelAnimationFrame(a.current),a.current=g?requestAnimationFrame(M):setTimeout(M,O)},j=function(M){if(!f.current)return!1;var O=M-i.current;return!i.current||O>=t||O<0||x&&M-o.current>=v},E=function(M){return a.current=null,y&&l.current?S(M):(l.current=c.current=null,d.current)},A=function M(){var O=Date.now();if(j(O))return E(O);if(f.current){var F=t-(O-i.current),_=x?Math.min(F,v-(O-o.current)):F;w(M,_)}},L=function(){if(p||C){var M=Date.now(),O=j(M);if(l.current=[].slice.call(arguments),c.current=s,i.current=M,O){if(!a.current&&f.current)return o.current=i.current,w(A,t),m?S(i.current):d.current;if(x)return w(A,t),S(i.current)}return a.current||w(A,t),d.current}};return L.cancel=function(){a.current&&(g?cancelAnimationFrame(a.current):clearTimeout(a.current)),o.current=0,l.current=i.current=c.current=a.current=null},L.isPending=function(){return!!a.current},L.flush=function(){return a.current?E(Date.now()):d.current},L},[m,x,t,v,y,g,p,C]);return b}function Cre(e,t){return e===t}function Sre(e,t){return t}function Zl(e,t,n){var s=Cre,i=u.useReducer(Sre,e),o=i[0],a=i[1],l=FP(u.useCallback(function(d){return a(d)},[a]),t,n),c=u.useRef(e);return s(c.current,e)||(l(e),c.current=e),s(o,e)&&l.cancel(),[o,l]}const BP=e=>{const t=I(CU),[n]=Zl(e,t),{data:s,isLoading:i}=SU(n??ws);return{metadata:s,isLoading:i}},rS=e=>{const t=z(),{t:n}=P(),s=I(Bf),i=I(Dn),o=I(On),{metadata:a}=BP(e.image_name),[l,c]=u.useState(!1),[d,h]=u.useState(!1),[f,p]=u.useState(!1),g=ce($0);u.useEffect(()=>{(async()=>{if(a){c(!0);try{await lt.seed.parse(a),h(!0)}catch{h(!1)}(await Promise.allSettled([lt.positivePrompt.parse(a).catch(()=>{}),lt.negativePrompt.parse(a).catch(()=>{}),lt.sdxlPositiveStylePrompt.parse(a).catch(()=>{}),lt.sdxlNegativeStylePrompt.parse(a).catch(()=>{})])).some(O=>O.status==="fulfilled")?p(!0):p(!1)}else c(!1),h(!1),p(!1)})()},[a]);const m=u.useCallback(()=>{s&&(t(rf(null)),fe({status:"info",title:n("stylePresets.promptTemplateCleared")}))},[t,s,n]),y=u.useCallback(()=>{a&&(ix(a,o==="canvas",i?["width","height"]:[]),m())},[a,o,i,m]),x=u.useCallback(()=>{a&&(ix(a,o==="canvas",["seed"]),m())},[o,a,m]),C=u.useCallback(()=>{a&&lt.seed.parse(a).then(L=>{var M,O;(O=(M=lt.seed).recall)==null||O.call(M,L,!0)}).catch(()=>{})},[a]),v=u.useCallback(()=>{a&&(mre(a),m())},[a,m]),b=u.useCallback(async()=>{if(!a)return;let L,M;try{L=await lt.positivePrompt.parse(a)}catch{L=""}try{M=await lt.negativePrompt.parse(a)}catch{M=""}ba.set({prefilledFormData:{name:"",positivePrompt:L,negativePrompt:M,imageUrl:e.image_url,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[a,e]),[S]=NP(),w=u.useCallback(()=>{!e.has_workflow||!g||S(e.image_name)},[S,g,e.has_workflow,e.image_name]),j=u.useCallback(()=>{i||yre(e)},[e,i]),E=u.useCallback(()=>{t(TT({imageDTO:e}))},[t,e]),A=u.useCallback(()=>{t($f([e]))},[t,e]);return{hasMetadata:l,hasSeed:d,hasPrompts:f,recallAll:y,remix:x,recallSeed:C,recallPrompts:v,createAsPreset:b,loadWorkflow:w,hasWorkflow:e.has_workflow,recallSize:j,upscale:E,delete:A}},un=e=>{const t=u.useMemo(()=>ve(Qr,s=>!(s.disabledFeatures.includes(e)||s.disabledSDFeatures.includes(e)||s.disabledTabs.includes(e))),[e]);return I(t)};function ox(){return ox=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ox.apply(this,arguments)}var $P=["shift","alt","meta","mod","ctrl"],wre={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function ua(e){return(wre[e]||e).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function jre(e){return $P.includes(e)}function ev(e,t){return t===void 0&&(t=","),e.split(t)}function tv(e,t,n){t===void 0&&(t="+");var s=e.toLocaleLowerCase().split(t).map(function(a){return ua(a)}),i={alt:s.includes("alt"),ctrl:s.includes("ctrl")||s.includes("control"),shift:s.includes("shift"),meta:s.includes("meta"),mod:s.includes("mod")},o=s.filter(function(a){return!$P.includes(a)});return ox({},i,{keys:o,description:n})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&VP([ua(e.key),ua(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&GP([ua(e.key),ua(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){da.clear()})})();var da=new Set;function iS(e){return Array.isArray(e)}function kre(e,t){t===void 0&&(t=",");var n=iS(e)?e:e.split(t);return n.every(function(s){return da.has(s.trim().toLowerCase())})}function VP(e){var t=Array.isArray(e)?e:[e];da.has("meta")&&da.forEach(function(n){return!jre(n)&&da.delete(n.toLowerCase())}),t.forEach(function(n){return da.add(n.toLowerCase())})}function GP(e){var t=Array.isArray(e)?e:[e];e==="meta"?da.clear():t.forEach(function(n){return da.delete(n.toLowerCase())})}function _re(e,t,n){(typeof n=="function"&&n(e,t)||n===!0)&&e.preventDefault()}function Ire(e,t,n){return typeof n=="function"?n(e,t):n===!0||n===void 0}function Are(e){return zP(e,["input","textarea","select"])}function zP(e,t){var n=e.target;t===void 0&&(t=!1);var s=n&&n.tagName;return iS(t)?!!(s&&t&&t.some(function(i){return i.toLowerCase()===s.toLowerCase()})):!!(s&&t&&t===!0)}function Tre(e,t){return e.length===0&&t?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):t?e.some(function(n){return t.includes(n)})||e.includes("*"):!0}var Mre=function(t,n,s){s===void 0&&(s=!1);var i=n.alt,o=n.meta,a=n.mod,l=n.shift,c=n.ctrl,d=n.keys,h=t.key,f=t.code,p=t.ctrlKey,g=t.metaKey,m=t.shiftKey,y=t.altKey,x=ua(f),C=h.toLowerCase();if(!(d!=null&&d.includes(x))&&!(d!=null&&d.includes(C))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(x))return!1;if(!s){if(i===!y&&C!=="alt"||l===!m&&C!=="shift")return!1;if(a){if(!g&&!p)return!1}else if(o===!g&&C!=="meta"&&C!=="os"||c===!p&&C!=="ctrl"&&C!=="control")return!1}return d&&d.length===1&&(d.includes(C)||d.includes(x))?!0:d?kre(d):!d},Pre=u.createContext(void 0),Ere=function(){return u.useContext(Pre)};function HP(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(n,s){return n&&HP(e[s],t[s])},!0):e===t}var Lre=u.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),Dre=function(){return u.useContext(Lre)};function Rre(e){var t=u.useRef(void 0);return HP(t.current,e)||(t.current=e),t.current}var T_=function(t){t.stopPropagation(),t.preventDefault(),t.stopImmediatePropagation()},Ore=typeof window<"u"?u.useLayoutEffect:u.useEffect;function Si(e,t,n,s){var i=u.useRef(null),o=u.useRef(!1),a=n instanceof Array?s instanceof Array?void 0:s:n,l=iS(e)?e.join(a==null?void 0:a.splitKey):e,c=n instanceof Array?n:s instanceof Array?s:void 0,d=u.useCallback(t,c??[]),h=u.useRef(d);c?h.current=d:h.current=t;var f=Rre(a),p=Dre(),g=p.enabledScopes,m=Ere();return Ore(function(){if(!((f==null?void 0:f.enabled)===!1||!Tre(g,f==null?void 0:f.scopes))){var y=function(S,w){var j;if(w===void 0&&(w=!1),!(Are(S)&&!zP(S,f==null?void 0:f.enableOnFormTags))){if(i.current!==null){var E=i.current.getRootNode();if((E instanceof Document||E instanceof ShadowRoot)&&E.activeElement!==i.current&&!i.current.contains(E.activeElement)){T_(S);return}}(j=S.target)!=null&&j.isContentEditable&&!(f!=null&&f.enableOnContentEditable)||ev(l,f==null?void 0:f.splitKey).forEach(function(A){var L,M=tv(A,f==null?void 0:f.combinationKey);if(Mre(S,M,f==null?void 0:f.ignoreModifiers)||(L=M.keys)!=null&&L.includes("*")){if(f!=null&&f.ignoreEventWhen!=null&&f.ignoreEventWhen(S)||w&&o.current)return;if(_re(S,M,f==null?void 0:f.preventDefault),!Ire(S,M,f==null?void 0:f.enabled)){T_(S);return}h.current(S,M),w||(o.current=!0)}})}},x=function(S){S.key!==void 0&&(VP(ua(S.code)),((f==null?void 0:f.keydown)===void 0&&(f==null?void 0:f.keyup)!==!0||f!=null&&f.keydown)&&y(S))},C=function(S){S.key!==void 0&&(GP(ua(S.code)),o.current=!1,f!=null&&f.keyup&&y(S,!0))},v=i.current||(a==null?void 0:a.document)||document;return v.addEventListener("keyup",C),v.addEventListener("keydown",x),m&&ev(l,f==null?void 0:f.splitKey).forEach(function(b){return m.addHotkey(tv(b,f==null?void 0:f.combinationKey,f==null?void 0:f.description))}),function(){v.removeEventListener("keyup",C),v.removeEventListener("keydown",x),m&&ev(l,f==null?void 0:f.splitKey).forEach(function(b){return m.removeHotkey(tv(b,f==null?void 0:f.combinationKey,f==null?void 0:f.description))})}}},[l,f,g]),i}const Nre=(e,t)=>e.map(n=>t?n.split("+").map(s=>s.replaceAll("mod","cmd").replaceAll("alt","option")):n.split("+").map(s=>s.replaceAll("mod","ctrl"))),WP=()=>{const{t:e}=P(),t=un("modelManager"),n=u.useMemo(()=>navigator.userAgent.toLowerCase().includes("mac"),[]);return u.useMemo(()=>{const i={app:{title:e("hotkeys.app.title"),hotkeys:{}},canvas:{title:e("hotkeys.canvas.title"),hotkeys:{}},viewer:{title:e("hotkeys.viewer.title"),hotkeys:{}},gallery:{title:e("hotkeys.gallery.title"),hotkeys:{}},workflows:{title:e("hotkeys.workflows.title"),hotkeys:{}}},o=(a,l,c)=>{i[a].hotkeys[l]={id:l,category:a,title:e(`hotkeys.${a}.${l}.title`),desc:e(`hotkeys.${a}.${l}.desc`),hotkeys:c,platformKeys:Nre(c,n)}};return o("app","invoke",["mod+enter"]),o("app","invokeFront",["mod+shift+enter"]),o("app","cancelQueueItem",["shift+x"]),o("app","clearQueue",["mod+shift+x"]),o("app","selectCanvasTab",["1"]),o("app","selectUpscalingTab",["2"]),o("app","selectWorkflowsTab",["3"]),t&&o("app","selectModelsTab",["4"]),o("app","selectQueueTab",t?["5"]:["4"]),o("app","focusPrompt",["alt+a"]),o("app","toggleLeftPanel",["t","o"]),o("app","toggleRightPanel",["g"]),o("app","resetPanelLayout",["shift+r"]),o("app","togglePanels",["f"]),o("canvas","selectBrushTool",["b"]),o("canvas","selectBboxTool",["c"]),o("canvas","decrementToolWidth",["["]),o("canvas","incrementToolWidth",["]"]),o("canvas","selectEraserTool",["e"]),o("canvas","selectMoveTool",["v"]),o("canvas","selectRectTool",["u"]),o("canvas","selectViewTool",["h"]),o("canvas","selectColorPickerTool",["i"]),o("canvas","setFillToWhite",["d"]),o("canvas","fitLayersToCanvas",["mod+0"]),o("canvas","fitBboxToCanvas",["mod+shift+0"]),o("canvas","setZoomTo100Percent",["mod+1"]),o("canvas","setZoomTo200Percent",["mod+2"]),o("canvas","setZoomTo400Percent",["mod+3"]),o("canvas","setZoomTo800Percent",["mod+4"]),o("canvas","quickSwitch",["q"]),o("canvas","deleteSelected",["delete","backspace"]),o("canvas","resetSelected",["shift+c"]),o("canvas","transformSelected",["shift+t"]),o("canvas","filterSelected",["shift+f"]),o("canvas","undo",["mod+z"]),o("canvas","redo",["mod+shift+z","mod+y"]),o("canvas","nextEntity",["alt+]"]),o("canvas","prevEntity",["alt+["]),o("canvas","applyFilter",["enter"]),o("canvas","cancelFilter",["esc"]),o("canvas","applyTransform",["enter"]),o("canvas","cancelTransform",["esc"]),o("canvas","applySegmentAnything",["enter"]),o("canvas","cancelSegmentAnything",["esc"]),o("workflows","addNode",["shift+a","space"]),o("workflows","copySelection",["mod+c"]),o("workflows","pasteSelection",["mod+v"]),o("workflows","pasteSelectionWithEdges",["mod+shift+v"]),o("workflows","selectAll",["mod+a"]),o("workflows","deleteSelection",["delete","backspace"]),o("workflows","undo",["mod+z"]),o("workflows","redo",["mod+shift+z","mod+y"]),o("viewer","toggleViewer",["z"]),o("viewer","swapImages",["c"]),o("viewer","nextComparisonMode",["m"]),o("viewer","loadWorkflow",["w"]),o("viewer","recallAll",["a"]),o("viewer","recallSeed",["s"]),o("viewer","recallPrompts",["p"]),o("viewer","remix",["r"]),o("viewer","useSize",["d"]),o("viewer","runPostprocessing",["shift+u"]),o("viewer","toggleMetadata",["i"]),o("gallery","selectAllOnPage",["mod+a"]),o("gallery","clearSelection",["esc"]),o("gallery","galleryNavUp",["up"]),o("gallery","galleryNavRight",["right"]),o("gallery","galleryNavDown",["down"]),o("gallery","galleryNavLeft",["left"]),o("gallery","galleryNavUpAlt",["alt+up"]),o("gallery","galleryNavRightAlt",["alt+right"]),o("gallery","galleryNavDownAlt",["alt+down"]),o("gallery","galleryNavLeftAlt",["alt+left"]),o("gallery","deleteSelection",["delete","backspace"]),i},[n,t,e])},Ee=({id:e,category:t,callback:n,options:s,dependencies:i})=>{const o=WP(),a=u.useMemo(()=>{var c;const l=(c=o[t].hotkeys[e])==null?void 0:c.hotkeys;return Re(l!==void 0,`Hotkey ${t}.${e} not found`),l},[t,o,e]);return Si(a,n,s,i)},UP=u.memo(()=>{wt("GlobalImageHotkeys");const e=I(Vf);return e?r.jsx(qP,{imageDTO:e}):null});UP.displayName="GlobalImageHotkeys";const qP=u.memo(({imageDTO:e})=>{const t=Ds("gallery"),n=Ds("viewer"),s=rS(e),i=I(Dn),o=un("upscaling");return Ee({id:"loadWorkflow",category:"viewer",callback:s.loadWorkflow,options:{enabled:t||n},dependencies:[s.loadWorkflow,t,n]}),Ee({id:"recallAll",category:"viewer",callback:s.recallAll,options:{enabled:!i&&(t||n)},dependencies:[s.recallAll,i,t,n]}),Ee({id:"recallSeed",category:"viewer",callback:s.recallSeed,options:{enabled:t||n},dependencies:[s.recallSeed,t,n]}),Ee({id:"recallPrompts",category:"viewer",callback:s.recallPrompts,options:{enabled:t||n},dependencies:[s.recallPrompts,t,n]}),Ee({id:"remix",category:"viewer",callback:s.remix,options:{enabled:t||n},dependencies:[s.remix,t,n]}),Ee({id:"useSize",category:"viewer",callback:s.recallSize,options:{enabled:!i&&(t||n)},dependencies:[s.recallSize,i,t,n]}),Ee({id:"runPostprocessing",category:"viewer",callback:s.upscale,options:{enabled:o&&n},dependencies:[o,e,n]}),null});qP.displayName="GlobalImageHotkeysInternal";const KP=u.createContext(null),zr=u.memo(({children:e})=>{const t=ce(of);return t?r.jsx(KP.Provider,{value:t,children:e}):null});zr.displayName="CanvasManagerProviderGate";const Tt=()=>{const e=u.useContext(KP);return Re(e,"useCanvasManagerContext must be used within a CanvasManagerProviderGate"),e},oS=()=>ce(of);let M_=!1;const ZP=ja(!0),Fre=ZP[0],Qc=ZP[1],Lt=()=>{const e=z(),t=oS(),n=Fre(),s=u.useCallback(()=>{!M_&&t&&(M_=!0,t.stage.fitLayersToStage()),n.setFalse()},[t,n]),i=u.useCallback(o=>{e(Pu(null)),e(J2(o)),n.setTrue()},[e,n]);return{isOpen:n.isTrue,open:n.setTrue,close:s,toggle:n.toggle,openImageInViewer:i}},Qa=ka("gallery/sentImageToCanvas"),Bre=ka("gallery/imageDownloaded"),[gp,$re]=eC(!1),bd=(e="")=>wU(`workflows/${e}`),jl=Ei.injectEndpoints({endpoints:e=>({getWorkflow:e.query({query:t=>bd(`i/${t}`),providesTags:(t,n,s)=>[{type:"Workflow",id:s},"FetchOnReconnect"],onQueryStarted:async(t,n)=>{const{dispatch:s,queryFulfilled:i}=n;try{await i,s(jl.util.invalidateTags([{type:"WorkflowsRecent",id:Li}]))}catch{}}}),deleteWorkflow:e.mutation({query:t=>({url:bd(`i/${t}`),method:"DELETE"}),invalidatesTags:(t,n,s)=>[{type:"Workflow",id:Li},{type:"Workflow",id:s},{type:"WorkflowsRecent",id:Li}]}),createWorkflow:e.mutation({query:t=>({url:bd(),method:"POST",body:{workflow:t}}),invalidatesTags:[{type:"Workflow",id:Li},{type:"WorkflowsRecent",id:Li}]}),updateWorkflow:e.mutation({query:t=>({url:bd(`i/${t.id}`),method:"PATCH",body:{workflow:t}}),invalidatesTags:(t,n,s)=>[{type:"WorkflowsRecent",id:Li},{type:"Workflow",id:Li},{type:"Workflow",id:s.id}]}),listWorkflows:e.query({query:t=>({url:bd(),params:t}),providesTags:["FetchOnReconnect",{type:"Workflow",id:Li}]})})}),{useLazyGetWorkflowQuery:Vre,useCreateWorkflowMutation:YP,useDeleteWorkflowMutation:Gre,useUpdateWorkflowMutation:zre,useListWorkflowsQuery:Hre}=jl,XP=e=>{const t=z(),n=Gf(),{t:s}=P(),[i,o]=Vre();return{getAndLoadWorkflow:u.useCallback(async l=>{try{const{workflow:c}=await i(l).unwrap();t(B0({data:{workflow:JSON.stringify(c),graph:null},asCopy:!1})),e!=null&&e.onSuccess&&e.onSuccess()}catch{n({id:`AUTH_ERROR_TOAST_${jl.endpoints.getWorkflow.name}`,title:s("toast.problemRetrievingWorkflow"),status:"error"}),e!=null&&e.onError&&e.onError()}},[i,t,e,s,n]),getAndLoadWorkflowResult:o}},Wre=e=>{wt("useStudioInitAction");const{t}=P(),n=u.useRef(!1),s=ce($0),i=_a(),{getAndLoadWorkflow:o}=XP(),a=u.useCallback(async f=>{const p=await Un(()=>MT(f));if(p.isErr()){fe({title:t("toast.unableToLoadImage"),status:"error"});return}const g=p.value,y={objects:[Jr(g)]};i.dispatch(Ya()),i.dispatch(Nl({overrides:y,isSelected:!0})),i.dispatch(nm(!0)),i.dispatch(bt("canvas")),i.dispatch(Qa()),Qc.set(!1),fe({title:t("toast.sentToCanvas"),status:"info"})},[i,t]),l=u.useCallback(async f=>{const p=await Un(()=>jU(f));if(p.isErr()){fe({title:t("toast.unableToLoadImageMetadata"),status:"error"});return}const g=p.value;ix(g,!0),i.dispatch(bt("canvas"))},[i,t]),c=u.useCallback(f=>{o(f),i.dispatch(bt("workflows"))},[o,i]),d=u.useCallback(async f=>{if((await Un(()=>kU(f))).isErr()){fe({title:t("toast.unableToLoadStylePreset"),status:"error"});return}i.dispatch(rf(f)),i.dispatch(bt("canvas")),fe({title:t("toast.stylePresetLoaded"),status:"info"})},[i,t]),h=u.useCallback(f=>{switch(f){case"generation":i.dispatch(bt("canvas")),i.dispatch(Ys("gallery")),i.dispatch(nm(!1)),Qc.set(!0);break;case"canvas":i.dispatch(bt("canvas")),i.dispatch(nm(!0)),Qc.set(!1);break;case"workflows":i.dispatch(bt("workflows"));break;case"upscaling":i.dispatch(bt("upscaling"));break;case"viewAllWorkflows":i.dispatch(bt("workflows")),$re.set(!0);break;case"viewAllStylePresets":i.dispatch(bt("canvas")),pu.set(!0);break}},[i]);u.useEffect(()=>{if(!(n.current||!e||!s))switch(n.current=!0,e.type){case"loadWorkflow":c(e.data.workflowId);break;case"selectStylePreset":d(e.data.stylePresetId);break;case"sendToCanvas":a(e.data.imageName);break;case"useAllParameters":l(e.data.imageName);break;case"goToDestination":h(e.data.destination);break}},[a,l,e,d,h,c,s])},P_=document.title,Ure="assets/images/invoke-favicon.svg",qre="assets/images/invoke-alert-favicon.svg",Kre=()=>{const{queueSize:e}=ei(void 0,{selectFromResult:t=>({queueSize:t.data?t.data.queue.pending+t.data.queue.in_progress:0})});u.useEffect(()=>{document.title=e>0?`(${e}) ${P_}`:P_;const t=document.getElementById("invoke-favicon");t instanceof HTMLLinkElement&&(t.href=e>0?qre:Ure)},[e])},QP=e=>u.useMemo(()=>nr(e),[e]),Zre=()=>{wt("useSyncLoggingConfig");const e=ce(IU),t=I(PT),n=I(ET),s=I(LT);u.useLayoutEffect(()=>{_U((e==null?void 0:e.logIsEnabled)??s,(e==null?void 0:e.logLevel)??t,(e==null?void 0:e.logNamespaces)??n)},[s,t,n,e==null?void 0:e.logIsEnabled,e==null?void 0:e.logLevel,e==null?void 0:e.logNamespaces])},JP=()=>u.useCallback(()=>{AU(),localStorage.clear()},[]),w1=()=>{const e=ce(An),{data:t}=ei(),[n,{isLoading:s}]=tC(),{t:i}=P(),o=u.useMemo(()=>t==null?void 0:t.queue.item_id,[t==null?void 0:t.queue.item_id]),a=u.useCallback(async()=>{if(o)try{await n(o).unwrap(),fe({id:"QUEUE_CANCEL_SUCCEEDED",title:i("queue.cancelSucceeded"),status:"success"})}catch{fe({id:"QUEUE_CANCEL_FAILED",title:i("queue.cancelFailed"),status:"error"})}},[o,i,n]),l=u.useMemo(()=>!e||ze(o),[e,o]);return{cancelQueueItem:a,isLoading:s,currentQueueItemId:o,isDisabled:l}},eE=()=>{const{t:e}=P(),t=z(),{data:n}=ei(),s=ce(An),[i,{isLoading:o}]=DT({fixedCacheKey:"clearQueue"}),a=u.useCallback(async()=>{if(n!=null&&n.queue.total)try{await i().unwrap(),fe({id:"QUEUE_CLEAR_SUCCEEDED",title:e("queue.clearSucceeded"),status:"success"}),t(nC(void 0)),t(sC(void 0))}catch{fe({id:"QUEUE_CLEAR_FAILED",title:e("queue.clearFailed"),status:"error"})}},[n==null?void 0:n.queue.total,i,t,e]),l=u.useMemo(()=>!s||!(n!=null&&n.queue.total),[s,n==null?void 0:n.queue.total]);return{clearQueue:a,isLoading:o,queueStatus:n,isDisabled:l}},Bi=Oe(!0),aS=()=>{const e=z(),t=I(On),n=ce(An),s=oS(),i=ce((s==null?void 0:s.stateApi.$isFiltering)??Bi),o=ce((s==null?void 0:s.stateApi.$isTransforming)??Bi),a=ce((s==null?void 0:s.stateApi.$isRasterizing)??Bi),l=ce((s==null?void 0:s.stateApi.$isSegmenting)??Bi),c=ce((s==null?void 0:s.compositor.$isBusy)??Bi),d=ce(xn),h=u.useMemo(()=>t==="canvas"?RT({isConnected:n,canvasIsFiltering:i,canvasIsTransforming:o,canvasIsRasterizing:a,canvasIsSelectingObject:l,canvasIsCompositing:c}):t==="upscaling"?OT({isConnected:n}):t==="workflows"?NT({isConnected:n,templates:d}):()=>!1,[t,n,i,o,a,l,c,d]),f=I(h),[p,{isLoading:g}]=rC(V0),m=u.useCallback(()=>{f&&e(Lk({tabName:t,prepend:!1}))},[e,f,t]),y=u.useCallback(()=>{f&&e(Lk({tabName:t,prepend:!0}))},[e,f,t]);return{queueBack:m,queueFront:y,isLoading:g,isDisabled:!f}},Yre=()=>{const e=z(),t=un("modelManager"),n=aS();Ee({id:"invoke",category:"app",callback:n.queueBack,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]}),Ee({id:"invokeFront",category:"app",callback:n.queueFront,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]});const{cancelQueueItem:s,isDisabled:i,isLoading:o}=w1();Ee({id:"cancelQueueItem",category:"app",callback:s,options:{enabled:!i&&!o,preventDefault:!0},dependencies:[s,i,o]});const{clearQueue:a,isDisabled:l,isLoading:c}=eE();Ee({id:"clearQueue",category:"app",callback:a,options:{enabled:!l&&!c,preventDefault:!0},dependencies:[a,l,c]}),Ee({id:"selectCanvasTab",category:"app",callback:()=>{e(bt("canvas"))},dependencies:[e]}),Ee({id:"selectUpscalingTab",category:"app",callback:()=>{e(bt("upscaling"))},dependencies:[e]}),Ee({id:"selectWorkflowsTab",category:"app",callback:()=>{e(bt("workflows"))},dependencies:[e]}),Ee({id:"selectModelsTab",category:"app",callback:()=>{e(bt("models"))},options:{enabled:t},dependencies:[e,t]}),Ee({id:"selectQueueTab",category:"app",callback:()=>{e(bt("queue"))},dependencies:[e,t]})},Xre=It(FT,e=>e.imagesToChange),Qre=ve(FT,e=>e.isModalOpen),Jre=()=>{wt("ChangeBoardModal");const e=z(),[t,n]=u.useState(),{data:s,isFetching:i}=Eu({include_archived:!0}),o=I(Qre),a=I(Xre),[l]=TU(),[c]=MU(),{t:d}=P(),h=u.useMemo(()=>[{label:d("boards.uncategorized"),value:"none"}].concat((s??[]).map(y=>({label:y.board_name,value:y.board_id}))),[s,d]),f=u.useMemo(()=>h.find(y=>y.value===t),[h,t]),p=u.useCallback(()=>{e(Dk()),e(iC(!1))},[e]),g=u.useCallback(()=>{!a.length||!t||(t==="none"?c({imageDTOs:a}):l({imageDTOs:a,board_id:t}),n(null),e(Dk()))},[l,e,a,c,t]),m=u.useCallback(y=>{y&&n(y.value)},[]);return r.jsx(ti,{isOpen:o,onClose:p,title:d("boards.changeBoard"),acceptCallback:g,acceptButtonText:d("boards.move"),cancelButtonText:d("boards.cancel"),useInert:!1,children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(K,{children:[d("boards.movingImagesToBoard",{count:a.length}),":"]}),r.jsx(Z,{isDisabled:i,children:r.jsx(Fe,{placeholder:d(i?"boards.loading":"boards.selectBoard"),onChange:m,value:f,options:h})})]})})},eie=u.memo(Jre);ve(oC,Fl,(e,t)=>{const{data:n}=e;let s=null;if(n){const o=Ia.selectAll(n).filter(aC).sort(l=>l.type==="controlnet"?-1:1);s=o.filter(l=>t?l.base===t:!0)[0]??o[0]??null}const i=(s==null?void 0:s.type)==="t2i_adapter"?ft(LU):ft(Bl);return s&&(i.model=Rs.parse(s)),i});const No=ve(oC,Fl,(e,t)=>{const{data:n}=e;let s=null;if(n){const o=Ia.selectAll(n).filter(BT);s=o.filter(l=>t?l.base===t:!0)[0]??o[0]??null}const i=ft(PU);return s&&(i.model=Rs.parse(s),s.base==="flux"&&(i.clipVisionModel="ViT-L")),i}),lS=()=>{const e=z();return u.useCallback(()=>{const n={controlAdapter:ft(Bl)};e(zf({isSelected:!0,overrides:n}))},[e])},cS=()=>{const e=z();return u.useCallback(()=>{e(Nl({isSelected:!0}))},[e])},uS=()=>{const e=z();return u.useCallback(()=>{e(G0({isSelected:!0}))},[e])},dS=()=>{const e=z();return u.useCallback(()=>{e(va({isSelected:!0}))},[e])},tE=()=>{const e=z(),t=I(No);return u.useCallback(()=>{const s={referenceImages:[{id:_e("regional_guidance_reference_image"),ipAdapter:ft(t)}]};e(va({isSelected:!0,overrides:s}))},[t,e])},hS=()=>{const e=z(),t=I(No);return u.useCallback(()=>{const s={ipAdapter:ft(t)};e(z0({isSelected:!0,overrides:s}))},[t,e])},nE=e=>{const t=z(),n=I(No);return u.useCallback(()=>{t(EU({entityIdentifier:e,overrides:{ipAdapter:ft(n)}}))},[n,t,e])},sE=e=>{const t=z();return u.useCallback(()=>{t($b({entityIdentifier:e,prompt:""}))},[t,e])},rE=e=>{const t=z();return u.useCallback(()=>{t(Vb({entityIdentifier:e,prompt:""}))},[t,e])},iE=e=>It(Je,t=>{const n=Aa(t,e);return{canAddPositivePrompt:(n==null?void 0:n.positivePrompt)===null,canAddNegativePrompt:(n==null?void 0:n.negativePrompt)===null}});class $t{constructor(){k(this,"initialize");k(this,"getLoggingContext",()=>({...this.parent.getLoggingContext(),path:this.path.join(" > ")}));k(this,"destroy",()=>{this.log("Destroying module")});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path}))}}var om={exports:{}},xd={},nv={},sv={},E_;function yt(){return E_||(E_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e._registerNode=e.Konva=e.glob=void 0;const t=Math.PI/180;function n(){return typeof window<"u"&&({}.toString.call(window)==="[object Window]"||{}.toString.call(window)==="[object global]")}e.glob=typeof Rk<"u"?Rk:typeof window<"u"?window:typeof WorkerGlobalScope<"u"?self:{},e.Konva={_global:e.glob,version:"9.3.15",isBrowser:n(),isUnminified:/param/.test((function(i){}).toString()),dblClickWindow:400,getAngle(i){return e.Konva.angleDeg?i*t:i},enableTrace:!1,pointerEventsEnabled:!0,autoDrawEnabled:!0,hitOnDragEnabled:!1,capturePointerEventsEnabled:!1,_mouseListenClick:!1,_touchListenClick:!1,_pointerListenClick:!1,_mouseInDblClickWindow:!1,_touchInDblClickWindow:!1,_pointerInDblClickWindow:!1,_mouseDblClickPointerId:null,_touchDblClickPointerId:null,_pointerDblClickPointerId:null,_fixTextRendering:!1,pixelRatio:typeof window<"u"&&window.devicePixelRatio||1,dragDistance:3,angleDeg:!0,showWarnings:!0,dragButtons:[0,1],isDragging(){return e.Konva.DD.isDragging},isTransforming(){var i;return(i=e.Konva.Transformer)===null||i===void 0?void 0:i.isTransforming()},isDragReady(){return!!e.Konva.DD.node},releaseCanvasOnDestroy:!0,document:e.glob.document,_injectGlobal(i){e.glob.Konva=i}};const s=i=>{e.Konva[i.prototype.getClassName()]=i};e._registerNode=s,e.Konva._injectGlobal(e.Konva)}(sv)),sv}var rv={},L_;function _n(){return L_||(L_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Util=e.Transform=void 0;const t=yt();class n{constructor(S=[1,0,0,1,0,0]){this.dirty=!1,this.m=S&&S.slice()||[1,0,0,1,0,0]}reset(){this.m[0]=1,this.m[1]=0,this.m[2]=0,this.m[3]=1,this.m[4]=0,this.m[5]=0}copy(){return new n(this.m)}copyInto(S){S.m[0]=this.m[0],S.m[1]=this.m[1],S.m[2]=this.m[2],S.m[3]=this.m[3],S.m[4]=this.m[4],S.m[5]=this.m[5]}point(S){var w=this.m;return{x:w[0]*S.x+w[2]*S.y+w[4],y:w[1]*S.x+w[3]*S.y+w[5]}}translate(S,w){return this.m[4]+=this.m[0]*S+this.m[2]*w,this.m[5]+=this.m[1]*S+this.m[3]*w,this}scale(S,w){return this.m[0]*=S,this.m[1]*=S,this.m[2]*=w,this.m[3]*=w,this}rotate(S){var w=Math.cos(S),j=Math.sin(S),E=this.m[0]*w+this.m[2]*j,A=this.m[1]*w+this.m[3]*j,L=this.m[0]*-j+this.m[2]*w,M=this.m[1]*-j+this.m[3]*w;return this.m[0]=E,this.m[1]=A,this.m[2]=L,this.m[3]=M,this}getTranslation(){return{x:this.m[4],y:this.m[5]}}skew(S,w){var j=this.m[0]+this.m[2]*w,E=this.m[1]+this.m[3]*w,A=this.m[2]+this.m[0]*S,L=this.m[3]+this.m[1]*S;return this.m[0]=j,this.m[1]=E,this.m[2]=A,this.m[3]=L,this}multiply(S){var w=this.m[0]*S.m[0]+this.m[2]*S.m[1],j=this.m[1]*S.m[0]+this.m[3]*S.m[1],E=this.m[0]*S.m[2]+this.m[2]*S.m[3],A=this.m[1]*S.m[2]+this.m[3]*S.m[3],L=this.m[0]*S.m[4]+this.m[2]*S.m[5]+this.m[4],M=this.m[1]*S.m[4]+this.m[3]*S.m[5]+this.m[5];return this.m[0]=w,this.m[1]=j,this.m[2]=E,this.m[3]=A,this.m[4]=L,this.m[5]=M,this}invert(){var S=1/(this.m[0]*this.m[3]-this.m[1]*this.m[2]),w=this.m[3]*S,j=-this.m[1]*S,E=-this.m[2]*S,A=this.m[0]*S,L=S*(this.m[2]*this.m[5]-this.m[3]*this.m[4]),M=S*(this.m[1]*this.m[4]-this.m[0]*this.m[5]);return this.m[0]=w,this.m[1]=j,this.m[2]=E,this.m[3]=A,this.m[4]=L,this.m[5]=M,this}getMatrix(){return this.m}decompose(){var S=this.m[0],w=this.m[1],j=this.m[2],E=this.m[3],A=this.m[4],L=this.m[5],M=S*E-w*j;let O={x:A,y:L,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(S!=0||w!=0){var F=Math.sqrt(S*S+w*w);O.rotation=w>0?Math.acos(S/F):-Math.acos(S/F),O.scaleX=F,O.scaleY=M/F,O.skewX=(S*j+w*E)/M,O.skewY=0}else if(j!=0||E!=0){var _=Math.sqrt(j*j+E*E);O.rotation=Math.PI/2-(E>0?Math.acos(-j/_):-Math.acos(j/_)),O.scaleX=M/_,O.scaleY=_,O.skewX=0,O.skewY=(S*j+w*E)/M}return O.rotation=e.Util._getRotation(O.rotation),O}}e.Transform=n;var s="[object Array]",i="[object Number]",o="[object String]",a="[object Boolean]",l=Math.PI/180,c=180/Math.PI,d="#",h="",f="0",p="Konva warning: ",g="Konva error: ",m="rgb(",y={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]},x=/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/,C=[];const v=typeof requestAnimationFrame<"u"&&requestAnimationFrame||function(b){setTimeout(b,60)};e.Util={_isElement(b){return!!(b&&b.nodeType==1)},_isFunction(b){return!!(b&&b.constructor&&b.call&&b.apply)},_isPlainObject(b){return!!b&&b.constructor===Object},_isArray(b){return Object.prototype.toString.call(b)===s},_isNumber(b){return Object.prototype.toString.call(b)===i&&!isNaN(b)&&isFinite(b)},_isString(b){return Object.prototype.toString.call(b)===o},_isBoolean(b){return Object.prototype.toString.call(b)===a},isObject(b){return b instanceof Object},isValidSelector(b){if(typeof b!="string")return!1;var S=b[0];return S==="#"||S==="."||S===S.toUpperCase()},_sign(b){return b===0||b>0?1:-1},requestAnimFrame(b){C.push(b),C.length===1&&v(function(){const S=C;C=[],S.forEach(function(w){w()})})},createCanvasElement(){var b=document.createElement("canvas");try{b.style=b.style||{}}catch{}return b},createImageElement(){return document.createElement("img")},_isInDocument(b){for(;b=b.parentNode;)if(b==document)return!0;return!1},_urlToImage(b,S){var w=e.Util.createImageElement();w.onload=function(){S(w)},w.src=b},_rgbToHex(b,S,w){return((1<<24)+(b<<16)+(S<<8)+w).toString(16).slice(1)},_hexToRgb(b){b=b.replace(d,h);var S=parseInt(b,16);return{r:S>>16&255,g:S>>8&255,b:S&255}},getRandomColor(){for(var b=(Math.random()*16777215<<0).toString(16);b.length<6;)b=f+b;return d+b},getRGB(b){var S;return b in y?(S=y[b],{r:S[0],g:S[1],b:S[2]}):b[0]===d?this._hexToRgb(b.substring(1)):b.substr(0,4)===m?(S=x.exec(b.replace(/ /g,"")),{r:parseInt(S[1],10),g:parseInt(S[2],10),b:parseInt(S[3],10)}):{r:0,g:0,b:0}},colorToRGBA(b){return b=b||"black",e.Util._namedColorToRBA(b)||e.Util._hex3ColorToRGBA(b)||e.Util._hex4ColorToRGBA(b)||e.Util._hex6ColorToRGBA(b)||e.Util._hex8ColorToRGBA(b)||e.Util._rgbColorToRGBA(b)||e.Util._rgbaColorToRGBA(b)||e.Util._hslColorToRGBA(b)},_namedColorToRBA(b){var S=y[b.toLowerCase()];return S?{r:S[0],g:S[1],b:S[2],a:1}:null},_rgbColorToRGBA(b){if(b.indexOf("rgb(")===0){b=b.match(/rgb\(([^)]+)\)/)[1];var S=b.split(/ *, */).map(Number);return{r:S[0],g:S[1],b:S[2],a:1}}},_rgbaColorToRGBA(b){if(b.indexOf("rgba(")===0){b=b.match(/rgba\(([^)]+)\)/)[1];var S=b.split(/ *, */).map((w,j)=>w.slice(-1)==="%"?j===3?parseInt(w)/100:parseInt(w)/100*255:Number(w));return{r:S[0],g:S[1],b:S[2],a:S[3]}}},_hex8ColorToRGBA(b){if(b[0]==="#"&&b.length===9)return{r:parseInt(b.slice(1,3),16),g:parseInt(b.slice(3,5),16),b:parseInt(b.slice(5,7),16),a:parseInt(b.slice(7,9),16)/255}},_hex6ColorToRGBA(b){if(b[0]==="#"&&b.length===7)return{r:parseInt(b.slice(1,3),16),g:parseInt(b.slice(3,5),16),b:parseInt(b.slice(5,7),16),a:1}},_hex4ColorToRGBA(b){if(b[0]==="#"&&b.length===5)return{r:parseInt(b[1]+b[1],16),g:parseInt(b[2]+b[2],16),b:parseInt(b[3]+b[3],16),a:parseInt(b[4]+b[4],16)/255}},_hex3ColorToRGBA(b){if(b[0]==="#"&&b.length===4)return{r:parseInt(b[1]+b[1],16),g:parseInt(b[2]+b[2],16),b:parseInt(b[3]+b[3],16),a:1}},_hslColorToRGBA(b){if(/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.test(b)){const[S,...w]=/hsl\((\d+),\s*([\d.]+)%,\s*([\d.]+)%\)/g.exec(b),j=Number(w[0])/360,E=Number(w[1])/100,A=Number(w[2])/100;let L,M,O;if(E===0)return O=A*255,{r:Math.round(O),g:Math.round(O),b:Math.round(O),a:1};A<.5?L=A*(1+E):L=A+E-A*E;const F=2*A-L,_=[0,0,0];for(let R=0;R<3;R++)M=j+1/3*-(R-1),M<0&&M++,M>1&&M--,6*M<1?O=F+(L-F)*6*M:2*M<1?O=L:3*M<2?O=F+(L-F)*(2/3-M)*6:O=F,_[R]=O*255;return{r:Math.round(_[0]),g:Math.round(_[1]),b:Math.round(_[2]),a:1}}},haveIntersection(b,S){return!(S.x>b.x+b.width||S.x+S.width<b.x||S.y>b.y+b.height||S.y+S.height<b.y)},cloneObject(b){var S={};for(var w in b)this._isPlainObject(b[w])?S[w]=this.cloneObject(b[w]):this._isArray(b[w])?S[w]=this.cloneArray(b[w]):S[w]=b[w];return S},cloneArray(b){return b.slice(0)},degToRad(b){return b*l},radToDeg(b){return b*c},_degToRad(b){return e.Util.warn("Util._degToRad is removed. Please use public Util.degToRad instead."),e.Util.degToRad(b)},_radToDeg(b){return e.Util.warn("Util._radToDeg is removed. Please use public Util.radToDeg instead."),e.Util.radToDeg(b)},_getRotation(b){return t.Konva.angleDeg?e.Util.radToDeg(b):b},_capitalize(b){return b.charAt(0).toUpperCase()+b.slice(1)},throw(b){throw new Error(g+b)},error(b){console.error(g+b)},warn(b){t.Konva.showWarnings&&console.warn(p+b)},each(b,S){for(var w in b)S(w,b[w])},_inRange(b,S,w){return S<=b&&b<w},_getProjectionToSegment(b,S,w,j,E,A){var L,M,O,F=(b-w)*(b-w)+(S-j)*(S-j);if(F==0)L=b,M=S,O=(E-w)*(E-w)+(A-j)*(A-j);else{var _=((E-b)*(w-b)+(A-S)*(j-S))/F;_<0?(L=b,M=S,O=(b-E)*(b-E)+(S-A)*(S-A)):_>1?(L=w,M=j,O=(w-E)*(w-E)+(j-A)*(j-A)):(L=b+_*(w-b),M=S+_*(j-S),O=(L-E)*(L-E)+(M-A)*(M-A))}return[L,M,O]},_getProjectionToLine(b,S,w){var j=e.Util.cloneObject(b),E=Number.MAX_VALUE;return S.forEach(function(A,L){if(!(!w&&L===S.length-1)){var M=S[(L+1)%S.length],O=e.Util._getProjectionToSegment(A.x,A.y,M.x,M.y,b.x,b.y),F=O[0],_=O[1],R=O[2];R<E&&(j.x=F,j.y=_,E=R)}}),j},_prepareArrayForTween(b,S,w){var j,E=[],A=[];if(b.length>S.length){var L=S;S=b,b=L}for(j=0;j<b.length;j+=2)E.push({x:b[j],y:b[j+1]});for(j=0;j<S.length;j+=2)A.push({x:S[j],y:S[j+1]});var M=[];return A.forEach(function(O){var F=e.Util._getProjectionToLine(O,E,w);M.push(F.x),M.push(F.y)}),M},_prepareToStringify(b){var S;b.visitedByCircularReferenceRemoval=!0;for(var w in b)if(b.hasOwnProperty(w)&&b[w]&&typeof b[w]=="object"){if(S=Object.getOwnPropertyDescriptor(b,w),b[w].visitedByCircularReferenceRemoval||e.Util._isElement(b[w]))if(S.configurable)delete b[w];else return null;else if(e.Util._prepareToStringify(b[w])===null)if(S.configurable)delete b[w];else return null}return delete b.visitedByCircularReferenceRemoval,b},_assign(b,S){for(var w in S)b[w]=S[w];return b},_getFirstPointerId(b){return b.touches?b.changedTouches[0].identifier:b.pointerId||999},releaseCanvas(...b){t.Konva.releaseCanvasOnDestroy&&b.forEach(S=>{S.width=0,S.height=0})},drawRoundedRectPath(b,S,w,j){let E=0,A=0,L=0,M=0;typeof j=="number"?E=A=L=M=Math.min(j,S/2,w/2):(E=Math.min(j[0]||0,S/2,w/2),A=Math.min(j[1]||0,S/2,w/2),M=Math.min(j[2]||0,S/2,w/2),L=Math.min(j[3]||0,S/2,w/2)),b.moveTo(E,0),b.lineTo(S-A,0),b.arc(S-A,A,A,Math.PI*3/2,0,!1),b.lineTo(S,w-M),b.arc(S-M,w-M,M,0,Math.PI/2,!1),b.lineTo(L,w),b.arc(L,w-L,L,Math.PI/2,Math.PI,!1),b.lineTo(0,E),b.arc(E,E,E,Math.PI,Math.PI*3/2,!1)}}}(rv)),rv}var Cd={},iv={},en={},D_;function xt(){if(D_)return en;D_=1,Object.defineProperty(en,"__esModule",{value:!0}),en.getComponentValidator=en.getBooleanValidator=en.getNumberArrayValidator=en.getFunctionValidator=en.getStringOrGradientValidator=en.getStringValidator=en.getNumberOrAutoValidator=en.getNumberOrArrayOfNumbersValidator=en.getNumberValidator=en.alphaComponent=en.RGBComponent=void 0;const e=yt(),t=_n();function n(m){return t.Util._isString(m)?'"'+m+'"':Object.prototype.toString.call(m)==="[object Number]"||t.Util._isBoolean(m)?m:Object.prototype.toString.call(m)}function s(m){return m>255?255:m<0?0:Math.round(m)}en.RGBComponent=s;function i(m){return m>1?1:m<1e-4?1e-4:m}en.alphaComponent=i;function o(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isNumber(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a number.'),m}}en.getNumberValidator=o;function a(m){if(e.Konva.isUnminified)return function(y,x){let C=t.Util._isNumber(y),v=t.Util._isArray(y)&&y.length==m;return!C&&!v&&t.Util.warn(n(y)+' is a not valid value for "'+x+'" attribute. The value should be a number or Array<number>('+m+")"),y}}en.getNumberOrArrayOfNumbersValidator=a;function l(){if(e.Konva.isUnminified)return function(m,y){var x=t.Util._isNumber(m),C=m==="auto";return x||C||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a number or "auto".'),m}}en.getNumberOrAutoValidator=l;function c(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isString(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a string.'),m}}en.getStringValidator=c;function d(){if(e.Konva.isUnminified)return function(m,y){const x=t.Util._isString(m),C=Object.prototype.toString.call(m)==="[object CanvasGradient]"||m&&m.addColorStop;return x||C||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a string or a native gradient.'),m}}en.getStringOrGradientValidator=d;function h(){if(e.Konva.isUnminified)return function(m,y){return t.Util._isFunction(m)||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a function.'),m}}en.getFunctionValidator=h;function f(){if(e.Konva.isUnminified)return function(m,y){const x=Int8Array?Object.getPrototypeOf(Int8Array):null;return x&&m instanceof x||(t.Util._isArray(m)?m.forEach(function(C){t.Util._isNumber(C)||t.Util.warn('"'+y+'" attribute has non numeric element '+C+". Make sure that all elements are numbers.")}):t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a array of numbers.')),m}}en.getNumberArrayValidator=f;function p(){if(e.Konva.isUnminified)return function(m,y){var x=m===!0||m===!1;return x||t.Util.warn(n(m)+' is a not valid value for "'+y+'" attribute. The value should be a boolean.'),m}}en.getBooleanValidator=p;function g(m){if(e.Konva.isUnminified)return function(y,x){return y==null||t.Util.isObject(y)||t.Util.warn(n(y)+' is a not valid value for "'+x+'" attribute. The value should be an object with properties '+m),y}}return en.getComponentValidator=g,en}var R_;function vt(){return R_||(R_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Factory=void 0;const t=_n(),n=xt();var s="get",i="set";e.Factory={addGetterSetter(o,a,l,c,d){e.Factory.addGetter(o,a,l),e.Factory.addSetter(o,a,c,d),e.Factory.addOverloadedGetterSetter(o,a)},addGetter(o,a,l){var c=s+t.Util._capitalize(a);o.prototype[c]=o.prototype[c]||function(){var d=this.attrs[a];return d===void 0?l:d}},addSetter(o,a,l,c){var d=i+t.Util._capitalize(a);o.prototype[d]||e.Factory.overWriteSetter(o,a,l,c)},overWriteSetter(o,a,l,c){var d=i+t.Util._capitalize(a);o.prototype[d]=function(h){return l&&h!==void 0&&h!==null&&(h=l.call(this,h,a)),this._setAttr(a,h),c&&c.call(this),this}},addComponentsGetterSetter(o,a,l,c,d){var h=l.length,f=t.Util._capitalize,p=s+f(a),g=i+f(a),m,y;o.prototype[p]=function(){var C={};for(m=0;m<h;m++)y=l[m],C[y]=this.getAttr(a+f(y));return C};var x=(0,n.getComponentValidator)(l);o.prototype[g]=function(C){var v=this.attrs[a],b;c&&(C=c.call(this,C)),x&&x.call(this,C,a);for(b in C)C.hasOwnProperty(b)&&this._setAttr(a+f(b),C[b]);return C||l.forEach(S=>{this._setAttr(a+f(S),void 0)}),this._fireChangeEvent(a,v,C),d&&d.call(this),this},e.Factory.addOverloadedGetterSetter(o,a)},addOverloadedGetterSetter(o,a){var l=t.Util._capitalize(a),c=i+l,d=s+l;o.prototype[a]=function(){return arguments.length?(this[c](arguments[0]),this):this[d]()}},addDeprecatedGetterSetter(o,a,l,c){t.Util.error("Adding deprecated "+a);var d=s+t.Util._capitalize(a),h=a+" property is deprecated and will be removed soon. Look at Konva change log for more information.";o.prototype[d]=function(){t.Util.error(h);var f=this.attrs[a];return f===void 0?l:f},e.Factory.addSetter(o,a,c,function(){t.Util.error(h)}),e.Factory.addOverloadedGetterSetter(o,a)},backCompat(o,a){t.Util.each(a,function(l,c){var d=o.prototype[c],h=s+t.Util._capitalize(l),f=i+t.Util._capitalize(l);function p(){d.apply(this,arguments),t.Util.error('"'+l+'" method is deprecated and will be removed soon. Use ""'+c+'" instead.')}o.prototype[l]=p,o.prototype[h]=p,o.prototype[f]=p})},afterSetFilter(){this._filterUpToDate=!1}}}(iv)),iv}var vo={},bo={},O_;function oE(){if(O_)return bo;O_=1,Object.defineProperty(bo,"__esModule",{value:!0}),bo.HitContext=bo.SceneContext=bo.Context=void 0;const e=_n(),t=yt();function n(C){var v=[],b=C.length,S=e.Util,w,j;for(w=0;w<b;w++)j=C[w],S._isNumber(j)?j=Math.round(j*1e3)/1e3:S._isString(j)||(j=j+""),v.push(j);return v}var s=",",i="(",o=")",a="([",l="])",c=";",d="()",h="=",f=["arc","arcTo","beginPath","bezierCurveTo","clearRect","clip","closePath","createLinearGradient","createPattern","createRadialGradient","drawImage","ellipse","fill","fillText","getImageData","createImageData","lineTo","moveTo","putImageData","quadraticCurveTo","rect","roundRect","restore","rotate","save","scale","setLineDash","setTransform","stroke","strokeText","transform","translate"],p=["fillStyle","strokeStyle","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","letterSpacing","lineCap","lineDashOffset","lineJoin","lineWidth","miterLimit","direction","font","textAlign","textBaseline","globalAlpha","globalCompositeOperation","imageSmoothingEnabled"];const g=100;let m=class{constructor(v){this.canvas=v,t.Konva.enableTrace&&(this.traceArr=[],this._enableTrace())}fillShape(v){v.fillEnabled()&&this._fill(v)}_fill(v){}strokeShape(v){v.hasStroke()&&this._stroke(v)}_stroke(v){}fillStrokeShape(v){v.attrs.fillAfterStrokeEnabled?(this.strokeShape(v),this.fillShape(v)):(this.fillShape(v),this.strokeShape(v))}getTrace(v,b){var S=this.traceArr,w=S.length,j="",E,A,L,M;for(E=0;E<w;E++)A=S[E],L=A.method,L?(M=A.args,j+=L,v?j+=d:e.Util._isArray(M[0])?j+=a+M.join(s)+l:(b&&(M=M.map(O=>typeof O=="number"?Math.floor(O):O)),j+=i+M.join(s)+o)):(j+=A.property,v||(j+=h+A.val)),j+=c;return j}clearTrace(){this.traceArr=[]}_trace(v){var b=this.traceArr,S;b.push(v),S=b.length,S>=g&&b.shift()}reset(){var v=this.getCanvas().getPixelRatio();this.setTransform(1*v,0,0,1*v,0,0)}getCanvas(){return this.canvas}clear(v){var b=this.getCanvas();v?this.clearRect(v.x||0,v.y||0,v.width||0,v.height||0):this.clearRect(0,0,b.getWidth()/b.pixelRatio,b.getHeight()/b.pixelRatio)}_applyLineCap(v){const b=v.attrs.lineCap;b&&this.setAttr("lineCap",b)}_applyOpacity(v){var b=v.getAbsoluteOpacity();b!==1&&this.setAttr("globalAlpha",b)}_applyLineJoin(v){const b=v.attrs.lineJoin;b&&this.setAttr("lineJoin",b)}setAttr(v,b){this._context[v]=b}arc(v,b,S,w,j,E){this._context.arc(v,b,S,w,j,E)}arcTo(v,b,S,w,j){this._context.arcTo(v,b,S,w,j)}beginPath(){this._context.beginPath()}bezierCurveTo(v,b,S,w,j,E){this._context.bezierCurveTo(v,b,S,w,j,E)}clearRect(v,b,S,w){this._context.clearRect(v,b,S,w)}clip(...v){this._context.clip.apply(this._context,v)}closePath(){this._context.closePath()}createImageData(v,b){var S=arguments;if(S.length===2)return this._context.createImageData(v,b);if(S.length===1)return this._context.createImageData(v)}createLinearGradient(v,b,S,w){return this._context.createLinearGradient(v,b,S,w)}createPattern(v,b){return this._context.createPattern(v,b)}createRadialGradient(v,b,S,w,j,E){return this._context.createRadialGradient(v,b,S,w,j,E)}drawImage(v,b,S,w,j,E,A,L,M){var O=arguments,F=this._context;O.length===3?F.drawImage(v,b,S):O.length===5?F.drawImage(v,b,S,w,j):O.length===9&&F.drawImage(v,b,S,w,j,E,A,L,M)}ellipse(v,b,S,w,j,E,A,L){this._context.ellipse(v,b,S,w,j,E,A,L)}isPointInPath(v,b,S,w){return S?this._context.isPointInPath(S,v,b,w):this._context.isPointInPath(v,b,w)}fill(...v){this._context.fill.apply(this._context,v)}fillRect(v,b,S,w){this._context.fillRect(v,b,S,w)}strokeRect(v,b,S,w){this._context.strokeRect(v,b,S,w)}fillText(v,b,S,w){w?this._context.fillText(v,b,S,w):this._context.fillText(v,b,S)}measureText(v){return this._context.measureText(v)}getImageData(v,b,S,w){return this._context.getImageData(v,b,S,w)}lineTo(v,b){this._context.lineTo(v,b)}moveTo(v,b){this._context.moveTo(v,b)}rect(v,b,S,w){this._context.rect(v,b,S,w)}roundRect(v,b,S,w,j){this._context.roundRect(v,b,S,w,j)}putImageData(v,b,S){this._context.putImageData(v,b,S)}quadraticCurveTo(v,b,S,w){this._context.quadraticCurveTo(v,b,S,w)}restore(){this._context.restore()}rotate(v){this._context.rotate(v)}save(){this._context.save()}scale(v,b){this._context.scale(v,b)}setLineDash(v){this._context.setLineDash?this._context.setLineDash(v):"mozDash"in this._context?this._context.mozDash=v:"webkitLineDash"in this._context&&(this._context.webkitLineDash=v)}getLineDash(){return this._context.getLineDash()}setTransform(v,b,S,w,j,E){this._context.setTransform(v,b,S,w,j,E)}stroke(v){v?this._context.stroke(v):this._context.stroke()}strokeText(v,b,S,w){this._context.strokeText(v,b,S,w)}transform(v,b,S,w,j,E){this._context.transform(v,b,S,w,j,E)}translate(v,b){this._context.translate(v,b)}_enableTrace(){var v=this,b=f.length,S=this.setAttr,w,j,E=function(A){var L=v[A],M;v[A]=function(){return j=n(Array.prototype.slice.call(arguments,0)),M=L.apply(v,arguments),v._trace({method:A,args:j}),M}};for(w=0;w<b;w++)E(f[w]);v.setAttr=function(){S.apply(v,arguments);var A=arguments[0],L=arguments[1];(A==="shadowOffsetX"||A==="shadowOffsetY"||A==="shadowBlur")&&(L=L/this.canvas.getPixelRatio()),v._trace({property:A,val:L})}}_applyGlobalCompositeOperation(v){const b=v.attrs.globalCompositeOperation;var S=!b||b==="source-over";S||this.setAttr("globalCompositeOperation",b)}};bo.Context=m,p.forEach(function(C){Object.defineProperty(m.prototype,C,{get(){return this._context[C]},set(v){this._context[C]=v}})});class y extends m{constructor(v,{willReadFrequently:b=!1}={}){super(v),this._context=v._canvas.getContext("2d",{willReadFrequently:b})}_fillColor(v){var b=v.fill();this.setAttr("fillStyle",b),v._fillFunc(this)}_fillPattern(v){this.setAttr("fillStyle",v._getFillPattern()),v._fillFunc(this)}_fillLinearGradient(v){var b=v._getLinearGradient();b&&(this.setAttr("fillStyle",b),v._fillFunc(this))}_fillRadialGradient(v){const b=v._getRadialGradient();b&&(this.setAttr("fillStyle",b),v._fillFunc(this))}_fill(v){const b=v.fill(),S=v.getFillPriority();if(b&&S==="color"){this._fillColor(v);return}const w=v.getFillPatternImage();if(w&&S==="pattern"){this._fillPattern(v);return}const j=v.getFillLinearGradientColorStops();if(j&&S==="linear-gradient"){this._fillLinearGradient(v);return}const E=v.getFillRadialGradientColorStops();if(E&&S==="radial-gradient"){this._fillRadialGradient(v);return}b?this._fillColor(v):w?this._fillPattern(v):j?this._fillLinearGradient(v):E&&this._fillRadialGradient(v)}_strokeLinearGradient(v){const b=v.getStrokeLinearGradientStartPoint(),S=v.getStrokeLinearGradientEndPoint(),w=v.getStrokeLinearGradientColorStops(),j=this.createLinearGradient(b.x,b.y,S.x,S.y);if(w){for(var E=0;E<w.length;E+=2)j.addColorStop(w[E],w[E+1]);this.setAttr("strokeStyle",j)}}_stroke(v){var b=v.dash(),S=v.getStrokeScaleEnabled();if(v.hasStroke()){if(!S){this.save();var w=this.getCanvas().getPixelRatio();this.setTransform(w,0,0,w,0,0)}this._applyLineCap(v),b&&v.dashEnabled()&&(this.setLineDash(b),this.setAttr("lineDashOffset",v.dashOffset())),this.setAttr("lineWidth",v.strokeWidth()),v.getShadowForStrokeEnabled()||this.setAttr("shadowColor","rgba(0,0,0,0)");var j=v.getStrokeLinearGradientColorStops();j?this._strokeLinearGradient(v):this.setAttr("strokeStyle",v.stroke()),v._strokeFunc(this),S||this.restore()}}_applyShadow(v){var b,S,w,j=(b=v.getShadowRGBA())!==null&&b!==void 0?b:"black",E=(S=v.getShadowBlur())!==null&&S!==void 0?S:5,A=(w=v.getShadowOffset())!==null&&w!==void 0?w:{x:0,y:0},L=v.getAbsoluteScale(),M=this.canvas.getPixelRatio(),O=L.x*M,F=L.y*M;this.setAttr("shadowColor",j),this.setAttr("shadowBlur",E*Math.min(Math.abs(O),Math.abs(F))),this.setAttr("shadowOffsetX",A.x*O),this.setAttr("shadowOffsetY",A.y*F)}}bo.SceneContext=y;class x extends m{constructor(v){super(v),this._context=v._canvas.getContext("2d",{willReadFrequently:!0})}_fill(v){this.save(),this.setAttr("fillStyle",v.colorKey),v._fillFuncHit(this),this.restore()}strokeShape(v){v.hasHitStroke()&&this._stroke(v)}_stroke(v){if(v.hasHitStroke()){const j=v.getStrokeScaleEnabled();if(!j){this.save();var b=this.getCanvas().getPixelRatio();this.setTransform(b,0,0,b,0,0)}this._applyLineCap(v);var S=v.hitStrokeWidth(),w=S==="auto"?v.strokeWidth():S;this.setAttr("lineWidth",w),this.setAttr("strokeStyle",v.colorKey),v._strokeFuncHit(this),j||this.restore()}}}return bo.HitContext=x,bo}var N_;function j1(){if(N_)return vo;N_=1,Object.defineProperty(vo,"__esModule",{value:!0}),vo.HitCanvas=vo.SceneCanvas=vo.Canvas=void 0;const e=_n(),t=oE(),n=yt(),s=vt(),i=xt();var o;function a(){if(o)return o;var h=e.Util.createCanvasElement(),f=h.getContext("2d");return o=function(){var p=n.Konva._global.devicePixelRatio||1,g=f.webkitBackingStorePixelRatio||f.mozBackingStorePixelRatio||f.msBackingStorePixelRatio||f.oBackingStorePixelRatio||f.backingStorePixelRatio||1;return p/g}(),e.Util.releaseCanvas(h),o}let l=class{constructor(f){this.pixelRatio=1,this.width=0,this.height=0,this.isCache=!1;var p=f||{},g=p.pixelRatio||n.Konva.pixelRatio||a();this.pixelRatio=g,this._canvas=e.Util.createCanvasElement(),this._canvas.style.padding="0",this._canvas.style.margin="0",this._canvas.style.border="0",this._canvas.style.background="transparent",this._canvas.style.position="absolute",this._canvas.style.top="0",this._canvas.style.left="0"}getContext(){return this.context}getPixelRatio(){return this.pixelRatio}setPixelRatio(f){var p=this.pixelRatio;this.pixelRatio=f,this.setSize(this.getWidth()/p,this.getHeight()/p)}setWidth(f){this.width=this._canvas.width=f*this.pixelRatio,this._canvas.style.width=f+"px";var p=this.pixelRatio,g=this.getContext()._context;g.scale(p,p)}setHeight(f){this.height=this._canvas.height=f*this.pixelRatio,this._canvas.style.height=f+"px";var p=this.pixelRatio,g=this.getContext()._context;g.scale(p,p)}getWidth(){return this.width}getHeight(){return this.height}setSize(f,p){this.setWidth(f||0),this.setHeight(p||0)}toDataURL(f,p){try{return this._canvas.toDataURL(f,p)}catch{try{return this._canvas.toDataURL()}catch(m){return e.Util.error("Unable to get data URL. "+m.message+" For more info read https://konvajs.org/docs/posts/Tainted_Canvas.html."),""}}}};vo.Canvas=l,s.Factory.addGetterSetter(l,"pixelRatio",void 0,(0,i.getNumberValidator)());class c extends l{constructor(f={width:0,height:0,willReadFrequently:!1}){super(f),this.context=new t.SceneContext(this,{willReadFrequently:f.willReadFrequently}),this.setSize(f.width,f.height)}}vo.SceneCanvas=c;class d extends l{constructor(f={width:0,height:0}){super(f),this.hitCanvas=!0,this.context=new t.HitContext(this),this.setSize(f.width,f.height)}}return vo.HitCanvas=d,vo}var ov={},F_;function fS(){return F_||(F_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.DD=void 0;const t=yt(),n=_n();e.DD={get isDragging(){var s=!1;return e.DD._dragElements.forEach(i=>{i.dragStatus==="dragging"&&(s=!0)}),s},justDragged:!1,get node(){var s;return e.DD._dragElements.forEach(i=>{s=i.node}),s},_dragElements:new Map,_drag(s){const i=[];e.DD._dragElements.forEach((o,a)=>{const{node:l}=o,c=l.getStage();c.setPointersPositions(s),o.pointerId===void 0&&(o.pointerId=n.Util._getFirstPointerId(s));const d=c._changedPointerPositions.find(p=>p.id===o.pointerId);if(d){if(o.dragStatus!=="dragging"){var h=l.dragDistance(),f=Math.max(Math.abs(d.x-o.startPointerPos.x),Math.abs(d.y-o.startPointerPos.y));if(f<h||(l.startDrag({evt:s}),!l.isDragging()))return}l._setDragPosition(s,o),i.push(l)}}),i.forEach(o=>{o.fire("dragmove",{type:"dragmove",target:o,evt:s},!0)})},_endDragBefore(s){const i=[];e.DD._dragElements.forEach(o=>{const{node:a}=o,l=a.getStage();if(s&&l.setPointersPositions(s),!l._changedPointerPositions.find(h=>h.id===o.pointerId))return;(o.dragStatus==="dragging"||o.dragStatus==="stopped")&&(e.DD.justDragged=!0,t.Konva._mouseListenClick=!1,t.Konva._touchListenClick=!1,t.Konva._pointerListenClick=!1,o.dragStatus="stopped");const d=o.node.getLayer()||o.node instanceof t.Konva.Stage&&o.node;d&&i.indexOf(d)===-1&&i.push(d)}),i.forEach(o=>{o.draw()})},_endDragAfter(s){e.DD._dragElements.forEach((i,o)=>{i.dragStatus==="stopped"&&i.node.fire("dragend",{type:"dragend",target:i.node,evt:s},!0),i.dragStatus!=="dragging"&&e.DD._dragElements.delete(o)})}},t.Konva.isBrowser&&(window.addEventListener("mouseup",e.DD._endDragBefore,!0),window.addEventListener("touchend",e.DD._endDragBefore,!0),window.addEventListener("mousemove",e.DD._drag),window.addEventListener("touchmove",e.DD._drag),window.addEventListener("mouseup",e.DD._endDragAfter,!1),window.addEventListener("touchend",e.DD._endDragAfter,!1))}(ov)),ov}var B_;function Tn(){if(B_)return Cd;B_=1,Object.defineProperty(Cd,"__esModule",{value:!0}),Cd.Node=void 0;const e=_n(),t=vt(),n=j1(),s=yt(),i=fS(),o=xt();var a="absoluteOpacity",l="allEventListeners",c="absoluteTransform",d="absoluteScale",h="canvas",f="Change",p="children",g="konva",m="listening",y="mouseenter",x="mouseleave",C="set",v="Shape",b=" ",S="stage",w="transform",j="Stage",E="visible",A=["xChange.konva","yChange.konva","scaleXChange.konva","scaleYChange.konva","skewXChange.konva","skewYChange.konva","rotationChange.konva","offsetXChange.konva","offsetYChange.konva","transformsEnabledChange.konva"].join(b);let L=1;class M{constructor(_){this._id=L++,this.eventListeners={},this.attrs={},this.index=0,this._allEventListeners=null,this.parent=null,this._cache=new Map,this._attachedDepsListeners=new Map,this._lastPos=null,this._batchingTransformChange=!1,this._needClearTransformCache=!1,this._filterUpToDate=!1,this._isUnderCache=!1,this._dragEventId=null,this._shouldFireChangeEvents=!1,this.setAttrs(_),this._shouldFireChangeEvents=!0}hasChildren(){return!1}_clearCache(_){(_===w||_===c)&&this._cache.get(_)?this._cache.get(_).dirty=!0:_?this._cache.delete(_):this._cache.clear()}_getCache(_,R){var D=this._cache.get(_),$=_===w||_===c,G=D===void 0||$&&D.dirty===!0;return G&&(D=R.call(this),this._cache.set(_,D)),D}_calculate(_,R,D){if(!this._attachedDepsListeners.get(_)){const $=R.map(G=>G+"Change.konva").join(b);this.on($,()=>{this._clearCache(_)}),this._attachedDepsListeners.set(_,!0)}return this._getCache(_,D)}_getCanvasCache(){return this._cache.get(h)}_clearSelfAndDescendantCache(_){this._clearCache(_),_===c&&this.fire("absoluteTransformChange")}clearCache(){if(this._cache.has(h)){const{scene:_,filter:R,hit:D}=this._cache.get(h);e.Util.releaseCanvas(_,R,D),this._cache.delete(h)}return this._clearSelfAndDescendantCache(),this._requestDraw(),this}cache(_){var R=_||{},D={};(R.x===void 0||R.y===void 0||R.width===void 0||R.height===void 0)&&(D=this.getClientRect({skipTransform:!0,relativeTo:this.getParent()||void 0}));var $=Math.ceil(R.width||D.width),G=Math.ceil(R.height||D.height),ee=R.pixelRatio,Q=R.x===void 0?Math.floor(D.x):R.x,se=R.y===void 0?Math.floor(D.y):R.y,ne=R.offset||0,H=R.drawBorder||!1,V=R.hitCanvasPixelRatio||1;if(!$||!G){e.Util.error("Can not cache the node. Width or height of the node equals 0. Caching is skipped.");return}const Y=Math.abs(Math.round(D.x)-Q)>.5?1:0,W=Math.abs(Math.round(D.y)-se)>.5?1:0;$+=ne*2+Y,G+=ne*2+W,Q-=ne,se-=ne;var J=new n.SceneCanvas({pixelRatio:ee,width:$,height:G}),N=new n.SceneCanvas({pixelRatio:ee,width:0,height:0,willReadFrequently:!0}),B=new n.HitCanvas({pixelRatio:V,width:$,height:G}),U=J.getContext(),ie=B.getContext();return B.isCache=!0,J.isCache=!0,this._cache.delete(h),this._filterUpToDate=!1,R.imageSmoothingEnabled===!1&&(J.getContext()._context.imageSmoothingEnabled=!1,N.getContext()._context.imageSmoothingEnabled=!1),U.save(),ie.save(),U.translate(-Q,-se),ie.translate(-Q,-se),this._isUnderCache=!0,this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(d),this.drawScene(J,this),this.drawHit(B,this),this._isUnderCache=!1,U.restore(),ie.restore(),H&&(U.save(),U.beginPath(),U.rect(0,0,$,G),U.closePath(),U.setAttr("strokeStyle","red"),U.setAttr("lineWidth",5),U.stroke(),U.restore()),this._cache.set(h,{scene:J,filter:N,hit:B,x:Q,y:se}),this._requestDraw(),this}isCached(){return this._cache.has(h)}getClientRect(_){throw new Error('abstract "getClientRect" method call')}_transformedRect(_,R){var D=[{x:_.x,y:_.y},{x:_.x+_.width,y:_.y},{x:_.x+_.width,y:_.y+_.height},{x:_.x,y:_.y+_.height}],$=1/0,G=1/0,ee=-1/0,Q=-1/0,se=this.getAbsoluteTransform(R);return D.forEach(function(ne){var H=se.point(ne);$===void 0&&($=ee=H.x,G=Q=H.y),$=Math.min($,H.x),G=Math.min(G,H.y),ee=Math.max(ee,H.x),Q=Math.max(Q,H.y)}),{x:$,y:G,width:ee-$,height:Q-G}}_drawCachedSceneCanvas(_){_.save(),_._applyOpacity(this),_._applyGlobalCompositeOperation(this);const R=this._getCanvasCache();_.translate(R.x,R.y);var D=this._getCachedSceneCanvas(),$=D.pixelRatio;_.drawImage(D._canvas,0,0,D.width/$,D.height/$),_.restore()}_drawCachedHitCanvas(_){var R=this._getCanvasCache(),D=R.hit;_.save(),_.translate(R.x,R.y),_.drawImage(D._canvas,0,0,D.width/D.pixelRatio,D.height/D.pixelRatio),_.restore()}_getCachedSceneCanvas(){var _=this.filters(),R=this._getCanvasCache(),D=R.scene,$=R.filter,G=$.getContext(),ee,Q,se,ne;if(_){if(!this._filterUpToDate){var H=D.pixelRatio;$.setSize(D.width/D.pixelRatio,D.height/D.pixelRatio);try{for(ee=_.length,G.clear(),G.drawImage(D._canvas,0,0,D.getWidth()/H,D.getHeight()/H),Q=G.getImageData(0,0,$.getWidth(),$.getHeight()),se=0;se<ee;se++){if(ne=_[se],typeof ne!="function"){e.Util.error("Filter should be type of function, but got "+typeof ne+" instead. Please check correct filters");continue}ne.call(this,Q),G.putImageData(Q,0,0)}}catch(V){e.Util.error("Unable to apply filter. "+V.message+" This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.")}this._filterUpToDate=!0}return $}return D}on(_,R){if(this._cache&&this._cache.delete(l),arguments.length===3)return this._delegate.apply(this,arguments);var D=_.split(b),$=D.length,G,ee,Q,se,ne;for(G=0;G<$;G++)ee=D[G],Q=ee.split("."),se=Q[0],ne=Q[1]||"",this.eventListeners[se]||(this.eventListeners[se]=[]),this.eventListeners[se].push({name:ne,handler:R});return this}off(_,R){var D=(_||"").split(b),$=D.length,G,ee,Q,se,ne,H;if(this._cache&&this._cache.delete(l),!_)for(ee in this.eventListeners)this._off(ee);for(G=0;G<$;G++)if(Q=D[G],se=Q.split("."),ne=se[0],H=se[1],ne)this.eventListeners[ne]&&this._off(ne,H,R);else for(ee in this.eventListeners)this._off(ee,H,R);return this}dispatchEvent(_){var R={target:this,type:_.type,evt:_};return this.fire(_.type,R),this}addEventListener(_,R){return this.on(_,function(D){R.call(this,D.evt)}),this}removeEventListener(_){return this.off(_),this}_delegate(_,R,D){var $=this;this.on(_,function(G){for(var ee=G.target.findAncestors(R,!0,$),Q=0;Q<ee.length;Q++)G=e.Util.cloneObject(G),G.currentTarget=ee[Q],D.call(ee[Q],G)})}remove(){return this.isDragging()&&this.stopDrag(),i.DD._dragElements.delete(this._id),this._remove(),this}_clearCaches(){this._clearSelfAndDescendantCache(c),this._clearSelfAndDescendantCache(a),this._clearSelfAndDescendantCache(d),this._clearSelfAndDescendantCache(S),this._clearSelfAndDescendantCache(E),this._clearSelfAndDescendantCache(m)}_remove(){this._clearCaches();var _=this.getParent();_&&_.children&&(_.children.splice(this.index,1),_._setChildrenIndices(),this.parent=null)}destroy(){return this.remove(),this.clearCache(),this}getAttr(_){var R="get"+e.Util._capitalize(_);return e.Util._isFunction(this[R])?this[R]():this.attrs[_]}getAncestors(){for(var _=this.getParent(),R=[];_;)R.push(_),_=_.getParent();return R}getAttrs(){return this.attrs||{}}setAttrs(_){return this._batchTransformChanges(()=>{var R,D;if(!_)return this;for(R in _)R!==p&&(D=C+e.Util._capitalize(R),e.Util._isFunction(this[D])?this[D](_[R]):this._setAttr(R,_[R]))}),this}isListening(){return this._getCache(m,this._isListening)}_isListening(_){if(!this.listening())return!1;const D=this.getParent();return D&&D!==_&&this!==_?D._isListening(_):!0}isVisible(){return this._getCache(E,this._isVisible)}_isVisible(_){if(!this.visible())return!1;const D=this.getParent();return D&&D!==_&&this!==_?D._isVisible(_):!0}shouldDrawHit(_,R=!1){if(_)return this._isVisible(_)&&this._isListening(_);var D=this.getLayer(),$=!1;i.DD._dragElements.forEach(ee=>{ee.dragStatus==="dragging"&&(ee.node.nodeType==="Stage"||ee.node.getLayer()===D)&&($=!0)});var G=!R&&!s.Konva.hitOnDragEnabled&&($||s.Konva.isTransforming());return this.isListening()&&this.isVisible()&&!G}show(){return this.visible(!0),this}hide(){return this.visible(!1),this}getZIndex(){return this.index||0}getAbsoluteZIndex(){var _=this.getDepth(),R=this,D=0,$,G,ee,Q;function se(H){for($=[],G=H.length,ee=0;ee<G;ee++)Q=H[ee],D++,Q.nodeType!==v&&($=$.concat(Q.getChildren().slice())),Q._id===R._id&&(ee=G);$.length>0&&$[0].getDepth()<=_&&se($)}const ne=this.getStage();return R.nodeType!==j&&ne&&se(ne.getChildren()),D}getDepth(){for(var _=0,R=this.parent;R;)_++,R=R.parent;return _}_batchTransformChanges(_){this._batchingTransformChange=!0,_(),this._batchingTransformChange=!1,this._needClearTransformCache&&(this._clearCache(w),this._clearSelfAndDescendantCache(c)),this._needClearTransformCache=!1}setPosition(_){return this._batchTransformChanges(()=>{this.x(_.x),this.y(_.y)}),this}getPosition(){return{x:this.x(),y:this.y()}}getRelativePointerPosition(){const _=this.getStage();if(!_)return null;var R=_.getPointerPosition();if(!R)return null;var D=this.getAbsoluteTransform().copy();return D.invert(),D.point(R)}getAbsolutePosition(_){let R=!1,D=this.parent;for(;D;){if(D.isCached()){R=!0;break}D=D.parent}R&&!_&&(_=!0);var $=this.getAbsoluteTransform(_).getMatrix(),G=new e.Transform,ee=this.offset();return G.m=$.slice(),G.translate(ee.x,ee.y),G.getTranslation()}setAbsolutePosition(_){const{x:R,y:D,...$}=this._clearTransform();this.attrs.x=R,this.attrs.y=D,this._clearCache(w);var G=this._getAbsoluteTransform().copy();return G.invert(),G.translate(_.x,_.y),_={x:this.attrs.x+G.getTranslation().x,y:this.attrs.y+G.getTranslation().y},this._setTransform($),this.setPosition({x:_.x,y:_.y}),this._clearCache(w),this._clearSelfAndDescendantCache(c),this}_setTransform(_){var R;for(R in _)this.attrs[R]=_[R]}_clearTransform(){var _={x:this.x(),y:this.y(),rotation:this.rotation(),scaleX:this.scaleX(),scaleY:this.scaleY(),offsetX:this.offsetX(),offsetY:this.offsetY(),skewX:this.skewX(),skewY:this.skewY()};return this.attrs.x=0,this.attrs.y=0,this.attrs.rotation=0,this.attrs.scaleX=1,this.attrs.scaleY=1,this.attrs.offsetX=0,this.attrs.offsetY=0,this.attrs.skewX=0,this.attrs.skewY=0,_}move(_){var R=_.x,D=_.y,$=this.x(),G=this.y();return R!==void 0&&($+=R),D!==void 0&&(G+=D),this.setPosition({x:$,y:G}),this}_eachAncestorReverse(_,R){var D=[],$=this.getParent(),G,ee;if(!(R&&R._id===this._id)){for(D.unshift(this);$&&(!R||$._id!==R._id);)D.unshift($),$=$.parent;for(G=D.length,ee=0;ee<G;ee++)_(D[ee])}}rotate(_){return this.rotation(this.rotation()+_),this}moveToTop(){if(!this.parent)return e.Util.warn("Node has no parent. moveToTop function is ignored."),!1;var _=this.index,R=this.parent.getChildren().length;return _<R-1?(this.parent.children.splice(_,1),this.parent.children.push(this),this.parent._setChildrenIndices(),!0):!1}moveUp(){if(!this.parent)return e.Util.warn("Node has no parent. moveUp function is ignored."),!1;var _=this.index,R=this.parent.getChildren().length;return _<R-1?(this.parent.children.splice(_,1),this.parent.children.splice(_+1,0,this),this.parent._setChildrenIndices(),!0):!1}moveDown(){if(!this.parent)return e.Util.warn("Node has no parent. moveDown function is ignored."),!1;var _=this.index;return _>0?(this.parent.children.splice(_,1),this.parent.children.splice(_-1,0,this),this.parent._setChildrenIndices(),!0):!1}moveToBottom(){if(!this.parent)return e.Util.warn("Node has no parent. moveToBottom function is ignored."),!1;var _=this.index;return _>0?(this.parent.children.splice(_,1),this.parent.children.unshift(this),this.parent._setChildrenIndices(),!0):!1}setZIndex(_){if(!this.parent)return e.Util.warn("Node has no parent. zIndex parameter is ignored."),this;(_<0||_>=this.parent.children.length)&&e.Util.warn("Unexpected value "+_+" for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to "+(this.parent.children.length-1)+".");var R=this.index;return this.parent.children.splice(R,1),this.parent.children.splice(_,0,this),this.parent._setChildrenIndices(),this}getAbsoluteOpacity(){return this._getCache(a,this._getAbsoluteOpacity)}_getAbsoluteOpacity(){var _=this.opacity(),R=this.getParent();return R&&!R._isUnderCache&&(_*=R.getAbsoluteOpacity()),_}moveTo(_){return this.getParent()!==_&&(this._remove(),_.add(this)),this}toObject(){var _=this.getAttrs(),R,D,$,G,ee;const Q={attrs:{},className:this.getClassName()};for(R in _)D=_[R],ee=e.Util.isObject(D)&&!e.Util._isPlainObject(D)&&!e.Util._isArray(D),!ee&&($=typeof this[R]=="function"&&this[R],delete _[R],G=$?$.call(this):null,_[R]=D,G!==D&&(Q.attrs[R]=D));return e.Util._prepareToStringify(Q)}toJSON(){return JSON.stringify(this.toObject())}getParent(){return this.parent}findAncestors(_,R,D){var $=[];R&&this._isMatch(_)&&$.push(this);for(var G=this.parent;G;){if(G===D)return $;G._isMatch(_)&&$.push(G),G=G.parent}return $}isAncestorOf(_){return!1}findAncestor(_,R,D){return this.findAncestors(_,R,D)[0]}_isMatch(_){if(!_)return!1;if(typeof _=="function")return _(this);var R=_.replace(/ /g,"").split(","),D=R.length,$,G;for($=0;$<D;$++)if(G=R[$],e.Util.isValidSelector(G)||(e.Util.warn('Selector "'+G+'" is invalid. Allowed selectors examples are "#foo", ".bar" or "Group".'),e.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like "Triangle".'),e.Util.warn("Konva is awesome, right?")),G.charAt(0)==="#"){if(this.id()===G.slice(1))return!0}else if(G.charAt(0)==="."){if(this.hasName(G.slice(1)))return!0}else if(this.className===G||this.nodeType===G)return!0;return!1}getLayer(){var _=this.getParent();return _?_.getLayer():null}getStage(){return this._getCache(S,this._getStage)}_getStage(){var _=this.getParent();return _?_.getStage():null}fire(_,R={},D){return R.target=R.target||this,D?this._fireAndBubble(_,R):this._fire(_,R),this}getAbsoluteTransform(_){return _?this._getAbsoluteTransform(_):this._getCache(c,this._getAbsoluteTransform)}_getAbsoluteTransform(_){var R;if(_)return R=new e.Transform,this._eachAncestorReverse(function($){var G=$.transformsEnabled();G==="all"?R.multiply($.getTransform()):G==="position"&&R.translate($.x()-$.offsetX(),$.y()-$.offsetY())},_),R;R=this._cache.get(c)||new e.Transform,this.parent?this.parent.getAbsoluteTransform().copyInto(R):R.reset();var D=this.transformsEnabled();if(D==="all")R.multiply(this.getTransform());else if(D==="position"){const $=this.attrs.x||0,G=this.attrs.y||0,ee=this.attrs.offsetX||0,Q=this.attrs.offsetY||0;R.translate($-ee,G-Q)}return R.dirty=!1,R}getAbsoluteScale(_){for(var R=this;R;)R._isUnderCache&&(_=R),R=R.getParent();const $=this.getAbsoluteTransform(_).decompose();return{x:$.scaleX,y:$.scaleY}}getAbsoluteRotation(){return this.getAbsoluteTransform().decompose().rotation}getTransform(){return this._getCache(w,this._getTransform)}_getTransform(){var _,R,D=this._cache.get(w)||new e.Transform;D.reset();var $=this.x(),G=this.y(),ee=s.Konva.getAngle(this.rotation()),Q=(_=this.attrs.scaleX)!==null&&_!==void 0?_:1,se=(R=this.attrs.scaleY)!==null&&R!==void 0?R:1,ne=this.attrs.skewX||0,H=this.attrs.skewY||0,V=this.attrs.offsetX||0,Y=this.attrs.offsetY||0;return($!==0||G!==0)&&D.translate($,G),ee!==0&&D.rotate(ee),(ne!==0||H!==0)&&D.skew(ne,H),(Q!==1||se!==1)&&D.scale(Q,se),(V!==0||Y!==0)&&D.translate(-1*V,-1*Y),D.dirty=!1,D}clone(_){var R=e.Util.cloneObject(this.attrs),D,$,G,ee,Q;for(D in _)R[D]=_[D];var se=new this.constructor(R);for(D in this.eventListeners)for($=this.eventListeners[D],G=$.length,ee=0;ee<G;ee++)Q=$[ee],Q.name.indexOf(g)<0&&(se.eventListeners[D]||(se.eventListeners[D]=[]),se.eventListeners[D].push(Q));return se}_toKonvaCanvas(_){_=_||{};var R=this.getClientRect(),D=this.getStage(),$=_.x!==void 0?_.x:Math.floor(R.x),G=_.y!==void 0?_.y:Math.floor(R.y),ee=_.pixelRatio||1,Q=new n.SceneCanvas({width:_.width||Math.ceil(R.width)||(D?D.width():0),height:_.height||Math.ceil(R.height)||(D?D.height():0),pixelRatio:ee}),se=Q.getContext();const ne=new n.SceneCanvas({width:Q.width/Q.pixelRatio+Math.abs($),height:Q.height/Q.pixelRatio+Math.abs(G),pixelRatio:Q.pixelRatio});return _.imageSmoothingEnabled===!1&&(se._context.imageSmoothingEnabled=!1),se.save(),($||G)&&se.translate(-1*$,-1*G),this.drawScene(Q,void 0,ne),se.restore(),Q}toCanvas(_){return this._toKonvaCanvas(_)._canvas}toDataURL(_){_=_||{};var R=_.mimeType||null,D=_.quality||null,$=this._toKonvaCanvas(_).toDataURL(R,D);return _.callback&&_.callback($),$}toImage(_){return new Promise((R,D)=>{try{const $=_==null?void 0:_.callback;$&&delete _.callback,e.Util._urlToImage(this.toDataURL(_),function(G){R(G),$==null||$(G)})}catch($){D($)}})}toBlob(_){return new Promise((R,D)=>{try{const $=_==null?void 0:_.callback;$&&delete _.callback,this.toCanvas(_).toBlob(G=>{R(G),$==null||$(G)},_==null?void 0:_.mimeType,_==null?void 0:_.quality)}catch($){D($)}})}setSize(_){return this.width(_.width),this.height(_.height),this}getSize(){return{width:this.width(),height:this.height()}}getClassName(){return this.className||this.nodeType}getType(){return this.nodeType}getDragDistance(){return this.attrs.dragDistance!==void 0?this.attrs.dragDistance:this.parent?this.parent.getDragDistance():s.Konva.dragDistance}_off(_,R,D){var $=this.eventListeners[_],G,ee,Q;for(G=0;G<$.length;G++)if(ee=$[G].name,Q=$[G].handler,(ee!=="konva"||R==="konva")&&(!R||ee===R)&&(!D||D===Q)){if($.splice(G,1),$.length===0){delete this.eventListeners[_];break}G--}}_fireChangeEvent(_,R,D){this._fire(_+f,{oldVal:R,newVal:D})}addName(_){if(!this.hasName(_)){var R=this.name(),D=R?R+" "+_:_;this.name(D)}return this}hasName(_){if(!_)return!1;const R=this.name();if(!R)return!1;var D=(R||"").split(/\s/g);return D.indexOf(_)!==-1}removeName(_){var R=(this.name()||"").split(/\s/g),D=R.indexOf(_);return D!==-1&&(R.splice(D,1),this.name(R.join(" "))),this}setAttr(_,R){var D=this[C+e.Util._capitalize(_)];return e.Util._isFunction(D)?D.call(this,R):this._setAttr(_,R),this}_requestDraw(){if(s.Konva.autoDrawEnabled){const _=this.getLayer()||this.getStage();_==null||_.batchDraw()}}_setAttr(_,R){var D=this.attrs[_];D===R&&!e.Util.isObject(R)||(R==null?delete this.attrs[_]:this.attrs[_]=R,this._shouldFireChangeEvents&&this._fireChangeEvent(_,D,R),this._requestDraw())}_setComponentAttr(_,R,D){var $;D!==void 0&&($=this.attrs[_],$||(this.attrs[_]=this.getAttr(_)),this.attrs[_][R]=D,this._fireChangeEvent(_,$,D))}_fireAndBubble(_,R,D){R&&this.nodeType===v&&(R.target=this);var $=(_===y||_===x)&&(D&&(this===D||this.isAncestorOf&&this.isAncestorOf(D))||this.nodeType==="Stage"&&!D);if(!$){this._fire(_,R);var G=(_===y||_===x)&&D&&D.isAncestorOf&&D.isAncestorOf(this)&&!D.isAncestorOf(this.parent);(R&&!R.cancelBubble||!R)&&this.parent&&this.parent.isListening()&&!G&&(D&&D.parent?this._fireAndBubble.call(this.parent,_,R,D):this._fireAndBubble.call(this.parent,_,R))}}_getProtoListeners(_){var R,D,$;const G=(R=this._cache.get(l))!==null&&R!==void 0?R:{};let ee=G==null?void 0:G[_];if(ee===void 0){ee=[];let Q=Object.getPrototypeOf(this);for(;Q;){const se=($=(D=Q.eventListeners)===null||D===void 0?void 0:D[_])!==null&&$!==void 0?$:[];ee.push(...se),Q=Object.getPrototypeOf(Q)}G[_]=ee,this._cache.set(l,G)}return ee}_fire(_,R){R=R||{},R.currentTarget=this,R.type=_;const D=this._getProtoListeners(_);if(D)for(var $=0;$<D.length;$++)D[$].handler.call(this,R);const G=this.eventListeners[_];if(G)for(var $=0;$<G.length;$++)G[$].handler.call(this,R)}draw(){return this.drawScene(),this.drawHit(),this}_createDragElement(_){var R=_?_.pointerId:void 0,D=this.getStage(),$=this.getAbsolutePosition();if(D){var G=D._getPointerById(R)||D._changedPointerPositions[0]||$;i.DD._dragElements.set(this._id,{node:this,startPointerPos:G,offset:{x:G.x-$.x,y:G.y-$.y},dragStatus:"ready",pointerId:R})}}startDrag(_,R=!0){i.DD._dragElements.has(this._id)||this._createDragElement(_);const D=i.DD._dragElements.get(this._id);D.dragStatus="dragging",this.fire("dragstart",{type:"dragstart",target:this,evt:_&&_.evt},R)}_setDragPosition(_,R){const D=this.getStage()._getPointerById(R.pointerId);if(D){var $={x:D.x-R.offset.x,y:D.y-R.offset.y},G=this.dragBoundFunc();if(G!==void 0){const ee=G.call(this,$,_);ee?$=ee:e.Util.warn("dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.")}(!this._lastPos||this._lastPos.x!==$.x||this._lastPos.y!==$.y)&&(this.setAbsolutePosition($),this._requestDraw()),this._lastPos=$}}stopDrag(_){const R=i.DD._dragElements.get(this._id);R&&(R.dragStatus="stopped"),i.DD._endDragBefore(_),i.DD._endDragAfter(_)}setDraggable(_){this._setAttr("draggable",_),this._dragChange()}isDragging(){const _=i.DD._dragElements.get(this._id);return _?_.dragStatus==="dragging":!1}_listenDrag(){this._dragCleanup(),this.on("mousedown.konva touchstart.konva",function(_){var R=_.evt.button!==void 0,D=!R||s.Konva.dragButtons.indexOf(_.evt.button)>=0;if(D&&!this.isDragging()){var $=!1;i.DD._dragElements.forEach(G=>{this.isAncestorOf(G.node)&&($=!0)}),$||this._createDragElement(_)}})}_dragChange(){if(this.attrs.draggable)this._listenDrag();else{this._dragCleanup();var _=this.getStage();if(!_)return;const R=i.DD._dragElements.get(this._id),D=R&&R.dragStatus==="dragging",$=R&&R.dragStatus==="ready";D?this.stopDrag():$&&i.DD._dragElements.delete(this._id)}}_dragCleanup(){this.off("mousedown.konva"),this.off("touchstart.konva")}isClientRectOnScreen(_={x:0,y:0}){const R=this.getStage();if(!R)return!1;const D={x:-_.x,y:-_.y,width:R.width()+2*_.x,height:R.height()+2*_.y};return e.Util.haveIntersection(D,this.getClientRect())}static create(_,R){return e.Util._isString(_)&&(_=JSON.parse(_)),this._createNode(_,R)}static _createNode(_,R){var D=M.prototype.getClassName.call(_),$=_.children,G,ee,Q;R&&(_.attrs.container=R),s.Konva[D]||(e.Util.warn('Can not find a node with class name "'+D+'". Fallback to "Shape".'),D="Shape");const se=s.Konva[D];if(G=new se(_.attrs),$)for(ee=$.length,Q=0;Q<ee;Q++)G.add(M._createNode($[Q]));return G}}Cd.Node=M,M.prototype.nodeType="Node",M.prototype._attrsAffectingSize=[],M.prototype.eventListeners={},M.prototype.on.call(M.prototype,A,function(){if(this._batchingTransformChange){this._needClearTransformCache=!0;return}this._clearCache(w),this._clearSelfAndDescendantCache(c)}),M.prototype.on.call(M.prototype,"visibleChange.konva",function(){this._clearSelfAndDescendantCache(E)}),M.prototype.on.call(M.prototype,"listeningChange.konva",function(){this._clearSelfAndDescendantCache(m)}),M.prototype.on.call(M.prototype,"opacityChange.konva",function(){this._clearSelfAndDescendantCache(a)});const O=t.Factory.addGetterSetter;return O(M,"zIndex"),O(M,"absolutePosition"),O(M,"position"),O(M,"x",0,(0,o.getNumberValidator)()),O(M,"y",0,(0,o.getNumberValidator)()),O(M,"globalCompositeOperation","source-over",(0,o.getStringValidator)()),O(M,"opacity",1,(0,o.getNumberValidator)()),O(M,"name","",(0,o.getStringValidator)()),O(M,"id","",(0,o.getStringValidator)()),O(M,"rotation",0,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(M,"scale",["x","y"]),O(M,"scaleX",1,(0,o.getNumberValidator)()),O(M,"scaleY",1,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(M,"skew",["x","y"]),O(M,"skewX",0,(0,o.getNumberValidator)()),O(M,"skewY",0,(0,o.getNumberValidator)()),t.Factory.addComponentsGetterSetter(M,"offset",["x","y"]),O(M,"offsetX",0,(0,o.getNumberValidator)()),O(M,"offsetY",0,(0,o.getNumberValidator)()),O(M,"dragDistance",null,(0,o.getNumberValidator)()),O(M,"width",0,(0,o.getNumberValidator)()),O(M,"height",0,(0,o.getNumberValidator)()),O(M,"listening",!0,(0,o.getBooleanValidator)()),O(M,"preventDefault",!0,(0,o.getBooleanValidator)()),O(M,"filters",null,function(F){return this._filterUpToDate=!1,F}),O(M,"visible",!0,(0,o.getBooleanValidator)()),O(M,"transformsEnabled","all",(0,o.getStringValidator)()),O(M,"size"),O(M,"dragBoundFunc"),O(M,"draggable",!1,(0,o.getBooleanValidator)()),t.Factory.backCompat(M,{rotateDeg:"rotate",setRotationDeg:"setRotation",getRotationDeg:"getRotation"}),Cd}var Sd={},$_;function k1(){if($_)return Sd;$_=1,Object.defineProperty(Sd,"__esModule",{value:!0}),Sd.Container=void 0;const e=vt(),t=Tn(),n=xt();let s=class extends t.Node{constructor(){super(...arguments),this.children=[]}getChildren(o){if(!o)return this.children||[];const a=this.children||[];var l=[];return a.forEach(function(c){o(c)&&l.push(c)}),l}hasChildren(){return this.getChildren().length>0}removeChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.remove()}),this.children=[],this._requestDraw(),this}destroyChildren(){return this.getChildren().forEach(o=>{o.parent=null,o.index=0,o.destroy()}),this.children=[],this._requestDraw(),this}add(...o){if(o.length===0)return this;if(o.length>1){for(var a=0;a<o.length;a++)this.add(o[a]);return this}const l=o[0];return l.getParent()?(l.moveTo(this),this):(this._validateAdd(l),l.index=this.getChildren().length,l.parent=this,l._clearCaches(),this.getChildren().push(l),this._fire("add",{child:l}),this._requestDraw(),this)}destroy(){return this.hasChildren()&&this.destroyChildren(),super.destroy(),this}find(o){return this._generalFind(o,!1)}findOne(o){var a=this._generalFind(o,!0);return a.length>0?a[0]:void 0}_generalFind(o,a){var l=[];return this._descendants(c=>{const d=c._isMatch(o);return d&&l.push(c),!!(d&&a)}),l}_descendants(o){let a=!1;const l=this.getChildren();for(const c of l){if(a=o(c),a)return!0;if(c.hasChildren()&&(a=c._descendants(o),a))return!0}return!1}toObject(){var o=t.Node.prototype.toObject.call(this);return o.children=[],this.getChildren().forEach(a=>{o.children.push(a.toObject())}),o}isAncestorOf(o){for(var a=o.getParent();a;){if(a._id===this._id)return!0;a=a.getParent()}return!1}clone(o){var a=t.Node.prototype.clone.call(this,o);return this.getChildren().forEach(function(l){a.add(l.clone())}),a}getAllIntersections(o){var a=[];return this.find("Shape").forEach(l=>{l.isVisible()&&l.intersects(o)&&a.push(l)}),a}_clearSelfAndDescendantCache(o){var a;super._clearSelfAndDescendantCache(o),!this.isCached()&&((a=this.children)===null||a===void 0||a.forEach(function(l){l._clearSelfAndDescendantCache(o)}))}_setChildrenIndices(){var o;(o=this.children)===null||o===void 0||o.forEach(function(a,l){a.index=l}),this._requestDraw()}drawScene(o,a,l){var c=this.getLayer(),d=o||c&&c.getCanvas(),h=d&&d.getContext(),f=this._getCanvasCache(),p=f&&f.scene,g=d&&d.isCache;if(!this.isVisible()&&!g)return this;if(p){h.save();var m=this.getAbsoluteTransform(a).getMatrix();h.transform(m[0],m[1],m[2],m[3],m[4],m[5]),this._drawCachedSceneCanvas(h),h.restore()}else this._drawChildren("drawScene",d,a,l);return this}drawHit(o,a){if(!this.shouldDrawHit(a))return this;var l=this.getLayer(),c=o||l&&l.hitCanvas,d=c&&c.getContext(),h=this._getCanvasCache(),f=h&&h.hit;if(f){d.save();var p=this.getAbsoluteTransform(a).getMatrix();d.transform(p[0],p[1],p[2],p[3],p[4],p[5]),this._drawCachedHitCanvas(d),d.restore()}else this._drawChildren("drawHit",c,a);return this}_drawChildren(o,a,l,c){var d,h=a&&a.getContext(),f=this.clipWidth(),p=this.clipHeight(),g=this.clipFunc(),m=typeof f=="number"&&typeof p=="number"||g;const y=l===this;if(m){h.save();var x=this.getAbsoluteTransform(l),C=x.getMatrix();h.transform(C[0],C[1],C[2],C[3],C[4],C[5]),h.beginPath();let w;if(g)w=g.call(this,h,this);else{var v=this.clipX(),b=this.clipY();h.rect(v||0,b||0,f,p)}h.clip.apply(h,w),C=x.copy().invert().getMatrix(),h.transform(C[0],C[1],C[2],C[3],C[4],C[5])}var S=!y&&this.globalCompositeOperation()!=="source-over"&&o==="drawScene";S&&(h.save(),h._applyGlobalCompositeOperation(this)),(d=this.children)===null||d===void 0||d.forEach(function(w){w[o](a,l,c)}),S&&h.restore(),m&&h.restore()}getClientRect(o={}){var a,l=o.skipTransform,c=o.relativeTo,d,h,f,p,g={x:1/0,y:1/0,width:0,height:0},m=this;(a=this.children)===null||a===void 0||a.forEach(function(b){if(b.visible()){var S=b.getClientRect({relativeTo:m,skipShadow:o.skipShadow,skipStroke:o.skipStroke});S.width===0&&S.height===0||(d===void 0?(d=S.x,h=S.y,f=S.x+S.width,p=S.y+S.height):(d=Math.min(d,S.x),h=Math.min(h,S.y),f=Math.max(f,S.x+S.width),p=Math.max(p,S.y+S.height)))}});for(var y=this.find("Shape"),x=!1,C=0;C<y.length;C++){var v=y[C];if(v._isVisible(this)){x=!0;break}}return x&&d!==void 0?g={x:d,y:h,width:f-d,height:p-h}:g={x:0,y:0,width:0,height:0},l?g:this._transformedRect(g,c)}};return Sd.Container=s,e.Factory.addComponentsGetterSetter(s,"clip",["x","y","width","height"]),e.Factory.addGetterSetter(s,"clipX",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipY",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipWidth",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipHeight",void 0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(s,"clipFunc"),Sd}var av={},lr={},V_;function aE(){if(V_)return lr;V_=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.releaseCapture=lr.setPointerCapture=lr.hasPointerCapture=lr.createEvent=lr.getCapturedShape=void 0;const e=yt(),t=new Map,n=e.Konva._global.PointerEvent!==void 0;function s(c){return t.get(c)}lr.getCapturedShape=s;function i(c){return{evt:c,pointerId:c.pointerId}}lr.createEvent=i;function o(c,d){return t.get(c)===d}lr.hasPointerCapture=o;function a(c,d){l(c),d.getStage()&&(t.set(c,d),n&&d._fire("gotpointercapture",i(new PointerEvent("gotpointercapture"))))}lr.setPointerCapture=a;function l(c,d){const h=t.get(c);if(!h)return;const f=h.getStage();f&&f.content,t.delete(c),n&&h._fire("lostpointercapture",i(new PointerEvent("lostpointercapture")))}return lr.releaseCapture=l,lr}var G_;function tie(){return G_||(G_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Stage=e.stages=void 0;const t=_n(),n=vt(),s=k1(),i=yt(),o=j1(),a=fS(),l=yt(),c=aE();var d="Stage",h="string",f="px",p="mouseout",g="mouseleave",m="mouseover",y="mouseenter",x="mousemove",C="mousedown",v="mouseup",b="pointermove",S="pointerdown",w="pointerup",j="pointercancel",E="lostpointercapture",A="pointerout",L="pointerleave",M="pointerover",O="pointerenter",F="contextmenu",_="touchstart",R="touchend",D="touchmove",$="touchcancel",G="wheel",ee=5,Q=[[y,"_pointerenter"],[C,"_pointerdown"],[x,"_pointermove"],[v,"_pointerup"],[g,"_pointerleave"],[_,"_pointerdown"],[D,"_pointermove"],[R,"_pointerup"],[$,"_pointercancel"],[m,"_pointerover"],[G,"_wheel"],[F,"_contextmenu"],[S,"_pointerdown"],[b,"_pointermove"],[w,"_pointerup"],[j,"_pointercancel"],[E,"_lostpointercapture"]];const se={mouse:{[A]:p,[L]:g,[M]:m,[O]:y,[b]:x,[S]:C,[w]:v,[j]:"mousecancel",pointerclick:"click",pointerdblclick:"dblclick"},touch:{[A]:"touchout",[L]:"touchleave",[M]:"touchover",[O]:"touchenter",[b]:D,[S]:_,[w]:R,[j]:$,pointerclick:"tap",pointerdblclick:"dbltap"},pointer:{[A]:A,[L]:L,[M]:M,[O]:O,[b]:b,[S]:S,[w]:w,[j]:j,pointerclick:"pointerclick",pointerdblclick:"pointerdblclick"}},ne=J=>J.indexOf("pointer")>=0?"pointer":J.indexOf("touch")>=0?"touch":"mouse",H=J=>{const N=ne(J);if(N==="pointer")return i.Konva.pointerEventsEnabled&&se.pointer;if(N==="touch")return se.touch;if(N==="mouse")return se.mouse};function V(J={}){return(J.clipFunc||J.clipWidth||J.clipHeight)&&t.Util.warn("Stage does not support clipping. Please use clip for Layers or Groups."),J}const Y="Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);";e.stages=[];class W extends s.Container{constructor(N){super(V(N)),this._pointerPositions=[],this._changedPointerPositions=[],this._buildDOM(),this._bindContentEvents(),e.stages.push(this),this.on("widthChange.konva heightChange.konva",this._resizeDOM),this.on("visibleChange.konva",this._checkVisibility),this.on("clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva",()=>{V(this.attrs)}),this._checkVisibility()}_validateAdd(N){const B=N.getType()==="Layer",U=N.getType()==="FastLayer";B||U||t.Util.throw("You may only add layers to the stage.")}_checkVisibility(){if(!this.content)return;const N=this.visible()?"":"none";this.content.style.display=N}setContainer(N){if(typeof N===h){if(N.charAt(0)==="."){var B=N.slice(1);N=document.getElementsByClassName(B)[0]}else{var U;N.charAt(0)!=="#"?U=N:U=N.slice(1),N=document.getElementById(U)}if(!N)throw"Can not find container in document with id "+U}return this._setAttr("container",N),this.content&&(this.content.parentElement&&this.content.parentElement.removeChild(this.content),N.appendChild(this.content)),this}shouldDrawHit(){return!0}clear(){var N=this.children,B=N.length,U;for(U=0;U<B;U++)N[U].clear();return this}clone(N){return N||(N={}),N.container=typeof document<"u"&&document.createElement("div"),s.Container.prototype.clone.call(this,N)}destroy(){super.destroy();var N=this.content;N&&t.Util._isInDocument(N)&&this.container().removeChild(N);var B=e.stages.indexOf(this);return B>-1&&e.stages.splice(B,1),t.Util.releaseCanvas(this.bufferCanvas._canvas,this.bufferHitCanvas._canvas),this}getPointerPosition(){const N=this._pointerPositions[0]||this._changedPointerPositions[0];return N?{x:N.x,y:N.y}:(t.Util.warn(Y),null)}_getPointerById(N){return this._pointerPositions.find(B=>B.id===N)}getPointersPositions(){return this._pointerPositions}getStage(){return this}getContent(){return this.content}_toKonvaCanvas(N){N=N||{},N.x=N.x||0,N.y=N.y||0,N.width=N.width||this.width(),N.height=N.height||this.height();var B=new o.SceneCanvas({width:N.width,height:N.height,pixelRatio:N.pixelRatio||1}),U=B.getContext()._context,ie=this.children;return(N.x||N.y)&&U.translate(-1*N.x,-1*N.y),ie.forEach(function(ue){if(ue.isVisible()){var be=ue._toKonvaCanvas(N);U.drawImage(be._canvas,N.x,N.y,be.getWidth()/be.getPixelRatio(),be.getHeight()/be.getPixelRatio())}}),B}getIntersection(N){if(!N)return null;var B=this.children,U=B.length,ie=U-1,ue;for(ue=ie;ue>=0;ue--){const be=B[ue].getIntersection(N);if(be)return be}return null}_resizeDOM(){var N=this.width(),B=this.height();this.content&&(this.content.style.width=N+f,this.content.style.height=B+f),this.bufferCanvas.setSize(N,B),this.bufferHitCanvas.setSize(N,B),this.children.forEach(U=>{U.setSize({width:N,height:B}),U.draw()})}add(N,...B){if(arguments.length>1){for(var U=0;U<arguments.length;U++)this.add(arguments[U]);return this}super.add(N);var ie=this.children.length;return ie>ee&&t.Util.warn("The stage has "+ie+" layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group."),N.setSize({width:this.width(),height:this.height()}),N.draw(),i.Konva.isBrowser&&this.content.appendChild(N.canvas._canvas),this}getParent(){return null}getLayer(){return null}hasPointerCapture(N){return c.hasPointerCapture(N,this)}setPointerCapture(N){c.setPointerCapture(N,this)}releaseCapture(N){c.releaseCapture(N,this)}getLayers(){return this.children}_bindContentEvents(){i.Konva.isBrowser&&Q.forEach(([N,B])=>{this.content.addEventListener(N,U=>{this[B](U)},{passive:!1})})}_pointerenter(N){this.setPointersPositions(N);const B=H(N.type);B&&this._fire(B.pointerenter,{evt:N,target:this,currentTarget:this})}_pointerover(N){this.setPointersPositions(N);const B=H(N.type);B&&this._fire(B.pointerover,{evt:N,target:this,currentTarget:this})}_getTargetShape(N){let B=this[N+"targetShape"];return B&&!B.getStage()&&(B=null),B}_pointerleave(N){const B=H(N.type),U=ne(N.type);if(B){this.setPointersPositions(N);var ie=this._getTargetShape(U),ue=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;ie&&ue?(ie._fireAndBubble(B.pointerout,{evt:N}),ie._fireAndBubble(B.pointerleave,{evt:N}),this._fire(B.pointerleave,{evt:N,target:this,currentTarget:this}),this[U+"targetShape"]=null):ue&&(this._fire(B.pointerleave,{evt:N,target:this,currentTarget:this}),this._fire(B.pointerout,{evt:N,target:this,currentTarget:this})),this.pointerPos=null,this._pointerPositions=[]}}_pointerdown(N){const B=H(N.type),U=ne(N.type);if(B){this.setPointersPositions(N);var ie=!1;this._changedPointerPositions.forEach(ue=>{var be=this.getIntersection(ue);if(a.DD.justDragged=!1,i.Konva["_"+U+"ListenClick"]=!0,!be||!be.isListening()){this[U+"ClickStartShape"]=void 0;return}i.Konva.capturePointerEventsEnabled&&be.setPointerCapture(ue.id),this[U+"ClickStartShape"]=be,be._fireAndBubble(B.pointerdown,{evt:N,pointerId:ue.id}),ie=!0;const Te=N.type.indexOf("touch")>=0;be.preventDefault()&&N.cancelable&&Te&&N.preventDefault()}),ie||this._fire(B.pointerdown,{evt:N,target:this,currentTarget:this,pointerId:this._pointerPositions[0].id})}}_pointermove(N){const B=H(N.type),U=ne(N.type);if(!B)return;i.Konva.isDragging()&&a.DD.node.preventDefault()&&N.cancelable&&N.preventDefault(),this.setPointersPositions(N);var ie=!(i.Konva.isDragging()||i.Konva.isTransforming())||i.Konva.hitOnDragEnabled;if(!ie)return;var ue={};let be=!1;var Te=this._getTargetShape(U);this._changedPointerPositions.forEach(je=>{const Be=c.getCapturedShape(je.id)||this.getIntersection(je),Ze=je.id,De={evt:N,pointerId:Ze};var q=Te!==Be;if(q&&Te&&(Te._fireAndBubble(B.pointerout,{...De},Be),Te._fireAndBubble(B.pointerleave,{...De},Be)),Be){if(ue[Be._id])return;ue[Be._id]=!0}Be&&Be.isListening()?(be=!0,q&&(Be._fireAndBubble(B.pointerover,{...De},Te),Be._fireAndBubble(B.pointerenter,{...De},Te),this[U+"targetShape"]=Be),Be._fireAndBubble(B.pointermove,{...De})):Te&&(this._fire(B.pointerover,{evt:N,target:this,currentTarget:this,pointerId:Ze}),this[U+"targetShape"]=null)}),be||this._fire(B.pointermove,{evt:N,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id})}_pointerup(N){const B=H(N.type),U=ne(N.type);if(!B)return;this.setPointersPositions(N);const ie=this[U+"ClickStartShape"],ue=this[U+"ClickEndShape"];var be={};let Te=!1;this._changedPointerPositions.forEach(je=>{const Be=c.getCapturedShape(je.id)||this.getIntersection(je);if(Be){if(Be.releaseCapture(je.id),be[Be._id])return;be[Be._id]=!0}const Ze=je.id,De={evt:N,pointerId:Ze};let q=!1;i.Konva["_"+U+"InDblClickWindow"]?(q=!0,clearTimeout(this[U+"DblTimeout"])):a.DD.justDragged||(i.Konva["_"+U+"InDblClickWindow"]=!0,clearTimeout(this[U+"DblTimeout"])),this[U+"DblTimeout"]=setTimeout(function(){i.Konva["_"+U+"InDblClickWindow"]=!1},i.Konva.dblClickWindow),Be&&Be.isListening()?(Te=!0,this[U+"ClickEndShape"]=Be,Be._fireAndBubble(B.pointerup,{...De}),i.Konva["_"+U+"ListenClick"]&&ie&&ie===Be&&(Be._fireAndBubble(B.pointerclick,{...De}),q&&ue&&ue===Be&&Be._fireAndBubble(B.pointerdblclick,{...De}))):(this[U+"ClickEndShape"]=null,i.Konva["_"+U+"ListenClick"]&&this._fire(B.pointerclick,{evt:N,target:this,currentTarget:this,pointerId:Ze}),q&&this._fire(B.pointerdblclick,{evt:N,target:this,currentTarget:this,pointerId:Ze}))}),Te||this._fire(B.pointerup,{evt:N,target:this,currentTarget:this,pointerId:this._changedPointerPositions[0].id}),i.Konva["_"+U+"ListenClick"]=!1,N.cancelable&&U!=="touch"&&N.preventDefault()}_contextmenu(N){this.setPointersPositions(N);var B=this.getIntersection(this.getPointerPosition());B&&B.isListening()?B._fireAndBubble(F,{evt:N}):this._fire(F,{evt:N,target:this,currentTarget:this})}_wheel(N){this.setPointersPositions(N);var B=this.getIntersection(this.getPointerPosition());B&&B.isListening()?B._fireAndBubble(G,{evt:N}):this._fire(G,{evt:N,target:this,currentTarget:this})}_pointercancel(N){this.setPointersPositions(N);const B=c.getCapturedShape(N.pointerId)||this.getIntersection(this.getPointerPosition());B&&B._fireAndBubble(w,c.createEvent(N)),c.releaseCapture(N.pointerId)}_lostpointercapture(N){c.releaseCapture(N.pointerId)}setPointersPositions(N){var B=this._getContentPosition(),U=null,ie=null;N=N||window.event,N.touches!==void 0?(this._pointerPositions=[],this._changedPointerPositions=[],Array.prototype.forEach.call(N.touches,ue=>{this._pointerPositions.push({id:ue.identifier,x:(ue.clientX-B.left)/B.scaleX,y:(ue.clientY-B.top)/B.scaleY})}),Array.prototype.forEach.call(N.changedTouches||N.touches,ue=>{this._changedPointerPositions.push({id:ue.identifier,x:(ue.clientX-B.left)/B.scaleX,y:(ue.clientY-B.top)/B.scaleY})})):(U=(N.clientX-B.left)/B.scaleX,ie=(N.clientY-B.top)/B.scaleY,this.pointerPos={x:U,y:ie},this._pointerPositions=[{x:U,y:ie,id:t.Util._getFirstPointerId(N)}],this._changedPointerPositions=[{x:U,y:ie,id:t.Util._getFirstPointerId(N)}])}_setPointerPosition(N){t.Util.warn('Method _setPointerPosition is deprecated. Use "stage.setPointersPositions(event)" instead.'),this.setPointersPositions(N)}_getContentPosition(){if(!this.content||!this.content.getBoundingClientRect)return{top:0,left:0,scaleX:1,scaleY:1};var N=this.content.getBoundingClientRect();return{top:N.top,left:N.left,scaleX:N.width/this.content.clientWidth||1,scaleY:N.height/this.content.clientHeight||1}}_buildDOM(){if(this.bufferCanvas=new o.SceneCanvas({width:this.width(),height:this.height()}),this.bufferHitCanvas=new o.HitCanvas({pixelRatio:1,width:this.width(),height:this.height()}),!!i.Konva.isBrowser){var N=this.container();if(!N)throw"Stage has no container. A container is required.";N.innerHTML="",this.content=document.createElement("div"),this.content.style.position="relative",this.content.style.userSelect="none",this.content.className="konvajs-content",this.content.setAttribute("role","presentation"),N.appendChild(this.content),this._resizeDOM()}}cache(){return t.Util.warn("Cache function is not allowed for stage. You may use cache only for layers, groups and shapes."),this}clearCache(){return this}batchDraw(){return this.getChildren().forEach(function(N){N.batchDraw()}),this}}e.Stage=W,W.prototype.nodeType=d,(0,l._registerNode)(W),n.Factory.addGetterSetter(W,"container"),i.Konva.isBrowser&&document.addEventListener("visibilitychange",()=>{e.stages.forEach(J=>{J.batchDraw()})})}(av)),av}var wd={},lv={},z_;function Qn(){return z_||(z_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Shape=e.shapes=void 0;const t=yt(),n=_n(),s=vt(),i=Tn(),o=xt(),a=yt(),l=aE();var c="hasShadow",d="shadowRGBA",h="patternImage",f="linearGradient",p="radialGradient";let g;function m(){return g||(g=n.Util.createCanvasElement().getContext("2d"),g)}e.shapes={};function y(L){const M=this.attrs.fillRule;M?L.fill(M):L.fill()}function x(L){L.stroke()}function C(L){const M=this.attrs.fillRule;M?L.fill(M):L.fill()}function v(L){L.stroke()}function b(){this._clearCache(c)}function S(){this._clearCache(d)}function w(){this._clearCache(h)}function j(){this._clearCache(f)}function E(){this._clearCache(p)}class A extends i.Node{constructor(M){super(M);let O;for(;O=n.Util.getRandomColor(),!(O&&!(O in e.shapes)););this.colorKey=O,e.shapes[O]=this}getContext(){return n.Util.warn("shape.getContext() method is deprecated. Please do not use it."),this.getLayer().getContext()}getCanvas(){return n.Util.warn("shape.getCanvas() method is deprecated. Please do not use it."),this.getLayer().getCanvas()}getSceneFunc(){return this.attrs.sceneFunc||this._sceneFunc}getHitFunc(){return this.attrs.hitFunc||this._hitFunc}hasShadow(){return this._getCache(c,this._hasShadow)}_hasShadow(){return this.shadowEnabled()&&this.shadowOpacity()!==0&&!!(this.shadowColor()||this.shadowBlur()||this.shadowOffsetX()||this.shadowOffsetY())}_getFillPattern(){return this._getCache(h,this.__getFillPattern)}__getFillPattern(){if(this.fillPatternImage()){var M=m();const O=M.createPattern(this.fillPatternImage(),this.fillPatternRepeat()||"repeat");if(O&&O.setTransform){const F=new n.Transform;F.translate(this.fillPatternX(),this.fillPatternY()),F.rotate(t.Konva.getAngle(this.fillPatternRotation())),F.scale(this.fillPatternScaleX(),this.fillPatternScaleY()),F.translate(-1*this.fillPatternOffsetX(),-1*this.fillPatternOffsetY());const _=F.getMatrix(),R=typeof DOMMatrix>"u"?{a:_[0],b:_[1],c:_[2],d:_[3],e:_[4],f:_[5]}:new DOMMatrix(_);O.setTransform(R)}return O}}_getLinearGradient(){return this._getCache(f,this.__getLinearGradient)}__getLinearGradient(){var M=this.fillLinearGradientColorStops();if(M){for(var O=m(),F=this.fillLinearGradientStartPoint(),_=this.fillLinearGradientEndPoint(),R=O.createLinearGradient(F.x,F.y,_.x,_.y),D=0;D<M.length;D+=2)R.addColorStop(M[D],M[D+1]);return R}}_getRadialGradient(){return this._getCache(p,this.__getRadialGradient)}__getRadialGradient(){var M=this.fillRadialGradientColorStops();if(M){for(var O=m(),F=this.fillRadialGradientStartPoint(),_=this.fillRadialGradientEndPoint(),R=O.createRadialGradient(F.x,F.y,this.fillRadialGradientStartRadius(),_.x,_.y,this.fillRadialGradientEndRadius()),D=0;D<M.length;D+=2)R.addColorStop(M[D],M[D+1]);return R}}getShadowRGBA(){return this._getCache(d,this._getShadowRGBA)}_getShadowRGBA(){if(this.hasShadow()){var M=n.Util.colorToRGBA(this.shadowColor());if(M)return"rgba("+M.r+","+M.g+","+M.b+","+M.a*(this.shadowOpacity()||1)+")"}}hasFill(){return this._calculate("hasFill",["fillEnabled","fill","fillPatternImage","fillLinearGradientColorStops","fillRadialGradientColorStops"],()=>this.fillEnabled()&&!!(this.fill()||this.fillPatternImage()||this.fillLinearGradientColorStops()||this.fillRadialGradientColorStops()))}hasStroke(){return this._calculate("hasStroke",["strokeEnabled","strokeWidth","stroke","strokeLinearGradientColorStops"],()=>this.strokeEnabled()&&this.strokeWidth()&&!!(this.stroke()||this.strokeLinearGradientColorStops()))}hasHitStroke(){const M=this.hitStrokeWidth();return M==="auto"?this.hasStroke():this.strokeEnabled()&&!!M}intersects(M){var O=this.getStage();if(!O)return!1;const F=O.bufferHitCanvas;return F.getContext().clear(),this.drawHit(F,void 0,!0),F.context.getImageData(Math.round(M.x),Math.round(M.y),1,1).data[3]>0}destroy(){return i.Node.prototype.destroy.call(this),delete e.shapes[this.colorKey],delete this.colorKey,this}_useBufferCanvas(M){var O;if(!((O=this.attrs.perfectDrawEnabled)!==null&&O!==void 0?O:!0))return!1;const _=M||this.hasFill(),R=this.hasStroke(),D=this.getAbsoluteOpacity()!==1;if(_&&R&&D)return!0;const $=this.hasShadow(),G=this.shadowForStrokeEnabled();return!!(_&&R&&$&&G)}setStrokeHitEnabled(M){n.Util.warn("strokeHitEnabled property is deprecated. Please use hitStrokeWidth instead."),M?this.hitStrokeWidth("auto"):this.hitStrokeWidth(0)}getStrokeHitEnabled(){return this.hitStrokeWidth()!==0}getSelfRect(){var M=this.size();return{x:this._centroid?-M.width/2:0,y:this._centroid?-M.height/2:0,width:M.width,height:M.height}}getClientRect(M={}){let O=!1,F=this.getParent();for(;F;){if(F.isCached()){O=!0;break}F=F.getParent()}const _=M.skipTransform,R=M.relativeTo||O&&this.getStage()||void 0,D=this.getSelfRect(),G=!M.skipStroke&&this.hasStroke()&&this.strokeWidth()||0,ee=D.width+G,Q=D.height+G,se=!M.skipShadow&&this.hasShadow(),ne=se?this.shadowOffsetX():0,H=se?this.shadowOffsetY():0,V=ee+Math.abs(ne),Y=Q+Math.abs(H),W=se&&this.shadowBlur()||0,J=V+W*2,N=Y+W*2,B={width:J,height:N,x:-(G/2+W)+Math.min(ne,0)+D.x,y:-(G/2+W)+Math.min(H,0)+D.y};return _?B:this._transformedRect(B,R)}drawScene(M,O,F){var _=this.getLayer(),R=M||_.getCanvas(),D=R.getContext(),$=this._getCanvasCache(),G=this.getSceneFunc(),ee=this.hasShadow(),Q,se,ne=R.isCache,H=O===this;if(!this.isVisible()&&!H)return this;if($){D.save();var V=this.getAbsoluteTransform(O).getMatrix();return D.transform(V[0],V[1],V[2],V[3],V[4],V[5]),this._drawCachedSceneCanvas(D),D.restore(),this}if(!G)return this;if(D.save(),this._useBufferCanvas()&&!ne){Q=this.getStage();const J=F||Q.bufferCanvas;se=J.getContext(),se.clear(),se.save(),se._applyLineJoin(this);var Y=this.getAbsoluteTransform(O).getMatrix();se.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),G.call(this,se,this),se.restore();var W=J.pixelRatio;ee&&D._applyShadow(this),D._applyOpacity(this),D._applyGlobalCompositeOperation(this),D.drawImage(J._canvas,0,0,J.width/W,J.height/W)}else{if(D._applyLineJoin(this),!H){var Y=this.getAbsoluteTransform(O).getMatrix();D.transform(Y[0],Y[1],Y[2],Y[3],Y[4],Y[5]),D._applyOpacity(this),D._applyGlobalCompositeOperation(this)}ee&&D._applyShadow(this),G.call(this,D,this)}return D.restore(),this}drawHit(M,O,F=!1){if(!this.shouldDrawHit(O,F))return this;var _=this.getLayer(),R=M||_.hitCanvas,D=R&&R.getContext(),$=this.hitFunc()||this.sceneFunc(),G=this._getCanvasCache(),ee=G&&G.hit;if(this.colorKey||n.Util.warn("Looks like your canvas has a destroyed shape in it. Do not reuse shape after you destroyed it. If you want to reuse shape you should call remove() instead of destroy()"),ee){D.save();var Q=this.getAbsoluteTransform(O).getMatrix();return D.transform(Q[0],Q[1],Q[2],Q[3],Q[4],Q[5]),this._drawCachedHitCanvas(D),D.restore(),this}if(!$)return this;if(D.save(),D._applyLineJoin(this),!(this===O)){var ne=this.getAbsoluteTransform(O).getMatrix();D.transform(ne[0],ne[1],ne[2],ne[3],ne[4],ne[5])}return $.call(this,D,this),D.restore(),this}drawHitFromCache(M=0){var O=this._getCanvasCache(),F=this._getCachedSceneCanvas(),_=O.hit,R=_.getContext(),D=_.getWidth(),$=_.getHeight(),G,ee,Q,se,ne,H;R.clear(),R.drawImage(F._canvas,0,0,D,$);try{for(G=R.getImageData(0,0,D,$),ee=G.data,Q=ee.length,se=n.Util._hexToRgb(this.colorKey),ne=0;ne<Q;ne+=4)H=ee[ne+3],H>M?(ee[ne]=se.r,ee[ne+1]=se.g,ee[ne+2]=se.b,ee[ne+3]=255):ee[ne+3]=0;R.putImageData(G,0,0)}catch(V){n.Util.error("Unable to draw hit graph from cached scene canvas. "+V.message)}return this}hasPointerCapture(M){return l.hasPointerCapture(M,this)}setPointerCapture(M){l.setPointerCapture(M,this)}releaseCapture(M){l.releaseCapture(M,this)}}e.Shape=A,A.prototype._fillFunc=y,A.prototype._strokeFunc=x,A.prototype._fillFuncHit=C,A.prototype._strokeFuncHit=v,A.prototype._centroid=!1,A.prototype.nodeType="Shape",(0,a._registerNode)(A),A.prototype.eventListeners={},A.prototype.on.call(A.prototype,"shadowColorChange.konva shadowBlurChange.konva shadowOffsetChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",b),A.prototype.on.call(A.prototype,"shadowColorChange.konva shadowOpacityChange.konva shadowEnabledChange.konva",S),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillPatternImageChange.konva fillPatternRepeatChange.konva fillPatternScaleXChange.konva fillPatternScaleYChange.konva fillPatternOffsetXChange.konva fillPatternOffsetYChange.konva fillPatternXChange.konva fillPatternYChange.konva fillPatternRotationChange.konva",w),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillLinearGradientColorStopsChange.konva fillLinearGradientStartPointXChange.konva fillLinearGradientStartPointYChange.konva fillLinearGradientEndPointXChange.konva fillLinearGradientEndPointYChange.konva",j),A.prototype.on.call(A.prototype,"fillPriorityChange.konva fillRadialGradientColorStopsChange.konva fillRadialGradientStartPointXChange.konva fillRadialGradientStartPointYChange.konva fillRadialGradientEndPointXChange.konva fillRadialGradientEndPointYChange.konva fillRadialGradientStartRadiusChange.konva fillRadialGradientEndRadiusChange.konva",E),s.Factory.addGetterSetter(A,"stroke",void 0,(0,o.getStringOrGradientValidator)()),s.Factory.addGetterSetter(A,"strokeWidth",2,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"fillAfterStrokeEnabled",!1),s.Factory.addGetterSetter(A,"hitStrokeWidth","auto",(0,o.getNumberOrAutoValidator)()),s.Factory.addGetterSetter(A,"strokeHitEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(A,"perfectDrawEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(A,"shadowForStrokeEnabled",!0,(0,o.getBooleanValidator)()),s.Factory.addGetterSetter(A,"lineJoin"),s.Factory.addGetterSetter(A,"lineCap"),s.Factory.addGetterSetter(A,"sceneFunc"),s.Factory.addGetterSetter(A,"hitFunc"),s.Factory.addGetterSetter(A,"dash"),s.Factory.addGetterSetter(A,"dashOffset",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"shadowColor",void 0,(0,o.getStringValidator)()),s.Factory.addGetterSetter(A,"shadowBlur",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"shadowOpacity",1,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(A,"shadowOffset",["x","y"]),s.Factory.addGetterSetter(A,"shadowOffsetX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"shadowOffsetY",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"fillPatternImage"),s.Factory.addGetterSetter(A,"fill",void 0,(0,o.getStringOrGradientValidator)()),s.Factory.addGetterSetter(A,"fillPatternX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"fillPatternY",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"fillLinearGradientColorStops"),s.Factory.addGetterSetter(A,"strokeLinearGradientColorStops"),s.Factory.addGetterSetter(A,"fillRadialGradientStartRadius",0),s.Factory.addGetterSetter(A,"fillRadialGradientEndRadius",0),s.Factory.addGetterSetter(A,"fillRadialGradientColorStops"),s.Factory.addGetterSetter(A,"fillPatternRepeat","repeat"),s.Factory.addGetterSetter(A,"fillEnabled",!0),s.Factory.addGetterSetter(A,"strokeEnabled",!0),s.Factory.addGetterSetter(A,"shadowEnabled",!0),s.Factory.addGetterSetter(A,"dashEnabled",!0),s.Factory.addGetterSetter(A,"strokeScaleEnabled",!0),s.Factory.addGetterSetter(A,"fillPriority","color"),s.Factory.addComponentsGetterSetter(A,"fillPatternOffset",["x","y"]),s.Factory.addGetterSetter(A,"fillPatternOffsetX",0,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"fillPatternOffsetY",0,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(A,"fillPatternScale",["x","y"]),s.Factory.addGetterSetter(A,"fillPatternScaleX",1,(0,o.getNumberValidator)()),s.Factory.addGetterSetter(A,"fillPatternScaleY",1,(0,o.getNumberValidator)()),s.Factory.addComponentsGetterSetter(A,"fillLinearGradientStartPoint",["x","y"]),s.Factory.addComponentsGetterSetter(A,"strokeLinearGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(A,"fillLinearGradientStartPointX",0),s.Factory.addGetterSetter(A,"strokeLinearGradientStartPointX",0),s.Factory.addGetterSetter(A,"fillLinearGradientStartPointY",0),s.Factory.addGetterSetter(A,"strokeLinearGradientStartPointY",0),s.Factory.addComponentsGetterSetter(A,"fillLinearGradientEndPoint",["x","y"]),s.Factory.addComponentsGetterSetter(A,"strokeLinearGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(A,"fillLinearGradientEndPointX",0),s.Factory.addGetterSetter(A,"strokeLinearGradientEndPointX",0),s.Factory.addGetterSetter(A,"fillLinearGradientEndPointY",0),s.Factory.addGetterSetter(A,"strokeLinearGradientEndPointY",0),s.Factory.addComponentsGetterSetter(A,"fillRadialGradientStartPoint",["x","y"]),s.Factory.addGetterSetter(A,"fillRadialGradientStartPointX",0),s.Factory.addGetterSetter(A,"fillRadialGradientStartPointY",0),s.Factory.addComponentsGetterSetter(A,"fillRadialGradientEndPoint",["x","y"]),s.Factory.addGetterSetter(A,"fillRadialGradientEndPointX",0),s.Factory.addGetterSetter(A,"fillRadialGradientEndPointY",0),s.Factory.addGetterSetter(A,"fillPatternRotation",0),s.Factory.addGetterSetter(A,"fillRule",void 0,(0,o.getStringValidator)()),s.Factory.backCompat(A,{dashArray:"dash",getDashArray:"getDash",setDashArray:"getDash",drawFunc:"sceneFunc",getDrawFunc:"getSceneFunc",setDrawFunc:"setSceneFunc",drawHitFunc:"hitFunc",getDrawHitFunc:"getHitFunc",setDrawHitFunc:"setHitFunc"})}(lv)),lv}var H_;function lE(){if(H_)return wd;H_=1,Object.defineProperty(wd,"__esModule",{value:!0}),wd.Layer=void 0;const e=_n(),t=k1(),n=Tn(),s=vt(),i=j1(),o=xt(),a=Qn(),l=yt();var c="#",d="beforeDraw",h="draw",f=[{x:0,y:0},{x:-1,y:-1},{x:1,y:-1},{x:1,y:1},{x:-1,y:1}],p=f.length;let g=class extends t.Container{constructor(y){super(y),this.canvas=new i.SceneCanvas,this.hitCanvas=new i.HitCanvas({pixelRatio:1}),this._waitingForDraw=!1,this.on("visibleChange.konva",this._checkVisibility),this._checkVisibility(),this.on("imageSmoothingEnabledChange.konva",this._setSmoothEnabled),this._setSmoothEnabled()}createPNGStream(){return this.canvas._canvas.createPNGStream()}getCanvas(){return this.canvas}getNativeCanvasElement(){return this.canvas._canvas}getHitCanvas(){return this.hitCanvas}getContext(){return this.getCanvas().getContext()}clear(y){return this.getContext().clear(y),this.getHitCanvas().getContext().clear(y),this}setZIndex(y){super.setZIndex(y);var x=this.getStage();return x&&x.content&&(x.content.removeChild(this.getNativeCanvasElement()),y<x.children.length-1?x.content.insertBefore(this.getNativeCanvasElement(),x.children[y+1].getCanvas()._canvas):x.content.appendChild(this.getNativeCanvasElement())),this}moveToTop(){n.Node.prototype.moveToTop.call(this);var y=this.getStage();return y&&y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.appendChild(this.getNativeCanvasElement())),!0}moveUp(){var y=n.Node.prototype.moveUp.call(this);if(!y)return!1;var x=this.getStage();return!x||!x.content?!1:(x.content.removeChild(this.getNativeCanvasElement()),this.index<x.children.length-1?x.content.insertBefore(this.getNativeCanvasElement(),x.children[this.index+1].getCanvas()._canvas):x.content.appendChild(this.getNativeCanvasElement()),!0)}moveDown(){if(n.Node.prototype.moveDown.call(this)){var y=this.getStage();if(y){var x=y.children;y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.insertBefore(this.getNativeCanvasElement(),x[this.index+1].getCanvas()._canvas))}return!0}return!1}moveToBottom(){if(n.Node.prototype.moveToBottom.call(this)){var y=this.getStage();if(y){var x=y.children;y.content&&(y.content.removeChild(this.getNativeCanvasElement()),y.content.insertBefore(this.getNativeCanvasElement(),x[1].getCanvas()._canvas))}return!0}return!1}getLayer(){return this}remove(){var y=this.getNativeCanvasElement();return n.Node.prototype.remove.call(this),y&&y.parentNode&&e.Util._isInDocument(y)&&y.parentNode.removeChild(y),this}getStage(){return this.parent}setSize({width:y,height:x}){return this.canvas.setSize(y,x),this.hitCanvas.setSize(y,x),this._setSmoothEnabled(),this}_validateAdd(y){var x=y.getType();x!=="Group"&&x!=="Shape"&&e.Util.throw("You may only add groups and shapes to a layer.")}_toKonvaCanvas(y){return y=y||{},y.width=y.width||this.getWidth(),y.height=y.height||this.getHeight(),y.x=y.x!==void 0?y.x:this.x(),y.y=y.y!==void 0?y.y:this.y(),n.Node.prototype._toKonvaCanvas.call(this,y)}_checkVisibility(){this.visible()?this.canvas._canvas.style.display="block":this.canvas._canvas.style.display="none"}_setSmoothEnabled(){this.getContext()._context.imageSmoothingEnabled=this.imageSmoothingEnabled()}getWidth(){if(this.parent)return this.parent.width()}setWidth(){e.Util.warn('Can not change width of layer. Use "stage.width(value)" function instead.')}getHeight(){if(this.parent)return this.parent.height()}setHeight(){e.Util.warn('Can not change height of layer. Use "stage.height(value)" function instead.')}batchDraw(){return this._waitingForDraw||(this._waitingForDraw=!0,e.Util.requestAnimFrame(()=>{this.draw(),this._waitingForDraw=!1})),this}getIntersection(y){if(!this.isListening()||!this.isVisible())return null;for(var x=1,C=!1;;){for(let v=0;v<p;v++){const b=f[v],S=this._getIntersection({x:y.x+b.x*x,y:y.y+b.y*x}),w=S.shape;if(w)return w;if(C=!!S.antialiased,!S.antialiased)break}if(C)x+=1;else return null}}_getIntersection(y){const x=this.hitCanvas.pixelRatio,C=this.hitCanvas.context.getImageData(Math.round(y.x*x),Math.round(y.y*x),1,1).data,v=C[3];if(v===255){const b=e.Util._rgbToHex(C[0],C[1],C[2]),S=a.shapes[c+b];return S?{shape:S}:{antialiased:!0}}else if(v>0)return{antialiased:!0};return{}}drawScene(y,x){var C=this.getLayer(),v=y||C&&C.getCanvas();return this._fire(d,{node:this}),this.clearBeforeDraw()&&v.getContext().clear(),t.Container.prototype.drawScene.call(this,v,x),this._fire(h,{node:this}),this}drawHit(y,x){var C=this.getLayer(),v=y||C&&C.hitCanvas;return C&&C.clearBeforeDraw()&&C.getHitCanvas().getContext().clear(),t.Container.prototype.drawHit.call(this,v,x),this}enableHitGraph(){return this.hitGraphEnabled(!0),this}disableHitGraph(){return this.hitGraphEnabled(!1),this}setHitGraphEnabled(y){e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening(y)}getHitGraphEnabled(y){return e.Util.warn("hitGraphEnabled method is deprecated. Please use layer.listening() instead."),this.listening()}toggleHitCanvas(){if(!(!this.parent||!this.parent.content)){var y=this.parent,x=!!this.hitCanvas._canvas.parentNode;x?y.content.removeChild(this.hitCanvas._canvas):y.content.appendChild(this.hitCanvas._canvas)}}destroy(){return e.Util.releaseCanvas(this.getNativeCanvasElement(),this.getHitCanvas()._canvas),super.destroy()}};return wd.Layer=g,g.prototype.nodeType="Layer",(0,l._registerNode)(g),s.Factory.addGetterSetter(g,"imageSmoothingEnabled",!0),s.Factory.addGetterSetter(g,"clearBeforeDraw",!0),s.Factory.addGetterSetter(g,"hitGraphEnabled",!0,(0,o.getBooleanValidator)()),wd}var jd={},W_;function nie(){if(W_)return jd;W_=1,Object.defineProperty(jd,"__esModule",{value:!0}),jd.FastLayer=void 0;const e=_n(),t=lE(),n=yt();let s=class extends t.Layer{constructor(o){super(o),this.listening(!1),e.Util.warn('Konva.Fast layer is deprecated. Please use "new Konva.Layer({ listening: false })" instead.')}};return jd.FastLayer=s,s.prototype.nodeType="FastLayer",(0,n._registerNode)(s),jd}var kd={},U_;function pS(){if(U_)return kd;U_=1,Object.defineProperty(kd,"__esModule",{value:!0}),kd.Group=void 0;const e=_n(),t=k1(),n=yt();let s=class extends t.Container{_validateAdd(o){var a=o.getType();a!=="Group"&&a!=="Shape"&&e.Util.throw("You may only add groups and shapes to groups.")}};return kd.Group=s,s.prototype.nodeType="Group",(0,n._registerNode)(s),kd}var _d={},q_;function gS(){if(q_)return _d;q_=1,Object.defineProperty(_d,"__esModule",{value:!0}),_d.Animation=void 0;const e=yt(),t=_n(),n=function(){return e.glob.performance&&e.glob.performance.now?function(){return e.glob.performance.now()}:function(){return new Date().getTime()}}();let s=class wc{constructor(o,a){this.id=wc.animIdCounter++,this.frame={time:0,timeDiff:0,lastTime:n(),frameRate:0},this.func=o,this.setLayers(a)}setLayers(o){let a=[];return o&&(a=Array.isArray(o)?o:[o]),this.layers=a,this}getLayers(){return this.layers}addLayer(o){const a=this.layers,l=a.length;for(let c=0;c<l;c++)if(a[c]._id===o._id)return!1;return this.layers.push(o),!0}isRunning(){const a=wc.animations,l=a.length;for(let c=0;c<l;c++)if(a[c].id===this.id)return!0;return!1}start(){return this.stop(),this.frame.timeDiff=0,this.frame.lastTime=n(),wc._addAnimation(this),this}stop(){return wc._removeAnimation(this),this}_updateFrameObject(o){this.frame.timeDiff=o-this.frame.lastTime,this.frame.lastTime=o,this.frame.time+=this.frame.timeDiff,this.frame.frameRate=1e3/this.frame.timeDiff}static _addAnimation(o){this.animations.push(o),this._handleAnimation()}static _removeAnimation(o){const a=o.id,l=this.animations,c=l.length;for(let d=0;d<c;d++)if(l[d].id===a){this.animations.splice(d,1);break}}static _runFrames(){const o={},a=this.animations;for(let l=0;l<a.length;l++){const c=a[l],d=c.layers,h=c.func;c._updateFrameObject(n());const f=d.length;let p;if(h?p=h.call(c,c.frame)!==!1:p=!0,!!p)for(let g=0;g<f;g++){const m=d[g];m._id!==void 0&&(o[m._id]=m)}}for(let l in o)o.hasOwnProperty(l)&&o[l].batchDraw()}static _animationLoop(){const o=wc;o.animations.length?(o._runFrames(),t.Util.requestAnimFrame(o._animationLoop)):o.animRunning=!1}static _handleAnimation(){this.animRunning||(this.animRunning=!0,t.Util.requestAnimFrame(this._animationLoop))}};return _d.Animation=s,s.animations=[],s.animIdCounter=0,s.animRunning=!1,_d}var cv={},K_;function sie(){return K_||(K_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Easings=e.Tween=void 0;const t=_n(),n=gS(),s=Tn(),i=yt();var o={node:1,duration:1,easing:1,onFinish:1,yoyo:1},a=1,l=2,c=3,d=0,h=["fill","stroke","shadowColor"];class f{constructor(m,y,x,C,v,b,S){this.prop=m,this.propFunc=y,this.begin=C,this._pos=C,this.duration=b,this._change=0,this.prevPos=0,this.yoyo=S,this._time=0,this._position=0,this._startTime=0,this._finish=0,this.func=x,this._change=v-this.begin,this.pause()}fire(m){var y=this[m];y&&y()}setTime(m){m>this.duration?this.yoyo?(this._time=this.duration,this.reverse()):this.finish():m<0?this.yoyo?(this._time=0,this.play()):this.reset():(this._time=m,this.update())}getTime(){return this._time}setPosition(m){this.prevPos=this._pos,this.propFunc(m),this._pos=m}getPosition(m){return m===void 0&&(m=this._time),this.func(m,this.begin,this._change,this.duration)}play(){this.state=l,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onPlay")}reverse(){this.state=c,this._time=this.duration-this._time,this._startTime=this.getTimer()-this._time,this.onEnterFrame(),this.fire("onReverse")}seek(m){this.pause(),this._time=m,this.update(),this.fire("onSeek")}reset(){this.pause(),this._time=0,this.update(),this.fire("onReset")}finish(){this.pause(),this._time=this.duration,this.update(),this.fire("onFinish")}update(){this.setPosition(this.getPosition(this._time)),this.fire("onUpdate")}onEnterFrame(){var m=this.getTimer()-this._startTime;this.state===l?this.setTime(m):this.state===c&&this.setTime(this.duration-m)}pause(){this.state=a,this.fire("onPause")}getTimer(){return new Date().getTime()}}class p{constructor(m){var y=this,x=m.node,C=x._id,v,b=m.easing||e.Easings.Linear,S=!!m.yoyo,w;typeof m.duration>"u"?v=.3:m.duration===0?v=.001:v=m.duration,this.node=x,this._id=d++;var j=x.getLayer()||(x instanceof i.Konva.Stage?x.getLayers():null);j||t.Util.error("Tween constructor have `node` that is not in a layer. Please add node into layer first."),this.anim=new n.Animation(function(){y.tween.onEnterFrame()},j),this.tween=new f(w,function(E){y._tweenFunc(E)},b,0,1,v*1e3,S),this._addListeners(),p.attrs[C]||(p.attrs[C]={}),p.attrs[C][this._id]||(p.attrs[C][this._id]={}),p.tweens[C]||(p.tweens[C]={});for(w in m)o[w]===void 0&&this._addAttr(w,m[w]);this.reset(),this.onFinish=m.onFinish,this.onReset=m.onReset,this.onUpdate=m.onUpdate}_addAttr(m,y){var x=this.node,C=x._id,v,b,S,w,j,E,A,L;if(S=p.tweens[C][m],S&&delete p.attrs[C][S][m],v=x.getAttr(m),t.Util._isArray(y))if(b=[],j=Math.max(y.length,v.length),m==="points"&&y.length!==v.length&&(y.length>v.length?(A=v,v=t.Util._prepareArrayForTween(v,y,x.closed())):(E=y,y=t.Util._prepareArrayForTween(y,v,x.closed()))),m.indexOf("fill")===0)for(w=0;w<j;w++)if(w%2===0)b.push(y[w]-v[w]);else{var M=t.Util.colorToRGBA(v[w]);L=t.Util.colorToRGBA(y[w]),v[w]=M,b.push({r:L.r-M.r,g:L.g-M.g,b:L.b-M.b,a:L.a-M.a})}else for(w=0;w<j;w++)b.push(y[w]-v[w]);else h.indexOf(m)!==-1?(v=t.Util.colorToRGBA(v),L=t.Util.colorToRGBA(y),b={r:L.r-v.r,g:L.g-v.g,b:L.b-v.b,a:L.a-v.a}):b=y-v;p.attrs[C][this._id][m]={start:v,diff:b,end:y,trueEnd:E,trueStart:A},p.tweens[C][m]=this._id}_tweenFunc(m){var y=this.node,x=p.attrs[y._id][this._id],C,v,b,S,w,j,E,A;for(C in x){if(v=x[C],b=v.start,S=v.diff,A=v.end,t.Util._isArray(b))if(w=[],E=Math.max(b.length,A.length),C.indexOf("fill")===0)for(j=0;j<E;j++)j%2===0?w.push((b[j]||0)+S[j]*m):w.push("rgba("+Math.round(b[j].r+S[j].r*m)+","+Math.round(b[j].g+S[j].g*m)+","+Math.round(b[j].b+S[j].b*m)+","+(b[j].a+S[j].a*m)+")");else for(j=0;j<E;j++)w.push((b[j]||0)+S[j]*m);else h.indexOf(C)!==-1?w="rgba("+Math.round(b.r+S.r*m)+","+Math.round(b.g+S.g*m)+","+Math.round(b.b+S.b*m)+","+(b.a+S.a*m)+")":w=b+S*m;y.setAttr(C,w)}}_addListeners(){this.tween.onPlay=()=>{this.anim.start()},this.tween.onReverse=()=>{this.anim.start()},this.tween.onPause=()=>{this.anim.stop()},this.tween.onFinish=()=>{var m=this.node,y=p.attrs[m._id][this._id];y.points&&y.points.trueEnd&&m.setAttr("points",y.points.trueEnd),this.onFinish&&this.onFinish.call(this)},this.tween.onReset=()=>{var m=this.node,y=p.attrs[m._id][this._id];y.points&&y.points.trueStart&&m.points(y.points.trueStart),this.onReset&&this.onReset()},this.tween.onUpdate=()=>{this.onUpdate&&this.onUpdate.call(this)}}play(){return this.tween.play(),this}reverse(){return this.tween.reverse(),this}reset(){return this.tween.reset(),this}seek(m){return this.tween.seek(m*1e3),this}pause(){return this.tween.pause(),this}finish(){return this.tween.finish(),this}destroy(){var m=this.node._id,y=this._id,x=p.tweens[m],C;this.pause();for(C in x)delete p.tweens[m][C];delete p.attrs[m][y]}}e.Tween=p,p.attrs={},p.tweens={},s.Node.prototype.to=function(g){var m=g.onFinish;g.node=this,g.onFinish=function(){this.destroy(),m&&m()};var y=new p(g);y.play()},e.Easings={BackEaseIn(g,m,y,x){var C=1.70158;return y*(g/=x)*g*((C+1)*g-C)+m},BackEaseOut(g,m,y,x){var C=1.70158;return y*((g=g/x-1)*g*((C+1)*g+C)+1)+m},BackEaseInOut(g,m,y,x){var C=1.70158;return(g/=x/2)<1?y/2*(g*g*(((C*=1.525)+1)*g-C))+m:y/2*((g-=2)*g*(((C*=1.525)+1)*g+C)+2)+m},ElasticEaseIn(g,m,y,x,C,v){var b=0;return g===0?m:(g/=x)===1?m+y:(v||(v=x*.3),!C||C<Math.abs(y)?(C=y,b=v/4):b=v/(2*Math.PI)*Math.asin(y/C),-(C*Math.pow(2,10*(g-=1))*Math.sin((g*x-b)*(2*Math.PI)/v))+m)},ElasticEaseOut(g,m,y,x,C,v){var b=0;return g===0?m:(g/=x)===1?m+y:(v||(v=x*.3),!C||C<Math.abs(y)?(C=y,b=v/4):b=v/(2*Math.PI)*Math.asin(y/C),C*Math.pow(2,-10*g)*Math.sin((g*x-b)*(2*Math.PI)/v)+y+m)},ElasticEaseInOut(g,m,y,x,C,v){var b=0;return g===0?m:(g/=x/2)===2?m+y:(v||(v=x*(.3*1.5)),!C||C<Math.abs(y)?(C=y,b=v/4):b=v/(2*Math.PI)*Math.asin(y/C),g<1?-.5*(C*Math.pow(2,10*(g-=1))*Math.sin((g*x-b)*(2*Math.PI)/v))+m:C*Math.pow(2,-10*(g-=1))*Math.sin((g*x-b)*(2*Math.PI)/v)*.5+y+m)},BounceEaseOut(g,m,y,x){return(g/=x)<1/2.75?y*(7.5625*g*g)+m:g<2/2.75?y*(7.5625*(g-=1.5/2.75)*g+.75)+m:g<2.5/2.75?y*(7.5625*(g-=2.25/2.75)*g+.9375)+m:y*(7.5625*(g-=2.625/2.75)*g+.984375)+m},BounceEaseIn(g,m,y,x){return y-e.Easings.BounceEaseOut(x-g,0,y,x)+m},BounceEaseInOut(g,m,y,x){return g<x/2?e.Easings.BounceEaseIn(g*2,0,y,x)*.5+m:e.Easings.BounceEaseOut(g*2-x,0,y,x)*.5+y*.5+m},EaseIn(g,m,y,x){return y*(g/=x)*g+m},EaseOut(g,m,y,x){return-y*(g/=x)*(g-2)+m},EaseInOut(g,m,y,x){return(g/=x/2)<1?y/2*g*g+m:-y/2*(--g*(g-2)-1)+m},StrongEaseIn(g,m,y,x){return y*(g/=x)*g*g*g*g+m},StrongEaseOut(g,m,y,x){return y*((g=g/x-1)*g*g*g*g+1)+m},StrongEaseInOut(g,m,y,x){return(g/=x/2)<1?y/2*g*g*g*g*g+m:y/2*((g-=2)*g*g*g*g+2)+m},Linear(g,m,y,x){return y*g/x+m}}}(cv)),cv}var Z_;function rie(){return Z_||(Z_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Konva=void 0;const t=yt(),n=_n(),s=Tn(),i=k1(),o=tie(),a=lE(),l=nie(),c=pS(),d=fS(),h=Qn(),f=gS(),p=sie(),g=oE(),m=j1();e.Konva=n.Util._assign(t.Konva,{Util:n.Util,Transform:n.Transform,Node:s.Node,Container:i.Container,Stage:o.Stage,stages:o.stages,Layer:a.Layer,FastLayer:l.FastLayer,Group:c.Group,DD:d.DD,Shape:h.Shape,shapes:h.shapes,Animation:f.Animation,Tween:p.Tween,Easings:p.Easings,Context:g.Context,Canvas:m.Canvas}),e.default=e.Konva}(nv)),nv}var Id={},Y_;function iie(){if(Y_)return Id;Y_=1,Object.defineProperty(Id,"__esModule",{value:!0}),Id.Arc=void 0;const e=vt(),t=Qn(),n=yt(),s=xt(),i=yt();let o=class extends t.Shape{_sceneFunc(l){var c=n.Konva.getAngle(this.angle()),d=this.clockwise();l.beginPath(),l.arc(0,0,this.outerRadius(),0,c,d),l.arc(0,0,this.innerRadius(),c,0,!d),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}getSelfRect(){const l=this.innerRadius(),c=this.outerRadius(),d=this.clockwise(),h=n.Konva.getAngle(d?360-this.angle():this.angle()),f=Math.cos(Math.min(h,Math.PI)),p=1,g=Math.sin(Math.min(Math.max(Math.PI,h),3*Math.PI/2)),m=Math.sin(Math.min(h,Math.PI/2)),y=f*(f>0?l:c),x=p*c,C=g*(g>0?l:c),v=m*(m>0?c:l);return{x:y,y:d?-1*v:C,width:x-y,height:v-C}}};return Id.Arc=o,o.prototype._centroid=!0,o.prototype.className="Arc",o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"innerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"clockwise",!1,(0,s.getBooleanValidator)()),Id}var Ad={},Td={},X_;function cE(){if(X_)return Td;X_=1,Object.defineProperty(Td,"__esModule",{value:!0}),Td.Line=void 0;const e=vt(),t=Qn(),n=xt(),s=yt();function i(l,c,d,h,f,p,g){var m=Math.sqrt(Math.pow(d-l,2)+Math.pow(h-c,2)),y=Math.sqrt(Math.pow(f-d,2)+Math.pow(p-h,2)),x=g*m/(m+y),C=g*y/(m+y),v=d-x*(f-l),b=h-x*(p-c),S=d+C*(f-l),w=h+C*(p-c);return[v,b,S,w]}function o(l,c){var d=l.length,h=[],f,p;for(f=2;f<d-2;f+=2)p=i(l[f-2],l[f-1],l[f],l[f+1],l[f+2],l[f+3],c),!isNaN(p[0])&&(h.push(p[0]),h.push(p[1]),h.push(l[f]),h.push(l[f+1]),h.push(p[2]),h.push(p[3]));return h}let a=class extends t.Shape{constructor(c){super(c),this.on("pointsChange.konva tensionChange.konva closedChange.konva bezierChange.konva",function(){this._clearCache("tensionPoints")})}_sceneFunc(c){var d=this.points(),h=d.length,f=this.tension(),p=this.closed(),g=this.bezier(),m,y,x;if(h){if(c.beginPath(),c.moveTo(d[0],d[1]),f!==0&&h>4){for(m=this.getTensionPoints(),y=m.length,x=p?0:4,p||c.quadraticCurveTo(m[0],m[1],m[2],m[3]);x<y-2;)c.bezierCurveTo(m[x++],m[x++],m[x++],m[x++],m[x++],m[x++]);p||c.quadraticCurveTo(m[y-2],m[y-1],d[h-2],d[h-1])}else if(g)for(x=2;x<h;)c.bezierCurveTo(d[x++],d[x++],d[x++],d[x++],d[x++],d[x++]);else for(x=2;x<h;x+=2)c.lineTo(d[x],d[x+1]);p?(c.closePath(),c.fillStrokeShape(this)):c.strokeShape(this)}}getTensionPoints(){return this._getCache("tensionPoints",this._getTensionPoints)}_getTensionPoints(){return this.closed()?this._getTensionPointsClosed():o(this.points(),this.tension())}_getTensionPointsClosed(){var c=this.points(),d=c.length,h=this.tension(),f=i(c[d-2],c[d-1],c[0],c[1],c[2],c[3],h),p=i(c[d-4],c[d-3],c[d-2],c[d-1],c[0],c[1],h),g=o(c,h),m=[f[2],f[3]].concat(g).concat([p[0],p[1],c[d-2],c[d-1],p[2],p[3],f[0],f[1],c[0],c[1]]);return m}getWidth(){return this.getSelfRect().width}getHeight(){return this.getSelfRect().height}getSelfRect(){var c=this.points();if(c.length<4)return{x:c[0]||0,y:c[1]||0,width:0,height:0};this.tension()!==0?c=[c[0],c[1],...this._getTensionPoints(),c[c.length-2],c[c.length-1]]:c=this.points();for(var d=c[0],h=c[0],f=c[1],p=c[1],g,m,y=0;y<c.length/2;y++)g=c[y*2],m=c[y*2+1],d=Math.min(d,g),h=Math.max(h,g),f=Math.min(f,m),p=Math.max(p,m);return{x:d,y:f,width:h-d,height:p-f}}};return Td.Line=a,a.prototype.className="Line",a.prototype._attrsAffectingSize=["points","bezier","tension"],(0,s._registerNode)(a),e.Factory.addGetterSetter(a,"closed",!1),e.Factory.addGetterSetter(a,"bezier",!1),e.Factory.addGetterSetter(a,"tension",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(a,"points",[],(0,n.getNumberArrayValidator)()),Td}var Md={},uv={},Q_;function oie(){return Q_||(Q_=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.t2length=e.getQuadraticArcLength=e.getCubicArcLength=e.binomialCoefficients=e.cValues=e.tValues=void 0,e.tValues=[[],[],[-.5773502691896257,.5773502691896257],[0,-.7745966692414834,.7745966692414834],[-.33998104358485626,.33998104358485626,-.8611363115940526,.8611363115940526],[0,-.5384693101056831,.5384693101056831,-.906179845938664,.906179845938664],[.6612093864662645,-.6612093864662645,-.2386191860831969,.2386191860831969,-.932469514203152,.932469514203152],[0,.4058451513773972,-.4058451513773972,-.7415311855993945,.7415311855993945,-.9491079123427585,.9491079123427585],[-.1834346424956498,.1834346424956498,-.525532409916329,.525532409916329,-.7966664774136267,.7966664774136267,-.9602898564975363,.9602898564975363],[0,-.8360311073266358,.8360311073266358,-.9681602395076261,.9681602395076261,-.3242534234038089,.3242534234038089,-.6133714327005904,.6133714327005904],[-.14887433898163122,.14887433898163122,-.4333953941292472,.4333953941292472,-.6794095682990244,.6794095682990244,-.8650633666889845,.8650633666889845,-.9739065285171717,.9739065285171717],[0,-.26954315595234496,.26954315595234496,-.5190961292068118,.5190961292068118,-.7301520055740494,.7301520055740494,-.8870625997680953,.8870625997680953,-.978228658146057,.978228658146057],[-.1252334085114689,.1252334085114689,-.3678314989981802,.3678314989981802,-.5873179542866175,.5873179542866175,-.7699026741943047,.7699026741943047,-.9041172563704749,.9041172563704749,-.9815606342467192,.9815606342467192],[0,-.2304583159551348,.2304583159551348,-.44849275103644687,.44849275103644687,-.6423493394403402,.6423493394403402,-.8015780907333099,.8015780907333099,-.9175983992229779,.9175983992229779,-.9841830547185881,.9841830547185881],[-.10805494870734367,.10805494870734367,-.31911236892788974,.31911236892788974,-.5152486363581541,.5152486363581541,-.6872929048116855,.6872929048116855,-.827201315069765,.827201315069765,-.9284348836635735,.9284348836635735,-.9862838086968123,.9862838086968123],[0,-.20119409399743451,.20119409399743451,-.3941513470775634,.3941513470775634,-.5709721726085388,.5709721726085388,-.7244177313601701,.7244177313601701,-.8482065834104272,.8482065834104272,-.937273392400706,.937273392400706,-.9879925180204854,.9879925180204854],[-.09501250983763744,.09501250983763744,-.2816035507792589,.2816035507792589,-.45801677765722737,.45801677765722737,-.6178762444026438,.6178762444026438,-.755404408355003,.755404408355003,-.8656312023878318,.8656312023878318,-.9445750230732326,.9445750230732326,-.9894009349916499,.9894009349916499],[0,-.17848418149584785,.17848418149584785,-.3512317634538763,.3512317634538763,-.5126905370864769,.5126905370864769,-.6576711592166907,.6576711592166907,-.7815140038968014,.7815140038968014,-.8802391537269859,.8802391537269859,-.9506755217687678,.9506755217687678,-.9905754753144174,.9905754753144174],[-.0847750130417353,.0847750130417353,-.2518862256915055,.2518862256915055,-.41175116146284263,.41175116146284263,-.5597708310739475,.5597708310739475,-.6916870430603532,.6916870430603532,-.8037049589725231,.8037049589725231,-.8926024664975557,.8926024664975557,-.9558239495713977,.9558239495713977,-.9915651684209309,.9915651684209309],[0,-.16035864564022537,.16035864564022537,-.31656409996362983,.31656409996362983,-.46457074137596094,.46457074137596094,-.600545304661681,.600545304661681,-.7209661773352294,.7209661773352294,-.8227146565371428,.8227146565371428,-.9031559036148179,.9031559036148179,-.96020815213483,.96020815213483,-.9924068438435844,.9924068438435844],[-.07652652113349734,.07652652113349734,-.22778585114164507,.22778585114164507,-.37370608871541955,.37370608871541955,-.5108670019508271,.5108670019508271,-.636053680726515,.636053680726515,-.7463319064601508,.7463319064601508,-.8391169718222188,.8391169718222188,-.912234428251326,.912234428251326,-.9639719272779138,.9639719272779138,-.9931285991850949,.9931285991850949],[0,-.1455618541608951,.1455618541608951,-.2880213168024011,.2880213168024011,-.4243421202074388,.4243421202074388,-.5516188358872198,.5516188358872198,-.6671388041974123,.6671388041974123,-.7684399634756779,.7684399634756779,-.8533633645833173,.8533633645833173,-.9200993341504008,.9200993341504008,-.9672268385663063,.9672268385663063,-.9937521706203895,.9937521706203895],[-.06973927331972223,.06973927331972223,-.20786042668822127,.20786042668822127,-.34193582089208424,.34193582089208424,-.469355837986757,.469355837986757,-.5876404035069116,.5876404035069116,-.6944872631866827,.6944872631866827,-.7878168059792081,.7878168059792081,-.8658125777203002,.8658125777203002,-.926956772187174,.926956772187174,-.9700604978354287,.9700604978354287,-.9942945854823992,.9942945854823992],[0,-.1332568242984661,.1332568242984661,-.26413568097034495,.26413568097034495,-.3903010380302908,.3903010380302908,-.5095014778460075,.5095014778460075,-.6196098757636461,.6196098757636461,-.7186613631319502,.7186613631319502,-.8048884016188399,.8048884016188399,-.8767523582704416,.8767523582704416,-.9329710868260161,.9329710868260161,-.9725424712181152,.9725424712181152,-.9947693349975522,.9947693349975522],[-.06405689286260563,.06405689286260563,-.1911188674736163,.1911188674736163,-.3150426796961634,.3150426796961634,-.4337935076260451,.4337935076260451,-.5454214713888396,.5454214713888396,-.6480936519369755,.6480936519369755,-.7401241915785544,.7401241915785544,-.820001985973903,.820001985973903,-.8864155270044011,.8864155270044011,-.9382745520027328,.9382745520027328,-.9747285559713095,.9747285559713095,-.9951872199970213,.9951872199970213]],e.cValues=[[],[],[1,1],[.8888888888888888,.5555555555555556,.5555555555555556],[.6521451548625461,.6521451548625461,.34785484513745385,.34785484513745385],[.5688888888888889,.47862867049936647,.47862867049936647,.23692688505618908,.23692688505618908],[.3607615730481386,.3607615730481386,.46791393457269104,.46791393457269104,.17132449237917036,.17132449237917036],[.4179591836734694,.3818300505051189,.3818300505051189,.27970539148927664,.27970539148927664,.1294849661688697,.1294849661688697],[.362683783378362,.362683783378362,.31370664587788727,.31370664587788727,.22238103445337448,.22238103445337448,.10122853629037626,.10122853629037626],[.3302393550012598,.1806481606948574,.1806481606948574,.08127438836157441,.08127438836157441,.31234707704000286,.31234707704000286,.26061069640293544,.26061069640293544],[.29552422471475287,.29552422471475287,.26926671930999635,.26926671930999635,.21908636251598204,.21908636251598204,.1494513491505806,.1494513491505806,.06667134430868814,.06667134430868814],[.2729250867779006,.26280454451024665,.26280454451024665,.23319376459199048,.23319376459199048,.18629021092773426,.18629021092773426,.1255803694649046,.1255803694649046,.05566856711617366,.05566856711617366],[.24914704581340277,.24914704581340277,.2334925365383548,.2334925365383548,.20316742672306592,.20316742672306592,.16007832854334622,.16007832854334622,.10693932599531843,.10693932599531843,.04717533638651183,.04717533638651183],[.2325515532308739,.22628318026289723,.22628318026289723,.2078160475368885,.2078160475368885,.17814598076194574,.17814598076194574,.13887351021978725,.13887351021978725,.09212149983772845,.09212149983772845,.04048400476531588,.04048400476531588],[.2152638534631578,.2152638534631578,.2051984637212956,.2051984637212956,.18553839747793782,.18553839747793782,.15720316715819355,.15720316715819355,.12151857068790319,.12151857068790319,.08015808715976021,.08015808715976021,.03511946033175186,.03511946033175186],[.2025782419255613,.19843148532711158,.19843148532711158,.1861610000155622,.1861610000155622,.16626920581699392,.16626920581699392,.13957067792615432,.13957067792615432,.10715922046717194,.10715922046717194,.07036604748810812,.07036604748810812,.03075324199611727,.03075324199611727],[.1894506104550685,.1894506104550685,.18260341504492358,.18260341504492358,.16915651939500254,.16915651939500254,.14959598881657674,.14959598881657674,.12462897125553388,.12462897125553388,.09515851168249279,.09515851168249279,.062253523938647894,.062253523938647894,.027152459411754096,.027152459411754096],[.17944647035620653,.17656270536699264,.17656270536699264,.16800410215645004,.16800410215645004,.15404576107681028,.15404576107681028,.13513636846852548,.13513636846852548,.11188384719340397,.11188384719340397,.08503614831717918,.08503614831717918,.0554595293739872,.0554595293739872,.02414830286854793,.02414830286854793],[.1691423829631436,.1691423829631436,.16427648374583273,.16427648374583273,.15468467512626524,.15468467512626524,.14064291467065065,.14064291467065065,.12255520671147846,.12255520671147846,.10094204410628717,.10094204410628717,.07642573025488905,.07642573025488905,.0497145488949698,.0497145488949698,.02161601352648331,.02161601352648331],[.1610544498487837,.15896884339395434,.15896884339395434,.15276604206585967,.15276604206585967,.1426067021736066,.1426067021736066,.12875396253933621,.12875396253933621,.11156664554733399,.11156664554733399,.09149002162245,.09149002162245,.06904454273764123,.06904454273764123,.0448142267656996,.0448142267656996,.019461788229726478,.019461788229726478],[.15275338713072584,.15275338713072584,.14917298647260374,.14917298647260374,.14209610931838204,.14209610931838204,.13168863844917664,.13168863844917664,.11819453196151841,.11819453196151841,.10193011981724044,.10193011981724044,.08327674157670475,.08327674157670475,.06267204833410907,.06267204833410907,.04060142980038694,.04060142980038694,.017614007139152118,.017614007139152118],[.14608113364969041,.14452440398997005,.14452440398997005,.13988739479107315,.13988739479107315,.13226893863333747,.13226893863333747,.12183141605372853,.12183141605372853,.10879729916714838,.10879729916714838,.09344442345603386,.09344442345603386,.0761001136283793,.0761001136283793,.057134425426857205,.057134425426857205,.036953789770852494,.036953789770852494,.016017228257774335,.016017228257774335],[.13925187285563198,.13925187285563198,.13654149834601517,.13654149834601517,.13117350478706238,.13117350478706238,.12325237681051242,.12325237681051242,.11293229608053922,.11293229608053922,.10041414444288096,.10041414444288096,.08594160621706773,.08594160621706773,.06979646842452049,.06979646842452049,.052293335152683286,.052293335152683286,.03377490158481415,.03377490158481415,.0146279952982722,.0146279952982722],[.13365457218610619,.1324620394046966,.1324620394046966,.12890572218808216,.12890572218808216,.12304908430672953,.12304908430672953,.11499664022241136,.11499664022241136,.10489209146454141,.10489209146454141,.09291576606003515,.09291576606003515,.07928141177671895,.07928141177671895,.06423242140852585,.06423242140852585,.04803767173108467,.04803767173108467,.030988005856979445,.030988005856979445,.013411859487141771,.013411859487141771],[.12793819534675216,.12793819534675216,.1258374563468283,.1258374563468283,.12167047292780339,.12167047292780339,.1155056680537256,.1155056680537256,.10744427011596563,.10744427011596563,.09761865210411388,.09761865210411388,.08619016153195327,.08619016153195327,.0733464814110803,.0733464814110803,.05929858491543678,.05929858491543678,.04427743881741981,.04427743881741981,.028531388628933663,.028531388628933663,.0123412297999872,.0123412297999872]],e.binomialCoefficients=[[1],[1,1],[1,2,1],[1,3,3,1]];const t=(a,l,c)=>{let d,h,f;d=c/2,h=0;for(let g=0;g<20;g++)f=d*e.tValues[20][g]+d,h+=e.cValues[20][g]*s(a,l,f);return d*h};e.getCubicArcLength=t;const n=(a,l,c)=>{c===void 0&&(c=1);const d=a[0]-2*a[1]+a[2],h=l[0]-2*l[1]+l[2],f=2*a[1]-2*a[0],p=2*l[1]-2*l[0],g=4*(d*d+h*h),m=4*(d*f+h*p),y=f*f+p*p;if(g===0)return c*Math.sqrt(Math.pow(a[2]-a[0],2)+Math.pow(l[2]-l[0],2));const x=m/(2*g),C=y/g,v=c+x,b=C-x*x,S=v*v+b>0?Math.sqrt(v*v+b):0,w=x*x+b>0?Math.sqrt(x*x+b):0,j=x+Math.sqrt(x*x+b)!==0?b*Math.log(Math.abs((v+S)/(x+w))):0;return Math.sqrt(g)/2*(v*S-x*w+j)};e.getQuadraticArcLength=n;function s(a,l,c){const d=i(1,c,a),h=i(1,c,l),f=d*d+h*h;return Math.sqrt(f)}const i=(a,l,c)=>{const d=c.length-1;let h,f;if(d===0)return 0;if(a===0){f=0;for(let p=0;p<=d;p++)f+=e.binomialCoefficients[d][p]*Math.pow(1-l,d-p)*Math.pow(l,p)*c[p];return f}else{h=new Array(d);for(let p=0;p<d;p++)h[p]=d*(c[p+1]-c[p]);return i(a-1,l,h)}},o=(a,l,c)=>{let d=1,h=a/l,f=(a-c(h))/l,p=0;for(;d>.001;){const g=c(h+f),m=Math.abs(a-g)/l;if(m<d)d=m,h+=f;else{const y=c(h-f),x=Math.abs(a-y)/l;x<d?(d=x,h-=f):f/=2}if(p++,p>500)break}return h};e.t2length=o}(uv)),uv}var J_;function mS(){if(J_)return Md;J_=1,Object.defineProperty(Md,"__esModule",{value:!0}),Md.Path=void 0;const e=vt(),t=Qn(),n=yt(),s=oie();let i=class Bs extends t.Shape{constructor(a){super(a),this.dataArray=[],this.pathLength=0,this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute()})}_readDataAttribute(){this.dataArray=Bs.parsePathData(this.data()),this.pathLength=Bs.getPathLength(this.dataArray)}_sceneFunc(a){var l=this.dataArray;a.beginPath();for(var c=!1,d=0;d<l.length;d++){var h=l[d].command,f=l[d].points;switch(h){case"L":a.lineTo(f[0],f[1]);break;case"M":a.moveTo(f[0],f[1]);break;case"C":a.bezierCurveTo(f[0],f[1],f[2],f[3],f[4],f[5]);break;case"Q":a.quadraticCurveTo(f[0],f[1],f[2],f[3]);break;case"A":var p=f[0],g=f[1],m=f[2],y=f[3],x=f[4],C=f[5],v=f[6],b=f[7],S=m>y?m:y,w=m>y?1:m/y,j=m>y?y/m:1;a.translate(p,g),a.rotate(v),a.scale(w,j),a.arc(0,0,S,x,x+C,1-b),a.scale(1/w,1/j),a.rotate(-v),a.translate(-p,-g);break;case"z":c=!0,a.closePath();break}}!c&&!this.hasFill()?a.strokeShape(this):a.fillStrokeShape(this)}getSelfRect(){var a=[];this.dataArray.forEach(function(m){if(m.command==="A"){var y=m.points[4],x=m.points[5],C=m.points[4]+x,v=Math.PI/180;if(Math.abs(y-C)<v&&(v=Math.abs(y-C)),x<0)for(let b=y-v;b>C;b-=v){const S=Bs.getPointOnEllipticalArc(m.points[0],m.points[1],m.points[2],m.points[3],b,0);a.push(S.x,S.y)}else for(let b=y+v;b<C;b+=v){const S=Bs.getPointOnEllipticalArc(m.points[0],m.points[1],m.points[2],m.points[3],b,0);a.push(S.x,S.y)}}else if(m.command==="C")for(let b=0;b<=1;b+=.01){const S=Bs.getPointOnCubicBezier(b,m.start.x,m.start.y,m.points[0],m.points[1],m.points[2],m.points[3],m.points[4],m.points[5]);a.push(S.x,S.y)}else a=a.concat(m.points)});for(var l=a[0],c=a[0],d=a[1],h=a[1],f,p,g=0;g<a.length/2;g++)f=a[g*2],p=a[g*2+1],isNaN(f)||(l=Math.min(l,f),c=Math.max(c,f)),isNaN(p)||(d=Math.min(d,p),h=Math.max(h,p));return{x:l,y:d,width:c-l,height:h-d}}getLength(){return this.pathLength}getPointAtLength(a){return Bs.getPointAtLengthOfDataArray(a,this.dataArray)}static getLineLength(a,l,c,d){return Math.sqrt((c-a)*(c-a)+(d-l)*(d-l))}static getPathLength(a){let l=0;for(var c=0;c<a.length;++c)l+=a[c].pathLength;return l}static getPointAtLengthOfDataArray(a,l){var c,d=0,h=l.length;if(!h)return null;for(;d<h&&a>l[d].pathLength;)a-=l[d].pathLength,++d;if(d===h)return c=l[d-1].points.slice(-2),{x:c[0],y:c[1]};if(a<.01)return c=l[d].points.slice(0,2),{x:c[0],y:c[1]};var f=l[d],p=f.points;switch(f.command){case"L":return Bs.getPointOnLine(a,f.start.x,f.start.y,p[0],p[1]);case"C":return Bs.getPointOnCubicBezier((0,s.t2length)(a,Bs.getPathLength(l),S=>(0,s.getCubicArcLength)([f.start.x,p[0],p[2],p[4]],[f.start.y,p[1],p[3],p[5]],S)),f.start.x,f.start.y,p[0],p[1],p[2],p[3],p[4],p[5]);case"Q":return Bs.getPointOnQuadraticBezier((0,s.t2length)(a,Bs.getPathLength(l),S=>(0,s.getQuadraticArcLength)([f.start.x,p[0],p[2]],[f.start.y,p[1],p[3]],S)),f.start.x,f.start.y,p[0],p[1],p[2],p[3]);case"A":var g=p[0],m=p[1],y=p[2],x=p[3],C=p[4],v=p[5],b=p[6];return C+=v*a/f.pathLength,Bs.getPointOnEllipticalArc(g,m,y,x,C,b)}return null}static getPointOnLine(a,l,c,d,h,f,p){f=f??l,p=p??c;const g=this.getLineLength(l,c,d,h);if(g<1e-10)return{x:l,y:c};if(d===l)return{x:f,y:p+(h>c?a:-a)};const m=(h-c)/(d-l),y=Math.sqrt(a*a/(1+m*m))*(d<l?-1:1),x=m*y;if(Math.abs(p-c-m*(f-l))<1e-10)return{x:f+y,y:p+x};const C=((f-l)*(d-l)+(p-c)*(h-c))/(g*g),v=l+C*(d-l),b=c+C*(h-c),S=this.getLineLength(f,p,v,b),w=Math.sqrt(a*a-S*S),j=Math.sqrt(w*w/(1+m*m))*(d<l?-1:1),E=m*j;return{x:v+j,y:b+E}}static getPointOnCubicBezier(a,l,c,d,h,f,p,g,m){function y(w){return w*w*w}function x(w){return 3*w*w*(1-w)}function C(w){return 3*w*(1-w)*(1-w)}function v(w){return(1-w)*(1-w)*(1-w)}var b=g*y(a)+f*x(a)+d*C(a)+l*v(a),S=m*y(a)+p*x(a)+h*C(a)+c*v(a);return{x:b,y:S}}static getPointOnQuadraticBezier(a,l,c,d,h,f,p){function g(v){return v*v}function m(v){return 2*v*(1-v)}function y(v){return(1-v)*(1-v)}var x=f*g(a)+d*m(a)+l*y(a),C=p*g(a)+h*m(a)+c*y(a);return{x,y:C}}static getPointOnEllipticalArc(a,l,c,d,h,f){var p=Math.cos(f),g=Math.sin(f),m={x:c*Math.cos(h),y:d*Math.sin(h)};return{x:a+(m.x*p-m.y*g),y:l+(m.x*g+m.y*p)}}static parsePathData(a){if(!a)return[];var l=a,c=["m","M","l","L","v","V","h","H","z","Z","c","C","q","Q","t","T","s","S","a","A"];l=l.replace(new RegExp(" ","g"),",");for(var d=0;d<c.length;d++)l=l.replace(new RegExp(c[d],"g"),"|"+c[d]);var h=l.split("|"),f=[],p=[],g=0,m=0,y=/([-+]?((\d+\.\d+)|((\d+)|(\.\d+)))(?:e[-+]?\d+)?)/gi,x;for(d=1;d<h.length;d++){var C=h[d],v=C.charAt(0);for(C=C.slice(1),p.length=0;x=y.exec(C);)p.push(x[0]);for(var b=[],S=0,w=p.length;S<w;S++){if(p[S]==="00"){b.push(0,0);continue}var j=parseFloat(p[S]);isNaN(j)?b.push(0):b.push(j)}for(;b.length>0&&!isNaN(b[0]);){var E="",A=[],L=g,M=m,O,F,_,R,D,$,G,ee,Q,se;switch(v){case"l":g+=b.shift(),m+=b.shift(),E="L",A.push(g,m);break;case"L":g=b.shift(),m=b.shift(),A.push(g,m);break;case"m":var ne=b.shift(),H=b.shift();if(g+=ne,m+=H,E="M",f.length>2&&f[f.length-1].command==="z"){for(var V=f.length-2;V>=0;V--)if(f[V].command==="M"){g=f[V].points[0]+ne,m=f[V].points[1]+H;break}}A.push(g,m),v="l";break;case"M":g=b.shift(),m=b.shift(),E="M",A.push(g,m),v="L";break;case"h":g+=b.shift(),E="L",A.push(g,m);break;case"H":g=b.shift(),E="L",A.push(g,m);break;case"v":m+=b.shift(),E="L",A.push(g,m);break;case"V":m=b.shift(),E="L",A.push(g,m);break;case"C":A.push(b.shift(),b.shift(),b.shift(),b.shift()),g=b.shift(),m=b.shift(),A.push(g,m);break;case"c":A.push(g+b.shift(),m+b.shift(),g+b.shift(),m+b.shift()),g+=b.shift(),m+=b.shift(),E="C",A.push(g,m);break;case"S":F=g,_=m,O=f[f.length-1],O.command==="C"&&(F=g+(g-O.points[2]),_=m+(m-O.points[3])),A.push(F,_,b.shift(),b.shift()),g=b.shift(),m=b.shift(),E="C",A.push(g,m);break;case"s":F=g,_=m,O=f[f.length-1],O.command==="C"&&(F=g+(g-O.points[2]),_=m+(m-O.points[3])),A.push(F,_,g+b.shift(),m+b.shift()),g+=b.shift(),m+=b.shift(),E="C",A.push(g,m);break;case"Q":A.push(b.shift(),b.shift()),g=b.shift(),m=b.shift(),A.push(g,m);break;case"q":A.push(g+b.shift(),m+b.shift()),g+=b.shift(),m+=b.shift(),E="Q",A.push(g,m);break;case"T":F=g,_=m,O=f[f.length-1],O.command==="Q"&&(F=g+(g-O.points[0]),_=m+(m-O.points[1])),g=b.shift(),m=b.shift(),E="Q",A.push(F,_,g,m);break;case"t":F=g,_=m,O=f[f.length-1],O.command==="Q"&&(F=g+(g-O.points[0]),_=m+(m-O.points[1])),g+=b.shift(),m+=b.shift(),E="Q",A.push(F,_,g,m);break;case"A":R=b.shift(),D=b.shift(),$=b.shift(),G=b.shift(),ee=b.shift(),Q=g,se=m,g=b.shift(),m=b.shift(),E="A",A=this.convertEndpointToCenterParameterization(Q,se,g,m,G,ee,R,D,$);break;case"a":R=b.shift(),D=b.shift(),$=b.shift(),G=b.shift(),ee=b.shift(),Q=g,se=m,g+=b.shift(),m+=b.shift(),E="A",A=this.convertEndpointToCenterParameterization(Q,se,g,m,G,ee,R,D,$);break}f.push({command:E||v,points:A,start:{x:L,y:M},pathLength:this.calcLength(L,M,E||v,A)})}(v==="z"||v==="Z")&&f.push({command:"z",points:[],start:void 0,pathLength:0})}return f}static calcLength(a,l,c,d){var h,f,p,g,m=Bs;switch(c){case"L":return m.getLineLength(a,l,d[0],d[1]);case"C":return(0,s.getCubicArcLength)([a,d[0],d[2],d[4]],[l,d[1],d[3],d[5]],1);case"Q":return(0,s.getQuadraticArcLength)([a,d[0],d[2]],[l,d[1],d[3]],1);case"A":h=0;var y=d[4],x=d[5],C=d[4]+x,v=Math.PI/180;if(Math.abs(y-C)<v&&(v=Math.abs(y-C)),f=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],y,0),x<0)for(g=y-v;g>C;g-=v)p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],g,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),f=p;else for(g=y+v;g<C;g+=v)p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],g,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),f=p;return p=m.getPointOnEllipticalArc(d[0],d[1],d[2],d[3],C,0),h+=m.getLineLength(f.x,f.y,p.x,p.y),h}return 0}static convertEndpointToCenterParameterization(a,l,c,d,h,f,p,g,m){var y=m*(Math.PI/180),x=Math.cos(y)*(a-c)/2+Math.sin(y)*(l-d)/2,C=-1*Math.sin(y)*(a-c)/2+Math.cos(y)*(l-d)/2,v=x*x/(p*p)+C*C/(g*g);v>1&&(p*=Math.sqrt(v),g*=Math.sqrt(v));var b=Math.sqrt((p*p*(g*g)-p*p*(C*C)-g*g*(x*x))/(p*p*(C*C)+g*g*(x*x)));h===f&&(b*=-1),isNaN(b)&&(b=0);var S=b*p*C/g,w=b*-g*x/p,j=(a+c)/2+Math.cos(y)*S-Math.sin(y)*w,E=(l+d)/2+Math.sin(y)*S+Math.cos(y)*w,A=function(D){return Math.sqrt(D[0]*D[0]+D[1]*D[1])},L=function(D,$){return(D[0]*$[0]+D[1]*$[1])/(A(D)*A($))},M=function(D,$){return(D[0]*$[1]<D[1]*$[0]?-1:1)*Math.acos(L(D,$))},O=M([1,0],[(x-S)/p,(C-w)/g]),F=[(x-S)/p,(C-w)/g],_=[(-1*x-S)/p,(-1*C-w)/g],R=M(F,_);return L(F,_)<=-1&&(R=Math.PI),L(F,_)>=1&&(R=0),f===0&&R>0&&(R=R-2*Math.PI),f===1&&R<0&&(R=R+2*Math.PI),[j,E,p,g,O,R,y,f]}};return Md.Path=i,i.prototype.className="Path",i.prototype._attrsAffectingSize=["data"],(0,n._registerNode)(i),e.Factory.addGetterSetter(i,"data"),Md}var e4;function aie(){if(e4)return Ad;e4=1,Object.defineProperty(Ad,"__esModule",{value:!0}),Ad.Arrow=void 0;const e=vt(),t=cE(),n=xt(),s=yt(),i=mS();let o=class extends t.Line{_sceneFunc(l){super._sceneFunc(l);var c=Math.PI*2,d=this.points(),h=d,f=this.tension()!==0&&d.length>4;f&&(h=this.getTensionPoints());var p=this.pointerLength(),g=d.length,m,y;if(f){const v=[h[h.length-4],h[h.length-3],h[h.length-2],h[h.length-1],d[g-2],d[g-1]],b=i.Path.calcLength(h[h.length-4],h[h.length-3],"C",v),S=i.Path.getPointOnQuadraticBezier(Math.min(1,1-p/b),v[0],v[1],v[2],v[3],v[4],v[5]);m=d[g-2]-S.x,y=d[g-1]-S.y}else m=d[g-2]-d[g-4],y=d[g-1]-d[g-3];var x=(Math.atan2(y,m)+c)%c,C=this.pointerWidth();this.pointerAtEnding()&&(l.save(),l.beginPath(),l.translate(d[g-2],d[g-1]),l.rotate(x),l.moveTo(0,0),l.lineTo(-p,C/2),l.lineTo(-p,-C/2),l.closePath(),l.restore(),this.__fillStroke(l)),this.pointerAtBeginning()&&(l.save(),l.beginPath(),l.translate(d[0],d[1]),f?(m=(h[0]+h[2])/2-d[0],y=(h[1]+h[3])/2-d[1]):(m=d[2]-d[0],y=d[3]-d[1]),l.rotate((Math.atan2(-y,-m)+c)%c),l.moveTo(0,0),l.lineTo(-p,C/2),l.lineTo(-p,-C/2),l.closePath(),l.restore(),this.__fillStroke(l))}__fillStroke(l){var c=this.dashEnabled();c&&(this.attrs.dashEnabled=!1,l.setLineDash([])),l.fillStrokeShape(this),c&&(this.attrs.dashEnabled=!0)}getSelfRect(){const l=super.getSelfRect(),c=this.pointerWidth()/2;return{x:l.x-c,y:l.y-c,width:l.width+c*2,height:l.height+c*2}}};return Ad.Arrow=o,o.prototype.className="Arrow",(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"pointerLength",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"pointerWidth",10,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"pointerAtBeginning",!1),e.Factory.addGetterSetter(o,"pointerAtEnding",!0),Ad}var Pd={},t4;function lie(){if(t4)return Pd;t4=1,Object.defineProperty(Pd,"__esModule",{value:!0}),Pd.Circle=void 0;const e=vt(),t=Qn(),n=xt(),s=yt();let i=class extends t.Shape{_sceneFunc(a){a.beginPath(),a.arc(0,0,this.attrs.radius||0,0,Math.PI*2,!1),a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(a){this.radius()!==a/2&&this.radius(a/2)}setHeight(a){this.radius()!==a/2&&this.radius(a/2)}};return Pd.Circle=i,i.prototype._centroid=!0,i.prototype.className="Circle",i.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"radius",0,(0,n.getNumberValidator)()),Pd}var Ed={},n4;function cie(){if(n4)return Ed;n4=1,Object.defineProperty(Ed,"__esModule",{value:!0}),Ed.Ellipse=void 0;const e=vt(),t=Qn(),n=xt(),s=yt();let i=class extends t.Shape{_sceneFunc(a){var l=this.radiusX(),c=this.radiusY();a.beginPath(),a.save(),l!==c&&a.scale(1,c/l),a.arc(0,0,l,0,Math.PI*2,!1),a.restore(),a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.radiusX()*2}getHeight(){return this.radiusY()*2}setWidth(a){this.radiusX(a/2)}setHeight(a){this.radiusY(a/2)}};return Ed.Ellipse=i,i.prototype.className="Ellipse",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radiusX","radiusY"],(0,s._registerNode)(i),e.Factory.addComponentsGetterSetter(i,"radius",["x","y"]),e.Factory.addGetterSetter(i,"radiusX",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"radiusY",0,(0,n.getNumberValidator)()),Ed}var Ld={},s4;function uie(){if(s4)return Ld;s4=1,Object.defineProperty(Ld,"__esModule",{value:!0}),Ld.Image=void 0;const e=_n(),t=vt(),n=Qn(),s=yt(),i=xt();class o extends n.Shape{constructor(l){super(l),this.on("imageChange.konva",()=>{this._setImageLoad()}),this._setImageLoad()}_setImageLoad(){const l=this.image();l&&l.complete||l&&l.readyState===4||l&&l.addEventListener&&l.addEventListener("load",()=>{this._requestDraw()})}_useBufferCanvas(){const l=!!this.cornerRadius(),c=this.hasShadow();return l&&c?!0:super._useBufferCanvas(!0)}_sceneFunc(l){const c=this.getWidth(),d=this.getHeight(),h=this.cornerRadius(),f=this.attrs.image;let p;if(f){const g=this.attrs.cropWidth,m=this.attrs.cropHeight;g&&m?p=[f,this.cropX(),this.cropY(),g,m,0,0,c,d]:p=[f,0,0,c,d]}(this.hasFill()||this.hasStroke()||h)&&(l.beginPath(),h?e.Util.drawRoundedRectPath(l,c,d,h):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)),f&&(h&&l.clip(),l.drawImage.apply(l,p))}_hitFunc(l){var c=this.width(),d=this.height(),h=this.cornerRadius();l.beginPath(),h?e.Util.drawRoundedRectPath(l,c,d,h):l.rect(0,0,c,d),l.closePath(),l.fillStrokeShape(this)}getWidth(){var l,c;return(l=this.attrs.width)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.width}getHeight(){var l,c;return(l=this.attrs.height)!==null&&l!==void 0?l:(c=this.image())===null||c===void 0?void 0:c.height}static fromURL(l,c,d=null){var h=e.Util.createImageElement();h.onload=function(){var f=new o({image:h});c(f)},h.onerror=d,h.crossOrigin="Anonymous",h.src=l}}return Ld.Image=o,o.prototype.className="Image",(0,s._registerNode)(o),t.Factory.addGetterSetter(o,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),t.Factory.addGetterSetter(o,"image"),t.Factory.addComponentsGetterSetter(o,"crop",["x","y","width","height"]),t.Factory.addGetterSetter(o,"cropX",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropY",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropWidth",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(o,"cropHeight",0,(0,i.getNumberValidator)()),Ld}var Wa={},r4;function die(){if(r4)return Wa;r4=1,Object.defineProperty(Wa,"__esModule",{value:!0}),Wa.Tag=Wa.Label=void 0;const e=vt(),t=Qn(),n=pS(),s=xt(),i=yt();var o=["fontFamily","fontSize","fontStyle","padding","lineHeight","text","width","height","pointerDirection","pointerWidth","pointerHeight"],a="Change.konva",l="none",c="up",d="right",h="down",f="left",p=o.length;let g=class extends n.Group{constructor(x){super(x),this.on("add.konva",function(C){this._addListeners(C.child),this._sync()})}getText(){return this.find("Text")[0]}getTag(){return this.find("Tag")[0]}_addListeners(x){var C=this,v,b=function(){C._sync()};for(v=0;v<p;v++)x.on(o[v]+a,b)}getWidth(){return this.getText().width()}getHeight(){return this.getText().height()}_sync(){var x=this.getText(),C=this.getTag(),v,b,S,w,j,E,A;if(x&&C){switch(v=x.width(),b=x.height(),S=C.pointerDirection(),w=C.pointerWidth(),A=C.pointerHeight(),j=0,E=0,S){case c:j=v/2,E=-1*A;break;case d:j=v+w,E=b/2;break;case h:j=v/2,E=b+A;break;case f:j=-1*w,E=b/2;break}C.setAttrs({x:-1*j,y:-1*E,width:v,height:b}),x.setAttrs({x:-1*j,y:-1*E})}}};Wa.Label=g,g.prototype.className="Label",(0,i._registerNode)(g);class m extends t.Shape{_sceneFunc(x){var C=this.width(),v=this.height(),b=this.pointerDirection(),S=this.pointerWidth(),w=this.pointerHeight(),j=this.cornerRadius();let E=0,A=0,L=0,M=0;typeof j=="number"?E=A=L=M=Math.min(j,C/2,v/2):(E=Math.min(j[0]||0,C/2,v/2),A=Math.min(j[1]||0,C/2,v/2),M=Math.min(j[2]||0,C/2,v/2),L=Math.min(j[3]||0,C/2,v/2)),x.beginPath(),x.moveTo(E,0),b===c&&(x.lineTo((C-S)/2,0),x.lineTo(C/2,-1*w),x.lineTo((C+S)/2,0)),x.lineTo(C-A,0),x.arc(C-A,A,A,Math.PI*3/2,0,!1),b===d&&(x.lineTo(C,(v-w)/2),x.lineTo(C+S,v/2),x.lineTo(C,(v+w)/2)),x.lineTo(C,v-M),x.arc(C-M,v-M,M,0,Math.PI/2,!1),b===h&&(x.lineTo((C+S)/2,v),x.lineTo(C/2,v+w),x.lineTo((C-S)/2,v)),x.lineTo(L,v),x.arc(L,v-L,L,Math.PI/2,Math.PI,!1),b===f&&(x.lineTo(0,(v+w)/2),x.lineTo(-1*S,v/2),x.lineTo(0,(v-w)/2)),x.lineTo(0,E),x.arc(E,E,E,Math.PI,Math.PI*3/2,!1),x.closePath(),x.fillStrokeShape(this)}getSelfRect(){var x=0,C=0,v=this.pointerWidth(),b=this.pointerHeight(),S=this.pointerDirection(),w=this.width(),j=this.height();return S===c?(C-=b,j+=b):S===h?j+=b:S===f?(x-=v*1.5,w+=v):S===d&&(w+=v*1.5),{x,y:C,width:w,height:j}}}return Wa.Tag=m,m.prototype.className="Tag",(0,i._registerNode)(m),e.Factory.addGetterSetter(m,"pointerDirection",l),e.Factory.addGetterSetter(m,"pointerWidth",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(m,"pointerHeight",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(m,"cornerRadius",0,(0,s.getNumberOrArrayOfNumbersValidator)(4)),Wa}var Dd={},i4;function uE(){if(i4)return Dd;i4=1,Object.defineProperty(Dd,"__esModule",{value:!0}),Dd.Rect=void 0;const e=vt(),t=Qn(),n=yt(),s=_n(),i=xt();let o=class extends t.Shape{_sceneFunc(l){var c=this.cornerRadius(),d=this.width(),h=this.height();l.beginPath(),c?s.Util.drawRoundedRectPath(l,d,h,c):l.rect(0,0,d,h),l.closePath(),l.fillStrokeShape(this)}};return Dd.Rect=o,o.prototype.className="Rect",(0,n._registerNode)(o),e.Factory.addGetterSetter(o,"cornerRadius",0,(0,i.getNumberOrArrayOfNumbersValidator)(4)),Dd}var Rd={},o4;function hie(){if(o4)return Rd;o4=1,Object.defineProperty(Rd,"__esModule",{value:!0}),Rd.RegularPolygon=void 0;const e=vt(),t=Qn(),n=xt(),s=yt();let i=class extends t.Shape{_sceneFunc(a){const l=this._getPoints();a.beginPath(),a.moveTo(l[0].x,l[0].y);for(var c=1;c<l.length;c++)a.lineTo(l[c].x,l[c].y);a.closePath(),a.fillStrokeShape(this)}_getPoints(){const a=this.attrs.sides,l=this.attrs.radius||0,c=[];for(var d=0;d<a;d++)c.push({x:l*Math.sin(d*2*Math.PI/a),y:-1*l*Math.cos(d*2*Math.PI/a)});return c}getSelfRect(){const a=this._getPoints();var l=a[0].x,c=a[0].y,d=a[0].x,h=a[0].y;return a.forEach(f=>{l=Math.min(l,f.x),c=Math.max(c,f.x),d=Math.min(d,f.y),h=Math.max(h,f.y)}),{x:l,y:d,width:c-l,height:h-d}}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(a){this.radius(a/2)}setHeight(a){this.radius(a/2)}};return Rd.RegularPolygon=i,i.prototype.className="RegularPolygon",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["radius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"radius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"sides",0,(0,n.getNumberValidator)()),Rd}var Od={},a4;function fie(){if(a4)return Od;a4=1,Object.defineProperty(Od,"__esModule",{value:!0}),Od.Ring=void 0;const e=vt(),t=Qn(),n=xt(),s=yt();var i=Math.PI*2;let o=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.innerRadius(),0,i,!1),l.moveTo(this.outerRadius(),0),l.arc(0,0,this.outerRadius(),i,0,!0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(l){this.outerRadius(l/2)}setHeight(l){this.outerRadius(l/2)}};return Od.Ring=o,o.prototype.className="Ring",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(o),e.Factory.addGetterSetter(o,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(o,"outerRadius",0,(0,n.getNumberValidator)()),Od}var Nd={},l4;function pie(){if(l4)return Nd;l4=1,Object.defineProperty(Nd,"__esModule",{value:!0}),Nd.Sprite=void 0;const e=vt(),t=Qn(),n=gS(),s=xt(),i=yt();let o=class extends t.Shape{constructor(l){super(l),this._updated=!0,this.anim=new n.Animation(()=>{var c=this._updated;return this._updated=!1,c}),this.on("animationChange.konva",function(){this.frameIndex(0)}),this.on("frameIndexChange.konva",function(){this._updated=!0}),this.on("frameRateChange.konva",function(){this.anim.isRunning()&&(clearInterval(this.interval),this._setInterval())})}_sceneFunc(l){var c=this.animation(),d=this.frameIndex(),h=d*4,f=this.animations()[c],p=this.frameOffsets(),g=f[h+0],m=f[h+1],y=f[h+2],x=f[h+3],C=this.image();if((this.hasFill()||this.hasStroke())&&(l.beginPath(),l.rect(0,0,y,x),l.closePath(),l.fillStrokeShape(this)),C)if(p){var v=p[c],b=d*2;l.drawImage(C,g,m,y,x,v[b+0],v[b+1],y,x)}else l.drawImage(C,g,m,y,x,0,0,y,x)}_hitFunc(l){var c=this.animation(),d=this.frameIndex(),h=d*4,f=this.animations()[c],p=this.frameOffsets(),g=f[h+2],m=f[h+3];if(l.beginPath(),p){var y=p[c],x=d*2;l.rect(y[x+0],y[x+1],g,m)}else l.rect(0,0,g,m);l.closePath(),l.fillShape(this)}_useBufferCanvas(){return super._useBufferCanvas(!0)}_setInterval(){var l=this;this.interval=setInterval(function(){l._updateIndex()},1e3/this.frameRate())}start(){if(!this.isRunning()){var l=this.getLayer();this.anim.setLayers(l),this._setInterval(),this.anim.start()}}stop(){this.anim.stop(),clearInterval(this.interval)}isRunning(){return this.anim.isRunning()}_updateIndex(){var l=this.frameIndex(),c=this.animation(),d=this.animations(),h=d[c],f=h.length/4;l<f-1?this.frameIndex(l+1):this.frameIndex(0)}};return Nd.Sprite=o,o.prototype.className="Sprite",(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"animation"),e.Factory.addGetterSetter(o,"animations"),e.Factory.addGetterSetter(o,"frameOffsets"),e.Factory.addGetterSetter(o,"image"),e.Factory.addGetterSetter(o,"frameIndex",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"frameRate",17,(0,s.getNumberValidator)()),e.Factory.backCompat(o,{index:"frameIndex",getIndex:"getFrameIndex",setIndex:"setFrameIndex"}),Nd}var Fd={},c4;function gie(){if(c4)return Fd;c4=1,Object.defineProperty(Fd,"__esModule",{value:!0}),Fd.Star=void 0;const e=vt(),t=Qn(),n=xt(),s=yt();let i=class extends t.Shape{_sceneFunc(a){var l=this.innerRadius(),c=this.outerRadius(),d=this.numPoints();a.beginPath(),a.moveTo(0,0-c);for(var h=1;h<d*2;h++){var f=h%2===0?c:l,p=f*Math.sin(h*Math.PI/d),g=-1*f*Math.cos(h*Math.PI/d);a.lineTo(p,g)}a.closePath(),a.fillStrokeShape(this)}getWidth(){return this.outerRadius()*2}getHeight(){return this.outerRadius()*2}setWidth(a){this.outerRadius(a/2)}setHeight(a){this.outerRadius(a/2)}};return Fd.Star=i,i.prototype.className="Star",i.prototype._centroid=!0,i.prototype._attrsAffectingSize=["innerRadius","outerRadius"],(0,s._registerNode)(i),e.Factory.addGetterSetter(i,"numPoints",5,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"innerRadius",0,(0,n.getNumberValidator)()),e.Factory.addGetterSetter(i,"outerRadius",0,(0,n.getNumberValidator)()),Fd}var Ua={},u4;function dE(){if(u4)return Ua;u4=1,Object.defineProperty(Ua,"__esModule",{value:!0}),Ua.Text=Ua.stringToArray=void 0;const e=_n(),t=vt(),n=Qn(),s=yt(),i=xt(),o=yt();function a(H){return[...H].reduce((V,Y,W,J)=>(new RegExp("\\p{Emoji_Modifier_Base}\\p{Emoji_Modifier}?(?:\\u200D\\p{Emoji_Presentation})+","u").test(Y)?V.push(Y):new RegExp("\\p{Regional_Indicator}{2}","u").test(Y+(J[W+1]||""))?V.push(Y+J[W+1]):W>0&&new RegExp("\\p{Mn}|\\p{Me}|\\p{Mc}","u").test(Y)?V[V.length-1]+=Y:V.push(Y),V),[])}Ua.stringToArray=a;var l="auto",c="center",d="inherit",h="justify",f="Change.konva",p="2d",g="-",m="left",y="text",x="Text",C="top",v="bottom",b="middle",S="normal",w="px ",j=" ",E="right",A="rtl",L="word",M="char",O="none",F="…",_=["direction","fontFamily","fontSize","fontStyle","fontVariant","padding","align","verticalAlign","lineHeight","text","width","height","wrap","ellipsis","letterSpacing"],R=_.length;function D(H){return H.split(",").map(V=>{V=V.trim();const Y=V.indexOf(" ")>=0,W=V.indexOf('"')>=0||V.indexOf("'")>=0;return Y&&!W&&(V=`"${V}"`),V}).join(", ")}var $;function G(){return $||($=e.Util.createCanvasElement().getContext(p),$)}function ee(H){H.fillText(this._partialText,this._partialTextX,this._partialTextY)}function Q(H){H.setAttr("miterLimit",2),H.strokeText(this._partialText,this._partialTextX,this._partialTextY)}function se(H){return H=H||{},!H.fillLinearGradientColorStops&&!H.fillRadialGradientColorStops&&!H.fillPatternImage&&(H.fill=H.fill||"black"),H}let ne=class extends n.Shape{constructor(V){super(se(V)),this._partialTextX=0,this._partialTextY=0;for(var Y=0;Y<R;Y++)this.on(_[Y]+f,this._setTextData);this._setTextData()}_sceneFunc(V){var Y=this.textArr,W=Y.length;if(this.text()){var J=this.padding(),N=this.fontSize(),B=this.lineHeight()*N,U=this.verticalAlign(),ie=this.direction(),ue=0,be=this.align(),Te=this.getWidth(),je=this.letterSpacing(),Be=this.fill(),Ze=this.textDecoration(),De=Ze.indexOf("underline")!==-1,q=Ze.indexOf("line-through")!==-1,re;ie=ie===d?V.direction:ie;var oe=B/2,xe=b;if(s.Konva._fixTextRendering){var ge=this.measureSize("M");xe="alphabetic",oe=(ge.fontBoundingBoxAscent-ge.fontBoundingBoxDescent)/2+B/2}var de=0,le=0;for(ie===A&&V.setAttr("direction",ie),V.setAttr("font",this._getContextFont()),V.setAttr("textBaseline",xe),V.setAttr("textAlign",m),U===b?ue=(this.getHeight()-W*B-J*2)/2:U===v&&(ue=this.getHeight()-W*B-J*2),V.translate(J,ue+J),re=0;re<W;re++){var de=0,le=0,Se=Y[re],Ge=Se.text,Ye=Se.width,dt=Se.lastInParagraph,fn,ln,pn;if(V.save(),be===E?de+=Te-Ye-J*2:be===c&&(de+=(Te-Ye-J*2)/2),De){V.save(),V.beginPath();let cs=s.Konva._fixTextRendering?Math.round(N/4):Math.round(N/2);const Ns=de,ii=oe+le+cs;V.moveTo(Ns,ii),fn=Ge.split(" ").length-1,ln=fn===0,pn=be===h&&!dt?Te-J*2:Ye,V.lineTo(Ns+Math.round(pn),ii),V.lineWidth=N/15;const ac=this._getLinearGradient();V.strokeStyle=ac||Be,V.stroke(),V.restore()}if(q){V.save(),V.beginPath();let cs=s.Konva._fixTextRendering?-Math.round(N/4):0;V.moveTo(de,oe+le+cs),fn=Ge.split(" ").length-1,ln=fn===0,pn=be===h&&dt&&!ln?Te-J*2:Ye,V.lineTo(de+Math.round(pn),oe+le+cs),V.lineWidth=N/15;const Ns=this._getLinearGradient();V.strokeStyle=Ns||Be,V.stroke(),V.restore()}if(ie!==A&&(je!==0||be===h)){fn=Ge.split(" ").length-1;for(var Jn=a(Ge),js=0;js<Jn.length;js++){var gn=Jn[js];gn===" "&&!dt&&be===h&&(de+=(Te-J*2-Ye)/fn),this._partialTextX=de,this._partialTextY=oe+le,this._partialText=gn,V.fillStrokeShape(this),de+=this.measureSize(gn).width+je}}else je!==0&&V.setAttr("letterSpacing",`${je}px`),this._partialTextX=de,this._partialTextY=oe+le,this._partialText=Ge,V.fillStrokeShape(this);V.restore(),W>1&&(oe+=B)}}}_hitFunc(V){var Y=this.getWidth(),W=this.getHeight();V.beginPath(),V.rect(0,0,Y,W),V.closePath(),V.fillStrokeShape(this)}setText(V){var Y=e.Util._isString(V)?V:V==null?"":V+"";return this._setAttr(y,Y),this}getWidth(){var V=this.attrs.width===l||this.attrs.width===void 0;return V?this.getTextWidth()+this.padding()*2:this.attrs.width}getHeight(){var V=this.attrs.height===l||this.attrs.height===void 0;return V?this.fontSize()*this.textArr.length*this.lineHeight()+this.padding()*2:this.attrs.height}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}measureSize(V){var Y,W,J,N,B,U,ie,ue,be,Te,je,Be=G(),Ze=this.fontSize(),De;Be.save(),Be.font=this._getContextFont(),De=Be.measureText(V),Be.restore();const q=Ze/100;return{actualBoundingBoxAscent:(Y=De.actualBoundingBoxAscent)!==null&&Y!==void 0?Y:71.58203125*q,actualBoundingBoxDescent:(W=De.actualBoundingBoxDescent)!==null&&W!==void 0?W:0,actualBoundingBoxLeft:(J=De.actualBoundingBoxLeft)!==null&&J!==void 0?J:-7.421875*q,actualBoundingBoxRight:(N=De.actualBoundingBoxRight)!==null&&N!==void 0?N:75.732421875*q,alphabeticBaseline:(B=De.alphabeticBaseline)!==null&&B!==void 0?B:0,emHeightAscent:(U=De.emHeightAscent)!==null&&U!==void 0?U:100*q,emHeightDescent:(ie=De.emHeightDescent)!==null&&ie!==void 0?ie:-20*q,fontBoundingBoxAscent:(ue=De.fontBoundingBoxAscent)!==null&&ue!==void 0?ue:91*q,fontBoundingBoxDescent:(be=De.fontBoundingBoxDescent)!==null&&be!==void 0?be:21*q,hangingBaseline:(Te=De.hangingBaseline)!==null&&Te!==void 0?Te:72.80000305175781*q,ideographicBaseline:(je=De.ideographicBaseline)!==null&&je!==void 0?je:-21*q,width:De.width,height:Ze}}_getContextFont(){return this.fontStyle()+j+this.fontVariant()+j+(this.fontSize()+w)+D(this.fontFamily())}_addTextLine(V){this.align()===h&&(V=V.trim());var W=this._getTextWidth(V);return this.textArr.push({text:V,width:W,lastInParagraph:!1})}_getTextWidth(V){var Y=this.letterSpacing(),W=V.length;return G().measureText(V).width+(W?Y*(W-1):0)}_setTextData(){var V=this.text().split(`
`),Y=+this.fontSize(),W=0,J=this.lineHeight()*Y,N=this.attrs.width,B=this.attrs.height,U=N!==l&&N!==void 0,ie=B!==l&&B!==void 0,ue=this.padding(),be=N-ue*2,Te=B-ue*2,je=0,Be=this.wrap(),Ze=Be!==O,De=Be!==M&&Ze,q=this.ellipsis();this.textArr=[],G().font=this._getContextFont();for(var re=q?this._getTextWidth(F):0,oe=0,xe=V.length;oe<xe;++oe){var ge=V[oe],de=this._getTextWidth(ge);if(U&&de>be)for(;ge.length>0;){for(var le=0,Se=ge.length,Ge="",Ye=0;le<Se;){var dt=le+Se>>>1,fn=ge.slice(0,dt+1),ln=this._getTextWidth(fn)+re;ln<=be?(le=dt+1,Ge=fn,Ye=ln):Se=dt}if(Ge){if(De){var pn,Jn=ge[Ge.length],js=Jn===j||Jn===g;js&&Ye<=be?pn=Ge.length:pn=Math.max(Ge.lastIndexOf(j),Ge.lastIndexOf(g))+1,pn>0&&(le=pn,Ge=Ge.slice(0,le),Ye=this._getTextWidth(Ge))}Ge=Ge.trimRight(),this._addTextLine(Ge),W=Math.max(W,Ye),je+=J;var gn=this._shouldHandleEllipsis(je);if(gn){this._tryToAddEllipsisToLastLine();break}if(ge=ge.slice(le),ge=ge.trimLeft(),ge.length>0&&(de=this._getTextWidth(ge),de<=be)){this._addTextLine(ge),je+=J,W=Math.max(W,de);break}}else break}else this._addTextLine(ge),je+=J,W=Math.max(W,de),this._shouldHandleEllipsis(je)&&oe<xe-1&&this._tryToAddEllipsisToLastLine();if(this.textArr[this.textArr.length-1]&&(this.textArr[this.textArr.length-1].lastInParagraph=!0),ie&&je+J>Te)break}this.textHeight=Y,this.textWidth=W}_shouldHandleEllipsis(V){var Y=+this.fontSize(),W=this.lineHeight()*Y,J=this.attrs.height,N=J!==l&&J!==void 0,B=this.padding(),U=J-B*2,ie=this.wrap(),ue=ie!==O;return!ue||N&&V+W>U}_tryToAddEllipsisToLastLine(){var V=this.attrs.width,Y=V!==l&&V!==void 0,W=this.padding(),J=V-W*2,N=this.ellipsis(),B=this.textArr[this.textArr.length-1];if(!(!B||!N)){if(Y){var U=this._getTextWidth(B.text+F)<J;U||(B.text=B.text.slice(0,B.text.length-3))}this.textArr.splice(this.textArr.length-1,1),this._addTextLine(B.text+F)}}getStrokeScaleEnabled(){return!0}_useBufferCanvas(){const V=this.textDecoration().indexOf("underline")!==-1||this.textDecoration().indexOf("line-through")!==-1,Y=this.hasShadow();return V&&Y?!0:super._useBufferCanvas()}};return Ua.Text=ne,ne.prototype._fillFunc=ee,ne.prototype._strokeFunc=Q,ne.prototype.className=x,ne.prototype._attrsAffectingSize=["text","fontSize","padding","wrap","lineHeight","letterSpacing"],(0,o._registerNode)(ne),t.Factory.overWriteSetter(ne,"width",(0,i.getNumberOrAutoValidator)()),t.Factory.overWriteSetter(ne,"height",(0,i.getNumberOrAutoValidator)()),t.Factory.addGetterSetter(ne,"direction",d),t.Factory.addGetterSetter(ne,"fontFamily","Arial"),t.Factory.addGetterSetter(ne,"fontSize",12,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(ne,"fontStyle",S),t.Factory.addGetterSetter(ne,"fontVariant",S),t.Factory.addGetterSetter(ne,"padding",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(ne,"align",m),t.Factory.addGetterSetter(ne,"verticalAlign",C),t.Factory.addGetterSetter(ne,"lineHeight",1,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(ne,"wrap",L),t.Factory.addGetterSetter(ne,"ellipsis",!1,(0,i.getBooleanValidator)()),t.Factory.addGetterSetter(ne,"letterSpacing",0,(0,i.getNumberValidator)()),t.Factory.addGetterSetter(ne,"text","",(0,i.getStringValidator)()),t.Factory.addGetterSetter(ne,"textDecoration",""),Ua}var Bd={},d4;function mie(){if(d4)return Bd;d4=1,Object.defineProperty(Bd,"__esModule",{value:!0}),Bd.TextPath=void 0;const e=_n(),t=vt(),n=Qn(),s=mS(),i=dE(),o=xt(),a=yt();var l="",c="normal";function d(p){p.fillText(this.partialText,0,0)}function h(p){p.strokeText(this.partialText,0,0)}let f=class extends n.Shape{constructor(g){super(g),this.dummyCanvas=e.Util.createCanvasElement(),this.dataArray=[],this._readDataAttribute(),this.on("dataChange.konva",function(){this._readDataAttribute(),this._setTextData()}),this.on("textChange.konva alignChange.konva letterSpacingChange.konva kerningFuncChange.konva fontSizeChange.konva fontFamilyChange.konva",this._setTextData),this._setTextData()}_getTextPathLength(){return s.Path.getPathLength(this.dataArray)}_getPointAtLength(g){if(!this.attrs.data)return null;const m=this.pathLength;return g-1>m?null:s.Path.getPointAtLengthOfDataArray(g,this.dataArray)}_readDataAttribute(){this.dataArray=s.Path.parsePathData(this.attrs.data),this.pathLength=this._getTextPathLength()}_sceneFunc(g){g.setAttr("font",this._getContextFont()),g.setAttr("textBaseline",this.textBaseline()),g.setAttr("textAlign","left"),g.save();var m=this.textDecoration(),y=this.fill(),x=this.fontSize(),C=this.glyphInfo;m==="underline"&&g.beginPath();for(var v=0;v<C.length;v++){g.save();var b=C[v].p0;g.translate(b.x,b.y),g.rotate(C[v].rotation),this.partialText=C[v].text,g.fillStrokeShape(this),m==="underline"&&(v===0&&g.moveTo(0,x/2+1),g.lineTo(x,x/2+1)),g.restore()}m==="underline"&&(g.strokeStyle=y,g.lineWidth=x/20,g.stroke()),g.restore()}_hitFunc(g){g.beginPath();var m=this.glyphInfo;if(m.length>=1){var y=m[0].p0;g.moveTo(y.x,y.y)}for(var x=0;x<m.length;x++){var C=m[x].p1;g.lineTo(C.x,C.y)}g.setAttr("lineWidth",this.fontSize()),g.setAttr("strokeStyle",this.colorKey),g.stroke()}getTextWidth(){return this.textWidth}getTextHeight(){return e.Util.warn("text.getTextHeight() method is deprecated. Use text.height() - for full height and text.fontSize() - for one line height."),this.textHeight}setText(g){return i.Text.prototype.setText.call(this,g)}_getContextFont(){return i.Text.prototype._getContextFont.call(this)}_getTextSize(g){var m=this.dummyCanvas,y=m.getContext("2d");y.save(),y.font=this._getContextFont();var x=y.measureText(g);return y.restore(),{width:x.width,height:parseInt(`${this.fontSize()}`,10)}}_setTextData(){const{width:g,height:m}=this._getTextSize(this.attrs.text);if(this.textWidth=g,this.textHeight=m,this.glyphInfo=[],!this.attrs.data)return null;const y=this.letterSpacing(),x=this.align(),C=this.kerningFunc(),v=Math.max(this.textWidth+((this.attrs.text||"").length-1)*y,0);let b=0;x==="center"&&(b=Math.max(0,this.pathLength/2-v/2)),x==="right"&&(b=Math.max(0,this.pathLength-v));const S=(0,i.stringToArray)(this.text());let w=b;for(var j=0;j<S.length;j++){const E=this._getPointAtLength(w);if(!E)return;let A=this._getTextSize(S[j]).width+y;if(S[j]===" "&&x==="justify"){const R=this.text().split(" ").length-1;A+=(this.pathLength-v)/R}const L=this._getPointAtLength(w+A);if(!L)return;const M=s.Path.getLineLength(E.x,E.y,L.x,L.y);let O=0;if(C)try{O=C(S[j-1],S[j])*this.fontSize()}catch{O=0}E.x+=O,L.x+=O,this.textWidth+=O;const F=s.Path.getPointOnLine(O+M/2,E.x,E.y,L.x,L.y),_=Math.atan2(L.y-E.y,L.x-E.x);this.glyphInfo.push({transposeX:F.x,transposeY:F.y,text:S[j],rotation:_,p0:E,p1:L}),w+=A}}getSelfRect(){if(!this.glyphInfo.length)return{x:0,y:0,width:0,height:0};var g=[];this.glyphInfo.forEach(function(j){g.push(j.p0.x),g.push(j.p0.y),g.push(j.p1.x),g.push(j.p1.y)});for(var m=g[0]||0,y=g[0]||0,x=g[1]||0,C=g[1]||0,v,b,S=0;S<g.length/2;S++)v=g[S*2],b=g[S*2+1],m=Math.min(m,v),y=Math.max(y,v),x=Math.min(x,b),C=Math.max(C,b);var w=this.fontSize();return{x:m-w/2,y:x-w/2,width:y-m+w,height:C-x+w}}destroy(){return e.Util.releaseCanvas(this.dummyCanvas),super.destroy()}};return Bd.TextPath=f,f.prototype._fillFunc=d,f.prototype._strokeFunc=h,f.prototype._fillFuncHit=d,f.prototype._strokeFuncHit=h,f.prototype.className="TextPath",f.prototype._attrsAffectingSize=["text","fontSize","data"],(0,a._registerNode)(f),t.Factory.addGetterSetter(f,"data"),t.Factory.addGetterSetter(f,"fontFamily","Arial"),t.Factory.addGetterSetter(f,"fontSize",12,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(f,"fontStyle",c),t.Factory.addGetterSetter(f,"align","left"),t.Factory.addGetterSetter(f,"letterSpacing",0,(0,o.getNumberValidator)()),t.Factory.addGetterSetter(f,"textBaseline","middle"),t.Factory.addGetterSetter(f,"fontVariant",c),t.Factory.addGetterSetter(f,"text",l),t.Factory.addGetterSetter(f,"textDecoration",null),t.Factory.addGetterSetter(f,"kerningFunc",null),Bd}var $d={},h4;function yie(){if(h4)return $d;h4=1,Object.defineProperty($d,"__esModule",{value:!0}),$d.Transformer=void 0;const e=_n(),t=vt(),n=Tn(),s=Qn(),i=uE(),o=pS(),a=yt(),l=xt(),c=yt();var d="tr-konva",h=["resizeEnabledChange","rotateAnchorOffsetChange","rotateEnabledChange","enabledAnchorsChange","anchorSizeChange","borderEnabledChange","borderStrokeChange","borderStrokeWidthChange","borderDashChange","anchorStrokeChange","anchorStrokeWidthChange","anchorFillChange","anchorCornerRadiusChange","ignoreStrokeChange","anchorStyleFuncChange"].map(A=>A+`.${d}`).join(" "),f="nodesRect",p=["widthChange","heightChange","scaleXChange","scaleYChange","skewXChange","skewYChange","rotationChange","offsetXChange","offsetYChange","transformsEnabledChange","strokeWidthChange"],g={"top-left":-45,"top-center":0,"top-right":45,"middle-right":-90,"middle-left":90,"bottom-left":-135,"bottom-center":180,"bottom-right":135};const m="ontouchstart"in a.Konva._global;function y(A,L,M){if(A==="rotater")return M;L+=e.Util.degToRad(g[A]||0);var O=(e.Util.radToDeg(L)%360+360)%360;return e.Util._inRange(O,315+22.5,360)||e.Util._inRange(O,0,22.5)?"ns-resize":e.Util._inRange(O,45-22.5,45+22.5)?"nesw-resize":e.Util._inRange(O,90-22.5,90+22.5)?"ew-resize":e.Util._inRange(O,135-22.5,135+22.5)?"nwse-resize":e.Util._inRange(O,180-22.5,180+22.5)?"ns-resize":e.Util._inRange(O,225-22.5,225+22.5)?"nesw-resize":e.Util._inRange(O,270-22.5,270+22.5)?"ew-resize":e.Util._inRange(O,315-22.5,315+22.5)?"nwse-resize":(e.Util.error("Transformer has unknown angle for cursor detection: "+O),"pointer")}var x=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"];function C(A){return{x:A.x+A.width/2*Math.cos(A.rotation)+A.height/2*Math.sin(-A.rotation),y:A.y+A.height/2*Math.cos(A.rotation)+A.width/2*Math.sin(A.rotation)}}function v(A,L,M){const O=M.x+(A.x-M.x)*Math.cos(L)-(A.y-M.y)*Math.sin(L),F=M.y+(A.x-M.x)*Math.sin(L)+(A.y-M.y)*Math.cos(L);return{...A,rotation:A.rotation+L,x:O,y:F}}function b(A,L){const M=C(A);return v(A,L,M)}function S(A,L,M){let O=L;for(let F=0;F<A.length;F++){const _=a.Konva.getAngle(A[F]),R=Math.abs(_-L)%(Math.PI*2);Math.min(R,Math.PI*2-R)<M&&(O=_)}return O}let w=0,j=class extends o.Group{constructor(L){super(L),this._movingAnchorName=null,this._transforming=!1,this._createElements(),this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseUp=this._handleMouseUp.bind(this),this.update=this.update.bind(this),this.on(h,this.update),this.getNode()&&this.update()}attachTo(L){return this.setNode(L),this}setNode(L){return e.Util.warn("tr.setNode(shape), tr.node(shape) and tr.attachTo(shape) methods are deprecated. Please use tr.nodes(nodesArray) instead."),this.setNodes([L])}getNode(){return this._nodes&&this._nodes[0]}_getEventNamespace(){return d+this._id}setNodes(L=[]){this._nodes&&this._nodes.length&&this.detach();const M=L.filter(F=>F.isAncestorOf(this)?(e.Util.error("Konva.Transformer cannot be an a child of the node you are trying to attach"),!1):!0);this._nodes=L=M,L.length===1&&this.useSingleNodeRotation()?this.rotation(L[0].getAbsoluteRotation()):this.rotation(0),this._nodes.forEach(F=>{const _=()=>{this.nodes().length===1&&this.useSingleNodeRotation()&&this.rotation(this.nodes()[0].getAbsoluteRotation()),this._resetTransformCache(),!this._transforming&&!this.isDragging()&&this.update()},R=F._attrsAffectingSize.map(D=>D+"Change."+this._getEventNamespace()).join(" ");F.on(R,_),F.on(p.map(D=>D+`.${this._getEventNamespace()}`).join(" "),_),F.on(`absoluteTransformChange.${this._getEventNamespace()}`,_),this._proxyDrag(F)}),this._resetTransformCache();var O=!!this.findOne(".top-left");return O&&this.update(),this}_proxyDrag(L){let M;L.on(`dragstart.${this._getEventNamespace()}`,O=>{M=L.getAbsolutePosition(),!this.isDragging()&&L!==this.findOne(".back")&&this.startDrag(O,!1)}),L.on(`dragmove.${this._getEventNamespace()}`,O=>{if(!M)return;const F=L.getAbsolutePosition(),_=F.x-M.x,R=F.y-M.y;this.nodes().forEach(D=>{if(D===L||D.isDragging())return;const $=D.getAbsolutePosition();D.setAbsolutePosition({x:$.x+_,y:$.y+R}),D.startDrag(O)}),M=null})}getNodes(){return this._nodes||[]}getActiveAnchor(){return this._movingAnchorName}detach(){this._nodes&&this._nodes.forEach(L=>{L.off("."+this._getEventNamespace())}),this._nodes=[],this._resetTransformCache()}_resetTransformCache(){this._clearCache(f),this._clearCache("transform"),this._clearSelfAndDescendantCache("absoluteTransform")}_getNodeRect(){return this._getCache(f,this.__getNodeRect)}__getNodeShape(L,M=this.rotation(),O){var F=L.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()}),_=L.getAbsoluteScale(O),R=L.getAbsolutePosition(O),D=F.x*_.x-L.offsetX()*_.x,$=F.y*_.y-L.offsetY()*_.y;const G=(a.Konva.getAngle(L.getAbsoluteRotation())+Math.PI*2)%(Math.PI*2),ee={x:R.x+D*Math.cos(G)+$*Math.sin(-G),y:R.y+$*Math.cos(G)+D*Math.sin(G),width:F.width*_.x,height:F.height*_.y,rotation:G};return v(ee,-a.Konva.getAngle(M),{x:0,y:0})}__getNodeRect(){var L=this.getNode();if(!L)return{x:-1e8,y:-1e8,width:0,height:0,rotation:0};const M=[];this.nodes().map(G=>{const ee=G.getClientRect({skipTransform:!0,skipShadow:!0,skipStroke:this.ignoreStroke()});var Q=[{x:ee.x,y:ee.y},{x:ee.x+ee.width,y:ee.y},{x:ee.x+ee.width,y:ee.y+ee.height},{x:ee.x,y:ee.y+ee.height}],se=G.getAbsoluteTransform();Q.forEach(function(ne){var H=se.point(ne);M.push(H)})});const O=new e.Transform;O.rotate(-a.Konva.getAngle(this.rotation()));var F=1/0,_=1/0,R=-1/0,D=-1/0;M.forEach(function(G){var ee=O.point(G);F===void 0&&(F=R=ee.x,_=D=ee.y),F=Math.min(F,ee.x),_=Math.min(_,ee.y),R=Math.max(R,ee.x),D=Math.max(D,ee.y)}),O.invert();const $=O.point({x:F,y:_});return{x:$.x,y:$.y,width:R-F,height:D-_,rotation:a.Konva.getAngle(this.rotation())}}getX(){return this._getNodeRect().x}getY(){return this._getNodeRect().y}getWidth(){return this._getNodeRect().width}getHeight(){return this._getNodeRect().height}_createElements(){this._createBack(),x.forEach(L=>{this._createAnchor(L)}),this._createAnchor("rotater")}_createAnchor(L){var M=new i.Rect({stroke:"rgb(0, 161, 255)",fill:"white",strokeWidth:1,name:L+" _anchor",dragDistance:0,draggable:!0,hitStrokeWidth:m?10:"auto"}),O=this;M.on("mousedown touchstart",function(F){O._handleMouseDown(F)}),M.on("dragstart",F=>{M.stopDrag(),F.cancelBubble=!0}),M.on("dragend",F=>{F.cancelBubble=!0}),M.on("mouseenter",()=>{var F=a.Konva.getAngle(this.rotation()),_=this.rotateAnchorCursor(),R=y(L,F,_);M.getStage().content&&(M.getStage().content.style.cursor=R),this._cursorChange=!0}),M.on("mouseout",()=>{M.getStage().content&&(M.getStage().content.style.cursor=""),this._cursorChange=!1}),this.add(M)}_createBack(){var L=new s.Shape({name:"back",width:0,height:0,draggable:!0,sceneFunc(M,O){var F=O.getParent(),_=F.padding();M.beginPath(),M.rect(-_,-_,O.width()+_*2,O.height()+_*2),M.moveTo(O.width()/2,-_),F.rotateEnabled()&&F.rotateLineVisible()&&M.lineTo(O.width()/2,-F.rotateAnchorOffset()*e.Util._sign(O.height())-_),M.fillStrokeShape(O)},hitFunc:(M,O)=>{if(this.shouldOverdrawWholeArea()){var F=this.padding();M.beginPath(),M.rect(-F,-F,O.width()+F*2,O.height()+F*2),M.fillStrokeShape(O)}}});this.add(L),this._proxyDrag(L),L.on("dragstart",M=>{M.cancelBubble=!0}),L.on("dragmove",M=>{M.cancelBubble=!0}),L.on("dragend",M=>{M.cancelBubble=!0}),this.on("dragmove",M=>{this.update()})}_handleMouseDown(L){if(!this._transforming){this._movingAnchorName=L.target.name().split(" ")[0];var M=this._getNodeRect(),O=M.width,F=M.height,_=Math.sqrt(Math.pow(O,2)+Math.pow(F,2));this.sin=Math.abs(F/_),this.cos=Math.abs(O/_),typeof window<"u"&&(window.addEventListener("mousemove",this._handleMouseMove),window.addEventListener("touchmove",this._handleMouseMove),window.addEventListener("mouseup",this._handleMouseUp,!0),window.addEventListener("touchend",this._handleMouseUp,!0)),this._transforming=!0;var R=L.target.getAbsolutePosition(),D=L.target.getStage().getPointerPosition();this._anchorDragOffset={x:D.x-R.x,y:D.y-R.y},w++,this._fire("transformstart",{evt:L.evt,target:this.getNode()}),this._nodes.forEach($=>{$._fire("transformstart",{evt:L.evt,target:$})})}}_handleMouseMove(L){var M,O,F,_=this.findOne("."+this._movingAnchorName),R=_.getStage();R.setPointersPositions(L);const D=R.getPointerPosition();let $={x:D.x-this._anchorDragOffset.x,y:D.y-this._anchorDragOffset.y};const G=_.getAbsolutePosition();this.anchorDragBoundFunc()&&($=this.anchorDragBoundFunc()(G,$,L)),_.setAbsolutePosition($);const ee=_.getAbsolutePosition();if(!(G.x===ee.x&&G.y===ee.y)){if(this._movingAnchorName==="rotater"){var Q=this._getNodeRect();M=_.x()-Q.width/2,O=-_.y()+Q.height/2;let De=Math.atan2(-O,M)+Math.PI/2;Q.height<0&&(De-=Math.PI);var se=a.Konva.getAngle(this.rotation());const q=se+De,re=a.Konva.getAngle(this.rotationSnapTolerance()),xe=S(this.rotationSnaps(),q,re)-Q.rotation,ge=b(Q,xe);this._fitNodesInto(ge,L);return}var ne=this.shiftBehavior(),H;ne==="inverted"?H=this.keepRatio()&&!L.shiftKey:ne==="none"?H=this.keepRatio():H=this.keepRatio()||L.shiftKey;var N=this.centeredScaling()||L.altKey;if(this._movingAnchorName==="top-left"){if(H){var V=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-right").x(),y:this.findOne(".bottom-right").y()};F=Math.sqrt(Math.pow(V.x-_.x(),2)+Math.pow(V.y-_.y(),2));var Y=this.findOne(".top-left").x()>V.x?-1:1,W=this.findOne(".top-left").y()>V.y?-1:1;M=F*this.cos*Y,O=F*this.sin*W,this.findOne(".top-left").x(V.x-M),this.findOne(".top-left").y(V.y-O)}}else if(this._movingAnchorName==="top-center")this.findOne(".top-left").y(_.y());else if(this._movingAnchorName==="top-right"){if(H){var V=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".bottom-left").x(),y:this.findOne(".bottom-left").y()};F=Math.sqrt(Math.pow(_.x()-V.x,2)+Math.pow(V.y-_.y(),2));var Y=this.findOne(".top-right").x()<V.x?-1:1,W=this.findOne(".top-right").y()>V.y?-1:1;M=F*this.cos*Y,O=F*this.sin*W,this.findOne(".top-right").x(V.x+M),this.findOne(".top-right").y(V.y-O)}var J=_.position();this.findOne(".top-left").y(J.y),this.findOne(".bottom-right").x(J.x)}else if(this._movingAnchorName==="middle-left")this.findOne(".top-left").x(_.x());else if(this._movingAnchorName==="middle-right")this.findOne(".bottom-right").x(_.x());else if(this._movingAnchorName==="bottom-left"){if(H){var V=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-right").x(),y:this.findOne(".top-right").y()};F=Math.sqrt(Math.pow(V.x-_.x(),2)+Math.pow(_.y()-V.y,2));var Y=V.x<_.x()?-1:1,W=_.y()<V.y?-1:1;M=F*this.cos*Y,O=F*this.sin*W,_.x(V.x-M),_.y(V.y+O)}J=_.position(),this.findOne(".top-left").x(J.x),this.findOne(".bottom-right").y(J.y)}else if(this._movingAnchorName==="bottom-center")this.findOne(".bottom-right").y(_.y());else if(this._movingAnchorName==="bottom-right"){if(H){var V=N?{x:this.width()/2,y:this.height()/2}:{x:this.findOne(".top-left").x(),y:this.findOne(".top-left").y()};F=Math.sqrt(Math.pow(_.x()-V.x,2)+Math.pow(_.y()-V.y,2));var Y=this.findOne(".bottom-right").x()<V.x?-1:1,W=this.findOne(".bottom-right").y()<V.y?-1:1;M=F*this.cos*Y,O=F*this.sin*W,this.findOne(".bottom-right").x(V.x+M),this.findOne(".bottom-right").y(V.y+O)}}else console.error(new Error("Wrong position argument of selection resizer: "+this._movingAnchorName));var N=this.centeredScaling()||L.altKey;if(N){var B=this.findOne(".top-left"),U=this.findOne(".bottom-right"),ie=B.x(),ue=B.y(),be=this.getWidth()-U.x(),Te=this.getHeight()-U.y();U.move({x:-ie,y:-ue}),B.move({x:be,y:Te})}var je=this.findOne(".top-left").getAbsolutePosition();M=je.x,O=je.y;var Be=this.findOne(".bottom-right").x()-this.findOne(".top-left").x(),Ze=this.findOne(".bottom-right").y()-this.findOne(".top-left").y();this._fitNodesInto({x:M,y:O,width:Be,height:Ze,rotation:a.Konva.getAngle(this.rotation())},L)}}_handleMouseUp(L){this._removeEvents(L)}getAbsoluteTransform(){return this.getTransform()}_removeEvents(L){var M;if(this._transforming){this._transforming=!1,typeof window<"u"&&(window.removeEventListener("mousemove",this._handleMouseMove),window.removeEventListener("touchmove",this._handleMouseMove),window.removeEventListener("mouseup",this._handleMouseUp,!0),window.removeEventListener("touchend",this._handleMouseUp,!0));var O=this.getNode();w--,this._fire("transformend",{evt:L,target:O}),(M=this.getLayer())===null||M===void 0||M.batchDraw(),O&&this._nodes.forEach(F=>{var _;F._fire("transformend",{evt:L,target:F}),(_=F.getLayer())===null||_===void 0||_.batchDraw()}),this._movingAnchorName=null}}_fitNodesInto(L,M){var O=this._getNodeRect();const F=1;if(e.Util._inRange(L.width,-this.padding()*2-F,F)){this.update();return}if(e.Util._inRange(L.height,-this.padding()*2-F,F)){this.update();return}var _=new e.Transform;if(_.rotate(a.Konva.getAngle(this.rotation())),this._movingAnchorName&&L.width<0&&this._movingAnchorName.indexOf("left")>=0){const se=_.point({x:-this.padding()*2,y:0});L.x+=se.x,L.y+=se.y,L.width+=this.padding()*2,this._movingAnchorName=this._movingAnchorName.replace("left","right"),this._anchorDragOffset.x-=se.x,this._anchorDragOffset.y-=se.y}else if(this._movingAnchorName&&L.width<0&&this._movingAnchorName.indexOf("right")>=0){const se=_.point({x:this.padding()*2,y:0});this._movingAnchorName=this._movingAnchorName.replace("right","left"),this._anchorDragOffset.x-=se.x,this._anchorDragOffset.y-=se.y,L.width+=this.padding()*2}if(this._movingAnchorName&&L.height<0&&this._movingAnchorName.indexOf("top")>=0){const se=_.point({x:0,y:-this.padding()*2});L.x+=se.x,L.y+=se.y,this._movingAnchorName=this._movingAnchorName.replace("top","bottom"),this._anchorDragOffset.x-=se.x,this._anchorDragOffset.y-=se.y,L.height+=this.padding()*2}else if(this._movingAnchorName&&L.height<0&&this._movingAnchorName.indexOf("bottom")>=0){const se=_.point({x:0,y:this.padding()*2});this._movingAnchorName=this._movingAnchorName.replace("bottom","top"),this._anchorDragOffset.x-=se.x,this._anchorDragOffset.y-=se.y,L.height+=this.padding()*2}if(this.boundBoxFunc()){const se=this.boundBoxFunc()(O,L);se?L=se:e.Util.warn("boundBoxFunc returned falsy. You should return new bound rect from it!")}const R=1e7,D=new e.Transform;D.translate(O.x,O.y),D.rotate(O.rotation),D.scale(O.width/R,O.height/R);const $=new e.Transform,G=L.width/R,ee=L.height/R;this.flipEnabled()===!1?($.translate(L.x,L.y),$.rotate(L.rotation),$.translate(L.width<0?L.width:0,L.height<0?L.height:0),$.scale(Math.abs(G),Math.abs(ee))):($.translate(L.x,L.y),$.rotate(L.rotation),$.scale(G,ee));const Q=$.multiply(D.invert());this._nodes.forEach(se=>{var ne;const H=se.getParent().getAbsoluteTransform(),V=se.getTransform().copy();V.translate(se.offsetX(),se.offsetY());const Y=new e.Transform;Y.multiply(H.copy().invert()).multiply(Q).multiply(H).multiply(V);const W=Y.decompose();se.setAttrs(W),(ne=se.getLayer())===null||ne===void 0||ne.batchDraw()}),this.rotation(e.Util._getRotation(L.rotation)),this._nodes.forEach(se=>{this._fire("transform",{evt:M,target:se}),se._fire("transform",{evt:M,target:se})}),this._resetTransformCache(),this.update(),this.getLayer().batchDraw()}forceUpdate(){this._resetTransformCache(),this.update()}_batchChangeChild(L,M){this.findOne(L).setAttrs(M)}update(){var L,M=this._getNodeRect();this.rotation(e.Util._getRotation(M.rotation));var O=M.width,F=M.height,_=this.enabledAnchors(),R=this.resizeEnabled(),D=this.padding(),$=this.anchorSize();const G=this.find("._anchor");G.forEach(Q=>{Q.setAttrs({width:$,height:$,offsetX:$/2,offsetY:$/2,stroke:this.anchorStroke(),strokeWidth:this.anchorStrokeWidth(),fill:this.anchorFill(),cornerRadius:this.anchorCornerRadius()})}),this._batchChangeChild(".top-left",{x:0,y:0,offsetX:$/2+D,offsetY:$/2+D,visible:R&&_.indexOf("top-left")>=0}),this._batchChangeChild(".top-center",{x:O/2,y:0,offsetY:$/2+D,visible:R&&_.indexOf("top-center")>=0}),this._batchChangeChild(".top-right",{x:O,y:0,offsetX:$/2-D,offsetY:$/2+D,visible:R&&_.indexOf("top-right")>=0}),this._batchChangeChild(".middle-left",{x:0,y:F/2,offsetX:$/2+D,visible:R&&_.indexOf("middle-left")>=0}),this._batchChangeChild(".middle-right",{x:O,y:F/2,offsetX:$/2-D,visible:R&&_.indexOf("middle-right")>=0}),this._batchChangeChild(".bottom-left",{x:0,y:F,offsetX:$/2+D,offsetY:$/2-D,visible:R&&_.indexOf("bottom-left")>=0}),this._batchChangeChild(".bottom-center",{x:O/2,y:F,offsetY:$/2-D,visible:R&&_.indexOf("bottom-center")>=0}),this._batchChangeChild(".bottom-right",{x:O,y:F,offsetX:$/2-D,offsetY:$/2-D,visible:R&&_.indexOf("bottom-right")>=0}),this._batchChangeChild(".rotater",{x:O/2,y:-this.rotateAnchorOffset()*e.Util._sign(F)-D,visible:this.rotateEnabled()}),this._batchChangeChild(".back",{width:O,height:F,visible:this.borderEnabled(),stroke:this.borderStroke(),strokeWidth:this.borderStrokeWidth(),dash:this.borderDash(),x:0,y:0});const ee=this.anchorStyleFunc();ee&&G.forEach(Q=>{ee(Q)}),(L=this.getLayer())===null||L===void 0||L.batchDraw()}isTransforming(){return this._transforming}stopTransform(){if(this._transforming){this._removeEvents();var L=this.findOne("."+this._movingAnchorName);L&&L.stopDrag()}}destroy(){return this.getStage()&&this._cursorChange&&this.getStage().content&&(this.getStage().content.style.cursor=""),o.Group.prototype.destroy.call(this),this.detach(),this._removeEvents(),this}toObject(){return n.Node.prototype.toObject.call(this)}clone(L){var M=n.Node.prototype.clone.call(this,L);return M}getClientRect(){return this.nodes().length>0?super.getClientRect():{x:0,y:0,width:0,height:0}}};$d.Transformer=j,j.isTransforming=()=>w>0;function E(A){return A instanceof Array||e.Util.warn("enabledAnchors value should be an array"),A instanceof Array&&A.forEach(function(L){x.indexOf(L)===-1&&e.Util.warn("Unknown anchor name: "+L+". Available names are: "+x.join(", "))}),A||[]}return j.prototype.className="Transformer",(0,c._registerNode)(j),t.Factory.addGetterSetter(j,"enabledAnchors",x,E),t.Factory.addGetterSetter(j,"flipEnabled",!0,(0,l.getBooleanValidator)()),t.Factory.addGetterSetter(j,"resizeEnabled",!0),t.Factory.addGetterSetter(j,"anchorSize",10,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"rotateEnabled",!0),t.Factory.addGetterSetter(j,"rotateLineVisible",!0),t.Factory.addGetterSetter(j,"rotationSnaps",[]),t.Factory.addGetterSetter(j,"rotateAnchorOffset",50,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"rotateAnchorCursor","crosshair"),t.Factory.addGetterSetter(j,"rotationSnapTolerance",5,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderEnabled",!0),t.Factory.addGetterSetter(j,"anchorStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(j,"anchorStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"anchorFill","white"),t.Factory.addGetterSetter(j,"anchorCornerRadius",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderStroke","rgb(0, 161, 255)"),t.Factory.addGetterSetter(j,"borderStrokeWidth",1,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"borderDash"),t.Factory.addGetterSetter(j,"keepRatio",!0),t.Factory.addGetterSetter(j,"shiftBehavior","default"),t.Factory.addGetterSetter(j,"centeredScaling",!1),t.Factory.addGetterSetter(j,"ignoreStroke",!1),t.Factory.addGetterSetter(j,"padding",0,(0,l.getNumberValidator)()),t.Factory.addGetterSetter(j,"node"),t.Factory.addGetterSetter(j,"nodes"),t.Factory.addGetterSetter(j,"boundBoxFunc"),t.Factory.addGetterSetter(j,"anchorDragBoundFunc"),t.Factory.addGetterSetter(j,"anchorStyleFunc"),t.Factory.addGetterSetter(j,"shouldOverdrawWholeArea",!1),t.Factory.addGetterSetter(j,"useSingleNodeRotation",!0),t.Factory.backCompat(j,{lineEnabled:"borderEnabled",rotateHandlerOffset:"rotateAnchorOffset",enabledHandlers:"enabledAnchors"}),$d}var Vd={},f4;function vie(){if(f4)return Vd;f4=1,Object.defineProperty(Vd,"__esModule",{value:!0}),Vd.Wedge=void 0;const e=vt(),t=Qn(),n=yt(),s=xt(),i=yt();let o=class extends t.Shape{_sceneFunc(l){l.beginPath(),l.arc(0,0,this.radius(),0,n.Konva.getAngle(this.angle()),this.clockwise()),l.lineTo(0,0),l.closePath(),l.fillStrokeShape(this)}getWidth(){return this.radius()*2}getHeight(){return this.radius()*2}setWidth(l){this.radius(l/2)}setHeight(l){this.radius(l/2)}};return Vd.Wedge=o,o.prototype.className="Wedge",o.prototype._centroid=!0,o.prototype._attrsAffectingSize=["radius"],(0,i._registerNode)(o),e.Factory.addGetterSetter(o,"radius",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"angle",0,(0,s.getNumberValidator)()),e.Factory.addGetterSetter(o,"clockwise",!1),e.Factory.backCompat(o,{angleDeg:"angle",getAngleDeg:"getAngle",setAngleDeg:"setAngle"}),Vd}var Gd={},p4;function bie(){if(p4)return Gd;p4=1,Object.defineProperty(Gd,"__esModule",{value:!0}),Gd.Blur=void 0;const e=vt(),t=Tn(),n=xt();function s(){this.r=0,this.g=0,this.b=0,this.a=0,this.next=null}var i=[512,512,456,512,328,456,335,512,405,328,271,456,388,335,292,512,454,405,364,328,298,271,496,456,420,388,360,335,312,292,273,512,482,454,428,405,383,364,345,328,312,298,284,271,259,496,475,456,437,420,404,388,374,360,347,335,323,312,302,292,282,273,265,512,497,482,468,454,441,428,417,405,394,383,373,364,354,345,337,328,320,312,305,298,291,284,278,271,265,259,507,496,485,475,465,456,446,437,428,420,412,404,396,388,381,374,367,360,354,347,341,335,329,323,318,312,307,302,297,292,287,282,278,273,269,265,261,512,505,497,489,482,475,468,461,454,447,441,435,428,422,417,411,405,399,394,389,383,378,373,368,364,359,354,350,345,341,337,332,328,324,320,316,312,309,305,301,298,294,291,287,284,281,278,274,271,268,265,262,259,257,507,501,496,491,485,480,475,470,465,460,456,451,446,442,437,433,428,424,420,416,412,408,404,400,396,392,388,385,381,377,374,370,367,363,360,357,354,350,347,344,341,338,335,332,329,326,323,320,318,315,312,310,307,304,302,299,297,294,292,289,287,285,282,280,278,275,273,271,269,267,265,263,261,259],o=[9,11,12,13,13,14,14,15,15,15,15,16,16,16,16,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24];function a(c,d){var h=c.data,f=c.width,p=c.height,g,m,y,x,C,v,b,S,w,j,E,A,L,M,O,F,_,R,D,$,G,ee,Q,se,ne=d+d+1,H=f-1,V=p-1,Y=d+1,W=Y*(Y+1)/2,J=new s,N=null,B=J,U=null,ie=null,ue=i[d],be=o[d];for(y=1;y<ne;y++)B=B.next=new s,y===Y&&(N=B);for(B.next=J,b=v=0,m=0;m<p;m++){for(F=_=R=D=S=w=j=E=0,A=Y*($=h[v]),L=Y*(G=h[v+1]),M=Y*(ee=h[v+2]),O=Y*(Q=h[v+3]),S+=W*$,w+=W*G,j+=W*ee,E+=W*Q,B=J,y=0;y<Y;y++)B.r=$,B.g=G,B.b=ee,B.a=Q,B=B.next;for(y=1;y<Y;y++)x=v+((H<y?H:y)<<2),S+=(B.r=$=h[x])*(se=Y-y),w+=(B.g=G=h[x+1])*se,j+=(B.b=ee=h[x+2])*se,E+=(B.a=Q=h[x+3])*se,F+=$,_+=G,R+=ee,D+=Q,B=B.next;for(U=J,ie=N,g=0;g<f;g++)h[v+3]=Q=E*ue>>be,Q!==0?(Q=255/Q,h[v]=(S*ue>>be)*Q,h[v+1]=(w*ue>>be)*Q,h[v+2]=(j*ue>>be)*Q):h[v]=h[v+1]=h[v+2]=0,S-=A,w-=L,j-=M,E-=O,A-=U.r,L-=U.g,M-=U.b,O-=U.a,x=b+((x=g+d+1)<H?x:H)<<2,F+=U.r=h[x],_+=U.g=h[x+1],R+=U.b=h[x+2],D+=U.a=h[x+3],S+=F,w+=_,j+=R,E+=D,U=U.next,A+=$=ie.r,L+=G=ie.g,M+=ee=ie.b,O+=Q=ie.a,F-=$,_-=G,R-=ee,D-=Q,ie=ie.next,v+=4;b+=f}for(g=0;g<f;g++){for(_=R=D=F=w=j=E=S=0,v=g<<2,A=Y*($=h[v]),L=Y*(G=h[v+1]),M=Y*(ee=h[v+2]),O=Y*(Q=h[v+3]),S+=W*$,w+=W*G,j+=W*ee,E+=W*Q,B=J,y=0;y<Y;y++)B.r=$,B.g=G,B.b=ee,B.a=Q,B=B.next;for(C=f,y=1;y<=d;y++)v=C+g<<2,S+=(B.r=$=h[v])*(se=Y-y),w+=(B.g=G=h[v+1])*se,j+=(B.b=ee=h[v+2])*se,E+=(B.a=Q=h[v+3])*se,F+=$,_+=G,R+=ee,D+=Q,B=B.next,y<V&&(C+=f);for(v=g,U=J,ie=N,m=0;m<p;m++)x=v<<2,h[x+3]=Q=E*ue>>be,Q>0?(Q=255/Q,h[x]=(S*ue>>be)*Q,h[x+1]=(w*ue>>be)*Q,h[x+2]=(j*ue>>be)*Q):h[x]=h[x+1]=h[x+2]=0,S-=A,w-=L,j-=M,E-=O,A-=U.r,L-=U.g,M-=U.b,O-=U.a,x=g+((x=m+Y)<V?x:V)*f<<2,S+=F+=U.r=h[x],w+=_+=U.g=h[x+1],j+=R+=U.b=h[x+2],E+=D+=U.a=h[x+3],U=U.next,A+=$=ie.r,L+=G=ie.g,M+=ee=ie.b,O+=Q=ie.a,F-=$,_-=G,R-=ee,D-=Q,ie=ie.next,v+=f}}const l=function(d){var h=Math.round(this.blurRadius());h>0&&a(d,h)};return Gd.Blur=l,e.Factory.addGetterSetter(t.Node,"blurRadius",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Gd}var zd={},g4;function xie(){if(g4)return zd;g4=1,Object.defineProperty(zd,"__esModule",{value:!0}),zd.Brighten=void 0;const e=vt(),t=Tn(),n=xt(),s=function(i){var o=this.brightness()*255,a=i.data,l=a.length,c;for(c=0;c<l;c+=4)a[c]+=o,a[c+1]+=o,a[c+2]+=o};return zd.Brighten=s,e.Factory.addGetterSetter(t.Node,"brightness",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),zd}var Hd={},m4;function Cie(){if(m4)return Hd;m4=1,Object.defineProperty(Hd,"__esModule",{value:!0}),Hd.Contrast=void 0;const e=vt(),t=Tn(),n=xt(),s=function(i){var o=Math.pow((this.contrast()+100)/100,2),a=i.data,l=a.length,c=150,d=150,h=150,f;for(f=0;f<l;f+=4)c=a[f],d=a[f+1],h=a[f+2],c/=255,c-=.5,c*=o,c+=.5,c*=255,d/=255,d-=.5,d*=o,d+=.5,d*=255,h/=255,h-=.5,h*=o,h+=.5,h*=255,c=c<0?0:c>255?255:c,d=d<0?0:d>255?255:d,h=h<0?0:h>255?255:h,a[f]=c,a[f+1]=d,a[f+2]=h};return Hd.Contrast=s,e.Factory.addGetterSetter(t.Node,"contrast",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Hd}var Wd={},y4;function Sie(){if(y4)return Wd;y4=1,Object.defineProperty(Wd,"__esModule",{value:!0}),Wd.Emboss=void 0;const e=vt(),t=Tn(),n=_n(),s=xt(),i=function(o){var a=this.embossStrength()*10,l=this.embossWhiteLevel()*255,c=this.embossDirection(),d=this.embossBlend(),h=0,f=0,p=o.data,g=o.width,m=o.height,y=g*4,x=m;switch(c){case"top-left":h=-1,f=-1;break;case"top":h=-1,f=0;break;case"top-right":h=-1,f=1;break;case"right":h=0,f=1;break;case"bottom-right":h=1,f=1;break;case"bottom":h=1,f=0;break;case"bottom-left":h=1,f=-1;break;case"left":h=0,f=-1;break;default:n.Util.error("Unknown emboss direction: "+c)}do{var C=(x-1)*y,v=h;x+v<1&&(v=0),x+v>m&&(v=0);var b=(x-1+v)*g*4,S=g;do{var w=C+(S-1)*4,j=f;S+j<1&&(j=0),S+j>g&&(j=0);var E=b+(S-1+j)*4,A=p[w]-p[E],L=p[w+1]-p[E+1],M=p[w+2]-p[E+2],O=A,F=O>0?O:-O,_=L>0?L:-L,R=M>0?M:-M;if(_>F&&(O=L),R>F&&(O=M),O*=a,d){var D=p[w]+O,$=p[w+1]+O,G=p[w+2]+O;p[w]=D>255?255:D<0?0:D,p[w+1]=$>255?255:$<0?0:$,p[w+2]=G>255?255:G<0?0:G}else{var ee=l-O;ee<0?ee=0:ee>255&&(ee=255),p[w]=p[w+1]=p[w+2]=ee}}while(--S)}while(--x)};return Wd.Emboss=i,e.Factory.addGetterSetter(t.Node,"embossStrength",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossWhiteLevel",.5,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossDirection","top-left",null,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"embossBlend",!1,null,e.Factory.afterSetFilter),Wd}var Ud={},v4;function wie(){if(v4)return Ud;v4=1,Object.defineProperty(Ud,"__esModule",{value:!0}),Ud.Enhance=void 0;const e=vt(),t=Tn(),n=xt();function s(o,a,l,c,d){var h=l-a,f=d-c,p;return h===0?c+f/2:f===0?c:(p=(o-a)/h,p=f*p+c,p)}const i=function(o){var a=o.data,l=a.length,c=a[0],d=c,h,f=a[1],p=f,g,m=a[2],y=m,x,C,v=this.enhance();if(v!==0){for(C=0;C<l;C+=4)h=a[C+0],h<c?c=h:h>d&&(d=h),g=a[C+1],g<f?f=g:g>p&&(p=g),x=a[C+2],x<m?m=x:x>y&&(y=x);d===c&&(d=255,c=0),p===f&&(p=255,f=0),y===m&&(y=255,m=0);var b,S,w,j,E,A,L,M,O;for(v>0?(S=d+v*(255-d),w=c-v*(c-0),E=p+v*(255-p),A=f-v*(f-0),M=y+v*(255-y),O=m-v*(m-0)):(b=(d+c)*.5,S=d+v*(d-b),w=c+v*(c-b),j=(p+f)*.5,E=p+v*(p-j),A=f+v*(f-j),L=(y+m)*.5,M=y+v*(y-L),O=m+v*(m-L)),C=0;C<l;C+=4)a[C+0]=s(a[C+0],c,d,w,S),a[C+1]=s(a[C+1],f,p,A,E),a[C+2]=s(a[C+2],m,y,O,M)}};return Ud.Enhance=i,e.Factory.addGetterSetter(t.Node,"enhance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Ud}var qd={},b4;function jie(){if(b4)return qd;b4=1,Object.defineProperty(qd,"__esModule",{value:!0}),qd.Grayscale=void 0;const e=function(t){var n=t.data,s=n.length,i,o;for(i=0;i<s;i+=4)o=.34*n[i]+.5*n[i+1]+.16*n[i+2],n[i]=o,n[i+1]=o,n[i+2]=o};return qd.Grayscale=e,qd}var Kd={},x4;function kie(){if(x4)return Kd;x4=1,Object.defineProperty(Kd,"__esModule",{value:!0}),Kd.HSL=void 0;const e=vt(),t=Tn(),n=xt();e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"luminance",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter);const s=function(i){var o=i.data,a=o.length,l=1,c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,h=this.luminance()*127,f,p=l*c*Math.cos(d*Math.PI/180),g=l*c*Math.sin(d*Math.PI/180),m=.299*l+.701*p+.167*g,y=.587*l-.587*p+.33*g,x=.114*l-.114*p-.497*g,C=.299*l-.299*p-.328*g,v=.587*l+.413*p+.035*g,b=.114*l-.114*p+.293*g,S=.299*l-.3*p+1.25*g,w=.587*l-.586*p-1.05*g,j=.114*l+.886*p-.2*g,E,A,L,M;for(f=0;f<a;f+=4)E=o[f+0],A=o[f+1],L=o[f+2],M=o[f+3],o[f+0]=m*E+y*A+x*L+h,o[f+1]=C*E+v*A+b*L+h,o[f+2]=S*E+w*A+j*L+h,o[f+3]=M};return Kd.HSL=s,Kd}var Zd={},C4;function _ie(){if(C4)return Zd;C4=1,Object.defineProperty(Zd,"__esModule",{value:!0}),Zd.HSV=void 0;const e=vt(),t=Tn(),n=xt(),s=function(i){var o=i.data,a=o.length,l=Math.pow(2,this.value()),c=Math.pow(2,this.saturation()),d=Math.abs(this.hue()+360)%360,h,f=l*c*Math.cos(d*Math.PI/180),p=l*c*Math.sin(d*Math.PI/180),g=.299*l+.701*f+.167*p,m=.587*l-.587*f+.33*p,y=.114*l-.114*f-.497*p,x=.299*l-.299*f-.328*p,C=.587*l+.413*f+.035*p,v=.114*l-.114*f+.293*p,b=.299*l-.3*f+1.25*p,S=.587*l-.586*f-1.05*p,w=.114*l+.886*f-.2*p,j,E,A,L;for(h=0;h<a;h+=4)j=o[h+0],E=o[h+1],A=o[h+2],L=o[h+3],o[h+0]=g*j+m*E+y*A,o[h+1]=x*j+C*E+v*A,o[h+2]=b*j+S*E+w*A,o[h+3]=L};return Zd.HSV=s,e.Factory.addGetterSetter(t.Node,"hue",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"saturation",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"value",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Zd}var Yd={},S4;function Iie(){if(S4)return Yd;S4=1,Object.defineProperty(Yd,"__esModule",{value:!0}),Yd.Invert=void 0;const e=function(t){var n=t.data,s=n.length,i;for(i=0;i<s;i+=4)n[i]=255-n[i],n[i+1]=255-n[i+1],n[i+2]=255-n[i+2]};return Yd.Invert=e,Yd}var Xd={},w4;function Aie(){if(w4)return Xd;w4=1,Object.defineProperty(Xd,"__esModule",{value:!0}),Xd.Kaleidoscope=void 0;const e=vt(),t=Tn(),n=_n(),s=xt();var i=function(l,c,d){var h=l.data,f=c.data,p=l.width,g=l.height,m=d.polarCenterX||p/2,y=d.polarCenterY||g/2,x,C,v,b=0,S=0,w=0,j=0,E,A=Math.sqrt(m*m+y*y);C=p-m,v=g-y,E=Math.sqrt(C*C+v*v),A=E>A?E:A;var L=g,M=p,O,F,_=360/M*Math.PI/180,R,D;for(F=0;F<M;F+=1)for(R=Math.sin(F*_),D=Math.cos(F*_),O=0;O<L;O+=1)C=Math.floor(m+A*O/L*D),v=Math.floor(y+A*O/L*R),x=(v*p+C)*4,b=h[x+0],S=h[x+1],w=h[x+2],j=h[x+3],x=(F+O*p)*4,f[x+0]=b,f[x+1]=S,f[x+2]=w,f[x+3]=j},o=function(l,c,d){var h=l.data,f=c.data,p=l.width,g=l.height,m=d.polarCenterX||p/2,y=d.polarCenterY||g/2,x,C,v,b,S,w=0,j=0,E=0,A=0,L,M=Math.sqrt(m*m+y*y);C=p-m,v=g-y,L=Math.sqrt(C*C+v*v),M=L>M?L:M;var O=g,F=p,_,R,D=0,$,G;for(C=0;C<p;C+=1)for(v=0;v<g;v+=1)b=C-m,S=v-y,_=Math.sqrt(b*b+S*S)*O/M,R=(Math.atan2(S,b)*180/Math.PI+360+D)%360,R=R*F/360,$=Math.floor(R),G=Math.floor(_),x=(G*p+$)*4,w=h[x+0],j=h[x+1],E=h[x+2],A=h[x+3],x=(v*p+C)*4,f[x+0]=w,f[x+1]=j,f[x+2]=E,f[x+3]=A};const a=function(l){var c=l.width,d=l.height,h,f,p,g,m,y,x,C,v,b,S=Math.round(this.kaleidoscopePower()),w=Math.round(this.kaleidoscopeAngle()),j=Math.floor(c*(w%360)/360);if(!(S<1)){var E=n.Util.createCanvasElement();E.width=c,E.height=d;var A=E.getContext("2d").getImageData(0,0,c,d);n.Util.releaseCanvas(E),i(l,A,{polarCenterX:c/2,polarCenterY:d/2});for(var L=c/Math.pow(2,S);L<=8;)L=L*2,S-=1;L=Math.ceil(L);var M=L,O=0,F=M,_=1;for(j+L>c&&(O=M,F=0,_=-1),f=0;f<d;f+=1)for(h=O;h!==F;h+=_)p=Math.round(h+j)%c,v=(c*f+p)*4,m=A.data[v+0],y=A.data[v+1],x=A.data[v+2],C=A.data[v+3],b=(c*f+h)*4,A.data[b+0]=m,A.data[b+1]=y,A.data[b+2]=x,A.data[b+3]=C;for(f=0;f<d;f+=1)for(M=Math.floor(L),g=0;g<S;g+=1){for(h=0;h<M+1;h+=1)v=(c*f+h)*4,m=A.data[v+0],y=A.data[v+1],x=A.data[v+2],C=A.data[v+3],b=(c*f+M*2-h-1)*4,A.data[b+0]=m,A.data[b+1]=y,A.data[b+2]=x,A.data[b+3]=C;M*=2}o(A,l,{})}};return Xd.Kaleidoscope=a,e.Factory.addGetterSetter(t.Node,"kaleidoscopePower",2,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"kaleidoscopeAngle",0,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),Xd}var Qd={},j4;function Tie(){if(j4)return Qd;j4=1,Object.defineProperty(Qd,"__esModule",{value:!0}),Qd.Mask=void 0;const e=vt(),t=Tn(),n=xt();function s(p,g,m){var y=(m*p.width+g)*4,x=[];return x.push(p.data[y++],p.data[y++],p.data[y++],p.data[y++]),x}function i(p,g){return Math.sqrt(Math.pow(p[0]-g[0],2)+Math.pow(p[1]-g[1],2)+Math.pow(p[2]-g[2],2))}function o(p){for(var g=[0,0,0],m=0;m<p.length;m++)g[0]+=p[m][0],g[1]+=p[m][1],g[2]+=p[m][2];return g[0]/=p.length,g[1]/=p.length,g[2]/=p.length,g}function a(p,g){var m=s(p,0,0),y=s(p,p.width-1,0),x=s(p,0,p.height-1),C=s(p,p.width-1,p.height-1),v=g||10;if(i(m,y)<v&&i(y,C)<v&&i(C,x)<v&&i(x,m)<v){for(var b=o([y,m,C,x]),S=[],w=0;w<p.width*p.height;w++){var j=i(b,[p.data[w*4],p.data[w*4+1],p.data[w*4+2]]);S[w]=j<v?0:255}return S}}function l(p,g){for(var m=0;m<p.width*p.height;m++)p.data[4*m+3]=g[m]}function c(p,g,m){for(var y=[1,1,1,1,0,1,1,1,1],x=Math.round(Math.sqrt(y.length)),C=Math.floor(x/2),v=[],b=0;b<m;b++)for(var S=0;S<g;S++){for(var w=b*g+S,j=0,E=0;E<x;E++)for(var A=0;A<x;A++){var L=b+E-C,M=S+A-C;if(L>=0&&L<m&&M>=0&&M<g){var O=L*g+M,F=y[E*x+A];j+=p[O]*F}}v[w]=j===255*8?255:0}return v}function d(p,g,m){for(var y=[1,1,1,1,1,1,1,1,1],x=Math.round(Math.sqrt(y.length)),C=Math.floor(x/2),v=[],b=0;b<m;b++)for(var S=0;S<g;S++){for(var w=b*g+S,j=0,E=0;E<x;E++)for(var A=0;A<x;A++){var L=b+E-C,M=S+A-C;if(L>=0&&L<m&&M>=0&&M<g){var O=L*g+M,F=y[E*x+A];j+=p[O]*F}}v[w]=j>=255*4?255:0}return v}function h(p,g,m){for(var y=[.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111,.1111111111111111],x=Math.round(Math.sqrt(y.length)),C=Math.floor(x/2),v=[],b=0;b<m;b++)for(var S=0;S<g;S++){for(var w=b*g+S,j=0,E=0;E<x;E++)for(var A=0;A<x;A++){var L=b+E-C,M=S+A-C;if(L>=0&&L<m&&M>=0&&M<g){var O=L*g+M,F=y[E*x+A];j+=p[O]*F}}v[w]=j}return v}const f=function(p){var g=this.threshold(),m=a(p,g);return m&&(m=c(m,p.width,p.height),m=d(m,p.width,p.height),m=h(m,p.width,p.height),l(p,m)),p};return Qd.Mask=f,e.Factory.addGetterSetter(t.Node,"threshold",0,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Qd}var Jd={},k4;function Mie(){if(k4)return Jd;k4=1,Object.defineProperty(Jd,"__esModule",{value:!0}),Jd.Noise=void 0;const e=vt(),t=Tn(),n=xt(),s=function(i){var o=this.noise()*255,a=i.data,l=a.length,c=o/2,d;for(d=0;d<l;d+=4)a[d+0]+=c-2*c*Math.random(),a[d+1]+=c-2*c*Math.random(),a[d+2]+=c-2*c*Math.random()};return Jd.Noise=s,e.Factory.addGetterSetter(t.Node,"noise",.2,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),Jd}var eh={},_4;function Pie(){if(_4)return eh;_4=1,Object.defineProperty(eh,"__esModule",{value:!0}),eh.Pixelate=void 0;const e=vt(),t=_n(),n=Tn(),s=xt(),i=function(o){var a=Math.ceil(this.pixelSize()),l=o.width,c=o.height,d,h,f,p,g,m,y,x=Math.ceil(l/a),C=Math.ceil(c/a),v,b,S,w,j,E,A,L=o.data;if(a<=0){t.Util.error("pixelSize value can not be <= 0");return}for(j=0;j<x;j+=1)for(E=0;E<C;E+=1){for(p=0,g=0,m=0,y=0,v=j*a,b=v+a,S=E*a,w=S+a,A=0,d=v;d<b;d+=1)if(!(d>=l))for(h=S;h<w;h+=1)h>=c||(f=(l*h+d)*4,p+=L[f+0],g+=L[f+1],m+=L[f+2],y+=L[f+3],A+=1);for(p=p/A,g=g/A,m=m/A,y=y/A,d=v;d<b;d+=1)if(!(d>=l))for(h=S;h<w;h+=1)h>=c||(f=(l*h+d)*4,L[f+0]=p,L[f+1]=g,L[f+2]=m,L[f+3]=y)}};return eh.Pixelate=i,e.Factory.addGetterSetter(n.Node,"pixelSize",8,(0,s.getNumberValidator)(),e.Factory.afterSetFilter),eh}var th={},I4;function Eie(){if(I4)return th;I4=1,Object.defineProperty(th,"__esModule",{value:!0}),th.Posterize=void 0;const e=vt(),t=Tn(),n=xt(),s=function(i){var o=Math.round(this.levels()*254)+1,a=i.data,l=a.length,c=255/o,d;for(d=0;d<l;d+=1)a[d]=Math.floor(a[d]/c)*c};return th.Posterize=s,e.Factory.addGetterSetter(t.Node,"levels",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),th}var nh={},A4;function Lie(){if(A4)return nh;A4=1,Object.defineProperty(nh,"__esModule",{value:!0}),nh.RGB=void 0;const e=vt(),t=Tn(),n=xt(),s=function(i){var o=i.data,a=o.length,l=this.red(),c=this.green(),d=this.blue(),h,f;for(h=0;h<a;h+=4)f=(.34*o[h]+.5*o[h+1]+.16*o[h+2])/255,o[h]=f*l,o[h+1]=f*c,o[h+2]=f*d,o[h+3]=o[h+3]};return nh.RGB=s,e.Factory.addGetterSetter(t.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),nh}var sh={},T4;function Die(){if(T4)return sh;T4=1,Object.defineProperty(sh,"__esModule",{value:!0}),sh.RGBA=void 0;const e=vt(),t=Tn(),n=xt(),s=function(i){var o=i.data,a=o.length,l=this.red(),c=this.green(),d=this.blue(),h=this.alpha(),f,p;for(f=0;f<a;f+=4)p=1-h,o[f]=l*h+o[f]*p,o[f+1]=c*h+o[f+1]*p,o[f+2]=d*h+o[f+2]*p};return sh.RGBA=s,e.Factory.addGetterSetter(t.Node,"red",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"green",0,function(i){return this._filterUpToDate=!1,i>255?255:i<0?0:Math.round(i)}),e.Factory.addGetterSetter(t.Node,"blue",0,n.RGBComponent,e.Factory.afterSetFilter),e.Factory.addGetterSetter(t.Node,"alpha",1,function(i){return this._filterUpToDate=!1,i>1?1:i<0?0:i}),sh}var rh={},M4;function Rie(){if(M4)return rh;M4=1,Object.defineProperty(rh,"__esModule",{value:!0}),rh.Sepia=void 0;const e=function(t){var n=t.data,s=n.length,i,o,a,l;for(i=0;i<s;i+=4)o=n[i+0],a=n[i+1],l=n[i+2],n[i+0]=Math.min(255,o*.393+a*.769+l*.189),n[i+1]=Math.min(255,o*.349+a*.686+l*.168),n[i+2]=Math.min(255,o*.272+a*.534+l*.131)};return rh.Sepia=e,rh}var ih={},P4;function Oie(){if(P4)return ih;P4=1,Object.defineProperty(ih,"__esModule",{value:!0}),ih.Solarize=void 0;const e=function(t){var n=t.data,s=t.width,i=t.height,o=s*4,a=i;do{var l=(a-1)*o,c=s;do{var d=l+(c-1)*4,h=n[d],f=n[d+1],p=n[d+2];h>127&&(h=255-h),f>127&&(f=255-f),p>127&&(p=255-p),n[d]=h,n[d+1]=f,n[d+2]=p}while(--c)}while(--a)};return ih.Solarize=e,ih}var oh={},E4;function Nie(){if(E4)return oh;E4=1,Object.defineProperty(oh,"__esModule",{value:!0}),oh.Threshold=void 0;const e=vt(),t=Tn(),n=xt(),s=function(i){var o=this.threshold()*255,a=i.data,l=a.length,c;for(c=0;c<l;c+=1)a[c]=a[c]<o?0:255};return oh.Threshold=s,e.Factory.addGetterSetter(t.Node,"threshold",.5,(0,n.getNumberValidator)(),e.Factory.afterSetFilter),oh}var L4;function Fie(){if(L4)return xd;L4=1,Object.defineProperty(xd,"__esModule",{value:!0}),xd.Konva=void 0;const e=rie(),t=iie(),n=aie(),s=lie(),i=cie(),o=uie(),a=die(),l=cE(),c=mS(),d=uE(),h=hie(),f=fie(),p=pie(),g=gie(),m=dE(),y=mie(),x=yie(),C=vie(),v=bie(),b=xie(),S=Cie(),w=Sie(),j=wie(),E=jie(),A=kie(),L=_ie(),M=Iie(),O=Aie(),F=Tie(),_=Mie(),R=Pie(),D=Eie(),$=Lie(),G=Die(),ee=Rie(),Q=Oie(),se=Nie();return xd.Konva=e.Konva.Util._assign(e.Konva,{Arc:t.Arc,Arrow:n.Arrow,Circle:s.Circle,Ellipse:i.Ellipse,Image:o.Image,Label:a.Label,Tag:a.Tag,Line:l.Line,Path:c.Path,Rect:d.Rect,RegularPolygon:h.RegularPolygon,Ring:f.Ring,Sprite:p.Sprite,Star:g.Star,Text:m.Text,TextPath:y.TextPath,Transformer:x.Transformer,Wedge:C.Wedge,Filters:{Blur:v.Blur,Brighten:b.Brighten,Contrast:S.Contrast,Emboss:w.Emboss,Enhance:j.Enhance,Grayscale:E.Grayscale,HSL:A.HSL,HSV:L.HSV,Invert:M.Invert,Kaleidoscope:O.Kaleidoscope,Mask:F.Mask,Noise:_.Noise,Pixelate:R.Pixelate,Posterize:D.Posterize,RGB:$.RGB,RGBA:G.RGBA,Sepia:ee.Sepia,Solarize:Q.Solarize,Threshold:se.Threshold}}),xd}var Bie=om.exports,D4;function $ie(){if(D4)return om.exports;D4=1,Object.defineProperty(Bie,"__esModule",{value:!0});const e=Fie();return om.exports=e.Konva,om.exports}var Vie=$ie();const Ne=Au(Vie);var dv,R4;function Gie(){if(R4)return dv;R4=1;var e=function(n){var s=null,i,o=function(c){return function(){s=null,n.apply(c,i)}},a=function(){for(var c=arguments.length,d=new Array(c),h=0;h<c;h++)d[h]=arguments[h];i=d,s===null&&(s=requestAnimationFrame(o(this)))};return a.cancel=function(){cancelAnimationFrame(s),s=null},a};return dv=e,dv}var zie=Gie();const hE=Au(zie),cg=new WeakMap;let Hie=0;function kl(e){const t=typeof e,n=e&&e.constructor,s=n==Date;if(Object(e)===e&&!s&&n!=RegExp){let i=cg.get(e);if(i)return i;i=++Hie+"~",cg.set(e,i);let o;if(n==Array){for(i="@",o=0;o<e.length;o++)i+=kl(e[o])+",";cg.set(e,i)}else if(n==Object){i="#";const a=Object.keys(e).sort();for(;(o=a.pop())!==void 0;)e[o]!==void 0&&(i+=o+":"+kl(e[o])+",");cg.set(e,i)}return i}return s?e.toJSON():t=="symbol"?e.toString():t=="string"?JSON.stringify(e):""+e}const wo=class wo extends $t{constructor(n,s,i){super();k(this,"type");k(this,"id");k(this,"path");k(this,"manager");k(this,"parent");k(this,"log");k(this,"entityIdentifier");k(this,"selectIsTypeHidden");k(this,"selectIsSelected");k(this,"konva");k(this,"state");k(this,"subscriptions",new Set);k(this,"$isLocked",Oe(!1));k(this,"$isDisabled",Oe(!1));k(this,"$isEntityTypeHidden",Oe(!1));k(this,"$isEmpty",Oe(!0));k(this,"$canvasCache",Oe(null));k(this,"$isOnScreen",Oe(!0));k(this,"$intersectsBbox",Oe(!1));k(this,"selectState",ve(Je,n=>Aa(n,this.entityIdentifier)));k(this,"selectPosition",ve(this.selectState,n=>n==null?void 0:n.position));k(this,"syncIsOnscreen",()=>{const n=this.manager.stage.getScaledStageRect(),s=this.checkIntersection(n),i=this.$isOnScreen.get();this.$isOnScreen.set(s),i!==s&&this.log.trace(`Moved ${s?"on-screen":"off-screen"}`),this.syncVisibility()});k(this,"syncIntersectsBbox",()=>{const n=this.manager.stateApi.getBbox().rect,s=this.checkIntersection(n),i=this.$intersectsBbox.get();this.$intersectsBbox.set(s),i!==s&&this.log.trace(`Moved ${s?"into bbox":"out of bbox"}`)});k(this,"checkIntersection",n=>{const s=this.transformer.$pixelRect.get(),i=this.manager.stateApi.runSelector(this.selectPosition);if(!i)return!1;const o={x:s.x+i.x,y:s.y+i.y,width:s.width,height:s.height},a=OU(n,o);return a.width>0&&a.height>0});k(this,"initialize",async()=>{this.log.debug("Initializing module"),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIsOnscreen)),this.subscriptions.add(this.transformer.$pixelRect.listen(this.syncIntersectsBbox)),await this.sync(this.manager.stateApi.runSelector(this.selectState),void 0),this.transformer.initialize(),await this.renderer.initialize(),this.syncZIndices(),this.syncVisibility(),wo.runInitCallbacks(this)});k(this,"syncZIndices",()=>{this.log.trace("Updating z-indices");let n=0;this.renderer.konva.objectGroup.zIndex(n++),this.bufferRenderer.konva.group.zIndex(n++),this.renderer.konva.compositing&&this.renderer.konva.compositing.group.zIndex(n++),this.transformer.konva.outlineRect.zIndex(n++),this.transformer.konva.proxyRect.zIndex(n++),this.transformer.konva.transformer.zIndex(n++)});k(this,"syncIsEnabled",()=>{this.log.trace("Updating visibility"),this.$isDisabled.set(!this.state.isEnabled),this.syncVisibility(),this.transformer.syncInteractionState()});k(this,"syncObjects",async()=>{this.$isEmpty.set(this.state.objects.length===0),await this.renderer.render()&&(this.transformer.requestRectCalculation(),this.transformer.syncInteractionState())});k(this,"syncPosition",()=>{this.transformer.updatePosition()});k(this,"syncOpacity",()=>{this.renderer.updateOpacity()});k(this,"syncVisibility",hE(()=>{if(this.manager.stateApi.runSelector(this.selectIsTypeHidden)){this.setVisibility(!1);return}if(this.manager.stateApi.runSelector(Gb)){const n=this.manager.stateApi.runSelector(Dn),s=$T(this.entityIdentifier);if(n&&!s){this.setVisibility(!1);return}}if(this.manager.stateApi.runSelector(Mm)){const n=this.manager.stateApi.$filteringAdapter.get();if(n&&n!==this){this.setVisibility(!1);return}const s=this.manager.stateApi.$transformingAdapter.get();if(s&&s!==this&&!s.transformer.$silentTransform.get()){this.setVisibility(!1);return}const i=this.manager.stateApi.$segmentingAdapter.get();if(i&&i!==this){this.setVisibility(!1);return}}if(this.$isDisabled.get()){this.setVisibility(!1);return}if(!this.$isOnScreen.get()&&!this.manager.stateApi.getIsSelected(this.entityIdentifier.id)){this.setVisibility(!1);return}this.setVisibility(!0)}));k(this,"setVisibility",n=>{this.konva.layer.visible()!==n&&(this.log.trace(n?"Showing":"Hiding"),this.konva.layer.visible(n),n&&(this.renderer.updateCompositingRectSize(),this.renderer.updateCompositingRectPosition(),this.renderer.updateCompositingRectFill()),this.renderer.syncKonvaCache())});k(this,"syncIsLocked",()=>{this.$isLocked.set(this.state.isLocked),this.transformer.syncInteractionState()});k(this,"hash",n=>{const s={state:this.getHashableState(),extra:n};return kl(s)});k(this,"cropToBbox",async()=>{const{rect:n}=this.manager.stateApi.getBbox(),s=await Un(()=>this.renderer.rasterize({rect:n,replaceObjects:!0,attrs:{opacity:1,filters:[]}}));if(s.isErr())throw fe({status:"error",title:"Failed to crop to bbox"}),s.error;return s.value});k(this,"destroy",()=>{var n;this.log.debug("Destroying module"),this.subscriptions.forEach(s=>s()),this.subscriptions.clear(),this.renderer.destroy(),this.transformer.$isTransforming.get()&&this.transformer.stopTransform(),this.transformer.destroy(),this.filterer&&(this.filterer.$isFiltering.get()&&this.filterer.cancel(),(n=this.filterer)==null||n.destroy()),this.segmentAnything&&(this.segmentAnything.$isSegmenting.get()&&this.segmentAnything.cancel(),this.segmentAnything.destroy()),this.konva.layer.destroy(),this.manager.deleteAdapter(this.entityIdentifier)});k(this,"repr",()=>{var n,s;return{id:this.id,type:this.type,path:this.path,entityIdentifier:this.entityIdentifier,state:ft(this.state),transformer:this.transformer.repr(),renderer:this.renderer.repr(),bufferRenderer:this.bufferRenderer.repr(),segmentAnything:((n=this.segmentAnything)==null?void 0:n.repr())??null,filterer:((s=this.filterer)==null?void 0:s.repr())??null,hasCache:this.$canvasCache.get()!==null,isLocked:this.$isLocked.get(),isDisabled:this.$isDisabled.get(),isEntityTypeHidden:this.$isEntityTypeHidden.get(),isEmpty:this.$isEmpty.get(),isOnScreen:this.$isOnScreen.get(),intersectsBbox:this.$intersectsBbox.get(),konva:rs(this.konva.layer)}});this.type=i,this.id=n.id,this.entityIdentifier=n,this.manager=s,this.parent=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Ne.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1})},this.manager.stage.addLayer(this.konva.layer);const o=this.manager.stateApi.runSelector(this.selectState);Re(o!==void 0,"Missing entity state on creation"),this.state=o,this.selectIsTypeHidden=DU(this.entityIdentifier.type),this.selectIsSelected=RU(this.entityIdentifier),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsTypeHidden,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Mm,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Gb,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Dn,this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$filteringAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$transformingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.$segmentingAdapter.listen(this.syncVisibility)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectIsSelected,this.syncVisibility)),this.subscriptions.add(this.$isDisabled.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isLocked.subscribe(this.manager.tool.render)),this.subscriptions.add(this.$isEntityTypeHidden.subscribe(this.manager.tool.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIsOnscreen)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Hf,this.syncIntersectsBbox)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectPosition,this.syncIntersectsBbox))}};k(wo,"initCallbacks",new Set),k(wo,"registerInitCallback",n=>{const s=async i=>{const o=await n(i);return o&&wo.initCallbacks.delete(s),o};wo.initCallbacks.add(s)}),k(wo,"runInitCallbacks",n=>{for(const s of wo.initCallbacks)s(n)});let _l=wo;const fE=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s}=e;s(lC({entityIdentifier:n,imageDTO:t}))},pE=e=>{const{imageDTO:t,entityIdentifier:n,referenceImageId:s,dispatch:i}=e;i(cC({entityIdentifier:n,referenceImageId:s,imageDTO:t}))},Wie=e=>{const{imageDTO:t,dispatch:n}=e;n(Pm(t))},Uie=e=>{const{imageDTO:t,fieldIdentifier:n,dispatch:s}=e;s(zb({...n,value:t}))},qie=e=>{const{imageDTO:t,dispatch:n}=e;n(Pu(t))},Vr=e=>{const{type:t,imageDTO:n,dispatch:s,getState:i,overrides:o}=e,a=i(),l=Jr(n),{x:c,y:d}=Hf(a),h={objects:[l],position:{x:c,y:d},...o};switch(t){case"raster_layer":{s(Nl({overrides:h,isSelected:!0}));break}case"control_layer":{s(zf({overrides:{...h,controlAdapter:ft(Bl)},isSelected:!0}));break}case"inpaint_mask":{s(G0({overrides:h,isSelected:!0}));break}case"regional_guidance":{s(va({overrides:h,isSelected:!0}));break}case"reference_image":{const f=ft(No(i()));f.image=Sl(n),s(z0({overrides:{ipAdapter:f},isSelected:!0}));break}case"regional_guidance_with_reference_image":{const f=ft(No(i()));f.image=Sl(n);const p=[{id:_e("regional_guidance_reference_image"),ipAdapter:f}];s(va({overrides:{referenceImages:p},isSelected:!0}));break}}},ug=e=>{const{type:t,imageDTO:n,withResize:s,dispatch:i,getState:o}=e,a=o(),l=NU(a),c=n.width/n.height,d=VT(l),{width:h,height:f}=FU(c,d**2,l),p=Jr(n),{x:g,y:m}=Hf(a),y=x=>{_l.registerInitCallback(async C=>C.id!==x?!1:(await C.transformer.startTransform({silent:!0}),C.transformer.fitToBboxFill(),await C.transformer.applyTransform(),!0))};switch(t){case"raster_layer":{const x={id:_e("raster_layer"),objects:[p],position:{x:g,y:m}};s&&y(x.id),i(Ya()),i(Ih({x:0,y:0,width:h,height:f})),i(Nl({overrides:x,isSelected:!0}));break}case"control_layer":{const x={id:_e("control_layer"),objects:[p],position:{x:g,y:m},controlAdapter:ft(Bl)};s&&y(x.id),i(Ya()),i(Ih({x:0,y:0,width:h,height:f})),i(zf({overrides:x,isSelected:!0}));break}case"inpaint_mask":{const x={id:_e("inpaint_mask"),objects:[p],position:{x:g,y:m}};s&&y(x.id),i(Ya()),i(Ih({x:0,y:0,width:h,height:f})),i(G0({overrides:x,isSelected:!0}));break}case"regional_guidance":{const x={id:_e("regional_guidance"),objects:[p],position:{x:g,y:m}};s&&y(x.id),i(Ya()),i(Ih({x:0,y:0,width:h,height:f})),i(va({overrides:x,isSelected:!0}));break}case"reference_image":{const x=ft(No(o()));x.image=Sl(n),i(Ya()),i(z0({overrides:{ipAdapter:x},isSelected:!0}));break}case"regional_guidance_with_reference_image":{const x=ft(No(o()));x.image=Sl(n);const C=[{id:_e("regional_guidance_reference_image"),ipAdapter:x}];i(Ya()),i(va({overrides:{referenceImages:C},isSelected:!0}));break}default:Re(!1)}},yS=e=>{const{imageDTO:t,entityIdentifier:n,dispatch:s,getState:i}=e,o=Jr(t),{x:a,y:l}=Hf(i());s(uC({entityIdentifier:n,imageObject:o,position:{x:a,y:l},replaceObjects:!0,isSelected:!0}))},O4=e=>{const{imageDTOs:t,boardId:n,dispatch:s}=e;s(dC.endpoints.addImagesToBoard.initiate({imageDTOs:t,board_id:n},{track:!1})),s(H0([]))},N4=e=>{const{imageDTOs:t,dispatch:n}=e;n(dC.endpoints.removeImagesFromBoard.initiate({imageDTOs:t},{track:!1})),n(H0([]))};var gE={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},F4=me.createContext&&me.createContext(gE),Kie=["attr","size","title"];function Zie(e,t){if(e==null)return{};var n=Yie(e,t),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function Yie(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function Nm(){return Nm=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Nm.apply(this,arguments)}function B4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function Fm(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?B4(Object(n),!0).forEach(function(s){Xie(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B4(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Xie(e,t,n){return t=Qie(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qie(e){var t=Jie(e,"string");return typeof t=="symbol"?t:t+""}function Jie(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function mE(e){return e&&e.map((t,n)=>me.createElement(t.tag,Fm({key:n},t.attr),mE(t.child)))}function pe(e){return t=>me.createElement(eoe,Nm({attr:Fm({},e.attr)},t),mE(e.child))}function eoe(e){var t=n=>{var{attr:s,size:i,title:o}=e,a=Zie(e,Kie),l=i||n.size||"1em",c;return n.className&&(c=n.className),e.className&&(c=(c?c+" ":"")+e.className),me.createElement("svg",Nm({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,a,{className:c,style:Fm(Fm({color:e.color||n.color},n.style),e.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&me.createElement("title",null,o),e.children)};return F4!==void 0?me.createElement(F4.Consumer,null,n=>t(n)):t(gE)}function yE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V88a20,20,0,0,0,16,19.6V192a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V107.6A20,20,0,0,0,244,88V64A20,20,0,0,0,224,44ZM36,68H220V84H36ZM52,188V108H204v80Zm112-52a12,12,0,0,1-12,12H104a12,12,0,0,1,0-24h48A12,12,0,0,1,164,136Z"},child:[]}]})(e)}function vE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,200a12,12,0,0,1-24,0,84.09,84.09,0,0,0-84-84H61l27.52,27.51a12,12,0,0,1-17,17l-48-48a12,12,0,0,1,0-17l48-48a12,12,0,0,1,17,17L61,92h67A108.12,108.12,0,0,1,236,200Z"},child:[]}]})(e)}function toe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function ho(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a100,100,0,0,1-98.66,100H128a99.39,99.39,0,0,1-68.62-27.29,12,12,0,0,1,16.48-17.45,76,76,0,1,0-1.57-109c-.13.13-.25.25-.39.37L54.89,92H72a12,12,0,0,1,0,24H24a12,12,0,0,1-12-12V56a12,12,0,0,1,24,0V76.72L57.48,57.06A100,100,0,0,1,228,128Z"},child:[]}]})(e)}function noe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,152.49l-72,72a12,12,0,0,1-17,0l-72-72a12,12,0,0,1,17-17L116,187V40a12,12,0,0,1,24,0V187l51.51-51.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function soe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H69l51.52,51.51a12,12,0,0,1-17,17l-72-72a12,12,0,0,1,0-17l72-72a12,12,0,0,1,17,17L69,116H216A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function roe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M47.51,112.49a12,12,0,0,1,17-17L116,147V32a12,12,0,0,1,24,0V147l51.51-51.52a12,12,0,0,1,17,17l-72,72a12,12,0,0,1-17,0ZM216,204H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function ioe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,143.51a12,12,0,0,1-17,17L140,109V224a12,12,0,0,1-24,0V109L64.49,160.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0ZM216,28H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function ooe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.49,136.49l-72,72a12,12,0,0,1-17-17L187,140H40a12,12,0,0,1,0-24H187L135.51,64.48a12,12,0,0,1,17-17l72,72A12,12,0,0,1,224.49,136.49Z"},child:[]}]})(e)}function _1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,104a12,12,0,0,1-24,0V69l-59.51,59.51a12,12,0,0,1-17-17L187,52H152a12,12,0,0,1,0-24h64a12,12,0,0,1,12,12Zm-44,24a12,12,0,0,0-12,12v64H52V84h64a12,12,0,0,0,0-24H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V140A12,12,0,0,0,184,128Z"},child:[]}]})(e)}function bE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,120.49a12,12,0,0,1-17,0L140,69V216a12,12,0,0,1-24,0V69L64.49,120.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0l72,72A12,12,0,0,1,208.49,120.49Z"},child:[]}]})(e)}function aoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V96a12,12,0,0,1-12,12H168a12,12,0,0,1,0-24h19l-7.8-7.8a75.55,75.55,0,0,0-53.32-22.26h-.43A75.49,75.49,0,0,0,72.39,75.57,12,12,0,1,1,55.61,58.41a99.38,99.38,0,0,1,69.87-28.47H126A99.42,99.42,0,0,1,196.2,59.23L204,67V48a12,12,0,0,1,24,0ZM183.61,180.43a75.49,75.49,0,0,1-53.09,21.63h-.43A75.55,75.55,0,0,1,76.77,179.8L69,172H88a12,12,0,0,0,0-24H40a12,12,0,0,0-12,12v48a12,12,0,0,0,24,0V189l7.8,7.8A99.42,99.42,0,0,0,130,226.06h.56a99.38,99.38,0,0,0,69.87-28.47,12,12,0,0,0-16.78-17.16Z"},child:[]}]})(e)}function Bm(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"},child:[]}]})(e)}function loe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120.49,167.51a12,12,0,0,1,0,17l-32,32a12,12,0,0,1-17,0l-32-32a12,12,0,1,1,17-17L68,179V48a12,12,0,0,1,24,0V179l11.51-11.52A12,12,0,0,1,120.49,167.51Zm96-96-32-32a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17L164,77V208a12,12,0,0,0,24,0V77l11.51,11.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function coe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,184.49l-32,32a12,12,0,0,1-17-17L179,188H48a12,12,0,0,1,0-24H179l-11.52-11.51a12,12,0,0,1,17-17l32,32A12,12,0,0,1,216.49,184.49Zm-145-64a12,12,0,0,0,17-17L77,92H208a12,12,0,0,0,0-24H77L88.49,56.49a12,12,0,0,0-17-17l-32,32a12,12,0,0,0,0,17Z"},child:[]}]})(e)}function I1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M220,48V96a12,12,0,0,1-24,0V77l-35.51,35.52a12,12,0,0,1-17-17L179,60H160a12,12,0,0,1,0-24h48A12,12,0,0,1,220,48ZM95.51,143.51,60,179V160a12,12,0,0,0-24,0v48a12,12,0,0,0,12,12H96a12,12,0,0,0,0-24H77l35.52-35.51a12,12,0,0,0-17-17ZM208,148a12,12,0,0,0-12,12v19l-35.51-35.52a12,12,0,0,0-17,17L179,196H160a12,12,0,0,0,0,24h48a12,12,0,0,0,12-12V160A12,12,0,0,0,208,148ZM77,60H96a12,12,0,0,0,0-24H48A12,12,0,0,0,36,48V96a12,12,0,0,0,24,0V77l35.51,35.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function xE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.29,182.17a12,12,0,0,1-16.47,4.12L140,149.19V216a12,12,0,0,1-24,0V149.19l-61.82,37.1a12,12,0,1,1-12.35-20.58L104.68,128,41.83,90.29A12,12,0,1,1,54.18,69.71L116,106.81V40a12,12,0,0,1,24,0v66.81l61.82-37.1a12,12,0,1,1,12.35,20.58L151.32,128l62.85,37.71A12,12,0,0,1,218.29,182.17Z"},child:[]}]})(e)}function uoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,28H72A20,20,0,0,0,52,48V224a12,12,0,0,0,18.36,10.18l57.63-36,57.65,36A12,12,0,0,0,204,224V48A20,20,0,0,0,184,28Zm-4,174.35-45.65-28.53a12,12,0,0,0-12.72,0L76,202.35V52H180Z"},child:[]}]})(e)}function La(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,100a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H176a20,20,0,0,0-20,20v4H100V48A20,20,0,0,0,80,28H48A20,20,0,0,0,28,48V80a20,20,0,0,0,20,20h4v56H48a20,20,0,0,0-20,20v32a20,20,0,0,0,20,20H80a20,20,0,0,0,20-20v-4h56v4a20,20,0,0,0,20,20h32a20,20,0,0,0,20-20V176a20,20,0,0,0-20-20h-4V100ZM180,52h24V76H180ZM52,52H76V76H52ZM76,204H52V180H76Zm128,0H180V180h24Zm-24-48h-4a20,20,0,0,0-20,20v4H100v-4a20,20,0,0,0-20-20H76V100h4a20,20,0,0,0,20-20V76h56v4a20,20,0,0,0,20,20h4Z"},child:[]}]})(e)}function doe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M54.8,119.49A35.06,35.06,0,0,1,49.05,128a35.06,35.06,0,0,1,5.75,8.51C60,147.24,60,159.83,60,172c0,25.94,1.84,32,20,32a12,12,0,0,1,0,24c-19.14,0-32.2-6.9-38.8-20.51C36,196.76,36,184.17,36,172c0-25.94-1.84-32-20-32a12,12,0,0,1,0-24c18.16,0,20-6.06,20-32,0-12.17,0-24.76,5.2-35.49C47.8,34.9,60.86,28,80,28a12,12,0,0,1,0,24c-18.16,0-20,6.06-20,32C60,96.17,60,108.76,54.8,119.49ZM240,116c-18.16,0-20-6.06-20-32,0-12.17,0-24.76-5.2-35.49C208.2,34.9,195.14,28,176,28a12,12,0,0,0,0,24c18.16,0,20,6.06,20,32,0,12.17,0,24.76,5.2,35.49A35.06,35.06,0,0,0,207,128a35.06,35.06,0,0,0-5.75,8.51C196,147.24,196,159.83,196,172c0,25.94-1.84,32-20,32a12,12,0,0,0,0,24c19.14,0,32.2-6.9,38.8-20.51C220,196.76,220,184.17,220,172c0-25.94,1.84-32,20-32a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function hoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.24,213.21C216.12,203,204,180.64,204,152V134.73a19.94,19.94,0,0,0-12.62-18.59l-24.86-9.81a4,4,0,0,1-2.26-5.14l21.33-53A32,32,0,0,0,167.17,6,32.13,32.13,0,0,0,126.25,24.2l-.07.18-21,53.09a3.94,3.94,0,0,1-2.14,2.2,3.89,3.89,0,0,1-3,.06L74.6,69.43A19.89,19.89,0,0,0,52.87,74C31.06,96.43,20,122.68,20,152a115.46,115.46,0,0,0,32.29,80.3A12,12,0,0,0,61,236H232a12,12,0,0,0,5.24-22.79ZM68.19,92.73,91.06,102A28,28,0,0,0,127.5,86.31l20.95-53a8.32,8.32,0,0,1,10.33-4.81,8,8,0,0,1,4.61,10.57,1.17,1.17,0,0,0,0,.11L142,92.29a28.05,28.05,0,0,0,15.68,36.33L180,137.45V152c0,1,0,2.07.05,3.1l-122.44-49A101.91,101.91,0,0,1,68.19,92.73ZM116.74,212a83.73,83.73,0,0,1-22.09-39,12,12,0,0,0-23.25,6,110.27,110.27,0,0,0,14.49,33H66.25A91.53,91.53,0,0,1,44,152a84,84,0,0,1,3.41-24.11l136.67,54.66A86.58,86.58,0,0,0,198.66,212Z"},child:[]}]})(e)}function foe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,160a12,12,0,0,0,0-24H212V120h12a12,12,0,0,0,0-24H210.45a83.7,83.7,0,0,0-18.78-38.7l16.82-16.81a12,12,0,1,0-17-17l-18,18a83.7,83.7,0,0,0-91.1,0l-18-18a12,12,0,0,0-17,17L64.33,57.3A83.7,83.7,0,0,0,45.55,96H32a12,12,0,0,0,0,24H44v16H32a12,12,0,0,0,0,24H44a83.55,83.55,0,0,0,1.55,16H32a12,12,0,0,0,0,24H54.15a84,84,0,0,0,147.7,0H224a12,12,0,0,0,0-24H210.45A83.55,83.55,0,0,0,212,160ZM128,52a60.1,60.1,0,0,1,57.82,44H70.18A60.1,60.1,0,0,1,128,52Zm12,166.79V148a12,12,0,0,0-24,0v70.79A60.09,60.09,0,0,1,68,160V120H188v40A60.09,60.09,0,0,1,140,218.79Z"},child:[]}]})(e)}function Pr(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,104.49l-80,80a12,12,0,0,1-17,0l-80-80a12,12,0,0,1,17-17L128,159l71.51-71.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function vS(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M168.49,199.51a12,12,0,0,1-17,17l-80-80a12,12,0,0,1,0-17l80-80a12,12,0,0,1,17,17L97,128Z"},child:[]}]})(e)}function A1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"},child:[]}]})(e)}function CE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,168.49a12,12,0,0,1-17,0L128,97,56.49,168.49a12,12,0,0,1-17-17l80-80a12,12,0,0,1,17,0l80,80A12,12,0,0,1,216.49,168.49Z"},child:[]}]})(e)}function mp(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function poe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Z"},child:[]}]})(e)}function goe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,128a108,108,0,0,1-216,0c0-42.52,24.73-81.34,63-98.9A12,12,0,1,1,93,50.91C63.24,64.57,44,94.83,44,128a84,84,0,0,0,168,0c0-33.17-19.24-63.43-49-77.09A12,12,0,1,1,173,29.1C211.27,46.66,236,85.48,236,128Z"},child:[]}]})(e)}function SE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM52,52H76v95.22a24,24,0,1,0,24,0V125l40,40v39H52ZM204,204H164V160a12,12,0,0,0-3.51-8.49L100,91V52h24V72a12,12,0,0,0,3.51,8.49l17.31,17.3a24,24,0,1,0,17-17L148,67V52h56Z"},child:[]}]})(e)}function moe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.68,97.22,34.74,128l36.94,30.78a12,12,0,1,1-15.36,18.44l-48-40a12,12,0,0,1,0-18.44l48-40A12,12,0,0,1,71.68,97.22Zm176,21.56-48-40a12,12,0,1,0-15.36,18.44L221.26,128l-36.94,30.78a12,12,0,1,0,15.36,18.44l48-40a12,12,0,0,0,0-18.44ZM164.1,28.72a12,12,0,0,0-15.38,7.18l-64,176a12,12,0,0,0,7.18,15.37A11.79,11.79,0,0,0,96,228a12,12,0,0,0,11.28-7.9l64-176A12,12,0,0,0,164.1,28.72Z"},child:[]}]})(e)}function on(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,28H88A12,12,0,0,0,76,40V76H40A12,12,0,0,0,28,88V216a12,12,0,0,0,12,12H168a12,12,0,0,0,12-12V180h36a12,12,0,0,0,12-12V40A12,12,0,0,0,216,28ZM156,204H52V100H156Zm48-48H180V88a12,12,0,0,0-12-12H100V52H204Z"},child:[]}]})(e)}function wE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,192a12,12,0,0,1-12,12H204v28a12,12,0,0,1-24,0V204H64a12,12,0,0,1-12-12V76H24a12,12,0,0,1,0-24H52V24a12,12,0,0,1,24,0V180H232A12,12,0,0,1,244,192ZM104,76h76v76a12,12,0,0,0,24,0V64a12,12,0,0,0-12-12H104a12,12,0,0,0,0,24Z"},child:[]}]})(e)}function yoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.6,62.64l-88-48.17a19.91,19.91,0,0,0-19.2,0l-88,48.17A20,20,0,0,0,20,80.19v95.62a20,20,0,0,0,10.4,17.55l88,48.17a19.89,19.89,0,0,0,19.2,0l88-48.17A20,20,0,0,0,236,175.81V80.19A20,20,0,0,0,225.6,62.64ZM128,36.57,200,76,128,115.4,56,76ZM44,96.79l72,39.4v76.67L44,173.44Zm96,116.07V136.19l72-39.4v76.65Z"},child:[]}]})(e)}function voe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.15,179.17l-46.83-46.82,37.93-13.51.76-.3a20,20,0,0,0-1.76-37.27L54.16,29A20,20,0,0,0,29,54.16L81.27,214.24A20,20,0,0,0,118.54,216c.11-.25.21-.5.3-.76l13.51-37.92,46.83,46.82a20,20,0,0,0,28.28,0l16.69-16.68A20,20,0,0,0,224.15,179.17Zm-30.83,25.17-48.48-48.48A20,20,0,0,0,130.7,150a20.66,20.66,0,0,0-3.74.35A20,20,0,0,0,112.35,162c-.11.25-.21.5-.3.76L100.4,195.5,54.29,54.29l141.21,46.1-32.71,11.66c-.26.09-.51.19-.76.3a20,20,0,0,0-6.17,32.48h0l48.49,48.48Z"},child:[]}]})(e)}function boe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,128a16,16,0,1,1-16-16A16,16,0,0,1,144,128ZM60,112a16,16,0,1,0,16,16A16,16,0,0,0,60,112Zm136,0a16,16,0,1,0,16,16A16,16,0,0,0,196,112Z"},child:[]}]})(e)}function jE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.51,88.49a12,12,0,0,1,17-17L116,99V24a12,12,0,0,1,24,0V99l27.51-27.52a12,12,0,0,1,17,17l-48,48a12,12,0,0,1-17,0ZM224,116H188a12,12,0,0,0,0,24h32v56H36V140H68a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116Zm-20,52a16,16,0,1,0-16,16A16,16,0,0,0,204,168Z"},child:[]}]})(e)}function Vu(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0Zm-108.49,8.49a12,12,0,0,0,17,0l40-40a12,12,0,0,0-17-17L140,115V32a12,12,0,0,0-24,0v83L96.49,95.51a12,12,0,0,0-17,17Z"},child:[]}]})(e)}function xoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M134.88,6.17a12,12,0,0,0-13.76,0,259,259,0,0,0-42.18,39C50.85,77.43,36,111.63,36,144a92,92,0,0,0,184,0C220,66.64,138.36,8.6,134.88,6.17ZM194.08,160H140V144h56A68,68,0,0,1,194.08,160ZM140,120V104h47a115,115,0,0,1,5.68,16Zm19.3-58.71A197.29,197.29,0,0,1,173.68,80H140V41.46A243.5,243.5,0,0,1,159.3,61.29ZM60,144c0-33.31,20-63.37,36.7-82.71A243.5,243.5,0,0,1,116,41.46V210.92A68.1,68.1,0,0,1,60,144Zm80,66.92V184h42.94A68,68,0,0,1,140,210.92Z"},child:[]}]})(e)}function Coe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,204H141l86.84-86.84a28,28,0,0,0,0-39.6L186.43,36.19a28,28,0,0,0-39.6,0L28.19,154.82a28,28,0,0,0,0,39.6l30.06,30.07A12,12,0,0,0,66.74,228H216a12,12,0,0,0,0-24ZM163.8,53.16a4,4,0,0,1,5.66,0l41.38,41.38a4,4,0,0,1,0,5.65L160,151l-47-47ZM71.71,204,45.16,177.45a4,4,0,0,1,0-5.65L96,121l47,47-36,36Z"},child:[]}]})(e)}function kE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M148,200a20,20,0,1,1-20-20A20,20,0,0,1,148,200Zm-20-40a12,12,0,0,0,12-12V48a12,12,0,0,0-24,0V148A12,12,0,0,0,128,160Z"},child:[]}]})(e)}function yp(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M251,123.13c-.37-.81-9.13-20.26-28.48-39.61C196.63,57.67,164,44,128,44S59.37,57.67,33.51,83.52C14.16,102.87,5.4,122.32,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212s68.63-13.66,94.48-39.51c19.36-19.35,28.12-38.79,28.49-39.61A12.08,12.08,0,0,0,251,123.13Zm-46.06,33C183.47,177.27,157.59,188,128,188s-55.47-10.73-76.91-31.88A130.36,130.36,0,0,1,29.52,128,130.45,130.45,0,0,1,51.09,99.89C72.54,78.73,98.41,68,128,68s55.46,10.73,76.91,31.89A130.36,130.36,0,0,1,226.48,128,130.45,130.45,0,0,1,204.91,156.12ZM128,84a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function Soe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.42,162A12,12,0,1,1,213.58,174l-16.86-29.5a127.19,127.19,0,0,1-30.17,13.86L171.84,190a12,12,0,0,1-9.87,13.8,11.22,11.22,0,0,1-2,.17,12,12,0,0,1-11.82-10L143,163.17a136.5,136.5,0,0,1-30.06,0L107.84,194A12,12,0,0,1,96,204a11.22,11.22,0,0,1-2-.17A12,12,0,0,1,84.16,190l5.29-31.72a127.19,127.19,0,0,1-30.17-13.86L42.42,174A12,12,0,1,1,21.58,162L40,129.85a159.73,159.73,0,0,1-17.31-18.31A12,12,0,0,1,41.34,96.46C57.38,116.32,85.44,140,128,140s70.62-23.68,86.66-43.54a12,12,0,0,1,18.67,15.08A159.73,159.73,0,0,1,216,129.85Z"},child:[]}]})(e)}function woe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M56.88,31.93A12,12,0,1,0,39.12,48.07l16,17.65C20.67,88.66,5.72,121.58,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212a131.34,131.34,0,0,0,51-10l20.09,22.1a12,12,0,0,0,17.76-16.14ZM128,188c-29.59,0-55.47-10.73-76.91-31.88A130.69,130.69,0,0,1,29.52,128c5.27-9.31,18.79-29.9,42-44.29l90.09,99.11A109.33,109.33,0,0,1,128,188Zm123-55.12c-.36.81-9,20-28,39.16a12,12,0,1,1-17-16.9A130.48,130.48,0,0,0,226.48,128a130.36,130.36,0,0,0-21.57-28.12C183.46,78.73,157.59,68,128,68c-3.35,0-6.7.14-10,.42a12,12,0,1,1-2-23.91c3.93-.34,8-.51,12-.51,36,0,68.63,13.67,94.49,39.52,19.35,19.35,28.11,38.8,28.48,39.61A12.08,12.08,0,0,1,251,132.88Z"},child:[]}]})(e)}function joe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,67.24a39.77,39.77,0,0,0-12.51-28.52C199.91,24,174.71,24.5,159.29,39.93L142.48,56.84a28,28,0,0,0-35.64,3.29l-9,9a20,20,0,0,0-.73,27.49L48.9,144.84A43.76,43.76,0,0,0,37,185.28l-7.5,17.19a17.66,17.66,0,0,0,3.71,19.65,19.9,19.9,0,0,0,22.15,4.19l16.31-7.13a43.88,43.88,0,0,0,39.45-12.09l48.24-48.26a20,20,0,0,0,27.47-.73l9-9a28.06,28.06,0,0,0,3.26-35.72l17.23-17.33A39.69,39.69,0,0,0,228,67.24ZM94.15,190.11a20,20,0,0,1-20,5,11.93,11.93,0,0,0-8.32.47L57,199.38,60.69,191a12,12,0,0,0,.37-8.64,19.92,19.92,0,0,1,4.81-20.55l48.2-48.22,28.28,28.3Zm105.14-111-25.37,25.52a12,12,0,0,0,0,16.95l4.88,4.89a4,4,0,0,1,0,5.66l-6.14,6.15-55-55.05,6.14-6.14a4,4,0,0,1,5.65,0L134.35,82a12,12,0,0,0,8.49,3.51h0A12,12,0,0,0,151.34,82l24.94-25.08c6.3-6.3,16.48-6.63,22.71-.74a16,16,0,0,1,.3,23Z"},child:[]}]})(e)}function dg(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Z"},child:[]}]})(e)}function uf(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.51l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.51ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm104-60a12,12,0,0,1-12,12H140v12a12,12,0,0,1-24,0V164H104a12,12,0,0,1,0-24h12V128a12,12,0,0,1,24,0v12h12A12,12,0,0,1,164,152Z"},child:[]}]})(e)}function bS(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.15,197.71,164,95.81V44h4a12,12,0,0,0,0-24H88a12,12,0,0,0,0,24h4V95.81L30.85,197.71A20,20,0,0,0,48,228H208a20,20,0,0,0,17.15-30.29ZM140,44V99.14a12,12,0,0,0,1.71,6.17l35.13,58.54c-10.79.86-25.15-1.31-43.42-10.56-14-7.08-27.46-11.33-40.27-12.76l21.14-35.22A12,12,0,0,0,116,99.14V44ZM55.06,204,79,164.19c13-1.11,27.62,2.42,43.62,10.52,19.61,9.92,36.25,13.31,49.85,13.31A75.44,75.44,0,0,0,190.11,186l10.83,18Z"},child:[]}]})(e)}function Ui(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M222.14,69.17,186.83,33.86A19.86,19.86,0,0,0,172.69,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V83.31A19.86,19.86,0,0,0,222.14,69.17ZM164,204H92V160h72Zm40,0H188V156a20,20,0,0,0-20-20H88a20,20,0,0,0-20,20v48H52V52H171l33,33ZM164,84a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h56A12,12,0,0,1,164,84Z"},child:[]}]})(e)}function T1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M248.49,71.51l-32-32a12,12,0,0,0-17,17L211,68h-3c-52,0-64.8,30.71-75.08,55.38-8.82,21.17-15.45,37.05-42.75,40.09a44,44,0,1,0,.28,24.08c43.34-3.87,55.07-32,64.63-54.93C164.9,109,172,92,208,92h3l-11.52,11.51a12,12,0,0,0,17,17l32-32A12,12,0,0,0,248.49,71.51ZM48,196a20,20,0,1,1,20-20A20,20,0,0,1,48,196Z"},child:[]}]})(e)}function _E(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,56H160L133.33,36a20.12,20.12,0,0,0-12-4H76A20,20,0,0,0,56,52V72H36A20,20,0,0,0,16,92V204a20,20,0,0,0,20,20H188.89A19.13,19.13,0,0,0,208,204.89V184h20.89A19.13,19.13,0,0,0,248,164.89V76A20,20,0,0,0,228,56ZM184,200H40V96H80l28.8,21.6A12,12,0,0,0,116,120h68Zm40-40H208V116a20,20,0,0,0-20-20H120L93.33,76a20.12,20.12,0,0,0-12-4H80V56h40l28.8,21.6A12,12,0,0,0,156,80h68Z"},child:[]}]})(e)}function vp(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,88a12,12,0,0,1,12-12h32a12,12,0,0,1,12,12v32a12,12,0,0,1-24,0V100H152A12,12,0,0,1,140,88ZM72,180h32a12,12,0,0,0,0-24H84V136a12,12,0,0,0-24,0v32A12,12,0,0,0,72,180ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},child:[]}]})(e)}function koe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},child:[]}]})(e)}function IE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M250.18,105.17,186.71,41.25a100.11,100.11,0,0,0-141.43,0l-.13.14L31.37,55.61a12,12,0,1,0,17.24,16.7L62.32,58.16A75.68,75.68,0,0,1,77.49,46.43L119,88,25.85,181.16a20,20,0,0,0,0,28.29l20.69,20.69a20,20,0,0,0,28.28,0L168,137l1.51,1.51h0l23.65,23.66a20,20,0,0,0,28.29,0l28.69-28.7A20,20,0,0,0,250.18,105.17ZM60.68,210.34l-15-15L108,133l15,15ZM140,131l-15-15,19.51-19.51a12,12,0,0,0,0-17L102.24,37.24a75.94,75.94,0,0,1,67.47,20.95l31.44,31.67L178,113l-1.51-1.51a12,12,0,0,0-17,0Zm67.32,11.31L195,130l23.09-23.09,12.3,12.39Z"},child:[]}]})(e)}function _oe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,44a32,32,0,0,0-8,1V44a32,32,0,0,0-60.79-14A32,32,0,0,0,76,60v50.83a32,32,0,0,0-52,36.7C55.82,214.6,75.35,244,128,244a92.1,92.1,0,0,0,92-92V76A32,32,0,0,0,188,44Zm8,108a68.08,68.08,0,0,1-68,68c-35.83,0-49.71-14-82.48-83.14-.14-.29-.29-.58-.45-.86a8,8,0,0,1,13.85-8l.21.35,18.68,30A12,12,0,0,0,100,152V60a8,8,0,0,1,16,0v60a12,12,0,0,0,24,0V44a8,8,0,0,1,16,0v76a12,12,0,0,0,24,0V76a8,8,0,0,1,16,0Z"},child:[]}]})(e)}function Ioe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,20H72A20,20,0,0,0,52,40V76a20.1,20.1,0,0,0,8,16l48,36L60,164a20.1,20.1,0,0,0-8,16v36a20,20,0,0,0,20,20H184a20,20,0,0,0,20-20V180.36a20.13,20.13,0,0,0-7.94-16L147.9,128l48.16-36.4a20.13,20.13,0,0,0,7.94-16V40A20,20,0,0,0,184,20Zm-4,24V60H76V44Zm-52,69L89.33,84h77Zm52,99H76V182l52-39,52,39.33Z"},child:[]}]})(e)}function mu(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,96a16,16,0,1,1,16,16A16,16,0,0,1,144,96Zm92-40V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56ZM44,60v79.72l33.86-33.86a20,20,0,0,1,28.28,0L147.31,147l17.18-17.17a20,20,0,0,1,28.28,0L212,149.09V60Zm0,136H162.34L92,125.66l-48,48Zm168,0V183l-33.37-33.37L164.28,164l32,32Z"},child:[]}]})(e)}function AE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M160,88a16,16,0,1,1,16,16A16,16,0,0,1,160,88Zm76-32V160a20,20,0,0,1-20,20H204v20a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V88A20,20,0,0,1,40,68H60V56A20,20,0,0,1,80,36H216A20,20,0,0,1,236,56ZM180,180H80a20,20,0,0,1-20-20V92H44V196H180Zm-21.66-24L124,121.66,89.66,156ZM212,60H84v67.72l25.86-25.86a20,20,0,0,1,28.28,0L192.28,156H212Z"},child:[]}]})(e)}function Aoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H88A20,20,0,0,0,68,48V60H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V188h12a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM92,52H204v59.72l-9.86-9.86a20,20,0,0,0-28.28,0L103.72,164H92Zm80,152H52V84H68v84a20,20,0,0,0,20,20h84Zm-34.34-40L180,121.66l24,24V164ZM108,88a20,20,0,1,1,20,20A20,20,0,0,1,108,88Z"},child:[]}]})(e)}function Gu(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M108,84a16,16,0,1,1,16,16A16,16,0,0,1,108,84Zm128,44A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Zm-72,36.68V132a20,20,0,0,0-20-20,12,12,0,0,0-4,23.32V168a20,20,0,0,0,20,20,12,12,0,0,0,4-23.32Z"},child:[]}]})(e)}function Toe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V192a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V64A20,20,0,0,0,224,44Zm-4,144H36V68H220ZM52,128a12,12,0,0,1,12-12H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,128Zm0-36A12,12,0,0,1,64,80H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,92Zm0,72a12,12,0,0,1,12-12h8a12,12,0,0,1,0,24H64A12,12,0,0,1,52,164Zm108,0a12,12,0,0,1-12,12H108a12,12,0,0,1,0-24h40A12,12,0,0,1,160,164Zm44,0a12,12,0,0,1-12,12h-8a12,12,0,0,1,0-24h8A12,12,0,0,1,204,164Z"},child:[]}]})(e)}function Moe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M180,232a12,12,0,0,1-12,12H88a12,12,0,0,1,0-24h80A12,12,0,0,1,180,232Zm40-128a92.47,92.47,0,0,1-37,73.73,7.81,7.81,0,0,0-3,6.27,20,20,0,0,1-20,20H96a20,20,0,0,1-20-20v-.23a7.76,7.76,0,0,0-3.25-6.2,91.36,91.36,0,0,1-36.75-73C35.73,54.69,76,13.2,125.79,12A92,92,0,0,1,220,104Zm-24,0a68,68,0,0,0-69.65-68C89.56,36.89,59.8,67.56,60,104.39a67.52,67.52,0,0,0,27.18,54h0A32.14,32.14,0,0,1,99.77,180H116V149L87.51,120.49a12,12,0,0,1,17-17L128,127l23.51-23.51a12,12,0,0,1,17,17L140,149v31h16.25a31.89,31.89,0,0,1,12.41-21.49A67.45,67.45,0,0,0,196,104Z"},child:[]}]})(e)}function Poe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M87.5,151.52l64-64a12,12,0,0,1,17,17l-64,64a12,12,0,0,1-17-17Zm131-114a60.08,60.08,0,0,0-84.87,0L103.51,67.61a12,12,0,0,0,17,17l30.07-30.06a36,36,0,0,1,50.93,50.92L171.4,135.52a12,12,0,1,0,17,17l30.08-30.06A60.09,60.09,0,0,0,218.45,37.55ZM135.52,171.4l-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function Eoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.45,122.43l-30.08,30.06a12,12,0,0,1-17-17l30.08-30.07a36,36,0,0,0-50.93-50.92L120.48,84.59a12,12,0,0,1-17-17l30.07-30.06a60,60,0,0,1,84.87,84.88Zm-82.93,49-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function Loe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM40,76H216a12,12,0,0,0,0-24H40a12,12,0,0,0,0,24ZM216,180H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function TE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H100V56a28,28,0,0,1,28-28c13.51,0,25.65,9.62,28.24,22.39a12,12,0,1,0,23.52-4.78C174.87,21.5,153.1,4,128,4A52.06,52.06,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76Zm-4,128H52V100H204Z"},child:[]}]})(e)}function ME(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},child:[]}]})(e)}function PE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H80a12,12,0,0,1,0-24h64A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function EE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H124v20a12,12,0,0,1-24,0V124H80a12,12,0,0,1,0-24h20V80a12,12,0,0,1,24,0v20h20A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function Doe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,60a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,60Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,124Zm0-112a92.1,92.1,0,0,0-92,92c0,77.36,81.64,135.4,85.12,137.83a12,12,0,0,0,13.76,0,259,259,0,0,0,42.18-39C205.15,170.57,220,136.37,220,104A92.1,92.1,0,0,0,128,12Zm31.3,174.71A249.35,249.35,0,0,1,128,216.89a249.35,249.35,0,0,1-31.3-30.18C80,167.37,60,137.31,60,104a68,68,0,0,1,136,0C196,137.31,176,167.37,159.3,186.71Z"},child:[]}]})(e)}function Roe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M84,108A12,12,0,0,1,96,96h64a12,12,0,0,1,0,24H96A12,12,0,0,1,84,108Zm32,28H96a12,12,0,0,0,0,24h20a12,12,0,0,0,0-24ZM228,48V156.69a19.86,19.86,0,0,1-5.86,14.14l-51.31,51.31A19.86,19.86,0,0,1,156.69,228H48a20,20,0,0,1-20-20V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48ZM52,204h92V156a12,12,0,0,1,12-12h48V52H52Zm139-36H168v23Z"},child:[]}]})(e)}function xS(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,32a12,12,0,0,0-12-12c-44.78,0-90,48.54-115.9,82a64,64,0,0,0-80,62c0,12-3.1,22.71-9.23,31.76A43,43,0,0,1,9.4,206.05a11.88,11.88,0,0,0-4.91,13.38A12.07,12.07,0,0,0,16.11,228h76A64,64,0,0,0,154,148C187.49,122.05,236,76.8,236,32ZM209.62,46.39c-4,12.92-13.15,27.49-26.92,42.91-3,3.39-6.16,6.7-9.35,9.89a104.31,104.31,0,0,0-16.5-16.51c3.19-3.19,6.49-6.32,9.88-9.35C182.15,59.55,196.71,50.43,209.62,46.39ZM92.07,204H42a80.17,80.17,0,0,0,10.14-40,40,40,0,1,1,40,40Zm38.18-91.32c3.12-3.93,6.55-8.09,10.23-12.35a80.52,80.52,0,0,1,15.23,15.24c-4.26,3.68-8.42,7.11-12.35,10.23A64.43,64.43,0,0,0,130.25,112.68Z"},child:[]}]})(e)}function bp(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M230.14,70.54,185.46,25.85a20,20,0,0,0-28.29,0L33.86,149.17A19.85,19.85,0,0,0,28,163.31V208a20,20,0,0,0,20,20H92.69a19.86,19.86,0,0,0,14.14-5.86L230.14,98.82a20,20,0,0,0,0-28.28ZM93,180l71-71,11,11-71,71ZM76,163,65,152l71-71,11,11ZM52,173l15.51,15.51h0L83,204H52ZM192,103,153,64l18.34-18.34,39,39Z"},child:[]}]})(e)}function LE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M255.62,51.65a12,12,0,0,0-11.27-11.27c-53.27-3.13-96.2,13.36-114.84,44.14-12.14,20-12.56,44.17-1.46,67.3a75.14,75.14,0,0,0-12.28,23l-12.66-12.66c7.19-16.77,6.43-34.11-2.4-48.69C86.73,90.36,54.89,78,15.55,80.27A12,12,0,0,0,4.28,91.55C2,130.89,14.36,162.73,37.45,176.71a49.76,49.76,0,0,0,26,7.27,57.54,57.54,0,0,0,22.7-4.87L112,205v23a12,12,0,0,0,24,0V198.51a51.63,51.63,0,0,1,9.49-29.95,76.82,76.82,0,0,0,32.1,7.39,64.91,64.91,0,0,0,33.89-9.46C242.25,147.85,258.76,104.92,255.62,51.65ZM49.88,156.18c-13.19-8-21.18-27.46-21.83-52.13,24.67.65,44.14,8.64,52.13,21.83a26,26,0,0,1,3.63,17L72.48,131.51a12,12,0,0,0-17,17l11.34,11.34A26.27,26.27,0,0,1,49.88,156.18ZM199.05,146c-10.66,6.45-23,7.67-35.81,3.76l37.25-37.24a12,12,0,0,0-17-17l-37.25,37.24C142.37,120,143.59,107.61,150,97c12.7-21,42.65-33,81.32-33H232C232.14,103,220.14,133.18,199.05,146Z"},child:[]}]})(e)}function Ht(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function DE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M28,64A12,12,0,0,1,40,52H216a12,12,0,0,1,0,24H40A12,12,0,0,1,28,64Zm104,52H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm0,64H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm120-20a12,12,0,0,1-5.64,10.18l-64,40A12,12,0,0,1,164,200V120a12,12,0,0,1,18.36-10.18l64,40A12,12,0,0,1,252,160Zm-34.64,0L188,141.65v36.7Z"},child:[]}]})(e)}function RE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M100,52H40A20,20,0,0,0,20,72v64a20,20,0,0,0,20,20H96v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,100,52Zm-4,80H44V76H96ZM216,52H156a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20h56v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,216,52Zm-4,80H160V76h52Z"},child:[]}]})(e)}function Ooe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,36H40A20,20,0,0,0,20,56V200a20,20,0,0,0,20,20H216a20,20,0,0,0,20-20V56A20,20,0,0,0,216,36Zm-4,160H44V60H212Z"},child:[]}]})(e)}function Noe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,108H48a12,12,0,0,0-12,12v88a12,12,0,0,0,12,12h88a12,12,0,0,0,12-12V120A12,12,0,0,0,136,108Zm-12,88H60V132h64Zm96-8v12a20,20,0,0,1-20,20H180a12,12,0,0,1,0-24h16v-8a12,12,0,0,1,24,0Zm0-72v24a12,12,0,0,1-24,0V116a12,12,0,0,1,24,0Zm0-60V72a12,12,0,0,1-24,0V60H184a12,12,0,0,1,0-24h16A20,20,0,0,1,220,56Zm-68-8a12,12,0,0,1-12,12H116a12,12,0,0,1,0-24h24A12,12,0,0,1,152,48ZM36,76V56A20,20,0,0,1,56,36H68a12,12,0,0,1,0,24H60V76a12,12,0,0,1-24,0Z"},child:[]}]})(e)}function Foe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M238.15,70.54,185.46,17.86a20,20,0,0,0-28.29,0L17.85,157.17a20,20,0,0,0,0,28.29l52.69,52.68a20,20,0,0,0,28.29,0L238.15,98.83A20,20,0,0,0,238.15,70.54ZM84.68,218.34l-47-47L64,145l23.52,23.52a12,12,0,0,0,17-17L81,128l15-15,23.51,23.52a12,12,0,0,0,17-17L113,96l15-15,23.52,23.52a12,12,0,0,0,17-17L145,64l26.35-26.34,47,47Z"},child:[]}]})(e)}function Boe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,216a12,12,0,0,1-12,12H112a12,12,0,0,1,0-24h32A12,12,0,0,1,156,216ZM40,156a12,12,0,0,0,12-12V112a12,12,0,0,0-24,0v32A12,12,0,0,0,40,156Zm32,48H52V184a12,12,0,0,0-24,0v24a20,20,0,0,0,20,20H72a12,12,0,0,0,0-24ZM228,48V208a20,20,0,0,1-20,20H184a12,12,0,0,1,0-24h3L52,69v3a12,12,0,0,1-24,0V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48Zm-24,4H69L204,187Z"},child:[]}]})(e)}function OE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,103.52l-80-80A12,12,0,0,0,140,32V68.74c-25.76,3.12-53.66,15.89-76.75,35.47-29.16,24.74-47.32,56.69-51.14,90A16,16,0,0,0,39.67,207h0c10.46-11.14,47-45.74,100.33-50.42V192a12,12,0,0,0,20.48,8.48l80-80A12,12,0,0,0,240.49,103.52ZM164,163V144a12,12,0,0,0-12-12c-49,0-86.57,21.56-109.79,40.11,7.13-18.16,19.63-35.22,36.57-49.59C101.3,103.41,128.67,92,152,92a12,12,0,0,0,12-12V61l51,51Z"},child:[]}]})(e)}function $oe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,175.51a12,12,0,0,1,0,17l-24,24a12,12,0,0,1-17-17L203,196h-2.09a76.17,76.17,0,0,1-61.85-31.83L97.38,105.78A52.1,52.1,0,0,0,55.06,84H32a12,12,0,0,1,0-24H55.06a76.17,76.17,0,0,1,61.85,31.83l41.71,58.39A52.1,52.1,0,0,0,200.94,172H203l-3.52-3.51a12,12,0,0,1,17-17Zm-95.62-72.62a12,12,0,0,0,16.93-1.13A52,52,0,0,1,200.94,84H203l-3.52,3.51a12,12,0,0,0,17,17l24-24a12,12,0,0,0,0-17l-24-24a12,12,0,0,0-17,17L203,60h-2.09a76,76,0,0,0-57.2,26A12,12,0,0,0,144.87,102.89Zm-33.74,50.22a12,12,0,0,0-16.93,1.13A52,52,0,0,1,55.06,172H32a12,12,0,0,0,0,24H55.06a76,76,0,0,0,57.2-26A12,12,0,0,0,111.13,153.11Z"},child:[]}]})(e)}function Voe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M40,92H70.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24H137.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24Zm64-24A12,12,0,1,1,92,80,12,12,0,0,1,104,68Zm112,96H201.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24h94.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24Zm-48,24a12,12,0,1,1,12-12A12,12,0,0,1,168,188Z"},child:[]}]})(e)}function Goe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,128a12,12,0,0,1-12,12H48a12,12,0,0,1,0-24h68A12,12,0,0,1,128,128ZM48,76H180a12,12,0,0,0,0-24H48a12,12,0,0,0,0,24Zm52,104H48a12,12,0,0,0,0,24h52a12,12,0,0,0,0-24Zm132.49-20.49a12,12,0,0,0-17,0L196,179V112a12,12,0,0,0-24,0v67l-19.51-19.52a12,12,0,0,0-17,17l40,40a12,12,0,0,0,17,0l40-40A12,12,0,0,0,232.49,159.51Z"},child:[]}]})(e)}function zoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M36,128a12,12,0,0,1,12-12h68a12,12,0,0,1,0,24H48A12,12,0,0,1,36,128ZM48,76h52a12,12,0,0,0,0-24H48a12,12,0,0,0,0,24ZM180,180H48a12,12,0,0,0,0,24H180a12,12,0,0,0,0-24ZM232.49,79.51l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,0,0,17,17L172,77v67a12,12,0,0,0,24,0V77l19.51,19.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function Hoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.36,170A12,12,0,0,1,230,186.37l-96,56a12,12,0,0,1-12.1,0l-96-56a12,12,0,0,1,12.09-20.74l90,52.48L218,165.63A12,12,0,0,1,234.36,170ZM218,117.63,128,170.11,38.05,117.63A12,12,0,0,0,26,138.37l96,56a12,12,0,0,0,12.1,0l96-56A12,12,0,0,0,218,117.63ZM20,80a12,12,0,0,1,6-10.37l96-56a12.06,12.06,0,0,1,12.1,0l96,56a12,12,0,0,1,0,20.74l-96,56a12,12,0,0,1-12.1,0l-96-56A12,12,0,0,1,20,80Zm35.82,0L128,122.11,200.18,80,128,37.89Z"},child:[]}]})(e)}function NE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10.05,110.42l112,64a12,12,0,0,0,11.9,0l112-64a12,12,0,0,0,0-20.84l-112-64a12,12,0,0,0-11.9,0l-112,64a12,12,0,0,0,0,20.84Zm118-60.6L215.81,100,128,150.18,40.19,100Zm122.42,92.23A12,12,0,0,1,246,158.42l-112,64a12,12,0,0,1-11.9,0l-112-64A12,12,0,1,1,22,137.58l106,60.6,106-60.6A12,12,0,0,1,250.42,142.05Z"},child:[]}]})(e)}function CS(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243,96a20.33,20.33,0,0,0-17.74-14l-56.59-4.57L146.83,24.62a20.36,20.36,0,0,0-37.66,0L87.35,77.44,30.76,82A20.45,20.45,0,0,0,19.1,117.88l43.18,37.24-13.2,55.7A20.37,20.37,0,0,0,79.57,233L128,203.19,176.43,233a20.39,20.39,0,0,0,30.49-22.15l-13.2-55.7,43.18-37.24A20.43,20.43,0,0,0,243,96ZM172.53,141.7a12,12,0,0,0-3.84,11.86L181.58,208l-47.29-29.08a12,12,0,0,0-12.58,0L74.42,208l12.89-54.4a12,12,0,0,0-3.84-11.86L41.2,105.24l55.4-4.47a12,12,0,0,0,10.13-7.38L128,41.89l21.27,51.5a12,12,0,0,0,10.13,7.38l55.4,4.47Z"},child:[]}]})(e)}function Hr(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V152a20,20,0,0,1-20,20H112.92a12,12,0,0,1-17.41,16.49l-20-20a12,12,0,0,1,0-17l20-20A12,12,0,0,1,112.92,148H204V52H100a12,12,0,0,1-24,0V48A20,20,0,0,1,96,28H208A20,20,0,0,1,228,48ZM168,192a12,12,0,0,0-12,12H52V108h91.08a12,12,0,0,0,17.41,16.49l20-20a12,12,0,0,0,0-17l-20-20A12,12,0,0,0,143.08,84H48a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20H160a20,20,0,0,0,20-20v-4A12,12,0,0,0,168,192Z"},child:[]}]})(e)}function FE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H180V36A28,28,0,0,0,152,8H104A28,28,0,0,0,76,36V48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM100,36a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V48H100Zm88,168H68V72H188ZM116,104v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Zm48,0v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function Xr(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM188,204H68V72H188ZM76,20A12,12,0,0,1,88,8h80a12,12,0,0,1,0,24H88A12,12,0,0,1,76,20Z"},child:[]}]})(e)}function xp(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,184a16,16,0,1,1,16-16A16,16,0,0,1,188,184Zm36-68H180a12,12,0,0,0,0,24h40v56H36V140H76a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116ZM88.49,80.49,116,53v75a12,12,0,0,0,24,0V53l27.51,27.52a12,12,0,1,0,17-17l-48-48a12,12,0,0,0-17,0l-48,48a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function M1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0ZM96.49,80.49,116,61v83a12,12,0,0,0,24,0V61l19.51,19.52a12,12,0,1,0,17-17l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function Woe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M125.18,156.94a64,64,0,1,0-82.36,0,100.23,100.23,0,0,0-39.49,32,12,12,0,0,0,19.35,14.2,76,76,0,0,1,122.64,0,12,12,0,0,0,19.36-14.2A100.33,100.33,0,0,0,125.18,156.94ZM44,108a40,40,0,1,1,40,40A40,40,0,0,1,44,108Zm206.1,97.67a12,12,0,0,1-16.78-2.57A76.31,76.31,0,0,0,172,172a12,12,0,0,1,0-24,40,40,0,1,0-10.3-78.67,12,12,0,1,1-6.16-23.19,64,64,0,0,1,57.64,110.8,100.23,100.23,0,0,1,39.49,32A12,12,0,0,1,250.1,205.67Z"},child:[]}]})(e)}function Cp(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.26,186.1,152.81,34.23h0a28.74,28.74,0,0,0-49.62,0L15.74,186.1a27.45,27.45,0,0,0,0,27.71A28.31,28.31,0,0,0,40.55,228h174.9a28.31,28.31,0,0,0,24.79-14.19A27.45,27.45,0,0,0,240.26,186.1Zm-20.8,15.7a4.46,4.46,0,0,1-4,2.2H40.55a4.46,4.46,0,0,1-4-2.2,3.56,3.56,0,0,1,0-3.73L124,46.2a4.77,4.77,0,0,1,8,0l87.44,151.87A3.56,3.56,0,0,1,219.46,201.8ZM116,136V104a12,12,0,0,1,24,0v32a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,176Z"},child:[]}]})(e)}function BE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},child:[]}]})(e)}function Nt(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,191.51a12,12,0,0,1-17,17L128,145,64.49,208.49a12,12,0,0,1-17-17L111,128,47.51,64.49a12,12,0,0,1,17-17L128,111l63.51-63.52a12,12,0,0,1,17,17L145,128Z"},child:[]}]})(e)}function Uoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,48H32A16,16,0,0,0,16,64V88a16,16,0,0,0,16,16v88a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V104a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48Zm-72,96H104a8,8,0,0,1,0-16h48a8,8,0,0,1,0,16Zm72-56H32V64H224V88Z"},child:[]}]})(e)}function qoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Z"},child:[]}]})(e)}function Koe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z"},child:[]}]})(e)}function $E(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32Zm-8,128H176V88a8,8,0,0,0-8-8H96V48H208Z"},child:[]}]})(e)}function Zoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128Z"},child:[]}]})(e)}function SS(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM48,100a28,28,0,1,0,28,28A28,28,0,0,0,48,100Zm160,0a28,28,0,1,0,28,28A28,28,0,0,0,208,100Z"},child:[]}]})(e)}function Yoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM128,76a28,28,0,1,0-28-28A28,28,0,0,0,128,76Zm0,104a28,28,0,1,0,28,28A28,28,0,0,0,128,180Z"},child:[]}]})(e)}function zu(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.94,107.21a8,8,0,0,0-3.89-5.4l-29.83-17-.12-33.62a8,8,0,0,0-2.83-6.08,111.91,111.91,0,0,0-36.72-20.67,8,8,0,0,0-6.46.59L128,41.85,97.88,25a8,8,0,0,0-6.47-.6A111.92,111.92,0,0,0,54.73,45.15a8,8,0,0,0-2.83,6.07l-.15,33.65-29.83,17a8,8,0,0,0-3.89,5.4,106.47,106.47,0,0,0,0,41.56,8,8,0,0,0,3.89,5.4l29.83,17,.12,33.63a8,8,0,0,0,2.83,6.08,111.91,111.91,0,0,0,36.72,20.67,8,8,0,0,0,6.46-.59L128,214.15,158.12,231a7.91,7.91,0,0,0,3.9,1,8.09,8.09,0,0,0,2.57-.42,112.1,112.1,0,0,0,36.68-20.73,8,8,0,0,0,2.83-6.07l.15-33.65,29.83-17a8,8,0,0,0,3.89-5.4A106.47,106.47,0,0,0,237.94,107.21ZM128,168a40,40,0,1,1,40-40A40,40,0,0,1,128,168Z"},child:[]}]})(e)}function P1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M213.85,125.46l-112,120a8,8,0,0,1-13.69-7l14.66-73.33L45.19,143.49a8,8,0,0,1-3-13l112-120a8,8,0,0,1,13.69,7L153.18,90.9l57.63,21.61a8,8,0,0,1,3,12.95Z"},child:[]}]})(e)}function VE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},child:[]}]})(e)}function GE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"},child:[]}]})(e)}function zE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"},child:[]}]})(e)}function Xoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM80,192H64a16,16,0,0,1-16-16V144a8,8,0,0,1,16,0v32H80a8,8,0,0,1,0,16ZM80,80H64v32a8,8,0,0,1-16,0V80A16,16,0,0,1,64,64H80a8,8,0,0,1,0,16Zm64,112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm0-112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm64,96a16,16,0,0,1-16,16H176a8,8,0,0,1,0-16h16V144a8,8,0,0,1,16,0Zm0-64a8,8,0,0,1-16,0V80H176a8,8,0,0,1,0-16h16a16,16,0,0,1,16,16Z"},child:[]}]})(e)}function HE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M111.59,181.47A8,8,0,0,1,104,192H24a8,8,0,0,1-7.59-10.53l40-120a8,8,0,0,1,15.18,0ZM208,76a52,52,0,1,0-52,52A52.06,52.06,0,0,0,208,76Zm16,68H136a8,8,0,0,0-8,8v56a8,8,0,0,0,8,8h88a8,8,0,0,0,8-8V152A8,8,0,0,0,224,144Z"},child:[]}]})(e)}function Qoe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M212,200a36,36,0,1,1-69.85-12.25l-53-34.05a36,36,0,1,1,0-51.4l53-34a36.09,36.09,0,1,1,8.67,13.45l-53,34.05a36,36,0,0,1,0,24.5l53,34.05A36,36,0,0,1,212,200Z"},child:[]}]})(e)}function wS(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M235.24,84.38l-28.06,23.68,8.56,35.39a13.34,13.34,0,0,1-5.09,13.91,13.54,13.54,0,0,1-15,.69L164,139l-31.65,19.06a13.51,13.51,0,0,1-15-.69,13.32,13.32,0,0,1-5.1-13.91l8.56-35.39L92.76,84.38a13.39,13.39,0,0,1,7.66-23.58l36.94-2.92,14.21-33.66a13.51,13.51,0,0,1,24.86,0l14.21,33.66,36.94,2.92a13.39,13.39,0,0,1,7.66,23.58ZM88.11,111.89a8,8,0,0,0-11.32,0L18.34,170.34a8,8,0,0,0,11.32,11.32l58.45-58.45A8,8,0,0,0,88.11,111.89Zm-.5,61.19L34.34,226.34a8,8,0,0,0,11.32,11.32l53.26-53.27a8,8,0,0,0-11.31-11.31Zm73-1-54.29,54.28a8,8,0,0,0,11.32,11.32l54.28-54.28a8,8,0,0,0-11.31-11.32Z"},child:[]}]})(e)}function E1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,144a15.78,15.78,0,0,1-10.42,14.94L146,178l-19,51.62a15.92,15.92,0,0,1-29.88,0L78,178l-51.62-19a15.92,15.92,0,0,1,0-29.88L78,110l19-51.62a15.92,15.92,0,0,1,29.88,0L146,110l51.62,19A15.78,15.78,0,0,1,208,144ZM152,48h16V64a8,8,0,0,0,16,0V48h16a8,8,0,0,0,0-16H184V16a8,8,0,0,0-16,0V32H152a8,8,0,0,0,0,16Zm88,32h-8V72a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0V96h8a8,8,0,0,0,0-16Z"},child:[]}]})(e)}function jS(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,114.85l-45,38.83L203,211.75a16.4,16.4,0,0,1-24.5,17.82L128,198.49,77.47,229.57A16.4,16.4,0,0,1,53,211.75l13.76-58.07-45-38.83A16.46,16.46,0,0,1,31.08,86l59-4.76,22.76-55.08a16.36,16.36,0,0,1,30.27,0l22.75,55.08,59,4.76a16.46,16.46,0,0,1,9.37,28.86Z"},child:[]}]})(e)}function Joe(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,112a40,40,0,1,1,40-40A40,40,0,0,1,176,168Z"},child:[]}]})(e)}function L1(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,56a8,8,0,0,1-8,8h-8V208a16,16,0,0,1-16,16H64a16,16,0,0,1-16-16V64H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,56ZM88,32h80a8,8,0,0,0,0-16H88a8,8,0,0,0,0,16Z"},child:[]}]})(e)}function eae(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M74.34,77.66a8,8,0,0,1,0-11.32l48-48a8,8,0,0,1,11.32,0l48,48a8,8,0,0,1-11.32,11.32L136,43.31V128a8,8,0,0,1-16,0V43.31L85.66,77.66A8,8,0,0,1,74.34,77.66ZM240,136v64a16,16,0,0,1-16,16H32a16,16,0,0,1-16-16V136a16,16,0,0,1,16-16h68a4,4,0,0,1,4,4v3.46c0,13.45,11,24.79,24.46,24.54A24,24,0,0,0,152,128v-4a4,4,0,0,1,4-4h68A16,16,0,0,1,240,136Zm-40,32a12,12,0,1,0-12,12A12,12,0,0,0,200,168Z"},child:[]}]})(e)}function WE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,96a72,72,0,0,1-100.94,66L79,222.22c-.12.14-.26.29-.39.42a32,32,0,0,1-45.26-45.26c.14-.13.28-.27.43-.39L94,124.94a72.07,72.07,0,0,1,83.54-98.78,8,8,0,0,1,3.93,13.19L144,80l5.66,26.35L176,112l40.65-37.52a8,8,0,0,1,13.19,3.93A72.6,72.6,0,0,1,232,96Z"},child:[]}]})(e)}function tae(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.33,69.52a24,24,0,0,0-14.49-16.4C185.56,39.88,131,40,128,40s-57.56-.12-91.84,13.12a24,24,0,0,0-14.49,16.4C19.08,79.5,16,97.74,16,128s3.08,48.5,5.67,58.48a24,24,0,0,0,14.49,16.41C69,215.56,120.4,216,127.34,216h1.32c6.94,0,58.37-.44,91.18-13.11a24,24,0,0,0,14.49-16.41c2.59-10,5.67-28.22,5.67-58.48S236.92,79.5,234.33,69.52Zm-73.74,65-40,28A8,8,0,0,1,108,156V100a8,8,0,0,1,12.59-6.55l40,28a8,8,0,0,1,0,13.1Z"},child:[]}]})(e)}function nae(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM48,48H208v77.38l-24.69-24.7a16,16,0,0,0-22.62,0L53.37,208H48ZM208,208H76l96-96,36,36v60ZM96,120A24,24,0,1,0,72,96,24,24,0,0,0,96,120Zm0-32a8,8,0,1,1-8,8A8,8,0,0,1,96,88Z"},child:[]}]})(e)}function UE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,16V158.75l-26.07-26.06a16,16,0,0,0-22.63,0l-20,20-44-44a16,16,0,0,0-22.62,0L40,149.37V56ZM40,172l52-52,80,80H40Zm176,28H194.63l-36-36,20-20L216,181.38V200ZM144,100a12,12,0,1,1,12,12A12,12,0,0,1,144,100Z"},child:[]}]})(e)}function sae(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}function qE(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,32V64a8,8,0,0,1-16,0V32a8,8,0,0,1,16,0Zm37.25,58.75a8,8,0,0,0,5.66-2.35l22.63-22.62a8,8,0,0,0-11.32-11.32L167.6,77.09a8,8,0,0,0,5.65,13.66ZM224,120H192a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16Zm-45.09,47.6a8,8,0,0,0-11.31,11.31l22.62,22.63a8,8,0,0,0,11.32-11.32ZM128,184a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V192A8,8,0,0,0,128,184ZM77.09,167.6,54.46,190.22a8,8,0,0,0,11.32,11.32L88.4,178.91A8,8,0,0,0,77.09,167.6ZM72,128a8,8,0,0,0-8-8H32a8,8,0,0,0,0,16H64A8,8,0,0,0,72,128ZM65.78,54.46A8,8,0,0,0,54.46,65.78L77.09,88.4A8,8,0,0,0,88.4,77.09Z"},child:[]}]})(e)}function rae(e){return pe({attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M165.66,101.66,139.31,128l26.35,26.34a8,8,0,0,1-11.32,11.32L128,139.31l-26.34,26.35a8,8,0,0,1-11.32-11.32L116.69,128,90.34,101.66a8,8,0,0,1,11.32-11.32L128,116.69l26.34-26.35a8,8,0,0,1,11.32,11.32ZM232,128A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}const kS=Oe(null),iae=e=>kS.set(e),hv=()=>kS.set(null),KE=u.memo(()=>{wt("CanvasPasteModal");const{dispatch:e,getState:t}=sr(),{t:n}=P(),s=ce(kS),i=Tt(),o=I(Ar),[a,{isLoading:l}]=GT({fixedCacheKey:"canvasPasteModal"}),c=u.useCallback(g=>{const{x:m,y}=i.stateApi.getBbox().rect;if(g==="bbox")return{x:m,y};const x=i.compositor.getVisibleAdaptersOfType("raster_layer");if(x.length===0)return{x:m,y};{const{x:C,y:v}=i.compositor.getRectOfAdapters(x);return{x:C,y:v}}},[i.compositor,i.stateApi]),d=u.useCallback(async(g,m)=>{try{const x=await a({file:g,is_intermediate:m!=="assets",image_category:"user",board_id:o==="none"?void 0:o}).unwrap();m!=="assets"&&Vr({type:"raster_layer",imageDTO:x,dispatch:e,getState:t,overrides:{position:c(m)}})}catch{fe({title:n("toast.pasteFailed"),status:"error"})}finally{hv(),fe({title:n("toast.pasteSuccess",{destination:n(m==="assets"?"controlLayers.pasteToAssets":m==="bbox"?"controlLayers.pasteToBbox":"controlLayers.pasteToCanvas")}),status:"success"})}},[o,e,c,t,n,a]),h=u.useCallback(()=>{s&&d(s,"assets")},[d,s]),f=u.useCallback(()=>{s&&d(s,"canvas")},[d,s]),p=u.useCallback(()=>{s&&d(s,"bbox")},[d,s]);return r.jsxs(ni,{isOpen:s!==null,onClose:hv,useInert:!1,isCentered:!0,size:"2xl",children:[r.jsx(rr,{}),r.jsxs(si,{children:[r.jsx(Tr,{children:n("controlLayers.pasteTo")}),r.jsx(lo,{}),r.jsx(ir,{display:"flex",justifyContent:"center",children:r.jsxs(T,{flexDir:"column",gap:4,w:"min-content",children:[r.jsx(ye,{size:"lg",onClick:f,isDisabled:l,leftIcon:r.jsx(mu,{}),children:n("controlLayers.pasteToCanvasDesc")}),r.jsx(ye,{size:"lg",onClick:p,isDisabled:l,leftIcon:r.jsx(La,{}),children:n("controlLayers.pasteToBboxDesc")}),r.jsx(ye,{size:"lg",onClick:h,isDisabled:l,variant:"ghost",children:n("controlLayers.pasteToAssetsDesc")})]})}),r.jsx(co,{children:r.jsx(ye,{onClick:hv,variant:"ghost",isLoading:l,children:n("common.cancel")})})]})]})});KE.displayName="CanvasPasteModal";const[ZE]=ja(!1),[YE]=ja(!1),XE=()=>{const e=z(),t=Lt(),n=I(Wf),s=ZE(),i=u.useCallback(()=>{e(BU()),t.open(),e(Ys("gallery"))},[e,t]),o=u.useCallback(()=>{if(n){s.setTrue();return}i()},[i,s,n]);return{newGallerySessionImmediate:i,newGallerySessionWithDialog:o}},QE=()=>{const e=z(),t=Lt(),n=I(Wf),s=YE(),i=u.useCallback(()=>{e($U()),t.close(),e(Ys("layers"))},[e,t]),o=u.useCallback(()=>{if(n){s.setTrue();return}i()},[i,s,n]);return{newCanvasSessionImmediate:i,newCanvasSessionWithDialog:o}},JE=u.memo(()=>{wt("NewGallerySessionDialog");const{t:e}=P(),t=z(),n=ZE(),{newGallerySessionImmediate:s}=XE(),i=I(Wf),o=u.useCallback(()=>{t(hC())},[t]);return r.jsx(ti,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newGallerySession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:r.jsxs(T,{direction:"column",gap:3,children:[r.jsx(K,{children:e("controlLayers.newGallerySessionDesc")}),r.jsx(K,{children:e("common.areYouSure")}),r.jsxs(Z,{children:[r.jsx(te,{children:e("common.dontAskMeAgain")}),r.jsx(jn,{isChecked:!i,onChange:o})]})]})})});JE.displayName="NewGallerySessionDialog";const eL=u.memo(()=>{wt("NewCanvasSessionDialog");const{t:e}=P(),t=z(),n=YE(),{newCanvasSessionImmediate:s}=QE(),i=I(Wf),o=u.useCallback(()=>{t(hC())},[t]);return r.jsx(ti,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newCanvasSession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:r.jsxs(T,{direction:"column",gap:3,children:[r.jsx(K,{children:e("controlLayers.newCanvasSessionDesc")}),r.jsx(K,{children:e("common.areYouSure")}),r.jsxs(Z,{children:[r.jsx(te,{children:e("common.dontAskMeAgain")}),r.jsx(jn,{isChecked:!i,onChange:o})]})]})})});eL.displayName="NewCanvasSessionDialog";const oae=e=>{const{t}=P(),{imageUsage:n,topMessage:s=t("gallery.currentlyInUse"),bottomMessage:i=t("gallery.featuresWillReset")}=e;return!n||!fs(n)?null:r.jsxs(r.Fragment,{children:[r.jsx(K,{children:s}),r.jsxs(ki,{paddingInlineStart:6,fontSize:"sm",children:[n.isControlLayerImage&&r.jsx(Gt,{children:t("controlLayers.controlLayer")}),n.isReferenceImage&&r.jsx(Gt,{children:t("controlLayers.referenceImage")}),n.isInpaintMaskImage&&r.jsx(Gt,{children:t("controlLayers.inpaintMask")}),n.isRasterLayerImage&&r.jsx(Gt,{children:t("controlLayers.rasterLayer")}),n.isRegionalGuidanceImage&&r.jsx(Gt,{children:t("controlLayers.regionalGuidance")}),n.isUpscaleImage&&r.jsx(Gt,{children:t("ui.tabs.upscalingTab")}),n.isNodesImage&&r.jsx(Gt,{children:t("ui.tabs.workflowsTab")})]}),r.jsx(K,{children:i})]})},tL=u.memo(oae),aae=It([HT,ot,Je,zU,U0],(e,t,n,s,i)=>{const{imagesToDelete:o}=e,a=(o??[]).map(({image_name:c})=>WT(t,n,i,c)),l={isUpscaleImage:fs(a,c=>c.isUpscaleImage),isRasterLayerImage:fs(a,c=>c.isRasterLayerImage),isInpaintMaskImage:fs(a,c=>c.isInpaintMaskImage),isRegionalGuidanceImage:fs(a,c=>c.isRegionalGuidanceImage),isNodesImage:fs(a,c=>c.isNodesImage),isControlLayerImage:fs(a,c=>c.isControlLayerImage),isReferenceImage:fs(a,c=>c.isReferenceImage)};return{imagesToDelete:o,imagesUsage:s,imageUsageSummary:l}}),lae=ve(W0,e=>e.shouldConfirmOnDelete),cae=ve(HT,e=>e.isModalOpen),uae=()=>{wt("DeleteImageModal");const e=z(),{t}=P(),n=I(lae),s=I(cae),{imagesToDelete:i,imagesUsage:o,imageUsageSummary:a}=I(aae),l=u.useCallback(h=>e(zT(!h.target.checked)),[e]),c=u.useCallback(()=>{e(Ok()),e(VU(!1))},[e]),d=u.useCallback(()=>{!i.length||!o.length||(e(Ok()),e(GU({imageDTOs:i,imagesUsage:o})))},[e,i,o]);return r.jsx(ti,{title:t("gallery.deleteImage",{count:i.length}),isOpen:s,onClose:c,cancelButtonText:t("common.cancel"),acceptButtonText:t("common.delete"),acceptCallback:d,useInert:!1,children:r.jsxs(T,{direction:"column",gap:3,children:[r.jsx(tL,{imageUsage:a}),r.jsx(Et,{}),r.jsx(K,{children:t("gallery.deleteImagePermanent")}),r.jsx(K,{children:t("common.areYouSure")}),r.jsxs(Z,{children:[r.jsx(te,{children:t("common.dontAskMeAgain")}),r.jsx(it,{isChecked:!n,onChange:l})]})]})})},dae=u.memo(uae);function Kn(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(){t.forEach(function(i){return i()})}}function ax(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function hae(e){if(Array.isArray(e))return ax(e)}function fae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function nL(e,t){if(e){if(typeof e=="string")return ax(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ax(e,t):void 0}}function pae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function D1(e){return hae(e)||fae(e)||nL(e)||pae()}var fv={},ah={},$4;function sL(){if($4)return ah;$4=1,Object.defineProperty(ah,"__esModule",{value:!0}),ah.bind=void 0;function e(t,n){var s=n.type,i=n.listener,o=n.options;return t.addEventListener(s,i,o),function(){t.removeEventListener(s,i,o)}}return ah.bind=e,ah}var qa={},V4;function gae(){if(V4)return qa;V4=1;var e=qa&&qa.__assign||function(){return e=Object.assign||function(o){for(var a,l=1,c=arguments.length;l<c;l++){a=arguments[l];for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&(o[d]=a[d])}return o},e.apply(this,arguments)};Object.defineProperty(qa,"__esModule",{value:!0}),qa.bindAll=void 0;var t=sL();function n(o){if(!(typeof o>"u"))return typeof o=="boolean"?{capture:o}:o}function s(o,a){if(a==null)return o;var l=e(e({},o),{options:e(e({},n(a)),n(o.options))});return l}function i(o,a,l){var c=a.map(function(d){var h=s(d,l);return(0,t.bind)(o,h)});return function(){c.forEach(function(h){return h()})}}return qa.bindAll=i,qa}var G4;function mae(){return G4||(G4=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.bindAll=e.bind=void 0;var t=sL();Object.defineProperty(e,"bind",{enumerable:!0,get:function(){return t.bind}});var n=gae();Object.defineProperty(e,"bindAll",{enumerable:!0,get:function(){return n.bindAll}})}(fv)),fv}var so=mae();function yae(e){if(Array.isArray(e))return e}function vae(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s,i,o,a,l=[],c=!0,d=!1;try{if(o=(n=n.call(e)).next,t===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(s=o.call(n)).done)&&(l.push(s.value),l.length!==t);c=!0);}catch(h){d=!0,i=h}finally{try{if(!c&&n.return!=null&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw i}}return l}}function bae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _S(e,t){return yae(e)||vae(e,t)||nL(e,t)||bae()}var rL="data-pdnd-honey-pot";function iL(e){return e instanceof Element&&e.hasAttribute(rL)}function IS(e){var t=document.elementsFromPoint(e.x,e.y),n=_S(t,2),s=n[0],i=n[1];return s?iL(s)?i??null:s:null}function AS(e){var t=null;return function(){if(!t){for(var s=arguments.length,i=new Array(s),o=0;o<s;o++)i[o]=arguments[o];var a=e.apply(this,i);t={result:a}}return t.result}}var oL=AS(function(){return navigator.userAgent.includes("Firefox")}),Hu=AS(function(){var t=navigator,n=t.userAgent;return n.includes("AppleWebKit")&&!n.includes("Chrome")}),$m={isLeavingWindow:Symbol("leaving"),isEnteringWindow:Symbol("entering")};function xae(e){var t=e.dragEnter;return Hu()?t.hasOwnProperty($m.isEnteringWindow):!1}function Cae(e){var t=e.dragLeave;return Hu()?t.hasOwnProperty($m.isLeavingWindow):!1}(function(){if(typeof window>"u"||!Hu())return;function t(){return{enterCount:0,isOverWindow:!1}}var n=t();function s(){n=t()}so.bindAll(window,[{type:"dragstart",listener:function(){n.enterCount=0,n.isOverWindow=!0}},{type:"drop",listener:s},{type:"dragend",listener:s},{type:"dragenter",listener:function(o){!n.isOverWindow&&n.enterCount===0&&(o[$m.isEnteringWindow]=!0),n.isOverWindow=!0,n.enterCount++}},{type:"dragleave",listener:function(o){n.enterCount--,n.isOverWindow&&n.enterCount===0&&(o[$m.isLeavingWindow]=!0,n.isOverWindow=!1)}}],{capture:!0})})();function Sae(e){return"nodeName"in e}function aL(e){return Sae(e)&&e.ownerDocument!==document}function wae(e){var t=e.dragLeave,n=t.type,s=t.relatedTarget;return n!=="dragleave"?!1:Hu()?Cae({dragLeave:t}):s==null?!0:oL()?aL(s):s instanceof HTMLIFrameElement}function TS(e){var t=e.onDragEnd;return[{type:"pointermove",listener:function(){var n=0;return function(){if(n<20){n++;return}t()}}()},{type:"pointerdown",listener:t}]}function Gh(e){return{altKey:e.altKey,button:e.button,buttons:e.buttons,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY}}var jae=function(t){var n=[],s=null,i=function(){for(var a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];n=l,!s&&(s=requestAnimationFrame(function(){s=null,t.apply(void 0,n)}))};return i.cancel=function(){s&&(cancelAnimationFrame(s),s=null)},i},pv=jae(function(e){return e()}),hg=function(){var e=null;function t(s){var i=requestAnimationFrame(function(){e=null,s()});e={frameId:i,fn:s}}function n(){e&&(cancelAnimationFrame(e.frameId),e.fn(),e=null)}return{schedule:t,flush:n}}();function kae(e){var t=e.source,n=e.initial,s=e.dispatchEvent,i={dropTargets:[]};function o(l){s(l),i={dropTargets:l.payload.location.current.dropTargets}}var a={start:function(c){var d=c.nativeSetDragImage,h={current:n,previous:i,initial:n};o({eventName:"onGenerateDragPreview",payload:{source:t,location:h,nativeSetDragImage:d}}),hg.schedule(function(){o({eventName:"onDragStart",payload:{source:t,location:h}})})},dragUpdate:function(c){var d=c.current;hg.flush(),pv.cancel(),o({eventName:"onDropTargetChange",payload:{source:t,location:{initial:n,previous:i,current:d}}})},drag:function(c){var d=c.current;pv(function(){hg.flush();var h={initial:n,previous:i,current:d};o({eventName:"onDrag",payload:{source:t,location:h}})})},drop:function(c){var d=c.current,h=c.updatedSourcePayload;hg.flush(),pv.cancel(),o({eventName:"onDrop",payload:{source:h??t,location:{current:d,previous:i,initial:n}}})}};return a}var lx={isActive:!1};function lL(){return!lx.isActive}function _ae(e){return e.dataTransfer?e.dataTransfer.setDragImage.bind(e.dataTransfer):null}function Iae(e){var t=e.current,n=e.next;if(t.length!==n.length)return!0;for(var s=0;s<t.length;s++)if(t[s].element!==n[s].element)return!0;return!1}function Aae(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,i=e.dispatchEvent;if(!lL())return;var o=Tae({event:t,dragType:n,getDropTargetsOver:s});lx.isActive=!0;var a={current:o};gv({event:t,current:o.dropTargets});var l=kae({source:n.payload,dispatchEvent:i,initial:o});function c(g){var m=Iae({current:a.current.dropTargets,next:g.dropTargets});a.current=g,m&&l.dragUpdate({current:a.current})}function d(g){var m=Gh(g),y=iL(g.target)?IS({x:m.clientX,y:m.clientY}):g.target,x=s({target:y,input:m,source:n.payload,current:a.current.dropTargets});x.length&&(g.preventDefault(),gv({event:g,current:x})),c({dropTargets:x,input:m})}function h(){a.current.dropTargets.length&&c({dropTargets:[],input:a.current.input}),l.drop({current:a.current,updatedSourcePayload:null}),f()}function f(){lx.isActive=!1,p()}var p=so.bindAll(window,[{type:"dragover",listener:function(m){d(m),l.drag({current:a.current})}},{type:"dragenter",listener:d},{type:"dragleave",listener:function(m){wae({dragLeave:m})&&(c({input:a.current.input,dropTargets:[]}),n.startedFrom==="external"&&h())}},{type:"drop",listener:function(m){if(a.current={dropTargets:a.current.dropTargets,input:Gh(m)},!a.current.dropTargets.length){h();return}m.preventDefault(),gv({event:m,current:a.current.dropTargets}),l.drop({current:a.current,updatedSourcePayload:n.type==="external"?n.getDropPayload(m):null}),f()}},{type:"dragend",listener:function(m){a.current={dropTargets:a.current.dropTargets,input:Gh(m)},h()}}].concat(D1(TS({onDragEnd:h}))),{capture:!0});l.start({nativeSetDragImage:_ae(t)})}function gv(e){var t,n=e.event,s=e.current,i=(t=s[0])===null||t===void 0?void 0:t.dropEffect;i!=null&&n.dataTransfer&&(n.dataTransfer.dropEffect=i)}function Tae(e){var t=e.event,n=e.dragType,s=e.getDropTargetsOver,i=Gh(t);if(n.startedFrom==="external")return{input:i,dropTargets:[]};var o=s({input:i,source:n.payload,target:t.target,current:[]});return{input:i,dropTargets:o}}var z4={canStart:lL,start:Aae},cx=new Map;function Mae(e){var t=e.typeKey,n=e.mount,s=cx.get(t);if(s)return s.usageCount++,s;var i={typeKey:t,unmount:n(),usageCount:1};return cx.set(t,i),i}function Pae(e){var t=Mae(e);return function(){t.usageCount--,!(t.usageCount>0)&&(t.unmount(),cx.delete(e.typeKey))}}function df(e){"@babel/helpers - typeof";return df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},df(e)}function Eae(e,t){if(df(e)!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t);if(df(s)!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Lae(e){var t=Eae(e,"string");return df(t)=="symbol"?t:t+""}function yi(e,t,n){return(t=Lae(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cL(e,t){var n=t.attribute,s=t.value;return e.setAttribute(n,s),function(){return e.removeAttribute(n)}}function H4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function Xo(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?H4(Object(n),!0).forEach(function(s){yi(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H4(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function mv(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Dae(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return a=d.done,d},e:function(d){l=!0,o=d},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw o}}}}function Dae(e,t){if(e){if(typeof e=="string")return W4(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?W4(e,t):void 0}}function W4(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function yv(e){return e.slice(0).reverse()}function Rae(e){var t=e.typeKey,n=e.defaultDropEffect,s=new WeakMap,i="data-drop-target-for-".concat(t),o="[".concat(i,"]");function a(g){return s.set(g.element,g),function(){return s.delete(g.element)}}function l(g){return Kn(cL(g.element,{attribute:i,value:"true"}),a(g))}function c(g){var m,y,x,C,v=g.source,b=g.target,S=g.input,w=g.result,j=w===void 0?[]:w;if(b==null)return j;if(!(b instanceof Element))return b instanceof Node?c({source:v,target:b.parentElement,input:S,result:j}):j;var E=b.closest(o);if(E==null)return j;var A=s.get(E);if(A==null)return j;var L={input:S,source:v,element:A.element};if(A.canDrop&&!A.canDrop(L))return c({source:v,target:A.element.parentElement,input:S,result:j});var M=(m=(y=A.getData)===null||y===void 0?void 0:y.call(A,L))!==null&&m!==void 0?m:{},O=(x=(C=A.getDropEffect)===null||C===void 0?void 0:C.call(A,L))!==null&&x!==void 0?x:n,F={data:M,element:A.element,dropEffect:O,isActiveDueToStickiness:!1};return c({source:v,target:A.element.parentElement,input:S,result:[].concat(D1(j),[F])})}function d(g){var m=g.eventName,y=g.payload,x=mv(y.location.current.dropTargets),C;try{for(x.s();!(C=x.n()).done;){var v,b=C.value,S=s.get(b.element),w=Xo(Xo({},y),{},{self:b});S==null||(v=S[m])===null||v===void 0||v.call(S,w)}}catch(j){x.e(j)}finally{x.f()}}var h={onGenerateDragPreview:d,onDrag:d,onDragStart:d,onDrop:d,onDropTargetChange:function(m){var y=m.payload,x=new Set(y.location.current.dropTargets.map(function(G){return G.element})),C=new Set,v=mv(y.location.previous.dropTargets),b;try{for(v.s();!(b=v.n()).done;){var S,w=b.value;C.add(w.element);var j=s.get(w.element),E=x.has(w.element),A=Xo(Xo({},y),{},{self:w});if(j==null||(S=j.onDropTargetChange)===null||S===void 0||S.call(j,A),!E){var L;j==null||(L=j.onDragLeave)===null||L===void 0||L.call(j,A)}}}catch(G){v.e(G)}finally{v.f()}var M=mv(y.location.current.dropTargets),O;try{for(M.s();!(O=M.n()).done;){var F,_,R=O.value;if(!C.has(R.element)){var D=Xo(Xo({},y),{},{self:R}),$=s.get(R.element);$==null||(F=$.onDropTargetChange)===null||F===void 0||F.call($,D),$==null||(_=$.onDragEnter)===null||_===void 0||_.call($,D)}}}catch(G){M.e(G)}finally{M.f()}}};function f(g){h[g.eventName](g)}function p(g){var m=g.source,y=g.target,x=g.input,C=g.current,v=c({source:m,target:y,input:x});if(v.length>=C.length)return v;for(var b=yv(C),S=yv(v),w=[],j=0;j<b.length;j++){var E,A=b[j],L=S[j];if(L!=null){w.push(L);continue}var M=w[j-1],O=b[j-1];if((M==null?void 0:M.element)!==(O==null?void 0:O.element))break;var F=s.get(A.element);if(!F)break;var _={input:x,source:m,element:F.element};if(F.canDrop&&!F.canDrop(_)||!((E=F.getIsSticky)!==null&&E!==void 0&&E.call(F,_)))break;w.push(Xo(Xo({},A),{},{isActiveDueToStickiness:!0}))}return yv(w)}return{dropTargetForConsumers:l,getIsOver:p,dispatchEvent:f}}function Oae(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Nae(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return a=d.done,d},e:function(d){l=!0,o=d},f:function(){try{a||n.return==null||n.return()}finally{if(l)throw o}}}}function Nae(e,t){if(e){if(typeof e=="string")return U4(e,t);var n={}.toString.call(e).slice(8,-1);return n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set"?Array.from(e):n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?U4(e,t):void 0}}function U4(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=Array(t);n<t;n++)s[n]=e[n];return s}function q4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function Fae(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?q4(Object(n),!0).forEach(function(s){yi(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q4(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Bae(){var e=new Set,t=null;function n(o){t&&(!o.canMonitor||o.canMonitor(t.canMonitorArgs))&&t.active.add(o)}function s(o){var a=Fae({},o);return e.add(a),n(a),function(){e.delete(a),t&&t.active.delete(a)}}function i(o){var a=o.eventName,l=o.payload;if(a==="onGenerateDragPreview"){t={canMonitorArgs:{initial:l.location.initial,source:l.source},active:new Set};var c=Oae(e),d;try{for(c.s();!(d=c.n()).done;){var h=d.value;n(h)}}catch(x){c.e(x)}finally{c.f()}}if(t){for(var f=Array.from(t.active),p=0,g=f;p<g.length;p++){var m=g[p];if(t.active.has(m)){var y;(y=m[a])===null||y===void 0||y.call(m,l)}}a==="onDrop"&&(t.active.clear(),t=null)}}return{dispatchEvent:i,monitorForConsumers:s}}function uL(e){var t=e.typeKey,n=e.mount,s=e.dispatchEventToSource,i=e.onPostDispatch,o=e.defaultDropEffect,a=Bae(),l=Rae({typeKey:t,defaultDropEffect:o});function c(f){s==null||s(f),l.dispatchEvent(f),a.dispatchEvent(f),i==null||i(f)}function d(f){var p=f.event,g=f.dragType;z4.start({event:p,dragType:g,getDropTargetsOver:l.getIsOver,dispatchEvent:c})}function h(){function f(){var p={canStart:z4.canStart,start:d};return n(p)}return Pae({typeKey:t,mount:f})}return{registerUsage:h,dropTarget:l.dropTargetForConsumers,monitor:a.monitorForConsumers}}var $ae=AS(function(){return navigator.userAgent.toLocaleLowerCase().includes("android")}),dL="pdnd:android-fallback";function Vae(e){var t=e.dragEnter,n=t.type,s=t.relatedTarget;return n!=="dragenter"?!1:Hu()?xae({dragEnter:t}):s==null?!0:oL()?aL(s):s instanceof HTMLIFrameElement}var ux="text/plain",hL="application/vnd.pdnd";function MS(e){var t=e.type,n=e.value;return!(t===hL||t===ux&&n===dL)}function Gae(e){return Array.from(e.types).filter(function(t){return MS({type:t,value:e.getData(t)})})}function zae(e){return Array.from(e.items).filter(function(t){return t.kind==="file"||MS({type:t.type,value:e.getData(t.type)})})}var dx=!1,PS=uL({typeKey:"external",defaultDropEffect:"copy",mount:function(t){return so.bind(window,{type:"dragenter",listener:function(s){if(!dx&&s.dataTransfer&&t.canStart(s)&&Vae({dragEnter:s})){var i=Gae(s.dataTransfer);if(i.length){var o={types:i,items:[],getStringData:function(){return null}};t.start({event:s,dragType:{type:"external",startedFrom:"external",payload:o,getDropPayload:function(l){if(!l.dataTransfer)return o;var c=zae(l.dataTransfer),d=l.dataTransfer.getData.bind(l.dataTransfer);return{types:i,items:c,getStringData:function(f){if(!i.includes(f))return null;var p=d(f);return MS({type:f,value:p})?p:null}}}}})}}}})}});function hx(e){return PS.dropTarget(e)}function zh(e){return PS.monitor(e)}(function(){if(typeof window>"u")return;PS.registerUsage();var t={type:"idle"},n=t;function s(){n.type==="dragging"&&(dx=!1,n.cleanup(),n=t)}function i(){return so.bindAll(window,[{type:"dragend",listener:s}].concat(D1(TS({onDragEnd:s}))),{capture:!0})}so.bind(window,{type:"dragstart",listener:function(){n.type==="idle"&&(dx=!0,n={type:"dragging",cleanup:i()})},options:{capture:!0}})})();function K4(e){var t=e.source;return t.types.includes("Files")}function Hae(e){var t=e.source;return t.items.filter(function(n){return n.kind==="file"}).map(function(n){return n.getAsFile()}).filter(function(n){return n!=null})}function Z4(e){e.defaultPrevented||(e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.preventDefault())}var fx=null;function Wae(){Eh(),fx=so.bindAll(window,[{type:"dragover",listener:Z4},{type:"dragenter",listener:Z4},{type:"drop",listener:function(t){t.preventDefault(),Eh()}},{type:"dragend",listener:Eh}].concat(D1(TS({onDragEnd:Eh}))),{capture:!1})}function Eh(){var e;(e=fx)===null||e===void 0||e(),fx=null}function Uae(){var e;if(((e=window.event)===null||e===void 0?void 0:e.type)==="drop"){var t;(t=window.event)===null||t===void 0||t.preventDefault()}Eh()}var Y4={start:Wae,stop:Uae};const qae={position:"absolute",top:0,right:0,bottom:0,left:0,color:"base.300",borderColor:"base.300",transitionProperty:"common",transitionDuration:"0.1s",".dnd-drop-overlay-backdrop":{position:"absolute",top:0,right:0,bottom:0,left:0,bg:"base.900",opacity:.7,borderRadius:"base",alignItems:"center",justifyContent:"center",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-content":{position:"absolute",top:.5,right:.5,bottom:.5,left:.5,opacity:1,borderWidth:1.5,borderRadius:"base",borderStyle:"dashed",alignItems:"center",justifyContent:"center",borderColor:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},".dnd-drop-overlay-label":{fontSize:"lg",fontWeight:"semibold",textAlign:"center",color:"inherit",transitionProperty:"inherit",transitionDuration:"inherit"},'&[data-dnd-state="over"]':{color:"invokeYellow.300",borderColor:"invokeYellow.300"}},hf=u.memo(e=>{const{dndState:t,label:n,withBackdrop:s=!0}=e;return t==="idle"?null:r.jsxs(T,{className:"dnd-drop-overlay","data-dnd-state":t,sx:qae,children:[s&&r.jsx(T,{className:"dnd-drop-overlay-backdrop"}),r.jsxs(T,{className:"dnd-drop-overlay-content",children:[Cl(n)&&r.jsx(K,{className:"dnd-drop-overlay-label",children:n}),!ze(n)&&!Cl(n)&&n]})]})});hf.displayName="DndDropOverlay";const Sp=e=>{const{boardName:t}=Eu({include_archived:!0},{selectFromResult:({data:n})=>{const s=n==null?void 0:n.find(o=>o.board_id===e);return{boardName:(s==null?void 0:s.board_name)||Ce("boards.uncategorized")}}});return t},Kae=["image/png","image/jpg","image/jpeg"],Zae=[".png",".jpg",".jpeg"],X4=$e.custom().refine(e=>Kae.includes(e.type),e=>({message:`File type ${e.type} is not supported`})).refine(e=>Zae.some(t=>e.name.endsWith(t)),e=>({message:`File extension .${e.name.split(".").at(-1)} is not supported`})),Yae=e=>e===void 0?$e.array(X4):$e.array(X4).max(e),Xae={position:"absolute",top:2,right:2,bottom:2,left:2,'&[data-dnd-state="idle"]':{pointerEvents:"none"}},fL=u.memo(()=>{const{t:e}=P(),t=u.useRef(null),n=I(fC),[s,i]=u.useState("idle"),o=I(On),a=ce(Qc),l=u.useCallback(d=>{const{getState:h}=ut();if(!Yae(n).safeParse(d).success){const x=n===void 0?e("toast.uploadFailedInvalidUploadDesc"):e("toast.uploadFailedInvalidUploadDesc_withCount",{count:n});fe({id:"UPLOAD_FAILED",title:e("toast.uploadFailed"),description:x,status:"error"});return}const[g]=d;if(!a&&o==="canvas"&&d.length===1&&g){iae(g);return}const m=Ar(h()),y=d.map((x,C)=>({file:x,image_category:"user",is_intermediate:!1,board_id:m==="none"?void 0:m,isFirstUploadOfBatch:C===0}));UT(y)},[o,a,n,e]),c=u.useCallback(d=>{var f;if(!((f=d.clipboardData)!=null&&f.files))return;const h=Array.from(d.clipboardData.files);l(h)},[l]);return u.useEffect(()=>{const d=t.current;if(d)return Kn(hx({element:d,canDrop:K4,onDrop:({source:h})=>{const f=Hae({source:h});l(f)},onDragEnter:()=>{i("over")},onDragLeave:()=>{i("idle")}}),zh({canMonitor:K4,onDragStart:()=>{i("potential"),Y4.start()},onDrop:()=>{i("idle"),Y4.stop()}}))},[l]),u.useEffect(()=>(window.addEventListener("paste",c),()=>{window.removeEventListener("paste",c)}),[c]),r.jsx(ke,{ref:t,"data-dnd-state":s,sx:Xae,children:r.jsx(hf,{dndState:s,label:r.jsx(pL,{})})})});fL.displayName="FullscreenDropzone";const pL=u.memo(()=>{const{t:e}=P(),t=I(Ar),n=Sp(t);return r.jsxs(T,{flexDir:"column",gap:4,color:"base.100",alignItems:"center",children:[r.jsx(Ot,{size:"lg",children:e("gallery.dropToUpload")}),r.jsx(Ot,{size:"md",children:e("toast.imagesWillBeAddedTo",{boardName:n})})]})});pL.displayName="DropLabel";const vv=Oe(!1),gL=()=>{const e=ce(vv),t=u.useCallback(()=>{vv.set(!0)},[]),n=u.useCallback(()=>{vv.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},Qae=""+new URL("commercial-license-bg-C_dHp7on.png",import.meta.url).href,Jae=""+new URL("denoising-strength-4mznP2tj.png",import.meta.url).href,ele={paramNegativeConditioning:{placement:"right"},clipSkip:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},inpainting:{href:"https://support.invoke.ai/support/solutions/articles/151000096702-inpainting-outpainting-and-bounding-box"},rasterLayer:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-raster-layers-and-initial-images"},regionalGuidance:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},regionalGuidanceAndReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000165024-regional-guidance-layers"},globalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},regionalReferenceImage:{href:"https://support.invoke.ai/support/solutions/articles/151000159340-global-and-regional-reference-images-ip-adapters-"},controlNet:{href:"https://support.invoke.ai/support/solutions/articles/151000105880"},controlNetBeginEnd:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},lora:{href:"https://support.invoke.ai/support/solutions/articles/151000159072"},loraWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000159072-concepts-low-rank-adaptations-loras-"},compositingMaskBlur:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingBlurMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingCoherenceMode:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},infillMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},scaleBeforeProcessing:{href:"https://support.invoke.ai/support/solutions/articles/151000179777-scale-before-processing"},paramCFGScale:{href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramCFGRescaleMultiplier:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramDenoisingStrength:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-image-to-image",image:Jae},paramHrf:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},paramIterations:{href:"https://support.invoke.ai/support/solutions/articles/151000159073"},paramPositiveConditioning:{href:"https://support.invoke.ai/support/solutions/articles/151000096606-tips-on-crafting-prompts",placement:"right"},paramScheduler:{placement:"right",href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramSeed:{href:"https://support.invoke.ai/support/solutions/articles/151000096684-what-is-a-seed-how-do-i-use-it-to-recreate-the-same-image-"},paramModel:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000096601-what-is-a-model-which-should-i-use-"},paramRatio:{gutter:16},controlNetControlMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetProcessor:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000105880-using-controlnet"},controlNetResizeMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},paramVAE:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramVAEPrecision:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramUpscaleMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},refinerModel:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerNegativeAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerPositiveAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerScheduler:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerStart:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerSteps:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerCfgScale:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},seamlessTilingXAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},seamlessTilingYAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},fluxDevLicense:{href:"https://www.invoke.com/get-a-commercial-license-for-flux",image:Qae}},tle=1e3,nle=[{name:"preventOverflow",options:{padding:10}}],sle=ve(W0,e=>e.shouldEnableInformationalPopovers),Ve=u.memo(({feature:e,children:t,inPortal:n=!0,hideDisable:s=!1,...i})=>{const o=I(sle),a=u.useMemo(()=>ele[e],[e]),l=u.useMemo(()=>qT(wl(a,["image","href","buttonLabel"]),i),[a,i]);return!s&&!o?t:r.jsxs(Vn,{isLazy:!0,closeOnBlur:!1,trigger:"hover",variant:"informational",openDelay:tle,modifiers:nle,placement:"top",...l,children:[r.jsx(Yn,{children:t}),n?r.jsx(Uf,{children:r.jsx(Q4,{data:a,feature:e,hideDisable:s})}):r.jsx(Q4,{data:a,feature:e,hideDisable:s})]})});Ve.displayName="InformationalPopover";const Q4=({data:e,feature:t,hideDisable:n})=>{const{t:s}=P(),i=z(),o=u.useMemo(()=>s(`popovers.${t}.heading`),[t,s]),a=u.useMemo(()=>s(`popovers.${t}.paragraphs`,{returnObjects:!0})??[],[t,s]),l=u.useCallback(()=>{e!=null&&e.href&&window.open(e.href)},[e==null?void 0:e.href]),c=u.useCallback(()=>{i(KT(!1)),fe({title:s("settings.informationalPopoversDisabled"),description:s("settings.informationalPopoversDisabledDesc"),status:"info"})},[i,s]);return r.jsxs(Gn,{maxW:300,children:[r.jsx(ZT,{top:2}),r.jsx(Xn,{children:r.jsxs(T,{gap:2,flexDirection:"column",alignItems:"flex-start",children:[o&&r.jsxs(r.Fragment,{children:[r.jsx(Ot,{size:"sm",children:o}),r.jsx(Et,{})]}),(e==null?void 0:e.image)&&r.jsxs(r.Fragment,{children:[r.jsx(dn,{objectFit:"contain",backgroundColor:"white",src:e.image,alt:"Optional Image"}),r.jsx(Et,{})]}),a.map(d=>r.jsx(K,{children:d},d)),r.jsx(Et,{}),r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"full",children:[!n&&r.jsx(ye,{onClick:c,variant:"link",size:"sm",children:s("common.dontShowMeThese")}),r.jsx(nt,{}),(e==null?void 0:e.href)&&r.jsx(ye,{onClick:l,leftIcon:r.jsx(_1,{}),variant:"link",size:"sm",children:s("common.learnMore")??o})]})]})})]})},rle=()=>{const e=I(HU),t=I(WU),n=I(UU),s=z(),{t:i}=P(),o=u.useCallback(a=>{s(qU(a))},[s]);return r.jsxs(Z,{isDisabled:!n,children:[r.jsx(Ve,{feature:"dynamicPromptsMaxPrompts",inPortal:!1,children:r.jsx(te,{children:i("dynamicPrompts.maxPrompts")})}),r.jsx(qe,{min:t.sliderMin,max:t.sliderMax,value:e,defaultValue:t.initial,onChange:o,marks:!0}),r.jsx(Ae,{min:t.numberInputMin,max:t.numberInputMax,value:e,defaultValue:t.initial,onChange:o})]})},ile=u.memo(rle),ole=u.memo(e=>e.image?r.jsx(pC,{w:`${e.image.width}px`,h:"auto",objectFit:"contain",aspectRatio:`${e.image.width}/${e.image.height}`}):r.jsx(T,{opacity:.7,w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",bg:"base.900",children:r.jsx(or,{size:"xl"})}));ole.displayName="IAILoadingImageFallback";const Yt=u.memo(e=>{const{icon:t=mu,boxSize:n=16,...s}=e;return r.jsxs(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",fontSize:"md",...s,children:[t&&r.jsx(pt,{as:t,boxSize:n,opacity:.7}),e.label&&r.jsx(K,{textAlign:"center",children:e.label})]})});Yt.displayName="IAINoContentFallback";const R1=u.memo(e=>{const{sx:t,...n}=e,s=u.useMemo(()=>({w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",...t}),[t]);return r.jsxs(T,{sx:s,...n,children:[r.jsx(or,{size:"xl"}),e.label&&r.jsx(K,{textAlign:"center",children:e.label})]})});R1.displayName="IAINoContentFallbackWithSpinner";var mL=2147483647;function J4(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function e5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?J4(Object(n),!0).forEach(function(s){yi(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J4(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var ff=2,t5=ff/2;function ale(e){return{x:Math.floor(e.x),y:Math.floor(e.y)}}function lle(e){return{x:e.x-t5,y:e.y-t5}}function cle(e){return{x:Math.max(e.x,0),y:Math.max(e.y,0)}}function ule(e){return{x:Math.min(e.x,window.innerWidth-ff),y:Math.min(e.y,window.innerHeight-ff)}}function n5(e){var t=e.client,n=ule(cle(lle(ale(t))));return DOMRect.fromRect({x:n.x,y:n.y,width:ff,height:ff})}function s5(e){var t=e.clientRect;return{left:"".concat(t.left,"px"),top:"".concat(t.top,"px"),width:"".concat(t.width,"px"),height:"".concat(t.height,"px")}}function dle(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function hle(e){var t=e.initial,n=document.createElement("div");n.setAttribute(rL,"true");var s=n5({client:t});Object.assign(n.style,e5(e5({backgroundColor:"transparent",position:"fixed",padding:0,margin:0,boxSizing:"border-box"},s5({clientRect:s})),{},{pointerEvents:"auto",zIndex:mL})),document.body.appendChild(n);var i=so.bind(window,{type:"pointermove",listener:function(a){var l={x:a.clientX,y:a.clientY};s=n5({client:l}),Object.assign(n.style,s5({clientRect:s}))},options:{capture:!0}});return function(a){var l=a.current;if(i(),dle({client:l,clientRect:s})){n.remove();return}function c(){d(),n.remove()}var d=so.bindAll(window,[{type:"pointerdown",listener:c},{type:"pointermove",listener:c},{type:"focusin",listener:c},{type:"focusout",listener:c},{type:"dragstart",listener:c},{type:"dragenter",listener:c},{type:"dragover",listener:c}],{capture:!0})}}function fle(){var e=null;function t(){return e=null,so.bind(window,{type:"pointermove",listener:function(i){e={x:i.clientX,y:i.clientY}},options:{capture:!0}})}function n(){var s=null;return function(o){var a=o.eventName,l=o.payload;if(a==="onDragStart"){var c,d=l.location.initial.input,h=(c=e)!==null&&c!==void 0?c:{x:d.clientX,y:d.clientY};s=hle({initial:h})}if(a==="onDrop"){var f,p=l.location.current.input;(f=s)===null||f===void 0||f({current:{x:p.clientX,y:p.clientY}}),s=null,e=null}}}return{bindEvents:t,getOnPostDispatch:n}}var ple="text/uri-list",Vm=new WeakMap;function gle(e){return Vm.set(e.element,e),function(){Vm.delete(e.element)}}var r5=fle(),ES=uL({typeKey:"element",defaultDropEffect:"move",mount:function(t){return Kn(r5.bindEvents(),so.bind(document,{type:"dragstart",listener:function(s){var i,o,a,l,c,d;if(t.canStart(s)&&!s.defaultPrevented&&s.dataTransfer){var h=s.target;if(!(h instanceof HTMLElement))return null;var f=Vm.get(h);if(!f)return null;var p=Gh(s),g={element:f.element,dragHandle:(i=f.dragHandle)!==null&&i!==void 0?i:null,input:p};if(f.canDrag&&!f.canDrag(g))return s.preventDefault(),null;if(f.dragHandle){var m=IS({x:p.clientX,y:p.clientY});if(!f.dragHandle.contains(m))return s.preventDefault(),null}var y=(o=(a=f.getInitialDataForExternal)===null||a===void 0?void 0:a.call(f,g))!==null&&o!==void 0?o:null;if(y)for(var x=0,C=Object.entries(y);x<C.length;x++){var v=_S(C[x],2),b=v[0],S=v[1];s.dataTransfer.setData(b,S??"")}$ae()&&!s.dataTransfer.types.includes(ux)&&!s.dataTransfer.types.includes(ple)&&s.dataTransfer.setData(ux,dL),s.dataTransfer.setData(hL,"");var w={element:f.element,dragHandle:(l=f.dragHandle)!==null&&l!==void 0?l:null,data:(c=(d=f.getInitialData)===null||d===void 0?void 0:d.call(f,g))!==null&&c!==void 0?c:{}},j={type:"element",payload:w,startedFrom:"internal"};t.start({event:s,dragType:j})}}}))},dispatchEventToSource:function(t){var n,s,i=t.eventName,o=t.payload;(n=Vm.get(o.source.element))===null||n===void 0||(s=n[i])===null||s===void 0||s.call(n,o)},onPostDispatch:r5.getOnPostDispatch()}),yu=ES.dropTarget,qi=ES.monitor;function Wu(e){return Kn(ES.registerUsage(),gle(e),cL(e.element,{attribute:"draggable",value:"true"}))}var pf=new Map,am=new Set;function yL(e){mle(e);var t=pf.get(e);if(t)return t;var n={timeOfEngagementStart:Date.now()};return pf.set(e,n),n}function mle(e){am.add(e)}function yle(e){am.clear(),e(),pf.forEach(function(t,n){am.has(n)||pf.delete(n)}),am.clear()}function vle(){pf.clear()}var i5=new Map;function ble(e){var t=i5.get(e);if(t)return t;var n=xle(e);return i5.set(e,n),n}function xle(e){var t={type:"idle"},n=[];function s(c){if(t.type==="running"){var d=c-t.timeLastFrameFinished,h=t,f=h.latestArgs,p=IS({x:f.location.current.input.clientX,y:f.location.current.input.clientY});yle(function(){n.forEach(function(g){return g({underUsersPointer:p,latestArgs:f,timeSinceLastFrame:d})})}),t.timeLastFrameFinished=c,t.frameId=requestAnimationFrame(s)}}function i(){t.type!=="idle"&&(cancelAnimationFrame(t.frameId),vle(),t={type:"idle"})}function o(c){t.type==="idle"&&(t={type:"initializing",latestArgs:c,frameId:requestAnimationFrame(function(d){t.type==="initializing"&&(t={type:"running",timeLastFrameFinished:d,latestArgs:t.latestArgs,frameId:requestAnimationFrame(s)})})})}function a(c){if(t.type==="idle"){o(c);return}t.latestArgs=c}e({onDragStart:o,onDropTargetChange:a,onDrag:a,onDrop:i});var l={onFrame:function(d){n.push(d)}};return l}var px="data-auto-scrollable",Cle="[".concat(px,'="true"]');function Sle(e){return e.setAttribute(px,"true"),function(){return e.removeAttribute(px)}}function o5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function a5(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?o5(Object(n),!0).forEach(function(s){yi(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var wle={startHitboxAtPercentageRemainingOfElement:{top:.25,right:.25,bottom:.25,left:.25},maxScrollAtPercentageRemainingOfHitbox:{top:.5,right:.5,bottom:.5,left:.5},timeDampeningDurationMs:300,maxMainAxisHitboxSize:180},jle={standard:15*60,fast:25*60};function vL(e){var t;return a5(a5({},wle),{},{maxPixelScrollPerSecond:jle[(t=e==null?void 0:e.maxScrollSpeed)!==null&&t!==void 0?t:"standard"]})}var kle={top:function(t){return t.scrollTop>0},right:function(t){return Math.ceil(t.scrollLeft)+t.clientWidth<t.scrollWidth},bottom:function(t){return Math.ceil(t.scrollTop)+t.clientHeight<t.scrollHeight},left:function(t){return t.scrollLeft>0}},_le=["top","right","bottom","left"],Ile={top:"vertical",right:"horizontal",bottom:"vertical",left:"horizontal"},l5={start:"top",end:"bottom",point:"y",size:"height"},c5={start:"left",end:"right",point:"x",size:"width"},bL={vertical:{mainAxis:l5,crossAxis:c5},horizontal:{mainAxis:c5,crossAxis:l5}},LS={top:"start",right:"end",bottom:"end",left:"start"};function fg(e){var t=e.edge,n=e.axis;return function(i){var o,a=i.clientRect,l=i.config,c=bL[n],d=c.mainAxis,h=c.crossAxis,f=LS[t],p=Math.min(l.startHitboxAtPercentageRemainingOfElement[t]*a[d.size],l.maxMainAxisHitboxSize);return DOMRect.fromRect((o={},yi(o,d.point,f==="start"?a[d.point]:a[d.point]+a[d.size]-p),yi(o,h.point,a[h.point]),yi(o,d.size,p),yi(o,h.size,a[h.size]),o))}}var Ale={top:fg({axis:"vertical",edge:"top"}),right:fg({axis:"horizontal",edge:"right"}),bottom:fg({axis:"vertical",edge:"bottom"}),left:fg({axis:"horizontal",edge:"left"})};function gx(e){var t=e.startOfRange,n=e.endOfRange,s=e.value,i=t<n;if(!i||s<t)return 0;if(s>n)return 1;var o=n-t;return(s-t)/o}function Tle(e){var t=e.timeSinceLastFrame,n=e.config,s=n.maxPixelScrollPerSecond/1e3,i=Math.ceil(s*t),o=n.maxPixelScrollPerSecond/60;return Math.min(i,o)}function Mle(e){var t=e.client,n=e.axis,s=e.edge,i=e.hitbox,o=e.config,a=bL[n].mainAxis,l=LS[s],c=i[a.size]*o.maxScrollAtPercentageRemainingOfHitbox[s];if(l==="end")return gx({startOfRange:i[a.start],endOfRange:i[a.end]-c,value:t[a.point]});var d=gx({startOfRange:i[a.start]+c,endOfRange:i[a.end],value:t[a.point]});return 1-d}function pg(e){var t=e.client,n=e.timeSinceLastFrame,s=e.engagement,i=e.axis,o=e.hitbox,a=e.edge,l=e.isDistanceDampeningEnabled,c=e.config,d=Tle({timeSinceLastFrame:n,config:c}),h=l?Mle({client:t,edge:a,hitbox:o,axis:i,config:c}):1,f=gx({startOfRange:s.timeOfEngagementStart,endOfRange:s.timeOfEngagementStart+c.timeDampeningDurationMs,value:Date.now()}),p=h*f,g=Math.max(d*p,1),m=LS[a];return m==="end"?g:-1*g}function Ple(e,t){return t==="all"||e===t}function Ele(e){var t=e.client,n=e.clientRect;return t.x>=n.x&&t.x<=n.x+n.width&&t.y>=n.y&&t.y<=n.y+n.height}function Lle(e){return e.getBoundingClientRect()}function xL(e){var t=e.element,n=e.input,s=e.timeSinceLastFrame,i=e.engagement,o=e.config,a=e.allowedAxis,l=e.getRect,c=l===void 0?Lle:l,d={x:n.clientX,y:n.clientY},h=c(t),f=_le.reduce(function(m,y){var x=Ale[y]({clientRect:h,config:o}),C=Ile[y];return!Ple(C,a)||!Ele({client:d,clientRect:x})||!kle[y](t)||m.set(y,{edge:y,hitbox:x}),m},new Map),p=function(){var m="horizontal",y=f.get("left");if(y)return pg({client:d,edge:y.edge,hitbox:y.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o});var x=f.get("right");return x?pg({client:d,edge:x.edge,hitbox:x.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o}):0}(),g=function(){var m="vertical",y=f.get("bottom");if(y)return pg({client:d,edge:y.edge,hitbox:y.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o});var x=f.get("top");return x?pg({client:d,edge:x.edge,hitbox:x.hitbox,axis:m,timeSinceLastFrame:s,engagement:i,isDistanceDampeningEnabled:!0,config:o}):0}();return{left:p,top:g}}function Dle(e,t){var n=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=Rle(e))||t){n&&(e=n);var s=0,i=function(){};return{s:i,n:function(){return s>=e.length?{done:!0}:{done:!1,value:e[s++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,l;return{s:function(){n=n.call(e)},n:function(){var d=n.next();return o=d.done,d},e:function(d){a=!0,l=d},f:function(){try{!o&&n.return!=null&&n.return()}finally{if(a)throw l}}}}function Rle(e,t){if(e){if(typeof e=="string")return u5(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return u5(e,t)}}function u5(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function CL(e){return!!(e.top||e.left)}function SL(e){var t,n,s,i=e.target,o=e.input,a=e.source,l=e.findEntry,c=e.timeSinceLastFrame,d=e.available,h=d===void 0?{top:!0,left:!0}:d;if(!CL(h)||!i)return h;var f=i.closest(Cle);if(!f)return h;var p=l(f);if(!p)return h;function g(){var S;return SL({target:(S=f==null?void 0:f.parentElement)!==null&&S!==void 0?S:null,findEntry:l,source:a,timeSinceLastFrame:c,input:o,available:h})}var m={input:o,source:a,element:f};if(p.canScroll&&!p.canScroll(m))return g();var y=yL(f),x=vL((t=p.getConfiguration)===null||t===void 0?void 0:t.call(p,m)),C=(n=(s=p.getAllowedAxis)===null||s===void 0?void 0:s.call(p,m))!==null&&n!==void 0?n:"all",v=xL({element:f,engagement:y,input:o,timeSinceLastFrame:c,allowedAxis:C,config:x}),b={top:0,left:0};return h.top&&v.top!==0&&(b.top=v.top,h.top=!1),h.left&&v.left!==0&&(b.left=v.left,h.left=!1),(b.top!==0||b.left!==0)&&f.scrollBy(b),g()}function Ole(e){var t=e.input,n=e.timeSinceLastFrame,s=e.available,i=e.source,o=e.entries,a=document.documentElement,l={input:t,source:i,element:a},c=Dle(o),d;try{for(c.s();!(d=c.n()).done;){var h,f,p,g=d.value;if(!(g.canScroll&&!g.canScroll(l))){var m=yL(a),y=vL((h=g.getConfiguration)===null||h===void 0?void 0:h.call(g,l)),x=(f=(p=g.getAllowedAxis)===null||p===void 0?void 0:p.call(g,l))!==null&&f!==void 0?f:"all",C=xL({element:a,engagement:m,input:t,config:y,allowedAxis:x,getRect:function(S){return DOMRect.fromRect({y:0,x:0,width:S.clientWidth,height:S.clientHeight})},timeSinceLastFrame:n}),v={top:s.top?C.top:0,left:s.left?C.left:0};(v.top!==0||v.left!==0)&&a.scrollBy(v);break}}}catch(b){c.e(b)}finally{c.f()}}function Nle(e){var t=e.input,n=e.findEntry,s=e.timeSinceLastFrame,i=e.source,o=e.getWindowScrollEntries,a=e.underUsersPointer,l=SL({target:a,timeSinceLastFrame:s,input:t,source:i,findEntry:n});CL(l)&&Ole({input:t,source:i,entries:o(),timeSinceLastFrame:s,available:l})}function d5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function Fle(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?d5(Object(n),!0).forEach(function(s){yi(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function wL(e){var t=e.monitor,n=new Map,s=new Set;function i(d){return n.set(d.element,d),Kn(Sle(d.element),function(){return n.delete(d.element)})}function o(){var d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},h=Fle({},d);return s.add(h),function(){return s.delete(h)}}function a(d){var h;return(h=n.get(d))!==null&&h!==void 0?h:null}function l(){return Array.from(s)}function c(d){var h=d.latestArgs,f=d.underUsersPointer,p=d.timeSinceLastFrame;Nle({input:h.location.current.input,source:h.source,findEntry:a,underUsersPointer:f,timeSinceLastFrame:p,getWindowScrollEntries:l})}return ble(t).onFrame(c),{autoScroll:i,autoScrollWindow:o}}var Ble=wL({monitor:qi}),jL=Ble.autoScroll,$le=wL({monitor:zh}),kL=$le.autoScroll;/*!
 * OverlayScrollbars
 * Version: 2.10.0
 *
 * Copyright (c) Rene Haas | KingSora.
 * https://github.com/KingSora
 *
 * Released under the MIT license.
 */const gr=(e,t)=>{const{o:n,i:s,u:i}=e;let o=n,a;const l=(h,f)=>{const p=o,g=h,m=f||(s?!s(p,g):p!==g);return(m||i)&&(o=g,a=p),[o,m,a]};return[t?h=>l(t(o,a),h):l,h=>[o,!!h,a]]},Vle=typeof window<"u"&&typeof HTMLElement<"u"&&!!window.document,Zs=Vle?window:{},Gm=Math.max,Gle=Math.min,mx=Math.round,zm=Math.abs,h5=Math.sign,DS=Zs.cancelAnimationFrame,O1=Zs.requestAnimationFrame,Hm=Zs.setTimeout,yx=Zs.clearTimeout,N1=e=>typeof Zs[e]<"u"?Zs[e]:void 0,zle=N1("MutationObserver"),f5=N1("IntersectionObserver"),Wm=N1("ResizeObserver"),lm=N1("ScrollTimeline"),RS=e=>e===void 0,F1=e=>e===null,Ki=e=>typeof e=="number",wp=e=>typeof e=="string",OS=e=>typeof e=="boolean",_r=e=>typeof e=="function",ro=e=>Array.isArray(e),Um=e=>typeof e=="object"&&!ro(e)&&!F1(e),NS=e=>{const t=!!e&&e.length,n=Ki(t)&&t>-1&&t%1==0;return ro(e)||!_r(e)&&n?t>0&&Um(e)?t-1 in e:!0:!1},qm=e=>!!e&&e.constructor===Object,Km=e=>e instanceof HTMLElement,B1=e=>e instanceof Element,p5=()=>performance.now(),bv=(e,t,n,s,i)=>{let o=0;const a=p5(),l=Gm(0,n),c=d=>{const h=p5(),p=h-a>=l,g=d?1:1-(Gm(0,a+l-h)/l||0),m=(t-e)*(_r(i)?i(g,g*l,0,1,l):g)+e,y=p||g===1;s&&s(m,g,y),o=y?0:O1(()=>c())};return c(),d=>{DS(o),d&&c(d)}};function Ut(e,t){if(NS(e))for(let n=0;n<e.length&&t(e[n],n,e)!==!1;n++);else e&&Ut(Object.keys(e),n=>t(e[n],n,e));return e}const _L=(e,t)=>e.indexOf(t)>=0,gf=(e,t)=>e.concat(t),vn=(e,t,n)=>(!wp(t)&&NS(t)?Array.prototype.push.apply(e,t):e.push(t),e),Da=e=>Array.from(e||[]),FS=e=>ro(e)?e:!wp(e)&&NS(e)?Da(e):[e],vx=e=>!!e&&!e.length,bx=e=>Da(new Set(e)),Sr=(e,t,n)=>{Ut(e,i=>i?i.apply(void 0,t||[]):!0),!n&&(e.length=0)},IL="paddingTop",AL="paddingRight",TL="paddingLeft",ML="paddingBottom",PL="marginLeft",EL="marginRight",LL="marginBottom",DL="overflowX",RL="overflowY",$1="width",V1="height",ia="visible",al="hidden",vu="scroll",Hle=e=>{const t=String(e||"");return t?t[0].toUpperCase()+t.slice(1):""},G1=(e,t,n,s)=>{if(e&&t){let i=!0;return Ut(n,o=>{const a=e[o],l=t[o];a!==l&&(i=!1)}),i}return!1},OL=(e,t)=>G1(e,t,["w","h"]),cm=(e,t)=>G1(e,t,["x","y"]),Wle=(e,t)=>G1(e,t,["t","r","b","l"]),pa=()=>{},et=(e,...t)=>e.bind(0,...t),ll=e=>{let t;const n=e?Hm:O1,s=e?yx:DS;return[i=>{s(t),t=n(()=>i(),_r(e)?e():e)},()=>s(t)]},xx=(e,t)=>{const{_:n,v:s,p:i,S:o}=t||{};let a,l,c,d,h=pa;const f=function(x){h(),yx(a),d=a=l=void 0,h=pa,e.apply(this,x)},p=y=>o&&l?o(l,y):y,g=()=>{h!==pa&&f(p(c)||c)},m=function(){const x=Da(arguments),C=_r(n)?n():n;if(Ki(C)&&C>=0){const b=_r(s)?s():s,S=Ki(b)&&b>=0,w=C>0?Hm:O1,j=C>0?yx:DS,A=p(x)||x,L=f.bind(0,A);let M;h(),i&&!d?(L(),d=!0,M=w(()=>d=void 0,C)):(M=w(L,C),S&&!a&&(a=Hm(g,b))),h=()=>j(M),l=c=A}else f(x)};return m.m=g,m},NL=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),wi=e=>e?Object.keys(e):[],Pt=(e,t,n,s,i,o,a)=>{const l=[t,n,s,i,o,a];return(typeof e!="object"||F1(e))&&!_r(e)&&(e={}),Ut(l,c=>{Ut(c,(d,h)=>{const f=c[h];if(e===f)return!0;const p=ro(f);if(f&&qm(f)){const g=e[h];let m=g;p&&!ro(g)?m=[]:!p&&!qm(g)&&(m={}),e[h]=Pt(m,f)}else e[h]=p?f.slice():f})}),e},FL=(e,t)=>Ut(Pt({},e),(n,s,i)=>{n===void 0?delete i[s]:n&&qm(n)&&(i[s]=FL(n))}),BS=e=>!wi(e).length,BL=(e,t,n)=>Gm(e,Gle(t,n)),ml=e=>bx((ro(e)?e:(e||"").split(" ")).filter(t=>t)),$S=(e,t)=>e&&e.getAttribute(t),g5=(e,t)=>e&&e.hasAttribute(t),Co=(e,t,n)=>{Ut(ml(t),s=>{e&&e.setAttribute(s,String(n||""))})},Pi=(e,t)=>{Ut(ml(t),n=>e&&e.removeAttribute(n))},z1=(e,t)=>{const n=ml($S(e,t)),s=et(Co,e,t),i=(o,a)=>{const l=new Set(n);return Ut(ml(o),c=>{l[a](c)}),Da(l).join(" ")};return{O:o=>s(i(o,"delete")),$:o=>s(i(o,"add")),C:o=>{const a=ml(o);return a.reduce((l,c)=>l&&n.includes(c),a.length>0)}}},$L=(e,t,n)=>(z1(e,t).O(n),et(VS,e,t,n)),VS=(e,t,n)=>(z1(e,t).$(n),et($L,e,t,n)),Zm=(e,t,n,s)=>(s?VS:$L)(e,t,n),GS=(e,t,n)=>z1(e,t).C(n),VL=e=>z1(e,"class"),GL=(e,t)=>{VL(e).O(t)},zS=(e,t)=>(VL(e).$(t),et(GL,e,t)),zL=(e,t)=>{const n=t?B1(t)&&t:document;return n?Da(n.querySelectorAll(e)):[]},Ule=(e,t)=>{const n=t?B1(t)&&t:document;return n&&n.querySelector(e)},Cx=(e,t)=>B1(e)&&e.matches(t),HL=e=>Cx(e,"body"),Sx=e=>e?Da(e.childNodes):[],mf=e=>e&&e.parentElement,Nc=(e,t)=>B1(e)&&e.closest(t),wx=e=>document.activeElement,qle=(e,t,n)=>{const s=Nc(e,t),i=e&&Ule(n,s),o=Nc(i,t)===s;return s&&i?s===e||i===e||o&&Nc(Nc(e,n),t)!==s:!1},bu=e=>{Ut(FS(e),t=>{const n=mf(t);t&&n&&n.removeChild(t)})},vr=(e,t)=>et(bu,e&&t&&Ut(FS(t),n=>{n&&e.appendChild(n)})),Jc=e=>{const t=document.createElement("div");return Co(t,"class",e),t},WL=e=>{const t=Jc();return t.innerHTML=e.trim(),Ut(Sx(t),n=>bu(n))},m5=(e,t)=>e.getPropertyValue(t)||e[t]||"",UL=e=>{const t=e||0;return isFinite(t)?t:0},gg=e=>UL(parseFloat(e||"")),jx=e=>Math.round(e*1e4)/1e4,qL=e=>`${jx(UL(e))}px`;function yf(e,t){e&&t&&Ut(t,(n,s)=>{try{const i=e.style,o=F1(n)||OS(n)?"":Ki(n)?qL(n):n;s.indexOf("--")===0?i.setProperty(s,o):i[s]=o}catch{}})}function Fo(e,t,n){const s=wp(t);let i=s?"":{};if(e){const o=Zs.getComputedStyle(e,n)||e.style;i=s?m5(o,t):Da(t).reduce((a,l)=>(a[l]=m5(o,l),a),i)}return i}const y5=(e,t,n)=>{const s=t?`${t}-`:"",i=n?`-${n}`:"",o=`${s}top${i}`,a=`${s}right${i}`,l=`${s}bottom${i}`,c=`${s}left${i}`,d=Fo(e,[o,a,l,c]);return{t:gg(d[o]),r:gg(d[a]),b:gg(d[l]),l:gg(d[c])}},Kle=(e,t)=>`translate${Um(e)?`(${e.x},${e.y})`:`Y(${e})`}`,Zle=e=>!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),Yle={w:0,h:0},H1=(e,t)=>t?{w:t[`${e}Width`],h:t[`${e}Height`]}:Yle,Xle=e=>H1("inner",e||Zs),eu=et(H1,"offset"),KL=et(H1,"client"),Ym=et(H1,"scroll"),HS=e=>{const t=parseFloat(Fo(e,$1))||0,n=parseFloat(Fo(e,V1))||0;return{w:t-mx(t),h:n-mx(n)}},xv=e=>e.getBoundingClientRect(),Qle=e=>!!e&&Zle(e),kx=e=>!!(e&&(e[V1]||e[$1])),ZL=(e,t)=>{const n=kx(e);return!kx(t)&&n},v5=(e,t,n,s)=>{Ut(ml(t),i=>{e&&e.removeEventListener(i,n,s)})},cn=(e,t,n,s)=>{var i;const o=(i=s&&s.H)!=null?i:!0,a=s&&s.I||!1,l=s&&s.A||!1,c={passive:o,capture:a};return et(Sr,ml(t).map(d=>{const h=l?f=>{v5(e,d,h,a),n&&n(f)}:n;return e&&e.addEventListener(d,h,c),et(v5,e,d,h,a)}))},YL=e=>e.stopPropagation(),_x=e=>e.preventDefault(),XL=e=>YL(e)||_x(e),Gi=(e,t)=>{const{x:n,y:s}=Ki(t)?{x:t,y:t}:t||{};Ki(n)&&(e.scrollLeft=n),Ki(s)&&(e.scrollTop=s)},br=e=>({x:e.scrollLeft,y:e.scrollTop}),QL=()=>({D:{x:0,y:0},M:{x:0,y:0}}),Jle=(e,t)=>{const{D:n,M:s}=e,{w:i,h:o}=t,a=(f,p,g)=>{let m=h5(f)*g,y=h5(p)*g;if(m===y){const x=zm(f),C=zm(p);y=x>C?0:y,m=x<C?0:m}return m=m===y?0:m,[m+0,y+0]},[l,c]=a(n.x,s.x,i),[d,h]=a(n.y,s.y,o);return{D:{x:l,y:d},M:{x:c,y:h}}},b5=({D:e,M:t})=>{const n=(s,i)=>s===0&&s<=i;return{x:n(e.x,t.x),y:n(e.y,t.y)}},x5=({D:e,M:t},n)=>{const s=(i,o,a)=>BL(0,1,(i-a)/(i-o)||0);return{x:s(e.x,t.x,n.x),y:s(e.y,t.y,n.y)}},Ix=e=>{e&&e.focus&&e.focus({preventScroll:!0})},C5=(e,t)=>{Ut(FS(t),e)},Ax=e=>{const t=new Map,n=(o,a)=>{if(o){const l=t.get(o);C5(c=>{l&&l[c?"delete":"clear"](c)},a)}else t.forEach(l=>{l.clear()}),t.clear()},s=(o,a)=>{if(wp(o)){const d=t.get(o)||new Set;return t.set(o,d),C5(h=>{_r(h)&&d.add(h)},a),et(n,o,a)}OS(a)&&a&&n();const l=wi(o),c=[];return Ut(l,d=>{const h=o[d];h&&vn(c,s(d,h))}),et(Sr,c)},i=(o,a)=>{Ut(Da(t.get(o)),l=>{a&&!vx(a)?l.apply(0,a):l()})};return s(e||{}),[s,n,i]},S5=e=>JSON.stringify(e,(t,n)=>{if(_r(n))throw 0;return n}),w5=(e,t)=>e?`${t}`.split(".").reduce((n,s)=>n&&NL(n,s)?n[s]:void 0,e):void 0,ece={paddingAbsolute:!1,showNativeOverlaidScrollbars:!1,update:{elementEvents:[["img","load"]],debounce:[0,33],attributes:null,ignoreMutation:null},overflow:{x:"scroll",y:"scroll"},scrollbars:{theme:"os-theme-dark",visibility:"auto",autoHide:"never",autoHideDelay:1300,autoHideSuspend:!1,dragScroll:!0,clickScroll:!1,pointers:["mouse","touch","pen"]}},JL=(e,t)=>{const n={},s=gf(wi(t),wi(e));return Ut(s,i=>{const o=e[i],a=t[i];if(Um(o)&&Um(a))Pt(n[i]={},JL(o,a)),BS(n[i])&&delete n[i];else if(NL(t,i)&&a!==o){let l=!0;if(ro(o)||ro(a))try{S5(o)===S5(a)&&(l=!1)}catch{}l&&(n[i]=a)}}),n},j5=(e,t,n)=>s=>[w5(e,s),n||w5(t,s)!==void 0],Uu="data-overlayscrollbars",um="os-environment",mg=`${um}-scrollbar-hidden`,Cv=`${Uu}-initialize`,dm="noClipping",k5=`${Uu}-body`,ga=Uu,tce="host",So=`${Uu}-viewport`,nce=DL,sce=RL,rce="arrange",eD="measuring",ice="scrolling",tD="scrollbarHidden",oce="noContent",Tx=`${Uu}-padding`,_5=`${Uu}-content`,WS="os-size-observer",ace=`${WS}-appear`,lce=`${WS}-listener`,cce="os-trinsic-observer",uce="os-theme-none",Er="os-scrollbar",dce=`${Er}-rtl`,hce=`${Er}-horizontal`,fce=`${Er}-vertical`,nD=`${Er}-track`,US=`${Er}-handle`,pce=`${Er}-visible`,gce=`${Er}-cornerless`,I5=`${Er}-interaction`,A5=`${Er}-unusable`,Mx=`${Er}-auto-hide`,T5=`${Mx}-hidden`,M5=`${Er}-wheel`,mce=`${nD}-interactive`,yce=`${US}-interactive`;let sD;const vce=()=>sD,bce=e=>{sD=e};let Sv;const xce=()=>{const e=(S,w,j)=>{vr(document.body,S),vr(document.body,S);const E=KL(S),A=eu(S),L=HS(w);return j&&bu(S),{x:A.h-E.h+L.h,y:A.w-E.w+L.w}},t=S=>{let w=!1;const j=zS(S,mg);try{w=Fo(S,"scrollbar-width")==="none"||Fo(S,"display","::-webkit-scrollbar")==="none"}catch{}return j(),w},n=`.${um}{scroll-behavior:auto!important;position:fixed;opacity:0;visibility:hidden;overflow:scroll;height:200px;width:200px;z-index:-1}.${um} div{width:200%;height:200%;margin:10px 0}.${mg}{scrollbar-width:none!important}.${mg}::-webkit-scrollbar,.${mg}::-webkit-scrollbar-corner{appearance:none!important;display:none!important;width:0!important;height:0!important}`,i=WL(`<div class="${um}"><div></div><style>${n}</style></div>`)[0],o=i.firstChild,a=i.lastChild,l=vce();l&&(a.nonce=l);const[c,,d]=Ax(),[h,f]=gr({o:e(i,o),i:cm},et(e,i,o,!0)),[p]=f(),g=t(i),m={x:p.x===0,y:p.y===0},y={elements:{host:null,padding:!g,viewport:S=>g&&HL(S)&&S,content:!1},scrollbars:{slot:!0},cancel:{nativeScrollbarsOverlaid:!1,body:null}},x=Pt({},ece),C=et(Pt,{},x),v=et(Pt,{},y),b={T:p,k:m,R:g,V:!!lm,L:et(c,"r"),U:v,P:S=>Pt(y,S)&&v(),N:C,q:S=>Pt(x,S)&&C(),B:Pt({},y),F:Pt({},x)};if(Pi(i,"style"),bu(i),cn(Zs,"resize",()=>{d("r",[])}),_r(Zs.matchMedia)&&!g&&(!m.x||!m.y)){const S=w=>{const j=Zs.matchMedia(`(resolution: ${Zs.devicePixelRatio}dppx)`);cn(j,"change",()=>{w(),S(w)},{A:!0})};S(()=>{const[w,j]=h();Pt(b.T,w),d("r",[j])})}return b},fo=()=>(Sv||(Sv=xce()),Sv),rD=(e,t)=>_r(t)?t.apply(0,e):t,Cce=(e,t,n,s)=>{const i=RS(s)?n:s;return rD(e,i)||t.apply(0,e)},iD=(e,t,n,s)=>{const i=RS(s)?n:s,o=rD(e,i);return!!o&&(Km(o)?o:t.apply(0,e))},Sce=(e,t)=>{const{nativeScrollbarsOverlaid:n,body:s}=t||{},{k:i,R:o,U:a}=fo(),{nativeScrollbarsOverlaid:l,body:c}=a().cancel,d=n??l,h=RS(s)?c:s,f=(i.x||i.y)&&d,p=e&&(F1(h)?!o:h);return!!f||!!p},qS=new WeakMap,wce=(e,t)=>{qS.set(e,t)},jce=e=>{qS.delete(e)},oD=e=>qS.get(e),kce=(e,t,n)=>{let s=!1;const i=n?new WeakMap:!1,o=()=>{s=!0},a=l=>{if(i&&n){const c=n.map(d=>{const[h,f]=d||[];return[f&&h?(l||zL)(h,e):[],f]});Ut(c,d=>Ut(d[0],h=>{const f=d[1],p=i.get(h)||[];if(e.contains(h)&&f){const m=cn(h,f,y=>{s?(m(),i.delete(h)):t(y)});i.set(h,vn(p,m))}else Sr(p),i.delete(h)}))}};return a(),[o,a]},P5=(e,t,n,s)=>{let i=!1;const{j:o,X:a,Y:l,W:c,J:d,G:h}=s||{},f=xx(()=>i&&n(!0),{_:33,v:99}),[p,g]=kce(e,f,l),m=o||[],y=a||[],x=gf(m,y),C=(b,S)=>{if(!vx(S)){const w=d||pa,j=h||pa,E=[],A=[];let L=!1,M=!1;if(Ut(S,O=>{const{attributeName:F,target:_,type:R,oldValue:D,addedNodes:$,removedNodes:G}=O,ee=R==="attributes",Q=R==="childList",se=e===_,ne=ee&&F,H=ne&&$S(_,F||""),V=wp(H)?H:null,Y=ne&&D!==V,W=_L(y,F)&&Y;if(t&&(Q||!se)){const J=ee&&Y,N=J&&c&&Cx(_,c),U=(N?!w(_,F,D,V):!ee||J)&&!j(O,!!N,e,s);Ut($,ie=>vn(E,ie)),Ut(G,ie=>vn(E,ie)),M=M||U}!t&&se&&Y&&!w(_,F,D,V)&&(vn(A,F),L=L||W)}),g(O=>bx(E).reduce((F,_)=>(vn(F,zL(O,_)),Cx(_,O)?vn(F,_):F),[])),t)return!b&&M&&n(!1),[!1];if(!vx(A)||L){const O=[bx(A),L];return!b&&n.apply(0,O),O}}},v=new zle(et(C,!1));return[()=>(v.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:x,subtree:t,childList:t,characterData:t}),i=!0,()=>{i&&(p(),v.disconnect(),i=!1)}),()=>{if(i)return f.m(),C(!0,v.takeRecords())}]},aD={},lD={},_ce=e=>{Ut(e,t=>Ut(t,(n,s)=>{aD[s]=t[s]}))},cD=(e,t,n)=>wi(e).map(s=>{const{static:i,instance:o}=e[s],[a,l,c]=n||[],d=n?o:i;if(d){const h=n?d(a,l,t):d(t);return(c||lD)[s]=h}}),jp=e=>lD[e],Ice="__osOptionsValidationPlugin",Ace="__osSizeObserverPlugin",Tce=(e,t)=>{const{k:n}=t,[s,i]=e("showNativeOverlaidScrollbars");return[s&&n.x&&n.y,i]},xu=e=>e.indexOf(ia)===0,Mce=(e,t)=>{const n=(i,o,a,l)=>{const c=i===ia?al:i.replace(`${ia}-`,""),d=xu(i),h=xu(a);return!o&&!l?al:d&&h?ia:d?o&&l?c:o?ia:al:o?c:h&&l?ia:al},s={x:n(t.x,e.x,t.y,e.y),y:n(t.y,e.y,t.x,e.x)};return{K:s,Z:{x:s.x===vu,y:s.y===vu}}},uD="__osScrollbarsHidingPlugin",dD="__osClickScrollPlugin",Pce={[dD]:{static:()=>(e,t,n,s)=>{let i=!1,o=pa;const a=133,l=222,[c,d]=ll(a),h=Math.sign(t),f=n*h,p=f/2,g=C=>1-(1-C)*(1-C),m=(C,v)=>bv(C,v,l,e,g),y=(C,v)=>bv(C,t-f,a*v,(b,S,w)=>{e(b),w&&(o=m(b,t))}),x=bv(0,f,l,(C,v,b)=>{if(e(C),b&&(s(i),!i)){const S=t-C;Math.sign(S-p)===h&&c(()=>{const j=S-f;o=Math.sign(j)===h?y(C,Math.abs(j)/n):m(C,t)})}},g);return C=>{i=!0,C&&x(),d(),o()}}}},hD=(e,t,n)=>{const{dt:s}=n||{},i=jp(Ace),[o]=gr({o:!1,u:!0});return()=>{const a=[],c=WL(`<div class="${WS}"><div class="${lce}"></div></div>`)[0],d=c.firstChild,h=f=>{const p=f instanceof ResizeObserverEntry;let g=!1,m=!1;if(p){const[y,,x]=o(f.contentRect),C=kx(y);m=ZL(y,x),g=!m&&!C}else m=f===!0;g||t({ft:!0,dt:m})};if(Wm){const f=new Wm(p=>h(p.pop()));f.observe(d),vn(a,()=>{f.disconnect()})}else if(i){const[f,p]=i(d,h,s);vn(a,gf([zS(c,ace),cn(c,"animationstart",f)],p))}else return pa;return et(Sr,vn(a,vr(e,c)))}},Ece=(e,t)=>{let n;const s=c=>c.h===0||c.isIntersecting||c.intersectionRatio>0,i=Jc(cce),[o]=gr({o:!1}),a=(c,d)=>{if(c){const h=o(s(c)),[,f]=h;return f&&!d&&t(h)&&[h]}},l=(c,d)=>a(d.pop(),c);return[()=>{const c=[];if(f5)n=new f5(et(l,!1),{root:e}),n.observe(i),vn(c,()=>{n.disconnect()});else{const d=()=>{const h=eu(i);a(h)};vn(c,hD(i,d)()),d()}return et(Sr,vn(c,vr(e,i)))},()=>n&&l(!0,n.takeRecords())]},Lce=(e,t,n,s)=>{let i,o,a,l,c,d;const h=`[${ga}]`,f=`[${So}]`,p=["id","class","style","open","wrap","cols","rows"],{vt:g,ht:m,ot:y,gt:x,bt:C,nt:v,wt:b,yt:S,St:w,Ot:j}=e,E=W=>Fo(W,"direction")==="rtl",A={$t:!1,ct:E(g)},L=fo(),M=jp(uD),[O]=gr({i:OL,o:{w:0,h:0}},()=>{const W=M&&M.tt(e,t,A,L,n).ut,N=!(b&&v)&&GS(m,ga,dm),B=!v&&S(rce),U=B&&br(x),ie=U&&j(),ue=w(eD,N),be=B&&W&&W()[0],Te=Ym(y),je=HS(y);return be&&be(),Gi(x,U),ie&&ie(),N&&ue(),{w:Te.w+je.w,h:Te.h+je.h}}),F=xx(s,{_:()=>i,v:()=>o,S(W,J){const[N]=W,[B]=J;return[gf(wi(N),wi(B)).reduce((U,ie)=>(U[ie]=N[ie]||B[ie],U),{})]}}),_=W=>{const J=E(g);Pt(W,{Ct:d!==J}),Pt(A,{ct:J}),d=J},R=(W,J)=>{const[N,B]=W,U={xt:B};return Pt(A,{$t:N}),!J&&s(U),U},D=({ft:W,dt:J})=>{const B=!(W&&!J)&&L.R?F:s,U={ft:W||J,dt:J};_(U),B(U)},$=(W,J)=>{const[,N]=O(),B={Ht:N};return _(B),N&&!J&&(W?s:F)(B),B},G=(W,J,N)=>{const B={Et:J};return _(B),J&&!N&&F(B),B},[ee,Q]=C?Ece(m,R):[],se=!v&&hD(m,D,{dt:!0}),[ne,H]=P5(m,!1,G,{X:p,j:p}),V=v&&Wm&&new Wm(W=>{const J=W[W.length-1].contentRect;D({ft:!0,dt:ZL(J,c)}),c=J}),Y=xx(()=>{const[,W]=O();s({Ht:W})},{_:222,p:!0});return[()=>{V&&V.observe(m);const W=se&&se(),J=ee&&ee(),N=ne(),B=L.L(U=>{U?F({zt:U}):Y()});return()=>{V&&V.disconnect(),W&&W(),J&&J(),l&&l(),N(),B()}},({It:W,At:J,Dt:N})=>{const B={},[U]=W("update.ignoreMutation"),[ie,ue]=W("update.attributes"),[be,Te]=W("update.elementEvents"),[je,Be]=W("update.debounce"),Ze=Te||ue,De=J||N,q=re=>_r(U)&&U(re);if(Ze){a&&a(),l&&l();const[re,oe]=P5(C||y,!0,$,{j:gf(p,ie||[]),Y:be,W:h,G:(xe,ge)=>{const{target:de,attributeName:le}=xe;return(!ge&&le&&!v?qle(de,h,f):!1)||!!Nc(de,`.${Er}`)||!!q(xe)}});l=re(),a=oe}if(Be)if(F.m(),ro(je)){const re=je[0],oe=je[1];i=Ki(re)&&re,o=Ki(oe)&&oe}else Ki(je)?(i=je,o=!1):(i=!1,o=!1);if(De){const re=H(),oe=Q&&Q(),xe=a&&a();re&&Pt(B,G(re[0],re[1],De)),oe&&Pt(B,R(oe[0],De)),xe&&Pt(B,$(xe[0],De))}return _(B),B},A]},Dce=(e,t,n,s)=>{const i="--os-viewport-percent",o="--os-scroll-percent",a="--os-scroll-direction",{U:l}=fo(),{scrollbars:c}=l(),{slot:d}=c,{vt:h,ht:f,ot:p,Mt:g,gt:m,wt:y,nt:x}=t,{scrollbars:C}=g?{}:e,{slot:v}=C||{},b=[],S=[],w=[],j=iD([h,f,p],()=>x&&y?h:f,d,v),E=ne=>{if(lm){const H=new lm({source:m,axis:ne});return{kt:Y=>{const W=Y.Tt.animate({clear:["left"],[o]:[0,1]},{timeline:H});return()=>W.cancel()}}}},A={x:E("x"),y:E("y")},L=()=>{const{Rt:ne,Vt:H}=n,V=(Y,W)=>BL(0,1,Y/(Y+W)||0);return{x:V(H.x,ne.x),y:V(H.y,ne.y)}},M=(ne,H,V)=>{const Y=V?zS:GL;Ut(ne,W=>{Y(W.Tt,H)})},O=(ne,H)=>{Ut(ne,V=>{const[Y,W]=H(V);yf(Y,W)})},F=(ne,H,V)=>{const Y=OS(V),W=Y?V:!0,J=Y?!V:!0;W&&M(S,ne,H),J&&M(w,ne,H)},_=()=>{const ne=L(),H=V=>Y=>[Y.Tt,{[i]:jx(V)+""}];O(S,H(ne.x)),O(w,H(ne.y))},R=()=>{if(!lm){const{Lt:ne}=n,H=x5(ne,br(m)),V=Y=>W=>[W.Tt,{[o]:jx(Y)+""}];O(S,V(H.x)),O(w,V(H.y))}},D=()=>{const{Lt:ne}=n,H=b5(ne),V=Y=>W=>[W.Tt,{[a]:Y?"0":"1"}];O(S,V(H.x)),O(w,V(H.y))},$=()=>{if(x&&!y){const{Rt:ne,Lt:H}=n,V=b5(H),Y=x5(H,br(m)),W=J=>{const{Tt:N}=J,B=mf(N)===p&&N,U=(ie,ue,be)=>{const Te=ue*ie;return qL(be?Te:-Te)};return[B,B&&{transform:Kle({x:U(Y.x,ne.x,V.x),y:U(Y.y,ne.y,V.y)})}]};O(S,W),O(w,W)}},G=ne=>{const H=ne?"x":"y",Y=Jc(`${Er} ${ne?hce:fce}`),W=Jc(nD),J=Jc(US),N={Tt:Y,Ut:W,Pt:J},B=A[H];return vn(ne?S:w,N),vn(b,[vr(Y,W),vr(W,J),et(bu,Y),B&&B.kt(N),s(N,F,ne)]),N},ee=et(G,!0),Q=et(G,!1),se=()=>(vr(j,S[0].Tt),vr(j,w[0].Tt),et(Sr,b));return ee(),Q(),[{Nt:_,qt:R,Bt:D,Ft:$,jt:F,Xt:{Yt:S,Wt:ee,Jt:et(O,S)},Gt:{Yt:w,Wt:Q,Jt:et(O,w)}},se]},Rce=(e,t,n,s)=>(i,o,a)=>{const{ht:l,ot:c,nt:d,gt:h,Kt:f,Ot:p}=t,{Tt:g,Ut:m,Pt:y}=i,[x,C]=ll(333),[v,b]=ll(444),S=E=>{_r(h.scrollBy)&&h.scrollBy({behavior:"smooth",left:E.x,top:E.y})},w=()=>{const E="pointerup pointercancel lostpointercapture",A=`client${a?"X":"Y"}`,L=a?$1:V1,M=a?"left":"top",O=a?"w":"h",F=a?"x":"y",_=(D,$)=>G=>{const{Rt:ee}=n,Q=eu(m)[O]-eu(y)[O],ne=$*G/Q*ee[F];Gi(h,{[F]:D+ne})},R=[];return cn(m,"pointerdown",D=>{const $=Nc(D.target,`.${US}`)===y,G=$?y:m,ee=e.scrollbars,Q=ee[$?"dragScroll":"clickScroll"],{button:se,isPrimary:ne,pointerType:H}=D,{pointers:V}=ee;if(se===0&&ne&&Q&&(V||[]).includes(H)){Sr(R),b();const W=!$&&(D.shiftKey||Q==="instant"),J=et(xv,y),N=et(xv,m),B=(ge,de)=>(ge||J())[M]-(de||N())[M],U=mx(xv(h)[L])/eu(h)[O]||1,ie=_(br(h)[F],1/U),ue=D[A],be=J(),Te=N(),je=be[L],Be=B(be,Te)+je/2,Ze=ue-Te[M],De=$?0:Ze-Be,q=ge=>{Sr(xe),G.releasePointerCapture(ge.pointerId)},re=$||W,oe=p(),xe=[cn(f,E,q),cn(f,"selectstart",ge=>_x(ge),{H:!1}),cn(m,E,q),re&&cn(m,"pointermove",ge=>ie(De+(ge[A]-ue))),re&&(()=>{const ge=br(h);oe();const de=br(h),le={x:de.x-ge.x,y:de.y-ge.y};(zm(le.x)>3||zm(le.y)>3)&&(p(),Gi(h,ge),S(le),v(oe))})];if(G.setPointerCapture(D.pointerId),W)ie(De);else if(!$){const ge=jp(dD);if(ge){const de=ge(ie,De,je,le=>{le?oe():vn(xe,oe)});vn(xe,de),vn(R,et(de,!0))}}}})};let j=!0;return et(Sr,[cn(y,"pointermove pointerleave",s),cn(g,"pointerenter",()=>{o(I5,!0)}),cn(g,"pointerleave pointercancel",()=>{o(I5,!1)}),!d&&cn(g,"mousedown",()=>{const E=wx();(g5(E,So)||g5(E,ga)||E===document.body)&&Hm(et(Ix,c),25)}),cn(g,"wheel",E=>{const{deltaX:A,deltaY:L,deltaMode:M}=E;j&&M===0&&mf(g)===l&&S({x:A,y:L}),j=!1,o(M5,!0),x(()=>{j=!0,o(M5)}),_x(E)},{H:!1,I:!0}),cn(g,"pointerdown",et(cn,f,"click",XL,{A:!0,I:!0,H:!1}),{I:!0}),w(),C,b])},Oce=(e,t,n,s,i,o)=>{let a,l,c,d,h,f=pa,p=0;const g=ne=>ne.pointerType==="mouse",[m,y]=ll(),[x,C]=ll(100),[v,b]=ll(100),[S,w]=ll(()=>p),[j,E]=Dce(e,i,s,Rce(t,i,s,ne=>g(ne)&&G())),{ht:A,Qt:L,wt:M}=i,{jt:O,Nt:F,qt:_,Bt:R,Ft:D}=j,$=(ne,H)=>{if(w(),ne)O(T5);else{const V=et(O,T5,!0);p>0&&!H?S(V):V()}},G=()=>{(c?!a:!d)&&($(!0),x(()=>{$(!1)}))},ee=ne=>{O(Mx,ne,!0),O(Mx,ne,!1)},Q=ne=>{g(ne)&&(a=c,c&&$(!0))},se=[w,C,b,y,()=>f(),cn(A,"pointerover",Q,{A:!0}),cn(A,"pointerenter",Q),cn(A,"pointerleave",ne=>{g(ne)&&(a=!1,c&&$(!1))}),cn(A,"pointermove",ne=>{g(ne)&&l&&G()}),cn(L,"scroll",ne=>{m(()=>{_(),G()}),o(ne),D()})];return[()=>et(Sr,vn(se,E())),({It:ne,Dt:H,Zt:V,tn:Y})=>{const{nn:W,sn:J,en:N,cn:B}=Y||{},{Ct:U,dt:ie}=V||{},{ct:ue}=n,{k:be}=fo(),{K:Te,rn:je}=s,[Be,Ze]=ne("showNativeOverlaidScrollbars"),[De,q]=ne("scrollbars.theme"),[re,oe]=ne("scrollbars.visibility"),[xe,ge]=ne("scrollbars.autoHide"),[de,le]=ne("scrollbars.autoHideSuspend"),[Se]=ne("scrollbars.autoHideDelay"),[Ge,Ye]=ne("scrollbars.dragScroll"),[dt,fn]=ne("scrollbars.clickScroll"),[ln,pn]=ne("overflow"),Jn=ie&&!H,js=je.x||je.y,gn=W||J||B||U||H,Ti=N||oe||pn,Yo=Be&&be.x&&be.y,cs=(Ns,ii,ac)=>{const Jp=Ns.includes(vu)&&(re===ia||re==="auto"&&ii===vu);return O(pce,Jp,ac),Jp};if(p=Se,Jn&&(de&&js?(ee(!1),f(),v(()=>{f=cn(L,"scroll",et(ee,!0),{A:!0})})):ee(!0)),Ze&&O(uce,Yo),q&&(O(h),O(De,!0),h=De),le&&!de&&ee(!0),ge&&(l=xe==="move",c=xe==="leave",d=xe==="never",$(d,!0)),Ye&&O(yce,Ge),fn&&O(mce,!!dt),Ti){const Ns=cs(ln.x,Te.x,!0),ii=cs(ln.y,Te.y,!1);O(gce,!(Ns&&ii))}gn&&(_(),F(),D(),B&&R(),O(A5,!je.x,!0),O(A5,!je.y,!1),O(dce,ue&&!M))},{},j]},Nce=e=>{const t=fo(),{U:n,R:s}=t,{elements:i}=n(),{padding:o,viewport:a,content:l}=i,c=Km(e),d=c?{}:e,{elements:h}=d,{padding:f,viewport:p,content:g}=h||{},m=c?e:d.target,y=HL(m),x=m.ownerDocument,C=x.documentElement,v=()=>x.defaultView||Zs,b=et(Cce,[m]),S=et(iD,[m]),w=et(Jc,""),j=et(b,w,a),E=et(S,w,l),A=je=>{const Be=eu(je),Ze=Ym(je),De=Fo(je,DL),q=Fo(je,RL);return Ze.w-Be.w>0&&!xu(De)||Ze.h-Be.h>0&&!xu(q)},L=j(p),M=L===m,O=M&&y,F=!M&&E(g),_=!M&&L===F,R=O?C:L,D=O?R:m,$=!M&&S(w,o,f),G=!_&&F,ee=[G,R,$,D].map(je=>Km(je)&&!mf(je)&&je),Q=je=>je&&_L(ee,je),se=!Q(R)&&A(R)?R:m,ne=O?C:R,V={vt:m,ht:D,ot:R,ln:$,bt:G,gt:ne,Qt:O?x:R,an:y?C:se,Kt:x,wt:y,Mt:c,nt:M,un:v,yt:je=>GS(R,So,je),St:(je,Be)=>Zm(R,So,je,Be),Ot:()=>Zm(ne,So,ice,!0)},{vt:Y,ht:W,ln:J,ot:N,bt:B}=V,U=[()=>{Pi(W,[ga,Cv]),Pi(Y,Cv),y&&Pi(C,[Cv,ga])}];let ie=Sx([B,N,J,W,Y].find(je=>je&&!Q(je)));const ue=O?Y:B||N,be=et(Sr,U);return[V,()=>{const je=v(),Be=wx(),Ze=xe=>{vr(mf(xe),Sx(xe)),bu(xe)},De=xe=>cn(xe,"focusin focusout focus blur",XL,{I:!0,H:!1}),q="tabindex",re=$S(N,q),oe=De(Be);return Co(W,ga,M?"":tce),Co(J,Tx,""),Co(N,So,""),Co(B,_5,""),M||(Co(N,q,re||"-1"),y&&Co(C,k5,"")),vr(ue,ie),vr(W,J),vr(J||W,!M&&N),vr(N,B),vn(U,[oe,()=>{const xe=wx(),ge=Q(N),de=ge&&xe===N?Y:xe,le=De(de);Pi(J,Tx),Pi(B,_5),Pi(N,So),y&&Pi(C,k5),re?Co(N,q,re):Pi(N,q),Q(B)&&Ze(B),ge&&Ze(N),Q(J)&&Ze(J),Ix(de),le()}]),s&&!M&&(VS(N,So,tD),vn(U,et(Pi,N,So))),Ix(!M&&y&&Be===Y&&je.top===je?N:Be),oe(),ie=0,be},be]},Fce=({bt:e})=>({Zt:t,_n:n,Dt:s})=>{const{xt:i}=t||{},{$t:o}=n;e&&(i||s)&&yf(e,{[V1]:o&&"100%"})},Bce=({ht:e,ln:t,ot:n,nt:s},i)=>{const[o,a]=gr({i:Wle,o:y5()},et(y5,e,"padding",""));return({It:l,Zt:c,_n:d,Dt:h})=>{let[f,p]=a(h);const{R:g}=fo(),{ft:m,Ht:y,Ct:x}=c||{},{ct:C}=d,[v,b]=l("paddingAbsolute");(m||p||(h||y))&&([f,p]=o(h));const w=!s&&(b||x||p);if(w){const j=!v||!t&&!g,E=f.r+f.l,A=f.t+f.b,L={[EL]:j&&!C?-E:0,[LL]:j?-A:0,[PL]:j&&C?-E:0,top:j?-f.t:0,right:j?C?-f.r:"auto":0,left:j?C?"auto":-f.l:0,[$1]:j&&`calc(100% + ${E}px)`},M={[IL]:j?f.t:0,[AL]:j?f.r:0,[ML]:j?f.b:0,[TL]:j?f.l:0};yf(t||n,L),yf(n,M),Pt(i,{ln:f,dn:!j,rt:t?M:Pt({},L,M)})}return{fn:w}}},$ce=(e,t)=>{const n=fo(),{ht:s,ln:i,ot:o,nt:a,Qt:l,gt:c,wt:d,St:h,un:f}=e,{R:p}=n,g=d&&a,m=et(Gm,0),y={display:()=>!1,direction:H=>H!=="ltr",flexDirection:H=>H.endsWith("-reverse"),writingMode:H=>H!=="horizontal-tb"},x=wi(y),C={i:OL,o:{w:0,h:0}},v={i:cm,o:{}},b=H=>{h(eD,!g&&H)},S=H=>{if(!x.some(ue=>{const be=H[ue];return be&&y[ue](be)}))return{D:{x:0,y:0},M:{x:1,y:1}};b(!0);const Y=br(c),W=h(oce,!0),J=cn(l,vu,ue=>{const be=br(c);ue.isTrusted&&be.x===Y.x&&be.y===Y.y&&YL(ue)},{I:!0,A:!0});Gi(c,{x:0,y:0}),W();const N=br(c),B=Ym(c);Gi(c,{x:B.w,y:B.h});const U=br(c);Gi(c,{x:U.x-N.x<1&&-B.w,y:U.y-N.y<1&&-B.h});const ie=br(c);return Gi(c,Y),O1(()=>J()),{D:N,M:ie}},w=(H,V)=>{const Y=Zs.devicePixelRatio%1!==0?1:0,W={w:m(H.w-V.w),h:m(H.h-V.h)};return{w:W.w>Y?W.w:0,h:W.h>Y?W.h:0}},[j,E]=gr(C,et(HS,o)),[A,L]=gr(C,et(Ym,o)),[M,O]=gr(C),[F]=gr(v),[_,R]=gr(C),[D]=gr(v),[$]=gr({i:(H,V)=>G1(H,V,x),o:{}},()=>Qle(o)?Fo(o,x):{}),[G,ee]=gr({i:(H,V)=>cm(H.D,V.D)&&cm(H.M,V.M),o:QL()}),Q=jp(uD),se=(H,V)=>`${V?nce:sce}${Hle(H)}`,ne=H=>{const V=W=>[ia,al,vu].map(J=>se(J,W)),Y=V(!0).concat(V()).join(" ");h(Y),h(wi(H).map(W=>se(H[W],W==="x")).join(" "),!0)};return({It:H,Zt:V,_n:Y,Dt:W},{fn:J})=>{const{ft:N,Ht:B,Ct:U,dt:ie,zt:ue}=V||{},be=Q&&Q.tt(e,t,Y,n,H),{it:Te,ut:je,_t:Be}=be||{},[Ze,De]=Tce(H,n),[q,re]=H("overflow"),oe=xu(q.x),xe=xu(q.y);let ge=E(W),de=L(W),le=O(W),Se=R(W);De&&p&&h(tD,!Ze);{GS(s,ga,dm)&&b(!0);const[Ik]=je?je():[],[eg]=ge=j(W),[tg]=de=A(W),ng=KL(o),sg=g&&Xle(f()),RW={w:m(tg.w+eg.w),h:m(tg.h+eg.h)},Ak={w:m((sg?sg.w:ng.w+m(ng.w-tg.w))+eg.w),h:m((sg?sg.h:ng.h+m(ng.h-tg.h))+eg.h)};Ik&&Ik(),Se=_(Ak),le=M(w(RW,Ak),W)}const[Ge,Ye]=Se,[dt,fn]=le,[ln,pn]=de,[Jn,js]=ge,[gn,Ti]=F({x:dt.w>0,y:dt.h>0}),Yo=oe&&xe&&(gn.x||gn.y)||oe&&gn.x&&!gn.y||xe&&gn.y&&!gn.x,cs=Mce(gn,q),[Ns,ii]=D(cs.K),[ac,Jp]=$(W),_k=U||ie||Jp||Ti||W,[LW,DW]=_k?G(S(ac),W):ee();return ii&&ne(cs.K),Be&&Te&&yf(o,Be(cs,Y,Te(cs,ln,Jn))),b(!1),Zm(s,ga,dm,Yo),Zm(i,Tx,dm,Yo),Pt(t,{K:Ns,Vt:{x:Ge.w,y:Ge.h},Rt:{x:dt.w,y:dt.h},rn:gn,Lt:Jle(LW,dt)}),{en:ii,nn:Ye,sn:fn,cn:DW||fn,vn:_k}}},Vce=e=>{const[t,n,s]=Nce(e),i={ln:{t:0,r:0,b:0,l:0},dn:!1,rt:{[EL]:0,[LL]:0,[PL]:0,[IL]:0,[AL]:0,[ML]:0,[TL]:0},Vt:{x:0,y:0},Rt:{x:0,y:0},K:{x:al,y:al},rn:{x:!1,y:!1},Lt:QL()},{vt:o,gt:a,nt:l,Ot:c}=t,{R:d,k:h}=fo(),f=!d&&(h.x||h.y),p=[Fce(t),Bce(t,i),$ce(t,i)];return[n,g=>{const m={},x=f&&br(a),C=x&&c();return Ut(p,v=>{Pt(m,v(g,m)||{})}),Gi(a,x),C&&C(),!l&&Gi(o,0),m},i,t,s]},Gce=(e,t,n,s,i)=>{let o=!1;const a=j5(t,{}),[l,c,d,h,f]=Vce(e),[p,g,m]=Lce(h,d,a,S=>{b({},S)}),[y,x,,C]=Oce(e,t,m,d,h,i),v=S=>wi(S).some(w=>!!S[w]),b=(S,w)=>{if(n())return!1;const{pn:j,Dt:E,At:A,hn:L}=S,M=j||{},O=!!E||!o,F={It:j5(t,M,O),pn:M,Dt:O};if(L)return x(F),!1;const _=w||g(Pt({},F,{At:A})),R=c(Pt({},F,{_n:m,Zt:_}));x(Pt({},F,{Zt:_,tn:R}));const D=v(_),$=v(R),G=D||$||!BS(M)||O;return o=!0,G&&s(S,{Zt:_,tn:R}),G};return[()=>{const{an:S,gt:w,Ot:j}=h,E=br(S),A=[p(),l(),y()],L=j();return Gi(w,E),L(),et(Sr,A)},b,()=>({gn:m,bn:d}),{wn:h,yn:C},f]},vi=(e,t,n)=>{const{N:s}=fo(),i=Km(e),o=i?e:e.target,a=oD(o);if(t&&!a){let l=!1;const c=[],d={},h=M=>{const O=FL(M),F=jp(Ice);return F?F(O,!0):O},f=Pt({},s(),h(t)),[p,g,m]=Ax(),[y,x,C]=Ax(n),v=(M,O)=>{C(M,O),m(M,O)},[b,S,w,j,E]=Gce(e,f,()=>l,({pn:M,Dt:O},{Zt:F,tn:_})=>{const{ft:R,Ct:D,xt:$,Ht:G,Et:ee,dt:Q}=F,{nn:se,sn:ne,en:H,cn:V}=_;v("updated",[L,{updateHints:{sizeChanged:!!R,directionChanged:!!D,heightIntrinsicChanged:!!$,overflowEdgeChanged:!!se,overflowAmountChanged:!!ne,overflowStyleChanged:!!H,scrollCoordinatesChanged:!!V,contentMutation:!!G,hostMutation:!!ee,appear:!!Q},changedOptions:M||{},force:!!O}])},M=>v("scroll",[L,M])),A=M=>{jce(o),Sr(c),l=!0,v("destroyed",[L,M]),g(),x()},L={options(M,O){if(M){const F=O?s():{},_=JL(f,Pt(F,h(M)));BS(_)||(Pt(f,_),S({pn:_}))}return Pt({},f)},on:y,off:(M,O)=>{M&&O&&x(M,O)},state(){const{gn:M,bn:O}=w(),{ct:F}=M,{Vt:_,Rt:R,K:D,rn:$,ln:G,dn:ee,Lt:Q}=O;return Pt({},{overflowEdge:_,overflowAmount:R,overflowStyle:D,hasOverflow:$,scrollCoordinates:{start:Q.D,end:Q.M},padding:G,paddingAbsolute:ee,directionRTL:F,destroyed:l})},elements(){const{vt:M,ht:O,ln:F,ot:_,bt:R,gt:D,Qt:$}=j.wn,{Xt:G,Gt:ee}=j.yn,Q=ne=>{const{Pt:H,Ut:V,Tt:Y}=ne;return{scrollbar:Y,track:V,handle:H}},se=ne=>{const{Yt:H,Wt:V}=ne,Y=Q(H[0]);return Pt({},Y,{clone:()=>{const W=Q(V());return S({hn:!0}),W}})};return Pt({},{target:M,host:O,padding:F||_,viewport:_,content:R||_,scrollOffsetElement:D,scrollEventElement:$,scrollbarHorizontal:se(G),scrollbarVertical:se(ee)})},update:M=>S({Dt:M,At:!0}),destroy:et(A,!1),plugin:M=>d[wi(M)[0]]};return vn(c,[E]),wce(o,L),cD(aD,vi,[L,p,d]),Sce(j.wn.wt,!i&&e.cancel)?(A(!0),L):(vn(c,b()),v("initialized",[L]),L.update(),L)}return a};vi.plugin=e=>{const t=ro(e),n=t?e:[e],s=n.map(i=>cD(i,vi)[0]);return _ce(n),t?s:s[0]};vi.valid=e=>{const t=e&&e.elements,n=_r(t)&&t();return qm(n)&&!!oD(n.target)};vi.env=()=>{const{T:e,k:t,R:n,V:s,B:i,F:o,U:a,P:l,N:c,q:d}=fo();return Pt({},{scrollbarsSize:e,scrollbarsOverlaid:t,scrollbarsHiding:n,scrollTimeline:s,staticDefaultInitialization:i,staticDefaultOptions:o,getDefaultInitialization:a,setDefaultInitialization:l,getDefaultOptions:c,setDefaultOptions:d})};vi.nonce=bce;vi.plugin(Pce);const Il={defer:!0,options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark",clickScroll:!0},overflow:{x:"hidden"}}},zo=(e="hidden",t="scroll")=>{const n=ft(Il);return qT(n,{options:{overflow:{y:t,x:e}}}),n},Yl={height:"100%",width:"100%"},zce=()=>{if(typeof window>"u"){const d=()=>{};return[d,d]}let e,t;const n=window,s=typeof n.requestIdleCallback=="function",i=n.requestAnimationFrame,o=n.cancelAnimationFrame,a=s?n.requestIdleCallback:i,l=s?n.cancelIdleCallback:o,c=()=>{l(e),o(t)};return[(d,h)=>{c(),e=a(s?()=>{c(),t=i(d)}:d,typeof h=="object"?h:{timeout:2233})},c]},fD=e=>{const{options:t,events:n,defer:s}=e||{},[i,o]=u.useMemo(zce,[]),a=u.useRef(null),l=u.useRef(s),c=u.useRef(t),d=u.useRef(n);return u.useEffect(()=>{l.current=s},[s]),u.useEffect(()=>{const{current:h}=a;c.current=t,vi.valid(h)&&h.options(t||{},!0)},[t]),u.useEffect(()=>{const{current:h}=a;d.current=n,vi.valid(h)&&h.on(n||{},!0)},[n]),u.useEffect(()=>()=>{var h;o(),(h=a.current)==null||h.destroy()},[]),u.useMemo(()=>[h=>{const f=a.current;if(vi.valid(f))return;const p=l.current,g=c.current||{},m=d.current||{},y=()=>a.current=vi(h,g,m);p?i(y,p):y()},()=>a.current],[])},Hce=(e,t)=>{const{element:n="div",options:s,events:i,defer:o,children:a,...l}=e,c=n,d=u.useRef(null),h=u.useRef(null),[f,p]=fD({options:s,events:i,defer:o});return u.useEffect(()=>{const{current:g}=d,{current:m}=h;if(!g)return;const y=g;return f(n==="body"?{target:y,cancel:{body:null}}:{target:y,elements:{viewport:m,content:m}}),()=>{var x;return(x=p())==null?void 0:x.destroy()}},[f,n]),u.useImperativeHandle(t,()=>({osInstance:p,getElement:()=>d.current}),[]),me.createElement(c,{"data-overlayscrollbars-initialize":"",ref:d,...l},n==="body"?a:me.createElement("div",{"data-overlayscrollbars-contents":"",ref:h},a))},tr=u.forwardRef(Hce),Wce={position:"absolute",top:0,left:0,right:0,bottom:0},Uce=({children:e,maxHeight:t,overflowX:n="hidden",overflowY:s="scroll"})=>{const i=u.useMemo(()=>zo(n,s).options,[n,s]),[o,a]=u.useState(null);return u.useEffect(()=>{const l=o==null?void 0:o.osInstance();if(!l)return;const c=l.elements().viewport,d=c.style.overflowY;c.style.setProperty("overflow-y","scroll","important");const h=Kn(jL({element:c}),kL({element:c}));return c.style.setProperty("overflow-y",d),h},[o]),r.jsx(T,{w:"full",h:"full",maxHeight:t,position:"relative",children:r.jsx(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,children:r.jsx(tr,{ref:a,style:Wce,options:i,children:e})})})},Nn=u.memo(Uce),qce={"&::marker":{color:"base.500"}},Kce=()=>{const{t:e}=P(),t=I(KU),n=I(YT),s=I(q0),i=I(ZU),o=u.useMemo(()=>{let a=`${e("dynamicPrompts.promptsPreview")} (${i.length})`;return t&&(a+=` - ${t}`),a},[t,i.length,e]);return n?r.jsx(T,{w:"full",h:"full",layerStyle:"second",alignItems:"center",justifyContent:"center",p:8,children:r.jsx(Yt,{icon:BE,label:"Problem generating prompts"})}):r.jsxs(Z,{orientation:"vertical",w:"full",h:"full",isInvalid:!!(t||n),children:[r.jsx(Ve,{feature:"dynamicPrompts",inPortal:!1,children:r.jsx(te,{children:o})}),r.jsxs(T,{w:"full",h:"full",pos:"relative",layerStyle:"first",p:4,borderRadius:"base",children:[r.jsx(Nn,{children:r.jsx(YU,{stylePosition:"inside",ms:0,children:i.map((a,l)=>r.jsx(Gt,{fontSize:"sm",sx:qce,children:r.jsx(K,{as:"span",children:a})},`${a}.${l}`))})}),s&&r.jsx(T,{pos:"absolute",w:"full",h:"full",top:0,insetInlineStart:0,layerStyle:"second",opacity:.7,alignItems:"center",justifyContent:"center",children:r.jsx(or,{})})]})]})},Zce=u.memo(Kce),Yce=()=>{const e=z(),{t}=P(),n=I(XU),s=u.useMemo(()=>[{value:"PER_ITERATION",label:t("dynamicPrompts.seedBehaviour.perIterationLabel"),description:t("dynamicPrompts.seedBehaviour.perIterationDesc")},{value:"PER_PROMPT",label:t("dynamicPrompts.seedBehaviour.perPromptLabel"),description:t("dynamicPrompts.seedBehaviour.perPromptDesc")}],[t]),i=u.useCallback(a=>{QU(a==null?void 0:a.value)&&e(JU(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===n),[s,n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"dynamicPromptsSeedBehaviour",inPortal:!1,children:r.jsx(te,{children:t("dynamicPrompts.seedBehaviour.label")})}),r.jsx(Fe,{value:o,options:s,onChange:i})]})},Xce=u.memo(Yce),pD=u.memo(()=>{wt("DynamicPromptsModal");const{t:e}=P(),{isOpen:t,onClose:n}=gL();return r.jsxs(ni,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[r.jsx(rr,{}),r.jsxs(si,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[r.jsx(Tr,{children:e("dynamicPrompts.dynamicPrompts")}),r.jsx(lo,{}),r.jsxs(ir,{as:T,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[r.jsxs(T,{gap:4,children:[r.jsx(Xce,{}),r.jsx(ile,{})]}),r.jsx(Zce,{})]})]})]})});pD.displayName="DynamicPromptsModal";const Lh=Oe(null),Qce=()=>{wt("DeleteBoardModal");const e=ce(Lh),{t}=P(),{currentData:n,isFetching:s}=eq((e==null?void 0:e.board_id)??ws),i=u.useMemo(()=>It([ot,Je,U0],(y,x,C)=>{const v=(n??[]).map(S=>WT(y,x,C,S));return{isUpscaleImage:fs(v,S=>S.isUpscaleImage),isRasterLayerImage:fs(v,S=>S.isRasterLayerImage),isInpaintMaskImage:fs(v,S=>S.isInpaintMaskImage),isRegionalGuidanceImage:fs(v,S=>S.isRegionalGuidanceImage),isNodesImage:fs(v,S=>S.isNodesImage),isControlLayerImage:fs(v,S=>S.isControlLayerImage),isReferenceImage:fs(v,S=>S.isReferenceImage)}}),[n]),[o,{isLoading:a}]=tq(),[l,{isLoading:c}]=nq(),d=I(i),h=u.useCallback(()=>{e&&(o(e.board_id),Lh.set(null))},[e,o]),f=u.useCallback(()=>{e&&(l(e.board_id),Lh.set(null))},[e,l]),p=u.useCallback(()=>{Lh.set(null)},[]),g=u.useRef(null),m=u.useMemo(()=>c||a||s,[c,a,s]);return e?r.jsx(XT,{isOpen:!!e,onClose:p,leastDestructiveRef:g,isCentered:!0,children:r.jsx(rr,{children:r.jsxs(QT,{children:[r.jsxs(Tr,{fontSize:"lg",fontWeight:"bold",children:[t("common.delete")," ",e.board_name]}),r.jsx(ir,{children:r.jsxs(T,{direction:"column",gap:3,children:[s?r.jsx(pC,{children:r.jsx(T,{w:"full",h:32})}):r.jsx(tL,{imageUsage:d,topMessage:t("boards.topMessage"),bottomMessage:t("boards.bottomMessage")}),r.jsx(K,{children:e.is_private?t("boards.deletedPrivateBoardsCannotbeRestored"):t("boards.deletedBoardsCannotbeRestored")}),r.jsx(K,{children:t("gallery.deleteImagePermanent")})]})}),r.jsx(co,{children:r.jsxs(T,{w:"full",gap:2,justifyContent:"end",children:[r.jsx(ye,{ref:g,onClick:p,children:t("boards.cancel")}),r.jsx(ye,{colorScheme:"warning",isLoading:m,onClick:h,children:t("boards.deleteBoardOnly")}),r.jsx(ye,{colorScheme:"error",isLoading:m,onClick:f,children:t("boards.deleteBoardAndImages")})]})})]})})}):null},Jce=u.memo(Qce),eue=()=>{const{t:e}=P(),t=z(),n=I(y=>y.gallery.selection),s=ce(gC),i=un("bulkDownload"),[o]=mC(),[a]=yC(),[l]=vC(),c=u.useCallback(()=>{t(JT(n)),t(iC(!0))},[t,n]),d=u.useCallback(()=>{t($f(n))},[t,n]),h=u.useCallback(()=>{o({imageDTOs:n})},[o,n]),f=u.useCallback(()=>{a({imageDTOs:n})},[a,n]),p=u.useCallback(()=>{l({image_names:n.map(y=>y.image_name)})},[n,l]),g=u.useMemo(()=>n.every(y=>y.starred),[n]),m=u.useMemo(()=>n.every(y=>!y.starred),[n]);return r.jsxs(r.Fragment,{children:[g&&r.jsx(he,{icon:s?s.on.icon:r.jsx(CS,{}),onClickCapture:f,children:s?s.off.text:"Unstar All"}),(m||!g&&!m)&&r.jsx(he,{icon:s?s.on.icon:r.jsx(jS,{}),onClickCapture:h,children:s?s.on.text:"Star All"}),i&&r.jsx(he,{icon:r.jsx(Vu,{}),onClickCapture:p,children:e("gallery.downloadSelection")}),r.jsx(he,{icon:r.jsx(_E,{}),onClickCapture:c,children:e("boards.changeBoard")}),r.jsx(is,{}),r.jsx(he,{color:"error.300",icon:r.jsx(Xr,{}),onClickCapture:d,children:e("gallery.deleteSelection")})]})},tue=u.memo(eue),Wr=({tooltip:e,icon:t,...n})=>r.jsx(Le,{label:e,placement:"top",gutter:12,children:r.jsx(he,{display:"flex",alignItems:"center",justifyContent:"center",w:"min-content",aspectRatio:"1",borderRadius:"base",...n,children:t})}),qu=({children:e})=>r.jsx(T,{gap:2,justifyContent:"space-between",children:e}),gD=u.createContext(null),nue=gD.Provider,Lr=()=>{const e=u.useContext(gD);return Re(e!==null,"useImageDTOContext must be used within ImageDTOContextProvider"),e},mD=u.memo(()=>{const{t:e}=P(),t=z(),n=Lr(),s=u.useCallback(()=>{t(JT([n])),t(iC(!0))},[t,n]);return r.jsx(he,{icon:r.jsx(_E,{}),onClickCapture:s,children:e("boards.changeBoard")})});mD.displayName="ImageMenuItemChangeBoard";const sue="https://invoke-ai.github.io/InvokeAI/faq/#unable-to-copy-on-firefox",Ho=()=>{const{t:e}=P(),t=u.useCallback(()=>{fe({id:"CLIPBOARD_UNAVAILABLE",title:e("toast.unableToCopy"),description:r.jsx(r.Fragment,{children:r.jsxs(K,{fontSize:"md",children:[e("toast.unableToCopyDesc"),r.jsx(Xs,{display:"inline",fontWeight:"semibold",href:sue,label:e("toast.unableToCopyDesc_theseSteps")}),"."]})}),status:"error"})},[e]),n=u.useMemo(()=>!(!navigator.clipboard||!window.ClipboardItem),[]),s=u.useCallback((a,l)=>{if(!n){t();return}navigator.clipboard.writeText(a),l==null||l()},[t,n]),i=u.useCallback((a,l)=>{if(!n){t();return}navigator.clipboard.write(a),l==null||l()},[t,n]),o=u.useCallback((a,l)=>{if(!n){t();return}const c=[new ClipboardItem({"image/png":a})];navigator.clipboard.write(c),l==null||l()},[t,n]);return{isAvailable:n,writeText:s,write:i,writeImage:o}},yD=e=>new Promise((t,n)=>{const s=new Image;s.onload=()=>{const i=document.createElement("canvas");i.width=s.width,i.height=s.height;const o=i.getContext("2d");if(!o){n(new Error("Failed to get canvas context"));return}o.drawImage(s,0,0),i.toBlob(a=>{a?t(a):n(new Error("Failed to convert image to blob"))},"image/png")},s.onerror=()=>{n(new Error("Image failed to load. The URL may be invalid or the object may not exist."))},s.crossOrigin=qf.get()?"use-credentials":"anonymous",s.src=e}),rue=()=>{const{t:e}=P(),t=Ho();return u.useCallback(async s=>{try{const i=await yD(s);if(!i)throw new Error("Unable to create Blob");t.writeImage(i,()=>{fe({id:"IMAGE_COPIED",title:e("toast.imageCopied"),status:"success"})})}catch(i){fe({id:"PROBLEM_COPYING_IMAGE",title:e("toast.problemCopyingImage"),description:String(i),status:"error"})}},[t,e])},vD=u.memo(()=>{const{t:e}=P(),t=Lr(),n=rue(),s=u.useCallback(()=>{n(t.image_url)},[n,t.image_url]);return r.jsx(Wr,{icon:r.jsx(on,{}),"aria-label":e("parameters.copyImage"),tooltip:e("parameters.copyImage"),onClickCapture:s})});vD.displayName="ImageMenuItemCopy";const bD=u.memo(()=>{const{t:e}=P(),t=z(),n=Lr(),s=u.useCallback(()=>{t($f([n]))},[t,n]);return r.jsx(Wr,{icon:r.jsx(Xr,{}),onClickCapture:s,"aria-label":e("gallery.deleteImage",{count:1}),tooltip:e("gallery.deleteImage",{count:1}),isDestructive:!0})});bD.displayName="ImageMenuItemDelete";const iue=()=>{const{t:e}=P(),t=z(),n=ce(qf);return{downloadImage:u.useCallback(async(i,o)=>{try{const a=n?{headers:{Authorization:`Bearer ${n}`}}:{},l=await fetch(i,a).then(h=>h.blob());if(!l)throw new Error("Unable to create Blob");const c=window.URL.createObjectURL(l),d=document.createElement("a");d.style.display="none",d.href=c,d.download=o,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(c),t(Bre())}catch(a){fe({id:"PROBLEM_DOWNLOADING_IMAGE",title:e("toast.problemDownloadingImage"),description:String(a),status:"error"})}},[e,t,n])}},xD=u.memo(()=>{const{t:e}=P(),t=Lr(),{downloadImage:n}=iue(),s=u.useCallback(()=>{n(t.image_url,t.image_name)},[n,t.image_name,t.image_url]);return r.jsx(Wr,{icon:r.jsx(Vu,{}),"aria-label":e("parameters.downloadImage"),tooltip:e("parameters.downloadImage"),onClick:s})});xD.displayName="ImageMenuItemDownload";const oue=()=>r.jsx(T,{w:"14px",alignItems:"center",justifyContent:"center",children:r.jsx(or,{size:"xs"})}),CD=u.memo(()=>{const{t:e}=P(),t=Lr(),[n,{isLoading:s}]=NP(),i=ce($0),o=u.useCallback(()=>{n(t.image_name)},[n,t.image_name]);return r.jsx(he,{icon:s?r.jsx(oue,{}):r.jsx(T1,{}),onClickCapture:o,isDisabled:!t.has_workflow||!i,children:e("nodes.loadWorkflow")})});CD.displayName="ImageMenuItemLoadWorkflow";const aue=[0,8],Qs=()=>{const e=sq(!1),t=u.useRef(null),n=FP(e.close,300),s=u.useCallback(()=>{n.cancel(),e.open()},[n,e]),i=u.useCallback(()=>{if(e.isOpen){e.close();return}else n.cancel(),e.toggle()},[n,e]),o=u.useCallback(l=>{if(l.currentTarget.contains(l.relatedTarget)){n.cancel();return}e.close()},[n,e]),a=u.useCallback(l=>{l.pointerType==="pen"||l.pointerType==="touch"||e.close()},[e]);return u.useEffect(()=>{if(!t.current)return;const c=new AbortController;return window.addEventListener("click",d=>{var h;(h=t.current)!=null&&h.contains(d.target)||e.close()},{signal:c.signal}),()=>{c.abort()}},[e]),{parentMenuItemProps:{onClick:i,onPointerEnter:s,onPointerLeave:a,closeOnSelect:!1},menuProps:{isOpen:e.isOpen,onClose:e.close,placement:"right",offset:aue,closeOnBlur:!1},menuButtonProps:{as:ke,width:"full",height:"full"},menuListProps:{ref:t,onPointerEnter:s,onPointerLeave:n,onBlur:o}}},Js=({label:e})=>r.jsxs(T,{w:"full",h:"full",flexDir:"row",justifyContent:"space-between",alignItems:"center",children:[r.jsx(K,{children:e}),r.jsx(pt,{as:A1})]}),SD=u.memo(()=>{const{t:e}=P(),t=Lr(),n=Qs(),{recallAll:s,remix:i,recallSeed:o,recallPrompts:a,hasMetadata:l,hasSeed:c,hasPrompts:d,createAsPreset:h}=rS(t);return r.jsx(he,{...n.parentMenuItemProps,icon:r.jsx(vE,{}),children:r.jsxs(Qt,{...n.menuProps,children:[r.jsx(Jt,{...n.menuButtonProps,children:r.jsx(Js,{label:e("parameters.recallMetadata")})}),r.jsxs(kt,{...n.menuListProps,children:[r.jsx(he,{icon:r.jsx(Bm,{}),onClick:i,isDisabled:!l,children:e("parameters.remixImage")}),r.jsx(he,{icon:r.jsx(RE,{}),onClick:a,isDisabled:!d,children:e("parameters.usePrompt")}),r.jsx(he,{icon:r.jsx(LE,{}),onClick:o,isDisabled:!c,children:e("parameters.useSeed")}),r.jsx(he,{icon:r.jsx(xE,{}),onClick:s,isDisabled:!l,children:e("parameters.useAll")}),r.jsx(he,{icon:r.jsx(xS,{}),onClick:h,isDisabled:!d,children:e("stylePresets.useForTemplate")})]})]})})});SD.displayName="ImageMenuItemMetadataRecallActions";const tt=()=>{const e=Tt();return ce(e.$isBusy)},wD=u.memo(()=>{const{t:e}=P(),t=Qs(),n=sr(),s=Lr(),i=Lt(),o=tt(),a=I($l),l=u.useCallback(()=>{const{dispatch:f,getState:p}=n;ug({imageDTO:s,withResize:!1,type:"raster_layer",dispatch:f,getState:p}),f(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),c=u.useCallback(()=>{const{dispatch:f,getState:p}=n;ug({imageDTO:s,withResize:!1,type:"control_layer",dispatch:f,getState:p}),f(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),d=u.useCallback(()=>{const{dispatch:f,getState:p}=n;ug({imageDTO:s,withResize:!0,type:"raster_layer",dispatch:f,getState:p}),f(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),h=u.useCallback(()=>{const{dispatch:f,getState:p}=n;ug({imageDTO:s,withResize:!0,type:"control_layer",dispatch:f,getState:p}),f(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Ht,{}),children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.newCanvasFromImage")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(he,{icon:r.jsx(dg,{}),onClickCapture:l,isDisabled:o,children:e("controlLayers.asRasterLayer")}),r.jsx(he,{icon:r.jsx(dg,{}),onClickCapture:d,isDisabled:o,children:e("controlLayers.asRasterLayerResize")}),r.jsx(he,{icon:r.jsx(dg,{}),onClickCapture:c,isDisabled:o||a,children:e("controlLayers.asControlLayer")}),r.jsx(he,{icon:r.jsx(dg,{}),onClickCapture:h,isDisabled:o||a,children:e("controlLayers.asControlLayerResize")})]})]})})});wD.displayName="ImageMenuItemNewCanvasFromImageSubMenu";const lue=$o(Xoe),ps=()=>r.jsx(lue,{transform:"rotate(90deg)"}),jD=u.memo(()=>{const{t:e}=P(),t=Qs(),n=sr(),s=Lr(),i=Lt(),o=tt(),a=I(xi),l=I($l),c=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Vr({imageDTO:s,type:"raster_layer",dispatch:m,getState:y}),m(Qa()),m(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),d=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Vr({imageDTO:s,type:"control_layer",dispatch:m,getState:y}),m(Qa()),m(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),h=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Vr({imageDTO:s,type:"inpaint_mask",dispatch:m,getState:y}),m(Qa()),m(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),f=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Vr({imageDTO:s,type:"regional_guidance",dispatch:m,getState:y}),m(Qa()),m(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),p=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Vr({imageDTO:s,type:"reference_image",dispatch:m,getState:y}),m(Qa()),m(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]),g=u.useCallback(()=>{const{dispatch:m,getState:y}=n;Vr({imageDTO:s,type:"regional_guidance_with_reference_image",dispatch:m,getState:y}),m(Qa()),m(bt("canvas")),i.close(),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[s,i,n,e]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Ht,{}),children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.newLayerFromImage")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:h,isDisabled:o,children:e("controlLayers.inpaintMask")}),r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:f,isDisabled:o||a||l,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:d,isDisabled:o||l,children:e("controlLayers.controlLayer")}),r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:c,isDisabled:o,children:e("controlLayers.rasterLayer")}),r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:g,isDisabled:o,children:e("controlLayers.referenceImageRegional")}),r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:p,isDisabled:o,children:e("controlLayers.referenceImageGlobal")})]})]})})});jD.displayName="ImageMenuItemNewLayerFromImageSubMenu";const kD=u.memo(()=>{const{t:e}=P(),t=Lr(),n=u.useCallback(()=>{window.open(t.image_url,"_blank")},[t.image_url]);return r.jsx(Wr,{onClickCapture:n,"aria-label":e("common.openInNewTab"),tooltip:e("common.openInNewTab"),icon:r.jsx(_1,{})})});kD.displayName="ImageMenuItemOpenInNewTab";const _D=u.memo(()=>{const{t:e}=P(),t=Lr(),n=Lt(),s=u.useCallback(()=>{n.openImageInViewer(t)},[t,n]);return r.jsx(Wr,{icon:r.jsx(I1,{}),onClickCapture:s,"aria-label":e("common.openInViewer"),tooltip:e("common.openInViewer")})});_D.displayName="ImageMenuItemOpenInViewer";const ID=u.memo(()=>{const{t:e}=P(),t=z(),n=Lr(),s=u.useMemo(()=>ve(kr,a=>{var l;return((l=a.imageToCompare)==null?void 0:l.image_name)!==n.image_name}),[n.image_name]),i=I(s),o=u.useCallback(()=>{t(Pu(n))},[t,n]);return r.jsx(Wr,{icon:r.jsx(AE,{}),isDisabled:!i,onClick:o,"aria-label":e("gallery.selectForCompare"),tooltip:e("gallery.selectForCompare")})});ID.displayName="ImageMenuItemSelectForCompare";const AD=u.memo(()=>{const{t:e}=P(),t=z(),n=Lr(),s=u.useCallback(()=>{t(Pm(n)),t(bt("upscaling")),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToUpscale"),status:"success"})},[t,n,e]);return r.jsx(he,{icon:r.jsx(OE,{}),onClickCapture:s,id:"send-to-upscale",children:e("parameters.sendToUpscale")})});AD.displayName="ImageMenuItemSendToUpscale";const TD=u.memo(()=>{const{t:e}=P(),t=Lr(),n=ce(gC),[s]=mC(),[i]=yC(),o=u.useCallback(()=>{t&&s({imageDTOs:[t]})},[s,t]),a=u.useCallback(()=>{t&&i({imageDTOs:[t]})},[i,t]);return t.starred?r.jsx(he,{icon:n?n.off.icon:r.jsx(jS,{}),onClickCapture:a,children:n?n.off.text:e("gallery.unstarImage")}):r.jsx(he,{icon:n?n.on.icon:r.jsx(CS,{}),onClickCapture:o,children:n?n.on.text:e("gallery.starImage")})});TD.displayName="ImageMenuItemStarUnstar";const cue=({imageDTO:e})=>r.jsxs(nue,{value:e,children:[r.jsxs(qu,{children:[r.jsx(kD,{}),r.jsx(vD,{}),r.jsx(xD,{}),r.jsx(_D,{}),r.jsx(ID,{}),r.jsx(bD,{})]}),r.jsx(is,{}),r.jsx(CD,{}),r.jsx(SD,{}),r.jsx(is,{}),r.jsx(AD,{}),r.jsxs(zr,{children:[r.jsx(wD,{}),r.jsx(jD,{})]}),r.jsx(is,{}),r.jsx(mD,{}),r.jsx(TD,{})]}),MD=u.memo(cue),uue=500,due=10,tu=rq({isOpen:!1,imageDTO:null,position:{x:-1,y:-1}}),Hh=()=>{tu.setKey("isOpen",!1)},Px=new Map,hue=e=>{const t=Array.from(Px.entries()).find(n=>n[0].contains(e));return t==null?void 0:t[1]},PD=(e,t)=>{u.useEffect(()=>{if(!t||!e)return;const n=t;return Px.set(n,e),()=>{Px.delete(n)}},[e,t])},ED=u.memo(()=>{wt("ImageContextMenu");const e=ce(tu);return Kf(Hh),r.jsxs(Uf,{children:[r.jsxs(Qt,{isOpen:e.isOpen,gutter:0,placement:"auto-end",onClose:Hh,children:[r.jsx(Jt,{"aria-hidden":!0,w:1,h:1,position:"absolute",left:e.position.x,top:e.position.y,cursor:"default",bg:"transparent",_hover:fue,pointerEvents:"none"}),r.jsx(DD,{})]}),r.jsx(LD,{})]})});ED.displayName="ImageContextMenu";const fue={bg:"transparent"},LD=u.memo(()=>{const e=u.useRef({x:-1,y:-1}),t=u.useRef(0),n=u.useRef(0),s=u.useCallback(c=>{if(c.shiftKey){Hh();return}const d=hue(c.target);if(!d){Hh();return}window.clearTimeout(n.current),c.preventDefault(),e.current.x!==c.pageX||e.current.y!==c.pageY?(tu.get().isOpen&&Hh(),n.current=window.setTimeout(()=>{tu.set({isOpen:!0,position:{x:c.pageX,y:c.pageY},imageDTO:d})},100)):tu.set({isOpen:!0,position:{x:c.pageX,y:c.pageY},imageDTO:d}),e.current={x:c.pageX,y:c.pageY}},[]),i=u.useCallback(c=>{c.pointerType!=="mouse"&&(t.current=window.setTimeout(()=>{s(c)},uue),e.current={x:c.pageX,y:c.pageY})},[s]),o=u.useCallback(c=>{if(c.pointerType==="mouse"||t.current===null)return;const d=e.current;Math.hypot(c.pageX-d.x,c.pageY-d.y)>due&&clearTimeout(t.current)},[]),a=u.useCallback(c=>{c.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]),l=u.useCallback(c=>{c.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]);return u.useEffect(()=>{const c=new AbortController;return window.addEventListener("contextmenu",s,{signal:c.signal}),window.addEventListener("pointerdown",i,{signal:c.signal}),window.addEventListener("pointerup",a,{signal:c.signal}),window.addEventListener("pointercancel",l,{signal:c.signal}),window.addEventListener("pointermove",o,{signal:c.signal}),()=>{c.abort()}},[s,l,i,o,a]),u.useEffect(()=>()=>{window.clearTimeout(n.current),window.clearTimeout(t.current)},[]),null});LD.displayName="ImageContextMenuEventLogical";const DD=u.memo(()=>{const e=I(bC),t=ce(tu);return t.imageDTO?e>1?r.jsx(kt,{visibility:"visible",children:r.jsx(tue,{})}):r.jsx(kt,{visibility:"visible",children:r.jsx(MD,{imageDTO:t.imageDTO})}):null});DD.displayName="MenuContent";const Is=u.memo(({loadingMessage:e})=>r.jsx(T,{flexDirection:"column",gap:4,borderRadius:"base",p:4,bg:"base.800",children:r.jsxs(T,{justifyContent:"center",alignItems:"center",flexDirection:"column",p:4,gap:8,children:[r.jsx(or,{}),r.jsx(K,{variant:"subtext",children:e||"Fetching..."})]})}));Is.displayName="FetchingModelsLoader";const Ex=e=>[e,...e.dependencies||[]],RD=()=>{const{modelList:e}=Zf(void 0,{selectFromResult:({data:s})=>({modelList:s?Ia.selectAll(s):er})}),t=u.useCallback(({source:s,name:i,base:o,type:a,is_installed:l,previous_names:c})=>e.some(d=>l||s===d.source||o===d.base&&(i===d.name||(c==null?void 0:c.includes(i)))&&a===d.type),[e]),n=u.useCallback(s=>{const{name:i,base:o,type:a,source:l,description:c,format:d}=s;return{config:{name:i,base:o,type:a,description:c,format:d},source:l}},[]);return{getIsInstalled:t,buildModelInstallArg:n}},pue=({bundleName:e,bundle:t})=>{const[n]=eM(),{getIsInstalled:s,buildModelInstallArg:i}=RD(),{t:o}=P(),a=u.useMemo(()=>{const c=Hne(t,Ex),d=EP(c,(p,g)=>p.source===g.source||p.name===g.name&&p.base===g.base&&p.type===g.type),h=d.filter(PP(s)).map(i),f=d.filter(s).map(i);return{install:h,skip:f}},[i,t,s]),l=u.useCallback(()=>{a.install.forEach(n);let c=o("modelManager.installingXModels",{count:a.install.length});a.skip.length>1&&(c+=o("modelManager.skippingXDuplicates",{count:a.skip.length-1})),fe({status:"info",title:o("modelManager.installingBundle"),description:c})},[a.install,a.skip.length,n,o]);return r.jsx(Le,{label:r.jsxs(T,{flexDir:"column",p:1,children:[r.jsxs(K,{children:[o("modelManager.includesNModels",{n:t.length}),":"]}),r.jsx(ki,{children:t.map((c,d)=>r.jsx(Gt,{wordBreak:"break-all",children:c.name},d))})]}),children:r.jsx(ye,{size:"sm",onClick:l,py:6,isDisabled:a.install.length===0,children:r.jsxs(T,{flexDir:"column",children:[r.jsx(K,{children:iq(e)?tM[e]:e}),a.install.length>0&&r.jsxs(K,{fontSize:"xs",children:["(",t.length," ",o("settings.models"),")"]}),a.install.length===0&&r.jsx(K,{fontSize:"xs",children:o("common.installed")})]})})})},Ku=()=>{const{t:e}=P(),[t,n]=eM();return[u.useCallback(({source:i,inplace:o,config:a,onSuccess:l,onError:c})=>{a||(a={}),t({source:i,inplace:o,config:a}).unwrap().then(d=>{l&&l(),fe({id:"MODEL_INSTALL_QUEUED",title:e("toast.modelAddedSimple"),status:"success"})}).catch(d=>{c&&c(d),d&&fe({id:"MODEL_INSTALL_QUEUE_FAILED",title:`${d.data.detail} `,status:"error"})})},[t,e]),n]},gue={any:"base","sd-1":"green","sd-2":"teal","sd-3":"purple",sdxl:"invokeBlue","sdxl-refiner":"invokeBlue",flux:"gold"},mue=({base:e})=>r.jsx(os,{flexGrow:0,colorScheme:gue[e],variant:"subtle",h:"min-content",children:tM[e]}),OD=u.memo(mue),ND=u.memo(({starterModel:e})=>{const{t}=P(),{getIsInstalled:n,buildModelInstallArg:s}=RD(),i=u.useMemo(()=>Ex(e).every(n),[n,e]),o=u.useMemo(()=>Ex(e).filter(PP(n)).map(s),[n,e,s]),[a]=Ku(),l=u.useCallback(()=>{o.forEach(a),fe({status:"info",title:t("modelManager.installingModel"),description:t("modelManager.installingXModels",{count:o.length})})},[o,a,t]);return r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(T,{fontSize:"sm",flexDir:"column",children:[r.jsxs(T,{gap:3,children:[r.jsx(os,{h:"min-content",children:e.type.replaceAll("_"," ")}),r.jsx(OD,{base:e.base}),r.jsx(K,{fontWeight:"semibold",children:e.name})]}),r.jsx(K,{variant:"subtext",children:e.description})]}),r.jsx(ke,{children:i?r.jsx(os,{children:t("common.installed")}):r.jsx(ae,{"aria-label":t("modelManager.install"),icon:r.jsx(Ht,{}),onClick:l,size:"sm"})})]})});ND.displayName="StarterModelsResultItem";const FD=u.memo(({results:e})=>{const{t}=P(),[n,s]=u.useState(""),i=u.useMemo(()=>e.starter_models.filter(l=>{const c=n.trim().toLowerCase(),d=[l.name.toLowerCase(),l.type.toLowerCase().replaceAll("_"," "),l.description.toLowerCase(),l.base.toLowerCase()];return l.type==="spandrel_image_to_image"&&(d.push("upscale"),d.push("post-processing"),d.push("postprocessing"),d.push("post processing")),d.some(h=>h.includes(c))}),[e,n]),o=u.useCallback(l=>{s(l.target.value)},[]),a=u.useCallback(()=>{s("")},[]);return r.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[Tu(e.starter_bundles)>0&&r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsxs(T,{gap:2,alignItems:"center",children:[r.jsx(K,{color:"base.200",fontWeight:"semibold",children:t("modelManager.starterBundles")}),r.jsx(Le,{label:t("modelManager.starterBundleHelpText"),children:r.jsx(T,{alignItems:"center",children:r.jsx(pt,{as:Gu,color:"base.200"})})})]}),r.jsx(T,{gap:2,children:Ci(e.starter_bundles,(l,c)=>r.jsx(pue,{bundleName:c,bundle:l},c))})]}),r.jsxs(Vo,{w:64,size:"xs",children:[r.jsx(Ct,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:o,size:"xs"}),n&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:r.jsx(Nt,{}),onClick:a,flexShrink:0})})]})]}),r.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx(Nn,{children:r.jsx(T,{flexDir:"column",gap:3,children:i.map(l=>r.jsx(ND,{starterModel:l},l.source))})})})]})});FD.displayName="StarterModelsResults";const BD=u.memo(()=>{const{isLoading:e,data:t}=oq(),{t:n}=P();return r.jsxs(T,{flexDir:"column",height:"100%",gap:3,children:[e&&r.jsx(Is,{loadingMessage:n("common.loading")}),t&&r.jsx(FD,{results:t})]})});BD.displayName="StarterModelsForm";const E5=nr("events"),yue=Di.endpoints.listModelInstalls.select(),Xm=_e("unauthorized-toast"),L5=_e("forbidden-toast"),vue=e=>{switch(e){case"invalid":return Ce("modelManager.hfTokenInvalid");case"unknown":return Ce("modelManager.hfTokenUnableToVerify");case"valid":return"HF Token is valid, but does not have access to model"}},bue=async e=>{const t=e(Di.endpoints.getHFTokenStatus.initiate(void 0,{subscribe:!1}));try{return await t.unwrap()}catch{return null}},xue=(e,t)=>async n=>{E5.error({data:n},"Model install error");const s=yue(e()).data;if(n.error==="Unauthorized")if(n.source.type==="hf"){const o=await bue(t);if(o===null)E5.error("Error getting HF token status");else{const a=vue(o);fe({id:Xm,title:a,description:r.jsx(Cue,{}),status:"error",isClosable:!0,duration:null})}}else n.source.type==="url"?fe({id:Xm,title:"Model requires authorization",description:r.jsxs(K,{fontSize:"md",children:[Ce("modelManager.urlUnauthorizedErrorMessage"),r.jsx(Xs,{label:Ce("modelManager.urlUnauthorizedErrorMessage2"),href:"https://invoke-ai.github.io/InvokeAI/configuration/#model-marketplace-api-keys"})]}),status:"error",isClosable:!0,duration:null}):Re(!1,"Unexpected unauthorized error for path source");else n.error==="Forbidden"?n.source.type==="hf"?fe({id:L5,title:Ce("modelManager.hfForbidden"),description:r.jsxs(K,{fontSize:"md",children:[Ce("modelManager.hfForbiddenErrorMessage"),r.jsx(Xs,{label:n.source.repo_id,href:`https://huggingface.co/${n.source.repo_id}`})]}),status:"error",isClosable:!0,duration:null}):n.source.type==="url"?fe({id:L5,title:Ce("modelManager.urlForbidden"),description:Ce("modelManager.urlForbiddenErrorMessage"),status:"error",isClosable:!0,duration:null}):Re(!1,"Unexpected forbidden error for path source"):fe({title:"Model install error",description:n.error,status:"error",isClosable:!0,duration:null});const i=s==null?void 0:s.find(o=>o.id===n.id);i?(i.source,t(Di.util.updateQueryData("listModelInstalls",void 0,o=>{const a=o.find(l=>l.id===n.id);return a&&(a.status="error",a.error_reason=n.error_type,a.error=n.error),o}))):t(Ei.util.invalidateTags([{type:"ModelInstalls"}]))},Cue=()=>{const e=un("hfToken"),{data:t}=xC(e?void 0:ws),{t:n}=P(),s=z(),i=u.useCallback(()=>{s(bt("models")),aq.close(Xm)},[s]);if(!t)return r.jsx(or,{});if(t==="invalid")return r.jsxs(K,{fontSize:"md",children:[n("modelManager.hfTokenInvalidErrorMessage")," ",n("modelManager.hfTokenRequired")," ",n("modelManager.hfTokenInvalidErrorMessage2"),r.jsxs(ye,{onClick:i,variant:"link",color:"base.50",flexGrow:0,children:[n("modelManager.modelManager"),"."]})]});if(t==="unknown")return r.jsxs(K,{fontSize:"md",children:[n("modelManager.hfTokenUnableToErrorMessage")," ",r.jsxs(ye,{onClick:i,variant:"link",color:"base.50",flexGrow:0,children:[n("modelManager.modelManager"),"."]})]});Re(!1,"Unexpected valid HF token with unauthorized error")},Sue=()=>{const{t:e}=P(),t=un("hfToken"),[n,s]=u.useState(""),{currentData:i}=xC(t?void 0:ws),[o,{isLoading:a,isUninitialized:l}]=lq(),c=u.useCallback(f=>{s(f.target.value)},[]),d=u.useCallback(()=>{o({token:n}).unwrap().then(f=>{f==="valid"&&(s(""),fe({id:Xm,title:e("modelManager.hfTokenSaved"),status:"success",duration:3e3}))})},[e,n,o]),h=u.useMemo(()=>!i||l||a?null:i==="invalid"?e("modelManager.hfTokenInvalidErrorMessage"):i==="unknown"?e("modelManager.hfTokenUnableToVerifyErrorMessage"):null,[i,a,l,e]);return!i||i==="valid"?null:r.jsx(T,{borderRadius:"base",w:"full",children:r.jsxs(Z,{isInvalid:!l&&!!h,orientation:"vertical",children:[r.jsx(te,{children:e("modelManager.hfTokenLabel")}),r.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[r.jsx(Ct,{type:"password",value:n,onChange:c}),r.jsx(ye,{onClick:d,size:"sm",isDisabled:n.trim().length===0,isLoading:a,children:e("common.save")})]}),r.jsx(Us,{children:r.jsx(Xs,{label:e("modelManager.hfTokenHelperText"),href:"https://huggingface.co/settings/tokens"})}),r.jsx(Yf,{children:h})]})})},$D=u.memo(({result:e})=>{const{t}=P(),[n]=Ku(),s=u.useCallback(()=>{n({source:e})},[n,e]);return r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(T,{fontSize:"sm",flexDir:"column",children:[r.jsx(K,{fontWeight:"semibold",children:e.split("/").slice(-1)[0]}),r.jsx(K,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:e})]}),r.jsx(ae,{"aria-label":t("modelManager.install"),icon:r.jsx(Ht,{}),onClick:s,size:"sm"})]})});$D.displayName="HuggingFaceResultItem";const VD=u.memo(({results:e})=>{const{t}=P(),[n,s]=u.useState(""),[i]=Ku(),o=u.useMemo(()=>e.filter(d=>{const h=d.split("/").slice(-1)[0];return h==null?void 0:h.toLowerCase().includes(n.toLowerCase())}),[e,n]),a=u.useCallback(d=>{s(d.target.value.trim())},[]),l=u.useCallback(()=>{s("")},[]),c=u.useCallback(()=>{for(const d of o)i({source:d})},[o,i]);return r.jsxs(r.Fragment,{children:[r.jsx(Et,{}),r.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ot,{size:"sm",children:t("modelManager.availableModels")}),r.jsxs(T,{alignItems:"center",gap:3,children:[r.jsx(ye,{size:"sm",onClick:c,isDisabled:e.length===0,flexShrink:0,children:t("modelManager.installAll")}),r.jsxs(Vo,{w:64,size:"xs",children:[r.jsx(Ct,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:a,size:"xs"}),n&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:r.jsx(Nt,{}),onClick:l})})]})]})]}),r.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx(Nn,{children:r.jsx(T,{flexDir:"column",gap:3,children:o.map(d=>r.jsx($D,{result:d},d))})})})]})]})});VD.displayName="HuggingFaceResults";const GD=u.memo(()=>{const[e,t]=u.useState(""),[n,s]=u.useState(!1),[i,o]=u.useState(""),{t:a}=P(),l=un("hfToken"),{currentData:c}=xC(l?void 0:ws),[d,{isLoading:h,data:f}]=cq(),[p]=Ku(),g=u.useCallback(()=>{d(e).unwrap().then(y=>{var x;y.is_diffusers?(p({source:e}),s(!1)):((x=y.urls)==null?void 0:x.length)===1&&y.urls[0]?(p({source:y.urls[0]}),s(!1)):s(!0)}).catch(y=>{o(y.data.detail||"")})},[d,p,e]),m=u.useCallback(y=>{t(y.target.value),o("")},[]);return r.jsxs(T,{flexDir:"column",height:"100%",gap:4,children:[r.jsxs(Z,{isInvalid:!!i.length,w:"full",orientation:"vertical",flexShrink:0,children:[r.jsx(te,{children:a("modelManager.huggingFaceRepoID")}),r.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[r.jsx(Ct,{placeholder:a("modelManager.huggingFacePlaceholder"),value:e,onChange:m}),r.jsx(ye,{onClick:g,isLoading:h,isDisabled:e.length===0,size:"sm",flexShrink:0,children:a("modelManager.installRepo")})]}),r.jsx(Us,{children:a("modelManager.huggingFaceHelper")}),!!i.length&&r.jsx(Yf,{children:i})]}),c!=="valid"&&r.jsx(Sue,{}),f&&f.urls&&n&&r.jsx(VD,{results:f.urls})]})});GD.displayName="HuggingFaceForm";var kp=e=>e.type==="checkbox",Fc=e=>e instanceof Date,Ms=e=>e==null;const zD=e=>typeof e=="object";var Rn=e=>!Ms(e)&&!Array.isArray(e)&&zD(e)&&!Fc(e),HD=e=>Rn(e)&&e.target?kp(e.target)?e.target.checked:e.target.value:e,wue=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,WD=(e,t)=>e.has(wue(t)),jue=e=>{const t=e.constructor&&e.constructor.prototype;return Rn(t)&&t.hasOwnProperty("isPrototypeOf")},KS=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function Gs(e){let t;const n=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(KS&&(e instanceof Blob||e instanceof FileList))&&(n||Rn(e)))if(t=n?[]:{},!n&&!jue(e))t=e;else for(const s in e)e.hasOwnProperty(s)&&(t[s]=Gs(e[s]));else return e;return t}var W1=e=>Array.isArray(e)?e.filter(Boolean):[],Cn=e=>e===void 0,Me=(e,t,n)=>{if(!t||!Rn(e))return n;const s=W1(t.split(/[,[\].]+?/)).reduce((i,o)=>Ms(i)?i:i[o],e);return Cn(s)||s===e?Cn(e[t])?n:e[t]:s},$r=e=>typeof e=="boolean",ZS=e=>/^\w*$/.test(e),UD=e=>W1(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Kt=(e,t,n)=>{let s=-1;const i=ZS(t)?[t]:UD(t),o=i.length,a=o-1;for(;++s<o;){const l=i[s];let c=n;if(s!==a){const d=e[l];c=Rn(d)||Array.isArray(d)?d:isNaN(+i[s+1])?{}:[]}if(l==="__proto__")return;e[l]=c,e=e[l]}return e};const Qm={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},mi={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},xo={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},kue=me.createContext(null),YS=()=>me.useContext(kue);var qD=(e,t,n,s=!0)=>{const i={defaultValues:t._defaultValues};for(const o in e)Object.defineProperty(i,o,{get:()=>{const a=o;return t._proxyFormState[a]!==mi.all&&(t._proxyFormState[a]=!s||mi.all),n&&(n[a]=!0),e[a]}});return i},zs=e=>Rn(e)&&!Object.keys(e).length,KD=(e,t,n,s)=>{n(e);const{name:i,...o}=e;return zs(o)||Object.keys(o).length>=Object.keys(t).length||Object.keys(o).find(a=>t[a]===(!s||mi.all))},Wh=e=>Array.isArray(e)?e:[e],ZD=(e,t,n)=>!e||!t||e===t||Wh(e).some(s=>s&&(n?s===t:s.startsWith(t)||t.startsWith(s)));function XS(e){const t=me.useRef(e);t.current=e,me.useEffect(()=>{const n=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{n&&n.unsubscribe()}},[e.disabled])}function _ue(e){const t=YS(),{control:n=t.control,disabled:s,name:i,exact:o}=e||{},[a,l]=me.useState(n._formState),c=me.useRef(!0),d=me.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),h=me.useRef(i);return h.current=i,XS({disabled:s,next:f=>c.current&&ZD(h.current,f.name,o)&&KD(f,d.current,n._updateFormState)&&l({...n._formState,...f}),subject:n._subjects.state}),me.useEffect(()=>(c.current=!0,d.current.isValid&&n._updateValid(!0),()=>{c.current=!1}),[n]),qD(a,n,d.current,!1)}var zi=e=>typeof e=="string",YD=(e,t,n,s,i)=>zi(e)?(s&&t.watch.add(e),Me(n,e,i)):Array.isArray(e)?e.map(o=>(s&&t.watch.add(o),Me(n,o))):(s&&(t.watchAll=!0),n);function Iue(e){const t=YS(),{control:n=t.control,name:s,defaultValue:i,disabled:o,exact:a}=e||{},l=me.useRef(s);l.current=s,XS({disabled:o,subject:n._subjects.values,next:h=>{ZD(l.current,h.name,a)&&d(Gs(YD(l.current,n._names,h.values||n._formValues,!1,i)))}});const[c,d]=me.useState(n._getWatch(s,i));return me.useEffect(()=>n._removeUnmounted()),c}function ls(e){const t=YS(),{name:n,disabled:s,control:i=t.control,shouldUnregister:o}=e,a=WD(i._names.array,n),l=Iue({control:i,name:n,defaultValue:Me(i._formValues,n,Me(i._defaultValues,n,e.defaultValue)),exact:!0}),c=_ue({control:i,name:n,exact:!0}),d=me.useRef(i.register(n,{...e.rules,value:l,...$r(e.disabled)?{disabled:e.disabled}:{}}));return me.useEffect(()=>{const h=i._options.shouldUnregister||o,f=(p,g)=>{const m=Me(i._fields,p);m&&m._f&&(m._f.mount=g)};if(f(n,!0),h){const p=Gs(Me(i._options.defaultValues,n));Kt(i._defaultValues,n,p),Cn(Me(i._formValues,n))&&Kt(i._formValues,n,p)}return()=>{(a?h&&!i._state.action:h)?i.unregister(n):f(n,!1)}},[n,i,a,o]),me.useEffect(()=>{Me(i._fields,n)&&i._updateDisabledField({disabled:s,fields:i._fields,name:n,value:Me(i._fields,n)._f.value})},[s,n,i]),{field:{name:n,value:l,...$r(s)||c.disabled?{disabled:c.disabled||s}:{},onChange:me.useCallback(h=>d.current.onChange({target:{value:HD(h),name:n},type:Qm.CHANGE}),[n]),onBlur:me.useCallback(()=>d.current.onBlur({target:{value:Me(i._formValues,n),name:n},type:Qm.BLUR}),[n,i]),ref:me.useCallback(h=>{const f=Me(i._fields,n);f&&h&&(f._f.ref={focus:()=>h.focus(),select:()=>h.select(),setCustomValidity:p=>h.setCustomValidity(p),reportValidity:()=>h.reportValidity()})},[i._fields,n])},formState:c,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!Me(c.errors,n)},isDirty:{enumerable:!0,get:()=>!!Me(c.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!Me(c.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!Me(c.validatingFields,n)},error:{enumerable:!0,get:()=>Me(c.errors,n)}})}}var Aue=(e,t,n,s,i)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[s]:i||!0}}:{},D5=e=>({isOnSubmit:!e||e===mi.onSubmit,isOnBlur:e===mi.onBlur,isOnChange:e===mi.onChange,isOnAll:e===mi.all,isOnTouch:e===mi.onTouched}),R5=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const Uh=(e,t,n,s)=>{for(const i of n||Object.keys(e)){const o=Me(e,i);if(o){const{_f:a,...l}=o;if(a){if(a.refs&&a.refs[0]&&t(a.refs[0],i)&&!s)return!0;if(a.ref&&t(a.ref,a.name)&&!s)return!0;if(Uh(l,t))break}else if(Rn(l)&&Uh(l,t))break}}};var Tue=(e,t,n)=>{const s=Wh(Me(e,n));return Kt(s,"root",t[n]),Kt(e,n,s),e},QS=e=>e.type==="file",To=e=>typeof e=="function",Jm=e=>{if(!KS)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},hm=e=>zi(e),JS=e=>e.type==="radio",e0=e=>e instanceof RegExp;const O5={value:!1,isValid:!1},N5={value:!0,isValid:!0};var XD=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!Cn(e[0].attributes.value)?Cn(e[0].value)||e[0].value===""?N5:{value:e[0].value,isValid:!0}:N5:O5}return O5};const F5={isValid:!1,value:null};var QD=e=>Array.isArray(e)?e.reduce((t,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:t,F5):F5;function B5(e,t,n="validate"){if(hm(e)||Array.isArray(e)&&e.every(hm)||$r(e)&&!e)return{type:n,message:hm(e)?e:"",ref:t}}var dc=e=>Rn(e)&&!e0(e)?e:{value:e,message:""},$5=async(e,t,n,s,i)=>{const{ref:o,refs:a,required:l,maxLength:c,minLength:d,min:h,max:f,pattern:p,validate:g,name:m,valueAsNumber:y,mount:x,disabled:C}=e._f,v=Me(t,m);if(!x||C)return{};const b=a?a[0]:o,S=F=>{s&&b.reportValidity&&(b.setCustomValidity($r(F)?"":F||""),b.reportValidity())},w={},j=JS(o),E=kp(o),A=j||E,L=(y||QS(o))&&Cn(o.value)&&Cn(v)||Jm(o)&&o.value===""||v===""||Array.isArray(v)&&!v.length,M=Aue.bind(null,m,n,w),O=(F,_,R,D=xo.maxLength,$=xo.minLength)=>{const G=F?_:R;w[m]={type:F?D:$,message:G,ref:o,...M(F?D:$,G)}};if(i?!Array.isArray(v)||!v.length:l&&(!A&&(L||Ms(v))||$r(v)&&!v||E&&!XD(a).isValid||j&&!QD(a).isValid)){const{value:F,message:_}=hm(l)?{value:!!l,message:l}:dc(l);if(F&&(w[m]={type:xo.required,message:_,ref:b,...M(xo.required,_)},!n))return S(_),w}if(!L&&(!Ms(h)||!Ms(f))){let F,_;const R=dc(f),D=dc(h);if(!Ms(v)&&!isNaN(v)){const $=o.valueAsNumber||v&&+v;Ms(R.value)||(F=$>R.value),Ms(D.value)||(_=$<D.value)}else{const $=o.valueAsDate||new Date(v),G=se=>new Date(new Date().toDateString()+" "+se),ee=o.type=="time",Q=o.type=="week";zi(R.value)&&v&&(F=ee?G(v)>G(R.value):Q?v>R.value:$>new Date(R.value)),zi(D.value)&&v&&(_=ee?G(v)<G(D.value):Q?v<D.value:$<new Date(D.value))}if((F||_)&&(O(!!F,R.message,D.message,xo.max,xo.min),!n))return S(w[m].message),w}if((c||d)&&!L&&(zi(v)||i&&Array.isArray(v))){const F=dc(c),_=dc(d),R=!Ms(F.value)&&v.length>+F.value,D=!Ms(_.value)&&v.length<+_.value;if((R||D)&&(O(R,F.message,_.message),!n))return S(w[m].message),w}if(p&&!L&&zi(v)){const{value:F,message:_}=dc(p);if(e0(F)&&!v.match(F)&&(w[m]={type:xo.pattern,message:_,ref:o,...M(xo.pattern,_)},!n))return S(_),w}if(g){if(To(g)){const F=await g(v,t),_=B5(F,b);if(_&&(w[m]={..._,...M(xo.validate,_.message)},!n))return S(_.message),w}else if(Rn(g)){let F={};for(const _ in g){if(!zs(F)&&!n)break;const R=B5(await g[_](v,t),b,_);R&&(F={...R,...M(_,R.message)},S(R.message),n&&(w[m]=F))}if(!zs(F)&&(w[m]={ref:b,...F},!n))return w}}return S(!0),w};function Mue(e,t){const n=t.slice(0,-1).length;let s=0;for(;s<n;)e=Cn(e)?s++:e[t[s++]];return e}function Pue(e){for(const t in e)if(e.hasOwnProperty(t)&&!Cn(e[t]))return!1;return!0}function Fn(e,t){const n=Array.isArray(t)?t:ZS(t)?[t]:UD(t),s=n.length===1?e:Mue(e,n),i=n.length-1,o=n[i];return s&&delete s[o],i!==0&&(Rn(s)&&zs(s)||Array.isArray(s)&&Pue(s))&&Fn(e,n.slice(0,-1)),e}var wv=()=>{let e=[];return{get observers(){return e},next:i=>{for(const o of e)o.next&&o.next(i)},subscribe:i=>(e.push(i),{unsubscribe:()=>{e=e.filter(o=>o!==i)}}),unsubscribe:()=>{e=[]}}},t0=e=>Ms(e)||!zD(e);function oa(e,t){if(t0(e)||t0(t))return e===t;if(Fc(e)&&Fc(t))return e.getTime()===t.getTime();const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(const i of n){const o=e[i];if(!s.includes(i))return!1;if(i!=="ref"){const a=t[i];if(Fc(o)&&Fc(a)||Rn(o)&&Rn(a)||Array.isArray(o)&&Array.isArray(a)?!oa(o,a):o!==a)return!1}}return!0}var JD=e=>e.type==="select-multiple",Eue=e=>JS(e)||kp(e),jv=e=>Jm(e)&&e.isConnected,eR=e=>{for(const t in e)if(To(e[t]))return!0;return!1};function n0(e,t={}){const n=Array.isArray(e);if(Rn(e)||n)for(const s in e)Array.isArray(e[s])||Rn(e[s])&&!eR(e[s])?(t[s]=Array.isArray(e[s])?[]:{},n0(e[s],t[s])):Ms(e[s])||(t[s]=!0);return t}function tR(e,t,n){const s=Array.isArray(e);if(Rn(e)||s)for(const i in e)Array.isArray(e[i])||Rn(e[i])&&!eR(e[i])?Cn(t)||t0(n[i])?n[i]=Array.isArray(e[i])?n0(e[i],[]):{...n0(e[i])}:tR(e[i],Ms(t)?{}:t[i],n[i]):n[i]=!oa(e[i],t[i]);return n}var yg=(e,t)=>tR(e,t,n0(t)),nR=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:s})=>Cn(e)?e:t?e===""?NaN:e&&+e:n&&zi(e)?new Date(e):s?s(e):e;function kv(e){const t=e.ref;if(!(e.refs?e.refs.every(n=>n.disabled):t.disabled))return QS(t)?t.files:JS(t)?QD(e.refs).value:JD(t)?[...t.selectedOptions].map(({value:n})=>n):kp(t)?XD(e.refs).value:nR(Cn(t.value)?e.ref.value:t.value,e)}var Lue=(e,t,n,s)=>{const i={};for(const o of e){const a=Me(t,o);a&&Kt(i,o,a._f)}return{criteriaMode:n,names:[...e],fields:i,shouldUseNativeValidation:s}},lh=e=>Cn(e)?e:e0(e)?e.source:Rn(e)?e0(e.value)?e.value.source:e.value:e;const V5="AsyncFunction";var Due=e=>(!e||!e.validate)&&!!(To(e.validate)&&e.validate.constructor.name===V5||Rn(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===V5)),Rue=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function G5(e,t,n){const s=Me(e,n);if(s||ZS(n))return{error:s,name:n};const i=n.split(".");for(;i.length;){const o=i.join("."),a=Me(t,o),l=Me(e,o);if(a&&!Array.isArray(a)&&n!==o)return{name:n};if(l&&l.type)return{name:o,error:l};i.pop()}return{name:n}}var Oue=(e,t,n,s,i)=>i.isOnAll?!1:!n&&i.isOnTouch?!(t||e):(n?s.isOnBlur:i.isOnBlur)?!e:(n?s.isOnChange:i.isOnChange)?e:!0,Nue=(e,t)=>!W1(Me(e,t)).length&&Fn(e,t);const Fue={mode:mi.onSubmit,reValidateMode:mi.onChange,shouldFocusError:!0};function Bue(e={}){let t={...Fue,...e},n={submitCount:0,isDirty:!1,isLoading:To(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},i=Rn(t.defaultValues)||Rn(t.values)?Gs(t.defaultValues||t.values)||{}:{},o=t.shouldUnregister?{}:Gs(i),a={action:!1,mount:!1,watch:!1},l={mount:new Set,unMount:new Set,array:new Set,watch:new Set},c,d=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},f={values:wv(),array:wv(),state:wv()},p=D5(t.mode),g=D5(t.reValidateMode),m=t.criteriaMode===mi.all,y=q=>re=>{clearTimeout(d),d=setTimeout(q,re)},x=async q=>{if(h.isValid||q){const re=t.resolver?zs((await A()).errors):await M(s,!0);re!==n.isValid&&f.state.next({isValid:re})}},C=(q,re)=>{(h.isValidating||h.validatingFields)&&((q||Array.from(l.mount)).forEach(oe=>{oe&&(re?Kt(n.validatingFields,oe,re):Fn(n.validatingFields,oe))}),f.state.next({validatingFields:n.validatingFields,isValidating:!zs(n.validatingFields)}))},v=(q,re=[],oe,xe,ge=!0,de=!0)=>{if(xe&&oe){if(a.action=!0,de&&Array.isArray(Me(s,q))){const le=oe(Me(s,q),xe.argA,xe.argB);ge&&Kt(s,q,le)}if(de&&Array.isArray(Me(n.errors,q))){const le=oe(Me(n.errors,q),xe.argA,xe.argB);ge&&Kt(n.errors,q,le),Nue(n.errors,q)}if(h.touchedFields&&de&&Array.isArray(Me(n.touchedFields,q))){const le=oe(Me(n.touchedFields,q),xe.argA,xe.argB);ge&&Kt(n.touchedFields,q,le)}h.dirtyFields&&(n.dirtyFields=yg(i,o)),f.state.next({name:q,isDirty:F(q,re),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else Kt(o,q,re)},b=(q,re)=>{Kt(n.errors,q,re),f.state.next({errors:n.errors})},S=q=>{n.errors=q,f.state.next({errors:n.errors,isValid:!1})},w=(q,re,oe,xe)=>{const ge=Me(s,q);if(ge){const de=Me(o,q,Cn(oe)?Me(i,q):oe);Cn(de)||xe&&xe.defaultChecked||re?Kt(o,q,re?de:kv(ge._f)):D(q,de),a.mount&&x()}},j=(q,re,oe,xe,ge)=>{let de=!1,le=!1;const Se={name:q},Ge=!!(Me(s,q)&&Me(s,q)._f&&Me(s,q)._f.disabled);if(!oe||xe){h.isDirty&&(le=n.isDirty,n.isDirty=Se.isDirty=F(),de=le!==Se.isDirty);const Ye=Ge||oa(Me(i,q),re);le=!!(!Ge&&Me(n.dirtyFields,q)),Ye||Ge?Fn(n.dirtyFields,q):Kt(n.dirtyFields,q,!0),Se.dirtyFields=n.dirtyFields,de=de||h.dirtyFields&&le!==!Ye}if(oe){const Ye=Me(n.touchedFields,q);Ye||(Kt(n.touchedFields,q,oe),Se.touchedFields=n.touchedFields,de=de||h.touchedFields&&Ye!==oe)}return de&&ge&&f.state.next(Se),de?Se:{}},E=(q,re,oe,xe)=>{const ge=Me(n.errors,q),de=h.isValid&&$r(re)&&n.isValid!==re;if(e.delayError&&oe?(c=y(()=>b(q,oe)),c(e.delayError)):(clearTimeout(d),c=null,oe?Kt(n.errors,q,oe):Fn(n.errors,q)),(oe?!oa(ge,oe):ge)||!zs(xe)||de){const le={...xe,...de&&$r(re)?{isValid:re}:{},errors:n.errors,name:q};n={...n,...le},f.state.next(le)}},A=async q=>{C(q,!0);const re=await t.resolver(o,t.context,Lue(q||l.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return C(q),re},L=async q=>{const{errors:re}=await A(q);if(q)for(const oe of q){const xe=Me(re,oe);xe?Kt(n.errors,oe,xe):Fn(n.errors,oe)}else n.errors=re;return re},M=async(q,re,oe={valid:!0})=>{for(const xe in q){const ge=q[xe];if(ge){const{_f:de,...le}=ge;if(de){const Se=l.array.has(de.name),Ge=ge._f&&Due(ge._f);Ge&&h.validatingFields&&C([xe],!0);const Ye=await $5(ge,o,m,t.shouldUseNativeValidation&&!re,Se);if(Ge&&h.validatingFields&&C([xe]),Ye[de.name]&&(oe.valid=!1,re))break;!re&&(Me(Ye,de.name)?Se?Tue(n.errors,Ye,de.name):Kt(n.errors,de.name,Ye[de.name]):Fn(n.errors,de.name))}!zs(le)&&await M(le,re,oe)}}return oe.valid},O=()=>{for(const q of l.unMount){const re=Me(s,q);re&&(re._f.refs?re._f.refs.every(oe=>!jv(oe)):!jv(re._f.ref))&&J(q)}l.unMount=new Set},F=(q,re)=>(q&&re&&Kt(o,q,re),!oa(ne(),i)),_=(q,re,oe)=>YD(q,l,{...a.mount?o:Cn(re)?i:zi(q)?{[q]:re}:re},oe,re),R=q=>W1(Me(a.mount?o:i,q,e.shouldUnregister?Me(i,q,[]):[])),D=(q,re,oe={})=>{const xe=Me(s,q);let ge=re;if(xe){const de=xe._f;de&&(!de.disabled&&Kt(o,q,nR(re,de)),ge=Jm(de.ref)&&Ms(re)?"":re,JD(de.ref)?[...de.ref.options].forEach(le=>le.selected=ge.includes(le.value)):de.refs?kp(de.ref)?de.refs.length>1?de.refs.forEach(le=>(!le.defaultChecked||!le.disabled)&&(le.checked=Array.isArray(ge)?!!ge.find(Se=>Se===le.value):ge===le.value)):de.refs[0]&&(de.refs[0].checked=!!ge):de.refs.forEach(le=>le.checked=le.value===ge):QS(de.ref)?de.ref.value="":(de.ref.value=ge,de.ref.type||f.values.next({name:q,values:{...o}})))}(oe.shouldDirty||oe.shouldTouch)&&j(q,ge,oe.shouldTouch,oe.shouldDirty,!0),oe.shouldValidate&&se(q)},$=(q,re,oe)=>{for(const xe in re){const ge=re[xe],de=`${q}.${xe}`,le=Me(s,de);(l.array.has(q)||!t0(ge)||le&&!le._f)&&!Fc(ge)?$(de,ge,oe):D(de,ge,oe)}},G=(q,re,oe={})=>{const xe=Me(s,q),ge=l.array.has(q),de=Gs(re);Kt(o,q,de),ge?(f.array.next({name:q,values:{...o}}),(h.isDirty||h.dirtyFields)&&oe.shouldDirty&&f.state.next({name:q,dirtyFields:yg(i,o),isDirty:F(q,de)})):xe&&!xe._f&&!Ms(de)?$(q,de,oe):D(q,de,oe),R5(q,l)&&f.state.next({...n}),f.values.next({name:a.mount?q:void 0,values:{...o}})},ee=async q=>{a.mount=!0;const re=q.target;let oe=re.name,xe=!0;const ge=Me(s,oe),de=()=>re.type?kv(ge._f):HD(q),le=Se=>{xe=Number.isNaN(Se)||oa(Se,Me(o,oe,Se))};if(ge){let Se,Ge;const Ye=de(),dt=q.type===Qm.BLUR||q.type===Qm.FOCUS_OUT,fn=!Rue(ge._f)&&!t.resolver&&!Me(n.errors,oe)&&!ge._f.deps||Oue(dt,Me(n.touchedFields,oe),n.isSubmitted,g,p),ln=R5(oe,l,dt);Kt(o,oe,Ye),dt?(ge._f.onBlur&&ge._f.onBlur(q),c&&c(0)):ge._f.onChange&&ge._f.onChange(q);const pn=j(oe,Ye,dt,!1),Jn=!zs(pn)||ln;if(!dt&&f.values.next({name:oe,type:q.type,values:{...o}}),fn)return h.isValid&&(e.mode==="onBlur"?dt&&x():x()),Jn&&f.state.next({name:oe,...ln?{}:pn});if(!dt&&ln&&f.state.next({...n}),t.resolver){const{errors:js}=await A([oe]);if(le(Ye),xe){const gn=G5(n.errors,s,oe),Ti=G5(js,s,gn.name||oe);Se=Ti.error,oe=Ti.name,Ge=zs(js)}}else C([oe],!0),Se=(await $5(ge,o,m,t.shouldUseNativeValidation))[oe],C([oe]),le(Ye),xe&&(Se?Ge=!1:h.isValid&&(Ge=await M(s,!0)));xe&&(ge._f.deps&&se(ge._f.deps),E(oe,Ge,Se,pn))}},Q=(q,re)=>{if(Me(n.errors,re)&&q.focus)return q.focus(),1},se=async(q,re={})=>{let oe,xe;const ge=Wh(q);if(t.resolver){const de=await L(Cn(q)?q:ge);oe=zs(de),xe=q?!ge.some(le=>Me(de,le)):oe}else q?(xe=(await Promise.all(ge.map(async de=>{const le=Me(s,de);return await M(le&&le._f?{[de]:le}:le)}))).every(Boolean),!(!xe&&!n.isValid)&&x()):xe=oe=await M(s);return f.state.next({...!zi(q)||h.isValid&&oe!==n.isValid?{}:{name:q},...t.resolver||!q?{isValid:oe}:{},errors:n.errors}),re.shouldFocus&&!xe&&Uh(s,Q,q?ge:l.mount),xe},ne=q=>{const re={...a.mount?o:i};return Cn(q)?re:zi(q)?Me(re,q):q.map(oe=>Me(re,oe))},H=(q,re)=>({invalid:!!Me((re||n).errors,q),isDirty:!!Me((re||n).dirtyFields,q),error:Me((re||n).errors,q),isValidating:!!Me(n.validatingFields,q),isTouched:!!Me((re||n).touchedFields,q)}),V=q=>{q&&Wh(q).forEach(re=>Fn(n.errors,re)),f.state.next({errors:q?n.errors:{}})},Y=(q,re,oe)=>{const xe=(Me(s,q,{_f:{}})._f||{}).ref,ge=Me(n.errors,q)||{},{ref:de,message:le,type:Se,...Ge}=ge;Kt(n.errors,q,{...Ge,...re,ref:xe}),f.state.next({name:q,errors:n.errors,isValid:!1}),oe&&oe.shouldFocus&&xe&&xe.focus&&xe.focus()},W=(q,re)=>To(q)?f.values.subscribe({next:oe=>q(_(void 0,re),oe)}):_(q,re,!0),J=(q,re={})=>{for(const oe of q?Wh(q):l.mount)l.mount.delete(oe),l.array.delete(oe),re.keepValue||(Fn(s,oe),Fn(o,oe)),!re.keepError&&Fn(n.errors,oe),!re.keepDirty&&Fn(n.dirtyFields,oe),!re.keepTouched&&Fn(n.touchedFields,oe),!re.keepIsValidating&&Fn(n.validatingFields,oe),!t.shouldUnregister&&!re.keepDefaultValue&&Fn(i,oe);f.values.next({values:{...o}}),f.state.next({...n,...re.keepDirty?{isDirty:F()}:{}}),!re.keepIsValid&&x()},N=({disabled:q,name:re,field:oe,fields:xe,value:ge})=>{if($r(q)&&a.mount||q){const de=q?void 0:Cn(ge)?kv(oe?oe._f:Me(xe,re)._f):ge;Kt(o,re,de),j(re,de,!1,!1,!0)}},B=(q,re={})=>{let oe=Me(s,q);const xe=$r(re.disabled)||$r(e.disabled);return Kt(s,q,{...oe||{},_f:{...oe&&oe._f?oe._f:{ref:{name:q}},name:q,mount:!0,...re}}),l.mount.add(q),oe?N({field:oe,disabled:$r(re.disabled)?re.disabled:e.disabled,name:q,value:re.value}):w(q,!0,re.value),{...xe?{disabled:re.disabled||e.disabled}:{},...t.progressive?{required:!!re.required,min:lh(re.min),max:lh(re.max),minLength:lh(re.minLength),maxLength:lh(re.maxLength),pattern:lh(re.pattern)}:{},name:q,onChange:ee,onBlur:ee,ref:ge=>{if(ge){B(q,re),oe=Me(s,q);const de=Cn(ge.value)&&ge.querySelectorAll&&ge.querySelectorAll("input,select,textarea")[0]||ge,le=Eue(de),Se=oe._f.refs||[];if(le?Se.find(Ge=>Ge===de):de===oe._f.ref)return;Kt(s,q,{_f:{...oe._f,...le?{refs:[...Se.filter(jv),de,...Array.isArray(Me(i,q))?[{}]:[]],ref:{type:de.type,name:q}}:{ref:de}}}),w(q,!1,void 0,de)}else oe=Me(s,q,{}),oe._f&&(oe._f.mount=!1),(t.shouldUnregister||re.shouldUnregister)&&!(WD(l.array,q)&&a.action)&&l.unMount.add(q)}}},U=()=>t.shouldFocusError&&Uh(s,Q,l.mount),ie=q=>{$r(q)&&(f.state.next({disabled:q}),Uh(s,(re,oe)=>{const xe=Me(s,oe);xe&&(re.disabled=xe._f.disabled||q,Array.isArray(xe._f.refs)&&xe._f.refs.forEach(ge=>{ge.disabled=xe._f.disabled||q}))},0,!1))},ue=(q,re)=>async oe=>{let xe;oe&&(oe.preventDefault&&oe.preventDefault(),oe.persist&&oe.persist());let ge=Gs(o);if(f.state.next({isSubmitting:!0}),t.resolver){const{errors:de,values:le}=await A();n.errors=de,ge=le}else await M(s);if(Fn(n.errors,"root"),zs(n.errors)){f.state.next({errors:{}});try{await q(ge,oe)}catch(de){xe=de}}else re&&await re({...n.errors},oe),U(),setTimeout(U);if(f.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:zs(n.errors)&&!xe,submitCount:n.submitCount+1,errors:n.errors}),xe)throw xe},be=(q,re={})=>{Me(s,q)&&(Cn(re.defaultValue)?G(q,Gs(Me(i,q))):(G(q,re.defaultValue),Kt(i,q,Gs(re.defaultValue))),re.keepTouched||Fn(n.touchedFields,q),re.keepDirty||(Fn(n.dirtyFields,q),n.isDirty=re.defaultValue?F(q,Gs(Me(i,q))):F()),re.keepError||(Fn(n.errors,q),h.isValid&&x()),f.state.next({...n}))},Te=(q,re={})=>{const oe=q?Gs(q):i,xe=Gs(oe),ge=zs(q),de=ge?i:xe;if(re.keepDefaultValues||(i=oe),!re.keepValues){if(re.keepDirtyValues)for(const le of l.mount)Me(n.dirtyFields,le)?Kt(de,le,Me(o,le)):G(le,Me(de,le));else{if(KS&&Cn(q))for(const le of l.mount){const Se=Me(s,le);if(Se&&Se._f){const Ge=Array.isArray(Se._f.refs)?Se._f.refs[0]:Se._f.ref;if(Jm(Ge)){const Ye=Ge.closest("form");if(Ye){Ye.reset();break}}}}s={}}o=e.shouldUnregister?re.keepDefaultValues?Gs(i):{}:Gs(de),f.array.next({values:{...de}}),f.values.next({values:{...de}})}l={mount:re.keepDirtyValues?l.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},a.mount=!h.isValid||!!re.keepIsValid||!!re.keepDirtyValues,a.watch=!!e.shouldUnregister,f.state.next({submitCount:re.keepSubmitCount?n.submitCount:0,isDirty:ge?!1:re.keepDirty?n.isDirty:!!(re.keepDefaultValues&&!oa(q,i)),isSubmitted:re.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:ge?{}:re.keepDirtyValues?re.keepDefaultValues&&o?yg(i,o):n.dirtyFields:re.keepDefaultValues&&q?yg(i,q):re.keepDirty?n.dirtyFields:{},touchedFields:re.keepTouched?n.touchedFields:{},errors:re.keepErrors?n.errors:{},isSubmitSuccessful:re.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},je=(q,re)=>Te(To(q)?q(o):q,re);return{control:{register:B,unregister:J,getFieldState:H,handleSubmit:ue,setError:Y,_executeSchema:A,_getWatch:_,_getDirty:F,_updateValid:x,_removeUnmounted:O,_updateFieldArray:v,_updateDisabledField:N,_getFieldArray:R,_reset:Te,_resetDefaultValues:()=>To(t.defaultValues)&&t.defaultValues().then(q=>{je(q,t.resetOptions),f.state.next({isLoading:!1})}),_updateFormState:q=>{n={...n,...q}},_disableForm:ie,_subjects:f,_proxyFormState:h,_setErrors:S,get _fields(){return s},get _formValues(){return o},get _state(){return a},set _state(q){a=q},get _defaultValues(){return i},get _names(){return l},set _names(q){l=q},get _formState(){return n},set _formState(q){n=q},get _options(){return t},set _options(q){t={...t,...q}}},trigger:se,register:B,handleSubmit:ue,watch:W,setValue:G,getValues:ne,reset:je,resetField:be,clearErrors:V,unregister:J,setError:Y,setFocus:(q,re={})=>{const oe=Me(s,q),xe=oe&&oe._f;if(xe){const ge=xe.refs?xe.refs[0]:xe.ref;ge.focus&&(ge.focus(),re.shouldSelect&&ge.select())}},getFieldState:H}}function _p(e={}){const t=me.useRef(),n=me.useRef(),[s,i]=me.useState({isDirty:!1,isValidating:!1,isLoading:To(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:To(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...Bue(e),formState:s});const o=t.current.control;return o._options=e,XS({subject:o._subjects.state,next:a=>{KD(a,o._proxyFormState,o._updateFormState,!0)&&i({...o._formState})}}),me.useEffect(()=>o._disableForm(e.disabled),[o,e.disabled]),me.useEffect(()=>{if(o._proxyFormState.isDirty){const a=o._getDirty();a!==s.isDirty&&o._subjects.state.next({isDirty:a})}},[o,s.isDirty]),me.useEffect(()=>{e.values&&!oa(e.values,n.current)?(o._reset(e.values,o._options.resetOptions),n.current=e.values,i(a=>({...a}))):o._resetDefaultValues()},[e.values,o]),me.useEffect(()=>{e.errors&&o._setErrors(e.errors)},[e.errors,o]),me.useEffect(()=>{o._state.mount||(o._updateValid(),o._state.mount=!0),o._state.watch&&(o._state.watch=!1,o._subjects.state.next({...o._formState})),o._removeUnmounted()}),me.useEffect(()=>{e.shouldUnregister&&o._subjects.values.next({values:o._getWatch()})},[e.shouldUnregister,o]),t.current.formState=qD(s,o),t.current}const sR=u.memo(()=>{const e=I(nM),t=z(),[n,{isLoading:s}]=Ku(),{register:i,handleSubmit:o,formState:a,reset:l}=_p({defaultValues:{location:""},mode:"onChange"}),c=u.useCallback(()=>l(void 0,{keepValues:!0}),[l]),d=u.useCallback(f=>{f!=null&&f.location&&n({source:f.location,inplace:e,onSuccess:c,onError:c})},[n,c,e]),h=u.useCallback(f=>{t(sM(f.target.checked))},[t]);return r.jsx("form",{onSubmit:o(d),children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsx(T,{gap:2,alignItems:"flex-end",justifyContent:"space-between",children:r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:Ce("modelManager.urlOrLocalPath")}),r.jsxs(T,{alignItems:"center",gap:3,w:"full",children:[r.jsx(Ct,{placeholder:Ce("modelManager.simpleModelPlaceholder"),...i("location")}),r.jsx(ye,{onClick:o(d),isDisabled:!a.dirtyFields.location,isLoading:s,size:"sm",children:Ce("modelManager.install")})]}),r.jsx(Us,{children:Ce("modelManager.urlOrLocalPathHelper")})]})}),r.jsx(Z,{children:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsxs(T,{gap:4,children:[r.jsx(jn,{isChecked:e,onChange:h}),r.jsxs(te,{children:[Ce("modelManager.inplaceInstall")," (",Ce("modelManager.localOnly"),")"]})]}),r.jsx(Us,{children:Ce("modelManager.inplaceInstallDesc")})]})})]})})});sR.displayName="InstallModelForm";const _v={waiting:{colorScheme:"cyan",translationKey:"queue.pending"},downloading:{colorScheme:"yellow",translationKey:"queue.in_progress"},downloads_done:{colorScheme:"yellow",translationKey:"queue.in_progress"},running:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},error:{colorScheme:"red",translationKey:"queue.failed"},cancelled:{colorScheme:"orange",translationKey:"queue.canceled"}},$ue=({status:e})=>{const{t}=P();return!e||!Object.keys(_v).includes(e)?null:r.jsx(os,{textAlign:"center",w:"134px",colorScheme:_v[e].colorScheme,children:t(_v[e].translationKey)})},Vue=u.memo($ue),z5=e=>{const t=["B","KB","MB","GB","TB"];let n=0;for(n;e>=1024&&n<4;n++)e/=1024;return`${e.toFixed(2)} ${t[n]}`},rR=u.memo(e=>{const{installJob:t}=e,[n]=uq(),s=u.useCallback(()=>{n(t.id).unwrap().then(l=>{fe({id:"MODEL_INSTALL_CANCELED",title:Ce("toast.modelImportCanceled"),status:"success"})}).catch(l=>{l&&fe({id:"MODEL_INSTALL_CANCEL_FAILED",title:`${l.data.detail} `,status:"error"})})},[n,t]),i=u.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url;case"local":return t.source.path;default:return Ce("common.unknown")}},[t.source]),o=u.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url.split("/").slice(-1)[0]??Ce("common.unknown");case"local":return t.source.path.split("\\").slice(-1)[0]??Ce("common.unknown");default:return Ce("common.unknown")}},[t.source]),a=u.useMemo(()=>t.status==="completed"||t.status==="error"||t.status==="cancelled"?100:ze(t.bytes)||ze(t.total_bytes)?null:t.total_bytes===0?0:t.bytes/t.total_bytes*100,[t.bytes,t.status,t.total_bytes]);return r.jsxs(T,{gap:3,w:"full",alignItems:"center",children:[r.jsx(Le,{maxW:600,label:r.jsx(iR,{name:o,source:i,installJob:t}),children:r.jsxs(T,{gap:3,w:"full",alignItems:"center",children:[r.jsx(K,{w:96,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:o}),r.jsx(rM,{w:"full",flexGrow:1,value:a??0,isIndeterminate:a===null,"aria-label":Ce("accessibility.invokeProgressBar"),h:2}),r.jsx(Vue,{status:t.status})]})}),r.jsx(ae,{isDisabled:t.status!=="downloading"&&t.status!=="waiting"&&t.status!=="running",size:"xs",tooltip:Ce("modelManager.cancel"),"aria-label":Ce("modelManager.cancel"),icon:r.jsx(Nt,{}),onClick:s,variant:"ghost"})]})});rR.displayName="ModelInstallQueueItem";const iR=u.memo(({name:e,source:t,installJob:n})=>{const s=u.useMemo(()=>n.status!=="downloading"||n.bytes===void 0||n.total_bytes===void 0?"":`${z5(n.bytes)} / ${z5(n.total_bytes)}`,[n.bytes,n.total_bytes,n.status]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{gap:3,justifyContent:"space-between",children:[r.jsx(K,{fontWeight:"semibold",children:e}),s&&r.jsx(K,{children:s})]}),r.jsx(K,{fontStyle:"italic",wordBreak:"break-all",children:t}),n.error_reason&&r.jsxs(K,{color:"error.500",children:[Ce("queue.failed"),": ",n.error]})]})});iR.displayName="TooltipLabel";const oR=u.memo(()=>{const{data:e}=dq(),[t]=hq(),n=u.useCallback(()=>{t().unwrap().then(i=>{fe({id:"MODEL_INSTALL_QUEUE_PRUNED",title:Ce("toast.prunedQueue"),status:"success"})}).catch(i=>{i&&fe({id:"MODEL_INSTALL_QUEUE_PRUNE_FAILED",title:`${i.data.detail} `,status:"error"})})},[t]),s=u.useMemo(()=>e==null?void 0:e.some(i=>i.status==="cancelled"||i.status==="error"||i.status==="completed"),[e]);return r.jsxs(T,{flexDir:"column",p:3,h:"full",gap:3,children:[r.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ot,{size:"sm",children:Ce("modelManager.installQueue")}),r.jsx(ye,{size:"sm",isDisabled:!s,onClick:n,tooltip:Ce("modelManager.pruneTooltip"),children:Ce("modelManager.prune")})]}),r.jsx(ke,{layerStyle:"first",p:3,borderRadius:"base",w:"full",h:"full",children:r.jsx(Nn,{children:r.jsx(T,{flexDir:"column-reverse",gap:"2",w:"full",children:e==null?void 0:e.map(i=>r.jsx(rR,{installJob:i},i.id))})})})]})});oR.displayName="ModelInstallQueue";const aR=u.memo(({result:e,installModel:t})=>{const{t:n}=P(),s=u.useCallback(()=>{t(e.path)},[t,e]);return r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[r.jsxs(T,{fontSize:"sm",flexDir:"column",children:[r.jsx(K,{fontWeight:"semibold",children:e.path.split("\\").slice(-1)[0]}),r.jsx(K,{variant:"subtext",children:e.path})]}),r.jsx(ke,{children:e.is_installed?r.jsx(os,{children:n("common.installed")}):r.jsx(ae,{"aria-label":n("modelManager.install"),icon:r.jsx(Ht,{}),onClick:s,size:"sm"})})]})});aR.displayName="ScanModelResultItem";const lR=u.memo(({results:e})=>{const t=I(nM),n=z(),{t:s}=P(),[i,o]=u.useState(""),[a]=Ku(),l=u.useMemo(()=>e.filter(g=>{const m=g.path.split("\\").slice(-1)[0];return m==null?void 0:m.toLowerCase().includes(i.toLowerCase())}),[e,i]),c=u.useCallback(g=>{o(g.target.value.trim())},[]),d=u.useCallback(g=>{n(sM(g.target.checked))},[n]),h=u.useCallback(()=>{o("")},[]),f=u.useCallback(()=>{for(const g of l)g.is_installed||a({source:g.path,inplace:t})},[l,a,t]),p=u.useCallback(g=>{a({source:g,inplace:t})},[a,t]);return r.jsxs(r.Fragment,{children:[r.jsx(Et,{}),r.jsxs(T,{flexDir:"column",gap:3,height:"100%",children:[r.jsxs(T,{justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ot,{size:"sm",children:s("modelManager.scanResults")}),r.jsxs(T,{alignItems:"center",gap:3,children:[r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:s("modelManager.inplaceInstall")}),r.jsx(jn,{isChecked:t,onChange:d,size:"md"})]}),r.jsx(ye,{size:"sm",onClick:f,isDisabled:l.length===0,children:s("modelManager.installAll")}),r.jsxs(Vo,{w:64,size:"xs",children:[r.jsx(Ct,{placeholder:s("modelManager.search"),value:i,"data-testid":"board-search-input",onChange:c,size:"xs"}),i&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:r.jsx(Nt,{}),onClick:h,flexShrink:0})})]})]})]}),r.jsx(T,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:r.jsx(Nn,{children:r.jsx(T,{flexDir:"column",gap:3,children:l.map(g=>r.jsx(aR,{result:g,installModel:p},g.path))})})})]})]})});lR.displayName="ScanModelsResults";const Gue=fq(e=>e.scanPath),cR=u.memo(()=>{const e=I(Gue),t=z(),[n,s]=u.useState(""),{t:i}=P(),[o,{isLoading:a,data:l}]=pq(),c=u.useCallback(()=>{o({scan_path:e}).unwrap().catch(h=>{h&&s(h.data.detail)})},[o,e]),d=u.useCallback(h=>{t(gq(h.target.value)),s("")},[t]);return r.jsxs(T,{flexDir:"column",height:"100%",gap:3,children:[r.jsxs(Z,{isInvalid:!!n.length,w:"full",orientation:"vertical",flexShrink:0,children:[r.jsx(te,{children:i("common.folder")}),r.jsxs(T,{gap:3,alignItems:"center",w:"full",children:[r.jsx(Ct,{placeholder:i("modelManager.scanPlaceholder"),value:e,onChange:d}),r.jsx(ye,{onClick:c,isLoading:a,isDisabled:e===void 0||e.length===0,size:"sm",flexShrink:0,children:i("modelManager.scanFolder")})]}),r.jsx(Us,{children:i("modelManager.scanFolderHelper")}),!!n.length&&r.jsx(Yf,{children:n})]}),l&&r.jsx(lR,{results:l})]})});cR.displayName="ScanModelsForm";const Al=Oe(0),uR=u.memo(()=>{const{t:e}=P(),t=ce(Al),n=u.useCallback(i=>{Al.set(i)},[]),s=u.useCallback(()=>{window.open("https://support.invoke.ai/support/solutions/articles/151000170961-supported-models")},[]);return r.jsxs(T,{layerStyle:"first",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:4,children:[r.jsxs(T,{alignItems:"center",justifyContent:"space-between",children:[r.jsx(Ot,{fontSize:"xl",children:e("modelManager.addModel")}),r.jsx(ye,{alignItems:"center",variant:"link",leftIcon:r.jsx(Gu,{}),onClick:s,children:r.jsx(K,{variant:"subtext",children:e("modelManager.learnMoreAboutSupportedModels")})})]}),r.jsxs(Vl,{variant:"collapse",height:"50%",display:"flex",flexDir:"column",index:t,onChange:n,children:[r.jsxs(Gl,{children:[r.jsx(Sn,{children:e("modelManager.urlOrLocalPath")}),r.jsx(Sn,{children:e("modelManager.huggingFace")}),r.jsx(Sn,{children:e("modelManager.scanFolder")}),r.jsx(Sn,{children:e("modelManager.starterModels")})]}),r.jsxs(Lu,{p:3,height:"100%",children:[r.jsx(Pn,{children:r.jsx(sR,{})}),r.jsx(Pn,{height:"100%",children:r.jsx(GD,{})}),r.jsx(Pn,{height:"100%",children:r.jsx(cR,{})}),r.jsx(Pn,{height:"100%",children:r.jsx(BD,{})})]})]}),r.jsx(ke,{layerStyle:"second",borderRadius:"base",h:"50%",children:r.jsx(oR,{})})]})});uR.displayName="InstallModels";const zn=(e,t)=>()=>{const n=Zf(void 0);return[u.useMemo(()=>n.data?Ia.selectAll(n.data).filter(i=>e(i,t)):er,[n]),n]},U1=zn(sf),zue=zn(jq),q1=zn(rT),Hue=zn(kq),Wue=zn(_q),Uue=zn(Iq),K1=zn(nT),dR=zn(iM),que=zn(aC),ew=zn(xq),hR=zn(Sq),tw=e=>zn(yq,e==null?void 0:e.excludeSubmodels)(),Xl=e=>zn(vq,e==null?void 0:e.excludeSubmodels)(),Ip=zn(bq),nw=zn(BT),fR=zn(Cq),Z1=e=>zn(sT,e==null?void 0:e.excludeSubmodels)(),pR=e=>zn(mq,e==null?void 0:e.excludeSubmodels)(),Kue=zn(wq),Zue=(e,t)=>ve(oC,n=>n.data?Ia.selectAll(n.data).filter(t).find(s=>s.key===e)??null:null),fm="starterModels",Yue=()=>{const{t:e}=P(),t=un("starterModels"),[n,s]=u.useState(!1),[i,{data:o}]=U1(),a=Gf();u.useEffect(()=>{if(a.isActive(fm)){if(i.length===0)return;a.close(fm)}o&&i.length===0&&!n&&t&&a({id:fm,title:e("modelManager.noModelsInstalled"),description:r.jsx(Xue,{}),status:"info",isClosable:!0,duration:null,onCloseComplete:()=>s(!0)})},[o,n,t,i.length,e,a])},Xue=()=>{const{t:e}=P(),t=z(),n=Gf(),s=u.useCallback(()=>{t(bt("models")),Al.set(3),n.close(fm)},[t,n]);return r.jsxs(K,{fontSize:"md",children:[e("modelManager.noModelsInstalledDesc1")," ",r.jsxs(ye,{onClick:s,variant:"link",color:"base.50",flexGrow:0,children:[e("ui.tabs.modelsTab"),"."]})]})},s0=Oe(null),H5=()=>s0.set(null),Que=()=>u.useCallback(t=>{s0.set(t)},[]),Jue=()=>{wt("ShareWorkflowModal");const e=ce(s0),t=ce(CC),{t:n}=P(),s=Ho(),i=u.useMemo(()=>!e||!t?null:`${window.location.origin}${t}/studio?selectedWorkflowId=${e.workflow_id}`,[t,e]),o=u.useCallback(()=>{i&&(s.writeText(i,()=>{fe({status:"success",title:n("toast.linkCopied")})}),s0.set(null))},[i,s,n]);return r.jsxs(ni,{isOpen:e!==null,onClose:H5,isCentered:!0,size:"lg",useInert:!1,children:[r.jsx(rr,{}),r.jsxs(si,{children:[r.jsx(Tr,{children:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(Ot,{fontSize:"xl",children:n("workflows.copyShareLinkForWorkflow")}),r.jsx(K,{fontSize:"md",children:e==null?void 0:e.name})]})}),r.jsx(lo,{}),r.jsx(ir,{children:r.jsxs(T,{layerStyle:"third",p:4,borderRadius:"base",alignItems:"center",children:[r.jsx(K,{fontWeight:"semibold",children:i}),r.jsx(ae,{variant:"ghost","aria-label":n("common.copy"),tooltip:n("common.copy"),icon:r.jsx(on,{}),onClick:o})]})}),r.jsx(co,{children:r.jsx(ye,{onClick:H5,children:n("common.close")})})]})]})},ede=()=>{const{t:e}=P(),{data:t}=ei(),n=ce(An),[s,{isLoading:i}]=Aq({fixedCacheKey:"cancelAllExceptCurrent"}),o=u.useCallback(async()=>{if(t!=null&&t.queue.pending)try{await s().unwrap(),fe({id:"QUEUE_CANCEL_SUCCEEDED",title:e("queue.cancelSucceeded"),status:"success"})}catch{fe({id:"QUEUE_CANCEL_FAILED",title:e("queue.cancelFailed"),status:"error"})}},[t==null?void 0:t.queue.pending,s,e]),a=u.useMemo(()=>!n||!(t!=null&&t.queue.pending),[n,t==null?void 0:t.queue.pending]);return{cancelAllExceptCurrentQueueItem:o,isLoading:i,queueStatus:t,isDisabled:a}},[tde]=ja(!1),gR=()=>{const e=tde(),{cancelAllExceptCurrentQueueItem:t,isLoading:n,isDisabled:s,queueStatus:i}=ede();return{cancelAllExceptCurrentQueueItem:t,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:n,queueStatus:i,isDisabled:s}},mR=u.memo(()=>{wt("CancelAllExceptCurrentQueueItemConfirmationAlertDialog");const{t:e}=P(),t=gR();return r.jsxs(ti,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.cancelAllExceptCurrentTooltip"),acceptCallback:t.cancelAllExceptCurrentQueueItem,acceptButtonText:e("queue.confirm"),useInert:!1,children:[r.jsx(K,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog")}),r.jsx("br",{}),r.jsx(K,{children:e("queue.cancelAllExceptCurrentQueueItemAlertDialog2")})]})});mR.displayName="CancelAllExceptCurrentQueueItemConfirmationAlertDialog";const[nde]=ja(!1),Ap=()=>{const e=nde(),{clearQueue:t,isLoading:n,isDisabled:s,queueStatus:i}=eE();return{clearQueue:t,isOpen:e.isTrue,openDialog:e.setTrue,closeDialog:e.setFalse,isLoading:n,queueStatus:i,isDisabled:s}},yR=u.memo(()=>{wt("ClearQueueConfirmationsAlertDialog");const{t:e}=P(),t=Ap();return r.jsxs(ti,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.clearTooltip"),acceptCallback:t.clearQueue,acceptButtonText:e("queue.clear"),useInert:!1,children:[r.jsx(K,{children:e("queue.clearQueueAlertDialog")}),r.jsx("br",{}),r.jsx(K,{children:e("queue.clearQueueAlertDialog2")})]})});yR.displayName="ClearQueueConfirmationsAlertDialog";const sw=Oe(null),sde=()=>sw.set(null),rde=()=>u.useCallback(t=>{sw.set(t)},[]),vR=u.memo(()=>{wt("DeleteStylePresetDialog");const{t:e}=P(),t=ce(sw),[n]=Tq(),s=u.useCallback(async()=>{if(t)try{await n(t.id).unwrap(),fe({status:"success",title:e("stylePresets.templateDeleted")})}catch{fe({status:"error",title:e("stylePresets.unableToDeleteTemplate")})}},[t,n,e]);return r.jsx(ti,{isOpen:t!==null,onClose:sde,title:e("stylePresets.deleteTemplate"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:r.jsx(K,{children:e("stylePresets.deleteTemplate2")})})});vR.displayName="DeleteStylePresetDialog";var Iv={exports:{}},Av,W5;function ide(){if(W5)return Av;W5=1;var e="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return Av=e,Av}var Tv,U5;function ode(){if(U5)return Tv;U5=1;var e=ide();function t(){}function n(){}return n.resetWarningCache=t,Tv=function(){function s(a,l,c,d,h,f){if(f!==e){var p=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw p.name="Invariant Violation",p}}s.isRequired=s;function i(){return s}var o={array:s,bigint:s,bool:s,func:s,number:s,object:s,string:s,symbol:s,any:s,arrayOf:i,element:s,elementType:s,instanceOf:i,node:s,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:n,resetWarningCache:t};return o.PropTypes=o,o},Tv}var q5;function ade(){return q5||(q5=1,Iv.exports=ode()()),Iv.exports}var lde=ade();const qt=Au(lde);var $i=function(){return $i=Object.assign||function(t){for(var n,s=1,i=arguments.length;s<i;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},$i.apply(this,arguments)};function bR(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(e);i<s.length;i++)t.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(e,s[i])&&(n[s[i]]=e[s[i]]);return n}function Zu(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})}function Yu(e,t){var n={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},s,i,o,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=l(0),a.throw=l(1),a.return=l(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function l(d){return function(h){return c([d,h])}}function c(d){if(s)throw new TypeError("Generator is already executing.");for(;a&&(a=0,d[0]&&(n=0)),n;)try{if(s=1,i&&(o=d[0]&2?i.return:d[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,d[1])).done)return o;switch(i=0,o&&(d=[d[0]&2,o.value]),d[0]){case 0:case 1:o=d;break;case 4:return n.label++,{value:d[1],done:!1};case 5:n.label++,i=d[1],d=[0];continue;case 7:d=n.ops.pop(),n.trys.pop();continue;default:if(o=n.trys,!(o=o.length>0&&o[o.length-1])&&(d[0]===6||d[0]===2)){n=0;continue}if(d[0]===3&&(!o||d[1]>o[0]&&d[1]<o[3])){n.label=d[1];break}if(d[0]===6&&n.label<o[1]){n.label=o[1],o=d;break}if(o&&n.label<o[2]){n.label=o[2],n.ops.push(d);break}o[2]&&n.ops.pop(),n.trys.pop();continue}d=t.call(e,n)}catch(h){d=[6,h],i=0}finally{s=o=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function K5(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var s=n.call(e),i,o=[],a;try{for(;(t===void 0||t-- >0)&&!(i=s.next()).done;)o.push(i.value)}catch(l){a={error:l}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(a)throw a.error}}return o}function Lx(e,t,n){if(n||arguments.length===2)for(var s=0,i=t.length,o;s<i;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}var cde=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function Tp(e,t){var n=ude(e);if(typeof n.path!="string"){var s=e.webkitRelativePath;Object.defineProperty(n,"path",{value:typeof t=="string"?t:typeof s=="string"&&s.length>0?s:e.name,writable:!1,configurable:!1,enumerable:!0})}return n}function ude(e){var t=e.name,n=t&&t.lastIndexOf(".")!==-1;if(n&&!e.type){var s=t.split(".").pop().toLowerCase(),i=cde.get(s);i&&Object.defineProperty(e,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return e}var dde=[".DS_Store","Thumbs.db"];function hde(e){return Zu(this,void 0,void 0,function(){return Yu(this,function(t){return r0(e)&&fde(e.dataTransfer)?[2,yde(e.dataTransfer,e.type)]:pde(e)?[2,gde(e)]:Array.isArray(e)&&e.every(function(n){return"getFile"in n&&typeof n.getFile=="function"})?[2,mde(e)]:[2,[]]})})}function fde(e){return r0(e)}function pde(e){return r0(e)&&r0(e.target)}function r0(e){return typeof e=="object"&&e!==null}function gde(e){return Dx(e.target.files).map(function(t){return Tp(t)})}function mde(e){return Zu(this,void 0,void 0,function(){var t;return Yu(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(s){return s.getFile()}))];case 1:return t=n.sent(),[2,t.map(function(s){return Tp(s)})]}})})}function yde(e,t){return Zu(this,void 0,void 0,function(){var n,s;return Yu(this,function(i){switch(i.label){case 0:return e.items?(n=Dx(e.items).filter(function(o){return o.kind==="file"}),t!=="drop"?[2,n]:[4,Promise.all(n.map(vde))]):[3,2];case 1:return s=i.sent(),[2,Z5(xR(s))];case 2:return[2,Z5(Dx(e.files).map(function(o){return Tp(o)}))]}})})}function Z5(e){return e.filter(function(t){return dde.indexOf(t.name)===-1})}function Dx(e){if(e===null)return[];for(var t=[],n=0;n<e.length;n++){var s=e[n];t.push(s)}return t}function vde(e){if(typeof e.webkitGetAsEntry!="function")return Y5(e);var t=e.webkitGetAsEntry();return t&&t.isDirectory?CR(t):Y5(e)}function xR(e){return e.reduce(function(t,n){return Lx(Lx([],K5(t),!1),K5(Array.isArray(n)?xR(n):[n]),!1)},[])}function Y5(e){var t=e.getAsFile();if(!t)return Promise.reject("".concat(e," is not a File"));var n=Tp(t);return Promise.resolve(n)}function bde(e){return Zu(this,void 0,void 0,function(){return Yu(this,function(t){return[2,e.isDirectory?CR(e):xde(e)]})})}function CR(e){var t=e.createReader();return new Promise(function(n,s){var i=[];function o(){var a=this;t.readEntries(function(l){return Zu(a,void 0,void 0,function(){var c,d,h;return Yu(this,function(f){switch(f.label){case 0:if(l.length)return[3,5];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Promise.all(i)];case 2:return c=f.sent(),n(c),[3,4];case 3:return d=f.sent(),s(d),[3,4];case 4:return[3,6];case 5:h=Promise.all(l.map(bde)),i.push(h),o(),f.label=6;case 6:return[2]}})})},function(l){s(l)})}o()})}function xde(e){return Zu(this,void 0,void 0,function(){return Yu(this,function(t){return[2,new Promise(function(n,s){e.file(function(i){var o=Tp(i,e.fullPath);n(o)},function(i){s(i)})})]})})}var vg={},X5;function Cde(){return X5||(X5=1,vg.__esModule=!0,vg.default=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),s=e.name||"",i=(e.type||"").toLowerCase(),o=i.replace(/\/.*$/,"");return n.some(function(a){var l=a.trim().toLowerCase();return l.charAt(0)==="."?s.toLowerCase().endsWith(l):l.endsWith("/*")?o===l.replace(/\/.*$/,""):i===l})}return!0}),vg}var Sde=Cde();const Mv=Au(Sde);function Q5(e){return kde(e)||jde(e)||wR(e)||wde()}function wde(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jde(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kde(e){if(Array.isArray(e))return Rx(e)}function J5(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function eI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?J5(Object(n),!0).forEach(function(s){SR(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J5(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function SR(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vf(e,t){return Ade(e)||Ide(e,t)||wR(e,t)||_de()}function _de(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wR(e,t){if(e){if(typeof e=="string")return Rx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Rx(e,t)}}function Rx(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function Ide(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],i=!0,o=!1,a,l;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(s.push(a.value),!(t&&s.length===t));i=!0);}catch(c){o=!0,l=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function Ade(e){if(Array.isArray(e))return e}var Tde=typeof Mv=="function"?Mv:Mv.default,Mde="file-invalid-type",Pde="file-too-large",Ede="file-too-small",Lde="too-many-files",Dde=function(t){t=Array.isArray(t)&&t.length===1?t[0]:t;var n=Array.isArray(t)?"one of ".concat(t.join(", ")):t;return{code:Mde,message:"File type must be ".concat(n)}},tI=function(t){return{code:Pde,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},nI=function(t){return{code:Ede,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},Rde={code:Lde,message:"Too many files"};function jR(e,t){var n=e.type==="application/x-moz-file"||Tde(e,t);return[n,n?null:Dde(t)]}function kR(e,t,n){if(tl(e.size))if(tl(t)&&tl(n)){if(e.size>n)return[!1,tI(n)];if(e.size<t)return[!1,nI(t)]}else{if(tl(t)&&e.size<t)return[!1,nI(t)];if(tl(n)&&e.size>n)return[!1,tI(n)]}return[!0,null]}function tl(e){return e!=null}function Ode(e){var t=e.files,n=e.accept,s=e.minSize,i=e.maxSize,o=e.multiple,a=e.maxFiles,l=e.validator;return!o&&t.length>1||o&&a>=1&&t.length>a?!1:t.every(function(c){var d=jR(c,n),h=vf(d,1),f=h[0],p=kR(c,s,i),g=vf(p,1),m=g[0],y=l?l(c):null;return f&&m&&!y})}function i0(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function bg(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!e.target&&!!e.target.files}function sI(e){e.preventDefault()}function Nde(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function Fde(e){return e.indexOf("Edge/")!==-1}function Bde(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return Nde(e)||Fde(e)}function Mi(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return t.some(function(l){return!i0(s)&&l&&l.apply(void 0,[s].concat(o)),i0(s)})}}function $de(){return"showOpenFilePicker"in window}function Vde(e){if(tl(e)){var t=Object.entries(e).filter(function(n){var s=vf(n,2),i=s[0],o=s[1],a=!0;return _R(i)||(console.warn('Skipped "'.concat(i,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),a=!1),(!Array.isArray(o)||!o.every(IR))&&(console.warn('Skipped "'.concat(i,'" because an invalid file extension was provided.')),a=!1),a}).reduce(function(n,s){var i=vf(s,2),o=i[0],a=i[1];return eI(eI({},n),{},SR({},o,a))},{});return[{description:"Files",accept:t}]}return e}function Gde(e){if(tl(e))return Object.entries(e).reduce(function(t,n){var s=vf(n,2),i=s[0],o=s[1];return[].concat(Q5(t),[i],Q5(o))},[]).filter(function(t){return _R(t)||IR(t)}).join(",")}function zde(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function Hde(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function _R(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}function IR(e){return/^.*\.[\w]+$/.test(e)}var Wde=["children"],Ude=["open"],qde=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],Kde=["refKey","onChange","onClick"];function Zde(e){return Qde(e)||Xde(e)||AR(e)||Yde()}function Yde(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Xde(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Qde(e){if(Array.isArray(e))return Ox(e)}function Pv(e,t){return the(e)||ehe(e,t)||AR(e,t)||Jde()}function Jde(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AR(e,t){if(e){if(typeof e=="string")return Ox(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ox(e,t)}}function Ox(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function ehe(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],i=!0,o=!1,a,l;try{for(n=n.call(e);!(i=(a=n.next()).done)&&(s.push(a.value),!(t&&s.length===t));i=!0);}catch(c){o=!0,l=c}finally{try{!i&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function the(e){if(Array.isArray(e))return e}function rI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?rI(Object(n),!0).forEach(function(s){Nx(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rI(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function Nx(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o0(e,t){if(e==null)return{};var n=nhe(e,t),s,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)s=o[i],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function nhe(e,t){if(e==null)return{};var n={},s=Object.keys(e),i,o;for(o=0;o<s.length;o++)i=s[o],!(t.indexOf(i)>=0)&&(n[i]=e[i]);return n}var rw=u.forwardRef(function(e,t){var n=e.children,s=o0(e,Wde),i=Ra(s),o=i.open,a=o0(i,Ude);return u.useImperativeHandle(t,function(){return{open:o}},[o]),me.createElement(u.Fragment,null,n(mn(mn({},a),{},{open:o})))});rw.displayName="Dropzone";var TR={disabled:!1,getFilesFromEvent:hde,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};rw.defaultProps=TR;rw.propTypes={children:qt.func,accept:qt.objectOf(qt.arrayOf(qt.string)),multiple:qt.bool,preventDropOnDocument:qt.bool,noClick:qt.bool,noKeyboard:qt.bool,noDrag:qt.bool,noDragEventsBubbling:qt.bool,minSize:qt.number,maxSize:qt.number,maxFiles:qt.number,disabled:qt.bool,getFilesFromEvent:qt.func,onFileDialogCancel:qt.func,onFileDialogOpen:qt.func,useFsAccessApi:qt.bool,autoFocus:qt.bool,onDragEnter:qt.func,onDragLeave:qt.func,onDragOver:qt.func,onDrop:qt.func,onDropAccepted:qt.func,onDropRejected:qt.func,onError:qt.func,validator:qt.func};var Fx={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Ra(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=mn(mn({},TR),e),n=t.accept,s=t.disabled,i=t.getFilesFromEvent,o=t.maxSize,a=t.minSize,l=t.multiple,c=t.maxFiles,d=t.onDragEnter,h=t.onDragLeave,f=t.onDragOver,p=t.onDrop,g=t.onDropAccepted,m=t.onDropRejected,y=t.onFileDialogCancel,x=t.onFileDialogOpen,C=t.useFsAccessApi,v=t.autoFocus,b=t.preventDropOnDocument,S=t.noClick,w=t.noKeyboard,j=t.noDrag,E=t.noDragEventsBubbling,A=t.onError,L=t.validator,M=u.useMemo(function(){return Gde(n)},[n]),O=u.useMemo(function(){return Vde(n)},[n]),F=u.useMemo(function(){return typeof x=="function"?x:iI},[x]),_=u.useMemo(function(){return typeof y=="function"?y:iI},[y]),R=u.useRef(null),D=u.useRef(null),$=u.useReducer(she,Fx),G=Pv($,2),ee=G[0],Q=G[1],se=ee.isFocused,ne=ee.isFileDialogActive,H=u.useRef(typeof window<"u"&&window.isSecureContext&&C&&$de()),V=function(){!H.current&&ne&&setTimeout(function(){if(D.current){var Se=D.current.files;Se.length||(Q({type:"closeDialog"}),_())}},300)};u.useEffect(function(){return window.addEventListener("focus",V,!1),function(){window.removeEventListener("focus",V,!1)}},[D,ne,_,H]);var Y=u.useRef([]),W=function(Se){R.current&&R.current.contains(Se.target)||(Se.preventDefault(),Y.current=[])};u.useEffect(function(){return b&&(document.addEventListener("dragover",sI,!1),document.addEventListener("drop",W,!1)),function(){b&&(document.removeEventListener("dragover",sI),document.removeEventListener("drop",W))}},[R,b]),u.useEffect(function(){return!s&&v&&R.current&&R.current.focus(),function(){}},[R,v,s]);var J=u.useCallback(function(le){A?A(le):console.error(le)},[A]),N=u.useCallback(function(le){le.preventDefault(),le.persist(),oe(le),Y.current=[].concat(Zde(Y.current),[le.target]),bg(le)&&Promise.resolve(i(le)).then(function(Se){if(!(i0(le)&&!E)){var Ge=Se.length,Ye=Ge>0&&Ode({files:Se,accept:M,minSize:a,maxSize:o,multiple:l,maxFiles:c,validator:L}),dt=Ge>0&&!Ye;Q({isDragAccept:Ye,isDragReject:dt,isDragActive:!0,type:"setDraggedFiles"}),d&&d(le)}}).catch(function(Se){return J(Se)})},[i,d,J,E,M,a,o,l,c,L]),B=u.useCallback(function(le){le.preventDefault(),le.persist(),oe(le);var Se=bg(le);if(Se&&le.dataTransfer)try{le.dataTransfer.dropEffect="copy"}catch{}return Se&&f&&f(le),!1},[f,E]),U=u.useCallback(function(le){le.preventDefault(),le.persist(),oe(le);var Se=Y.current.filter(function(Ye){return R.current&&R.current.contains(Ye)}),Ge=Se.indexOf(le.target);Ge!==-1&&Se.splice(Ge,1),Y.current=Se,!(Se.length>0)&&(Q({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),bg(le)&&h&&h(le))},[R,h,E]),ie=u.useCallback(function(le,Se){var Ge=[],Ye=[];le.forEach(function(dt){var fn=jR(dt,M),ln=Pv(fn,2),pn=ln[0],Jn=ln[1],js=kR(dt,a,o),gn=Pv(js,2),Ti=gn[0],Yo=gn[1],cs=L?L(dt):null;if(pn&&Ti&&!cs)Ge.push(dt);else{var Ns=[Jn,Yo];cs&&(Ns=Ns.concat(cs)),Ye.push({file:dt,errors:Ns.filter(function(ii){return ii})})}}),(!l&&Ge.length>1||l&&c>=1&&Ge.length>c)&&(Ge.forEach(function(dt){Ye.push({file:dt,errors:[Rde]})}),Ge.splice(0)),Q({acceptedFiles:Ge,fileRejections:Ye,type:"setFiles"}),p&&p(Ge,Ye,Se),Ye.length>0&&m&&m(Ye,Se),Ge.length>0&&g&&g(Ge,Se)},[Q,l,M,a,o,c,p,g,m,L]),ue=u.useCallback(function(le){le.preventDefault(),le.persist(),oe(le),Y.current=[],bg(le)&&Promise.resolve(i(le)).then(function(Se){i0(le)&&!E||ie(Se,le)}).catch(function(Se){return J(Se)}),Q({type:"reset"})},[i,ie,J,E]),be=u.useCallback(function(){if(H.current){Q({type:"openDialog"}),F();var le={multiple:l,types:O};window.showOpenFilePicker(le).then(function(Se){return i(Se)}).then(function(Se){ie(Se,null),Q({type:"closeDialog"})}).catch(function(Se){zde(Se)?(_(Se),Q({type:"closeDialog"})):Hde(Se)?(H.current=!1,D.current?(D.current.value=null,D.current.click()):J(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):J(Se)});return}D.current&&(Q({type:"openDialog"}),F(),D.current.value=null,D.current.click())},[Q,F,_,C,ie,J,O,l]),Te=u.useCallback(function(le){!R.current||!R.current.isEqualNode(le.target)||(le.key===" "||le.key==="Enter"||le.keyCode===32||le.keyCode===13)&&(le.preventDefault(),be())},[R,be]),je=u.useCallback(function(){Q({type:"focus"})},[]),Be=u.useCallback(function(){Q({type:"blur"})},[]),Ze=u.useCallback(function(){S||(Bde()?setTimeout(be,0):be())},[S,be]),De=function(Se){return s?null:Se},q=function(Se){return w?null:De(Se)},re=function(Se){return j?null:De(Se)},oe=function(Se){E&&Se.stopPropagation()},xe=u.useMemo(function(){return function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Se=le.refKey,Ge=Se===void 0?"ref":Se,Ye=le.role,dt=le.onKeyDown,fn=le.onFocus,ln=le.onBlur,pn=le.onClick,Jn=le.onDragEnter,js=le.onDragOver,gn=le.onDragLeave,Ti=le.onDrop,Yo=o0(le,qde);return mn(mn(Nx({onKeyDown:q(Mi(dt,Te)),onFocus:q(Mi(fn,je)),onBlur:q(Mi(ln,Be)),onClick:De(Mi(pn,Ze)),onDragEnter:re(Mi(Jn,N)),onDragOver:re(Mi(js,B)),onDragLeave:re(Mi(gn,U)),onDrop:re(Mi(Ti,ue)),role:typeof Ye=="string"&&Ye!==""?Ye:"presentation"},Ge,R),!s&&!w?{tabIndex:0}:{}),Yo)}},[R,Te,je,Be,Ze,N,B,U,ue,w,j,s]),ge=u.useCallback(function(le){le.stopPropagation()},[]),de=u.useMemo(function(){return function(){var le=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},Se=le.refKey,Ge=Se===void 0?"ref":Se,Ye=le.onChange,dt=le.onClick,fn=o0(le,Kde),ln=Nx({accept:M,multiple:l,type:"file",style:{display:"none"},onChange:De(Mi(Ye,ue)),onClick:De(Mi(dt,ge)),tabIndex:-1},Ge,D);return mn(mn({},ln),fn)}},[D,n,l,ue,s]);return mn(mn({},ee),{},{isFocused:se&&!s,getRootProps:xe,getInputProps:de,rootRef:R,inputRef:D,open:De(be)})}function she(e,t){switch(t.type){case"focus":return mn(mn({},e),{},{isFocused:!0});case"blur":return mn(mn({},e),{},{isFocused:!1});case"openDialog":return mn(mn({},Fx),{},{isFileDialogActive:!0});case"closeDialog":return mn(mn({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return mn(mn({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return mn(mn({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return mn({},Fx);default:return e}}function iI(){}const rhe=e=>{const{field:t}=ls(e),{t:n}=P(),s=u.useCallback(l=>{const c=l[0];c&&t.onChange(c)},[t]),i=u.useCallback(()=>{t.onChange(null)},[t]),{getInputProps:o,getRootProps:a}=Ra({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:s,noDrag:!0,multiple:!1});return t.value?r.jsxs(ke,{position:"relative",flexShrink:0,children:[r.jsx(dn,{src:URL.createObjectURL(t.value),objectFit:"cover",objectPosition:"50% 50%",w:65,h:65,minWidth:65,borderRadius:"base"}),r.jsx(ae,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:i,"aria-label":n("stylePresets.deleteImage"),tooltip:n("stylePresets.deleteImage"),icon:r.jsx(ho,{}),size:"md",variant:"ghost"})]}):r.jsxs(r.Fragment,{children:[r.jsx(Le,{label:n("stylePresets.uploadImage"),children:r.jsx(T,{as:ye,w:65,h:65,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...a(),children:r.jsx(pt,{as:M1,w:8,h:8})})}),r.jsx("input",{...o()})]})},oI=e=>{const{field:t}=ls(e),n=u.useRef(null),{t:s}=P(),i=u.useCallback(c=>{t.onChange(c.target.value)},[t]),o=u.useMemo(()=>t.value,[t.value]),a=u.useCallback(()=>{var c;if(n.current){const d=n.current.selectionStart,h=o.slice(0,d),f=o.slice(d),p=h+gl+f;t.onChange(p)}else t.onChange(o+gl);(c=n.current)==null||c.focus()},[o,t,n]),l=u.useMemo(()=>o==null?void 0:o.includes(gl),[o]);return r.jsxs(Z,{orientation:"vertical",gap:3,children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(te,{children:e.label}),r.jsx(ye,{onClick:a,size:"xs","aria-label":s("stylePresets.insertPlaceholder"),isDisabled:l,children:s("stylePresets.insertPlaceholder")})]}),r.jsx(Zn,{size:"sm",ref:n,value:o,onChange:i})]})},aI=[{label:Ce("stylePresets.private"),value:"user"},{label:Ce("stylePresets.shared"),value:"project"}],ihe=e=>{var a;const{field:t}=ls(e),n=ce(ba),{t:s}=P(),i=u.useCallback(l=>{l&&t.onChange(l.value)},[t]),o=u.useMemo(()=>aI.find(l=>l.value===t.value),[t.value]);return r.jsxs(Z,{orientation:"vertical",maxW:48,isDisabled:((a=n.prefilledFormData)==null?void 0:a.type)==="project",children:[r.jsx(te,{children:s("stylePresets.type")}),r.jsx(Fe,{value:o,options:aI,onChange:i})]})},ohe=({updatingStylePresetId:e,formData:t})=>{const[n,{isLoading:s}]=Mq(),[i,{isLoading:o}]=Pq(),{t:a}=P(),l=I(oM),{handleSubmit:c,control:d,register:h,formState:f}=_p({defaultValues:t||{name:"",positivePrompt:"",negativePrompt:"",image:null,type:"user"},mode:"onChange"}),p=u.useCallback(async g=>{const m={data:{name:g.name,positive_prompt:g.positivePrompt,negative_prompt:g.negativePrompt,type:g.type},image:g.image};try{e?await i({id:e,...m}).unwrap():await n(m).unwrap()}catch{fe({status:"error",title:"Failed to save style preset"})}ba.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[e,i,n]);return r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(T,{alignItems:"center",gap:4,children:[r.jsx(rhe,{control:d,name:"image"}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:a("stylePresets.name")}),r.jsx(Ct,{size:"md",...h("name",{required:!0,minLength:1})})]})]}),r.jsx(oI,{label:a("stylePresets.positivePrompt"),control:d,name:"positivePrompt"}),r.jsx(oI,{label:a("stylePresets.negativePrompt"),control:d,name:"negativePrompt"}),r.jsxs(ke,{children:[r.jsx(K,{variant:"subtext",children:a("stylePresets.promptTemplatesDesc1")}),r.jsx(K,{variant:"subtext",children:r.jsx(Xt,{i18nKey:"stylePresets.promptTemplatesDesc2",components:{Pre:r.jsx(ahe,{})},values:{placeholder:gl}})}),r.jsx(K,{variant:"subtext",children:a("stylePresets.promptTemplatesDesc3")})]}),r.jsxs(T,{justifyContent:"space-between",alignItems:"flex-end",gap:10,children:[l?r.jsx(ihe,{control:d,name:"type"}):r.jsx(nt,{}),r.jsx(ye,{onClick:c(p),isDisabled:!f.isValid,isLoading:s||o,children:a("common.save")})]})]})},ahe=e=>r.jsx(K,{as:"span",fontFamily:"monospace",fontWeight:"semibold",children:e.children}),lhe=()=>{wt("StylePresetModal");const[e,t]=u.useState(null),{t:n}=P(),s=ce(ba),i=u.useMemo(()=>s.updatingStylePresetId?n("stylePresets.updatePromptTemplate"):n("stylePresets.createPromptTemplate"),[s.updatingStylePresetId,n]),o=u.useCallback(()=>{ba.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[]);return u.useEffect(()=>{t(null)},[]),u.useEffect(()=>{(async l=>{if(!l)t(null);else{let c=null;if(l.imageUrl)try{const d=await yD(l.imageUrl);d&&(c=new File([d],"style_preset.png",{type:"image/png"}))}catch{}t({...l,image:c})}})(s.prefilledFormData)},[s.prefilledFormData]),r.jsxs(ni,{isOpen:s.isModalOpen,onClose:o,isCentered:!0,size:"2xl",useInert:!1,children:[r.jsx(rr,{}),r.jsxs(si,{children:[r.jsx(Tr,{children:i}),r.jsx(lo,{}),r.jsx(ir,{display:"flex",flexDir:"column",gap:4,children:!s.prefilledFormData||e?r.jsx(ohe,{updatingStylePresetId:s.updatingStylePresetId,formData:e}):r.jsx(or,{})}),r.jsx(co,{p:2})]})]})},[MR]=ja(!1),che=()=>{wt("RefreshAfterResetModal");const{t:e}=P(),[t,n]=u.useState(3),s=MR();return u.useEffect(()=>{if(!s.isTrue)return;const i=window.setInterval(()=>n(o=>o-1),1e3);return()=>{window.clearInterval(i)}},[s.isTrue]),u.useEffect(()=>{t<=0&&window.location.reload()},[t]),r.jsx(r.Fragment,{children:r.jsxs(ni,{closeOnOverlayClick:!1,isOpen:s.isTrue,onClose:s.setFalse,isCentered:!0,closeOnEsc:!1,useInert:!1,children:[r.jsx(rr,{backdropFilter:"blur(40px)"}),r.jsxs(si,{children:[r.jsx(Tr,{}),r.jsx(ir,{children:r.jsx(T,{justifyContent:"center",children:r.jsx(K,{fontSize:"lg",children:r.jsxs(K,{children:[e("settings.resetComplete")," ",e("settings.reloadingIn")," ",t,"..."]})})})}),r.jsx(co,{})]})]})})},uhe=u.memo(che),PR=[{tKey:"creatingYourFirstImage",link:"https://www.youtube.com/watch?v=jVi2XgSGrfY&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=1&t=29s&pp=iAQB",length:{minutes:6,seconds:0}},{tKey:"usingControlLayersAndReferenceGuides",link:"https://www.youtube.com/watch?v=crgw6bEgyrw&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=2&t=70s&pp=iAQB",length:{minutes:5,seconds:30}},{tKey:"understandingImageToImageAndDenoising",link:"https://www.youtube.com/watch?v=tvj8-0s6S2U&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=3&t=1s&pp=iAQB",length:{minutes:2,seconds:37}},{tKey:"exploringAIModelsAndConceptAdapters",link:"https://www.youtube.com/watch?v=iwBmBQMZ0UA&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=4&pp=iAQB",length:{minutes:8,seconds:52}},{tKey:"creatingAndComposingOnInvokesControlCanvas",link:"https://www.youtube.com/watch?v=O4LaFcYFxlA",length:{minutes:2,seconds:52}},{tKey:"upscaling",link:"https://www.youtube.com/watch?v=OCb19_P0nro&list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO&index=6&t=2s&pp=iAQB",length:{minutes:4,seconds:0}}],dhe=[{tKey:"howDoIGenerateAndSaveToTheGallery",link:"https://youtu.be/Tl-69JvwJ2s?si=dbjmBc1iDAUpE1k5&t=26",length:{minutes:0,seconds:49}},{tKey:"howDoIEditOnTheCanvas",link:"https://youtu.be/Tl-69JvwJ2s?si=U_bFl9HsvSuejbxp&t=76",length:{minutes:0,seconds:58}},{tKey:"howDoIDoImageToImageTransformation",link:"https://youtu.be/Tl-69JvwJ2s?si=fjhTeY-yZ3qsEzEM&t=138",length:{minutes:0,seconds:51}},{tKey:"howDoIUseControlNetsAndControlLayers",link:"https://youtu.be/Tl-69JvwJ2s?si=x5KcYvkHbvR9ifsX&t=192",length:{minutes:1,seconds:41}},{tKey:"howDoIUseGlobalIPAdaptersAndReferenceImages",link:"https://youtu.be/Tl-69JvwJ2s?si=O940rNHiHGKXknK2&t=297",length:{minutes:0,seconds:43}},{tKey:"howDoIUseInpaintMasks",link:"https://youtu.be/Tl-69JvwJ2s?si=3DZhmerkzUmvJJSn&t=345",length:{minutes:1,seconds:9}},{tKey:"howDoIOutpaint",link:"https://youtu.be/Tl-69JvwJ2s?si=IIwkGZLq1PfLf80Q&t=420",length:{minutes:0,seconds:48}}],hhe="https://www.youtube.com/playlist?list=PLvWK1Kc8iXGq_8tWZqnwDVaf9uhlDC09U",ER=u.memo(e=>r.jsx(T,{ps:2,pb:4,position:"sticky",zIndex:1,top:0,bg:"base.800",sx:e.sx,children:r.jsx(Ot,{size:"sm",children:e.title})}));ER.displayName="StickyScrollableHeading";const LR=u.memo(e=>r.jsx(T,{p:4,borderRadius:"base",bg:"base.750",flexDir:"column",gap:4,sx:e.sx,children:e.children}));LR.displayName="StickyScrollableContent";const Ri=u.memo(e=>r.jsxs(T,{flexDir:"column",children:[r.jsx(ER,{title:e.title,sx:e.headingSx}),r.jsx(LR,{sx:e.contentSx,children:e.children})]},e.title));Ri.displayName="StickyScrollable";const iw=ka("system/videoModalLinkClicked"),fhe=ka("system/videoModalOpened"),phe=({minutes:e,seconds:t})=>`${e}:${t.toString().padStart(2,"0")}`,DR=u.memo(({video:e})=>{const{t}=P(),n=z(),{tKey:s,link:i,length:o}=e,a=u.useCallback(()=>{n(iw(t(`supportVideos.videos.${s}.title`)))},[n,t,s]);return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(K,{fontSize:"md",fontWeight:"semibold",children:t(`supportVideos.videos.${s}.title`)}),r.jsx(nt,{}),r.jsx(K,{variant:"subtext",children:phe(o)}),r.jsx(Xs,{fontSize:"sm",href:i,label:t("supportVideos.watch"),onClick:a})]}),r.jsx(K,{fontSize:"md",variant:"subtext",children:t(`supportVideos.videos.${s}.description`)})]})});DR.displayName="VideoCard";const Bx=u.memo(({category:e,videos:t})=>r.jsx(Ri,{title:e,children:t.map((n,s)=>r.jsxs(u.Fragment,{children:[r.jsx(DR,{video:n}),s<PR.length-1&&r.jsx(Et,{})]},`${n.tKey}-${s}`))}));Bx.displayName="VideoCardList";const $x="http://github.com/invoke-ai/InvokeAI",ow="https://discord.gg/ZmtBAhwWhy",lI="https://www.invoke.com/",[RR]=eC(!1),ghe=()=>{const e=z(),t=u.useCallback(()=>{e(iw("Studio session playlist"))},[e]);return r.jsx(Xs,{fontWeight:"semibold",href:hhe,display:"inline-flex",label:"Studio Sessions playlist",onClick:t})},mhe=()=>{const e=z(),t=u.useCallback(()=>{e(iw("Discord"))},[e]);return r.jsx(Xs,{fontWeight:"semibold",href:ow,display:"inline-flex",label:"Discord",onClick:t})},cI={StudioSessionsPlaylistLink:r.jsx(ghe,{}),DiscordLink:r.jsx(mhe,{})},OR=u.memo(()=>{const{t:e}=P(),t=RR();return r.jsxs(ni,{isOpen:t.isOpen,onClose:t.close,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(rr,{}),r.jsxs(si,{maxH:"80vh",h:"80vh",children:[r.jsx(Tr,{bg:"none",children:e("supportVideos.supportVideos")}),r.jsx(lo,{}),r.jsx(ir,{children:r.jsx(Nn,{children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(T,{flexDir:"column",gap:2,pb:2,children:[r.jsx(K,{fontSize:"md",children:r.jsx(Xt,{i18nKey:"supportVideos.studioSessionsDesc1",components:cI})}),r.jsx(K,{fontSize:"md",children:r.jsx(Xt,{i18nKey:"supportVideos.studioSessionsDesc2",components:cI})})]}),r.jsx(Bx,{category:e("supportVideos.gettingStarted"),videos:PR}),r.jsx(Bx,{category:e("supportVideos.controlCanvas"),videos:dhe})]})})}),r.jsx(co,{})]})]})});OR.displayName="VideosModal";const NR=ve(W0,e=>e.language),FR=u.memo(()=>{const{t:e}=P();return I(aM)?r.jsxs(zl,{status:"warning",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(Hl,{}),r.jsx(K0,{children:e("controlLayers.settings.preserveMask.alert")})]}):null});FR.displayName="CanvasAlertsPreserveMask";const Wo=u.memo(e=>{const t=u.useMemo(()=>Eq(e.entityIdentifier),[e.entityIdentifier]);return I(t)?e.children:null});Wo.displayName="CanvasEntityStateGate";const Ql=u.createContext(null),Ke=e=>{const t=u.useContext(Ql);return Re(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),e&&Re(t.type===e,"useEntityIdentifier must be used with the correct type"),t},Mp=u.createContext(null),BR=u.memo(({children:e})=>{const t=Tt(),n=Ke(),s=u.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(Mp.Provider,{value:i,children:e}):null});BR.displayName="RasterLayerAdapterGate";const $R=u.memo(({children:e})=>{const t=Tt(),n=Ke(),s=u.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(Mp.Provider,{value:i,children:e}):null});$R.displayName="ControlLayerAdapterGate";const VR=u.memo(({children:e})=>{const t=Tt(),n=Ke(),s=u.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(Mp.Provider,{value:i,children:e}):null});VR.displayName="InpaintMaskAdapterGate";const GR=u.memo(({children:e})=>{const t=Tt(),n=Ke(),s=u.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),i=u.useMemo(()=>s.get(n.id)??null,[s,n.id]);return i?r.jsx(Mp.Provider,{value:i,children:e}):null}),yhe=e=>{const t=u.useContext(Mp);return Re(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),Re(t.entityIdentifier.type===e,"useEntityIdentifier must be used with the correct type"),t};GR.displayName="RegionalGuidanceAdapterGate";const po=e=>{const t=Tt(),n=u.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),s=u.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),i=u.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),o=u.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot);return u.useMemo(()=>e?e.type==="raster_layer"?s.get(e.id)??null:e.type==="control_layer"?i.get(e.id)??null:e.type==="inpaint_mask"?o.get(e.id)??null:e.type==="regional_guidance"?n.get(e.id)??null:null:null,[i,e,o,s,n])},vhe=e=>{const t=po(e);return Re(t,"useEntityAdapter must be used within a EntityAdapterContext"),t},bhe=e=>ve(Je,t=>{const n=Aa(t,e);return n?n.name:null}),zR=e=>{const t=u.useMemo(()=>bhe(e),[e]);return I(t)},HR=e=>{const{t}=P();return u.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.inpaintMask");case"control_layer":return t("controlLayers.controlLayer");case"raster_layer":return t("controlLayers.rasterLayer");case"reference_image":return t("controlLayers.globalReferenceImage");case"regional_guidance":return t("controlLayers.regionalGuidance");default:Re(!1,"Unexpected entity type")}},[e,t])},WR=e=>{const t=zR(e),n=HR(e.type);return u.useMemo(()=>t||n,[t,n])},aw=e=>{const t=u.useMemo(()=>ve(Je,s=>{switch(e){case"control_layer":return s.controlLayers.isHidden;case"raster_layer":return s.rasterLayers.isHidden;case"inpaint_mask":return s.inpaintMasks.isHidden;case"regional_guidance":return s.regionalGuidance.isHidden;case"reference_image":default:return!1}}),[e]);return I(t)},xhe=Oe(!1),Che=e=>ve(Je,t=>Mr(t,e,"CanvasAlertsSelectedEntityStatusContent").isEnabled),She=e=>ve(Je,t=>Mr(t,e,"CanvasAlertsSelectedEntityStatusContent").isLocked),UR=u.memo(({entityIdentifier:e,adapter:t})=>{var g;const{t:n}=P(),s=WR(e),i=u.useMemo(()=>Che(e),[e]),o=u.useMemo(()=>She(e),[e]),a=I(i),l=I(o),c=aw(e.type),d=ce(((g=t.filterer)==null?void 0:g.$isFiltering)??xhe),h=ce(t.transformer.$isTransforming),f=ce(t.$isEmpty),p=u.useMemo(()=>d?{status:"info",title:n("controlLayers.HUD.entityStatus.isFiltering",{title:s})}:h?{status:"info",title:n("controlLayers.HUD.entityStatus.isTransforming",{title:s})}:f?{status:"info",title:n("controlLayers.HUD.entityStatus.isEmpty",{title:s})}:c?{status:"warning",title:n("controlLayers.HUD.entityStatus.isHidden",{title:s})}:l?{status:"warning",title:n("controlLayers.HUD.entityStatus.isLocked",{title:s})}:a?null:{status:"warning",title:n("controlLayers.HUD.entityStatus.isDisabled",{title:s})},[d,h,f,c,l,a,s,n]);return p?r.jsxs(zl,{status:p.status,borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(Hl,{}),r.jsx(K0,{children:p.title})]}):null});UR.displayName="CanvasAlertsSelectedEntityStatusContent";const qR=u.memo(()=>{const e=I(kn),t=po(e);return!e||!t?null:r.jsx(Wo,{entityIdentifier:e,children:r.jsx(UR,{entityIdentifier:e,adapter:t})})});qR.displayName="CanvasAlertsSelectedEntityStatus";const lw=()=>{const{destination:e}=Lq(void 0,{selectFromResult:({data:t})=>({destination:t?t.destination:null})});return e};function whe(e){if(typeof Proxy>"u")return e;const t=new Map,n=(...s)=>e(...s);return new Proxy(n,{get:(s,i)=>i==="create"?e:(t.has(i)||t.set(i,e(i)),t.get(i))})}function bf(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}const Vx=e=>Array.isArray(e);function KR(e,t){if(!Array.isArray(t))return!1;const n=t.length;if(n!==e.length)return!1;for(let s=0;s<n;s++)if(t[s]!==e[s])return!1;return!0}function xf(e){return typeof e=="string"||Array.isArray(e)}function uI(e){const t=[{},{}];return e==null||e.values.forEach((n,s)=>{t[0][s]=n.get(),t[1][s]=n.getVelocity()}),t}function cw(e,t,n,s){if(typeof t=="function"){const[i,o]=uI(s);t=t(n!==void 0?n:e.custom,i,o)}if(typeof t=="string"&&(t=e.variants&&e.variants[t]),typeof t=="function"){const[i,o]=uI(s);t=t(n!==void 0?n:e.custom,i,o)}return t}function Y1(e,t,n){const s=e.getProps();return cw(s,t,n!==void 0?n:s.custom,e)}const uw=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],dw=["initial",...uw],Pp=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Oa=new Set(Pp),Eo=e=>e*1e3,Lo=e=>e/1e3,jhe={type:"spring",stiffness:500,damping:25,restSpeed:10},khe=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),_he={type:"keyframes",duration:.8},Ihe={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Ahe=(e,{keyframes:t})=>t.length>2?_he:Oa.has(e)?e.startsWith("scale")?khe(t[1]):jhe:Ihe;function hw(e,t){return e[t]||e.default||e}const The={useManualTiming:!1},Mhe=e=>e!==null;function X1(e,{repeat:t,repeatType:n="loop"},s){const i=e.filter(Mhe),o=t&&n!=="loop"&&t%2===1?0:i.length-1;return!o||s===void 0?i[o]:s}const Cs=e=>e;function Phe(e){let t=new Set,n=new Set,s=!1,i=!1;const o=new WeakSet;let a={delta:0,timestamp:0,isProcessing:!1};function l(d){o.has(d)&&(c.schedule(d),e()),d(a)}const c={schedule:(d,h=!1,f=!1)=>{const g=f&&s?t:n;return h&&o.add(d),g.has(d)||g.add(d),d},cancel:d=>{n.delete(d),o.delete(d)},process:d=>{if(a=d,s){i=!0;return}s=!0,[t,n]=[n,t],n.clear(),t.forEach(l),s=!1,i&&(i=!1,c.process(d))}};return c}const xg=["read","resolveKeyframes","update","preRender","render","postRender"],Ehe=40;function ZR(e,t){let n=!1,s=!0;const i={delta:0,timestamp:0,isProcessing:!1},o=()=>n=!0,a=xg.reduce((C,v)=>(C[v]=Phe(o),C),{}),{read:l,resolveKeyframes:c,update:d,preRender:h,render:f,postRender:p}=a,g=()=>{const C=performance.now();n=!1,i.delta=s?1e3/60:Math.max(Math.min(C-i.timestamp,Ehe),1),i.timestamp=C,i.isProcessing=!0,l.process(i),c.process(i),d.process(i),h.process(i),f.process(i),p.process(i),i.isProcessing=!1,n&&t&&(s=!1,e(g))},m=()=>{n=!0,s=!0,i.isProcessing||e(g)};return{schedule:xg.reduce((C,v)=>{const b=a[v];return C[v]=(S,w=!1,j=!1)=>(n||m(),b.schedule(S,w,j)),C},{}),cancel:C=>{for(let v=0;v<xg.length;v++)a[xg[v]].cancel(C)},state:i,steps:a}}const{schedule:Wt,cancel:xa,state:ss,steps:Ev}=ZR(typeof requestAnimationFrame<"u"?requestAnimationFrame:Cs,!0),YR=(e,t,n)=>(((1-3*n+3*t)*e+(3*n-6*t))*e+3*t)*e,Lhe=1e-7,Dhe=12;function Rhe(e,t,n,s,i){let o,a,l=0;do a=t+(n-t)/2,o=YR(a,s,i)-e,o>0?n=a:t=a;while(Math.abs(o)>Lhe&&++l<Dhe);return a}function Ep(e,t,n,s){if(e===t&&n===s)return Cs;const i=o=>Rhe(o,0,1,e,n);return o=>o===0||o===1?o:YR(i(o),t,s)}const XR=e=>t=>t<=.5?e(2*t)/2:(2-e(2*(1-t)))/2,QR=e=>t=>1-e(1-t),JR=Ep(.33,1.53,.69,.99),fw=QR(JR),e7=XR(fw),t7=e=>(e*=2)<1?.5*fw(e):.5*(2-Math.pow(2,-10*(e-1))),pw=e=>1-Math.sin(Math.acos(e)),n7=QR(pw),s7=XR(pw),r7=e=>/^0[^.\s]+$/u.test(e);function Ohe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||r7(e):!0}let i7=Cs;const o7=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e),a7=e=>t=>typeof t=="string"&&t.startsWith(e),l7=a7("--"),Nhe=a7("var(--"),gw=e=>Nhe(e)?Fhe.test(e.split("/*")[0].trim()):!1,Fhe=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Bhe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function $he(e){const t=Bhe.exec(e);if(!t)return[,];const[,n,s,i]=t;return[`--${n??s}`,i]}function c7(e,t,n=1){const[s,i]=$he(e);if(!s)return;const o=window.getComputedStyle(t).getPropertyValue(s);if(o){const a=o.trim();return o7(a)?parseFloat(a):a}return gw(i)?c7(i,t,n+1):i}const Ca=(e,t,n)=>n>t?t:n<e?e:n,Xu={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},Cf={...Xu,transform:e=>Ca(0,1,e)},Cg={...Xu,default:1},Lp=e=>({test:t=>typeof t=="string"&&t.endsWith(e)&&t.split(" ").length===1,parse:parseFloat,transform:t=>`${t}${e}`}),Qo=Lp("deg"),Zi=Lp("%"),Qe=Lp("px"),Vhe=Lp("vh"),Ghe=Lp("vw"),dI={...Zi,parse:e=>Zi.parse(e)/100,transform:e=>Zi.transform(e*100)},zhe=new Set(["width","height","top","left","right","bottom","x","y","translateX","translateY"]),hI=e=>e===Xu||e===Qe,fI=(e,t)=>parseFloat(e.split(", ")[t]),pI=(e,t)=>(n,{transform:s})=>{if(s==="none"||!s)return 0;const i=s.match(/^matrix3d\((.+)\)$/u);if(i)return fI(i[1],t);{const o=s.match(/^matrix\((.+)\)$/u);return o?fI(o[1],e):0}},Hhe=new Set(["x","y","z"]),Whe=Pp.filter(e=>!Hhe.has(e));function Uhe(e){const t=[];return Whe.forEach(n=>{const s=e.getValue(n);s!==void 0&&(t.push([n,s.get()]),s.set(n.startsWith("scale")?1:0))}),t}const Cu={width:({x:e},{paddingLeft:t="0",paddingRight:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),height:({y:e},{paddingTop:t="0",paddingBottom:n="0"})=>e.max-e.min-parseFloat(t)-parseFloat(n),top:(e,{top:t})=>parseFloat(t),left:(e,{left:t})=>parseFloat(t),bottom:({y:e},{top:t})=>parseFloat(t)+(e.max-e.min),right:({x:e},{left:t})=>parseFloat(t)+(e.max-e.min),x:pI(4,13),y:pI(5,14)};Cu.translateX=Cu.x;Cu.translateY=Cu.y;const u7=e=>t=>t.test(e),qhe={test:e=>e==="auto",parse:e=>e},d7=[Xu,Qe,Zi,Qo,Ghe,Vhe,qhe],gI=e=>d7.find(u7(e)),yl=new Set;let Gx=!1,zx=!1;function h7(){if(zx){const e=Array.from(yl).filter(s=>s.needsMeasurement),t=new Set(e.map(s=>s.element)),n=new Map;t.forEach(s=>{const i=Uhe(s);i.length&&(n.set(s,i),s.render())}),e.forEach(s=>s.measureInitialState()),t.forEach(s=>{s.render();const i=n.get(s);i&&i.forEach(([o,a])=>{var l;(l=s.getValue(o))===null||l===void 0||l.set(a)})}),e.forEach(s=>s.measureEndState()),e.forEach(s=>{s.suspendedScrollY!==void 0&&window.scrollTo(0,s.suspendedScrollY)})}zx=!1,Gx=!1,yl.forEach(e=>e.complete()),yl.clear()}function f7(){yl.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(zx=!0)})}function Khe(){f7(),h7()}class mw{constructor(t,n,s,i,o,a=!1){this.isComplete=!1,this.isAsync=!1,this.needsMeasurement=!1,this.isScheduled=!1,this.unresolvedKeyframes=[...t],this.onComplete=n,this.name=s,this.motionValue=i,this.element=o,this.isAsync=a}scheduleResolve(){this.isScheduled=!0,this.isAsync?(yl.add(this),Gx||(Gx=!0,Wt.read(f7),Wt.resolveKeyframes(h7))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:t,name:n,element:s,motionValue:i}=this;for(let o=0;o<t.length;o++)if(t[o]===null)if(o===0){const a=i==null?void 0:i.get(),l=t[t.length-1];if(a!==void 0)t[0]=a;else if(s&&n){const c=s.readValue(n,l);c!=null&&(t[0]=c)}t[0]===void 0&&(t[0]=l),i&&a===void 0&&i.set(t[0])}else t[o]=t[o-1]}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(){this.isComplete=!0,this.onComplete(this.unresolvedKeyframes,this.finalKeyframe),yl.delete(this)}cancel(){this.isComplete||(this.isScheduled=!1,yl.delete(this))}resume(){this.isComplete||this.scheduleResolve()}}const qh=e=>Math.round(e*1e5)/1e5,yw=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Zhe(e){return e==null}const Yhe=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,vw=(e,t)=>n=>!!(typeof n=="string"&&Yhe.test(n)&&n.startsWith(e)||t&&!Zhe(n)&&Object.prototype.hasOwnProperty.call(n,t)),p7=(e,t,n)=>s=>{if(typeof s!="string")return s;const[i,o,a,l]=s.match(yw);return{[e]:parseFloat(i),[t]:parseFloat(o),[n]:parseFloat(a),alpha:l!==void 0?parseFloat(l):1}},Xhe=e=>Ca(0,255,e),Lv={...Xu,transform:e=>Math.round(Xhe(e))},cl={test:vw("rgb","red"),parse:p7("red","green","blue"),transform:({red:e,green:t,blue:n,alpha:s=1})=>"rgba("+Lv.transform(e)+", "+Lv.transform(t)+", "+Lv.transform(n)+", "+qh(Cf.transform(s))+")"};function Qhe(e){let t="",n="",s="",i="";return e.length>5?(t=e.substring(1,3),n=e.substring(3,5),s=e.substring(5,7),i=e.substring(7,9)):(t=e.substring(1,2),n=e.substring(2,3),s=e.substring(3,4),i=e.substring(4,5),t+=t,n+=n,s+=s,i+=i),{red:parseInt(t,16),green:parseInt(n,16),blue:parseInt(s,16),alpha:i?parseInt(i,16)/255:1}}const Hx={test:vw("#"),parse:Qhe,transform:cl.transform},Bc={test:vw("hsl","hue"),parse:p7("hue","saturation","lightness"),transform:({hue:e,saturation:t,lightness:n,alpha:s=1})=>"hsla("+Math.round(e)+", "+Zi.transform(qh(t))+", "+Zi.transform(qh(n))+", "+qh(Cf.transform(s))+")"},hs={test:e=>cl.test(e)||Hx.test(e)||Bc.test(e),parse:e=>cl.test(e)?cl.parse(e):Bc.test(e)?Bc.parse(e):Hx.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?cl.transform(e):Bc.transform(e)},Jhe=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function efe(e){var t,n;return isNaN(e)&&typeof e=="string"&&(((t=e.match(yw))===null||t===void 0?void 0:t.length)||0)+(((n=e.match(Jhe))===null||n===void 0?void 0:n.length)||0)>0}const g7="number",m7="color",tfe="var",nfe="var(",mI="${}",sfe=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function Sf(e){const t=e.toString(),n=[],s={color:[],number:[],var:[]},i=[];let o=0;const l=t.replace(sfe,c=>(hs.test(c)?(s.color.push(o),i.push(m7),n.push(hs.parse(c))):c.startsWith(nfe)?(s.var.push(o),i.push(tfe),n.push(c)):(s.number.push(o),i.push(g7),n.push(parseFloat(c))),++o,mI)).split(mI);return{values:n,split:l,indexes:s,types:i}}function y7(e){return Sf(e).values}function v7(e){const{split:t,types:n}=Sf(e),s=t.length;return i=>{let o="";for(let a=0;a<s;a++)if(o+=t[a],i[a]!==void 0){const l=n[a];l===g7?o+=qh(i[a]):l===m7?o+=hs.transform(i[a]):o+=i[a]}return o}}const rfe=e=>typeof e=="number"?0:e;function ife(e){const t=y7(e);return v7(e)(t.map(rfe))}const Sa={test:efe,parse:y7,createTransformer:v7,getAnimatableNone:ife},ofe=new Set(["brightness","contrast","saturate","opacity"]);function afe(e){const[t,n]=e.slice(0,-1).split("(");if(t==="drop-shadow")return e;const[s]=n.match(yw)||[];if(!s)return e;const i=n.replace(s,"");let o=ofe.has(t)?1:0;return s!==n&&(o*=100),t+"("+o+i+")"}const lfe=/\b([a-z-]*)\(.*?\)/gu,Wx={...Sa,getAnimatableNone:e=>{const t=e.match(lfe);return t?t.map(afe).join(" "):e}},cfe={borderWidth:Qe,borderTopWidth:Qe,borderRightWidth:Qe,borderBottomWidth:Qe,borderLeftWidth:Qe,borderRadius:Qe,radius:Qe,borderTopLeftRadius:Qe,borderTopRightRadius:Qe,borderBottomRightRadius:Qe,borderBottomLeftRadius:Qe,width:Qe,maxWidth:Qe,height:Qe,maxHeight:Qe,top:Qe,right:Qe,bottom:Qe,left:Qe,padding:Qe,paddingTop:Qe,paddingRight:Qe,paddingBottom:Qe,paddingLeft:Qe,margin:Qe,marginTop:Qe,marginRight:Qe,marginBottom:Qe,marginLeft:Qe,backgroundPositionX:Qe,backgroundPositionY:Qe},ufe={rotate:Qo,rotateX:Qo,rotateY:Qo,rotateZ:Qo,scale:Cg,scaleX:Cg,scaleY:Cg,scaleZ:Cg,skew:Qo,skewX:Qo,skewY:Qo,distance:Qe,translateX:Qe,translateY:Qe,translateZ:Qe,x:Qe,y:Qe,z:Qe,perspective:Qe,transformPerspective:Qe,opacity:Cf,originX:dI,originY:dI,originZ:Qe},yI={...Xu,transform:Math.round},bw={...cfe,...ufe,zIndex:yI,size:Qe,fillOpacity:Cf,strokeOpacity:Cf,numOctaves:yI},dfe={...bw,color:hs,backgroundColor:hs,outlineColor:hs,fill:hs,stroke:hs,borderColor:hs,borderTopColor:hs,borderRightColor:hs,borderBottomColor:hs,borderLeftColor:hs,filter:Wx,WebkitFilter:Wx},xw=e=>dfe[e];function b7(e,t){let n=xw(e);return n!==Wx&&(n=Sa),n.getAnimatableNone?n.getAnimatableNone(t):void 0}const hfe=new Set(["auto","none","0"]);function ffe(e,t,n){let s=0,i;for(;s<e.length&&!i;){const o=e[s];typeof o=="string"&&!hfe.has(o)&&Sf(o).values.length&&(i=e[s]),s++}if(i&&n)for(const o of t)e[o]=b7(n,i)}class x7 extends mw{constructor(t,n,s,i,o){super(t,n,s,i,o,!0)}readKeyframes(){const{unresolvedKeyframes:t,element:n,name:s}=this;if(!n||!n.current)return;super.readKeyframes();for(let c=0;c<t.length;c++){let d=t[c];if(typeof d=="string"&&(d=d.trim(),gw(d))){const h=c7(d,n.current);h!==void 0&&(t[c]=h),c===t.length-1&&(this.finalKeyframe=d)}}if(this.resolveNoneKeyframes(),!zhe.has(s)||t.length!==2)return;const[i,o]=t,a=gI(i),l=gI(o);if(a!==l)if(hI(a)&&hI(l))for(let c=0;c<t.length;c++){const d=t[c];typeof d=="string"&&(t[c]=parseFloat(d))}else this.needsMeasurement=!0}resolveNoneKeyframes(){const{unresolvedKeyframes:t,name:n}=this,s=[];for(let i=0;i<t.length;i++)Ohe(t[i])&&s.push(i);s.length&&ffe(t,s,n)}measureInitialState(){const{element:t,unresolvedKeyframes:n,name:s}=this;if(!t||!t.current)return;s==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=Cu[s](t.measureViewportBox(),window.getComputedStyle(t.current)),n[0]=this.measuredOrigin;const i=n[n.length-1];i!==void 0&&t.getValue(s,i).jump(i,!1)}measureEndState(){var t;const{element:n,name:s,unresolvedKeyframes:i}=this;if(!n||!n.current)return;const o=n.getValue(s);o&&o.jump(this.measuredOrigin,!1);const a=i.length-1,l=i[a];i[a]=Cu[s](n.measureViewportBox(),window.getComputedStyle(n.current)),l!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=l),!((t=this.removedTransforms)===null||t===void 0)&&t.length&&this.removedTransforms.forEach(([c,d])=>{n.getValue(c).set(d)}),this.resolveNoneKeyframes()}}function Cw(e){return typeof e=="function"}let pm;function pfe(){pm=void 0}const Yi={now:()=>(pm===void 0&&Yi.set(ss.isProcessing||The.useManualTiming?ss.timestamp:performance.now()),pm),set:e=>{pm=e,queueMicrotask(pfe)}},vI=(e,t)=>t==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Sa.test(e)||e==="0")&&!e.startsWith("url("));function gfe(e){const t=e[0];if(e.length===1)return!0;for(let n=0;n<e.length;n++)if(e[n]!==t)return!0}function mfe(e,t,n,s){const i=e[0];if(i===null)return!1;if(t==="display"||t==="visibility")return!0;const o=e[e.length-1],a=vI(i,t),l=vI(o,t);return!a||!l?!1:gfe(e)||(n==="spring"||Cw(n))&&s}const yfe=40;class C7{constructor({autoplay:t=!0,delay:n=0,type:s="keyframes",repeat:i=0,repeatDelay:o=0,repeatType:a="loop",...l}){this.isStopped=!1,this.hasAttemptedResolve=!1,this.createdAt=Yi.now(),this.options={autoplay:t,delay:n,type:s,repeat:i,repeatDelay:o,repeatType:a,...l},this.updateFinishedPromise()}calcStartTime(){return this.resolvedAt?this.resolvedAt-this.createdAt>yfe?this.resolvedAt:this.createdAt:this.createdAt}get resolved(){return!this._resolved&&!this.hasAttemptedResolve&&Khe(),this._resolved}onKeyframesResolved(t,n){this.resolvedAt=Yi.now(),this.hasAttemptedResolve=!0;const{name:s,type:i,velocity:o,delay:a,onComplete:l,onUpdate:c,isGenerator:d}=this.options;if(!d&&!mfe(t,s,i,o))if(a)this.options.duration=0;else{c==null||c(X1(t,this.options,n)),l==null||l(),this.resolveFinishedPromise();return}const h=this.initPlayback(t,n);h!==!1&&(this._resolved={keyframes:t,finalKeyframe:n,...h},this.onPostResolved())}onPostResolved(){}then(t,n){return this.currentFinishedPromise.then(t,n)}updateFinishedPromise(){this.currentFinishedPromise=new Promise(t=>{this.resolveFinishedPromise=t})}}function S7(e,t){return t?e*(1e3/t):0}const vfe=5;function w7(e,t,n){const s=Math.max(t-vfe,0);return S7(n-e(s),t-s)}const bI=.001,bfe=.01,xfe=10,Cfe=.05,Sfe=1;function wfe({duration:e=800,bounce:t=.25,velocity:n=0,mass:s=1}){let i,o,a=1-t;a=Ca(Cfe,Sfe,a),e=Ca(bfe,xfe,Lo(e)),a<1?(i=d=>{const h=d*a,f=h*e,p=h-n,g=Ux(d,a),m=Math.exp(-f);return bI-p/g*m},o=d=>{const f=d*a*e,p=f*n+n,g=Math.pow(a,2)*Math.pow(d,2)*e,m=Math.exp(-f),y=Ux(Math.pow(d,2),a);return(-i(d)+bI>0?-1:1)*((p-g)*m)/y}):(i=d=>{const h=Math.exp(-d*e),f=(d-n)*e+1;return-.001+h*f},o=d=>{const h=Math.exp(-d*e),f=(n-d)*(e*e);return h*f});const l=5/e,c=kfe(i,o,l);if(e=Eo(e),isNaN(c))return{stiffness:100,damping:10,duration:e};{const d=Math.pow(c,2)*s;return{stiffness:d,damping:a*2*Math.sqrt(s*d),duration:e}}}const jfe=12;function kfe(e,t,n){let s=n;for(let i=1;i<jfe;i++)s=s-e(s)/t(s);return s}function Ux(e,t){return e*Math.sqrt(1-t*t)}const _fe=["duration","bounce"],Ife=["stiffness","damping","mass"];function xI(e,t){return t.some(n=>e[n]!==void 0)}function Afe(e){let t={velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1,...e};if(!xI(e,Ife)&&xI(e,_fe)){const n=wfe(e);t={...t,...n,mass:1},t.isResolvedFromDuration=!0}return t}function j7({keyframes:e,restDelta:t,restSpeed:n,...s}){const i=e[0],o=e[e.length-1],a={done:!1,value:i},{stiffness:l,damping:c,mass:d,duration:h,velocity:f,isResolvedFromDuration:p}=Afe({...s,velocity:-Lo(s.velocity||0)}),g=f||0,m=c/(2*Math.sqrt(l*d)),y=o-i,x=Lo(Math.sqrt(l/d)),C=Math.abs(y)<5;n||(n=C?.01:2),t||(t=C?.005:.5);let v;if(m<1){const b=Ux(x,m);v=S=>{const w=Math.exp(-m*x*S);return o-w*((g+m*x*y)/b*Math.sin(b*S)+y*Math.cos(b*S))}}else if(m===1)v=b=>o-Math.exp(-x*b)*(y+(g+x*y)*b);else{const b=x*Math.sqrt(m*m-1);v=S=>{const w=Math.exp(-m*x*S),j=Math.min(b*S,300);return o-w*((g+m*x*y)*Math.sinh(j)+b*y*Math.cosh(j))/b}}return{calculatedDuration:p&&h||null,next:b=>{const S=v(b);if(p)a.done=b>=h;else{let w=0;m<1&&(w=b===0?Eo(g):w7(v,b,S));const j=Math.abs(w)<=n,E=Math.abs(o-S)<=t;a.done=j&&E}return a.value=a.done?o:S,a}}}function CI({keyframes:e,velocity:t=0,power:n=.8,timeConstant:s=325,bounceDamping:i=10,bounceStiffness:o=500,modifyTarget:a,min:l,max:c,restDelta:d=.5,restSpeed:h}){const f=e[0],p={done:!1,value:f},g=A=>l!==void 0&&A<l||c!==void 0&&A>c,m=A=>l===void 0?c:c===void 0||Math.abs(l-A)<Math.abs(c-A)?l:c;let y=n*t;const x=f+y,C=a===void 0?x:a(x);C!==x&&(y=C-f);const v=A=>-y*Math.exp(-A/s),b=A=>C+v(A),S=A=>{const L=v(A),M=b(A);p.done=Math.abs(L)<=d,p.value=p.done?C:M};let w,j;const E=A=>{g(p.value)&&(w=A,j=j7({keyframes:[p.value,m(p.value)],velocity:w7(b,A,p.value),damping:i,stiffness:o,restDelta:d,restSpeed:h}))};return E(0),{calculatedDuration:null,next:A=>{let L=!1;return!j&&w===void 0&&(L=!0,S(A),E(A)),w!==void 0&&A>=w?j.next(A-w):(!L&&S(A),p)}}}const Tfe=Ep(.42,0,1,1),Mfe=Ep(0,0,.58,1),k7=Ep(.42,0,.58,1),Pfe=e=>Array.isArray(e)&&typeof e[0]!="number",Efe={linear:Cs,easeIn:Tfe,easeInOut:k7,easeOut:Mfe,circIn:pw,circInOut:s7,circOut:n7,backIn:fw,backInOut:e7,backOut:JR,anticipate:t7},SI=e=>{if(Array.isArray(e)){i7(e.length===4);const[t,n,s,i]=e;return Ep(t,n,s,i)}else if(typeof e=="string")return Efe[e];return e},Lfe=(e,t)=>n=>t(e(n)),Do=(...e)=>e.reduce(Lfe),Su=(e,t,n)=>{const s=t-e;return s===0?1:(n-e)/s},bn=(e,t,n)=>e+(t-e)*n;function Dv(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Dfe({hue:e,saturation:t,lightness:n,alpha:s}){e/=360,t/=100,n/=100;let i=0,o=0,a=0;if(!t)i=o=a=n;else{const l=n<.5?n*(1+t):n+t-n*t,c=2*n-l;i=Dv(c,l,e+1/3),o=Dv(c,l,e),a=Dv(c,l,e-1/3)}return{red:Math.round(i*255),green:Math.round(o*255),blue:Math.round(a*255),alpha:s}}function a0(e,t){return n=>n>0?t:e}const Rv=(e,t,n)=>{const s=e*e,i=n*(t*t-s)+s;return i<0?0:Math.sqrt(i)},Rfe=[Hx,cl,Bc],Ofe=e=>Rfe.find(t=>t.test(e));function wI(e){const t=Ofe(e);if(!t)return!1;let n=t.parse(e);return t===Bc&&(n=Dfe(n)),n}const jI=(e,t)=>{const n=wI(e),s=wI(t);if(!n||!s)return a0(e,t);const i={...n};return o=>(i.red=Rv(n.red,s.red,o),i.green=Rv(n.green,s.green,o),i.blue=Rv(n.blue,s.blue,o),i.alpha=bn(n.alpha,s.alpha,o),cl.transform(i))},qx=new Set(["none","hidden"]);function Nfe(e,t){return qx.has(e)?n=>n<=0?e:t:n=>n>=1?t:e}function Ffe(e,t){return n=>bn(e,t,n)}function Sw(e){return typeof e=="number"?Ffe:typeof e=="string"?gw(e)?a0:hs.test(e)?jI:Vfe:Array.isArray(e)?_7:typeof e=="object"?hs.test(e)?jI:Bfe:a0}function _7(e,t){const n=[...e],s=n.length,i=e.map((o,a)=>Sw(o)(o,t[a]));return o=>{for(let a=0;a<s;a++)n[a]=i[a](o);return n}}function Bfe(e,t){const n={...e,...t},s={};for(const i in n)e[i]!==void 0&&t[i]!==void 0&&(s[i]=Sw(e[i])(e[i],t[i]));return i=>{for(const o in s)n[o]=s[o](i);return n}}function $fe(e,t){var n;const s=[],i={color:0,var:0,number:0};for(let o=0;o<t.values.length;o++){const a=t.types[o],l=e.indexes[a][i[a]],c=(n=e.values[l])!==null&&n!==void 0?n:0;s[o]=c,i[a]++}return s}const Vfe=(e,t)=>{const n=Sa.createTransformer(t),s=Sf(e),i=Sf(t);return s.indexes.var.length===i.indexes.var.length&&s.indexes.color.length===i.indexes.color.length&&s.indexes.number.length>=i.indexes.number.length?qx.has(e)&&!i.values.length||qx.has(t)&&!s.values.length?Nfe(e,t):Do(_7($fe(s,i),i.values),n):a0(e,t)};function I7(e,t,n){return typeof e=="number"&&typeof t=="number"&&typeof n=="number"?bn(e,t,n):Sw(e)(e,t)}function Gfe(e,t,n){const s=[],i=n||I7,o=e.length-1;for(let a=0;a<o;a++){let l=i(e[a],e[a+1]);if(t){const c=Array.isArray(t)?t[a]||Cs:t;l=Do(c,l)}s.push(l)}return s}function zfe(e,t,{clamp:n=!0,ease:s,mixer:i}={}){const o=e.length;if(i7(o===t.length),o===1)return()=>t[0];if(o===2&&e[0]===e[1])return()=>t[1];e[0]>e[o-1]&&(e=[...e].reverse(),t=[...t].reverse());const a=Gfe(t,s,i),l=a.length,c=d=>{let h=0;if(l>1)for(;h<e.length-2&&!(d<e[h+1]);h++);const f=Su(e[h],e[h+1],d);return a[h](f)};return n?d=>c(Ca(e[0],e[o-1],d)):c}function Hfe(e,t){const n=e[e.length-1];for(let s=1;s<=t;s++){const i=Su(0,t,s);e.push(bn(n,1,i))}}function Wfe(e){const t=[0];return Hfe(t,e.length-1),t}function Ufe(e,t){return e.map(n=>n*t)}function qfe(e,t){return e.map(()=>t||k7).splice(0,e.length-1)}function l0({duration:e=300,keyframes:t,times:n,ease:s="easeInOut"}){const i=Pfe(s)?s.map(SI):SI(s),o={done:!1,value:t[0]},a=Ufe(n&&n.length===t.length?n:Wfe(t),e),l=zfe(a,t,{ease:Array.isArray(i)?i:qfe(t,i)});return{calculatedDuration:e,next:c=>(o.value=l(c),o.done=c>=e,o)}}const kI=2e4;function Kfe(e){let t=0;const n=50;let s=e.next(t);for(;!s.done&&t<kI;)t+=n,s=e.next(t);return t>=kI?1/0:t}const Zfe=e=>{const t=({timestamp:n})=>e(n);return{start:()=>Wt.update(t,!0),stop:()=>xa(t),now:()=>ss.isProcessing?ss.timestamp:Yi.now()}},Yfe={decay:CI,inertia:CI,tween:l0,keyframes:l0,spring:j7},Xfe=e=>e/100;class ww extends C7{constructor(t){super(t),this.holdTime=null,this.cancelTime=null,this.currentTime=0,this.playbackSpeed=1,this.pendingPlayState="running",this.startTime=null,this.state="idle",this.stop=()=>{if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.teardown();const{onStop:c}=this.options;c&&c()};const{name:n,motionValue:s,element:i,keyframes:o}=this.options,a=(i==null?void 0:i.KeyframeResolver)||mw,l=(c,d)=>this.onKeyframesResolved(c,d);this.resolver=new a(o,l,n,s,i),this.resolver.scheduleResolve()}initPlayback(t){const{type:n="keyframes",repeat:s=0,repeatDelay:i=0,repeatType:o,velocity:a=0}=this.options,l=Cw(n)?n:Yfe[n]||l0;let c,d;l!==l0&&typeof t[0]!="number"&&(c=Do(Xfe,I7(t[0],t[1])),t=[0,100]);const h=l({...this.options,keyframes:t});o==="mirror"&&(d=l({...this.options,keyframes:[...t].reverse(),velocity:-a})),h.calculatedDuration===null&&(h.calculatedDuration=Kfe(h));const{calculatedDuration:f}=h,p=f+i,g=p*(s+1)-i;return{generator:h,mirroredGenerator:d,mapPercentToKeyframes:c,calculatedDuration:f,resolvedDuration:p,totalDuration:g}}onPostResolved(){const{autoplay:t=!0}=this.options;this.play(),this.pendingPlayState==="paused"||!t?this.pause():this.state=this.pendingPlayState}tick(t,n=!1){const{resolved:s}=this;if(!s){const{keyframes:A}=this.options;return{done:!0,value:A[A.length-1]}}const{finalKeyframe:i,generator:o,mirroredGenerator:a,mapPercentToKeyframes:l,keyframes:c,calculatedDuration:d,totalDuration:h,resolvedDuration:f}=s;if(this.startTime===null)return o.next(0);const{delay:p,repeat:g,repeatType:m,repeatDelay:y,onUpdate:x}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,t):this.speed<0&&(this.startTime=Math.min(t-h/this.speed,this.startTime)),n?this.currentTime=t:this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=Math.round(t-this.startTime)*this.speed;const C=this.currentTime-p*(this.speed>=0?1:-1),v=this.speed>=0?C<0:C>h;this.currentTime=Math.max(C,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let b=this.currentTime,S=o;if(g){const A=Math.min(this.currentTime,h)/f;let L=Math.floor(A),M=A%1;!M&&A>=1&&(M=1),M===1&&L--,L=Math.min(L,g+1),!!(L%2)&&(m==="reverse"?(M=1-M,y&&(M-=y/f)):m==="mirror"&&(S=a)),b=Ca(0,1,M)*f}const w=v?{done:!1,value:c[0]}:S.next(b);l&&(w.value=l(w.value));let{done:j}=w;!v&&d!==null&&(j=this.speed>=0?this.currentTime>=h:this.currentTime<=0);const E=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&j);return E&&i!==void 0&&(w.value=X1(c,this.options,i)),x&&x(w.value),E&&this.finish(),w}get duration(){const{resolved:t}=this;return t?Lo(t.calculatedDuration):0}get time(){return Lo(this.currentTime)}set time(t){t=Eo(t),this.currentTime=t,this.holdTime!==null||this.speed===0?this.holdTime=t:this.driver&&(this.startTime=this.driver.now()-t/this.speed)}get speed(){return this.playbackSpeed}set speed(t){const n=this.playbackSpeed!==t;this.playbackSpeed=t,n&&(this.time=Lo(this.currentTime))}play(){if(this.resolver.isScheduled||this.resolver.resume(),!this._resolved){this.pendingPlayState="running";return}if(this.isStopped)return;const{driver:t=Zfe,onPlay:n,startTime:s}=this.options;this.driver||(this.driver=t(o=>this.tick(o))),n&&n();const i=this.driver.now();this.holdTime!==null?this.startTime=i-this.holdTime:this.startTime?this.state==="finished"&&(this.startTime=i):this.startTime=s??this.calcStartTime(),this.state==="finished"&&this.updateFinishedPromise(),this.cancelTime=this.startTime,this.holdTime=null,this.state="running",this.driver.start()}pause(){var t;if(!this._resolved){this.pendingPlayState="paused";return}this.state="paused",this.holdTime=(t=this.currentTime)!==null&&t!==void 0?t:0}complete(){this.state!=="running"&&this.play(),this.pendingPlayState=this.state="finished",this.holdTime=null}finish(){this.teardown(),this.state="finished";const{onComplete:t}=this.options;t&&t()}cancel(){this.cancelTime!==null&&this.tick(this.cancelTime),this.teardown(),this.updateFinishedPromise()}teardown(){this.state="idle",this.stopDriver(),this.resolveFinishedPromise(),this.updateFinishedPromise(),this.startTime=this.cancelTime=null,this.resolver.cancel()}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(t){return this.startTime=0,this.tick(t,!0)}}const A7=new Set(["opacity","clipPath","filter","transform"]),T7=e=>Array.isArray(e)&&typeof e[0]=="number",Qfe=10,Jfe=(e,t)=>{let n="";const s=Math.max(Math.round(t/Qfe),2);for(let i=0;i<s;i++)n+=e(Su(0,s-1,i))+", ";return`linear(${n.substring(0,n.length-2)})`};function jw(e){let t;return()=>(t===void 0&&(t=e()),t)}const epe={linearEasing:void 0};function tpe(e,t){const n=jw(e);return()=>{var s;return(s=epe[t])!==null&&s!==void 0?s:n()}}const c0=tpe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing");function M7(e){return!!(typeof e=="function"&&c0()||!e||typeof e=="string"&&(e in Kx||c0())||T7(e)||Array.isArray(e)&&e.every(M7))}const Dh=([e,t,n,s])=>`cubic-bezier(${e}, ${t}, ${n}, ${s})`,Kx={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Dh([0,.65,.55,1]),circOut:Dh([.55,0,1,.45]),backIn:Dh([.31,.01,.66,-.59]),backOut:Dh([.33,1.53,.69,.99])};function P7(e,t){if(e)return typeof e=="function"&&c0()?Jfe(e,t):T7(e)?Dh(e):Array.isArray(e)?e.map(n=>P7(n,t)||Kx.easeOut):Kx[e]}function npe(e,t,n,{delay:s=0,duration:i=300,repeat:o=0,repeatType:a="loop",ease:l,times:c}={}){const d={[t]:n};c&&(d.offset=c);const h=P7(l,i);return Array.isArray(h)&&(d.easing=h),e.animate(d,{delay:s,duration:i,easing:Array.isArray(h)?"linear":h,fill:"both",iterations:o+1,direction:a==="reverse"?"alternate":"normal"})}function _I(e,t){e.timeline=t,e.onfinish=null}const spe=jw(()=>Object.hasOwnProperty.call(Element.prototype,"animate")),u0=10,rpe=2e4;function ipe(e){return Cw(e.type)||e.type==="spring"||!M7(e.ease)}function ope(e,t){const n=new ww({...t,keyframes:e,repeat:0,delay:0,isGenerator:!0});let s={done:!1,value:e[0]};const i=[];let o=0;for(;!s.done&&o<rpe;)s=n.sample(o),i.push(s.value),o+=u0;return{times:void 0,keyframes:i,duration:o-u0,ease:"linear"}}const E7={anticipate:t7,backInOut:e7,circInOut:s7};function ape(e){return e in E7}class II extends C7{constructor(t){super(t);const{name:n,motionValue:s,element:i,keyframes:o}=this.options;this.resolver=new x7(o,(a,l)=>this.onKeyframesResolved(a,l),n,s,i),this.resolver.scheduleResolve()}initPlayback(t,n){var s;let{duration:i=300,times:o,ease:a,type:l,motionValue:c,name:d,startTime:h}=this.options;if(!(!((s=c.owner)===null||s===void 0)&&s.current))return!1;if(typeof a=="string"&&c0()&&ape(a)&&(a=E7[a]),ipe(this.options)){const{onComplete:p,onUpdate:g,motionValue:m,element:y,...x}=this.options,C=ope(t,x);t=C.keyframes,t.length===1&&(t[1]=t[0]),i=C.duration,o=C.times,a=C.ease,l="keyframes"}const f=npe(c.owner.current,d,t,{...this.options,duration:i,times:o,ease:a});return f.startTime=h??this.calcStartTime(),this.pendingTimeline?(_I(f,this.pendingTimeline),this.pendingTimeline=void 0):f.onfinish=()=>{const{onComplete:p}=this.options;c.set(X1(t,this.options,n)),p&&p(),this.cancel(),this.resolveFinishedPromise()},{animation:f,duration:i,times:o,type:l,ease:a,keyframes:t}}get duration(){const{resolved:t}=this;if(!t)return 0;const{duration:n}=t;return Lo(n)}get time(){const{resolved:t}=this;if(!t)return 0;const{animation:n}=t;return Lo(n.currentTime||0)}set time(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.currentTime=Eo(t)}get speed(){const{resolved:t}=this;if(!t)return 1;const{animation:n}=t;return n.playbackRate}set speed(t){const{resolved:n}=this;if(!n)return;const{animation:s}=n;s.playbackRate=t}get state(){const{resolved:t}=this;if(!t)return"idle";const{animation:n}=t;return n.playState}get startTime(){const{resolved:t}=this;if(!t)return null;const{animation:n}=t;return n.startTime}attachTimeline(t){if(!this._resolved)this.pendingTimeline=t;else{const{resolved:n}=this;if(!n)return Cs;const{animation:s}=n;_I(s,t)}return Cs}play(){if(this.isStopped)return;const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.playState==="finished"&&this.updateFinishedPromise(),n.play()}pause(){const{resolved:t}=this;if(!t)return;const{animation:n}=t;n.pause()}stop(){if(this.resolver.cancel(),this.isStopped=!0,this.state==="idle")return;this.resolveFinishedPromise(),this.updateFinishedPromise();const{resolved:t}=this;if(!t)return;const{animation:n,keyframes:s,duration:i,type:o,ease:a,times:l}=t;if(n.playState==="idle"||n.playState==="finished")return;if(this.time){const{motionValue:d,onUpdate:h,onComplete:f,element:p,...g}=this.options,m=new ww({...g,keyframes:s,duration:i,type:o,ease:a,times:l,isGenerator:!0}),y=Eo(this.time);d.setWithVelocity(m.sample(y-u0).value,m.sample(y).value,u0)}const{onStop:c}=this.options;c&&c(),this.cancel()}complete(){const{resolved:t}=this;t&&t.animation.finish()}cancel(){const{resolved:t}=this;t&&t.animation.cancel()}static supports(t){const{motionValue:n,name:s,repeatDelay:i,repeatType:o,damping:a,type:l}=t;return spe()&&s&&A7.has(s)&&n&&n.owner&&n.owner.current instanceof HTMLElement&&!n.owner.getProps().onUpdate&&!i&&o!=="mirror"&&a!==0&&l!=="inertia"}}const lpe=jw(()=>window.ScrollTimeline!==void 0);class cpe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}then(t,n){return Promise.all(this.animations).then(t).catch(n)}getAll(t){return this.animations[0][t]}setAll(t,n){for(let s=0;s<this.animations.length;s++)this.animations[s][t]=n}attachTimeline(t,n){const s=this.animations.map(i=>lpe()&&i.attachTimeline?i.attachTimeline(t):n(i));return()=>{s.forEach((i,o)=>{i&&i(),this.animations[o].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get startTime(){return this.getAll("startTime")}get duration(){let t=0;for(let n=0;n<this.animations.length;n++)t=Math.max(t,this.animations[n].duration);return t}runAll(t){this.animations.forEach(n=>n[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function upe({when:e,delay:t,delayChildren:n,staggerChildren:s,staggerDirection:i,repeat:o,repeatType:a,repeatDelay:l,from:c,elapsed:d,...h}){return!!Object.keys(h).length}const kw=(e,t,n,s={},i,o)=>a=>{const l=hw(s,e)||{},c=l.delay||s.delay||0;let{elapsed:d=0}=s;d=d-Eo(c);let h={keyframes:Array.isArray(n)?n:[null,n],ease:"easeOut",velocity:t.getVelocity(),...l,delay:-d,onUpdate:p=>{t.set(p),l.onUpdate&&l.onUpdate(p)},onComplete:()=>{a(),l.onComplete&&l.onComplete()},name:e,motionValue:t,element:o?void 0:i};upe(l)||(h={...h,...Ahe(e,h)}),h.duration&&(h.duration=Eo(h.duration)),h.repeatDelay&&(h.repeatDelay=Eo(h.repeatDelay)),h.from!==void 0&&(h.keyframes[0]=h.from);let f=!1;if((h.type===!1||h.duration===0&&!h.repeatDelay)&&(h.duration=0,h.delay===0&&(f=!0)),f&&!o&&t.get()!==void 0){const p=X1(h.keyframes,l);if(p!==void 0)return Wt.update(()=>{h.onUpdate(p),h.onComplete()}),new cpe([])}return!o&&II.supports(h)?new II(h):new ww(h)},dpe=e=>!!(e&&typeof e=="object"&&e.mix&&e.toValue),hpe=e=>Vx(e)?e[e.length-1]||0:e;function _w(e,t){e.indexOf(t)===-1&&e.push(t)}function Iw(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}class Aw{constructor(){this.subscriptions=[]}add(t){return _w(this.subscriptions,t),()=>Iw(this.subscriptions,t)}notify(t,n,s){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](t,n,s);else for(let o=0;o<i;o++){const a=this.subscriptions[o];a&&a(t,n,s)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const AI=30,fpe=e=>!isNaN(parseFloat(e));class ppe{constructor(t,n={}){this.version="11.10.0",this.canTrackVelocity=null,this.events={},this.updateAndNotify=(s,i=!0)=>{const o=Yi.now();this.updatedAt!==o&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(s),this.current!==this.prev&&this.events.change&&this.events.change.notify(this.current),i&&this.events.renderRequest&&this.events.renderRequest.notify(this.current)},this.hasAnimated=!1,this.setCurrent(t),this.owner=n.owner}setCurrent(t){this.current=t,this.updatedAt=Yi.now(),this.canTrackVelocity===null&&t!==void 0&&(this.canTrackVelocity=fpe(this.current))}setPrevFrameValue(t=this.current){this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt}onChange(t){return this.on("change",t)}on(t,n){this.events[t]||(this.events[t]=new Aw);const s=this.events[t].add(n);return t==="change"?()=>{s(),Wt.read(()=>{this.events.change.getSize()||this.stop()})}:s}clearListeners(){for(const t in this.events)this.events[t].clear()}attach(t,n){this.passiveEffect=t,this.stopPassiveEffect=n}set(t,n=!0){!n||!this.passiveEffect?this.updateAndNotify(t,n):this.passiveEffect(t,this.updateAndNotify)}setWithVelocity(t,n,s){this.set(n),this.prev=void 0,this.prevFrameValue=t,this.prevUpdatedAt=this.updatedAt-s}jump(t,n=!0){this.updateAndNotify(t),this.prev=t,this.prevUpdatedAt=this.prevFrameValue=void 0,n&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const t=Yi.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||t-this.updatedAt>AI)return 0;const n=Math.min(this.updatedAt-this.prevUpdatedAt,AI);return S7(parseFloat(this.current)-parseFloat(this.prevFrameValue),n)}start(t){return this.stop(),new Promise(n=>{this.hasAnimated=!0,this.animation=t(n),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function wf(e,t){return new ppe(e,t)}function gpe(e,t,n){e.hasValue(t)?e.getValue(t).set(n):e.addValue(t,wf(n))}function mpe(e,t){const n=Y1(e,t);let{transitionEnd:s={},transition:i={},...o}=n||{};o={...o,...s};for(const a in o){const l=hpe(o[a]);gpe(e,a,l)}}const Q1=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),ype="framerAppearId",L7="data-"+Q1(ype);function D7(e){return e.props[L7]}const ys=e=>!!(e&&e.getVelocity);function vpe(e){return!!(ys(e)&&e.add)}function R7(e){if(Oa.has(e))return"transform";if(A7.has(e))return Q1(e)}function Zx(e,t){var n;if(!e.applyWillChange)return;const s=e.getValue("willChange");if(vpe(s))return s.add(t);!(!((n=e.props.style)===null||n===void 0)&&n.willChange)&&R7(t)&&e.setStaticValue("willChange","transform")}function bpe({protectedKeys:e,needsAnimating:t},n){const s=e.hasOwnProperty(n)&&t[n]!==!0;return t[n]=!1,s}function O7(e,t,{delay:n=0,transitionOverride:s,type:i}={}){var o;let{transition:a=e.getDefaultTransition(),transitionEnd:l,...c}=t;s&&(a=s);const d=[],h=i&&e.animationState&&e.animationState.getState()[i];for(const f in c){const p=e.getValue(f,(o=e.latestValues[f])!==null&&o!==void 0?o:null),g=c[f];if(g===void 0||h&&bpe(h,f))continue;const m={delay:n,...hw(a||{},f)};let y=!1;if(window.MotionHandoffAnimation){const C=D7(e);if(C){const v=window.MotionHandoffAnimation(C,f,Wt);v!==null&&(m.startTime=v,y=!0)}}Zx(e,f),p.start(kw(f,p,g,e.shouldReduceMotion&&Oa.has(f)?{type:!1}:m,e,y));const x=p.animation;x&&d.push(x)}return l&&Promise.all(d).then(()=>{Wt.update(()=>{l&&mpe(e,l)})}),d}function Yx(e,t,n={}){var s;const i=Y1(e,t,n.type==="exit"?(s=e.presenceContext)===null||s===void 0?void 0:s.custom:void 0);let{transition:o=e.getDefaultTransition()||{}}=i||{};n.transitionOverride&&(o=n.transitionOverride);const a=i?()=>Promise.all(O7(e,i,n)):()=>Promise.resolve(),l=e.variantChildren&&e.variantChildren.size?(d=0)=>{const{delayChildren:h=0,staggerChildren:f,staggerDirection:p}=o;return xpe(e,t,h+d,f,p,n)}:()=>Promise.resolve(),{when:c}=o;if(c){const[d,h]=c==="beforeChildren"?[a,l]:[l,a];return d().then(()=>h())}else return Promise.all([a(),l(n.delay)])}function xpe(e,t,n=0,s=0,i=1,o){const a=[],l=(e.variantChildren.size-1)*s,c=i===1?(d=0)=>d*s:(d=0)=>l-d*s;return Array.from(e.variantChildren).sort(Cpe).forEach((d,h)=>{d.notify("AnimationStart",t),a.push(Yx(d,t,{...o,delay:n+c(h)}).then(()=>d.notify("AnimationComplete",t)))}),Promise.all(a)}function Cpe(e,t){return e.sortNodePosition(t)}function Spe(e,t,n={}){e.notify("AnimationStart",t);let s;if(Array.isArray(t)){const i=t.map(o=>Yx(e,o,n));s=Promise.all(i)}else if(typeof t=="string")s=Yx(e,t,n);else{const i=typeof t=="function"?Y1(e,t,n.custom):t;s=Promise.all(O7(e,i,n))}return s.then(()=>{e.notify("AnimationComplete",t)})}const wpe=dw.length;function N7(e){if(!e)return;if(!e.isControllingVariants){const n=e.parent?N7(e.parent)||{}:{};return e.props.initial!==void 0&&(n.initial=e.props.initial),n}const t={};for(let n=0;n<wpe;n++){const s=dw[n],i=e.props[s];(xf(i)||i===!1)&&(t[s]=i)}return t}const jpe=[...uw].reverse(),kpe=uw.length;function _pe(e){return t=>Promise.all(t.map(({animation:n,options:s})=>Spe(e,n,s)))}function Ipe(e){let t=_pe(e),n=TI(),s=!0;const i=c=>(d,h)=>{var f;const p=Y1(e,h,c==="exit"?(f=e.presenceContext)===null||f===void 0?void 0:f.custom:void 0);if(p){const{transition:g,transitionEnd:m,...y}=p;d={...d,...y,...m}}return d};function o(c){t=c(e)}function a(c){const{props:d}=e,h=N7(e.parent)||{},f=[],p=new Set;let g={},m=1/0;for(let x=0;x<kpe;x++){const C=jpe[x],v=n[C],b=d[C]!==void 0?d[C]:h[C],S=xf(b),w=C===c?v.isActive:null;w===!1&&(m=x);let j=b===h[C]&&b!==d[C]&&S;if(j&&s&&e.manuallyAnimateOnMount&&(j=!1),v.protectedKeys={...g},!v.isActive&&w===null||!b&&!v.prevProp||bf(b)||typeof b=="boolean")continue;const E=Ape(v.prevProp,b);let A=E||C===c&&v.isActive&&!j&&S||x>m&&S,L=!1;const M=Array.isArray(b)?b:[b];let O=M.reduce(i(C),{});w===!1&&(O={});const{prevResolvedValues:F={}}=v,_={...F,...O},R=G=>{A=!0,p.has(G)&&(L=!0,p.delete(G)),v.needsAnimating[G]=!0;const ee=e.getValue(G);ee&&(ee.liveStyle=!1)};for(const G in _){const ee=O[G],Q=F[G];if(g.hasOwnProperty(G))continue;let se=!1;Vx(ee)&&Vx(Q)?se=!KR(ee,Q):se=ee!==Q,se?ee!=null?R(G):p.add(G):ee!==void 0&&p.has(G)?R(G):v.protectedKeys[G]=!0}v.prevProp=b,v.prevResolvedValues=O,v.isActive&&(g={...g,...O}),s&&e.blockInitialAnimation&&(A=!1),A&&(!(j&&E)||L)&&f.push(...M.map(G=>({animation:G,options:{type:C}})))}if(p.size){const x={};p.forEach(C=>{const v=e.getBaseTarget(C),b=e.getValue(C);b&&(b.liveStyle=!0),x[C]=v??null}),f.push({animation:x})}let y=!!f.length;return s&&(d.initial===!1||d.initial===d.animate)&&!e.manuallyAnimateOnMount&&(y=!1),s=!1,y?t(f):Promise.resolve()}function l(c,d){var h;if(n[c].isActive===d)return Promise.resolve();(h=e.variantChildren)===null||h===void 0||h.forEach(p=>{var g;return(g=p.animationState)===null||g===void 0?void 0:g.setActive(c,d)}),n[c].isActive=d;const f=a(c);for(const p in n)n[p].protectedKeys={};return f}return{animateChanges:a,setActive:l,setAnimateFunction:o,getState:()=>n,reset:()=>{n=TI(),s=!0}}}function Ape(e,t){return typeof t=="string"?t!==e:Array.isArray(t)?!KR(t,e):!1}function Ka(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function TI(){return{animate:Ka(!0),whileInView:Ka(),whileHover:Ka(),whileTap:Ka(),whileDrag:Ka(),whileFocus:Ka(),exit:Ka()}}class Na{constructor(t){this.isMounted=!1,this.node=t}update(){}}class Tpe extends Na{constructor(t){super(t),t.animationState||(t.animationState=Ipe(t))}updateAnimationControlsSubscription(){const{animate:t}=this.node.getProps();bf(t)&&(this.unmountControls=t.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:t}=this.node.getProps(),{animate:n}=this.node.prevProps||{};t!==n&&this.updateAnimationControlsSubscription()}unmount(){var t;this.node.animationState.reset(),(t=this.unmountControls)===null||t===void 0||t.call(this)}}let Mpe=0;class Ppe extends Na{constructor(){super(...arguments),this.id=Mpe++}update(){if(!this.node.presenceContext)return;const{isPresent:t,onExitComplete:n}=this.node.presenceContext,{isPresent:s}=this.node.prevPresenceContext||{};if(!this.node.animationState||t===s)return;const i=this.node.animationState.setActive("exit",!t);n&&!t&&i.then(()=>n(this.id))}mount(){const{register:t}=this.node.presenceContext||{};t&&(this.unmount=t(this.id))}unmount(){}}const Epe={animation:{Feature:Tpe},exit:{Feature:Ppe}},F7=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1;function J1(e,t="page"){return{point:{x:e[`${t}X`],y:e[`${t}Y`]}}}const Lpe=e=>t=>F7(t)&&e(t,J1(t));function Mo(e,t,n,s={passive:!0}){return e.addEventListener(t,n,s),()=>e.removeEventListener(t,n)}function Ro(e,t,n,s){return Mo(e,t,Lpe(n),s)}const MI=(e,t)=>Math.abs(e-t);function Dpe(e,t){const n=MI(e.x,t.x),s=MI(e.y,t.y);return Math.sqrt(n**2+s**2)}class B7{constructor(t,n,{transformPagePoint:s,contextWindow:i,dragSnapToOrigin:o=!1}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const f=Nv(this.lastMoveEventInfo,this.history),p=this.startEvent!==null,g=Dpe(f.offset,{x:0,y:0})>=3;if(!p&&!g)return;const{point:m}=f,{timestamp:y}=ss;this.history.push({...m,timestamp:y});const{onStart:x,onMove:C}=this.handlers;p||(x&&x(this.lastMoveEvent,f),this.startEvent=this.lastMoveEvent),C&&C(this.lastMoveEvent,f)},this.handlePointerMove=(f,p)=>{this.lastMoveEvent=f,this.lastMoveEventInfo=Ov(p,this.transformPagePoint),Wt.update(this.updatePoint,!0)},this.handlePointerUp=(f,p)=>{this.end();const{onEnd:g,onSessionEnd:m,resumeAnimation:y}=this.handlers;if(this.dragSnapToOrigin&&y&&y(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const x=Nv(f.type==="pointercancel"?this.lastMoveEventInfo:Ov(p,this.transformPagePoint),this.history);this.startEvent&&g&&g(f,x),m&&m(f,x)},!F7(t))return;this.dragSnapToOrigin=o,this.handlers=n,this.transformPagePoint=s,this.contextWindow=i||window;const a=J1(t),l=Ov(a,this.transformPagePoint),{point:c}=l,{timestamp:d}=ss;this.history=[{...c,timestamp:d}];const{onSessionStart:h}=n;h&&h(t,Nv(l,this.history)),this.removeListeners=Do(Ro(this.contextWindow,"pointermove",this.handlePointerMove),Ro(this.contextWindow,"pointerup",this.handlePointerUp),Ro(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(t){this.handlers=t}end(){this.removeListeners&&this.removeListeners(),xa(this.updatePoint)}}function Ov(e,t){return t?{point:t(e.point)}:e}function PI(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Nv({point:e},t){return{point:e,delta:PI(e,$7(t)),offset:PI(e,Rpe(t)),velocity:Ope(t,.1)}}function Rpe(e){return e[0]}function $7(e){return e[e.length-1]}function Ope(e,t){if(e.length<2)return{x:0,y:0};let n=e.length-1,s=null;const i=$7(e);for(;n>=0&&(s=e[n],!(i.timestamp-s.timestamp>Eo(t)));)n--;if(!s)return{x:0,y:0};const o=Lo(i.timestamp-s.timestamp);if(o===0)return{x:0,y:0};const a={x:(i.x-s.x)/o,y:(i.y-s.y)/o};return a.x===1/0&&(a.x=0),a.y===1/0&&(a.y=0),a}function V7(e){let t=null;return()=>{const n=()=>{t=null};return t===null?(t=e,n):!1}}const EI=V7("dragHorizontal"),LI=V7("dragVertical");function G7(e){let t=!1;if(e==="y")t=LI();else if(e==="x")t=EI();else{const n=EI(),s=LI();n&&s?t=()=>{n(),s()}:(n&&n(),s&&s())}return t}function z7(){const e=G7(!0);return e?(e(),!1):!0}function $c(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}const H7=1e-4,Npe=1-H7,Fpe=1+H7,W7=.01,Bpe=0-W7,$pe=0+W7;function Ir(e){return e.max-e.min}function Vpe(e,t,n){return Math.abs(e-t)<=n}function DI(e,t,n,s=.5){e.origin=s,e.originPoint=bn(t.min,t.max,e.origin),e.scale=Ir(n)/Ir(t),e.translate=bn(n.min,n.max,e.origin)-e.originPoint,(e.scale>=Npe&&e.scale<=Fpe||isNaN(e.scale))&&(e.scale=1),(e.translate>=Bpe&&e.translate<=$pe||isNaN(e.translate))&&(e.translate=0)}function Kh(e,t,n,s){DI(e.x,t.x,n.x,s?s.originX:void 0),DI(e.y,t.y,n.y,s?s.originY:void 0)}function RI(e,t,n){e.min=n.min+t.min,e.max=e.min+Ir(t)}function Gpe(e,t,n){RI(e.x,t.x,n.x),RI(e.y,t.y,n.y)}function OI(e,t,n){e.min=t.min-n.min,e.max=e.min+Ir(t)}function Zh(e,t,n){OI(e.x,t.x,n.x),OI(e.y,t.y,n.y)}function zpe(e,{min:t,max:n},s){return t!==void 0&&e<t?e=s?bn(t,e,s.min):Math.max(e,t):n!==void 0&&e>n&&(e=s?bn(n,e,s.max):Math.min(e,n)),e}function NI(e,t,n){return{min:t!==void 0?e.min+t:void 0,max:n!==void 0?e.max+n-(e.max-e.min):void 0}}function Hpe(e,{top:t,left:n,bottom:s,right:i}){return{x:NI(e.x,n,i),y:NI(e.y,t,s)}}function FI(e,t){let n=t.min-e.min,s=t.max-e.max;return t.max-t.min<e.max-e.min&&([n,s]=[s,n]),{min:n,max:s}}function Wpe(e,t){return{x:FI(e.x,t.x),y:FI(e.y,t.y)}}function Upe(e,t){let n=.5;const s=Ir(e),i=Ir(t);return i>s?n=Su(t.min,t.max-s,e.min):s>i&&(n=Su(e.min,e.max-i,t.min)),Ca(0,1,n)}function qpe(e,t){const n={};return t.min!==void 0&&(n.min=t.min-e.min),t.max!==void 0&&(n.max=t.max-e.min),n}const Xx=.35;function Kpe(e=Xx){return e===!1?e=0:e===!0&&(e=Xx),{x:BI(e,"left","right"),y:BI(e,"top","bottom")}}function BI(e,t,n){return{min:$I(e,t),max:$I(e,n)}}function $I(e,t){return typeof e=="number"?e:e[t]||0}const VI=()=>({translate:0,scale:1,origin:0,originPoint:0}),Vc=()=>({x:VI(),y:VI()}),GI=()=>({min:0,max:0}),In=()=>({x:GI(),y:GI()});function Fr(e){return[e("x"),e("y")]}function U7({top:e,left:t,right:n,bottom:s}){return{x:{min:t,max:n},y:{min:e,max:s}}}function Zpe({x:e,y:t}){return{top:t.min,right:e.max,bottom:t.max,left:e.min}}function Ype(e,t){if(!t)return e;const n=t({x:e.left,y:e.top}),s=t({x:e.right,y:e.bottom});return{top:n.y,left:n.x,bottom:s.y,right:s.x}}function Fv(e){return e===void 0||e===1}function Qx({scale:e,scaleX:t,scaleY:n}){return!Fv(e)||!Fv(t)||!Fv(n)}function Ja(e){return Qx(e)||q7(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function q7(e){return zI(e.x)||zI(e.y)}function zI(e){return e&&e!=="0%"}function d0(e,t,n){const s=e-n,i=t*s;return n+i}function HI(e,t,n,s,i){return i!==void 0&&(e=d0(e,i,s)),d0(e,n,s)+t}function Jx(e,t=0,n=1,s,i){e.min=HI(e.min,t,n,s,i),e.max=HI(e.max,t,n,s,i)}function K7(e,{x:t,y:n}){Jx(e.x,t.translate,t.scale,t.originPoint),Jx(e.y,n.translate,n.scale,n.originPoint)}const WI=.999999999999,UI=1.0000000000001;function Xpe(e,t,n,s=!1){const i=n.length;if(!i)return;t.x=t.y=1;let o,a;for(let l=0;l<i;l++){o=n[l],a=o.projectionDelta;const{visualElement:c}=o.options;c&&c.props.style&&c.props.style.display==="contents"||(s&&o.options.layoutScroll&&o.scroll&&o!==o.root&&zc(e,{x:-o.scroll.offset.x,y:-o.scroll.offset.y}),a&&(t.x*=a.x.scale,t.y*=a.y.scale,K7(e,a)),s&&Ja(o.latestValues)&&zc(e,o.latestValues))}t.x<UI&&t.x>WI&&(t.x=1),t.y<UI&&t.y>WI&&(t.y=1)}function Gc(e,t){e.min=e.min+t,e.max=e.max+t}function qI(e,t,n,s,i=.5){const o=bn(e.min,e.max,i);Jx(e,t,n,o,s)}function zc(e,t){qI(e.x,t.x,t.scaleX,t.scale,t.originX),qI(e.y,t.y,t.scaleY,t.scale,t.originY)}function Z7(e,t){return U7(Ype(e.getBoundingClientRect(),t))}function Qpe(e,t,n){const s=Z7(e,n),{scroll:i}=t;return i&&(Gc(s.x,i.offset.x),Gc(s.y,i.offset.y)),s}const Y7=({current:e})=>e?e.ownerDocument.defaultView:null,Jpe=new WeakMap;class ege{constructor(t){this.openGlobalLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=In(),this.visualElement=t}start(t,{snapToCursor:n=!1}={}){const{presenceContext:s}=this.visualElement;if(s&&s.isPresent===!1)return;const i=h=>{const{dragSnapToOrigin:f}=this.getProps();f?this.pauseAnimation():this.stopAnimation(),n&&this.snapToCursor(J1(h,"page").point)},o=(h,f)=>{const{drag:p,dragPropagation:g,onDragStart:m}=this.getProps();if(p&&!g&&(this.openGlobalLock&&this.openGlobalLock(),this.openGlobalLock=G7(p),!this.openGlobalLock))return;this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Fr(x=>{let C=this.getAxisMotionValue(x).get()||0;if(Zi.test(C)){const{projection:v}=this.visualElement;if(v&&v.layout){const b=v.layout.layoutBox[x];b&&(C=Ir(b)*(parseFloat(C)/100))}}this.originPoint[x]=C}),m&&Wt.postRender(()=>m(h,f)),Zx(this.visualElement,"transform");const{animationState:y}=this.visualElement;y&&y.setActive("whileDrag",!0)},a=(h,f)=>{const{dragPropagation:p,dragDirectionLock:g,onDirectionLock:m,onDrag:y}=this.getProps();if(!p&&!this.openGlobalLock)return;const{offset:x}=f;if(g&&this.currentDirection===null){this.currentDirection=tge(x),this.currentDirection!==null&&m&&m(this.currentDirection);return}this.updateAxis("x",f.point,x),this.updateAxis("y",f.point,x),this.visualElement.render(),y&&y(h,f)},l=(h,f)=>this.stop(h,f),c=()=>Fr(h=>{var f;return this.getAnimationState(h)==="paused"&&((f=this.getAxisMotionValue(h).animation)===null||f===void 0?void 0:f.play())}),{dragSnapToOrigin:d}=this.getProps();this.panSession=new B7(t,{onSessionStart:i,onStart:o,onMove:a,onSessionEnd:l,resumeAnimation:c},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:d,contextWindow:Y7(this.visualElement)})}stop(t,n){const s=this.isDragging;if(this.cancel(),!s)return;const{velocity:i}=n;this.startAnimation(i);const{onDragEnd:o}=this.getProps();o&&Wt.postRender(()=>o(t,n))}cancel(){this.isDragging=!1;const{projection:t,animationState:n}=this.visualElement;t&&(t.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:s}=this.getProps();!s&&this.openGlobalLock&&(this.openGlobalLock(),this.openGlobalLock=null),n&&n.setActive("whileDrag",!1)}updateAxis(t,n,s){const{drag:i}=this.getProps();if(!s||!Sg(t,i,this.currentDirection))return;const o=this.getAxisMotionValue(t);let a=this.originPoint[t]+s[t];this.constraints&&this.constraints[t]&&(a=zpe(a,this.constraints[t],this.elastic[t])),o.set(a)}resolveConstraints(){var t;const{dragConstraints:n,dragElastic:s}=this.getProps(),i=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(t=this.visualElement.projection)===null||t===void 0?void 0:t.layout,o=this.constraints;n&&$c(n)?this.constraints||(this.constraints=this.resolveRefConstraints()):n&&i?this.constraints=Hpe(i.layoutBox,n):this.constraints=!1,this.elastic=Kpe(s),o!==this.constraints&&i&&this.constraints&&!this.hasMutatedConstraints&&Fr(a=>{this.constraints!==!1&&this.getAxisMotionValue(a)&&(this.constraints[a]=qpe(i.layoutBox[a],this.constraints[a]))})}resolveRefConstraints(){const{dragConstraints:t,onMeasureDragConstraints:n}=this.getProps();if(!t||!$c(t))return!1;const s=t.current,{projection:i}=this.visualElement;if(!i||!i.layout)return!1;const o=Qpe(s,i.root,this.visualElement.getTransformPagePoint());let a=Wpe(i.layout.layoutBox,o);if(n){const l=n(Zpe(a));this.hasMutatedConstraints=!!l,l&&(a=U7(l))}return a}startAnimation(t){const{drag:n,dragMomentum:s,dragElastic:i,dragTransition:o,dragSnapToOrigin:a,onDragTransitionEnd:l}=this.getProps(),c=this.constraints||{},d=Fr(h=>{if(!Sg(h,n,this.currentDirection))return;let f=c&&c[h]||{};a&&(f={min:0,max:0});const p=i?200:1e6,g=i?40:1e7,m={type:"inertia",velocity:s?t[h]:0,bounceStiffness:p,bounceDamping:g,timeConstant:750,restDelta:1,restSpeed:10,...o,...f};return this.startAxisValueAnimation(h,m)});return Promise.all(d).then(l)}startAxisValueAnimation(t,n){const s=this.getAxisMotionValue(t);return Zx(this.visualElement,t),s.start(kw(t,s,0,n,this.visualElement,!1))}stopAnimation(){Fr(t=>this.getAxisMotionValue(t).stop())}pauseAnimation(){Fr(t=>{var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.pause()})}getAnimationState(t){var n;return(n=this.getAxisMotionValue(t).animation)===null||n===void 0?void 0:n.state}getAxisMotionValue(t){const n=`_drag${t.toUpperCase()}`,s=this.visualElement.getProps(),i=s[n];return i||this.visualElement.getValue(t,(s.initial?s.initial[t]:void 0)||0)}snapToCursor(t){Fr(n=>{const{drag:s}=this.getProps();if(!Sg(n,s,this.currentDirection))return;const{projection:i}=this.visualElement,o=this.getAxisMotionValue(n);if(i&&i.layout){const{min:a,max:l}=i.layout.layoutBox[n];o.set(t[n]-bn(a,l,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:t,dragConstraints:n}=this.getProps(),{projection:s}=this.visualElement;if(!$c(n)||!s||!this.constraints)return;this.stopAnimation();const i={x:0,y:0};Fr(a=>{const l=this.getAxisMotionValue(a);if(l&&this.constraints!==!1){const c=l.get();i[a]=Upe({min:c,max:c},this.constraints[a])}});const{transformTemplate:o}=this.visualElement.getProps();this.visualElement.current.style.transform=o?o({},""):"none",s.root&&s.root.updateScroll(),s.updateLayout(),this.resolveConstraints(),Fr(a=>{if(!Sg(a,t,null))return;const l=this.getAxisMotionValue(a),{min:c,max:d}=this.constraints[a];l.set(bn(c,d,i[a]))})}addListeners(){if(!this.visualElement.current)return;Jpe.set(this.visualElement,this);const t=this.visualElement.current,n=Ro(t,"pointerdown",c=>{const{drag:d,dragListener:h=!0}=this.getProps();d&&h&&this.start(c)}),s=()=>{const{dragConstraints:c}=this.getProps();$c(c)&&c.current&&(this.constraints=this.resolveRefConstraints())},{projection:i}=this.visualElement,o=i.addEventListener("measure",s);i&&!i.layout&&(i.root&&i.root.updateScroll(),i.updateLayout()),Wt.read(s);const a=Mo(window,"resize",()=>this.scalePositionWithinConstraints()),l=i.addEventListener("didUpdate",({delta:c,hasLayoutChanged:d})=>{this.isDragging&&d&&(Fr(h=>{const f=this.getAxisMotionValue(h);f&&(this.originPoint[h]+=c[h].translate,f.set(f.get()+c[h].translate))}),this.visualElement.render())});return()=>{a(),n(),o(),l&&l()}}getProps(){const t=this.visualElement.getProps(),{drag:n=!1,dragDirectionLock:s=!1,dragPropagation:i=!1,dragConstraints:o=!1,dragElastic:a=Xx,dragMomentum:l=!0}=t;return{...t,drag:n,dragDirectionLock:s,dragPropagation:i,dragConstraints:o,dragElastic:a,dragMomentum:l}}}function Sg(e,t,n){return(t===!0||t===e)&&(n===null||n===e)}function tge(e,t=10){let n=null;return Math.abs(e.y)>t?n="y":Math.abs(e.x)>t&&(n="x"),n}class nge extends Na{constructor(t){super(t),this.removeGroupControls=Cs,this.removeListeners=Cs,this.controls=new ege(t)}mount(){const{dragControls:t}=this.node.getProps();t&&(this.removeGroupControls=t.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Cs}unmount(){this.removeGroupControls(),this.removeListeners()}}const KI=e=>(t,n)=>{e&&Wt.postRender(()=>e(t,n))};class sge extends Na{constructor(){super(...arguments),this.removePointerDownListener=Cs}onPointerDown(t){this.session=new B7(t,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:Y7(this.node)})}createPanHandlers(){const{onPanSessionStart:t,onPanStart:n,onPan:s,onPanEnd:i}=this.node.getProps();return{onSessionStart:KI(t),onStart:KI(n),onMove:s,onEnd:(o,a)=>{delete this.session,i&&Wt.postRender(()=>i(o,a))}}}mount(){this.removePointerDownListener=Ro(this.node.current,"pointerdown",t=>this.onPointerDown(t))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const ey=u.createContext(null);function rge(){const e=u.useContext(ey);if(e===null)return[!0,null];const{isPresent:t,onExitComplete:n,register:s}=e,i=u.useId();u.useEffect(()=>s(i),[]);const o=u.useCallback(()=>n&&n(i),[i,n]);return!t&&n?[!1,o]:[!0]}const Tw=u.createContext({}),X7=u.createContext({}),gm={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function ZI(e,t){return t.max===t.min?0:e/(t.max-t.min)*100}const ch={correct:(e,t)=>{if(!t.target)return e;if(typeof e=="string")if(Qe.test(e))e=parseFloat(e);else return e;const n=ZI(e,t.target.x),s=ZI(e,t.target.y);return`${n}% ${s}%`}},ige={correct:(e,{treeScale:t,projectionDelta:n})=>{const s=e,i=Sa.parse(e);if(i.length>5)return s;const o=Sa.createTransformer(e),a=typeof i[0]!="number"?1:0,l=n.x.scale*t.x,c=n.y.scale*t.y;i[0+a]/=l,i[1+a]/=c;const d=bn(l,c,.5);return typeof i[2+a]=="number"&&(i[2+a]/=d),typeof i[3+a]=="number"&&(i[3+a]/=d),o(i)}},h0={};function oge(e){Object.assign(h0,e)}const{schedule:Mw}=ZR(queueMicrotask,!1);class age extends u.Component{componentDidMount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s,layoutId:i}=this.props,{projection:o}=t;oge(lge),o&&(n.group&&n.group.add(o),s&&s.register&&i&&s.register(o),o.root.didUpdate(),o.addEventListener("animationComplete",()=>{this.safeToRemove()}),o.setOptions({...o.options,onExitComplete:()=>this.safeToRemove()})),gm.hasEverUpdated=!0}getSnapshotBeforeUpdate(t){const{layoutDependency:n,visualElement:s,drag:i,isPresent:o}=this.props,a=s.projection;return a&&(a.isPresent=o,i||t.layoutDependency!==n||n===void 0?a.willUpdate():this.safeToRemove(),t.isPresent!==o&&(o?a.promote():a.relegate()||Wt.postRender(()=>{const l=a.getStack();(!l||!l.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:t}=this.props.visualElement;t&&(t.root.didUpdate(),Mw.postRender(()=>{!t.currentAnimation&&t.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:t,layoutGroup:n,switchLayoutGroup:s}=this.props,{projection:i}=t;i&&(i.scheduleCheckAfterUnmount(),n&&n.group&&n.group.remove(i),s&&s.deregister&&s.deregister(i))}safeToRemove(){const{safeToRemove:t}=this.props;t&&t()}render(){return null}}function Q7(e){const[t,n]=rge(),s=u.useContext(Tw);return r.jsx(age,{...e,layoutGroup:s,switchLayoutGroup:u.useContext(X7),isPresent:t,safeToRemove:n})}const lge={borderRadius:{...ch,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:ch,borderTopRightRadius:ch,borderBottomLeftRadius:ch,borderBottomRightRadius:ch,boxShadow:ige},J7=["TopLeft","TopRight","BottomLeft","BottomRight"],cge=J7.length,YI=e=>typeof e=="string"?parseFloat(e):e,XI=e=>typeof e=="number"||Qe.test(e);function uge(e,t,n,s,i,o){i?(e.opacity=bn(0,n.opacity!==void 0?n.opacity:1,dge(s)),e.opacityExit=bn(t.opacity!==void 0?t.opacity:1,0,hge(s))):o&&(e.opacity=bn(t.opacity!==void 0?t.opacity:1,n.opacity!==void 0?n.opacity:1,s));for(let a=0;a<cge;a++){const l=`border${J7[a]}Radius`;let c=QI(t,l),d=QI(n,l);if(c===void 0&&d===void 0)continue;c||(c=0),d||(d=0),c===0||d===0||XI(c)===XI(d)?(e[l]=Math.max(bn(YI(c),YI(d),s),0),(Zi.test(d)||Zi.test(c))&&(e[l]+="%")):e[l]=d}(t.rotate||n.rotate)&&(e.rotate=bn(t.rotate||0,n.rotate||0,s))}function QI(e,t){return e[t]!==void 0?e[t]:e.borderRadius}const dge=e9(0,.5,n7),hge=e9(.5,.95,Cs);function e9(e,t,n){return s=>s<e?0:s>t?1:n(Su(e,t,s))}function JI(e,t){e.min=t.min,e.max=t.max}function Nr(e,t){JI(e.x,t.x),JI(e.y,t.y)}function e6(e,t){e.translate=t.translate,e.scale=t.scale,e.originPoint=t.originPoint,e.origin=t.origin}function t6(e,t,n,s,i){return e-=t,e=d0(e,1/n,s),i!==void 0&&(e=d0(e,1/i,s)),e}function fge(e,t=0,n=1,s=.5,i,o=e,a=e){if(Zi.test(t)&&(t=parseFloat(t),t=bn(a.min,a.max,t/100)-a.min),typeof t!="number")return;let l=bn(o.min,o.max,s);e===o&&(l-=t),e.min=t6(e.min,t,n,l,i),e.max=t6(e.max,t,n,l,i)}function n6(e,t,[n,s,i],o,a){fge(e,t[n],t[s],t[i],t.scale,o,a)}const pge=["x","scaleX","originX"],gge=["y","scaleY","originY"];function s6(e,t,n,s){n6(e.x,t,pge,n?n.x:void 0,s?s.x:void 0),n6(e.y,t,gge,n?n.y:void 0,s?s.y:void 0)}function r6(e){return e.translate===0&&e.scale===1}function t9(e){return r6(e.x)&&r6(e.y)}function i6(e,t){return e.min===t.min&&e.max===t.max}function mge(e,t){return i6(e.x,t.x)&&i6(e.y,t.y)}function o6(e,t){return Math.round(e.min)===Math.round(t.min)&&Math.round(e.max)===Math.round(t.max)}function n9(e,t){return o6(e.x,t.x)&&o6(e.y,t.y)}function a6(e){return Ir(e.x)/Ir(e.y)}function l6(e,t){return e.translate===t.translate&&e.scale===t.scale&&e.originPoint===t.originPoint}class yge{constructor(){this.members=[]}add(t){_w(this.members,t),t.scheduleRender()}remove(t){if(Iw(this.members,t),t===this.prevLead&&(this.prevLead=void 0),t===this.lead){const n=this.members[this.members.length-1];n&&this.promote(n)}}relegate(t){const n=this.members.findIndex(i=>t===i);if(n===0)return!1;let s;for(let i=n;i>=0;i--){const o=this.members[i];if(o.isPresent!==!1){s=o;break}}return s?(this.promote(s),!0):!1}promote(t,n){const s=this.lead;if(t!==s&&(this.prevLead=s,this.lead=t,t.show(),s)){s.instance&&s.scheduleRender(),t.scheduleRender(),t.resumeFrom=s,n&&(t.resumeFrom.preserveOpacity=!0),s.snapshot&&(t.snapshot=s.snapshot,t.snapshot.latestValues=s.animationValues||s.latestValues),t.root&&t.root.isUpdating&&(t.isLayoutDirty=!0);const{crossfade:i}=t.options;i===!1&&s.hide()}}exitAnimationComplete(){this.members.forEach(t=>{const{options:n,resumingFrom:s}=t;n.onExitComplete&&n.onExitComplete(),s&&s.options.onExitComplete&&s.options.onExitComplete()})}scheduleRender(){this.members.forEach(t=>{t.instance&&t.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function vge(e,t,n){let s="";const i=e.x.translate/t.x,o=e.y.translate/t.y,a=(n==null?void 0:n.z)||0;if((i||o||a)&&(s=`translate3d(${i}px, ${o}px, ${a}px) `),(t.x!==1||t.y!==1)&&(s+=`scale(${1/t.x}, ${1/t.y}) `),n){const{transformPerspective:d,rotate:h,rotateX:f,rotateY:p,skewX:g,skewY:m}=n;d&&(s=`perspective(${d}px) ${s}`),h&&(s+=`rotate(${h}deg) `),f&&(s+=`rotateX(${f}deg) `),p&&(s+=`rotateY(${p}deg) `),g&&(s+=`skewX(${g}deg) `),m&&(s+=`skewY(${m}deg) `)}const l=e.x.scale*t.x,c=e.y.scale*t.y;return(l!==1||c!==1)&&(s+=`scale(${l}, ${c})`),s||"none"}const bge=(e,t)=>e.depth-t.depth;class xge{constructor(){this.children=[],this.isDirty=!1}add(t){_w(this.children,t),this.isDirty=!0}remove(t){Iw(this.children,t),this.isDirty=!0}forEach(t){this.isDirty&&this.children.sort(bge),this.isDirty=!1,this.children.forEach(t)}}function mm(e){const t=ys(e)?e.get():e;return dpe(t)?t.toValue():t}function Cge(e,t){const n=Yi.now(),s=({timestamp:i})=>{const o=i-n;o>=t&&(xa(s),e(o-t))};return Wt.read(s,!0),()=>xa(s)}function Sge(e){return e instanceof SVGElement&&e.tagName!=="svg"}function wge(e,t,n){const s=ys(e)?e:wf(e);return s.start(kw("",s,t,n)),s.animation}const el={type:"projectionFrame",totalNodes:0,resolvedTargetDeltas:0,recalculatedProjection:0},Rh=typeof window<"u"&&window.MotionDebug!==void 0,Bv=["","X","Y","Z"],jge={visibility:"hidden"},c6=1e3;let kge=0;function $v(e,t,n,s){const{latestValues:i}=t;i[e]&&(n[e]=i[e],t.setStaticValue(e,0),s&&(s[e]=0))}function s9(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:t}=e.options;if(!t)return;const n=D7(t);if(window.MotionHasOptimisedAnimation(n,"transform")){const{layout:i,layoutId:o}=e.options;window.MotionCancelOptimisedAnimation(n,"transform",Wt,!(i||o))}const{parent:s}=e;s&&!s.hasCheckedOptimisedAppear&&s9(s)}function r9({attachResizeListener:e,defaultParent:t,measureScroll:n,checkIsScrollRoot:s,resetTransform:i}){return class{constructor(a={},l=t==null?void 0:t()){this.id=kge++,this.animationId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,Rh&&(el.totalNodes=el.resolvedTargetDeltas=el.recalculatedProjection=0),this.nodes.forEach(Age),this.nodes.forEach(Lge),this.nodes.forEach(Dge),this.nodes.forEach(Tge),Rh&&window.MotionDebug.record(el)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=a,this.root=l?l.root||l:this,this.path=l?[...l.path,l]:[],this.parent=l,this.depth=l?l.depth+1:0;for(let c=0;c<this.path.length;c++)this.path[c].shouldResetTransform=!0;this.root===this&&(this.nodes=new xge)}addEventListener(a,l){return this.eventHandlers.has(a)||this.eventHandlers.set(a,new Aw),this.eventHandlers.get(a).add(l)}notifyListeners(a,...l){const c=this.eventHandlers.get(a);c&&c.notify(...l)}hasListeners(a){return this.eventHandlers.has(a)}mount(a,l=this.root.hasTreeAnimated){if(this.instance)return;this.isSVG=Sge(a),this.instance=a;const{layoutId:c,layout:d,visualElement:h}=this.options;if(h&&!h.current&&h.mount(a),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),l&&(d||c)&&(this.isLayoutDirty=!0),e){let f;const p=()=>this.root.updateBlockedByResize=!1;e(a,()=>{this.root.updateBlockedByResize=!0,f&&f(),f=Cge(p,250),gm.hasAnimatedSinceResize&&(gm.hasAnimatedSinceResize=!1,this.nodes.forEach(d6))})}c&&this.root.registerSharedNode(c,this),this.options.animate!==!1&&h&&(c||d)&&this.addEventListener("didUpdate",({delta:f,hasLayoutChanged:p,hasRelativeTargetChanged:g,layout:m})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const y=this.options.transition||h.getDefaultTransition()||Bge,{onLayoutAnimationStart:x,onLayoutAnimationComplete:C}=h.getProps(),v=!this.targetLayout||!n9(this.targetLayout,m)||g,b=!p&&g;if(this.options.layoutRoot||this.resumeFrom&&this.resumeFrom.instance||b||p&&(v||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0),this.setAnimationOrigin(f,b);const S={...hw(y,"layout"),onPlay:x,onComplete:C};(h.shouldReduceMotion||this.options.layoutRoot)&&(S.delay=0,S.type=!1),this.startAnimation(S)}else p||d6(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=m})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const a=this.getStack();a&&a.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,xa(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Rge),this.animationId++)}getTransformTemplate(){const{visualElement:a}=this.options;return a&&a.getProps().transformTemplate}willUpdate(a=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&s9(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let h=0;h<this.path.length;h++){const f=this.path[h];f.shouldResetTransform=!0,f.updateScroll("snapshot"),f.options.layoutRoot&&f.willUpdate(!1)}const{layoutId:l,layout:c}=this.options;if(l===void 0&&!c)return;const d=this.getTransformTemplate();this.prevTransformTemplateValue=d?d(this.latestValues,""):void 0,this.updateSnapshot(),a&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(u6);return}this.isUpdating||this.nodes.forEach(Pge),this.isUpdating=!1,this.nodes.forEach(Ege),this.nodes.forEach(_ge),this.nodes.forEach(Ige),this.clearAllSnapshots();const l=Yi.now();ss.delta=Ca(0,1e3/60,l-ss.timestamp),ss.timestamp=l,ss.isProcessing=!0,Ev.update.process(ss),Ev.preRender.process(ss),Ev.render.process(ss),ss.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,Mw.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(Mge),this.sharedNodes.forEach(Oge)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Wt.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Wt.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure())}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let c=0;c<this.path.length;c++)this.path[c].updateScroll();const a=this.layout;this.layout=this.measure(!1),this.layoutCorrected=In(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:l}=this.options;l&&l.notify("LayoutMeasure",this.layout.layoutBox,a?a.layoutBox:void 0)}updateScroll(a="measure"){let l=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===a&&(l=!1),l){const c=s(this.instance);this.scroll={animationId:this.root.animationId,phase:a,isRoot:c,offset:n(this.instance),wasRoot:this.scroll?this.scroll.isRoot:c}}}resetTransform(){if(!i)return;const a=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,l=this.projectionDelta&&!t9(this.projectionDelta),c=this.getTransformTemplate(),d=c?c(this.latestValues,""):void 0,h=d!==this.prevTransformTemplateValue;a&&(l||Ja(this.latestValues)||h)&&(i(this.instance,d),this.shouldResetTransform=!1,this.scheduleRender())}measure(a=!0){const l=this.measurePageBox();let c=this.removeElementScroll(l);return a&&(c=this.removeTransform(c)),$ge(c),{animationId:this.root.animationId,measuredBox:l,layoutBox:c,latestValues:{},source:this.id}}measurePageBox(){var a;const{visualElement:l}=this.options;if(!l)return In();const c=l.measureViewportBox();if(!(((a=this.scroll)===null||a===void 0?void 0:a.wasRoot)||this.path.some(Vge))){const{scroll:h}=this.root;h&&(Gc(c.x,h.offset.x),Gc(c.y,h.offset.y))}return c}removeElementScroll(a){var l;const c=In();if(Nr(c,a),!((l=this.scroll)===null||l===void 0)&&l.wasRoot)return c;for(let d=0;d<this.path.length;d++){const h=this.path[d],{scroll:f,options:p}=h;h!==this.root&&f&&p.layoutScroll&&(f.wasRoot&&Nr(c,a),Gc(c.x,f.offset.x),Gc(c.y,f.offset.y))}return c}applyTransform(a,l=!1){const c=In();Nr(c,a);for(let d=0;d<this.path.length;d++){const h=this.path[d];!l&&h.options.layoutScroll&&h.scroll&&h!==h.root&&zc(c,{x:-h.scroll.offset.x,y:-h.scroll.offset.y}),Ja(h.latestValues)&&zc(c,h.latestValues)}return Ja(this.latestValues)&&zc(c,this.latestValues),c}removeTransform(a){const l=In();Nr(l,a);for(let c=0;c<this.path.length;c++){const d=this.path[c];if(!d.instance||!Ja(d.latestValues))continue;Qx(d.latestValues)&&d.updateSnapshot();const h=In(),f=d.measurePageBox();Nr(h,f),s6(l,d.latestValues,d.snapshot?d.snapshot.layoutBox:void 0,h)}return Ja(this.latestValues)&&s6(l,this.latestValues),l}setTargetDelta(a){this.targetDelta=a,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(a){this.options={...this.options,...a,crossfade:a.crossfade!==void 0?a.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ss.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(a=!1){var l;const c=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=c.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=c.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=c.isSharedProjectionDirty);const d=!!this.resumingFrom||this!==c;if(!(a||d&&this.isSharedProjectionDirty||this.isProjectionDirty||!((l=this.parent)===null||l===void 0)&&l.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:f,layoutId:p}=this.options;if(!(!this.layout||!(f||p))){if(this.resolvedRelativeTargetAt=ss.timestamp,!this.targetDelta&&!this.relativeTarget){const g=this.getClosestProjectingParent();g&&g.layout&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=In(),this.relativeTargetOrigin=In(),Zh(this.relativeTargetOrigin,this.layout.layoutBox,g.layout.layoutBox),Nr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)){if(this.target||(this.target=In(),this.targetWithTransforms=In()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),Gpe(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Nr(this.target,this.layout.layoutBox),K7(this.target,this.targetDelta)):Nr(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget){this.attemptToResolveRelativeTarget=!1;const g=this.getClosestProjectingParent();g&&!!g.resumingFrom==!!this.resumingFrom&&!g.options.layoutScroll&&g.target&&this.animationProgress!==1?(this.relativeParent=g,this.forceRelativeParentToResolveTarget(),this.relativeTarget=In(),this.relativeTargetOrigin=In(),Zh(this.relativeTargetOrigin,this.target,g.target),Nr(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}Rh&&el.resolvedTargetDeltas++}}}getClosestProjectingParent(){if(!(!this.parent||Qx(this.parent.latestValues)||q7(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var a;const l=this.getLead(),c=!!this.resumingFrom||this!==l;let d=!0;if((this.isProjectionDirty||!((a=this.parent)===null||a===void 0)&&a.isProjectionDirty)&&(d=!1),c&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(d=!1),this.resolvedRelativeTargetAt===ss.timestamp&&(d=!1),d)return;const{layout:h,layoutId:f}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(h||f))return;Nr(this.layoutCorrected,this.layout.layoutBox);const p=this.treeScale.x,g=this.treeScale.y;Xpe(this.layoutCorrected,this.treeScale,this.path,c),l.layout&&!l.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(l.target=l.layout.layoutBox,l.targetWithTransforms=In());const{target:m}=l;if(!m){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(e6(this.prevProjectionDelta.x,this.projectionDelta.x),e6(this.prevProjectionDelta.y,this.projectionDelta.y)),Kh(this.projectionDelta,this.layoutCorrected,m,this.latestValues),(this.treeScale.x!==p||this.treeScale.y!==g||!l6(this.projectionDelta.x,this.prevProjectionDelta.x)||!l6(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",m)),Rh&&el.recalculatedProjection++}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(a=!0){var l;if((l=this.options.visualElement)===null||l===void 0||l.scheduleRender(),a){const c=this.getStack();c&&c.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=Vc(),this.projectionDelta=Vc(),this.projectionDeltaWithTransform=Vc()}setAnimationOrigin(a,l=!1){const c=this.snapshot,d=c?c.latestValues:{},h={...this.latestValues},f=Vc();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!l;const p=In(),g=c?c.source:void 0,m=this.layout?this.layout.source:void 0,y=g!==m,x=this.getStack(),C=!x||x.members.length<=1,v=!!(y&&!C&&this.options.crossfade===!0&&!this.path.some(Fge));this.animationProgress=0;let b;this.mixTargetDelta=S=>{const w=S/1e3;h6(f.x,a.x,w),h6(f.y,a.y,w),this.setTargetDelta(f),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(Zh(p,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Nge(this.relativeTarget,this.relativeTargetOrigin,p,w),b&&mge(this.relativeTarget,b)&&(this.isProjectionDirty=!1),b||(b=In()),Nr(b,this.relativeTarget)),y&&(this.animationValues=h,uge(h,d,this.latestValues,w,v,C)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=w},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(a){this.notifyListeners("animationStart"),this.currentAnimation&&this.currentAnimation.stop(),this.resumingFrom&&this.resumingFrom.currentAnimation&&this.resumingFrom.currentAnimation.stop(),this.pendingAnimation&&(xa(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Wt.update(()=>{gm.hasAnimatedSinceResize=!0,this.currentAnimation=wge(0,c6,{...a,onUpdate:l=>{this.mixTargetDelta(l),a.onUpdate&&a.onUpdate(l)},onComplete:()=>{a.onComplete&&a.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const a=this.getStack();a&&a.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(c6),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const a=this.getLead();let{targetWithTransforms:l,target:c,layout:d,latestValues:h}=a;if(!(!l||!c||!d)){if(this!==a&&this.layout&&d&&i9(this.options.animationType,this.layout.layoutBox,d.layoutBox)){c=this.target||In();const f=Ir(this.layout.layoutBox.x);c.x.min=a.target.x.min,c.x.max=c.x.min+f;const p=Ir(this.layout.layoutBox.y);c.y.min=a.target.y.min,c.y.max=c.y.min+p}Nr(l,c),zc(l,h),Kh(this.projectionDeltaWithTransform,this.layoutCorrected,l,h)}}registerSharedNode(a,l){this.sharedNodes.has(a)||this.sharedNodes.set(a,new yge),this.sharedNodes.get(a).add(l);const d=l.options.initialPromotionConfig;l.promote({transition:d?d.transition:void 0,preserveFollowOpacity:d&&d.shouldPreserveFollowOpacity?d.shouldPreserveFollowOpacity(l):void 0})}isLead(){const a=this.getStack();return a?a.lead===this:!0}getLead(){var a;const{layoutId:l}=this.options;return l?((a=this.getStack())===null||a===void 0?void 0:a.lead)||this:this}getPrevLead(){var a;const{layoutId:l}=this.options;return l?(a=this.getStack())===null||a===void 0?void 0:a.prevLead:void 0}getStack(){const{layoutId:a}=this.options;if(a)return this.root.sharedNodes.get(a)}promote({needsReset:a,transition:l,preserveFollowOpacity:c}={}){const d=this.getStack();d&&d.promote(this,c),a&&(this.projectionDelta=void 0,this.needsReset=!0),l&&this.setOptions({transition:l})}relegate(){const a=this.getStack();return a?a.relegate(this):!1}resetSkewAndRotation(){const{visualElement:a}=this.options;if(!a)return;let l=!1;const{latestValues:c}=a;if((c.z||c.rotate||c.rotateX||c.rotateY||c.rotateZ||c.skewX||c.skewY)&&(l=!0),!l)return;const d={};c.z&&$v("z",a,d,this.animationValues);for(let h=0;h<Bv.length;h++)$v(`rotate${Bv[h]}`,a,d,this.animationValues),$v(`skew${Bv[h]}`,a,d,this.animationValues);a.render();for(const h in d)a.setStaticValue(h,d[h]),this.animationValues&&(this.animationValues[h]=d[h]);a.scheduleRender()}getProjectionStyles(a){var l,c;if(!this.instance||this.isSVG)return;if(!this.isVisible)return jge;const d={visibility:""},h=this.getTransformTemplate();if(this.needsReset)return this.needsReset=!1,d.opacity="",d.pointerEvents=mm(a==null?void 0:a.pointerEvents)||"",d.transform=h?h(this.latestValues,""):"none",d;const f=this.getLead();if(!this.projectionDelta||!this.layout||!f.target){const y={};return this.options.layoutId&&(y.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,y.pointerEvents=mm(a==null?void 0:a.pointerEvents)||""),this.hasProjected&&!Ja(this.latestValues)&&(y.transform=h?h({},""):"none",this.hasProjected=!1),y}const p=f.animationValues||f.latestValues;this.applyTransformsToTarget(),d.transform=vge(this.projectionDeltaWithTransform,this.treeScale,p),h&&(d.transform=h(p,d.transform));const{x:g,y:m}=this.projectionDelta;d.transformOrigin=`${g.origin*100}% ${m.origin*100}% 0`,f.animationValues?d.opacity=f===this?(c=(l=p.opacity)!==null&&l!==void 0?l:this.latestValues.opacity)!==null&&c!==void 0?c:1:this.preserveOpacity?this.latestValues.opacity:p.opacityExit:d.opacity=f===this?p.opacity!==void 0?p.opacity:"":p.opacityExit!==void 0?p.opacityExit:0;for(const y in h0){if(p[y]===void 0)continue;const{correct:x,applyTo:C}=h0[y],v=d.transform==="none"?p[y]:x(p[y],f);if(C){const b=C.length;for(let S=0;S<b;S++)d[C[S]]=v}else d[y]=v}return this.options.layoutId&&(d.pointerEvents=f===this?mm(a==null?void 0:a.pointerEvents)||"":"none"),d}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(a=>{var l;return(l=a.currentAnimation)===null||l===void 0?void 0:l.stop()}),this.root.nodes.forEach(u6),this.root.sharedNodes.clear()}}}function _ge(e){e.updateLayout()}function Ige(e){var t;const n=((t=e.resumeFrom)===null||t===void 0?void 0:t.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&n&&e.hasListeners("didUpdate")){const{layoutBox:s,measuredBox:i}=e.layout,{animationType:o}=e.options,a=n.source!==e.layout.source;o==="size"?Fr(f=>{const p=a?n.measuredBox[f]:n.layoutBox[f],g=Ir(p);p.min=s[f].min,p.max=p.min+g}):i9(o,n.layoutBox,s)&&Fr(f=>{const p=a?n.measuredBox[f]:n.layoutBox[f],g=Ir(s[f]);p.max=p.min+g,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[f].max=e.relativeTarget[f].min+g)});const l=Vc();Kh(l,s,n.layoutBox);const c=Vc();a?Kh(c,e.applyTransform(i,!0),n.measuredBox):Kh(c,s,n.layoutBox);const d=!t9(l);let h=!1;if(!e.resumeFrom){const f=e.getClosestProjectingParent();if(f&&!f.resumeFrom){const{snapshot:p,layout:g}=f;if(p&&g){const m=In();Zh(m,n.layoutBox,p.layoutBox);const y=In();Zh(y,s,g.layoutBox),n9(m,y)||(h=!0),f.options.layoutRoot&&(e.relativeTarget=y,e.relativeTargetOrigin=m,e.relativeParent=f)}}}e.notifyListeners("didUpdate",{layout:s,snapshot:n,delta:c,layoutDelta:l,hasLayoutChanged:d,hasRelativeTargetChanged:h})}else if(e.isLead()){const{onExitComplete:s}=e.options;s&&s()}e.options.transition=void 0}function Age(e){Rh&&el.totalNodes++,e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function Tge(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function Mge(e){e.clearSnapshot()}function u6(e){e.clearMeasurements()}function Pge(e){e.isLayoutDirty=!1}function Ege(e){const{visualElement:t}=e.options;t&&t.getProps().onBeforeLayoutMeasure&&t.notify("BeforeLayoutMeasure"),e.resetTransform()}function d6(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Lge(e){e.resolveTargetDelta()}function Dge(e){e.calcProjection()}function Rge(e){e.resetSkewAndRotation()}function Oge(e){e.removeLeadSnapshot()}function h6(e,t,n){e.translate=bn(t.translate,0,n),e.scale=bn(t.scale,1,n),e.origin=t.origin,e.originPoint=t.originPoint}function f6(e,t,n,s){e.min=bn(t.min,n.min,s),e.max=bn(t.max,n.max,s)}function Nge(e,t,n,s){f6(e.x,t.x,n.x,s),f6(e.y,t.y,n.y,s)}function Fge(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Bge={duration:.45,ease:[.4,0,.1,1]},p6=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),g6=p6("applewebkit/")&&!p6("chrome/")?Math.round:Cs;function m6(e){e.min=g6(e.min),e.max=g6(e.max)}function $ge(e){m6(e.x),m6(e.y)}function i9(e,t,n){return e==="position"||e==="preserve-aspect"&&!Vpe(a6(t),a6(n),.2)}function Vge(e){var t;return e!==e.root&&((t=e.scroll)===null||t===void 0?void 0:t.wasRoot)}const Gge=r9({attachResizeListener:(e,t)=>Mo(e,"resize",t),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Vv={current:void 0},o9=r9({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!Vv.current){const e=new Gge({});e.mount(window),e.setOptions({layoutScroll:!0}),Vv.current=e}return Vv.current},resetTransform:(e,t)=>{e.style.transform=t!==void 0?t:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),zge={pan:{Feature:sge},drag:{Feature:nge,ProjectionNode:o9,MeasureLayout:Q7}};function y6(e,t){const n=t?"pointerenter":"pointerleave",s=t?"onHoverStart":"onHoverEnd",i=(o,a)=>{if(o.pointerType==="touch"||z7())return;const l=e.getProps();e.animationState&&l.whileHover&&e.animationState.setActive("whileHover",t);const c=l[s];c&&Wt.postRender(()=>c(o,a))};return Ro(e.current,n,i,{passive:!e.getProps()[s]})}class Hge extends Na{mount(){this.unmount=Do(y6(this.node,!0),y6(this.node,!1))}unmount(){}}class Wge extends Na{constructor(){super(...arguments),this.isActive=!1}onFocus(){let t=!1;try{t=this.node.current.matches(":focus-visible")}catch{t=!0}!t||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Do(Mo(this.node.current,"focus",()=>this.onFocus()),Mo(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}const a9=(e,t)=>t?e===t?!0:a9(e,t.parentElement):!1;function Gv(e,t){if(!t)return;const n=new PointerEvent("pointer"+e);t(n,J1(n))}class Uge extends Na{constructor(){super(...arguments),this.removeStartListeners=Cs,this.removeEndListeners=Cs,this.removeAccessibleListeners=Cs,this.startPointerPress=(t,n)=>{if(this.isPressing)return;this.removeEndListeners();const s=this.node.getProps(),o=Ro(window,"pointerup",(l,c)=>{if(!this.checkPressEnd())return;const{onTap:d,onTapCancel:h,globalTapTarget:f}=this.node.getProps(),p=!f&&!a9(this.node.current,l.target)?h:d;p&&Wt.update(()=>p(l,c))},{passive:!(s.onTap||s.onPointerUp)}),a=Ro(window,"pointercancel",(l,c)=>this.cancelPress(l,c),{passive:!(s.onTapCancel||s.onPointerCancel)});this.removeEndListeners=Do(o,a),this.startPress(t,n)},this.startAccessiblePress=()=>{const t=o=>{if(o.key!=="Enter"||this.isPressing)return;const a=l=>{l.key!=="Enter"||!this.checkPressEnd()||Gv("up",(c,d)=>{const{onTap:h}=this.node.getProps();h&&Wt.postRender(()=>h(c,d))})};this.removeEndListeners(),this.removeEndListeners=Mo(this.node.current,"keyup",a),Gv("down",(l,c)=>{this.startPress(l,c)})},n=Mo(this.node.current,"keydown",t),s=()=>{this.isPressing&&Gv("cancel",(o,a)=>this.cancelPress(o,a))},i=Mo(this.node.current,"blur",s);this.removeAccessibleListeners=Do(n,i)}}startPress(t,n){this.isPressing=!0;const{onTapStart:s,whileTap:i}=this.node.getProps();i&&this.node.animationState&&this.node.animationState.setActive("whileTap",!0),s&&Wt.postRender(()=>s(t,n))}checkPressEnd(){return this.removeEndListeners(),this.isPressing=!1,this.node.getProps().whileTap&&this.node.animationState&&this.node.animationState.setActive("whileTap",!1),!z7()}cancelPress(t,n){if(!this.checkPressEnd())return;const{onTapCancel:s}=this.node.getProps();s&&Wt.postRender(()=>s(t,n))}mount(){const t=this.node.getProps(),n=Ro(t.globalTapTarget?window:this.node.current,"pointerdown",this.startPointerPress,{passive:!(t.onTapStart||t.onPointerStart)}),s=Mo(this.node.current,"focus",this.startAccessiblePress);this.removeStartListeners=Do(n,s)}unmount(){this.removeStartListeners(),this.removeEndListeners(),this.removeAccessibleListeners()}}const e2=new WeakMap,zv=new WeakMap,qge=e=>{const t=e2.get(e.target);t&&t(e)},Kge=e=>{e.forEach(qge)};function Zge({root:e,...t}){const n=e||document;zv.has(n)||zv.set(n,{});const s=zv.get(n),i=JSON.stringify(t);return s[i]||(s[i]=new IntersectionObserver(Kge,{root:e,...t})),s[i]}function Yge(e,t,n){const s=Zge(t);return e2.set(e,n),s.observe(e),()=>{e2.delete(e),s.unobserve(e)}}const Xge={some:0,all:1};class Qge extends Na{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:t={}}=this.node.getProps(),{root:n,margin:s,amount:i="some",once:o}=t,a={root:n?n.current:void 0,rootMargin:s,threshold:typeof i=="number"?i:Xge[i]},l=c=>{const{isIntersecting:d}=c;if(this.isInView===d||(this.isInView=d,o&&!d&&this.hasEnteredView))return;d&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",d);const{onViewportEnter:h,onViewportLeave:f}=this.node.getProps(),p=d?h:f;p&&p(c)};return Yge(this.node.current,a,l)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:t,prevProps:n}=this.node;["amount","margin","root"].some(Jge(t,n))&&this.startObserver()}unmount(){}}function Jge({viewport:e={}},{viewport:t={}}={}){return n=>e[n]!==t[n]}const eme={inView:{Feature:Qge},tap:{Feature:Uge},focus:{Feature:Wge},hover:{Feature:Hge}},tme={layout:{ProjectionNode:o9,MeasureLayout:Q7}},Pw=u.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"}),ty=u.createContext({}),Ew=typeof window<"u",l9=Ew?u.useLayoutEffect:u.useEffect,c9=u.createContext({strict:!1});let v6=!1;function nme(e,t,n,s,i){var o;const{visualElement:a}=u.useContext(ty),l=u.useContext(c9),c=u.useContext(ey),d=u.useContext(Pw).reducedMotion,h=u.useRef();s=s||l.renderer,!h.current&&s&&(h.current=s(e,{visualState:t,parent:a,props:n,presenceContext:c,blockInitialAnimation:c?c.initial===!1:!1,reducedMotionConfig:d}));const f=h.current,p=u.useContext(X7);f&&!f.projection&&i&&(f.type==="html"||f.type==="svg")&&rme(h.current,n,i,p),u.useInsertionEffect(()=>{f&&f.update(n,c)});const g=n[L7],m=u.useRef(!!g&&!window.MotionHandoffIsComplete&&((o=window.MotionHasOptimisedAnimation)===null||o===void 0?void 0:o.call(window,g)));return l9(()=>{f&&(f.updateFeatures(),Mw.render(f.render),m.current&&f.animationState&&f.animationState.animateChanges())}),u.useEffect(()=>{f&&(!m.current&&f.animationState&&f.animationState.animateChanges(),m.current=!1,v6||(v6=!0,queueMicrotask(sme)))}),f}function sme(){window.MotionHandoffIsComplete=!0}function rme(e,t,n,s){const{layoutId:i,layout:o,drag:a,dragConstraints:l,layoutScroll:c,layoutRoot:d}=t;e.projection=new n(e.latestValues,t["data-framer-portal-id"]?void 0:u9(e.parent)),e.projection.setOptions({layoutId:i,layout:o,alwaysMeasureLayout:!!a||l&&$c(l),visualElement:e,animationType:typeof o=="string"?o:"both",initialPromotionConfig:s,layoutScroll:c,layoutRoot:d})}function u9(e){if(e)return e.options.allowProjection!==!1?e.projection:u9(e.parent)}function ime(e,t,n){return u.useCallback(s=>{s&&e.mount&&e.mount(s),t&&(s?t.mount(s):t.unmount()),n&&(typeof n=="function"?n(s):$c(n)&&(n.current=s))},[t])}function ny(e){return bf(e.animate)||dw.some(t=>xf(e[t]))}function d9(e){return!!(ny(e)||e.variants)}function ome(e,t){if(ny(e)){const{initial:n,animate:s}=e;return{initial:n===!1||xf(n)?n:void 0,animate:xf(s)?s:void 0}}return e.inherit!==!1?t:{}}function ame(e){const{initial:t,animate:n}=ome(e,u.useContext(ty));return u.useMemo(()=>({initial:t,animate:n}),[b6(t),b6(n)])}function b6(e){return Array.isArray(e)?e.join(" "):e}const x6={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},wu={};for(const e in x6)wu[e]={isEnabled:t=>x6[e].some(n=>!!t[n])};function lme(e){for(const t in e)wu[t]={...wu[t],...e[t]}}const cme=Symbol.for("motionComponentSymbol");function ume({preloadedFeatures:e,createVisualElement:t,useRender:n,useVisualState:s,Component:i}){e&&lme(e);function o(l,c){let d;const h={...u.useContext(Pw),...l,layoutId:dme(l)},{isStatic:f}=h,p=ame(l),g=s(l,f);if(!f&&Ew){hme();const m=fme(h);d=m.MeasureLayout,p.visualElement=nme(i,g,h,t,m.ProjectionNode)}return r.jsxs(ty.Provider,{value:p,children:[d&&p.visualElement?r.jsx(d,{visualElement:p.visualElement,...h}):null,n(i,l,ime(g,p.visualElement,c),g,f,p.visualElement)]})}const a=u.forwardRef(o);return a[cme]=i,a}function dme({layoutId:e}){const t=u.useContext(Tw).id;return t&&e!==void 0?t+"-"+e:e}function hme(e,t){u.useContext(c9).strict}function fme(e){const{drag:t,layout:n}=wu;if(!t&&!n)return{};const s={...t,...n};return{MeasureLayout:t!=null&&t.isEnabled(e)||n!=null&&n.isEnabled(e)?s.MeasureLayout:void 0,ProjectionNode:s.ProjectionNode}}const pme=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function Lw(e){return typeof e!="string"||e.includes("-")?!1:!!(pme.indexOf(e)>-1||/[A-Z]/u.test(e))}function h9(e,{style:t,vars:n},s,i){Object.assign(e.style,t,i&&i.getProjectionStyles(s));for(const o in n)e.style.setProperty(o,n[o])}const f9=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function p9(e,t,n,s){h9(e,t,void 0,s);for(const i in t.attrs)e.setAttribute(f9.has(i)?i:Q1(i),t.attrs[i])}function g9(e,{layout:t,layoutId:n}){return Oa.has(e)||e.startsWith("origin")||(t||n!==void 0)&&(!!h0[e]||e==="opacity")}function Dw(e,t,n){var s;const{style:i}=e,o={};for(const a in i)(ys(i[a])||t.style&&ys(t.style[a])||g9(a,e)||((s=n==null?void 0:n.getValue(a))===null||s===void 0?void 0:s.liveStyle)!==void 0)&&(o[a]=i[a]);return n&&i&&typeof i.willChange=="string"&&(n.applyWillChange=!1),o}function m9(e,t,n){const s=Dw(e,t,n);for(const i in e)if(ys(e[i])||ys(t[i])){const o=Pp.indexOf(i)!==-1?"attr"+i.charAt(0).toUpperCase()+i.substring(1):i;s[o]=e[i]}return s}function Rw(e){const t=u.useRef(null);return t.current===null&&(t.current=e()),t.current}function gme({applyWillChange:e=!1,scrapeMotionValuesFromProps:t,createRenderState:n,onMount:s},i,o,a,l){const c={latestValues:mme(i,o,a,l?!1:e,t),renderState:n()};return s&&(c.mount=d=>s(i,d,c)),c}const y9=e=>(t,n)=>{const s=u.useContext(ty),i=u.useContext(ey),o=()=>gme(e,t,s,i,n);return n?o():Rw(o)};function C6(e,t,n){const s=Array.isArray(t)?t:[t];for(let i=0;i<s.length;i++){const o=cw(e,s[i]);if(o){const{transitionEnd:a,transition:l,...c}=o;n(c,a)}}}function mme(e,t,n,s,i){var o;const a={};let l=s&&((o=e.style)===null||o===void 0?void 0:o.willChange)===void 0;const c=i(e,{});for(const y in c)a[y]=mm(c[y]);let{initial:d,animate:h}=e;const f=ny(e),p=d9(e);t&&p&&!f&&e.inherit!==!1&&(d===void 0&&(d=t.initial),h===void 0&&(h=t.animate));let g=n?n.initial===!1:!1;g=g||d===!1;const m=g?h:d;return m&&typeof m!="boolean"&&!bf(m)&&C6(e,m,(y,x)=>{for(const C in y){let v=y[C];if(Array.isArray(v)){const b=g?v.length-1:0;v=v[b]}v!==null&&(a[C]=v)}for(const C in x)a[C]=x[C]}),l&&h&&d!==!1&&!bf(h)&&C6(e,h,y=>{for(const x in y)if(R7(x)){a.willChange="transform";return}}),a}const Ow=()=>({style:{},transform:{},transformOrigin:{},vars:{}}),v9=()=>({...Ow(),attrs:{}}),b9=(e,t)=>t&&typeof e=="number"?t.transform(e):e,yme={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},vme=Pp.length;function bme(e,t,n){let s="",i=!0;for(let o=0;o<vme;o++){const a=Pp[o],l=e[a];if(l===void 0)continue;let c=!0;if(typeof l=="number"?c=l===(a.startsWith("scale")?1:0):c=parseFloat(l)===0,!c||n){const d=b9(l,bw[a]);if(!c){i=!1;const h=yme[a]||a;s+=`${h}(${d}) `}n&&(t[a]=d)}}return s=s.trim(),n?s=n(t,i?"":s):i&&(s="none"),s}function Nw(e,t,n){const{style:s,vars:i,transformOrigin:o}=e;let a=!1,l=!1;for(const c in t){const d=t[c];if(Oa.has(c)){a=!0;continue}else if(l7(c)){i[c]=d;continue}else{const h=b9(d,bw[c]);c.startsWith("origin")?(l=!0,o[c]=h):s[c]=h}}if(t.transform||(a||n?s.transform=bme(t,e.transform,n):s.transform&&(s.transform="none")),l){const{originX:c="50%",originY:d="50%",originZ:h=0}=o;s.transformOrigin=`${c} ${d} ${h}`}}function S6(e,t,n){return typeof e=="string"?e:Qe.transform(t+n*e)}function xme(e,t,n){const s=S6(t,e.x,e.width),i=S6(n,e.y,e.height);return`${s} ${i}`}const Cme={offset:"stroke-dashoffset",array:"stroke-dasharray"},Sme={offset:"strokeDashoffset",array:"strokeDasharray"};function wme(e,t,n=1,s=0,i=!0){e.pathLength=1;const o=i?Cme:Sme;e[o.offset]=Qe.transform(-s);const a=Qe.transform(t),l=Qe.transform(n);e[o.array]=`${a} ${l}`}function Fw(e,{attrX:t,attrY:n,attrScale:s,originX:i,originY:o,pathLength:a,pathSpacing:l=1,pathOffset:c=0,...d},h,f){if(Nw(e,d,f),h){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:p,style:g,dimensions:m}=e;p.transform&&(m&&(g.transform=p.transform),delete p.transform),m&&(i!==void 0||o!==void 0||g.transform)&&(g.transformOrigin=xme(m,i!==void 0?i:.5,o!==void 0?o:.5)),t!==void 0&&(p.x=t),n!==void 0&&(p.y=n),s!==void 0&&(p.scale=s),a!==void 0&&wme(p,a,l,c,!1)}const Bw=e=>typeof e=="string"&&e.toLowerCase()==="svg",jme={useVisualState:y9({scrapeMotionValuesFromProps:m9,createRenderState:v9,onMount:(e,t,{renderState:n,latestValues:s})=>{Wt.read(()=>{try{n.dimensions=typeof t.getBBox=="function"?t.getBBox():t.getBoundingClientRect()}catch{n.dimensions={x:0,y:0,width:0,height:0}}}),Wt.render(()=>{Fw(n,s,Bw(t.tagName),e.transformTemplate),p9(t,n)})}})},kme={useVisualState:y9({applyWillChange:!0,scrapeMotionValuesFromProps:Dw,createRenderState:Ow})};function x9(e,t,n){for(const s in t)!ys(t[s])&&!g9(s,n)&&(e[s]=t[s])}function _me({transformTemplate:e},t){return u.useMemo(()=>{const n=Ow();return Nw(n,t,e),Object.assign({},n.vars,n.style)},[t])}function Ime(e,t){const n=e.style||{},s={};return x9(s,n,e),Object.assign(s,_me(e,t)),s}function Ame(e,t){const n={},s=Ime(e,t);return e.drag&&e.dragListener!==!1&&(n.draggable=!1,s.userSelect=s.WebkitUserSelect=s.WebkitTouchCallout="none",s.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(n.tabIndex=0),n.style=s,n}const Tme=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function f0(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||Tme.has(e)}let C9=e=>!f0(e);function Mme(e){e&&(C9=t=>t.startsWith("on")?!f0(t):e(t))}try{Mme(require("@emotion/is-prop-valid").default)}catch{}function Pme(e,t,n){const s={};for(const i in e)i==="values"&&typeof e.values=="object"||(C9(i)||n===!0&&f0(i)||!t&&!f0(i)||e.draggable&&i.startsWith("onDrag"))&&(s[i]=e[i]);return s}function Eme(e,t,n,s){const i=u.useMemo(()=>{const o=v9();return Fw(o,t,Bw(s),e.transformTemplate),{...o.attrs,style:{...o.style}}},[t]);if(e.style){const o={};x9(o,e.style,e),i.style={...o,...i.style}}return i}function Lme(e=!1){return(n,s,i,{latestValues:o},a)=>{const c=(Lw(n)?Eme:Ame)(s,o,a,n),d=Pme(s,typeof n=="string",e),h=n!==u.Fragment?{...d,...c,ref:i}:{},{children:f}=s,p=u.useMemo(()=>ys(f)?f.get():f,[f]);return u.createElement(n,{...h,children:p})}}function Dme(e,t){return function(s,{forwardMotionProps:i}={forwardMotionProps:!1}){const a={...Lw(s)?jme:kme,preloadedFeatures:e,useRender:Lme(i),createVisualElement:t,Component:s};return ume(a)}}const t2={current:null},S9={current:!1};function Rme(){if(S9.current=!0,!!Ew)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),t=()=>t2.current=e.matches;e.addListener(t),t()}else t2.current=!1}function Ome(e,t,n){for(const s in t){const i=t[s],o=n[s];if(ys(i))e.addValue(s,i);else if(ys(o))e.addValue(s,wf(i,{owner:e}));else if(o!==i)if(e.hasValue(s)){const a=e.getValue(s);a.liveStyle===!0?a.jump(i):a.hasAnimated||a.set(i)}else{const a=e.getStaticValue(s);e.addValue(s,wf(a!==void 0?a:i,{owner:e}))}}for(const s in n)t[s]===void 0&&e.removeValue(s);return t}const w6=new WeakMap,Nme=[...d7,hs,Sa],Fme=e=>Nme.find(u7(e)),j6=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class Bme{scrapeMotionValuesFromProps(t,n,s){return{}}constructor({parent:t,props:n,presenceContext:s,reducedMotionConfig:i,blockInitialAnimation:o,visualState:a},l={}){this.applyWillChange=!1,this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=mw,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const p=Yi.now();this.renderScheduledAt<p&&(this.renderScheduledAt=p,Wt.render(this.render,!1,!0))};const{latestValues:c,renderState:d}=a;this.latestValues=c,this.baseTarget={...c},this.initialValues=n.initial?{...c}:{},this.renderState=d,this.parent=t,this.props=n,this.presenceContext=s,this.depth=t?t.depth+1:0,this.reducedMotionConfig=i,this.options=l,this.blockInitialAnimation=!!o,this.isControllingVariants=ny(n),this.isVariantNode=d9(n),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(t&&t.current);const{willChange:h,...f}=this.scrapeMotionValuesFromProps(n,{},this);for(const p in f){const g=f[p];c[p]!==void 0&&ys(g)&&g.set(c[p],!1)}}mount(t){this.current=t,w6.set(t,this),this.projection&&!this.projection.instance&&this.projection.mount(t),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((n,s)=>this.bindToMotionValue(s,n)),S9.current||Rme(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:t2.current,this.parent&&this.parent.children.add(this),this.update(this.props,this.presenceContext)}unmount(){w6.delete(this.current),this.projection&&this.projection.unmount(),xa(this.notifyUpdate),xa(this.render),this.valueSubscriptions.forEach(t=>t()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent&&this.parent.children.delete(this);for(const t in this.events)this.events[t].clear();for(const t in this.features){const n=this.features[t];n&&(n.unmount(),n.isMounted=!1)}this.current=null}bindToMotionValue(t,n){this.valueSubscriptions.has(t)&&this.valueSubscriptions.get(t)();const s=Oa.has(t),i=n.on("change",l=>{this.latestValues[t]=l,this.props.onUpdate&&Wt.preRender(this.notifyUpdate),s&&this.projection&&(this.projection.isTransformDirty=!0)}),o=n.on("renderRequest",this.scheduleRender);let a;window.MotionCheckAppearSync&&(a=window.MotionCheckAppearSync(this,t,n)),this.valueSubscriptions.set(t,()=>{i(),o(),a&&a(),n.owner&&n.stop()})}sortNodePosition(t){return!this.current||!this.sortInstanceNodePosition||this.type!==t.type?0:this.sortInstanceNodePosition(this.current,t.current)}updateFeatures(){let t="animation";for(t in wu){const n=wu[t];if(!n)continue;const{isEnabled:s,Feature:i}=n;if(!this.features[t]&&i&&s(this.props)&&(this.features[t]=new i(this)),this.features[t]){const o=this.features[t];o.isMounted?o.update():(o.mount(),o.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):In()}getStaticValue(t){return this.latestValues[t]}setStaticValue(t,n){this.latestValues[t]=n}update(t,n){(t.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=t,this.prevPresenceContext=this.presenceContext,this.presenceContext=n;for(let s=0;s<j6.length;s++){const i=j6[s];this.propEventSubscriptions[i]&&(this.propEventSubscriptions[i](),delete this.propEventSubscriptions[i]);const o="on"+i,a=t[o];a&&(this.propEventSubscriptions[i]=this.on(i,a))}this.prevMotionValues=Ome(this,this.scrapeMotionValuesFromProps(t,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(t){return this.props.variants?this.props.variants[t]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(t){const n=this.getClosestVariantNode();if(n)return n.variantChildren&&n.variantChildren.add(t),()=>n.variantChildren.delete(t)}addValue(t,n){const s=this.values.get(t);n!==s&&(s&&this.removeValue(t),this.bindToMotionValue(t,n),this.values.set(t,n),this.latestValues[t]=n.get())}removeValue(t){this.values.delete(t);const n=this.valueSubscriptions.get(t);n&&(n(),this.valueSubscriptions.delete(t)),delete this.latestValues[t],this.removeValueFromRenderState(t,this.renderState)}hasValue(t){return this.values.has(t)}getValue(t,n){if(this.props.values&&this.props.values[t])return this.props.values[t];let s=this.values.get(t);return s===void 0&&n!==void 0&&(s=wf(n===null?void 0:n,{owner:this}),this.addValue(t,s)),s}readValue(t,n){var s;let i=this.latestValues[t]!==void 0||!this.current?this.latestValues[t]:(s=this.getBaseTargetFromProps(this.props,t))!==null&&s!==void 0?s:this.readValueFromInstance(this.current,t,this.options);return i!=null&&(typeof i=="string"&&(o7(i)||r7(i))?i=parseFloat(i):!Fme(i)&&Sa.test(n)&&(i=b7(t,n)),this.setBaseTarget(t,ys(i)?i.get():i)),ys(i)?i.get():i}setBaseTarget(t,n){this.baseTarget[t]=n}getBaseTarget(t){var n;const{initial:s}=this.props;let i;if(typeof s=="string"||typeof s=="object"){const a=cw(this.props,s,(n=this.presenceContext)===null||n===void 0?void 0:n.custom);a&&(i=a[t])}if(s&&i!==void 0)return i;const o=this.getBaseTargetFromProps(this.props,t);return o!==void 0&&!ys(o)?o:this.initialValues[t]!==void 0&&i===void 0?void 0:this.baseTarget[t]}on(t,n){return this.events[t]||(this.events[t]=new Aw),this.events[t].add(n)}notify(t,...n){this.events[t]&&this.events[t].notify(...n)}}class w9 extends Bme{constructor(){super(...arguments),this.KeyframeResolver=x7}sortInstanceNodePosition(t,n){return t.compareDocumentPosition(n)&2?1:-1}getBaseTargetFromProps(t,n){return t.style?t.style[n]:void 0}removeValueFromRenderState(t,{vars:n,style:s}){delete n[t],delete s[t]}}function $me(e){return window.getComputedStyle(e)}class Vme extends w9{constructor(){super(...arguments),this.type="html",this.applyWillChange=!0,this.renderInstance=h9}readValueFromInstance(t,n){if(Oa.has(n)){const s=xw(n);return s&&s.default||0}else{const s=$me(t),i=(l7(n)?s.getPropertyValue(n):s[n])||0;return typeof i=="string"?i.trim():i}}measureInstanceViewportBox(t,{transformPagePoint:n}){return Z7(t,n)}build(t,n,s){Nw(t,n,s.transformTemplate)}scrapeMotionValuesFromProps(t,n,s){return Dw(t,n,s)}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:t}=this.props;ys(t)&&(this.childSubscription=t.on("change",n=>{this.current&&(this.current.textContent=`${n}`)}))}}class Gme extends w9{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=In}getBaseTargetFromProps(t,n){return t[n]}readValueFromInstance(t,n){if(Oa.has(n)){const s=xw(n);return s&&s.default||0}return n=f9.has(n)?n:Q1(n),t.getAttribute(n)}scrapeMotionValuesFromProps(t,n,s){return m9(t,n,s)}build(t,n,s){Fw(t,n,this.isSVGTag,s.transformTemplate)}renderInstance(t,n,s,i){p9(t,n,s,i)}mount(t){this.isSVGTag=Bw(t.tagName),super.mount(t)}}const zme=(e,t)=>Lw(e)?new Gme(t):new Vme(t,{allowProjection:e!==u.Fragment}),Hme=Dme({...Epe,...eme,...zge,...tme},zme),$w=whe(Hme);class Wme extends u.Component{getSnapshotBeforeUpdate(t){const n=this.props.childRef.current;if(n&&t.isPresent&&!this.props.isPresent){const s=this.props.sizeRef.current;s.height=n.offsetHeight||0,s.width=n.offsetWidth||0,s.top=n.offsetTop,s.left=n.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function Ume({children:e,isPresent:t}){const n=u.useId(),s=u.useRef(null),i=u.useRef({width:0,height:0,top:0,left:0}),{nonce:o}=u.useContext(Pw);return u.useInsertionEffect(()=>{const{width:a,height:l,top:c,left:d}=i.current;if(t||!s.current||!a||!l)return;s.current.dataset.motionPopId=n;const h=document.createElement("style");return o&&(h.nonce=o),document.head.appendChild(h),h.sheet&&h.sheet.insertRule(`
          [data-motion-pop-id="${n}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${l}px !important;
            top: ${c}px !important;
            left: ${d}px !important;
          }
        `),()=>{document.head.removeChild(h)}},[t]),r.jsx(Wme,{isPresent:t,childRef:s,sizeRef:i,children:u.cloneElement(e,{ref:s})})}const qme=({children:e,initial:t,isPresent:n,onExitComplete:s,custom:i,presenceAffectsLayout:o,mode:a})=>{const l=Rw(Kme),c=u.useId(),d=u.useMemo(()=>({id:c,initial:t,isPresent:n,custom:i,onExitComplete:h=>{l.set(h,!0);for(const f of l.values())if(!f)return;s&&s()},register:h=>(l.set(h,!1),()=>l.delete(h))}),o?[Math.random()]:[n]);return u.useMemo(()=>{l.forEach((h,f)=>l.set(f,!1))},[n]),u.useEffect(()=>{!n&&!l.size&&s&&s()},[n]),a==="popLayout"&&(e=r.jsx(Ume,{isPresent:n,children:e})),r.jsx(ey.Provider,{value:d,children:e})};function Kme(){return new Map}const wg=e=>e.key||"";function k6(e){const t=[];return u.Children.forEach(e,n=>{u.isValidElement(n)&&t.push(n)}),t}const j9=({children:e,exitBeforeEnter:t,custom:n,initial:s=!0,onExitComplete:i,presenceAffectsLayout:o=!0,mode:a="sync"})=>{const l=u.useMemo(()=>k6(e),[e]),c=l.map(wg),d=u.useRef(!0),h=u.useRef(l),f=Rw(()=>new Map),[p,g]=u.useState(l),[m,y]=u.useState(l);l9(()=>{d.current=!1,h.current=l;for(let v=0;v<m.length;v++){const b=wg(m[v]);c.includes(b)?f.delete(b):f.get(b)!==!0&&f.set(b,!1)}},[m,c.length,c.join("-")]);const x=[];if(l!==p){let v=[...l];for(let b=0;b<m.length;b++){const S=m[b],w=wg(S);c.includes(w)||(v.splice(b,0,S),x.push(S))}a==="wait"&&x.length&&(v=x),y(k6(v)),g(l);return}const{forceRender:C}=u.useContext(Tw);return r.jsx(r.Fragment,{children:m.map(v=>{const b=wg(v),S=l===m||c.includes(b),w=()=>{if(f.has(b))f.set(b,!0);else return;let j=!0;f.forEach(E=>{E||(j=!1)}),j&&(C==null||C(),y(h.current),i&&i())};return r.jsx(qme,{isPresent:S,initial:!d.current||s?void 0:!1,custom:S?void 0:n,presenceAffectsLayout:o,mode:a,onExitComplete:S?void 0:w,children:v},b)})})},Zme=e=>{const t=Lt(),n=z(),s=u.useCallback(()=>{t.open(),n(Ys("gallery"))},[t,n]);return r.jsx(ye,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},Yme=()=>{const{t:e}=P(),t=lw(),n=I(On),s=u.useMemo(()=>n!=="canvas"||!t?!1:t==="gallery",[t,n]);return r.jsx(k9,{title:e("controlLayers.sendingToGallery"),description:r.jsx(Xt,{i18nKey:"controlLayers.viewProgressInViewer",components:{Btn:r.jsx(Zme,{})}}),isVisible:s})},Xme=e=>{const t=z(),n=Lt(),s=u.useCallback(()=>{t(bt("canvas")),t(Ys("layers")),n.close()},[t,n]);return r.jsx(ye,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},Qme=()=>{const{t:e}=P(),t=lw(),n=I(Dn),s=I(On),i=u.useMemo(()=>s!=="canvas"&&t!=="canvas"?!1:n?!0:t?t==="canvas":!1,[t,n,s]);return r.jsx(k9,{title:e("controlLayers.sendingToCanvas"),description:r.jsx(Xt,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:r.jsx(Xme,{})}}),isVisible:i})},k9=({title:e,description:t,isVisible:n})=>{const s=Xf(!1);return r.jsx(j9,{children:(n||s.isTrue)&&r.jsx($w.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.1,ease:"easeOut"}},exit:{opacity:0,transition:{duration:.1,delay:s.isTrue?.1:1,ease:"easeIn"}},onMouseEnter:s.setTrue,onMouseLeave:s.setFalse,children:r.jsxs(zl,{status:"warning",flexDir:"column",pointerEvents:"auto",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsxs(T,{w:"full",alignItems:"center",children:[r.jsx(Hl,{}),r.jsx(K0,{children:e})]}),r.jsx(Qf,{children:t})]})})})},_9=u.memo(()=>{const{t:e}=P(),t=tt(),n=Tt(),s=u.useCallback(async()=>{const i=n.getAllAdapters();for(const o of i)await o.cropToBbox()},[n]);return r.jsx(he,{icon:r.jsx(wE,{}),isDisabled:t,onClick:s,children:e("controlLayers.canvasContextMenu.cropCanvasToBbox")})});_9.displayName="CanvasContextMenuItemsCropCanvasToBbox";const p0=nr("canvas"),Jme=()=>{const{t:e}=P(),t=Ho();return u.useCallback(async s=>{if(s)try{const i=s.getCanvas(),o=await Z0(i);t.writeImage(o,()=>{p0.trace("Layer copied to clipboard"),fe({status:"info",title:e("toast.layerCopiedToClipboard")})})}catch(i){p0.error({error:Es(i)},"Problem copying layer to clipboard"),fe({status:"error",title:e("toast.problemCopyingLayer")})}},[t,e])},_6=e=>{const{t}=P(),n=Ho(),s=Tt();return u.useCallback(async()=>{const o=e==="bbox"?s.stateApi.getBbox().rect:s.compositor.getVisibleRectOfType("raster_layer");if(o.width===0||o.height===0){fe({title:t("controlLayers.copyRegionError",{region:Kc(e)}),description:t("controlLayers.regionIsEmpty"),status:"warning"});return}try{const a=s.compositor.getVisibleAdaptersOfType("raster_layer"),l=s.compositor.getCompositeCanvas(a,o),c=await Z0(l);n.writeImage(c,()=>{p0.trace("Region copied to clipboard"),fe({title:t("controlLayers.regionCopiedToClipboard",{region:Kc(e)})})})}catch(a){p0.error({error:Es(a)},"Failed to save canvas to gallery"),fe({title:t("controlLayers.copyRegionError",{region:Kc(e)}),status:"error"})}},[s.compositor,s.stateApi,n,e,t])},e0e=nr("canvas"),Uo=({region:e,saveToGallery:t,toastOk:n,toastError:s,onSave:i,withMetadata:o})=>{const{t:a}=P(),l=_a(),c=Tt();return u.useCallback(async()=>{const h=e==="bbox"?c.stateApi.getBbox().rect:c.compositor.getVisibleRectOfType("raster_layer");if(h.width===0||h.height===0){fe({title:s,description:a("controlLayers.regionIsEmpty"),status:"warning"});return}let f;o&&(f=Dq(l.getState()));let p;t&&(p=Ar(l.getState()));const g=await Un(()=>{const m=c.compositor.getVisibleAdaptersOfType("raster_layer");return c.compositor.getCompositeImageDTO(m,h,{is_intermediate:!t,metadata:f,board_id:p,silent:!0},void 0,!0)});g.isOk()?(i&&i(g.value,h),fe({title:n})):(e0e.error({error:Es(g.error)},"Failed to save canvas to gallery"),fe({title:s,status:"error"}))},[c.compositor,c.stateApi,i,e,t,l,a,s,n,o])},I9=()=>{const{t:e}=P(),t=u.useMemo(()=>({region:"canvas",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return Uo(t)},A9=()=>{const{t:e}=P(),t=u.useMemo(()=>({region:"bbox",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return Uo(t)},t0e=()=>{const{t:e}=P(),t=z(),n=I(No),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:a=>{const c={referenceImages:[{id:_e("regional_guidance_reference_image"),ipAdapter:{...ft(n),image:Sl(a)}}]};t(va({overrides:c,isSelected:!0}))},toastOk:e("controlLayers.newRegionalReferenceImageOk"),toastError:e("controlLayers.newRegionalReferenceImageError")}),[n,t,e]);return Uo(s)},n0e=()=>{const{t:e}=P(),t=z(),n=I(No),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:a=>{const l={ipAdapter:{...ft(n),image:Sl(a)}};t(z0({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newGlobalReferenceImageOk"),toastError:e("controlLayers.newGlobalReferenceImageError")}),[n,t,e]);return Uo(s)},s0e=()=>{const{t:e}=P(),t=z(),n=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(o,a)=>{const l={objects:[Jr(o)],position:{x:a.x,y:a.y}};t(Nl({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newRasterLayerOk"),toastError:e("controlLayers.newRasterLayerError")}),[t,e]);return Uo(n)},r0e=()=>{const{t:e}=P(),t=z(),n=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(o,a)=>{const l={objects:[Jr(o)],controlAdapter:ft(Bl),position:{x:a.x,y:a.y}};t(zf({overrides:l,isSelected:!0}))},toastOk:e("controlLayers.newControlLayerOk"),toastError:e("controlLayers.newControlLayerError")}),[t,e]);return Uo(n)},i0e=e=>{const{t}=P(),n=z(),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,l)=>{n(uC({entityIdentifier:e,position:{x:l.x,y:l.y},imageObject:Jr(a),replaceObjects:!0}))},toastOk:t("controlLayers.pullBboxIntoLayerOk"),toastError:t("controlLayers.pullBboxIntoLayerError")}),[n,e,t]);return Uo(s)},T9=e=>{const{t}=P(),n=z(),s=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,l)=>{n(lC({entityIdentifier:e,imageDTO:a}))},toastOk:t("controlLayers.pullBboxIntoReferenceImageOk"),toastError:t("controlLayers.pullBboxIntoReferenceImageError")}),[n,e,t]);return Uo(s)},o0e=(e,t)=>{const{t:n}=P(),s=z(),i=u.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(l,c)=>{s(cC({entityIdentifier:e,referenceImageId:t,imageDTO:l}))},toastOk:n("controlLayers.pullBboxIntoReferenceImageOk"),toastError:n("controlLayers.pullBboxIntoReferenceImageError")}),[s,e,t,n]);return Uo(i)},M9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=Qs(),s=Qs(),i=tt(),o=I9(),a=A9(),l=t0e(),c=n0e(),d=s0e(),h=r0e(),f=_6("canvas"),p=_6("bbox");return r.jsx(r.Fragment,{children:r.jsxs(Cr,{title:e("controlLayers.canvasContextMenu.canvasGroup"),children:[r.jsx(_9,{}),r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Ui,{}),children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.canvasContextMenu.saveToGalleryGroup")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(he,{icon:r.jsx(Ui,{}),isDisabled:i,onClick:o,children:e("controlLayers.canvasContextMenu.saveCanvasToGallery")}),r.jsx(he,{icon:r.jsx(Ui,{}),isDisabled:i,onClick:a,children:e("controlLayers.canvasContextMenu.saveBboxToGallery")})]})]})}),r.jsx(he,{...n.parentMenuItemProps,icon:r.jsx(ps,{}),children:r.jsxs(Qt,{...n.menuProps,children:[r.jsx(Jt,{...n.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.canvasContextMenu.bboxGroup")})}),r.jsxs(kt,{...n.menuListProps,children:[r.jsx(he,{icon:r.jsx(ps,{}),isDisabled:i,onClick:c,children:e("controlLayers.canvasContextMenu.newGlobalReferenceImage")}),r.jsx(he,{icon:r.jsx(ps,{}),isDisabled:i,onClick:l,children:e("controlLayers.canvasContextMenu.newRegionalReferenceImage")}),r.jsx(he,{icon:r.jsx(ps,{}),isDisabled:i,onClick:h,children:e("controlLayers.canvasContextMenu.newControlLayer")}),r.jsx(he,{icon:r.jsx(ps,{}),isDisabled:i,onClick:d,children:e("controlLayers.canvasContextMenu.newRasterLayer")})]})]})}),r.jsx(he,{...s.parentMenuItemProps,icon:r.jsx(on,{}),children:r.jsxs(Qt,{...s.menuProps,children:[r.jsx(Jt,{...s.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.canvasContextMenu.copyToClipboard")})}),r.jsxs(kt,{...s.menuListProps,children:[r.jsx(he,{icon:r.jsx(on,{}),isDisabled:i,onClick:f,children:e("controlLayers.canvasContextMenu.copyCanvasToClipboard")}),r.jsx(he,{icon:r.jsx(on,{}),isDisabled:i,onClick:p,children:e("controlLayers.canvasContextMenu.copyBboxToClipboard")})]})]})})]})})});M9.displayName="CanvasContextMenuGlobalMenuItems";const a0e=(e,{id:t,type:n})=>n==="raster_layer"?{index:e.rasterLayers.entities.findIndex(s=>s.id===t),count:e.rasterLayers.entities.length}:n==="control_layer"?{index:e.controlLayers.entities.findIndex(s=>s.id===t),count:e.controlLayers.entities.length}:n==="regional_guidance"?{index:e.regionalGuidance.entities.findIndex(s=>s.id===t),count:e.regionalGuidance.entities.length}:n==="inpaint_mask"?{index:e.inpaintMasks.entities.findIndex(s=>s.id===t),count:e.inpaintMasks.entities.length}:n==="reference_image"?{index:e.referenceImages.entities.findIndex(s=>s.id===t),count:e.referenceImages.entities.length}:{index:-1,count:0},Qu=u.memo(()=>{const{t:e}=P(),t=z(),n=Ke(),s=tt(),i=u.useMemo(()=>It(Je,h=>{const{index:f,count:p}=a0e(h,n);return{canMoveForwardOne:f<p-1,canMoveBackwardOne:f>0,canMoveToFront:f<p-1,canMoveToBack:f>0}}),[n]),o=I(i),a=u.useCallback(()=>{t(Rq({entityIdentifier:n}))},[t,n]),l=u.useCallback(()=>{t(Oq({entityIdentifier:n}))},[t,n]),c=u.useCallback(()=>{t(Nq({entityIdentifier:n}))},[t,n]),d=u.useCallback(()=>{t(Fq({entityIdentifier:n}))},[t,n]);return r.jsxs(r.Fragment,{children:[r.jsx(Wr,{"aria-label":e("controlLayers.moveToFront"),tooltip:e("controlLayers.moveToFront"),onClick:l,isDisabled:!o.canMoveToFront||s,icon:r.jsx(ioe,{})}),r.jsx(Wr,{"aria-label":e("controlLayers.moveForward"),tooltip:e("controlLayers.moveForward"),onClick:a,isDisabled:!o.canMoveForwardOne||s,icon:r.jsx(bE,{})}),r.jsx(Wr,{"aria-label":e("controlLayers.moveBackward"),tooltip:e("controlLayers.moveBackward"),onClick:c,isDisabled:!o.canMoveBackwardOne||s,icon:r.jsx(noe,{})}),r.jsx(Wr,{"aria-label":e("controlLayers.moveToBack"),tooltip:e("controlLayers.moveToBack"),onClick:d,isDisabled:!o.canMoveToBack||s,icon:r.jsx(roe,{})})]})});Qu.displayName="CanvasEntityMenuItemsArrange";const Ii=e=>{const t=u.useMemo(()=>ve(Je,s=>{if(!e)return!1;const i=Aa(s,e);return i?i.isLocked:!1}),[e]);return I(t)},Dp=u.memo(()=>{const{t:e}=P(),t=Ke(),n=po(t),s=tt(),i=Ii(t),o=u.useCallback(()=>{n&&n.cropToBbox()},[n]);return r.jsx(he,{onClick:o,icon:r.jsx(wE,{}),isDisabled:s||i,children:e("controlLayers.cropLayerToBbox")})});Dp.displayName="CanvasEntityMenuItemsCropToBbox";const Ju=u.memo(({asIcon:e=!1})=>{const{t}=P(),n=z(),s=Ke(),i=tt(),o=u.useCallback(()=>{n(SC({entityIdentifier:s}))},[n,s]);return e?r.jsx(Wr,{"aria-label":t("common.delete"),tooltip:t("common.delete"),onClick:o,icon:r.jsx(Xr,{}),isDestructive:!0,isDisabled:i}):r.jsx(he,{onClick:o,icon:r.jsx(Xr,{}),isDestructive:!0,isDisabled:i,children:t("common.delete")})});Ju.displayName="CanvasEntityMenuItemsDelete";const ed=u.memo(()=>{const{t:e}=P(),t=z(),n=Ke(),s=tt(),i=u.useCallback(()=>{t(lM({entityIdentifier:n}))},[t,n]);return r.jsx(Wr,{"aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),onClick:i,icon:r.jsx($E,{}),isDisabled:s})});ed.displayName="CanvasEntityMenuItemsDuplicate";const Rp=e=>{const t=u.useMemo(()=>e?Bq(e):()=>!1,[e]);return!I(t)},sy=e=>{const t=Tt(),n=po(e),s=Lt(),i=tt(),o=Ii(e),a=Rp(e),l=u.useMemo(()=>!!(!e||!Hb(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(()=>{if(l||!e||!Hb(e))return;const d=t.getAdapter(e);d&&(s.close(),d.filterer.start())},[l,e,t,s]);return{isDisabled:l,start:c}},Vw=u.memo(()=>{const{t:e}=P(),t=Ke(),n=sy(t);return r.jsx(he,{onClick:n.start,icon:r.jsx(wS,{}),isDisabled:n.isDisabled,children:e("controlLayers.filter.filter")})});Vw.displayName="CanvasEntityMenuItemsFilter";const l0e=e=>{const t=u.useMemo(()=>It(Je,s=>{const i=$q(s,e);return i?qs(i):null}),[e]);return I(t)},Op=u.memo(()=>{const{t:e}=P(),t=Tt(),n=tt(),s=Ke(),i=l0e(s),o=u.useCallback(()=>{i!==null&&t.compositor.mergeByEntityIdentifiers([i,s],!0)},[t.compositor,s,i]);return r.jsx(he,{onClick:o,icon:r.jsx(NE,{}),isDisabled:n||i===null,children:e("controlLayers.mergeDown")})});Op.displayName="CanvasEntityMenuItemsMergeDown";const P9=()=>{const e=I(Ar);return u.useCallback(async n=>{if(!n)return;const s=n.getCanvas(),i=await Z0(s),o=new File([i],`layer-${n.id}.png`,{type:"image/png"});ca({file:o,image_category:"user",is_intermediate:!1,board_id:e==="none"?void 0:e})},[e])},Np=u.memo(()=>{const{t:e}=P(),t=Ke(),n=po(t),s=tt(),i=P9(),o=u.useCallback(()=>{i(n)},[i,n]);return r.jsx(he,{onClick:o,icon:r.jsx(Ui,{}),isDisabled:s,children:e("controlLayers.saveLayerToAssets")})});Np.displayName="CanvasEntityMenuItemsSave";const E9=e=>{const t=Tt(),n=po(e),s=Lt(),i=tt(),o=Ii(e),a=Rp(e),l=u.useMemo(()=>!!(!e||!Wb(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(()=>{if(l||!e||!Wb(e))return;const d=t.getAdapter(e);d&&(s.close(),d.segmentAnything.start())},[l,e,t,s]);return{isDisabled:l,start:c}},Gw=u.memo(()=>{const{t:e}=P(),t=Ke(),n=E9(t);return r.jsx(he,{onClick:n.start,icon:r.jsx(HE,{}),isDisabled:n.isDisabled,children:e("controlLayers.selectObject.selectObject")})});Gw.displayName="CanvasEntityMenuItemsSelectObject";const zw=e=>{const t=Tt(),n=po(e),s=Lt(),i=tt(),o=Ii(e),a=Rp(e),l=u.useMemo(()=>!!(!e||!sm(e)||!n||i||o||a),[e,n,i,o,a]),c=u.useCallback(async()=>{if(l||!e||!sm(e))return;const h=t.getAdapter(e);h&&(s.close(),await h.transformer.startTransform())},[l,e,t,s]),d=u.useCallback(async()=>{if(l||!e||!sm(e))return;const h=t.getAdapter(e);h&&(s.close(),await h.transformer.startTransform({silent:!0}),h.transformer.fitToBboxContain(),await h.transformer.applyTransform())},[t,e,s,l]);return{isDisabled:l,start:c,fitToBbox:d}},Fp=u.memo(()=>{const{t:e}=P(),t=Ke(),n=zw(t);return r.jsxs(r.Fragment,{children:[r.jsx(he,{onClick:n.start,icon:r.jsx(vp,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.transform")}),r.jsx(he,{onClick:n.fitToBbox,icon:r.jsx(La,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.fitToBbox")})]})});Fp.displayName="CanvasEntityMenuItemsTransform";const L9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=z(),s=Ke("control_layer"),i=tt(),o=Ii(s),a=u.useCallback(()=>{n(cM({entityIdentifier:s,replace:!0}))},[n,s]),l=u.useCallback(()=>{n(uM({entityIdentifier:s,replace:!0}))},[n,s]),c=u.useCallback(()=>{n(dM({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Hr,{}),isDisabled:o||i,children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.convertControlLayerTo")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(he,{onClick:a,icon:r.jsx(Hr,{}),isDisabled:o||i,children:e("controlLayers.inpaintMask")}),r.jsx(he,{onClick:l,icon:r.jsx(Hr,{}),isDisabled:o||i,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{onClick:c,icon:r.jsx(Hr,{}),isDisabled:o||i,children:e("controlLayers.rasterLayer")})]})]})})});L9.displayName="ControlLayerMenuItemsConvertToSubMenu";const Bp=u.memo(()=>{const{t:e}=P(),t=Ke(),n=po(t),s=tt(),i=Rp(t),o=Jme(),a=u.useCallback(()=>{o(n)},[o,n]);return r.jsx(he,{onClick:a,icon:r.jsx(on,{}),isDisabled:s||i,children:e("common.clipboard")})});Bp.displayName="CanvasEntityMenuItemsCopyToClipboard";const D9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=z(),s=Ke("control_layer"),i=tt(),o=u.useCallback(()=>{n(cM({entityIdentifier:s}))},[n,s]),a=u.useCallback(()=>{n(uM({entityIdentifier:s}))},[n,s]),l=u.useCallback(()=>{n(dM({entityIdentifier:s}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(on,{}),isDisabled:i,children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.copyControlLayerTo")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(Bp,{}),r.jsx(he,{onClick:o,icon:r.jsx(on,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")}),r.jsx(he,{onClick:a,icon:r.jsx(on,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")}),r.jsx(he,{onClick:l,icon:r.jsx(on,{}),isDisabled:i,children:e("controlLayers.newRasterLayer")})]})]})})});D9.displayName="ControlLayerMenuItemsCopyToSubMenu";const c0e=e=>ve(Je,t=>Mr(t,e,"ControlLayerMenuItemsTransparencyEffect").withTransparencyEffect),R9=u.memo(()=>{const{t:e}=P(),t=z(),n=Ke("control_layer"),s=Ii(n),i=u.useMemo(()=>c0e(n),[n]),o=I(i),a=u.useCallback(()=>{t(Vq({entityIdentifier:n}))},[t,n]);return r.jsx(he,{onClick:a,icon:r.jsx(xoe,{}),isDisabled:s,children:e(o?"controlLayers.disableTransparencyEffect":"controlLayers.enableTransparencyEffect")})});R9.displayName="ControlLayerMenuItemsTransparencyEffect";const Hw=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(qu,{children:[r.jsx(Qu,{}),r.jsx(ed,{}),r.jsx(Ju,{asIcon:!0})]}),r.jsx(is,{}),r.jsx(Fp,{}),r.jsx(Vw,{}),r.jsx(Gw,{}),r.jsx(R9,{}),r.jsx(is,{}),r.jsx(Op,{}),r.jsx(D9,{}),r.jsx(L9,{}),r.jsx(Dp,{}),r.jsx(Np,{})]}));Hw.displayName="ControlLayerMenuItems";const O9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=z(),s=Ke("inpaint_mask"),i=tt(),o=Ii(s),a=u.useCallback(()=>{n(hM({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Hr,{}),isDisabled:i||o,children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.convertInpaintMaskTo")})}),r.jsx(kt,{...t.menuListProps,children:r.jsx(he,{onClick:a,icon:r.jsx(Hr,{}),isDisabled:i||o,children:e("controlLayers.regionalGuidance")})})]})})});O9.displayName="InpaintMaskMenuItemsConvertToSubMenu";const N9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=z(),s=Ke("inpaint_mask"),i=tt(),o=u.useCallback(()=>{n(hM({entityIdentifier:s}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(on,{}),isDisabled:i,children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.copyInpaintMaskTo")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(Bp,{}),r.jsx(he,{onClick:o,icon:r.jsx(on,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")})]})]})})});N9.displayName="InpaintMaskMenuItemsCopyToSubMenu";const Ww=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(qu,{children:[r.jsx(Qu,{}),r.jsx(ed,{}),r.jsx(Ju,{asIcon:!0})]}),r.jsx(is,{}),r.jsx(Fp,{}),r.jsx(is,{}),r.jsx(Op,{}),r.jsx(N9,{}),r.jsx(O9,{}),r.jsx(Dp,{}),r.jsx(Np,{})]}));Ww.displayName="InpaintMaskMenuItems";const F9=u.memo(()=>{const{t:e}=P(),t=Ke("reference_image"),n=T9(t),s=tt();return r.jsx(he,{onClick:n,icon:r.jsx(La,{}),isDisabled:s,children:e("controlLayers.pullBboxIntoReferenceImage")})});F9.displayName="IPAdapterMenuItemPullBbox";const Uw=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(qu,{children:[r.jsx(Qu,{}),r.jsx(ed,{}),r.jsx(Ju,{asIcon:!0})]}),r.jsx(is,{}),r.jsx(F9,{})]}));Uw.displayName="IPAdapterMenuItems";const B9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=z(),s=Ke("raster_layer"),i=tt(),o=Ii(s),a=u.useCallback(()=>{n(fM({entityIdentifier:s,replace:!0}))},[n,s]),l=u.useCallback(()=>{n(pM({entityIdentifier:s,replace:!0}))},[n,s]),c=u.useCallback(()=>{n(gM({entityIdentifier:s,replace:!0,overrides:{controlAdapter:ft(Bl)}}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Hr,{}),isDisabled:i||o,children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.convertRasterLayerTo")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(he,{onClick:a,icon:r.jsx(Hr,{}),isDisabled:i||o,children:e("controlLayers.inpaintMask")}),r.jsx(he,{onClick:l,icon:r.jsx(Hr,{}),isDisabled:i||o,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{onClick:c,icon:r.jsx(Hr,{}),isDisabled:i||o,children:e("controlLayers.controlLayer")})]})]})})});B9.displayName="RasterLayerMenuItemsConvertToSubMenu";const $9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=z(),s=Ke("raster_layer"),i=tt(),o=u.useCallback(()=>{n(fM({entityIdentifier:s}))},[n,s]),a=u.useCallback(()=>{n(pM({entityIdentifier:s}))},[n,s]),l=u.useCallback(()=>{n(gM({entityIdentifier:s,overrides:{controlAdapter:ft(Bl)}}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(on,{}),isDisabled:i,children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.copyRasterLayerTo")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(Bp,{}),r.jsx(he,{onClick:o,icon:r.jsx(on,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")}),r.jsx(he,{onClick:a,icon:r.jsx(on,{}),isDisabled:i,children:e("controlLayers.newRegionalGuidance")}),r.jsx(he,{onClick:l,icon:r.jsx(on,{}),isDisabled:i,children:e("controlLayers.newControlLayer")})]})]})})});$9.displayName="RasterLayerMenuItemsCopyToSubMenu";const qw=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(qu,{children:[r.jsx(Qu,{}),r.jsx(ed,{}),r.jsx(Ju,{asIcon:!0})]}),r.jsx(is,{}),r.jsx(Fp,{}),r.jsx(Vw,{}),r.jsx(Gw,{}),r.jsx(is,{}),r.jsx(Op,{}),r.jsx($9,{}),r.jsx(B9,{}),r.jsx(Dp,{}),r.jsx(Np,{})]}));qw.displayName="RasterLayerMenuItems";const V9=u.memo(()=>{const e=Ke("regional_guidance"),{t}=P(),n=tt(),s=nE(e),i=sE(e),o=rE(e),a=u.useMemo(()=>iE(e),[e]),l=I(a);return r.jsxs(r.Fragment,{children:[r.jsx(he,{onClick:i,isDisabled:!l.canAddPositivePrompt||n,children:t("controlLayers.addPositivePrompt")}),r.jsx(he,{onClick:o,isDisabled:!l.canAddNegativePrompt||n,children:t("controlLayers.addNegativePrompt")}),r.jsx(he,{onClick:s,isDisabled:n,children:t("controlLayers.addReferenceImage")})]})});V9.displayName="RegionalGuidanceMenuItemsExtra";const G9=u.memo(()=>{const e=Ke("regional_guidance"),{t}=P(),n=z(),s=u.useMemo(()=>ve(Je,a=>Mr(a,e,"RegionalGuidanceMenuItemsAutoNegative").autoNegative),[e]),i=I(s),o=u.useCallback(()=>{n(Gq({entityIdentifier:e}))},[n,e]);return r.jsx(he,{icon:r.jsx(Boe,{}),onClick:o,children:t(i?"controlLayers.disableAutoNegative":"controlLayers.enableAutoNegative")})});G9.displayName="RegionalGuidanceMenuItemsAutoNegative";const z9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=z(),s=Ke("regional_guidance"),i=tt(),o=Ii(s),a=u.useCallback(()=>{n(mM({entityIdentifier:s,replace:!0}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(Hr,{}),isDisabled:o||i,children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.convertRegionalGuidanceTo")})}),r.jsx(kt,{...t.menuListProps,children:r.jsx(he,{onClick:a,icon:r.jsx(Hr,{}),isDisabled:o||i,children:e("controlLayers.inpaintMask")})})]})})});z9.displayName="RegionalGuidanceMenuItemsConvertToSubMenu";const H9=u.memo(()=>{const{t:e}=P(),t=Qs(),n=z(),s=Ke("regional_guidance"),i=tt(),o=u.useCallback(()=>{n(mM({entityIdentifier:s}))},[n,s]);return r.jsx(he,{...t.parentMenuItemProps,icon:r.jsx(on,{}),isDisabled:i,children:r.jsxs(Qt,{...t.menuProps,children:[r.jsx(Jt,{...t.menuButtonProps,children:r.jsx(Js,{label:e("controlLayers.copyRegionalGuidanceTo")})}),r.jsxs(kt,{...t.menuListProps,children:[r.jsx(Bp,{}),r.jsx(he,{onClick:o,icon:r.jsx(on,{}),isDisabled:i,children:e("controlLayers.newInpaintMask")})]})]})})});H9.displayName="RegionalGuidanceMenuItemsCopyToSubMenu";const Kw=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(qu,{children:[r.jsx(Qu,{}),r.jsx(ed,{}),r.jsx(Ju,{asIcon:!0})]}),r.jsx(is,{}),r.jsx(V9,{}),r.jsx(is,{}),r.jsx(Fp,{}),r.jsx(G9,{}),r.jsx(is,{}),r.jsx(Op,{}),r.jsx(H9,{}),r.jsx(z9,{}),r.jsx(Dp,{}),r.jsx(Np,{})]}));Kw.displayName="RegionalGuidanceMenuItems";const W9=(e,t=!1)=>{const{t:n}=P();return u.useMemo(()=>{switch(e){case"control_layer":return n(t?"controlLayers.controlLayer_withCount_other":"controlLayers.controlLayer");case"raster_layer":return n(t?"controlLayers.rasterLayer_withCount_other":"controlLayers.rasterLayer");case"inpaint_mask":return n(t?"controlLayers.inpaintMask_withCount_other":"controlLayers.inpaintMask");case"regional_guidance":return n(t?"controlLayers.regionalGuidance_withCount_other":"controlLayers.regionalGuidance");case"reference_image":return n(t?"controlLayers.globalReferenceImage_withCount_other":"controlLayers.globalReferenceImage");default:return""}},[e,t,n])},U9=u.memo(()=>{const e=Ke();if(e.type==="raster_layer")return r.jsx(qw,{});if(e.type==="control_layer")return r.jsx(Hw,{});if(e.type==="inpaint_mask")return r.jsx(Ww,{});if(e.type==="regional_guidance")return r.jsx(Kw,{});if(e.type==="reference_image")return r.jsx(Uw,{});Re(!1)});U9.displayName="CanvasContextMenuSelectedEntityMenuItemsContent";const q9=u.memo(e=>{const t=Ke(),n=W9(t.type);return r.jsx(Cr,{title:n,children:e.children})});q9.displayName="CanvasContextMenuSelectedEntityMenuGroup";const K9=u.memo(()=>{const e=I(kn);return e?r.jsx(Ql.Provider,{value:e,children:r.jsx(Wo,{entityIdentifier:e,children:r.jsx(q9,{children:r.jsx(U9,{})})})}):null});K9.displayName="CanvasContextMenuSelectedEntityMenuItems";const n2="drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))",Z9=(e,t)=>{if(e.width===0||e.height===0)return{width:t.width,height:t.height};if(t.width<=e.width&&t.height<=e.height)return{width:t.width,height:t.height};const n=e.width/e.height,s=t.width/t.height;let i,o;return s>n?(i=e.width,o=i/s):(o=e.height,i=o*s),{width:i,height:o}},Y9=(e,t,n,s)=>{const i=e==="fill"?t.width:t.width*s.width/n.width,o=e==="fill"?t.height:t.height*s.height/n.height;return{width:i,height:o}},X9=It(kr,e=>{const t=e.selection.slice(-1)[0]??null,n=e.imageToCompare;return{firstImage:t,secondImage:n}}),u0e=nr("dnd"),Dr=e=>{const t=Symbol(e);return{type:e,key:t}},Rr=e=>n=>!!n[e],Or=(e,t)=>(s,i)=>({[e]:!0,id:i??_e(t),type:t,payload:s}),jg=Dr("single-image"),wn={...jg,typeGuard:Rr(jg.key),getData:Or(jg.key,jg.type)},kg=Dr("multiple-image"),Zr={...kg,typeGuard:Rr(kg.key),getData:Or(kg.key,kg.type)},_g=Dr("single-canvas-entity"),nu={..._g,typeGuard:Rr(_g.key),getData:Or(_g.key,_g.type)},Ig=Dr("set-global-reference-image"),jf={...Ig,typeGuard:Rr(Ig.key),getData:Or(Ig.key,Ig.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:i}=t.payload;fE({entityIdentifier:i,imageDTO:s,dispatch:n})}},Ag=Dr("set-regional-guidance-reference-image"),kf={...Ag,typeGuard:Rr(Ag.key),getData:Or(Ag.key,Ag.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{entityIdentifier:i,referenceImageId:o}=t.payload;pE({imageDTO:s,entityIdentifier:i,referenceImageId:o,dispatch:n})}},Tg=Dr("set-upscale-initial-image"),s2={...Tg,typeGuard:Rr(Tg.key),getData:Or(Tg.key,Tg.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;Wie({imageDTO:n,dispatch:t})}},Mg=Dr("set-node-image-field-image"),r2={...Mg,typeGuard:Rr(Mg.key),getData:Or(Mg.key,Mg.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n})=>{const{imageDTO:s}=e.payload,{fieldIdentifier:i}=t.payload;Uie({fieldIdentifier:i,imageDTO:s,dispatch:n})}},Pg=Dr("add-images-to-image-collection-node-field"),i2={...Pg,typeGuard:Rr(Pg.key),getData:Or(Pg.key,Pg.type),isValid:({sourceData:e})=>!!(wn.typeGuard(e)||Zr.typeGuard(e)),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{if(!wn.typeGuard(e)&&!Zr.typeGuard(e))return;const{fieldIdentifier:i}=t.payload,o=Y0(ot(s()),i.nodeId,i.fieldName);if(!wC(o)){u0e.warn({fieldIdentifier:i},"Attempted to add images to a non-image field collection");return}const a=o.value?[...o.value]:[];wn.typeGuard(e)?a.push({image_name:e.payload.imageDTO.image_name}):a.push(...e.payload.imageDTOs.map(({image_name:l})=>({image_name:l}))),n(Ub({...i,value:a}))}},Eg=Dr("set-comparison-image"),o2={...Eg,typeGuard:Rr(Eg.key),getData:Or(Eg.key,Eg.type),isValid:({sourceData:e,getState:t})=>{if(!wn.typeGuard(e))return!1;const{firstImage:n,secondImage:s}=X9(t());return!(e.payload.imageDTO.image_name===(n==null?void 0:n.image_name)||e.payload.imageDTO.image_name===(s==null?void 0:s.image_name))},handler:({sourceData:e,dispatch:t})=>{const{imageDTO:n}=e.payload;qie({imageDTO:n,dispatch:t})}},Lg=Dr("new-canvas-entity-from-image"),Po={...Lg,typeGuard:Rr(Lg.key),getData:Or(Lg.key,Lg.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{type:i}=t.payload,{imageDTO:o}=e.payload;Vr({type:i,imageDTO:o,dispatch:n,getState:s})}},Dg=Dr("replace-canvas-entity-objects-with-image"),_f={...Dg,typeGuard:Rr(Dg.key),getData:Or(Dg.key,Dg.type),isValid:({sourceData:e})=>!!wn.typeGuard(e),handler:({sourceData:e,targetData:t,dispatch:n,getState:s})=>{const{imageDTO:i}=e.payload,{entityIdentifier:o}=t.payload;yS({imageDTO:i,entityIdentifier:o,dispatch:n,getState:s})}},Rg=Dr("add-to-board"),g0={...Rg,typeGuard:Rr(Rg.key),getData:Or(Rg.key,Rg.type),isValid:({sourceData:e,targetData:t})=>{if(wn.typeGuard(e)){const n=e.payload.imageDTO.board_id??"none",s=t.payload.boardId;return n!==s}if(Zr.typeGuard(e)){const n=e.payload.boardId,s=t.payload.boardId;return n!==s}return!1},handler:({sourceData:e,targetData:t,dispatch:n})=>{if(wn.typeGuard(e)){const{imageDTO:s}=e.payload,{boardId:i}=t.payload;O4({imageDTOs:[s],boardId:i,dispatch:n})}if(Zr.typeGuard(e)){const{imageDTOs:s}=e.payload,{boardId:i}=t.payload;O4({imageDTOs:s,boardId:i,dispatch:n})}}},Og=Dr("remove-from-board"),m0={...Og,typeGuard:Rr(Og.key),getData:Or(Og.key,Og.type),isValid:({sourceData:e})=>wn.typeGuard(e)?(e.payload.imageDTO.board_id??"none")!=="none":Zr.typeGuard(e)?e.payload.boardId!=="none":!1,handler:({sourceData:e,dispatch:t})=>{if(wn.typeGuard(e)){const{imageDTO:n}=e.payload;N4({imageDTOs:[n],dispatch:t})}if(Zr.typeGuard(e)){const{imageDTOs:n}=e.payload;N4({imageDTOs:n,dispatch:t})}}},d0e=[jf,kf,s2,r2,o2,Po,_f,g0,m0,g0,m0,i2],h0e={position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",pointerEvents:"auto",'&[data-dnd-state="idle"]':{pointerEvents:"none"}},vs=u.memo(e=>{const{dndTarget:t,dndTargetData:n,label:s,isDisabled:i}=e,[o,a]=u.useState("idle"),l=u.useRef(null),c=z();return u.useEffect(()=>{const d=l.current;if(!d||i)return;const{dispatch:h,getState:f}=ut();return Kn(yu({element:d,canDrop:({source:p})=>{const g={sourceData:p.data,targetData:n,dispatch:h,getState:f};return t.isValid(g)},onDragEnter:()=>{a("over")},onDragLeave:()=>{a("potential")},getData:()=>n}),qi({canMonitor:({source:p})=>{const g={sourceData:p.data,targetData:n,dispatch:h,getState:f};return t.isValid(g)},onDragStart:()=>{a("potential")},onDrop:()=>{a("idle")}}))},[c,i,t,n]),r.jsx(ke,{ref:l,sx:h0e,"data-dnd-state":o,children:r.jsx(hf,{dndState:o,label:s})})});vs.displayName="DndDropTarget";const f0e=Po.getData({type:"raster_layer"}),p0e=Po.getData({type:"control_layer"}),g0e=Po.getData({type:"regional_guidance_with_reference_image"}),m0e=Po.getData({type:"reference_image"}),Q9=u.memo(()=>{const{t:e}=P(),t=Lt(),n=tt();return t.isOpen?null:r.jsx(r.Fragment,{children:r.jsxs(Kr,{gridTemplateRows:"1fr 1fr",gridTemplateColumns:"1fr 1fr",position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:[r.jsx(Rt,{position:"relative",children:r.jsx(vs,{dndTarget:Po,dndTargetData:f0e,label:e("controlLayers.canvasContextMenu.newRasterLayer"),isDisabled:n})}),r.jsx(Rt,{position:"relative",children:r.jsx(vs,{dndTarget:Po,dndTargetData:p0e,label:e("controlLayers.canvasContextMenu.newControlLayer"),isDisabled:n})}),r.jsx(Rt,{position:"relative",children:r.jsx(vs,{dndTarget:Po,dndTargetData:g0e,label:e("controlLayers.canvasContextMenu.newRegionalReferenceImage"),isDisabled:n})}),r.jsx(Rt,{position:"relative",children:r.jsx(vs,{dndTarget:Po,dndTargetData:m0e,label:e("controlLayers.canvasContextMenu.newGlobalReferenceImage"),isDisabled:n})})]})})});Q9.displayName="CanvasDropArea";const Zw=u.memo(()=>{const{t:e}=P(),t=z(),n=I(Jf),s=u.useCallback(()=>{t(zq())},[t]);return r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:e("controlLayers.filter.autoProcess")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})});Zw.displayName="CanvasAutoProcessSwitch";const ry=u.memo(()=>{const{t:e}=P(),t=z(),n=I(Mm),s=u.useCallback(()=>{t(yM())},[t]);return r.jsx(Le,{label:e("controlLayers.settings.isolatedLayerPreviewDesc"),children:r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:e("controlLayers.settings.isolatedPreview")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})})});ry.displayName="CanvasOperationIsolatedLayerPreviewSwitch";const J9=$e.enum(["Red (RGBA)","Green (RGBA)","Blue (RGBA)","Alpha (RGBA)","Cyan (CMYK)","Magenta (CMYK)","Yellow (CMYK)","Black (CMYK)","Hue (HSV)","Saturation (HSV)","Value (HSV)","Luminosity (LAB)","A (LAB)","B (LAB)","Y (YCbCr)","Cb (YCbCr)","Cr (YCbCr)"]),y0e=e=>J9.safeParse(e).success,v0e=$e.object({type:$e.literal("adjust_image"),channel:J9,value:$e.number(),scale_values:$e.boolean().optional()}),b0e=$e.object({type:$e.literal("canny_edge_detection"),low_threshold:$e.number().int().gte(0).lte(255),high_threshold:$e.number().int().gte(0).lte(255)}),x0e=$e.object({type:$e.literal("color_map"),tile_size:$e.number().int().gte(1)}),C0e=$e.object({type:$e.literal("content_shuffle"),scale_factor:$e.number().int().gte(1)}),eO=$e.enum(["large","base","small","small_v2"]),S0e=e=>eO.safeParse(e).success,w0e=$e.object({type:$e.literal("depth_anything_depth_estimation"),model_size:eO}),j0e=$e.object({type:$e.literal("hed_edge_detection"),scribble:$e.boolean()}),k0e=$e.object({type:$e.literal("lineart_anime_edge_detection")}),_0e=$e.object({type:$e.literal("lineart_edge_detection"),coarse:$e.boolean()}),I0e=$e.object({type:$e.literal("mediapipe_face_detection"),max_faces:$e.number().int().gte(1),min_confidence:$e.number().gte(0).lte(1)}),A0e=$e.object({type:$e.literal("mlsd_detection"),score_threshold:$e.number().gte(0),distance_threshold:$e.number().gte(0)}),T0e=$e.object({type:$e.literal("normal_map")}),M0e=$e.object({type:$e.literal("pidi_edge_detection"),quantize_edges:$e.boolean(),scribble:$e.boolean()}),P0e=$e.object({type:$e.literal("dw_openpose_detection"),draw_body:$e.boolean(),draw_face:$e.boolean(),draw_hands:$e.boolean()}),E0e=$e.object({type:$e.literal("spandrel_filter"),model:Rs.nullable(),autoScale:$e.boolean(),scale:$e.number().gte(1).lte(16)}),tO=$e.enum(["gaussian","box"]),L0e=e=>tO.safeParse(e).success,D0e=$e.object({type:$e.literal("img_blur"),blur_type:tO,radius:$e.number().gte(0)}),nO=$e.enum(["gaussian","salt_and_pepper"]),R0e=e=>nO.safeParse(e).success,O0e=$e.object({type:$e.literal("img_noise"),noise_type:nO,amount:$e.number().gte(0).lte(1),noise_color:$e.boolean(),size:$e.number().int().gte(1)});$e.discriminatedUnion("type",[v0e,b0e,x0e,C0e,w0e,j0e,k0e,_0e,I0e,A0e,T0e,M0e,P0e,E0e,D0e,O0e]);const N0e=$e.enum(["adjust_image","canny_edge_detection","color_map","content_shuffle","depth_anything_depth_estimation","hed_edge_detection","lineart_anime_edge_detection","lineart_edge_detection","mediapipe_face_detection","mlsd_detection","normal_map","pidi_edge_detection","dw_openpose_detection","spandrel_filter","img_blur","img_noise"]),sO=e=>N0e.safeParse(e).success,En={adjust_image:{type:"adjust_image",buildDefaults:()=>({type:"adjust_image",channel:"Luminosity (LAB)",value:1,scale_values:!1}),buildGraph:({image_name:e},{channel:t,value:n,scale_values:s})=>{const i=new ts(_e("adjust_image_filter"));let o;return s?o=i.addNode({id:_e("img_channel_multiply"),type:"img_channel_multiply",image:{image_name:e},channel:t,scale:n,invert_channel:!1}):(n=Math.min(n,2),o=i.addNode({id:_e("img_channel_offset"),type:"img_channel_offset",image:{image_name:e},channel:t,offset:Math.round(255*(n-1))})),{graph:i,outputNodeId:o.id}}},canny_edge_detection:{type:"canny_edge_detection",buildDefaults:()=>({type:"canny_edge_detection",low_threshold:100,high_threshold:200}),buildGraph:({image_name:e},{low_threshold:t,high_threshold:n})=>{const s=new ts(_e("canny_edge_detection_filter")),i=s.addNode({id:_e("canny_edge_detection"),type:"canny_edge_detection",image:{image_name:e},low_threshold:t,high_threshold:n});return{graph:s,outputNodeId:i.id}}},color_map:{type:"color_map",buildDefaults:()=>({type:"color_map",tile_size:64}),buildGraph:({image_name:e},{tile_size:t})=>{const n=new ts(_e("color_map_filter")),s=n.addNode({id:_e("color_map"),type:"color_map",image:{image_name:e},tile_size:t});return{graph:n,outputNodeId:s.id}}},content_shuffle:{type:"content_shuffle",buildDefaults:()=>({type:"content_shuffle",scale_factor:256}),buildGraph:({image_name:e},{scale_factor:t})=>{const n=new ts(_e("content_shuffle_filter")),s=n.addNode({id:_e("content_shuffle"),type:"content_shuffle",image:{image_name:e},scale_factor:t});return{graph:n,outputNodeId:s.id}}},depth_anything_depth_estimation:{type:"depth_anything_depth_estimation",buildDefaults:()=>({type:"depth_anything_depth_estimation",model_size:"small_v2"}),buildGraph:({image_name:e},{model_size:t})=>{const n=new ts(_e("depth_anything_depth_estimation_filter")),s=n.addNode({id:_e("depth_anything_depth_estimation"),type:"depth_anything_depth_estimation",image:{image_name:e},model_size:t});return{graph:n,outputNodeId:s.id}}},hed_edge_detection:{type:"hed_edge_detection",buildDefaults:()=>({type:"hed_edge_detection",scribble:!1}),buildGraph:({image_name:e},{scribble:t})=>{const n=new ts(_e("hed_edge_detection_filter")),s=n.addNode({id:_e("hed_edge_detection"),type:"hed_edge_detection",image:{image_name:e},scribble:t});return{graph:n,outputNodeId:s.id}}},lineart_anime_edge_detection:{type:"lineart_anime_edge_detection",buildDefaults:()=>({type:"lineart_anime_edge_detection"}),buildGraph:({image_name:e})=>{const t=new ts(_e("lineart_anime_edge_detection_filter")),n=t.addNode({id:_e("lineart_anime_edge_detection"),type:"lineart_anime_edge_detection",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},lineart_edge_detection:{type:"lineart_edge_detection",buildDefaults:()=>({type:"lineart_edge_detection",coarse:!1}),buildGraph:({image_name:e},{coarse:t})=>{const n=new ts(_e("lineart_edge_detection_filter")),s=n.addNode({id:_e("lineart_edge_detection"),type:"lineart_edge_detection",image:{image_name:e},coarse:t});return{graph:n,outputNodeId:s.id}}},mediapipe_face_detection:{type:"mediapipe_face_detection",buildDefaults:()=>({type:"mediapipe_face_detection",max_faces:1,min_confidence:.5}),buildGraph:({image_name:e},{max_faces:t,min_confidence:n})=>{const s=new ts(_e("mediapipe_face_detection_filter")),i=s.addNode({id:_e("mediapipe_face_detection"),type:"mediapipe_face_detection",image:{image_name:e},max_faces:t,min_confidence:n});return{graph:s,outputNodeId:i.id}}},mlsd_detection:{type:"mlsd_detection",buildDefaults:()=>({type:"mlsd_detection",score_threshold:.1,distance_threshold:20}),buildGraph:({image_name:e},{score_threshold:t,distance_threshold:n})=>{const s=new ts(_e("mlsd_detection_filter")),i=s.addNode({id:_e("mlsd_detection"),type:"mlsd_detection",image:{image_name:e},score_threshold:t,distance_threshold:n});return{graph:s,outputNodeId:i.id}}},normal_map:{type:"normal_map",buildDefaults:()=>({type:"normal_map"}),buildGraph:({image_name:e})=>{const t=new ts(_e("normal_map_filter")),n=t.addNode({id:_e("normal_map"),type:"normal_map",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},pidi_edge_detection:{type:"pidi_edge_detection",buildDefaults:()=>({type:"pidi_edge_detection",quantize_edges:!1,scribble:!1}),buildGraph:({image_name:e},{quantize_edges:t,scribble:n})=>{const s=new ts(_e("pidi_edge_detection_filter")),i=s.addNode({id:_e("pidi_edge_detection"),type:"pidi_edge_detection",image:{image_name:e},quantize_edges:t,scribble:n});return{graph:s,outputNodeId:i.id}}},dw_openpose_detection:{type:"dw_openpose_detection",buildDefaults:()=>({type:"dw_openpose_detection",draw_body:!0,draw_face:!0,draw_hands:!0}),buildGraph:({image_name:e},{draw_body:t,draw_face:n,draw_hands:s})=>{const i=new ts(_e("dw_openpose_detection_filter")),o=i.addNode({id:_e("dw_openpose_detection"),type:"dw_openpose_detection",image:{image_name:e},draw_body:t,draw_face:n,draw_hands:s});return{graph:i,outputNodeId:o.id}}},spandrel_filter:{type:"spandrel_filter",buildDefaults:()=>({type:"spandrel_filter",model:null,autoScale:!0,scale:1}),buildGraph:({image_name:e},{model:t,scale:n,autoScale:s})=>{Re(t!==null);const i=new ts(_e("spandrel_filter")),o=i.addNode(s?{id:_e("spandrel_image_to_image_autoscale"),type:"spandrel_image_to_image_autoscale",image_to_image_model:t,image:{image_name:e},scale:n}:{id:_e("spandrel_image_to_image"),type:"spandrel_image_to_image",image_to_image_model:t,image:{image_name:e}});return{graph:i,outputNodeId:o.id}},validateConfig:e=>!!e.model},img_blur:{type:"img_blur",buildDefaults:()=>({type:"img_blur",blur_type:"gaussian",radius:8}),buildGraph:({image_name:e},{blur_type:t,radius:n})=>{const s=new ts(_e("img_blur")),i=s.addNode({id:_e("img_blur"),type:"img_blur",image:{image_name:e},blur_type:t,radius:n});return{graph:s,outputNodeId:i.id}}},img_noise:{type:"img_noise",buildDefaults:()=>({type:"img_noise",noise_type:"gaussian",amount:.3,noise_color:!0,size:1}),buildGraph:({image_name:e},{noise_type:t,amount:n,noise_color:s,size:i})=>{const o=new ts(_e("img_noise")),a=o.addNode({id:_e("img_noise"),type:"img_noise",image:{image_name:e},noise_type:t,amount:n,noise_color:s,size:i}),l=o.addNode({id:_e("rand_int"),use_cache:!1,type:"rand_int",low:0,high:2147483647});return o.addEdge(l,"value",a,"seed"),{graph:o,outputNodeId:a.id}}}},F0e={canny_image_processor:"canny_edge_detection",mlsd_image_processor:"mlsd_detection",depth_anything_image_processor:"depth_anything_depth_estimation",normalbae_image_processor:"normal_map",pidi_image_processor:"pidi_edge_detection",lineart_image_processor:"lineart_edge_detection",lineart_anime_image_processor:"lineart_anime_edge_detection",hed_image_processor:"hed_edge_detection",content_shuffle_image_processor:"content_shuffle",dw_openpose_image_processor:"dw_openpose_detection",mediapipe_face_processor:"mediapipe_face_detection",zoe_depth_image_processor:"depth_anything_depth_estimation",color_map_image_processor:"color_map"},rO=e=>{var s;if(!e)return null;const t=(s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor;if(!t)return null;if(sO(t))return En[t];const n=F0e[t];return n?En[n]:null},Hv=En.adjust_image.buildDefaults(),iO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(c=>{y0e(c==null?void 0:c.value)&&e({...t,channel:c.value})},[t,e]),i=u.useCallback(c=>{e({...t,value:c})},[t,e]),o=u.useCallback(c=>{e({...t,scale_values:c.target.checked})},[t,e]),a=u.useMemo(()=>[{label:n("controlLayers.filter.adjust_image.red"),value:"Red (RGBA)"},{label:n("controlLayers.filter.adjust_image.green"),value:"Green (RGBA)"},{label:n("controlLayers.filter.adjust_image.blue"),value:"Blue (RGBA)"},{label:n("controlLayers.filter.adjust_image.alpha"),value:"Alpha (RGBA)"},{label:n("controlLayers.filter.adjust_image.cyan"),value:"Cyan (CMYK)"},{label:n("controlLayers.filter.adjust_image.magenta"),value:"Magenta (CMYK)"},{label:n("controlLayers.filter.adjust_image.yellow"),value:"Yellow (CMYK)"},{label:n("controlLayers.filter.adjust_image.black"),value:"Black (CMYK)"},{label:n("controlLayers.filter.adjust_image.hue"),value:"Hue (HSV)"},{label:n("controlLayers.filter.adjust_image.saturation"),value:"Saturation (HSV)"},{label:n("controlLayers.filter.adjust_image.value"),value:"Value (HSV)"},{label:n("controlLayers.filter.adjust_image.luminosity"),value:"Luminosity (LAB)"},{label:n("controlLayers.filter.adjust_image.a"),value:"A (LAB)"},{label:n("controlLayers.filter.adjust_image.b"),value:"B (LAB)"},{label:n("controlLayers.filter.adjust_image.y"),value:"Y (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cb"),value:"Cb (YCbCr)"},{label:n("controlLayers.filter.adjust_image.cr"),value:"Cr (YCbCr)"}],[n]),l=u.useMemo(()=>a.filter(c=>c.value===t.channel)[0],[a,t.channel]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.adjust_image.channel")}),r.jsx(Fe,{value:l,options:a,onChange:s,isSearchable:!1})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.adjust_image.value_setting")}),r.jsx(qe,{value:t.value,defaultValue:Hv.value,onChange:i,min:0,max:2,step:.0025,marks:!0}),r.jsx(Ae,{value:t.value,defaultValue:Hv.value,onChange:i,min:0,max:255,step:.0025})]}),r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.adjust_image.scale_values")}),r.jsx(it,{defaultChecked:Hv.scale_values,isChecked:t.scale_values,onChange:o})]})]})});iO.displayName="FilterAdjustImage";const I6=En.img_blur.buildDefaults(),oO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(l=>{L0e(l==null?void 0:l.value)&&e({...t,blur_type:l.value})},[t,e]),i=u.useCallback(l=>{e({...t,radius:l})},[t,e]),o=u.useMemo(()=>[{label:n("controlLayers.filter.img_blur.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_blur.box_type"),value:"box"}],[n]),a=u.useMemo(()=>o.filter(l=>l.value===t.blur_type)[0],[o,t.blur_type]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_blur.blur_type")}),r.jsx(Fe,{value:a,options:o,onChange:s,isSearchable:!1})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_blur.blur_radius")}),r.jsx(qe,{value:t.radius,defaultValue:I6.radius,onChange:i,min:1,max:64,step:.1,marks:!0}),r.jsx(Ae,{value:t.radius,defaultValue:I6.radius,onChange:i,min:1,max:4096,step:.1})]})]})});oO.displayName="FilterBlur";const Ng=En.canny_edge_detection.buildDefaults(),aO=({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(o=>{e({...t,low_threshold:o})},[e,t]),i=u.useCallback(o=>{e({...t,high_threshold:o})},[e,t]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.canny_edge_detection.low_threshold")}),r.jsx(qe,{value:t.low_threshold,onChange:s,defaultValue:Ng.low_threshold,min:0,max:255}),r.jsx(Ae,{value:t.low_threshold,onChange:s,defaultValue:Ng.low_threshold,min:0,max:255})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.canny_edge_detection.high_threshold")}),r.jsx(qe,{value:t.high_threshold,onChange:i,defaultValue:Ng.high_threshold,min:0,max:255}),r.jsx(Ae,{value:t.high_threshold,onChange:i,defaultValue:Ng.high_threshold,min:0,max:255})]})]})};aO.displayName="FilterCannyEdgeDetection";const A6=En.color_map.buildDefaults(),lO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(i=>{e({...t,tile_size:i})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.color_map.tile_size")}),r.jsx(qe,{value:t.tile_size,defaultValue:A6.tile_size,onChange:s,min:1,max:256,step:1,marks:!0}),r.jsx(Ae,{value:t.tile_size,defaultValue:A6.tile_size,onChange:s,min:1,max:4096,step:1})]})})});lO.displayName="FilterColorMap";const T6=En.content_shuffle.buildDefaults(),cO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(i=>{e({...t,scale_factor:i})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.content_shuffle.scale_factor")}),r.jsx(qe,{value:t.scale_factor,defaultValue:T6.scale_factor,onChange:s,min:0,max:4096,marks:!0}),r.jsx(Ae,{value:t.scale_factor,defaultValue:T6.scale_factor,onChange:s,min:0,max:4096})]})})});cO.displayName="FilterContentShuffle";const uO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(a=>{S0e(a==null?void 0:a.value)&&e({...t,model_size:a.value})},[t,e]),i=u.useMemo(()=>[{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small_v2"),value:"small_v2"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small"),value:"small"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_base"),value:"base"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_large"),value:"large"}],[n]),o=u.useMemo(()=>i.filter(a=>a.value===t.model_size)[0],[i,t.model_size]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.depth_anything_depth_estimation.model_size")}),r.jsx(Fe,{value:o,options:i,onChange:s,isSearchable:!1})]})})});uO.displayName="FilterDepthAnythingDepthEstimation";const Wv=En.dw_openpose_detection.buildDefaults(),dO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(a=>{e({...t,draw_body:a.target.checked})},[t,e]),i=u.useCallback(a=>{e({...t,draw_face:a.target.checked})},[t,e]),o=u.useCallback(a=>{e({...t,draw_hands:a.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(T,{sx:{flexDir:"row",gap:6},children:[r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_body")}),r.jsx(it,{defaultChecked:Wv.draw_body,isChecked:t.draw_body,onChange:s})]}),r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_face")}),r.jsx(it,{defaultChecked:Wv.draw_face,isChecked:t.draw_face,onChange:i})]}),r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_hands")}),r.jsx(it,{defaultChecked:Wv.draw_hands,isChecked:t.draw_hands,onChange:o})]})]})})});dO.displayName="FilterDWOpenposeDetection";const hO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(i=>{e({...t,scribble:i.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.hed_edge_detection.scribble")}),r.jsx(it,{isChecked:t.scribble,onChange:s})]})})});hO.displayName="FilterHEDEdgeDetection";const fO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(i=>{e({...t,coarse:i.target.checked})},[t,e]);return r.jsx(r.Fragment,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.lineart_edge_detection.coarse")}),r.jsx(it,{isChecked:t.coarse,onChange:s})]})})});fO.displayName="FilterLineartEdgeDetection";const Fg=En.mediapipe_face_detection.buildDefaults(),pO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(o=>{e({...t,max_faces:o})},[t,e]),i=u.useCallback(o=>{e({...t,min_confidence:o})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.max_faces")}),r.jsx(qe,{value:t.max_faces,onChange:s,defaultValue:Fg.max_faces,min:1,max:20,marks:!0}),r.jsx(Ae,{value:t.max_faces,onChange:s,defaultValue:Fg.max_faces,min:1,max:20})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.min_confidence")}),r.jsx(qe,{value:t.min_confidence,onChange:i,defaultValue:Fg.min_confidence,min:0,max:1,step:.01,marks:!0}),r.jsx(Ae,{value:t.min_confidence,onChange:i,defaultValue:Fg.min_confidence,min:0,max:1,step:.01})]})]})});pO.displayName="FilterMediaPipeFaceDetection";const Bg=En.mlsd_detection.buildDefaults(),gO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(o=>{e({...t,distance_threshold:o})},[t,e]),i=u.useCallback(o=>{e({...t,score_threshold:o})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsxs(te,{m:0,children:[n("controlLayers.filter.mlsd_detection.score_threshold")," "]}),r.jsx(qe,{value:t.score_threshold,onChange:i,defaultValue:Bg.score_threshold,min:0,max:1,step:.01,marks:!0}),r.jsx(Ae,{value:t.score_threshold,onChange:i,defaultValue:Bg.score_threshold,min:0,max:1,step:.01})]}),r.jsxs(Z,{children:[r.jsxs(te,{m:0,children:[n("controlLayers.filter.mlsd_detection.distance_threshold")," "]}),r.jsx(qe,{value:t.distance_threshold,onChange:s,defaultValue:Bg.distance_threshold,min:0,max:100,step:1,marks:!0}),r.jsx(Ae,{value:t.distance_threshold,onChange:s,defaultValue:Bg.distance_threshold,min:0,max:1e3,step:1})]})]})});gO.displayName="FilterMLSDDetection";const uh=En.img_noise.buildDefaults(),mO=u.memo(({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(d=>{R0e(d==null?void 0:d.value)&&e({...t,noise_type:d.value})},[t,e]),i=u.useCallback(d=>{e({...t,amount:d})},[t,e]),o=u.useCallback(d=>{e({...t,noise_color:d.target.checked})},[t,e]),a=u.useCallback(d=>{e({...t,size:d})},[t,e]),l=u.useMemo(()=>[{label:n("controlLayers.filter.img_noise.gaussian_type"),value:"gaussian"},{label:n("controlLayers.filter.img_noise.salt_and_pepper_type"),value:"salt_and_pepper"}],[n]),c=u.useMemo(()=>l.filter(d=>d.value===t.noise_type)[0],[l,t.noise_type]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_noise.noise_type")}),r.jsx(Fe,{value:c,options:l,onChange:s,isSearchable:!1})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_noise.noise_amount")}),r.jsx(qe,{value:t.amount,defaultValue:uh.amount,onChange:i,min:0,max:1,step:.01,marks:!0}),r.jsx(Ae,{value:t.amount,defaultValue:uh.amount,onChange:i,min:0,max:1,step:.01})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_noise.size")}),r.jsx(qe,{value:t.size,defaultValue:uh.size,onChange:a,min:1,max:16,step:1,marks:!0}),r.jsx(Ae,{value:t.size,defaultValue:uh.size,onChange:a,min:1,max:256,step:1})]}),r.jsxs(Z,{w:"max-content",children:[r.jsx(te,{m:0,children:n("controlLayers.filter.img_noise.noise_color")}),r.jsx(it,{defaultChecked:uh.noise_color,isChecked:t.noise_color,onChange:o})]})]})});mO.displayName="Filternoise";const yO=({onChange:e,config:t})=>{const{t:n}=P(),s=u.useCallback(o=>{e({...t,scribble:o.target.checked})},[t,e]),i=u.useCallback(o=>{e({...t,quantize_edges:o.target.checked})},[t,e]);return r.jsxs(r.Fragment,{children:[r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.pidi_edge_detection.scribble")}),r.jsx(it,{isChecked:t.scribble,onChange:s})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.pidi_edge_detection.quantize_edges")}),r.jsx(it,{isChecked:t.quantize_edges,onChange:i})]})]})};yO.displayName="FilterPiDiNetEdgeDetection";const Fa=e=>{const{t}=P(),{modelConfigs:n,selectedModel:s,getIsDisabled:i,onChange:o,isLoading:a,optionsFilter:l=()=>!0}=e,c=I(X0),d=u.useMemo(()=>n.filter(l).map(m=>({label:m.name,value:m.key,description:c&&m.description||void 0,isDisabled:i?i(m):!1})),[l,i,n,c]),h=u.useMemo(()=>d.find(m=>s?m.value===s.key:!1),[d,s]),f=u.useCallback(m=>{if(!m){o(null);return}const y=n.find(x=>x.key===m.value);if(!y){o(null);return}o(y)},[n,o]),p=u.useMemo(()=>a?t("common.loading"):d.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[a,d,t]),g=u.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}},M6=En.spandrel_filter.buildDefaults(),vO=({onChange:e,config:t})=>{const{t:n}=P(),[s,{isLoading:i}]=Ip(),o=u.useMemo(()=>{var m;if(!(!s.length||!t.model))return(m=s.find(y=>{var x;return y.key===((x=t.model)==null?void 0:x.key)}))==null?void 0:m.description},[s,t.model]),a=u.useCallback(m=>{e({...t,model:m})},[t,e]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Fa({modelConfigs:s,onChange:a,selectedModel:t.model,isLoading:i}),p=u.useCallback(m=>{e({...t,scale:m})},[e,t]),g=u.useCallback(m=>{e({...t,autoScale:m.target.checked})},[e,t]);return u.useEffect(()=>{const m=l[0];!t.model&&m&&d(m)},[t.model,d,l]),r.jsxs(r.Fragment,{children:[r.jsxs(Z,{w:"full",orientation:"vertical",children:[r.jsxs(T,{w:"full",alignItems:"center",children:[r.jsx(te,{m:0,flexGrow:1,children:n("controlLayers.filter.spandrel_filter.autoScale")}),r.jsx(it,{size:"sm",isChecked:t.autoScale,onChange:g})]}),r.jsx(Us,{children:n("controlLayers.filter.spandrel_filter.autoScaleDesc")})]}),r.jsxs(Z,{isDisabled:!t.autoScale,children:[r.jsx(te,{m:0,children:n("controlLayers.filter.spandrel_filter.scale")}),r.jsx(qe,{value:t.scale,onChange:p,defaultValue:M6.scale,min:1,max:16}),r.jsx(Ae,{value:t.scale,onChange:p,defaultValue:M6.scale,min:1,max:16})]}),r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.filter.spandrel_filter.model")}),r.jsx(Le,{label:o,children:r.jsx(ke,{w:"full",children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})]})};vO.displayName="FilterSpandrel";const bO=u.memo(({filterConfig:e,onChange:t})=>{const{t:n}=P();return e.type==="adjust_image"?r.jsx(iO,{config:e,onChange:t}):e.type==="canny_edge_detection"?r.jsx(aO,{config:e,onChange:t}):e.type==="color_map"?r.jsx(lO,{config:e,onChange:t}):e.type==="content_shuffle"?r.jsx(cO,{config:e,onChange:t}):e.type==="depth_anything_depth_estimation"?r.jsx(uO,{config:e,onChange:t}):e.type==="dw_openpose_detection"?r.jsx(dO,{config:e,onChange:t}):e.type==="hed_edge_detection"?r.jsx(hO,{config:e,onChange:t}):e.type==="lineart_edge_detection"?r.jsx(fO,{config:e,onChange:t}):e.type==="mediapipe_face_detection"?r.jsx(pO,{config:e,onChange:t}):e.type==="mlsd_detection"?r.jsx(gO,{config:e,onChange:t}):e.type==="pidi_edge_detection"?r.jsx(yO,{config:e,onChange:t}):e.type==="img_blur"?r.jsx(oO,{config:e,onChange:t}):e.type==="img_noise"?r.jsx(mO,{config:e,onChange:t}):e.type==="spandrel_filter"?r.jsx(vO,{config:e,onChange:t}):r.jsx(Yt,{py:4,label:`${n(`controlLayers.filter.${e.type}.label`)} has no settings`,icon:null})});bO.displayName="Filter";const B0e=ve(Qr,e=>e.sd.disabledControlNetProcessors),xO=u.memo(({filterType:e,onChange:t})=>{const{t:n}=P(),s=I(B0e),i=u.useMemo(()=>Ci(En,(l,c)=>({value:c,label:n(`controlLayers.filter.${c}.label`)})).filter(l=>!Une(s,l.value)),[s,n]),o=u.useCallback(l=>{l&&(Re(sO(l.value)),t(l.value))},[t]),a=u.useMemo(()=>i.find(l=>l.value===e)??null,[i,e]);return r.jsx(T,{gap:2,children:r.jsxs(Z,{children:[r.jsx(Ve,{feature:"controlNetProcessor",children:r.jsx(te,{m:0,children:n("controlLayers.filter.filterType")})}),r.jsx(Fe,{value:a,options:i,onChange:o,isSearchable:!1,isClearable:!1})]})})});xO.displayName="FilterTypeSelect";const CO=u.memo(({adapter:e})=>{const{t}=P(),n=ce(e.filterer.$filterConfig),s=ce(e.filterer.$isProcessing),i=ce(e.filterer.$hasImageState),o=I(Jf),a=u.useCallback(g=>{e.filterer.$filterConfig.set(g)},[e.filterer.$filterConfig]),l=u.useCallback(g=>{e.filterer.$filterConfig.set(En[g].buildDefaults())},[e.filterer.$filterConfig]),c=u.useMemo(()=>{var g,m;return((m=(g=En[n.type]).validateConfig)==null?void 0:m.call(g,n))??!0},[n]),d=u.useCallback(()=>{e.filterer.saveAs("inpaint_mask")},[e.filterer]),h=u.useCallback(()=>{e.filterer.saveAs("regional_guidance")},[e.filterer]),f=u.useCallback(()=>{e.filterer.saveAs("raster_layer")},[e.filterer]),p=u.useCallback(()=>{e.filterer.saveAs("control_layer")},[e.filterer]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ot,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),r.jsx(nt,{}),r.jsx(Zw,{}),r.jsx(ry,{})]}),r.jsx(xO,{filterType:n.type,onChange:l}),r.jsx(bO,{filterConfig:n,onChange:a}),r.jsxs(as,{isAttached:!1,size:"sm",w:"full",children:[r.jsxs(ye,{variant:"ghost",onClick:e.filterer.processImmediate,loadingText:t("controlLayers.filter.process"),isDisabled:s||!c||o&&i,children:[t("controlLayers.filter.process"),s&&r.jsx(or,{ms:3,boxSize:5,color:"base.600"})]}),r.jsx(nt,{}),r.jsx(ye,{onClick:e.filterer.reset,isDisabled:s,loadingText:t("controlLayers.filter.reset"),variant:"ghost",children:t("controlLayers.filter.reset")}),r.jsx(ye,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!c||!i,children:t("controlLayers.filter.apply")}),r.jsxs(Qt,{children:[r.jsx(Jt,{as:ye,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:s||!c||!i,rightIcon:r.jsx(Pr,{}),children:t("controlLayers.selectObject.saveAs")}),r.jsxs(kt,{children:[r.jsx(he,{isDisabled:s||!c||!i,onClick:d,children:t("controlLayers.newInpaintMask")}),r.jsx(he,{isDisabled:s||!c||!i,onClick:h,children:t("controlLayers.newRegionalGuidance")}),r.jsx(he,{isDisabled:s||!c||!i,onClick:p,children:t("controlLayers.newControlLayer")}),r.jsx(he,{isDisabled:s||!c||!i,onClick:f,children:t("controlLayers.newRasterLayer")})]})]}),r.jsx(ye,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});CO.displayName="FilterContentAdvanced";const SO=u.memo(({adapter:e})=>{const{t}=P(),n=ce(e.filterer.$filterConfig),s=ce(e.filterer.$isProcessing),i=ce(e.filterer.$hasImageState),o=u.useMemo(()=>{var l,c;return((c=(l=En[n.type]).validateConfig)==null?void 0:c.call(l,n))??!0},[n]),a=u.useCallback(()=>{e.filterer.$simple.set(!1)},[e.filterer.$simple]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ot,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),r.jsx(nt,{})]}),r.jsxs(T,{flexDir:"column",w:"full",gap:2,pb:2,children:[r.jsx(K,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.processingLayerWith",{type:t(`controlLayers.filter.${n.type}.label`)})}),r.jsx(K,{color:"base.500",textAlign:"center",children:t("controlLayers.filter.forMoreControl")})]}),r.jsxs(as,{isAttached:!1,size:"sm",w:"full",children:[r.jsx(ye,{variant:"ghost",onClick:a,children:t("controlLayers.filter.advanced")}),r.jsx(nt,{}),r.jsx(ye,{onClick:e.filterer.apply,loadingText:t("controlLayers.filter.apply"),variant:"ghost",isDisabled:s||!o||!i,children:t("controlLayers.filter.apply")}),r.jsx(ye,{variant:"ghost",onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});SO.displayName="FilterContentSimple";const wO=()=>{const e=Tt(),t=ce(e.stateApi.$filteringAdapter);return t?r.jsx(jO,{adapter:t}):null};wO.displayName="Filter";const jO=u.memo(({adapter:e})=>{const t=ce(e.filterer.$simple),n=Ds("canvas"),s=ce(e.filterer.$isProcessing),i=u.useRef(null);return Go("canvas",i,{focusOnMount:!0}),Ee({id:"applyFilter",category:"canvas",callback:e.filterer.apply,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),Ee({id:"cancelFilter",category:"canvas",callback:e.filterer.cancel,options:{enabled:!s&&n,enableOnFormTags:!0},dependencies:[e.filterer,s,n]}),r.jsxs(T,{ref:i,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,w:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[t&&r.jsx(SO,{adapter:e}),!t&&r.jsx(CO,{adapter:e})]})});jO.displayName="FilterContent";const Yw=u.memo(({label:e,value:t,color:n})=>r.jsxs(r.Fragment,{children:[r.jsx(Rt,{children:r.jsxs(K,{textAlign:"end",children:[e,": "]})}),r.jsx(Rt,{fontWeight:"semibold",children:r.jsx(K,{textAlign:"end",color:n,children:t})})]}));Yw.displayName="CanvasHUDItem";const $0e=ve(Ec,e=>e.rect),kO=u.memo(()=>{const{t:e}=P(),t=I($0e);return r.jsx(Yw,{label:e("controlLayers.HUD.bbox"),value:`${t.width}×${t.height} px`})});kO.displayName="CanvasHUDItemBbox";const _O=u.memo(()=>{const{t:e}=P(),t=I(vM),n=I(Hq);return t==="none"?null:r.jsx(Yw,{label:e("controlLayers.HUD.scaledBbox"),value:`${n.width}×${n.height} px`})});_O.displayName="CanvasHUDItemScaledBbox";const IO=u.memo(()=>r.jsxs(Kr,{bg:"base.900",borderBottomEndRadius:"base",p:2,gap:1,borderRadius:"base",templateColumns:"1fr 1fr",opacity:.6,minW:64,children:[r.jsx(kO,{}),r.jsx(_O,{})]}));IO.displayName="CanvasHUD";class Oh extends Map{constructor(n){super(n);k(this,"subscriptions",new Set);k(this,"lastSnapshot",null);k(this,"set",(n,s)=>(super.set(n,s),this.notifySubscribers(),this));k(this,"delete",n=>{const s=super.delete(n);return this.notifySubscribers(),s});k(this,"clear",()=>{super.clear(),this.notifySubscribers()});k(this,"notifySubscribers",()=>{for(const n of this.subscriptions)n()});k(this,"subscribe",n=>(this.subscriptions.add(n),()=>{this.subscriptions.delete(n)}));k(this,"getSnapshot",()=>{const n=new Map(this);return(!this.lastSnapshot||!this.areSnapshotsEqual(this.lastSnapshot,n))&&(this.lastSnapshot=n),this.lastSnapshot});k(this,"areSnapshotsEqual",(n,s)=>{if(n.size!==s.size)return!1;for(const[i,o]of n)if(!Object.is(o,s.get(i)))return!1;return!0})}}const hc=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,AO=new Set,a2=typeof process=="object"&&process?process:{},TO=(e,t,n,s)=>{typeof a2.emitWarning=="function"?a2.emitWarning(e,t,n,s):console.error(`[${n}] ${t}: ${e}`)};let y0=globalThis.AbortController,P6=globalThis.AbortSignal;var qA;if(typeof y0>"u"){P6=class{constructor(){k(this,"onabort");k(this,"_onabort",[]);k(this,"reason");k(this,"aborted",!1)}addEventListener(s,i){this._onabort.push(i)}},y0=class{constructor(){k(this,"signal",new P6);t()}abort(s){var i,o;if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const a of this.signal._onabort)a(s);(o=(i=this.signal).onabort)==null||o.call(i,s)}}};let e=((qA=a2.env)==null?void 0:qA.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const t=()=>{e&&(e=!1,TO("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const V0e=e=>!AO.has(e),Jo=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),MO=e=>Jo(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?ym:null:null;class ym extends Array{constructor(t){super(t),this.fill(0)}}var uu;const il=class il{constructor(t,n){k(this,"heap");k(this,"length");if(!X(il,uu))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(t),this.length=0}static create(t){const n=MO(t);if(!n)return[];Xe(il,uu,!0);const s=new il(t,n);return Xe(il,uu,!1),s}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};uu=new WeakMap,At(il,uu,!1);let l2=il;var KA,ZA,ai,dr,li,ci,du,hu,Bn,ui,Mn,sn,at,As,hr,ds,Hn,di,Wn,hi,fi,fr,pi,la,Ts,Pe,c2,fl,ko,Nf,pr,PO,pl,fu,Ff,ea,ta,u2,vm,bm,nn,d2,Nh,na,h2;const kk=class kk{constructor(t){At(this,Pe);At(this,ai);At(this,dr);At(this,li);At(this,ci);At(this,du);At(this,hu);k(this,"ttl");k(this,"ttlResolution");k(this,"ttlAutopurge");k(this,"updateAgeOnGet");k(this,"updateAgeOnHas");k(this,"allowStale");k(this,"noDisposeOnSet");k(this,"noUpdateTTL");k(this,"maxEntrySize");k(this,"sizeCalculation");k(this,"noDeleteOnFetchRejection");k(this,"noDeleteOnStaleGet");k(this,"allowStaleOnFetchAbort");k(this,"allowStaleOnFetchRejection");k(this,"ignoreFetchAbort");At(this,Bn);At(this,ui);At(this,Mn);At(this,sn);At(this,at);At(this,As);At(this,hr);At(this,ds);At(this,Hn);At(this,di);At(this,Wn);At(this,hi);At(this,fi);At(this,fr);At(this,pi);At(this,la);At(this,Ts);At(this,fl,()=>{});At(this,ko,()=>{});At(this,Nf,()=>{});At(this,pr,()=>!1);At(this,pl,t=>{});At(this,fu,(t,n,s)=>{});At(this,Ff,(t,n,s,i)=>{if(s||i)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});k(this,KA,"LRUCache");const{max:n=0,ttl:s,ttlResolution:i=1,ttlAutopurge:o,updateAgeOnGet:a,updateAgeOnHas:l,allowStale:c,dispose:d,disposeAfter:h,noDisposeOnSet:f,noUpdateTTL:p,maxSize:g=0,maxEntrySize:m=0,sizeCalculation:y,fetchMethod:x,memoMethod:C,noDeleteOnFetchRejection:v,noDeleteOnStaleGet:b,allowStaleOnFetchRejection:S,allowStaleOnFetchAbort:w,ignoreFetchAbort:j}=t;if(n!==0&&!Jo(n))throw new TypeError("max option must be a nonnegative integer");const E=n?MO(n):Array;if(!E)throw new Error("invalid max value: "+n);if(Xe(this,ai,n),Xe(this,dr,g),this.maxEntrySize=m||X(this,dr),this.sizeCalculation=y,this.sizeCalculation){if(!X(this,dr)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(C!==void 0&&typeof C!="function")throw new TypeError("memoMethod must be a function if defined");if(Xe(this,hu,C),x!==void 0&&typeof x!="function")throw new TypeError("fetchMethod must be a function if specified");if(Xe(this,du,x),Xe(this,la,!!x),Xe(this,Mn,new Map),Xe(this,sn,new Array(n).fill(void 0)),Xe(this,at,new Array(n).fill(void 0)),Xe(this,As,new E(n)),Xe(this,hr,new E(n)),Xe(this,ds,0),Xe(this,Hn,0),Xe(this,di,l2.create(n)),Xe(this,Bn,0),Xe(this,ui,0),typeof d=="function"&&Xe(this,li,d),typeof h=="function"?(Xe(this,ci,h),Xe(this,Wn,[])):(Xe(this,ci,void 0),Xe(this,Wn,void 0)),Xe(this,pi,!!X(this,li)),Xe(this,Ts,!!X(this,ci)),this.noDisposeOnSet=!!f,this.noUpdateTTL=!!p,this.noDeleteOnFetchRejection=!!v,this.allowStaleOnFetchRejection=!!S,this.allowStaleOnFetchAbort=!!w,this.ignoreFetchAbort=!!j,this.maxEntrySize!==0){if(X(this,dr)!==0&&!Jo(X(this,dr)))throw new TypeError("maxSize must be a positive integer if specified");if(!Jo(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");He(this,Pe,PO).call(this)}if(this.allowStale=!!c,this.noDeleteOnStaleGet=!!b,this.updateAgeOnGet=!!a,this.updateAgeOnHas=!!l,this.ttlResolution=Jo(i)||i===0?i:1,this.ttlAutopurge=!!o,this.ttl=s||0,this.ttl){if(!Jo(this.ttl))throw new TypeError("ttl must be a positive integer if specified");He(this,Pe,c2).call(this)}if(X(this,ai)===0&&this.ttl===0&&X(this,dr)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!X(this,ai)&&!X(this,dr)){const A="LRU_CACHE_UNBOUNDED";V0e(A)&&(AO.add(A),TO("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",A,kk))}}static unsafeExposeInternals(t){return{starts:X(t,fi),ttls:X(t,fr),sizes:X(t,hi),keyMap:X(t,Mn),keyList:X(t,sn),valList:X(t,at),next:X(t,As),prev:X(t,hr),get head(){return X(t,ds)},get tail(){return X(t,Hn)},free:X(t,di),isBackgroundFetch:n=>{var s;return He(s=t,Pe,nn).call(s,n)},backgroundFetch:(n,s,i,o)=>{var a;return He(a=t,Pe,bm).call(a,n,s,i,o)},moveToTail:n=>{var s;return He(s=t,Pe,Nh).call(s,n)},indexes:n=>{var s;return He(s=t,Pe,ea).call(s,n)},rindexes:n=>{var s;return He(s=t,Pe,ta).call(s,n)},isStale:n=>{var s;return X(s=t,pr).call(s,n)}}}get max(){return X(this,ai)}get maxSize(){return X(this,dr)}get calculatedSize(){return X(this,ui)}get size(){return X(this,Bn)}get fetchMethod(){return X(this,du)}get memoMethod(){return X(this,hu)}get dispose(){return X(this,li)}get disposeAfter(){return X(this,ci)}getRemainingTTL(t){return X(this,Mn).has(t)?1/0:0}*entries(){for(const t of He(this,Pe,ea).call(this))X(this,at)[t]!==void 0&&X(this,sn)[t]!==void 0&&!He(this,Pe,nn).call(this,X(this,at)[t])&&(yield[X(this,sn)[t],X(this,at)[t]])}*rentries(){for(const t of He(this,Pe,ta).call(this))X(this,at)[t]!==void 0&&X(this,sn)[t]!==void 0&&!He(this,Pe,nn).call(this,X(this,at)[t])&&(yield[X(this,sn)[t],X(this,at)[t]])}*keys(){for(const t of He(this,Pe,ea).call(this)){const n=X(this,sn)[t];n!==void 0&&!He(this,Pe,nn).call(this,X(this,at)[t])&&(yield n)}}*rkeys(){for(const t of He(this,Pe,ta).call(this)){const n=X(this,sn)[t];n!==void 0&&!He(this,Pe,nn).call(this,X(this,at)[t])&&(yield n)}}*values(){for(const t of He(this,Pe,ea).call(this))X(this,at)[t]!==void 0&&!He(this,Pe,nn).call(this,X(this,at)[t])&&(yield X(this,at)[t])}*rvalues(){for(const t of He(this,Pe,ta).call(this))X(this,at)[t]!==void 0&&!He(this,Pe,nn).call(this,X(this,at)[t])&&(yield X(this,at)[t])}[(ZA=Symbol.iterator,KA=Symbol.toStringTag,ZA)](){return this.entries()}find(t,n={}){for(const s of He(this,Pe,ea).call(this)){const i=X(this,at)[s],o=He(this,Pe,nn).call(this,i)?i.__staleWhileFetching:i;if(o!==void 0&&t(o,X(this,sn)[s],this))return this.get(X(this,sn)[s],n)}}forEach(t,n=this){for(const s of He(this,Pe,ea).call(this)){const i=X(this,at)[s],o=He(this,Pe,nn).call(this,i)?i.__staleWhileFetching:i;o!==void 0&&t.call(n,o,X(this,sn)[s],this)}}rforEach(t,n=this){for(const s of He(this,Pe,ta).call(this)){const i=X(this,at)[s],o=He(this,Pe,nn).call(this,i)?i.__staleWhileFetching:i;o!==void 0&&t.call(n,o,X(this,sn)[s],this)}}purgeStale(){let t=!1;for(const n of He(this,Pe,ta).call(this,{allowStale:!0}))X(this,pr).call(this,n)&&(He(this,Pe,na).call(this,X(this,sn)[n],"expire"),t=!0);return t}info(t){const n=X(this,Mn).get(t);if(n===void 0)return;const s=X(this,at)[n],i=He(this,Pe,nn).call(this,s)?s.__staleWhileFetching:s;if(i===void 0)return;const o={value:i};if(X(this,fr)&&X(this,fi)){const a=X(this,fr)[n],l=X(this,fi)[n];if(a&&l){const c=a-(hc.now()-l);o.ttl=c,o.start=Date.now()}}return X(this,hi)&&(o.size=X(this,hi)[n]),o}dump(){const t=[];for(const n of He(this,Pe,ea).call(this,{allowStale:!0})){const s=X(this,sn)[n],i=X(this,at)[n],o=He(this,Pe,nn).call(this,i)?i.__staleWhileFetching:i;if(o===void 0||s===void 0)continue;const a={value:o};if(X(this,fr)&&X(this,fi)){a.ttl=X(this,fr)[n];const l=hc.now()-X(this,fi)[n];a.start=Math.floor(Date.now()-l)}X(this,hi)&&(a.size=X(this,hi)[n]),t.unshift([s,a])}return t}load(t){this.clear();for(const[n,s]of t){if(s.start){const i=Date.now()-s.start;s.start=hc.now()-i}this.set(n,s.value,s)}}set(t,n,s={}){var p,g,m,y,x;if(n===void 0)return this.delete(t),this;const{ttl:i=this.ttl,start:o,noDisposeOnSet:a=this.noDisposeOnSet,sizeCalculation:l=this.sizeCalculation,status:c}=s;let{noUpdateTTL:d=this.noUpdateTTL}=s;const h=X(this,Ff).call(this,t,n,s.size||0,l);if(this.maxEntrySize&&h>this.maxEntrySize)return c&&(c.set="miss",c.maxEntrySizeExceeded=!0),He(this,Pe,na).call(this,t,"set"),this;let f=X(this,Bn)===0?void 0:X(this,Mn).get(t);if(f===void 0)f=X(this,Bn)===0?X(this,Hn):X(this,di).length!==0?X(this,di).pop():X(this,Bn)===X(this,ai)?He(this,Pe,vm).call(this,!1):X(this,Bn),X(this,sn)[f]=t,X(this,at)[f]=n,X(this,Mn).set(t,f),X(this,As)[X(this,Hn)]=f,X(this,hr)[f]=X(this,Hn),Xe(this,Hn,f),rg(this,Bn)._++,X(this,fu).call(this,f,h,c),c&&(c.set="add"),d=!1;else{He(this,Pe,Nh).call(this,f);const C=X(this,at)[f];if(n!==C){if(X(this,la)&&He(this,Pe,nn).call(this,C)){C.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:v}=C;v!==void 0&&!a&&(X(this,pi)&&((p=X(this,li))==null||p.call(this,v,t,"set")),X(this,Ts)&&((g=X(this,Wn))==null||g.push([v,t,"set"])))}else a||(X(this,pi)&&((m=X(this,li))==null||m.call(this,C,t,"set")),X(this,Ts)&&((y=X(this,Wn))==null||y.push([C,t,"set"])));if(X(this,pl).call(this,f),X(this,fu).call(this,f,h,c),X(this,at)[f]=n,c){c.set="replace";const v=C&&He(this,Pe,nn).call(this,C)?C.__staleWhileFetching:C;v!==void 0&&(c.oldValue=v)}}else c&&(c.set="update")}if(i!==0&&!X(this,fr)&&He(this,Pe,c2).call(this),X(this,fr)&&(d||X(this,Nf).call(this,f,i,o),c&&X(this,ko).call(this,c,f)),!a&&X(this,Ts)&&X(this,Wn)){const C=X(this,Wn);let v;for(;v=C==null?void 0:C.shift();)(x=X(this,ci))==null||x.call(this,...v)}return this}pop(){var t;try{for(;X(this,Bn);){const n=X(this,at)[X(this,ds)];if(He(this,Pe,vm).call(this,!0),He(this,Pe,nn).call(this,n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(X(this,Ts)&&X(this,Wn)){const n=X(this,Wn);let s;for(;s=n==null?void 0:n.shift();)(t=X(this,ci))==null||t.call(this,...s)}}}has(t,n={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:i}=n,o=X(this,Mn).get(t);if(o!==void 0){const a=X(this,at)[o];if(He(this,Pe,nn).call(this,a)&&a.__staleWhileFetching===void 0)return!1;if(X(this,pr).call(this,o))i&&(i.has="stale",X(this,ko).call(this,i,o));else return s&&X(this,fl).call(this,o),i&&(i.has="hit",X(this,ko).call(this,i,o)),!0}else i&&(i.has="miss");return!1}peek(t,n={}){const{allowStale:s=this.allowStale}=n,i=X(this,Mn).get(t);if(i===void 0||!s&&X(this,pr).call(this,i))return;const o=X(this,at)[i];return He(this,Pe,nn).call(this,o)?o.__staleWhileFetching:o}async fetch(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,ttl:a=this.ttl,noDisposeOnSet:l=this.noDisposeOnSet,size:c=0,sizeCalculation:d=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:f=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:p=this.allowStaleOnFetchRejection,ignoreFetchAbort:g=this.ignoreFetchAbort,allowStaleOnFetchAbort:m=this.allowStaleOnFetchAbort,context:y,forceRefresh:x=!1,status:C,signal:v}=n;if(!X(this,la))return C&&(C.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:o,status:C});const b={allowStale:s,updateAgeOnGet:i,noDeleteOnStaleGet:o,ttl:a,noDisposeOnSet:l,size:c,sizeCalculation:d,noUpdateTTL:h,noDeleteOnFetchRejection:f,allowStaleOnFetchRejection:p,allowStaleOnFetchAbort:m,ignoreFetchAbort:g,status:C,signal:v};let S=X(this,Mn).get(t);if(S===void 0){C&&(C.fetch="miss");const w=He(this,Pe,bm).call(this,t,S,b,y);return w.__returned=w}else{const w=X(this,at)[S];if(He(this,Pe,nn).call(this,w)){const M=s&&w.__staleWhileFetching!==void 0;return C&&(C.fetch="inflight",M&&(C.returnedStale=!0)),M?w.__staleWhileFetching:w.__returned=w}const j=X(this,pr).call(this,S);if(!x&&!j)return C&&(C.fetch="hit"),He(this,Pe,Nh).call(this,S),i&&X(this,fl).call(this,S),C&&X(this,ko).call(this,C,S),w;const E=He(this,Pe,bm).call(this,t,S,b,y),L=E.__staleWhileFetching!==void 0&&s;return C&&(C.fetch=j?"stale":"refresh",L&&j&&(C.returnedStale=!0)),L?E.__staleWhileFetching:E.__returned=E}}async forceFetch(t,n={}){const s=await this.fetch(t,n);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(t,n={}){const s=X(this,hu);if(!s)throw new Error("no memoMethod provided to constructor");const{context:i,forceRefresh:o,...a}=n,l=this.get(t,a);if(!o&&l!==void 0)return l;const c=s(t,l,{options:a,context:i});return this.set(t,c,a),c}get(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:i=this.updateAgeOnGet,noDeleteOnStaleGet:o=this.noDeleteOnStaleGet,status:a}=n,l=X(this,Mn).get(t);if(l!==void 0){const c=X(this,at)[l],d=He(this,Pe,nn).call(this,c);return a&&X(this,ko).call(this,a,l),X(this,pr).call(this,l)?(a&&(a.get="stale"),d?(a&&s&&c.__staleWhileFetching!==void 0&&(a.returnedStale=!0),s?c.__staleWhileFetching:void 0):(o||He(this,Pe,na).call(this,t,"expire"),a&&s&&(a.returnedStale=!0),s?c:void 0)):(a&&(a.get="hit"),d?c.__staleWhileFetching:(He(this,Pe,Nh).call(this,l),i&&X(this,fl).call(this,l),c))}else a&&(a.get="miss")}delete(t){return He(this,Pe,na).call(this,t,"delete")}clear(){return He(this,Pe,h2).call(this,"delete")}};ai=new WeakMap,dr=new WeakMap,li=new WeakMap,ci=new WeakMap,du=new WeakMap,hu=new WeakMap,Bn=new WeakMap,ui=new WeakMap,Mn=new WeakMap,sn=new WeakMap,at=new WeakMap,As=new WeakMap,hr=new WeakMap,ds=new WeakMap,Hn=new WeakMap,di=new WeakMap,Wn=new WeakMap,hi=new WeakMap,fi=new WeakMap,fr=new WeakMap,pi=new WeakMap,la=new WeakMap,Ts=new WeakMap,Pe=new WeakSet,c2=function(){const t=new ym(X(this,ai)),n=new ym(X(this,ai));Xe(this,fr,t),Xe(this,fi,n),Xe(this,Nf,(o,a,l=hc.now())=>{if(n[o]=a!==0?l:0,t[o]=a,a!==0&&this.ttlAutopurge){const c=setTimeout(()=>{X(this,pr).call(this,o)&&He(this,Pe,na).call(this,X(this,sn)[o],"expire")},a+1);c.unref&&c.unref()}}),Xe(this,fl,o=>{n[o]=t[o]!==0?hc.now():0}),Xe(this,ko,(o,a)=>{if(t[a]){const l=t[a],c=n[a];if(!l||!c)return;o.ttl=l,o.start=c,o.now=s||i();const d=o.now-c;o.remainingTTL=l-d}});let s=0;const i=()=>{const o=hc.now();if(this.ttlResolution>0){s=o;const a=setTimeout(()=>s=0,this.ttlResolution);a.unref&&a.unref()}return o};this.getRemainingTTL=o=>{const a=X(this,Mn).get(o);if(a===void 0)return 0;const l=t[a],c=n[a];if(!l||!c)return 1/0;const d=(s||i())-c;return l-d},Xe(this,pr,o=>{const a=n[o],l=t[o];return!!l&&!!a&&(s||i())-a>l})},fl=new WeakMap,ko=new WeakMap,Nf=new WeakMap,pr=new WeakMap,PO=function(){const t=new ym(X(this,ai));Xe(this,ui,0),Xe(this,hi,t),Xe(this,pl,n=>{Xe(this,ui,X(this,ui)-t[n]),t[n]=0}),Xe(this,Ff,(n,s,i,o)=>{if(He(this,Pe,nn).call(this,s))return 0;if(!Jo(i))if(o){if(typeof o!="function")throw new TypeError("sizeCalculation must be a function");if(i=o(s,n),!Jo(i))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return i}),Xe(this,fu,(n,s,i)=>{if(t[n]=s,X(this,dr)){const o=X(this,dr)-t[n];for(;X(this,ui)>o;)He(this,Pe,vm).call(this,!0)}Xe(this,ui,X(this,ui)+t[n]),i&&(i.entrySize=s,i.totalCalculatedSize=X(this,ui))})},pl=new WeakMap,fu=new WeakMap,Ff=new WeakMap,ea=function*({allowStale:t=this.allowStale}={}){if(X(this,Bn))for(let n=X(this,Hn);!(!He(this,Pe,u2).call(this,n)||((t||!X(this,pr).call(this,n))&&(yield n),n===X(this,ds)));)n=X(this,hr)[n]},ta=function*({allowStale:t=this.allowStale}={}){if(X(this,Bn))for(let n=X(this,ds);!(!He(this,Pe,u2).call(this,n)||((t||!X(this,pr).call(this,n))&&(yield n),n===X(this,Hn)));)n=X(this,As)[n]},u2=function(t){return t!==void 0&&X(this,Mn).get(X(this,sn)[t])===t},vm=function(t){var o,a;const n=X(this,ds),s=X(this,sn)[n],i=X(this,at)[n];return X(this,la)&&He(this,Pe,nn).call(this,i)?i.__abortController.abort(new Error("evicted")):(X(this,pi)||X(this,Ts))&&(X(this,pi)&&((o=X(this,li))==null||o.call(this,i,s,"evict")),X(this,Ts)&&((a=X(this,Wn))==null||a.push([i,s,"evict"]))),X(this,pl).call(this,n),t&&(X(this,sn)[n]=void 0,X(this,at)[n]=void 0,X(this,di).push(n)),X(this,Bn)===1?(Xe(this,ds,Xe(this,Hn,0)),X(this,di).length=0):Xe(this,ds,X(this,As)[n]),X(this,Mn).delete(s),rg(this,Bn)._--,n},bm=function(t,n,s,i){const o=n===void 0?void 0:X(this,at)[n];if(He(this,Pe,nn).call(this,o))return o;const a=new y0,{signal:l}=s;l==null||l.addEventListener("abort",()=>a.abort(l.reason),{signal:a.signal});const c={signal:a.signal,options:s,context:i},d=(y,x=!1)=>{const{aborted:C}=a.signal,v=s.ignoreFetchAbort&&y!==void 0;if(s.status&&(C&&!x?(s.status.fetchAborted=!0,s.status.fetchError=a.signal.reason,v&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),C&&!v&&!x)return f(a.signal.reason);const b=g;return X(this,at)[n]===g&&(y===void 0?b.__staleWhileFetching?X(this,at)[n]=b.__staleWhileFetching:He(this,Pe,na).call(this,t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,y,c.options))),y},h=y=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=y),f(y)),f=y=>{const{aborted:x}=a.signal,C=x&&s.allowStaleOnFetchAbort,v=C||s.allowStaleOnFetchRejection,b=v||s.noDeleteOnFetchRejection,S=g;if(X(this,at)[n]===g&&(!b||S.__staleWhileFetching===void 0?He(this,Pe,na).call(this,t,"fetch"):C||(X(this,at)[n]=S.__staleWhileFetching)),v)return s.status&&S.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),S.__staleWhileFetching;if(S.__returned===S)throw y},p=(y,x)=>{var v;const C=(v=X(this,du))==null?void 0:v.call(this,t,o,c);C&&C instanceof Promise&&C.then(b=>y(b===void 0?void 0:b),x),a.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(y(void 0),s.allowStaleOnFetchAbort&&(y=b=>d(b,!0)))})};s.status&&(s.status.fetchDispatched=!0);const g=new Promise(p).then(d,h),m=Object.assign(g,{__abortController:a,__staleWhileFetching:o,__returned:void 0});return n===void 0?(this.set(t,m,{...c.options,status:void 0}),n=X(this,Mn).get(t)):X(this,at)[n]=m,m},nn=function(t){if(!X(this,la))return!1;const n=t;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof y0},d2=function(t,n){X(this,hr)[n]=t,X(this,As)[t]=n},Nh=function(t){t!==X(this,Hn)&&(t===X(this,ds)?Xe(this,ds,X(this,As)[t]):He(this,Pe,d2).call(this,X(this,hr)[t],X(this,As)[t]),He(this,Pe,d2).call(this,X(this,Hn),t),Xe(this,Hn,t))},na=function(t,n){var i,o,a,l;let s=!1;if(X(this,Bn)!==0){const c=X(this,Mn).get(t);if(c!==void 0)if(s=!0,X(this,Bn)===1)He(this,Pe,h2).call(this,n);else{X(this,pl).call(this,c);const d=X(this,at)[c];if(He(this,Pe,nn).call(this,d)?d.__abortController.abort(new Error("deleted")):(X(this,pi)||X(this,Ts))&&(X(this,pi)&&((i=X(this,li))==null||i.call(this,d,t,n)),X(this,Ts)&&((o=X(this,Wn))==null||o.push([d,t,n]))),X(this,Mn).delete(t),X(this,sn)[c]=void 0,X(this,at)[c]=void 0,c===X(this,Hn))Xe(this,Hn,X(this,hr)[c]);else if(c===X(this,ds))Xe(this,ds,X(this,As)[c]);else{const h=X(this,hr)[c];X(this,As)[h]=X(this,As)[c];const f=X(this,As)[c];X(this,hr)[f]=X(this,hr)[c]}rg(this,Bn)._--,X(this,di).push(c)}}if(X(this,Ts)&&((a=X(this,Wn))!=null&&a.length)){const c=X(this,Wn);let d;for(;d=c==null?void 0:c.shift();)(l=X(this,ci))==null||l.call(this,...d)}return s},h2=function(t){var n,s,i;for(const o of He(this,Pe,ta).call(this,{allowStale:!0})){const a=X(this,at)[o];if(He(this,Pe,nn).call(this,a))a.__abortController.abort(new Error("deleted"));else{const l=X(this,sn)[o];X(this,pi)&&((n=X(this,li))==null||n.call(this,a,l,t)),X(this,Ts)&&((s=X(this,Wn))==null||s.push([a,l,t]))}}if(X(this,Mn).clear(),X(this,at).fill(void 0),X(this,sn).fill(void 0),X(this,fr)&&X(this,fi)&&(X(this,fr).fill(0),X(this,fi).fill(0)),X(this,hi)&&X(this,hi).fill(0),Xe(this,ds,0),Xe(this,Hn,0),X(this,di).length=0,Xe(this,ui,0),Xe(this,Bn,0),X(this,Ts)&&X(this,Wn)){const o=X(this,Wn);let a;for(;a=o==null?void 0:o.shift();)(i=X(this,ci))==null||i.call(this,...a)}};let nl=kk;const G0e={imageNameCacheSize:1e3,imageDataCacheSize:32,transparencyCalculationCacheSize:1e3,canvasElementCacheSize:32,generationModeCacheSize:100};class v0 extends $t{constructor(n){super();k(this,"type","cache");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"config",G0e);k(this,"imageNameCache",new nl({max:this.config.imageNameCacheSize}));k(this,"canvasElementCache",new nl({max:this.config.canvasElementCacheSize}));k(this,"imageDataCache",new nl({max:this.config.imageDataCacheSize}));k(this,"transparencyCalculationCache",new nl({max:this.config.imageDataCacheSize}));k(this,"generationModeCache",new nl({max:this.config.generationModeCacheSize}));k(this,"clearAll",()=>{this.canvasElementCache.clear(),this.imageNameCache.clear(),this.generationModeCache.clear()});k(this,"destroy",()=>{this.log.debug("Destroying cache module"),this.clearAll()});this.id=_e("cache"),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating cache module")}}k(v0,"getWithFallback",async({cache:n,getValue:s,key:i,onHit:o,onMiss:a})=>{let l=n.get(i);return l===void 0?(a==null||a(),l=await s(),n.set(i,l)):o==null||o(l),l});class z0e extends $t{constructor(n){super();k(this,"type","compositor");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"$isCompositing",Oe(!1));k(this,"$isProcessing",Oe(!1));k(this,"$isUploading",Oe(!1));k(this,"$isBusy",gs([this.$isCompositing,this.$isProcessing,this.$isUploading],(n,s,i)=>n||s||i));k(this,"getVisibleRectOfType",n=>{const s=[];for(const i of this.manager.getAllAdapters())i.state.isEnabled&&(n&&i.state.type!==n||i.renderer.hasObjects()&&s.push(i.transformer.getRelativeRect()));return Nk(...s)});k(this,"getRectOfAdapters",n=>{const s=[];for(const i of n)i.renderer.hasObjects()&&s.push(i.transformer.getRelativeRect());return Nk(...s)});k(this,"getVisibleAdaptersOfType",n=>{let s;switch(n){case"raster_layer":s=this.manager.stateApi.getRasterLayersState().entities;break;case"inpaint_mask":s=this.manager.stateApi.getInpaintMasksState().entities;break;case"control_layer":s=this.manager.stateApi.getControlLayersState().entities;break;case"regional_guidance":s=this.manager.stateApi.getRegionsState().entities;break;default:Re(!1,`Unhandled entity type: ${n}`)}return s.map(o=>qs(o)).map(this.manager.getAdapter).filter(o=>!!o).filter(o=>!o.$isDisabled.get()&&o.renderer.hasObjects())});k(this,"getCompositeHash",(n,s)=>{const i=[];for(const a of n)i.push(a.getHashableState());return kl({extra:s,adapterHashes:i})});k(this,"getCompositeCanvas",(n,s,i)=>{const o=n.map(h=>h.entityIdentifier),a=this.getCompositeHash(n,{rect:s}),l=this.manager.cache.canvasElementCache.get(a);if(l)return this.log.debug({entityIdentifiers:o,rect:s},"Using cached composite canvas"),l;this.log.debug({entityIdentifiers:o,rect:s},"Building composite canvas"),this.$isCompositing.set(!0);const c=document.createElement("canvas");c.width=s.width,c.height=s.height;const d=c.getContext("2d");Re(d!==null,"Canvas 2D context is null"),d.imageSmoothingEnabled=!1,i!=null&&i.globalCompositeOperation&&(d.globalCompositeOperation=i.globalCompositeOperation);for(const h of n){this.log.debug({entityIdentifier:h.entityIdentifier},"Drawing entity to composite canvas");const f=h.getCanvas(s);d.drawImage(f,0,0)}return this.manager.cache.canvasElementCache.set(a,c),this.$isCompositing.set(!1),c});k(this,"getCompositeImageDTO",async(n,s,i,o,a)=>{Re(s.width>0&&s.height>0,"Unable to rasterize empty rect");const l=this.getCompositeHash(n,{rect:s}),c=a?void 0:this.manager.cache.imageNameCache.get(l);let d=null;if(c){if(d=await Q0(c),d)return this.log.debug({rect:s,imageName:c,imageDTO:d},"Using cached composite image"),d;this.log.warn({rect:s,imageName:c},"Cached image name not found, recompositing")}const h=bM(()=>this.getCompositeCanvas(n,s,o));if(h.isErr())throw this.log.error({error:Es(h.error)},"Failed to get composite canvas"),h.error;this.$isProcessing.set(!0);const f=await Un(()=>Z0(h.value));if(this.$isProcessing.set(!1),f.isErr())throw this.log.error({error:Es(f.error)},"Failed to convert composite canvas to blob"),f.error;const p=f.value;this.manager._isDebugging&&xM(p,"Composite"),this.$isUploading.set(!0);const g=await Un(()=>ca({file:new File([p],"canvas-composite.png",{type:"image/png"}),image_category:"general",...i}));if(this.$isUploading.set(!1),g.isErr())throw g.error;return d=g.value,this.manager.cache.imageNameCache.set(l,d.image_name),d});k(this,"mergeByEntityIdentifiers",async(n,s)=>{var h;if(fe({id:"MERGE_LAYERS_TOAST",title:Ce("controlLayers.mergingLayers"),withCount:!1}),n.length<=1)return this.log.warn({entityIdentifiers:n},"Cannot merge less than 2 entities"),null;const i=(h=n[0])==null?void 0:h.type;Re(i,"Cannot merge entities with no type (this should never happen)");const o=this.manager.getAdapters(n);Re(o.length===n.length,"Failed to get all adapters for entity identifiers");const a=this.getRectOfAdapters(o),l={globalCompositeOperation:i==="control_layer"?"lighter":void 0},c=await Un(()=>this.getCompositeImageDTO(o,a,{is_intermediate:!0},l));if(c.isErr())return this.log.error({error:Es(c.error)},"Failed to merge selected entities"),fe({id:"MERGE_LAYERS_TOAST",title:Ce("controlLayers.mergeVisibleError"),status:"error",withCount:!1}),null;const d={isSelected:!0,overrides:{objects:[Jr(c.value)],position:{x:Math.floor(a.x),y:Math.floor(a.y)}},mergedEntitiesToDelete:s?n.map(Wq):[]};switch(i){case"raster_layer":this.manager.stateApi.addRasterLayer(d);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(d);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(d);break;case"control_layer":this.manager.stateApi.addControlLayer(d);break;default:Re(!1,"Unsupported type for merge")}return fe({id:"MERGE_LAYERS_TOAST",title:Ce("controlLayers.mergeVisibleOk"),status:"success",withCount:!1}),c.value});k(this,"mergeVisibleOfType",n=>{let s;switch(n){case"raster_layer":s=this.manager.stateApi.runSelector(jC);break;case"inpaint_mask":s=this.manager.stateApi.runSelector(wM);break;case"regional_guidance":s=this.manager.stateApi.runSelector(SM);break;case"control_layer":s=this.manager.stateApi.runSelector(CM);break;default:Re(!1,"Unsupported type for merge")}const i=s.map(qs);return this.mergeByEntityIdentifiers(i,!1)});k(this,"getTransparency",(n,s,i)=>{const a={entityIdentifiers:n.map(l=>l.entityIdentifier),rect:s};return v0.getWithFallback({cache:this.manager.cache.transparencyCalculationCache,key:i,getValue:async()=>{const l=this.getCompositeCanvas(n,s),c=await v0.getWithFallback({cache:this.manager.cache.imageDataCache,key:i,getValue:()=>Promise.resolve(jM(l)),onHit:()=>this.log.trace(a,"Using cached image data"),onMiss:()=>this.log.trace(a,"Calculating image data")});return Uq(c)},onHit:()=>this.log.trace(a,"Using cached transparency"),onMiss:()=>this.log.trace(a,"Calculating transparency")})});k(this,"getGenerationMode",async()=>{const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.compositor.getVisibleAdaptersOfType("raster_layer"),i=this.getCompositeHash(s,{rect:n}),o=this.manager.compositor.getVisibleAdaptersOfType("inpaint_mask"),a=this.getCompositeHash(o,{rect:n}),l=kl({rect:n,compositeInpaintMaskHash:a,compositeRasterLayerHash:i}),c=this.manager.cache.generationModeCache.get(l);if(c)return this.log.debug({rect:n,cachedGenerationMode:c},"Using cached generation mode"),c;this.log.debug({rect:n},"Calculating generation mode"),this.$isProcessing.set(!0);const d=await Un(async()=>{const h=await this.getTransparency(s,n,i),f=await this.getTransparency(o,n,a);let p;return h==="FULLY_TRANSPARENT"?p="txt2img":h==="PARTIALLY_TRANSPARENT"?p="outpaint":f==="FULLY_TRANSPARENT"?p="img2img":p="inpaint",this.manager.cache.generationModeCache.set(l,p),p});if(this.$isProcessing.set(!1),d.isErr())throw this.log.error({error:Es(d.error)},"Failed to calculate generation mode"),d.error;return d.value});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isCompositing:this.$isCompositing.get(),$isProcessing:this.$isProcessing.get(),$isUploading:this.$isUploading.get(),$isBusy:this.$isBusy.get()}));this.id=_e("canvas_compositor"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating compositor module")}}function H0e(e,t=!1){const n=(16777216+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1),s=Math.round(e.a*255).toString(16).padStart(2,"0");return t?`#${n}${s}`:`#${n}`}function W0e(e,t){e=e.replace(/^#/,"");const n=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),i=parseInt(e.substring(4,6),16);return{r:n,g:s,b:i,a:t}}const Oo=e=>{const{r:t,g:n,b:s,a:i}=e;return`rgba(${t}, ${n}, ${s}, ${i})`},Tl=e=>{const{r:t,g:n,b:s}=e;return`rgba(${t}, ${n}, ${s})`};class Yh extends $t{constructor(n,s){super();k(this,"type","object_brush_line");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:ft(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Ne.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line");const{points:i,color:o,strokeWidth:a}=n;return this.konva.line.setAttrs({points:i.length===2?[...i,...i]:i,stroke:Oo(o),strokeWidth:a}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class b0 extends $t{constructor(n,s){super();k(this,"type","object_brush_line_with_pressure");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:ft(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Ne.Path({name:`${this.type}:path`,listening:!1,shadowForStrokeEnabled:!1,globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line with pressure");const{points:i,color:o,strokeWidth:a}=n;return this.konva.line.setAttrs({data:kM(i,{size:a/2,simulatePressure:!1,last:!0,thinning:1}),fill:Oo(o)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class Xh extends $t{constructor(n,s){super();k(this,"type","object_eraser_line");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:ft(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating eraser line renderer module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,clip:n.clip,listening:!1}),line:new Ne.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,stroke:"red",tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line");const{points:i,strokeWidth:o}=n;return this.konva.line.setAttrs({points:i.length===2?[...i,...i]:i,strokeWidth:o}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class x0 extends $t{constructor(n,s){super();k(this,"type","object_eraser_line_with_pressure");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:ft(this.state)}));const{id:i,clip:o}=n;this.id=i,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,clip:o,listening:!1}),line:new Ne.Path({name:`${this.type}:path`,listening:!1,fill:"red",shadowForStrokeEnabled:!1,globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line with pressure");const{points:i,strokeWidth:o}=n;return this.konva.line.setAttrs({data:kM(i,{size:o/2,simulatePressure:!1,last:!0,thinning:1})}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting eraser line visibility"),this.konva.group.visible(n)}}const U0e=new Error("request for lock canceled");var q0e=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class K0e{constructor(t,n=U0e){this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}acquire(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,i)=>{const o={resolve:s,reject:i,weight:t,priority:n},a=EO(this._queue,l=>n<=l.priority);a===-1&&t<=this._value?this._dispatchItem(o):this._queue.splice(a+1,0,o)})}runExclusive(t){return q0e(this,arguments,void 0,function*(n,s=1,i=0){const[o,a]=yield this.acquire(s,i);try{return yield n(o)}finally{a()}})}waitForUnlock(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),Z0e(this._weightedWaiters[t-1],{resolve:s,priority:n})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const n=this._value;this._value-=t.weight,t.resolve([n,this._newReleaser(t.weight)])}_newReleaser(t){let n=!1;return()=>{n||(n=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];n&&(n.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let n=this._value;n>0;n--){const s=this._weightedWaiters[n-1];if(!s)continue;const i=s.findIndex(o=>o.priority<=t);(i===-1?s:s.splice(0,i)).forEach(o=>o.resolve())}}}_couldLockImmediately(t,n){return(this._queue.length===0||this._queue[0].priority<n)&&t<=this._value}}function Z0e(e,t){const n=EO(e,s=>t.priority<=s.priority);e.splice(n+1,0,t)}function EO(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}var Y0e=function(e,t,n,s){function i(o){return o instanceof n?o:new n(function(a){a(o)})}return new(n||(n=Promise))(function(o,a){function l(h){try{d(s.next(h))}catch(f){a(f)}}function c(h){try{d(s.throw(h))}catch(f){a(f)}}function d(h){h.done?o(h.value):i(h.value).then(l,c)}d((s=s.apply(e,t||[])).next())})};class Xw{constructor(t){this._semaphore=new K0e(1,t)}acquire(){return Y0e(this,arguments,void 0,function*(t=0){const[,n]=yield this._semaphore.acquire(1,t);return n})}runExclusive(t,n=0){return this._semaphore.runExclusive(()=>t(),1,n)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}class ma extends $t{constructor(n,s){super();k(this,"type","object_image");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"imageElement",null);k(this,"isLoading",!1);k(this,"isError",!1);k(this,"mutex",new Xw);k(this,"updateImageSource",async n=>{this.log.trace({imageName:n},"Updating image source"),this.isLoading=!0,this.konva.group.visible(!0),this.konva.image||(this.konva.placeholder.group.visible(!1),this.konva.placeholder.text.text(Ce("common.loadingImage","Loading Image")));const s=await Q0(n);if(s===null){this.onFailedToLoadImage(Ce("controlLayers.unableToFindImage","Unable to find image"));return}const i=await Un(()=>_M(s.image_url));if(i.isErr()){this.onFailedToLoadImage(Ce("controlLayers.unableToLoadImage","Unable to load image"));return}this.imageElement=i.value,await this.updateImageElement()});k(this,"onFailedToLoadImage",n=>{var s;this.log({image:this.state.image},n),(s=this.konva.image)==null||s.visible(!1),this.isLoading=!1,this.isError=!0,this.konva.placeholder.text.text(n),this.konva.placeholder.group.visible(!0)});k(this,"updateImageElement",async()=>{const n=await this.mutex.acquire();try{if(this.imageElement){const{width:s,height:i}=this.state.image;this.konva.image?(this.log.trace("Updating Konva image attrs"),this.konva.image.setAttrs({image:this.imageElement,width:s,height:i,visible:!0})):(this.log.trace("Creating new Konva image"),this.konva.image=new Ne.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,width:s,height:i,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.placeholder.rect.setAttrs({width:s,height:i}),this.konva.placeholder.text.setAttrs({width:s,height:i,fontSize:s/16}),this.isLoading=!1,this.isError=!1,this.konva.placeholder.group.visible(!1)}}finally{n()}});k(this,"update",async(n,s=!1)=>{var i;if(s||this.state!==n){this.log.trace({state:n},"Updating image");const{image:o}=n,{width:a,height:l,image_name:c}=o;return(s||this.state.image.image_name!==c&&!this.isLoading)&&await this.updateImageSource(c),(i=this.konva.image)==null||i.setAttrs({width:a,height:l}),this.state=n,!0}return!1});k(this,"destroy",()=>{this.log.debug("Destroying image renderer module"),this.konva.group.destroy()});k(this,"setVisibility",n=>{this.log.trace({isVisible:n},"Setting image visibility"),this.konva.group.visible(n)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isLoading:this.isLoading,isError:this.isError,state:ft(this.state),konva:{group:rs(this.konva.group),image:this.konva.image?rs(this.konva.image):null}}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module");const{width:i,height:o}=n.image;this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1}),placeholder:{group:new Ne.Group({name:`${this.type}:placeholder_group`,listening:!1}),rect:new Ne.Rect({name:`${this.type}:placeholder_rect`,fill:"hsl(220 12% 45% / 1)",width:i,height:o,listening:!1,perfectDrawEnabled:!1}),text:new Ne.Text({name:`${this.type}:placeholder_text`,fill:"hsl(220 12% 10% / 1)",width:i,height:o,align:"center",verticalAlign:"middle",fontFamily:'"Inter Variable", sans-serif',fontSize:i/16,fontStyle:"600",text:Ce("common.loadingImage","Loading Image"),listening:!1,perfectDrawEnabled:!1})},image:null},this.konva.placeholder.group.add(this.konva.placeholder.rect),this.konva.placeholder.group.add(this.konva.placeholder.text),this.konva.group.add(this.konva.placeholder.group),this.state=n}}class C0 extends $t{constructor(n,s){super();k(this,"type","object_rect");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"state");k(this,"konva");k(this,"isFirstRender",!1);k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isFirstRender:this.isFirstRender,state:ft(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1}),rect:new Ne.Rect({name:`${this.type}:rect`,listening:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.rect),this.state=n}update(n,s=!1){if(s||this.state!==n){this.isFirstRender=!1,this.log.trace({state:n},"Updating rect");const{rect:i,color:o}=n;return this.konva.rect.setAttrs({x:i.x,y:i.y,width:i.width,height:i.height,fill:Oo(o)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting rect visibility"),this.konva.group.visible(n)}}class iy extends $t{constructor(n){super();k(this,"type","buffer_renderer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"state",null);k(this,"renderer",null);k(this,"konva");k(this,"renderBufferObject",async()=>{let n=!1;if(!this.state)return!1;let s=null;return this.renderer&&this.renderer.id!==this.state.id&&(s=this.renderer,this.renderer=null),this.state.type==="brush_line"?(Re(this.renderer instanceof Yh||!this.renderer),this.renderer||(this.renderer=new Yh(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="brush_line_with_pressure"?(Re(this.renderer instanceof b0||!this.renderer),this.renderer||(this.renderer=new b0(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line"?(Re(this.renderer instanceof Xh||!this.renderer),this.renderer||(this.renderer=new Xh(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line_with_pressure"?(Re(this.renderer instanceof x0||!this.renderer),this.renderer||(this.renderer=new x0(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="rect"?(Re(this.renderer instanceof C0||!this.renderer),this.renderer||(this.renderer=new C0(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="image"&&(Re(this.renderer instanceof ma||!this.renderer),this.renderer||(this.renderer=new ma(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=await this.renderer.update(this.state,!0)),s&&s.destroy(),n});k(this,"hasBuffer",()=>this.state!==null||this.renderer!==null);k(this,"setBuffer",async(n,s=!1)=>(this.log.trace("Setting buffer"),this.state=n,s&&this.konva.group.offset({x:0,y:0}),await this.renderBufferObject()));k(this,"clearBuffer",()=>{var n;(this.state||this.renderer)&&(this.log.trace("Clearing buffer"),(n=this.renderer)==null||n.destroy(),this.renderer=null,this.state=null)});k(this,"commitBuffer",n=>{if({...n},!this.state||!this.renderer){this.log.trace("No buffer to commit");return}this.log.trace({buffer:this.renderer.repr()},"Committing buffer"),this.parent.renderer.adoptObjectRenderer(this.renderer);{const s=this.parent.entityIdentifier;switch(this.state.type){case"brush_line":case"brush_line_with_pressure":this.manager.stateApi.addBrushLine({entityIdentifier:s,brushLine:this.state});break;case"eraser_line":case"eraser_line_with_pressure":this.manager.stateApi.addEraserLine({entityIdentifier:s,eraserLine:this.state});break;case"rect":this.manager.stateApi.addRect({entityIdentifier:s,rect:this.state});break}}this.renderer=null,this.state=null});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.renderer&&this.renderer.destroy()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,bufferState:ft(this.state),bufferRenderer:((n=this.renderer)==null?void 0:n.repr())??null}});this.id=_e(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:buffer_group`,listening:!1})},this.parent.konva.layer.add(this.konva.group),this.subscriptions.add(this.manager.tool.$tool.listen(()=>{this.hasBuffer()&&!this.manager.$isBusy.get()&&this.commitBuffer()}))}}const X0e={PROCESS_DEBOUNCE_MS:1e3};class LO extends $t{constructor(n){super();k(this,"type","canvas_filterer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",X0e);k(this,"subscriptions",new Set);k(this,"abortController",null);k(this,"$isFiltering",Oe(!1));k(this,"$lastProcessedHash",Oe(""));k(this,"$isProcessing",Oe(!1));k(this,"$filterConfig",Oe(En.adjust_image.buildDefaults()));k(this,"$initialFilterConfig",Oe(null));k(this,"$imageState",Oe(null));k(this,"$hasImageState",gs(this.$imageState,n=>n!==null));k(this,"$simple",Oe(!1));k(this,"imageModule",null);k(this,"konva");k(this,"KONVA_GROUP_NAME",`${this.type}:group`);k(this,"subscribe",()=>{this.subscriptions.add(this.$filterConfig.listen(()=>{this.manager.stateApi.getSettings().autoProcess&&this.$isFiltering.get()&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Jf,n=>{n&&this.$isFiltering.get()&&this.process()}))});k(this,"unsubscribe",()=>{this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});k(this,"start",n=>{const s=this.manager.stateApi.$filteringAdapter.get();if(s){this.log.error(`Already filtering an entity: ${s.id}`);return}this.log.trace("Initializing filter"),this.resetEphemeralState(),this.$isFiltering.set(!0);const i=this.parent.transformer.$pixelRect.get(),o=qb(this.parent.state.position,i);if(this.konva.group.setAttrs(o),this.parent.konva.layer.add(this.konva.group),n)this.$filterConfig.set(n),this.$initialFilterConfig.set(n),this.$simple.set(!0);else{const a=this.createInitialFilterConfig();this.$filterConfig.set(a),this.$initialFilterConfig.set(a),this.$simple.set(!1)}this.subscribe(),this.manager.stateApi.$filteringAdapter.set(this.parent),this.manager.stateApi.getSettings().autoProcess&&this.processImmediate()});k(this,"createInitialFilterConfig",()=>{if(this.parent.type==="control_layer_adapter"&&this.parent.state.controlAdapter.model){const n=Zue(this.parent.state.controlAdapter.model.key,aC),s=this.manager.stateApi.runSelector(n);return(rO(s)??En.canny_edge_detection).buildDefaults()}else return En.adjust_image.buildDefaults()});k(this,"processImmediate",async()=>{var x;if(!this.$isFiltering.get()){this.log.warn("Cannot process filter when not initialized");return}const n=this.$filterConfig.get(),s=En[n.type];if(!(((x=s.validateConfig)==null?void 0:x.call(s,n))??!0)){this.log.error({config:n},"Invalid filter config");return}const o=kl({config:n});if(o===this.$lastProcessedHash.get()){this.log.trace("Already processed config");return}this.log.trace({config:n},"Processing filter");const a=this.parent.transformer.getRelativeRect(),l=await Un(()=>this.parent.renderer.rasterize({rect:a,attrs:{filters:[],opacity:1}}));if(l.isErr()){fe({status:"error",title:"Failed to process filter"}),this.log.error({error:Es(l.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}this.$isProcessing.set(!0);const c=l.value,d=bM(()=>s.buildGraph(c,n));if(d.isErr()){this.log.error({error:Es(d.error)},"Error building filter graph"),this.$isProcessing.set(!1);return}const h=new AbortController;this.abortController=h;const{graph:f,outputNodeId:p}=d.value,g=await Un(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:f,outputNodeId:p,prepend:!0,signal:h.signal}));if(g.isErr()){this.log.error({error:Es(g.error)},"Error filtering"),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null;return}this.log.trace({imageDTO:g.value},"Filtered");const m=Jr(g.value);this.$imageState.set(m);const y=this.imageModule;this.imageModule=new ma(m,this),await this.imageModule.update(m,!0),this.konva.group.add(this.imageModule.konva.group),this.parent.renderer.hideObjects(),y&&y.destroy(),this.$lastProcessedHash.set(o),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null});k(this,"process",Ea(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS));k(this,"apply",()=>{const n=this.$imageState.get();if(!n){this.log.warn("No image state to apply filter to");return}this.log.trace("Applying"),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.teardown()});k(this,"saveAs",n=>{const s=this.$imageState.get();if(!s){this.log.warn("No image state to apply filter to");return}this.log.trace(`Saving as ${n}`);const i=this.parent.transformer.getRelativeRect(),o={overrides:{objects:[s],position:{x:Math.round(i.x),y:Math.round(i.y)}},isSelected:!0};switch(n){case"raster_layer":this.manager.stateApi.addRasterLayer(o);break;case"control_layer":this.manager.stateApi.addControlLayer(o);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(o);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(o);break;default:Re(!1)}});k(this,"resetEphemeralState",()=>{this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null);const n=ft(this.$initialFilterConfig.get()??this.createInitialFilterConfig());this.$filterConfig.set(n),this.$imageState.set(null),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1)});k(this,"teardown",()=>{this.unsubscribe(),this.parent.renderer.showObjects(),this.konva.group.remove(),this.resetEphemeralState(),this.$isFiltering.set(!1),this.manager.stateApi.$filteringAdapter.set(null)});k(this,"reset",()=>{this.log.trace("Resetting"),this.resetEphemeralState()});k(this,"cancel",()=>{this.log.trace("Canceling"),this.teardown()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,config:this.config,imageState:ft(this.$imageState.get()),$isFiltering:this.$isFiltering.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$filterConfig:this.$filterConfig.get(),konva:{group:rs(this.konva.group)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating filter module"),this.konva={group:new Ne.Group({name:this.KONVA_GROUP_NAME})}}}const Q0e=e=>{const t=e.data.length/4;for(let n=0;n<t;n++){const s=e.data[n*4+0],i=e.data[n*4+1],o=e.data[n*4+2],a=e.data[n*4+3],l=Math.min(s,i,o),c=Math.max(s,i,o);e.data[n*4+3]=Math.min(a,(l+c)/2)}},J0e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="6px" height="6px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M1,-2L13,10" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M-1,2L10,13" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
</svg>\r
`,e1e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="6px" height="6px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.3px;"/>\r
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.3px;"/>\r
</svg>\r
`,t1e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="12px" height="12px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0.5,-1L0.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M4.5,-1L4.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M8.5,-1L8.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,0.5L12,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,4.5L12,4.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,8.5L12,8.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`,n1e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="9px" height="9px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M10,0.5L-1,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M10,3.5L-1,3.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M10,6.5L-1,6.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`,s1e=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="9px" height="9px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0.5,-1L0.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M3.5,-1L3.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M6.5,-1L6.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`;function r1e(e,t){let n="data:image/svg+xml;utf8,";return e==="crosshatch"?n+=J0e:e==="diagonal"?n+=e1e:e==="horizontal"?n+=n1e:e==="vertical"?n+=s1e:e==="grid"&&(n+=t1e),n=n.replaceAll("stroke:black",`stroke:${Tl(t)}`),n}function i1e(e,...t){const n=new Image;return n.onload=()=>{e.fillPatternImage(n)},n.crossOrigin=qf.get()?"use-credentials":"anonymous",n.src=r1e(...t),n}class oy extends $t{constructor(n){super();k(this,"type","object_renderer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"renderers",new Oh);k(this,"konva");k(this,"initialize",async()=>{this.log.debug("Initializing module"),await this.render()});k(this,"render",async()=>{let n=!1;const s=this.parent.state.objects,i=s.map(o=>o.id);for(const o of this.renderers.values())i.includes(o.id)||(this.renderers.delete(o.id),o.destroy(),n=!0);for(const o of s)n=await this.renderObject(o)||n;return this.syncKonvaCache(n),n});k(this,"hideObjects",()=>{this.konva.objectGroup.hide()});k(this,"showObjects",()=>{this.konva.objectGroup.show()});k(this,"adoptObjectRenderer",n=>{this.renderers.set(n.id,n),n.konva.group.moveTo(this.konva.objectGroup)});k(this,"syncKonvaCache",(n=!1)=>{if(this.renderers.size===0){this.log.trace("Clearing object group cache"),this.konva.objectGroup.clearCache();return}const s=this.parent.konva.layer.visible(),i=this.konva.objectGroup.isCached();s&&(n||!i)&&(this.log.trace("Caching object group"),this.konva.objectGroup.clearCache(),this.konva.objectGroup.cache({pixelRatio:1,imageSmoothingEnabled:!1}))});k(this,"updateTransparencyEffect",()=>{if(this.parent.state.type==="control_layer"){const n=this.parent.state.withTransparencyEffect?[Q0e]:[];this.konva.objectGroup.filters(n)}});k(this,"updateCompositingRectFill",sx(n=>{if(!n&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect fill");const s=this.parent.state.fill;s.style==="solid"?this.konva.compositing.rect.setAttrs({fill:Tl(s.color),fillPriority:"color"}):(this.konva.compositing.rect.setAttrs({fillPriority:"pattern"}),i1e(this.konva.compositing.rect,s.style,s.color))},100));k(this,"updateCompositingRectSize",n=>{if(!n&&!this.hasObjects()||!this.parent.konva.layer.visible()||!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance")return;this.log.trace("Updating compositing rect size");const s=this.manager.stage.unscale(1);this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect(),fillPatternScaleX:s,fillPatternScaleY:s})});k(this,"updateCompositingRectPosition",n=>{!n&&!this.hasObjects()||this.parent.konva.layer.visible()&&(!this.konva.compositing||this.parent.state.type!=="inpaint_mask"&&this.parent.state.type!=="regional_guidance"||(this.log.trace("Updating compositing rect position"),this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect()})))});k(this,"updateOpacity",sx(()=>{if(!this.parent.konva.layer.visible())return;this.log.trace("Updating opacity");const n=this.parent.state.opacity;this.konva.compositing?this.konva.compositing.group.opacity(n):this.konva.objectGroup.opacity(n),this.parent.bufferRenderer.konva.group.opacity(n)},100));k(this,"renderObject",async(n,s=!1)=>{let i=!1,o=this.renderers.get(n.id);const a=!o;return n.type==="brush_line"?(Re(o instanceof Yh||!o),o||(o=new Yh(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="brush_line_with_pressure"?(Re(o instanceof b0||!o),o||(o=new b0(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="eraser_line"?(Re(o instanceof Xh||!o),o||(o=new Xh(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="eraser_line_with_pressure"?(Re(o instanceof x0||!o),o||(o=new x0(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="rect"?(Re(o instanceof C0||!o),o||(o=new C0(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=o.update(n,s||a)):n.type==="image"&&(Re(o instanceof ma||!o),o||(o=new ma(n,this),this.renderers.set(o.id,o),this.konva.objectGroup.add(o.konva.group)),i=await o.update(n,s||a)),i&&this.konva.objectGroup.isCached()&&this.konva.objectGroup.clearCache(),i});k(this,"needsPixelBbox",()=>{let n=!1;for(const s of this.renderers.values()){const i=s instanceof Xh,o=s instanceof ma,a=s instanceof Yh&&s.state.clip;if(i||a||o){n=!0;break}}return n});k(this,"hasObjects",()=>this.renderers.size>0||this.parent.bufferRenderer.hasBuffer());k(this,"rasterize",async n=>{const s=this.manager.stateApi.$rasterizingAdapter.get();s&&Re(!1,`Already rasterizing an entity: ${s.id}`);const{rect:i,replaceObjects:o,attrs:a,bg:l,ignoreCache:c}={replaceObjects:!1,ignoreCache:!1,attrs:{},...n};let d=null;const h={rect:i,attrs:a,bg:l},f=this.parent.hash(h),p=this.manager.cache.imageNameCache.get(f);if(p&&!c&&(d=await Q0(p),d))return this.log.trace({rect:i,cachedImageName:p,imageDTO:d},"Using cached rasterized image"),d;this.log.trace({rasterizeArgs:h},"Rasterizing entity"),this.manager.stateApi.$rasterizingAdapter.set(this.parent);try{const g=await this.getBlob(h);this.manager._isDebugging&&xM(g,"Rasterized entity"),d=await ca({file:new File([g],`${this.id}_rasterized.png`,{type:"image/png"}),image_category:"other",is_intermediate:!0,silent:!0});const m=Jr(d);return o&&(await this.parent.bufferRenderer.setBuffer(m),this.parent.bufferRenderer.commitBuffer({pushToState:!1})),this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:m,position:{x:Math.round(i.x),y:Math.round(i.y)},replaceObjects:o}),this.manager.cache.imageNameCache.set(f,d.image_name),d}catch(g){throw this.log.error({rasterizeArgs:h,error:Es(g)},"Failed to rasterize entity"),g}finally{this.manager.stateApi.$rasterizingAdapter.set(null)}});k(this,"cloneObjectGroup",(n={})=>{const{attrs:s}=n,i=this.konva.objectGroup.clone();return s&&i.setAttrs(s),i.hasChildren()&&i.cache({pixelRatio:1,imageSmoothingEnabled:!1}),i});k(this,"getCanvas",(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i}),l=qq({node:a,rect:s,bg:o});return a.destroy(),l});k(this,"getBlob",async(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i});return await Kq({node:a,rect:s,bg:o})});k(this,"getImageData",(n={})=>{const{rect:s,attrs:i,bg:o}=n,a=this.cloneObjectGroup({attrs:i}),l=Zq({node:a,rect:s,bg:o});return a.destroy(),l});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear();for(const n of this.renderers.values())n.destroy();this.renderers.clear()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,renderers:Array.from(this.renderers.values()).map(n=>n.repr()),konva:{objectGroup:rs(this.konva.objectGroup)}}));if(this.id=_e(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={objectGroup:new Ne.Group({name:`${this.type}:object_group`,listening:!1}),compositing:null},this.parent.konva.layer.add(this.konva.objectGroup),this.parent.entityIdentifier.type==="inpaint_mask"||this.parent.entityIdentifier.type==="regional_guidance"){const s=new Ne.Rect({name:`${this.type}:compositing_rect`,globalCompositeOperation:"source-in",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1});this.konva.compositing={group:new Ne.Group({name:`${this.type}:compositing_group`,listening:!1}),rect:s,patternImage:new Image},this.konva.compositing.group.add(this.konva.compositing.rect),this.parent.konva.layer.add(this.konva.compositing.group)}this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,i)=>{this.konva.compositing&&((s.width!==i.width||s.height!==i.height||s.scale!==i.scale)&&this.updateCompositingRectSize(),(s.x!==i.x||s.y!==i.y)&&this.updateCompositingRectPosition())}))}}const o1e={RECT_CALC_DEBOUNCE_MS:300,ANCHOR_HIT_PADDING:10,OUTLINE_PADDING:0,OUTLINE_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_FILL_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_STROKE_COLOR:"hsl(200 76% 77% / 1)",SCALE_ANCHOR_CORNER_RADIUS_RATIO:.5,SCALE_ANCHOR_STROKE_WIDTH:2,SCALE_ANCHOR_SIZE:8,ROTATE_ANCHOR_FILL_COLOR:"hsl(200 76% 95% / 1)",ROTATE_ANCHOR_STROKE_COLOR:"hsl(200 76% 40% / 1)",ROTATE_ANCHOR_SIZE:12};class ay extends $t{constructor(n){super();k(this,"type","entity_transformer");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",o1e);k(this,"$nodeRect",Oe(lc()));k(this,"$pixelRect",Oe(lc()));k(this,"$isPendingRectCalculation",Oe(!0));k(this,"subscriptions",new Set);k(this,"$isTransforming",Oe(!1));k(this,"$interactionMode",Oe("off"));k(this,"$isDragEnabled",Oe(!1));k(this,"$isTransformEnabled",Oe(!1));k(this,"$isProcessing",Oe(!1));k(this,"$silentTransform",Oe(!1));k(this,"transformMutex",new Xw);k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.syncInteractionState()});k(this,"syncCursorStyle",()=>{this.parent.renderer.hasObjects()?this.manager.stage.setCursor("default"):this.manager.stage.setCursor("not-allowed")});k(this,"anchorStyleFunc",n=>{n.hasName("rotater")&&n.setAttrs({height:this.config.ROTATE_ANCHOR_SIZE,width:this.config.ROTATE_ANCHOR_SIZE,cornerRadius:this.config.ROTATE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,fill:this.config.ROTATE_ANCHOR_FILL_COLOR,stroke:this.config.SCALE_ANCHOR_FILL_COLOR,offsetX:this.config.ROTATE_ANCHOR_SIZE/2,offsetY:this.config.ROTATE_ANCHOR_SIZE/2}),n.hitFunc(s=>{s.beginPath(),s.rect(-this.config.ANCHOR_HIT_PADDING,-this.config.ANCHOR_HIT_PADDING,n.width()+this.config.ANCHOR_HIT_PADDING*2,n.height()+this.config.ANCHOR_HIT_PADDING*2),s.closePath(),s.fillStrokeShape(n)})});k(this,"anchorDragBoundFunc",(n,s)=>{if(this.konva.transformer.getActiveAnchor()==="rotater")return s;const i=this.manager.stateApi.$shiftKey.get()?this.manager.stateApi.getGridSize():1,o=this.manager.stage.getScale(),a=this.manager.stage.getPosition(),l=Br(s.x/o,i),c=Br(s.y/o,i),d=a.x%(o*i),h=a.y%(o*i),f=l*o+d,p=c*o+h;return{x:f,y:p}});k(this,"boxBoundFunc",(n,s)=>this.konva.transformer.getActiveAnchor()!=="rotater"?s:this.manager.stateApi.$shiftKey.get()&&Math.abs(s.rotation%(Math.PI/4))>0?n:s);k(this,"snapProxyRectToPixelGrid",()=>{const n=this.konva.proxyRect.x(),s=this.konva.proxyRect.y(),i=Math.round(n),o=Math.round(s),a=this.konva.proxyRect.width(),l=this.konva.proxyRect.height(),c=this.konva.proxyRect.scaleX(),d=this.konva.proxyRect.scaleY(),h=Math.max(Math.abs(Math.round(a*c)),1),f=Math.max(Math.abs(Math.round(l*d)),1),p=h/a*Math.sign(c),g=f/l*Math.sign(d);this.konva.proxyRect.setAttrs({x:i,y:o,scaleX:p,scaleY:g}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxFill",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=n.width/this.konva.proxyRect.width(),i=n.height/this.konva.proxyRect.height();this.konva.proxyRect.setAttrs({x:n.x,y:n.y,scaleX:s,scaleY:i,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxContain",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getGridSize(),i=this.konva.proxyRect.width(),o=this.konva.proxyRect.height(),a=n.width/i,l=n.height/o,c=Math.min(a,l),d=(n.width-i*c)/2,h=(n.height-o*c)/2;this.konva.proxyRect.setAttrs({x:to(Br(n.x+d,s),n.x,n.x+n.width),y:to(Br(n.y+h,s),n.y,n.y+n.height),scaleX:c,scaleY:c,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"fitToBboxCover",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getGridSize(),i=this.konva.proxyRect.width(),o=this.konva.proxyRect.height(),a=n.width/i,l=n.height/o,c=Math.max(a,l),d=(n.width-i*c)/2,h=(n.height-o*c)/2;this.konva.proxyRect.setAttrs({x:Br(n.x+d,s),y:Br(n.y+h,s),scaleX:c,scaleY:c,rotation:0}),this.syncObjectGroupWithProxyRect()});k(this,"onDragMove",()=>{const n=this.manager.stateApi.getGridSize();this.konva.proxyRect.x(Br(this.konva.proxyRect.x(),n)),this.konva.proxyRect.y(Br(this.konva.proxyRect.y(),n));const s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s}),this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y()})});k(this,"onDragEnd",()=>{if(this.$isTransforming.get())return;const n=this.$pixelRect.get(),s={x:this.konva.proxyRect.x()-n.x,y:this.konva.proxyRect.y()-n.y};this.log.trace({position:s},"Position changed"),this.manager.stateApi.setEntityPosition({entityIdentifier:this.parent.entityIdentifier,position:s})});k(this,"nudgeBy",n=>{const s=this.konva.proxyRect.position(),i=Wi(s,n);this.konva.proxyRect.setAttrs(i),this.syncObjectGroupWithProxyRect(),this.manager.stateApi.moveEntityBy({entityIdentifier:this.parent.entityIdentifier,offset:n}),this.log.trace({offset:n},"Nudged")});k(this,"syncObjectGroupWithProxyRect",()=>{this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y(),scaleX:this.konva.proxyRect.scaleX(),scaleY:this.konva.proxyRect.scaleY(),rotation:this.konva.proxyRect.rotation()})});k(this,"update",(n,s)=>{const i=this.manager.stage.unscale(1),o=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:n.x+s.x-o,y:n.y+s.y-o,width:s.width+o*2,height:s.height+o*2,strokeWidth:i}),this.konva.proxyRect.setAttrs({x:n.x+s.x,y:n.y+s.y,width:s.width,height:s.height})});k(this,"syncInteractionState",()=>{var a,l;if(this.log.trace("Syncing interaction state"),this.manager.stagingArea.$isStaging.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if((a=this.parent.segmentAnything)!=null&&a.$isSegmenting.get()){this.parent.konva.layer.listening(!0),this._setInteractionMode("off");return}if((l=this.parent.filterer)!=null&&l.$isFiltering.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.manager.stateApi.$isTransforming.get()&&!this.$isTransforming.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const n=this.$pixelRect.get();if(this.$isPendingRectCalculation.get()||n.width===0||n.height===0){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const i=this.manager.tool.$tool.get();if(!this.manager.stateApi.getIsSelected(this.parent.id)){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isEmpty.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.parent.$isLocked.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(!this.$isTransforming.get()&&i==="move"){this.parent.konva.layer.listening(!0),this._setInteractionMode("drag");return}if(this.$isTransforming.get()){i==="view"?(this.parent.konva.layer.listening(!1),this._setInteractionMode("off")):(this.parent.konva.layer.listening(!0),this._setInteractionMode("all"));return}this.parent.konva.layer.listening(!1),this._setInteractionMode("off")});k(this,"syncScale",()=>{const n=this.manager.stage.unscale(1),s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s,width:this.konva.proxyRect.width()*this.konva.proxyRect.scaleX()+s*2,height:this.konva.proxyRect.height()*this.konva.proxyRect.scaleY()+s*2,strokeWidth:n}),this.konva.transformer.forceUpdate()});k(this,"startTransform",async n=>{const s=this.manager.stateApi.$transformingAdapter.get();s&&Re(!1,`Already transforming an entity: ${s.id}`),await this.transformMutex.acquire(),this.log.debug("Starting transform");const{silent:i}={silent:!1,...n};this.$silentTransform.set(i),this.$isTransforming.set(!0),this.manager.stateApi.$transformingAdapter.set(this.parent),this.syncInteractionState()});k(this,"applyTransform",async()=>{if(!this.$isTransforming.get()){this.log.warn("Cannot apply transform when not transforming. Did you forget to call `await adapter.transformer.startTransform()`?");return}this.log.debug("Applying transform"),this.$isProcessing.set(!0),this._setInteractionMode("off");const n=this.getRelativeRect(),s=await Un(()=>this.parent.renderer.rasterize({rect:Yq(n),replaceObjects:!0,ignoreCache:!0,attrs:{opacity:1,filters:[]}}));s.isErr()&&(fe({status:"error",title:"Failed to apply transform"}),this.log.error({error:Es(s.error)},"Failed to rasterize entity")),this.requestRectCalculation(),this.stopTransform()});k(this,"resetTransform",()=>{this.resetScale(),this.updatePosition(),this.updateBbox()});k(this,"stopTransform",()=>{this.log.debug("Stopping transform"),this.$isTransforming.set(!1),this.resetTransform(),this.syncInteractionState(),this.manager.stateApi.$transformingAdapter.set(null),this.$isProcessing.set(!1),this.transformMutex.release()});k(this,"resetScale",()=>{const n={scaleX:1,scaleY:1,rotation:0};this.parent.renderer.konva.objectGroup.setAttrs(n),this.parent.bufferRenderer.konva.group.setAttrs(n),this.konva.outlineRect.setAttrs(n),this.konva.proxyRect.setAttrs(n)});k(this,"updatePosition",n=>{this.log.trace("Updating position");const s=Z2(n,"position",this.parent.state.position),i=this.$pixelRect.get(),o={x:s.x+i.x,y:s.y+i.y,offsetX:i.x,offsetY:i.y};this.parent.renderer.konva.objectGroup.setAttrs(o),this.parent.bufferRenderer.konva.group.setAttrs(o),this.update(s,i)});k(this,"_setInteractionMode",n=>{this.$interactionMode.set(n),n==="drag"?(this._enableDrag(),this._disableTransform(),this._showBboxOutline()):n==="all"?(this._enableDrag(),this._enableTransform(),this._hideBboxOutline()):n==="off"&&(this._disableDrag(),this._disableTransform(),this._hideBboxOutline())});k(this,"updateBbox",()=>{const n=this.$nodeRect.get(),s=this.$pixelRect.get();if(this.log.trace({nodeRect:n,pixelRect:s},"Updating bbox"),this.$isPendingRectCalculation.get()){this.syncInteractionState();return}if(s.width===0||s.height===0)this.parent.renderer.hasObjects()&&(this.manager.stateApi.resetEntity({entityIdentifier:this.parent.entityIdentifier}),this.syncInteractionState());else{this.syncInteractionState(),this.update(this.parent.state.position,s);const i={x:this.parent.state.position.x+s.x,y:this.parent.state.position.y+s.y,offsetX:s.x,offsetY:s.y};this.parent.renderer.konva.objectGroup.setAttrs(i),this.parent.bufferRenderer.konva.group.setAttrs(i)}});k(this,"calculateRect",Ea(()=>{this.log.debug("Calculating bbox");const n=this.parent.getCanvas();if(!this.parent.renderer.hasObjects()){this.log.trace("No objects, resetting bbox"),this.$nodeRect.set(lc()),this.$pixelRect.set(lc()),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const s=this.parent.renderer.konva.objectGroup.getClientRect({skipTransform:!0});if(!this.parent.renderer.needsPixelBbox()){this.$nodeRect.set({...s}),this.$pixelRect.set({...s}),this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get()},"Got bbox from client rect"),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const i=jM(n);this.manager.worker.requestBbox({buffer:i.data.buffer,width:i.width,height:i.height},o=>{if(o){const{minX:a,minY:l,maxX:c,maxY:d}=o;this.$nodeRect.set({...s}),this.$pixelRect.set({x:Math.round(s.x)+a,y:Math.round(s.y)+l,width:c-a,height:d-l})}else this.$nodeRect.set(lc()),this.$pixelRect.set(lc());this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get(),extents:o},"Got bbox from worker"),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release()})},this.config.RECT_CALC_DEBOUNCE_MS));k(this,"requestRectCalculation",async()=>{await this.transformMutex.acquire(),this.$isPendingRectCalculation.set(!0),this.syncInteractionState(),this.calculateRect()});k(this,"getRelativeRect",()=>this.konva.proxyRect.getClientRect({relativeTo:this.parent.konva.layer}));k(this,"_enableTransform",()=>{this.$isTransformEnabled.set(!0),this.konva.transformer.visible(!0),this.konva.transformer.listening(!0),this.konva.transformer.nodes([this.konva.proxyRect])});k(this,"_disableTransform",()=>{this.$isTransformEnabled.set(!1),this.konva.transformer.visible(!1),this.konva.transformer.listening(!1),this.konva.transformer.nodes([])});k(this,"_enableDrag",()=>{this.$isDragEnabled.set(!0),this.konva.proxyRect.visible(!0),this.konva.proxyRect.listening(!0)});k(this,"_disableDrag",()=>{this.$isDragEnabled.set(!1),this.konva.proxyRect.visible(!1),this.konva.proxyRect.listening(!1)});k(this,"_showBboxOutline",()=>{this.konva.outlineRect.visible(!0)});k(this,"_hideBboxOutline",()=>{this.konva.outlineRect.visible(!1)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$nodeRect:this.$nodeRect.get(),$pixelRect:this.$pixelRect.get(),$isPendingRectCalculation:this.$isPendingRectCalculation.get(),$isTransforming:this.$isTransforming.get(),$interactionMode:this.$interactionMode.get(),$isDragEnabled:this.$isDragEnabled.get(),$isTransformEnabled:this.$isTransformEnabled.get(),$isProcessing:this.$isProcessing.get(),konva:{transformer:rs(this.konva.transformer),proxyRect:rs(this.konva.proxyRect),outlineRect:rs(this.konva.outlineRect)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.outlineRect.destroy(),this.konva.transformer.destroy(),this.konva.proxyRect.destroy()});this.id=_e(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={outlineRect:new Ne.Rect({listening:!1,draggable:!1,name:`${this.type}:outline_rect`,stroke:this.config.OUTLINE_COLOR,perfectDrawEnabled:!1,hitStrokeWidth:0}),transformer:new Ne.Transformer({name:`${this.type}:transformer`,visible:!1,listening:!1,rotateEnabled:!0,flipEnabled:!0,keepRatio:!0,shiftBehavior:"inverted",padding:this.config.OUTLINE_PADDING,stroke:this.config.OUTLINE_COLOR,anchorFill:this.config.SCALE_ANCHOR_FILL_COLOR,anchorStroke:this.config.SCALE_ANCHOR_STROKE_COLOR,anchorStrokeWidth:this.config.SCALE_ANCHOR_STROKE_WIDTH,anchorSize:this.config.SCALE_ANCHOR_SIZE,anchorCornerRadius:this.config.SCALE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc,boundBoxFunc:this.boxBoundFunc}),proxyRect:new Ne.Rect({name:`${this.type}:proxy_rect`,listening:!1,draggable:!0})},this.konva.transformer.on("transform",this.syncObjectGroupWithProxyRect),this.konva.transformer.on("transformend",this.snapProxyRectToPixelGrid),this.konva.transformer.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.transformer.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("dragend",this.onDragEnd),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.subscriptions.add(()=>{this.konva.transformer.off("transform transformend pointerenter pointerleave"),this.konva.proxyRect.off("dragmove dragend pointerenter pointerleave")}),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,i)=>{s.scale!==i.scale&&this.syncScale()})),this.subscriptions.add(this.manager.stateApi.$shiftKey.listen(s=>{this.konva.transformer.rotationSnaps(s?[0,45,90,135,180,225,270,315]:[])})),this.subscriptions.add(this.manager.tool.$tool.listen(this.syncInteractionState)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(kn,this.syncInteractionState)),this.subscriptions.add(this.manager.$isBusy.listen(this.syncInteractionState)),this.parent.konva.layer.add(this.konva.outlineRect),this.parent.konva.layer.add(this.konva.proxyRect),this.parent.konva.layer.add(this.konva.transformer)}}const a1e={SAM_POINT_RADIUS:8,SAM_POINT_BORDER_WIDTH:2,SAM_POINT_BORDER_COLOR:{r:0,g:0,b:0,a:1},SAM_POINT_FOREGROUND_COLOR:{r:50,g:255,b:0,a:1},SAM_POINT_BACKGROUND_COLOR:{r:255,g:0,b:50,a:1},SAM_POINT_NEUTRAL_COLOR:{r:0,g:225,b:255,a:1},MASK_COLOR:{r:0,g:225,b:255,a:1},PROCESS_DEBOUNCE_MS:1e3},R0=class R0 extends $t{constructor(n){super();k(this,"type","canvas_segment_anything");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",a1e);k(this,"subscriptions",new Set);k(this,"abortController",null);k(this,"$isSegmenting",Oe(!1));k(this,"$lastProcessedHash",Oe(""));k(this,"$isProcessing",Oe(!1));k(this,"$pointType",Oe(1));k(this,"$pointTypeString",gs(this.$pointType,n=>$y[n]));k(this,"$isDraggingPoint",Oe(!1));k(this,"$imageState",Oe(null));k(this,"$hasImageState",gs(this.$imageState,n=>n!==null));k(this,"$points",Oe([]));k(this,"$hasPoints",gs(this.$points,n=>n.length>0));k(this,"$invert",Oe(!1));k(this,"imageModule",null);k(this,"konva");k(this,"KONVA_CIRCLE_NAME",`${this.type}:circle`);k(this,"KONVA_GROUP_NAME",`${this.type}:group`);k(this,"KONVA_POINT_GROUP_NAME",`${this.type}:point_group`);k(this,"KONVA_MASK_GROUP_NAME",`${this.type}:mask_group`);k(this,"KONVA_COMPOSITING_RECT_NAME",`${this.type}:compositing_rect`);k(this,"syncCursorStyle",()=>{this.$isProcessing.get()?this.manager.stage.setCursor("wait"):this.$isSegmenting.get()&&this.manager.stage.setCursor("crosshair")});k(this,"syncPointScales",()=>{const n=this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),s=this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH);for(const i of this.$points.get())i.konva.circle.radius(n),i.konva.circle.strokeWidth(s)});k(this,"getSAMPoints",()=>{const n=[];for(const{id:s,coord:i,label:o}of this.$points.get())n.push({id:s,x:i.x,y:i.y,label:o});return n});k(this,"onStagePointerUp",n=>{if(n.evt.button!==0||this.manager.stage.getIsDragging()||this.$isDraggingPoint.get()||this.$isProcessing.get())return;const s=this.manager.tool.$cursorPos.get();if(!s)return;const i=this.parent.transformer.$pixelRect.get(),o=qb(this.parent.state.position,i),a=Wi(s.relative,o),l=this.createPoint(a,this.$pointType.get()),c=[...this.$points.get(),l];this.$points.set(c)});k(this,"subscribe",()=>{this.manager.stage.konva.stage.on("pointerup",this.onStagePointerUp),this.subscriptions.add(()=>{this.manager.stage.konva.stage.off("pointerup",this.onStagePointerUp)}),this.subscriptions.add(this.$isProcessing.listen(n=>{this.syncCursorStyle(),this.parent.konva.layer.listening(!n)})),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((n,s)=>{n.scale!==s.scale&&this.syncPointScales()})),this.subscriptions.add(this.$points.listen(n=>{n.length!==0&&this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.$invert.listen(()=>{this.$points.get().length!==0&&this.manager.stateApi.getSettings().autoProcess&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Jf,n=>{this.$points.get().length!==0&&n&&this.process()}))});k(this,"unsubscribe",()=>{this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});k(this,"start",()=>{const n=this.manager.stateApi.$segmentingAdapter.get();if(n){this.log.error(`Already segmenting an entity: ${n.id}`);return}this.log.trace("Starting segment anything"),this.resetEphemeralState(),this.$isSegmenting.set(!0);const s=this.parent.transformer.$pixelRect.get(),i=qb(this.parent.state.position,s);this.konva.group.setAttrs(i),this.parent.konva.layer.add(this.konva.group),this.parent.konva.layer.listening(!0),this.subscribe(),this.manager.stateApi.$segmentingAdapter.set(this.parent),this.syncCursorStyle()});k(this,"processImmediate",async()=>{if(!this.$isSegmenting.get()){this.log.warn("Cannot process segmentation when not initialized");return}if(this.$isProcessing.get()){this.log.warn("Already processing");return}const n=this.getSAMPoints();if(n.length===0){this.log.trace("No points to segment");return}const s=this.$invert.get(),i=kl({points:n,invert:s});if(i===this.$lastProcessedHash.get()){this.log.trace("Already processed points");return}this.$isProcessing.set(!0),this.log.trace({points:n},"Segmenting");const o=this.parent.transformer.getRelativeRect(),a=await Un(()=>this.parent.renderer.rasterize({rect:o,attrs:{filters:[],opacity:1}}));if(a.isErr()){fe({status:"error",title:"Failed to select object"}),this.log.error({error:Es(a.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}const l=new AbortController;this.abortController=l;const{graph:c,outputNodeId:d}=R0.buildGraph(a.value,n,s),h=await Un(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:c,outputNodeId:d,prepend:!0,signal:l.signal}));if(h.isErr()){this.log.error({error:Es(h.error)},"Error segmenting"),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null;return}this.log.trace({imageDTO:h.value},"Segmented");const f=Jr(h.value);this.$imageState.set(f),this.imageModule&&this.imageModule.destroy(),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.imageModule=new ma(f,this),await this.imageModule.update(f,!0),this.konva.compositingRect.setAttrs({width:f.image.width,height:f.image.height,visible:!0}),this.konva.maskGroup.add(this.imageModule.konva.group),this.konva.compositingRect.moveToTop(),this.konva.maskGroup.cache(),this.konva.maskTween=new Ne.Tween({node:this.konva.maskGroup,duration:1,opacity:.4,yoyo:!0,repeat:1/0,easing:Ne.Easings.EaseOut}),this.konva.maskTween.play(),this.$lastProcessedHash.set(i),this.$isProcessing.set(!1),this.abortController.signal.aborted||this.abortController.abort(),this.abortController=null});k(this,"process",Ea(this.processImmediate,this.config.PROCESS_DEBOUNCE_MS));k(this,"apply",()=>{const n=this.$imageState.get();if(!n){this.log.error("No image state to apply");return}this.log.trace("Applying");const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.teardown()});k(this,"saveAs",n=>{const s=this.$imageState.get();if(!s){this.log.error("No image state to save as");return}this.log.trace(`Saving as ${n}`),this.imageModule&&this.parent.renderer.adoptObjectRenderer(this.imageModule);const i=this.parent.transformer.getRelativeRect(),o={overrides:{objects:[s],position:{x:Math.round(i.x),y:Math.round(i.y)}},isSelected:!0};switch(n){case"raster_layer":this.manager.stateApi.addRasterLayer(o);break;case"control_layer":this.manager.stateApi.addControlLayer(o);break;case"inpaint_mask":this.manager.stateApi.addInpaintMask(o);break;case"regional_guidance":this.manager.stateApi.addRegionalGuidance(o);break;default:Re(!1)}});k(this,"reset",()=>{this.log.trace("Resetting"),this.resetEphemeralState()});k(this,"cancel",()=>{this.log.trace("Canceling"),this.teardown()});k(this,"teardown",()=>{this.unsubscribe(),this.konva.group.remove(),this.resetEphemeralState(),this.$isSegmenting.set(!1),this.manager.stateApi.$segmentingAdapter.set(null)});k(this,"resetEphemeralState",()=>{var n;(n=this.abortController)==null||n.abort(),this.abortController=null;for(const s of this.$points.get())s.konva.circle.destroy();this.imageModule&&this.imageModule.konva.group.parent===this.konva.group&&(this.imageModule.destroy(),this.imageModule=null),this.konva.maskTween&&(this.konva.maskTween.destroy(),this.konva.maskTween=null),this.$points.set([]),this.$imageState.set(null),this.$pointType.set(1),this.$invert.set(!1),this.$lastProcessedHash.set(""),this.$isProcessing.set(!1),this.konva.compositingRect.visible(!1),this.konva.maskGroup.clearCache()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,points:this.$points.get().map(({id:s,konva:i,label:o})=>({id:s,label:o,circle:rs(i.circle)})),imageState:ft(this.$imageState.get()),imageModule:((n=this.imageModule)==null?void 0:n.repr())??null,config:ft(this.config),$isSegmenting:this.$isSegmenting.get(),$lastProcessedHash:this.$lastProcessedHash.get(),$isProcessing:this.$isProcessing.get(),$pointType:this.$pointType.get(),$pointTypeString:this.$pointTypeString.get(),$isDraggingPoint:this.$isDraggingPoint.get(),konva:{group:rs(this.konva.group),compositingRect:rs(this.konva.compositingRect),maskGroup:rs(this.konva.maskGroup),pointGroup:rs(this.konva.pointGroup)}}});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.abortController&&!this.abortController.signal.aborted&&this.abortController.abort(),this.abortController=null,this.unsubscribe(),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:this.KONVA_GROUP_NAME}),pointGroup:new Ne.Group({name:this.KONVA_POINT_GROUP_NAME}),maskGroup:new Ne.Group({name:this.KONVA_MASK_GROUP_NAME,opacity:.6}),compositingRect:new Ne.Rect({name:this.KONVA_COMPOSITING_RECT_NAME,fill:Oo(this.config.MASK_COLOR),globalCompositeOperation:"source-atop",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1,visible:!1}),maskTween:null},this.konva.group.add(this.konva.maskGroup),this.konva.group.add(this.konva.pointGroup),this.konva.maskGroup.add(this.konva.compositingRect)}createPoint(n,s){const i=_e("sam_point"),o=Fk(n),a=new Ne.Circle({name:this.KONVA_CIRCLE_NAME,x:o.x,y:o.y,radius:this.manager.stage.unscale(this.config.SAM_POINT_RADIUS),fill:Oo(this.getSAMPointColor(s)),stroke:Oo(this.config.SAM_POINT_BORDER_COLOR),strokeWidth:this.manager.stage.unscale(this.config.SAM_POINT_BORDER_WIDTH),draggable:!0,perfectDrawEnabled:!0,opacity:.6,dragDistance:3});return a.on("pointerup",l=>{if(this.$isDraggingPoint.get()||l.evt.button!==0)return;l.cancelBubble=!0,a.destroy();const c=this.$points.get().filter(d=>d.id!==i);c.length===0?this.resetEphemeralState():this.$points.set(c)}),a.on("dragstart",()=>{this.$isDraggingPoint.set(!0)}),a.on("dragend",()=>{const l=Fk(a.position());this.log.trace({...l,label:$y[s]},"Moved SAM point"),this.$isDraggingPoint.set(!1);const c=this.$points.get().map(d=>d.id===i?{...d,coord:l}:d);this.$points.set(c)}),this.konva.pointGroup.add(a),this.log.trace({...o,label:$y[s]},"Created SAM point"),{id:i,coord:o,label:s,konva:{circle:a}}}getSAMPointColor(n){return n===0?this.config.SAM_POINT_NEUTRAL_COLOR:n===1?this.config.SAM_POINT_FOREGROUND_COLOR:this.config.SAM_POINT_BACKGROUND_COLOR}};k(R0,"buildGraph",({image_name:n},s,i)=>{const o=new ts(_e("canvas_segment_anything")),a=o.addNode({id:_e("segment_anything"),type:"segment_anything",model:"segment-anything-huge",image:{image_name:n},point_lists:[{points:s.map(({x:c,y:d,label:h})=>({x:c,y:d,label:h}))}],mask_filter:"largest"}),l=o.addNode({id:_e("apply_tensor_mask_to_image"),type:"apply_tensor_mask_to_image",image:{image_name:n},invert:i});return o.addEdge(a,"mask",l,"mask"),{graph:o,outputNodeId:l.id}});let S0=R0;class l1e extends _l{constructor(n,s){super(n,s,"control_layer_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.withTransparencyEffect!==s.withTransparencyEffect)&&this.renderer.updateTransparencyEffect())});k(this,"syncTransparencyEffect",()=>{this.renderer.updateTransparencyEffect()});k(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});k(this,"getHashableState",()=>{const n=["name","controlAdapter","withTransparencyEffect","isLocked"];return wl(this.state,n)});this.renderer=new oy(this),this.bufferRenderer=new iy(this),this.transformer=new ay(this),this.filterer=new LO(this),this.segmentAnything=new S0(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class c1e extends _l{constructor(n,s){super(n,s,"inpaint_mask_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!s),s||(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});k(this,"getHashableState",()=>{const n=["fill","name","opacity","isLocked"];return wl(this.state,n)});k(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new oy(this),this.bufferRenderer=new iy(this),this.transformer=new ay(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class u1e extends _l{constructor(n,s){super(n,s,"raster_layer_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity())});k(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});k(this,"getHashableState",()=>{const n=["name","isLocked"];return wl(this.state,n)});this.renderer=new oy(this),this.bufferRenderer=new iy(this),this.transformer=new ay(this),this.filterer=new LO(this),this.segmentAnything=new S0(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class d1e extends _l{constructor(n,s){super(n,s,"regional_guidance_adapter");k(this,"renderer");k(this,"bufferRenderer");k(this,"transformer");k(this,"filterer");k(this,"segmentAnything");k(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!s),s||(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});k(this,"getHashableState",()=>{const n=["fill","name","opacity","isLocked","autoNegative","positivePrompt","negativePrompt","referenceImages"];return wl(this.state,n)});k(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new oy(this),this.bufferRenderer=new iy(this),this.transformer=new ay(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class h1e extends $t{constructor(n){super();k(this,"type","entity_renderer");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"subscriptions",new Set);k(this,"initialize",()=>{this.log.debug("Initializing module"),this.createNewRasterLayers(this.manager.stateApi.runSelector(Bk)),this.createNewControlLayers(this.manager.stateApi.runSelector($k)),this.createNewRegionalGuidance(this.manager.stateApi.runSelector(Gk)),this.createNewInpaintMasks(this.manager.stateApi.runSelector(Vk)),this.arrangeEntities(this.manager.stateApi.runSelector(Je),null)});k(this,"createNewRasterLayers",n=>{for(const s of n)this.manager.adapters.rasterLayers.has(s.id)||this.manager.createAdapter(qs(s)).initialize()});k(this,"createNewControlLayers",n=>{for(const s of n)this.manager.adapters.controlLayers.has(s.id)||this.manager.createAdapter(qs(s)).initialize()});k(this,"createNewRegionalGuidance",n=>{for(const s of n)this.manager.adapters.regionMasks.has(s.id)||this.manager.createAdapter(qs(s)).initialize()});k(this,"createNewInpaintMasks",n=>{for(const s of n)this.manager.adapters.inpaintMasks.has(s.id)||this.manager.createAdapter(qs(s)).initialize()});k(this,"arrangeEntities",(n,s)=>{var i,o,a,l,c,d;if(!s||n.rasterLayers.entities!==s.rasterLayers.entities||n.controlLayers.entities!==s.controlLayers.entities||n.regionalGuidance.entities!==s.regionalGuidance.entities||n.inpaintMasks.entities!==s.inpaintMasks.entities||((i=n.selectedEntityIdentifier)==null?void 0:i.id)!==((o=s.selectedEntityIdentifier)==null?void 0:o.id)){this.log.trace("Arranging entities");let h=0;this.manager.background.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getRasterLayersState().entities)(a=this.manager.adapters.rasterLayers.get(f))==null||a.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getControlLayersState().entities)(l=this.manager.adapters.controlLayers.get(f))==null||l.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getRegionsState().entities)(c=this.manager.adapters.regionMasks.get(f))==null||c.konva.layer.zIndex(h++);for(const{id:f}of this.manager.stateApi.getInpaintMasksState().entities)(d=this.manager.adapters.inpaintMasks.get(f))==null||d.konva.layer.zIndex(h++);this.manager.konva.previewLayer.zIndex(h++)}});k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});this.id=_e("canvas_renderer"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Bk,this.createNewRasterLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription($k,this.createNewControlLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Vk,this.createNewInpaintMasks)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Gk,this.createNewRegionalGuidance)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Je,this.arrangeEntities))}}const f1e=e=>!!e.image;class p1e extends $t{constructor(n){super();k(this,"type","progress_image");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"konva");k(this,"$isLoading",Oe(!1));k(this,"$isError",Oe(!1));k(this,"imageElement",null);k(this,"subscriptions",new Set);k(this,"$lastProgressEvent",Oe(null));k(this,"$hasActiveGeneration",Oe(!1));k(this,"mutex",new Xw);k(this,"setSocketEventListeners",()=>{const n=o=>{o.destination==="canvas"&&f1e(o)&&this.$hasActiveGeneration.get()&&this.$lastProgressEvent.set(o)},s=o=>{o.destination==="canvas"&&(o.status==="failed"||o.status==="canceled")&&(this.$lastProgressEvent.set(null),this.$hasActiveGeneration.set(!1))},i=()=>{this.$lastProgressEvent.set(null)};return this.manager.socket.on("invocation_progress",n),this.manager.socket.on("queue_item_status_changed",s),this.manager.socket.on("connect",i),this.manager.socket.on("connect_error",i),this.manager.socket.on("disconnect",i),()=>{this.manager.socket.off("invocation_progress",n),this.manager.socket.off("queue_item_status_changed",s),this.manager.socket.off("connect",i),this.manager.socket.off("connect_error",i),this.manager.socket.off("disconnect",i)}});k(this,"getNodes",()=>[this.konva.group]);k(this,"render",async()=>{var d;const n=await this.mutex.acquire(),s=this.$lastProgressEvent.get(),i=this.manager.stateApi.runSelector(Kb);if(!s||!i){this.konva.group.visible(!1),(d=this.konva.image)==null||d.destroy(),this.konva.image=null,this.imageElement=null,this.$isLoading.set(!1),this.$isError.set(!1),n();return}this.$isLoading.set(!0);const{x:o,y:a,width:l,height:c}=this.manager.stateApi.getBbox().rect;try{this.imageElement=await _M(s.image.dataURL),this.konva.image?this.konva.image.setAttrs({image:this.imageElement,x:o,y:a,width:l,height:c}):(this.konva.image=new Ne.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,x:o,y:a,width:l,height:c,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.group.visible(this.manager.stagingArea.$shouldShowStagedImage.get())}catch{this.$isError.set(!0)}finally{this.$isLoading.set(!1),n()}});k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$lastProgressEvent:Em(this.$lastProgressEvent.get()),$hasActiveGeneration:this.$hasActiveGeneration.get(),$isError:this.$isError.get(),$isLoading:this.$isLoading.get()}));this.id=_e(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating progress image module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1}),image:null},this.subscriptions.add(this.manager.stagingArea.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Kb,this.render)),this.subscriptions.add(this.setSocketEventListeners()),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Xq,({data:s})=>{s&&(s.in_progress>0||s.pending>0)?this.$hasActiveGeneration.set(!0):this.$hasActiveGeneration.set(!1)})),this.subscriptions.add(this.$lastProgressEvent.listen(this.render))}}const g1e={MIN_SCALE:.1,MAX_SCALE:20,SCALE_FACTOR:.999};class m1e extends $t{constructor(n,s){super();k(this,"type","stage");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"container");k(this,"konva");k(this,"config",g1e);k(this,"$stageAttrs",Oe({x:0,y:0,width:0,height:0,scale:0}));k(this,"subscriptions",new Set);k(this,"resizeObserver",null);k(this,"setContainer",n=>{this.container=n,this.konva.stage.container(n),this.setResizeObserver()});k(this,"setResizeObserver",()=>{this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.fitStageToContainer),this.resizeObserver.observe(this.container)});k(this,"initialize",()=>{this.log.debug("Initializing module"),this.container.style.touchAction="none",this.container.style.userSelect="none",this.container.style.webkitUserSelect="none",this.konva.stage.container(this.container),this.setResizeObserver(),this.fitStageToContainer(),this.konva.stage.on("wheel",this.onStageMouseWheel),this.konva.stage.on("dragmove",this.onStageDragMove),this.konva.stage.on("dragend",this.onStageDragEnd),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.subscriptions.add(()=>this.konva.stage.off("wheel",this.onStageMouseWheel)),this.subscriptions.add(()=>this.konva.stage.off("dragmove",this.onStageDragMove)),this.subscriptions.add(()=>this.konva.stage.off("dragend",this.onStageDragEnd)),this.subscriptions.add(this.manager.tool.$tool.listen(this.stopDragging))});k(this,"fitStageToContainer",()=>{this.log.trace("Fitting stage to container");const n=this.konva.stage.container().offsetWidth,s=this.konva.stage.container().offsetHeight;if(n===0||s===0)return;const i=this.konva.stage.width()===0||this.konva.stage.height()===0;this.konva.stage.width(n),this.konva.stage.height(s),this.syncStageAttrs(),i&&this.fitLayersToStage()});k(this,"fitBboxToStage",()=>{const{rect:n}=this.manager.stateApi.getBbox();this.log.trace({rect:n},"Fitting bbox to stage"),this.fitRect(n)});k(this,"fitLayersToStage",()=>{const n=this.manager.compositor.getVisibleRectOfType();n.width===0||n.height===0?this.fitBboxToStage():(this.log.trace({rect:n},"Fitting layers to stage"),this.fitRect(n))});k(this,"fitRect",n=>{const{width:s,height:i}=this.getSize();if(s===0||i===0)return;const o=20,a=s-o*2,l=i-o*2,c=this.constrainScale(Math.min(Math.min(a/n.width,l/n.height),1)),d=Math.floor(-n.x*c+o+(a-n.width*c)/2),h=Math.floor(-n.y*c+o+(l-n.height*c)/2);this.konva.stage.setAttrs({x:d,y:h,scaleX:c,scaleY:c}),this.syncStageAttrs({x:d,y:h,scale:c})});k(this,"getCenter",(n=!1)=>{const s=this.getScale(),{x:i,y:o}=this.getPosition(),{width:a,height:l}=this.getSize(),c={x:(a/2-i)/s,y:(l/2-o)/s};return n?this.konva.stage.getAbsoluteTransform().point(c):c});k(this,"constrainScale",n=>to(Math.round(n*100)/100,this.config.MIN_SCALE,this.config.MAX_SCALE));k(this,"setScale",(n,s=this.getCenter(!0))=>{this.log.trace("Setting scale");const i=this.constrainScale(n),{x:o,y:a}=this.getPosition(),l=this.getScale(),c=(s.x-o)/l,d=(s.y-a)/l,h=Math.floor(s.x-c*i),f=Math.floor(s.y-d*i);this.konva.stage.setAttrs({x:h,y:f,scaleX:i,scaleY:i}),this.syncStageAttrs()});k(this,"onStageMouseWheel",n=>{if(n.evt.preventDefault(),n.evt.ctrlKey||n.evt.metaKey)return;const s=this.konva.stage.getPointerPosition();if(s){const i=n.evt.ctrlKey?-n.evt.deltaY:n.evt.deltaY,o=this.manager.stage.getScale()*this.config.SCALE_FACTOR**i;this.manager.stage.setScale(o,s)}});k(this,"onStagePointerDown",n=>{n.evt.button===1&&this.startDragging()});k(this,"startDragging",()=>{this.setIsDraggable(!0),this.getIsDragging()||this.konva.stage.startDrag(),this.manager.tool.render()});k(this,"stopDragging",()=>{this.setIsDraggable(this.manager.tool.$tool.get()==="view"),this.getIsDragging()&&this.konva.stage.stopDrag(),this.manager.tool.render()});k(this,"onStageDragMove",n=>{n.target===this.konva.stage&&this.syncStageAttrs()});k(this,"onStageDragEnd",n=>{n.target===this.konva.stage&&this.stopDragging()});k(this,"getScale",()=>this.konva.stage.scaleX());k(this,"getPosition",()=>this.konva.stage.position());k(this,"unscale",n=>n/this.getScale());k(this,"setCursor",n=>{this.container.style.cursor!==n&&(this.container.style.cursor=n)});k(this,"syncStageAttrs",n=>{this.$stageAttrs.set({x:this.konva.stage.x(),y:this.konva.stage.y(),width:this.konva.stage.width(),height:this.konva.stage.height(),scale:this.konva.stage.scaleX(),...n})});k(this,"setIsDraggable",n=>{this.konva.stage.draggable(n)});k(this,"getIsDragging",()=>this.konva.stage.isDragging());k(this,"addLayer",n=>{this.konva.stage.add(n)});k(this,"getScaledStageRect",(n=!0)=>{const{x:s,y:i}=this.getPosition(),{width:o,height:a}=this.getSize(),l=this.getScale();return{x:n?Math.floor(-s/l):-s/l,y:n?Math.floor(-i/l):-i/l,width:n?Math.ceil(o/l):o/l,height:n?Math.ceil(a/l):a/l}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$stageAttrs:this.$stageAttrs.get(),konva:{stage:rs(this.konva.stage)}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.resizeObserver&&this.resizeObserver.disconnect(),this.konva.stage.destroy()});this.id=_e("stage"),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.container=n,this.konva={stage:new Ne.Stage({id:_e("konva_stage"),container:n})}}getSize(){return this.konva.stage.size()}}class y1e extends $t{constructor(n){super();k(this,"type","staging_area");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"konva");k(this,"image");k(this,"selectedImage");k(this,"$shouldShowStagedImage",Oe(!0));k(this,"$isStaging",Oe(!1));k(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.$isStaging.set(this.manager.stateApi.runSelector(Dn))});k(this,"render",async()=>{var a,l;this.log.trace("Rendering staging area");const n=this.manager.stateApi.runSelector(Zb),{x:s,y:i}=this.manager.stateApi.getBbox().rect,o=this.$shouldShowStagedImage.get();if(this.selectedImage=n.stagedImages[n.selectedStagedImageIndex]??null,this.konva.group.position({x:s,y:i}),this.selectedImage){const{imageDTO:c}=this.selectedImage,d=Sl(c),h=(a=this.manager.progressImage.$lastProgressEvent.get())==null?void 0:a.session_id,f=()=>{var g;const p=(g=this.manager.progressImage.$lastProgressEvent.get())==null?void 0:g.session_id;h===p&&this.manager.progressImage.$lastProgressEvent.set(null)};this.image?this.image.isLoading||(this.image.state.image.image_name!==d.image_name?(await this.image.update({...this.image.state,image:d},!0),f()):this.image.isError&&f()):(this.image=new ma({id:"staging-area-image",type:"image",image:d},this),await this.image.update(this.image.state,!0),this.konva.group.add(this.image.konva.group),f()),this.image.konva.group.visible(o)}else(l=this.image)==null||l.destroy(),this.image=null});k(this,"getNodes",()=>[this.konva.group]);k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.image&&this.image.destroy();for(const n of this.getNodes())n.destroy()});k(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,selectedImage:this.selectedImage,$shouldShowStagedImage:this.$shouldShowStagedImage.get(),$isStaging:this.$isStaging.get(),image:((n=this.image)==null?void 0:n.repr())??null}});this.id=_e(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1})},this.image=null,this.selectedImage=null,this.subscriptions.add(this.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Zb,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Dn,(s,i)=>{this.$isStaging.set(s),s&&!i&&this.$shouldShowStagedImage.set(!0)}))}}const v1e=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],b1e=["top-left","top-right","bottom-left","bottom-right"],x1e=[];class C1e extends $t{constructor(n){super();k(this,"type","bbox");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"konva");k(this,"$aspectRatioBuffer",Oe(1));k(this,"syncCursorStyle",AM);k(this,"initialize",()=>{this.log.debug("Initializing module");const{width:n,height:s}=this.manager.stateApi.runSelector(Ec).rect;this.$aspectRatioBuffer.set(n/s),this.render()});k(this,"render",()=>{const n=this.manager.tool.$tool.get(),{x:s,y:i,width:o,height:a}=this.manager.stateApi.runSelector(Ec).rect;this.konva.group.listening(n==="bbox"&&!this.manager.$isBusy.get()),this.konva.proxyRect.setAttrs({x:s,y:i,width:o,height:a,scaleX:1,scaleY:1,listening:n==="bbox"}),this.syncOverlay(),this.konva.transformer.setAttrs({listening:n==="bbox",enabledAnchors:n==="bbox"?v1e:x1e})});k(this,"syncOverlay",()=>{const n=this.manager.stateApi.getSettings().bboxOverlay;if(this.konva.overlayGroup.visible(n),!n)return;const s=this.manager.stage.$stageAttrs.get();this.konva.overlayRect.setAttrs({x:-s.x/s.scale,y:-s.y/s.scale,width:s.width/s.scale,height:s.height/s.scale})});k(this,"onDragMove",()=>{const n=this.manager.stateApi.getGridSize(),s=this.manager.stateApi.getBbox(),i={...s.rect,x:Br(this.konva.proxyRect.x(),n),y:Br(this.konva.proxyRect.y(),n)};this.konva.proxyRect.setAttrs(i),(s.rect.x!==i.x||s.rect.y!==i.y)&&this.manager.stateApi.setGenerationBbox(i)});k(this,"onTransform",()=>{const n=this.konva.transformer.getActiveAnchor();if(!n)return;const s=this.manager.stateApi.$altKey.get(),i=this.manager.stateApi.$ctrlKey.get(),o=this.manager.stateApi.$metaKey.get(),a=this.manager.stateApi.$shiftKey.get();let l=i||o?this.manager.stateApi.getBboxGridSize():64;this.manager.stateApi.$altKey.get()&&(l=l*2);let c=this.konva.proxyRect.x(),d=this.konva.proxyRect.y(),h=ig(this.konva.proxyRect.width()*this.konva.proxyRect.scaleX(),l),f=ig(this.konva.proxyRect.height()*this.konva.proxyRect.scaleY(),l);if(a&&b1e.includes(n)&&!s){let g=Math.sqrt(h*f*this.$aspectRatioBuffer.get()),m=g/this.$aspectRatioBuffer.get();g=ig(g,l),m=ig(m,l),n==="top-left"&&(c=c-(g-h),d=d-(m-f)),n==="top-right"&&(d=d-(m-f)),n==="bottom-left"&&(c=c-(g-h)),h=g,f=m}const p={x:Math.round(c),y:Math.round(d),width:h,height:f};this.konva.proxyRect.setAttrs({...p,scaleX:1,scaleY:1}),this.manager.stateApi.setGenerationBbox(p),a||this.$aspectRatioBuffer.set(p.width/p.height)});k(this,"onTransformEnd",()=>{this.$aspectRatioBuffer.set(this.konva.proxyRect.width()/this.konva.proxyRect.height())});k(this,"anchorStyleFunc",n=>{(n.hasName("top-center")||n.hasName("bottom-center"))&&(n.height(8),n.offsetY(4),n.width(30),n.offsetX(15)),(n.hasName("middle-left")||n.hasName("middle-right"))&&(n.height(30),n.offsetY(15),n.width(8),n.offsetX(4))});k(this,"fitToLayers",()=>{const n=this.manager.compositor.getVisibleRectOfType();if(n.height===0||n.width===0)return;const s=this.manager.stateApi.getBboxGridSize(),i=Qq(n,s);this.manager.stateApi.setGenerationBbox(i)});k(this,"anchorDragBoundFunc",(n,s)=>{const i=this.konva.transformer.getStage();Re(i,"Stage must exist");const a=(this.manager.stateApi.$ctrlKey.get()||this.manager.stateApi.$metaKey.get()?this.manager.stateApi.getBboxGridSize():64)*i.scaleX(),l=i.getAbsolutePosition(),c=l.x%a,d=l.y%a;return{x:Br(s.x,a)+c,y:Br(s.y,a)+d}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,aspectRatioBuffer:this.$aspectRatioBuffer.get(),konva:{group:rs(this.konva.group),proxyRect:rs(this.konva.proxyRect),transformer:rs(this.konva.transformer)}}));k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating bbox module"),this.konva={group:new Ne.Group({name:`${this.type}:group`,listening:!1}),proxyRect:new Ne.Rect({name:`${this.type}:rect`,listening:!1,strokeEnabled:!0,draggable:!0,stroke:"rgb(42,42,42)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1}),overlayGroup:new Ne.Group({name:`${this.type}:overlayGroup`,listening:!1,clipFunc:s=>{const i=this.manager.stage.getScaledStageRect(),o=this.manager.stateApi.runSelector(Ec).rect;s.beginPath(),s.moveTo(i.x,i.y),s.lineTo(i.x+i.width,i.y),s.lineTo(i.x+i.width,i.y+i.height),s.lineTo(i.x,i.y+i.height),s.closePath(),s.moveTo(o.x,o.y),s.lineTo(o.x,o.y+o.height),s.lineTo(o.x+o.width,o.y+o.height),s.lineTo(o.x+o.width,o.y),s.closePath()}}),overlayRect:new Ne.Rect({name:`${this.type}:overlay`,listening:!1,strokeEnabled:!1,draggable:!1,fill:"hsl(220 12% 10% / 0.8)",perfectDrawEnabled:!1}),transformer:new Ne.Transformer({listening:!1,name:`${this.type}:transformer`,borderDash:[5,5],borderStroke:"rgba(212,216,234,1)",borderEnabled:!0,borderStrokeWidth:1,rotateEnabled:!1,keepRatio:!1,ignoreStroke:!0,flipEnabled:!1,anchorFill:"rgba(212,216,234,1)",anchorStroke:"rgb(42,42,42)",anchorSize:12,anchorCornerRadius:3,shiftBehavior:"none",centeredScaling:!1,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc})},this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("pointerenter",()=>{this.manager.stage.setCursor("move")}),this.konva.proxyRect.on("pointerleave",()=>{this.manager.stage.setCursor("default")}),this.konva.transformer.on("transform",this.onTransform),this.konva.transformer.on("transformend",this.onTransformEnd),this.subscriptions.add(()=>{this.konva.proxyRect.off("dragmove pointerenter pointerleave"),this.konva.transformer.off("transform transformend")}),this.konva.transformer.nodes([this.konva.proxyRect]),this.konva.overlayGroup.add(this.konva.overlayRect),this.konva.group.add(this.konva.overlayGroup),this.konva.group.add(this.konva.proxyRect),this.konva.group.add(this.konva.transformer),this.subscriptions.add(this.parent.$tool.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ec,this.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncOverlay)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(IM,this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render))}}const S1e={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",HIDE_FILL_TIMEOUT_MS:1500};class w1e extends $t{constructor(n){super();k(this,"type","brush_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",S1e);k(this,"hideFillTimeoutId",null);k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="brush"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}const s=this.parent.$isPrimaryPointerDown.get(),i=this.parent.$lastPointerType.get();if(i!=="mouse"&&s){this.setVisibility(!1);return}this.setVisibility(!0),this.hideFillTimeoutId!==null&&(window.clearTimeout(this.hideFillTimeoutId),this.hideFillTimeoutId=null);const o=this.manager.stateApi.getSettings(),a=this.manager.stateApi.getBrushPreviewColor(),l=_o(n.relative,o.brushWidth),c=o.brushWidth/2;this.konva.fillCircle.setAttrs({x:l.x,y:l.y,radius:c,fill:Oo(a),visible:!s&&i==="mouse"});const d=this.manager.stage.unscale(1),h=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:c,outerRadius:c+d}),this.konva.outerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:c+d,outerRadius:c+h}),this.hideFillTimeoutId=window.setTimeout(()=>{this.konva.fillCircle.visible(!1),this.hideFillTimeoutId=null},this.config.HIDE_FILL_TIMEOUT_MS)});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerEnter",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=this.manager.stateApi.getSettings(),l=Wi(s.relative,o.state.position),c=_o(l,a.brushWidth);n.evt.pointerType==="pen"&&a.pressureSensitivity?await o.bufferRenderer.setBuffer({id:_e("brush_line_with_pressure"),type:"brush_line_with_pressure",points:[c.x,c.y,n.evt.pressure],strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(o.state)}):await o.bufferRenderer.setBuffer({id:_e("brush_line"),type:"brush_line",points:[c.x,c.y],strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(o.state)})});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!i)return;o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();const a=this.manager.stateApi.getSettings(),l=Wi(s.relative,o.state.position),c=_o(l,a.brushWidth);if(n.evt.pointerType==="pen"&&a.pressureSensitivity){const d=TM(o.state.objects,"brush_line_with_pressure");let h;n.evt.shiftKey&&d?h=[d.x,d.y,d.pressure,c.x,c.y,n.evt.pressure]:h=[c.x,c.y,n.evt.pressure],await o.bufferRenderer.setBuffer({id:_e("brush_line_with_pressure"),type:"brush_line_with_pressure",points:h,strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(o.state)})}else{const d=MM(o.state.objects,"brush_line");let h;n.evt.shiftKey&&d?h=[d.x,d.y,c.x,c.y]:h=[c.x,c.y],await o.bufferRenderer.setBuffer({id:_e("brush_line"),type:"brush_line",points:h,strokeWidth:a.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.parent.getClip(o.state)})}});k(this,"onStagePointerUp",n=>{var i,o;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&((((i=s.bufferRenderer.state)==null?void 0:i.type)==="brush_line"||((o=s.bufferRenderer.state)==null?void 0:o.type)==="brush_line_with_pressure")&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="brush_line"&&o.type!=="brush_line_with_pressure")return;const a=this.manager.stateApi.getSettings(),l=PM(o.points),c=a.brushWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!l||!EM(s.relative,l,c))return;const d=Wi(s.relative,i.state.position),h=_o(d,a.brushWidth);l.x===h.x&&l.y===h.y||(o.points.push(h.x,h.y),o.type==="brush_line_with_pressure"&&a.pressureSensitivity&&o.points.push(n.evt.pressure),await i.bufferRenderer.setBuffer(o))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:brush_group`,listening:!1}),fillCircle:new Ne.Circle({name:`${this.type}:brush_fill_circle`,listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1}),innerBorder:new Ne.Ring({name:`${this.type}:brush_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Ne.Ring({name:`${this.type}:brush_outer_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.fillCircle,this.konva.innerBorder,this.konva.outerBorder)}}const j1e={RING_INNER_RADIUS:25,RING_OUTER_RADIUS:35,RING_BORDER_INNER_COLOR:"rgba(0,0,0,1)",RING_BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",CROSSHAIR_INNER_RADIUS:5,CROSSHAIR_LINE_THICKNESS:1.5,CROSSHAIR_LINE_BORDER_THICKNESS:.75,CROSSHAIR_LINE_LENGTH:10,CROSSHAIR_LINE_COLOR:"rgba(0,0,0,1)",CROSSHAIR_BORDER_COLOR:"rgba(255,255,255,0.8)"};class k1e extends $t{constructor(n){super();k(this,"type","color_picker_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",j1e);k(this,"$colorUnderCursor",Oe(LM));k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="colorPicker"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}this.setVisibility(!0);const{x:s,y:i}=n.relative,o=this.manager.stateApi.getSettings(),a=this.$colorUnderCursor.get(),l=this.manager.stage.unscale(this.config.RING_INNER_RADIUS),c=this.manager.stage.unscale(this.config.RING_OUTER_RADIUS),d=this.manager.stage.unscale(1),h=this.manager.stage.unscale(2);this.konva.ringCandidateColor.setAttrs({x:s,y:i,fill:Tl(a),innerRadius:l,outerRadius:c}),this.konva.ringCurrentColor.setAttrs({x:s,y:i,fill:Tl(o.color),innerRadius:l,outerRadius:c}),this.konva.ringInnerBorder.setAttrs({x:s,y:i,innerRadius:c,outerRadius:c+d}),this.konva.ringOuterBorder.setAttrs({x:s,y:i,innerRadius:c+d,outerRadius:c+h});const f=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_LENGTH),p=this.manager.stage.unscale(this.config.CROSSHAIR_INNER_RADIUS),g=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS),m=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS+this.config.CROSSHAIR_LINE_BORDER_THICKNESS*2);this.konva.crosshairNorthOuter.setAttrs({strokeWidth:m,points:[s,i-f,s,i-p]}),this.konva.crosshairNorthInner.setAttrs({strokeWidth:g,points:[s,i-f,s,i-p]}),this.konva.crosshairEastOuter.setAttrs({strokeWidth:m,points:[s+p,i,s+f,i]}),this.konva.crosshairEastInner.setAttrs({strokeWidth:g,points:[s+p,i,s+f,i]}),this.konva.crosshairSouthOuter.setAttrs({strokeWidth:m,points:[s,i+p,s,i+f]}),this.konva.crosshairSouthInner.setAttrs({strokeWidth:g,points:[s,i+p,s,i+f]}),this.konva.crosshairWestOuter.setAttrs({strokeWidth:m,points:[s-p,i,s-f,i]}),this.konva.crosshairWestInner.setAttrs({strokeWidth:g,points:[s-p,i,s-f,i]})});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerUp",n=>{const s=this.$colorUnderCursor.get();if(s){const i=this.manager.stateApi.getSettings();this.manager.stateApi.setColor({...i.color,...s})}});k(this,"onStagePointerMove",n=>{this.syncColorUnderCursor()});k(this,"syncColorUnderCursor",hE(()=>{const n=this.parent.$cursorPos.get();if(!n)return;const s=Jq(this.manager.stage.konva.stage,n.absolute);s&&this.$colorUnderCursor.set(s)}));k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$colorUnderCursor:this.$colorUnderCursor.get()}));k(this,"destroy",()=>{this.log.debug("Destroying color picker tool preview module"),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:color_picker_group`,listening:!1}),ringCandidateColor:new Ne.Ring({listening:!1,name:`${this.type}:color_picker_candidate_color_ring`,innerRadius:0,outerRadius:0,strokeEnabled:!1,perfectDrawEnabled:!1}),ringCurrentColor:new Ne.Arc({listening:!1,name:`${this.type}:color_picker_current_color_arc`,innerRadius:0,outerRadius:0,angle:180,strokeEnabled:!1,perfectDrawEnabled:!1}),ringInnerBorder:new Ne.Ring({listening:!1,name:`${this.type}:color_picker_inner_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),ringOuterBorder:new Ne.Ring({listening:!1,name:`${this.type}:color_picker_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),crosshairNorthInner:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairNorthOuter:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_north2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairEastInner:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairEastOuter:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_east2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairSouthInner:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairSouthOuter:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_south2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairWestInner:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairWestOuter:new Ne.Line({listening:!1,name:`${this.type}:color_picker_crosshair_west2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.ringCandidateColor,this.konva.ringCurrentColor,this.konva.ringInnerBorder,this.konva.ringOuterBorder,this.konva.crosshairNorthOuter,this.konva.crosshairNorthInner,this.konva.crosshairEastOuter,this.konva.crosshairEastInner,this.konva.crosshairSouthOuter,this.konva.crosshairSouthInner,this.konva.crosshairWestOuter,this.konva.crosshairWestInner)}}const _1e={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)"};class I1e extends $t{constructor(n){super();k(this,"type","eraser_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",_1e);k(this,"konva");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("none")});k(this,"render",()=>{if(this.parent.$tool.get()!=="eraser"){this.setVisibility(!1);return}if(!this.parent.getCanDraw()){this.setVisibility(!1);return}const n=this.parent.$cursorPos.get();if(!n){this.setVisibility(!1);return}const s=this.parent.$isPrimaryPointerDown.get();if(this.parent.$lastPointerType.get()!=="mouse"&&s){this.setVisibility(!1);return}this.setVisibility(!0);const o=this.manager.stateApi.getSettings(),a=_o(n.relative,o.eraserWidth),l=o.eraserWidth/2;this.konva.cutoutCircle.setAttrs({x:a.x,y:a.y,radius:l});const c=this.manager.stage.unscale(1),d=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:l,outerRadius:l+c}),this.konva.outerBorder.setAttrs({x:n.relative.x,y:n.relative.y,innerRadius:l+c,outerRadius:l+d})});k(this,"setVisibility",n=>{this.konva.group.visible(n)});k(this,"onStagePointerEnter",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=this.manager.stateApi.getSettings(),l=Wi(s.relative,o.state.position),c=_o(l,a.brushWidth);n.evt.pointerType==="pen"&&a.pressureSensitivity?await o.bufferRenderer.setBuffer({id:_e("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:[c.x,c.y,n.evt.pressure],strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)}):await o.bufferRenderer.setBuffer({id:_e("eraser_line"),type:"eraser_line",points:[c.x,c.y],strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!o||!i)return;const a=this.manager.stateApi.getSettings(),l=Wi(s.relative,o.state.position);if(n.evt.pointerType==="pen"&&a.pressureSensitivity){const c=TM(o.state.objects,"eraser_line_with_pressure"),d=_o(l,a.eraserWidth);o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();let h;n.evt.shiftKey&&c?h=[c.x,c.y,c.pressure,d.x,d.y,n.evt.pressure]:h=[d.x,d.y,n.evt.pressure],await o.bufferRenderer.setBuffer({id:_e("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:h,strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})}else{const c=MM(o.state.objects,"eraser_line"),d=_o(l,a.eraserWidth);o.bufferRenderer.hasBuffer()&&o.bufferRenderer.commitBuffer();let h;n.evt.shiftKey&&c?h=[c.x,c.y,d.x,d.y]:h=[d.x,d.y],await o.bufferRenderer.setBuffer({id:_e("eraser_line"),type:"eraser_line",points:h,strokeWidth:a.eraserWidth,clip:this.parent.getClip(o.state)})}});k(this,"onStagePointerUp",n=>{var i,o;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&((((i=s.bufferRenderer.state)==null?void 0:i.type)==="eraser_line"||((o=s.bufferRenderer.state)==null?void 0:o.type)==="eraser_line_with_pressure")&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="eraser_line"&&o.type!=="eraser_line_with_pressure")return;const a=this.manager.stateApi.getSettings(),l=PM(o.points),c=a.eraserWidth*this.parent.config.BRUSH_SPACING_TARGET_SCALE;if(!l||!EM(s.relative,l,c))return;const d=Wi(s.relative,i.state.position),h=_o(d,a.eraserWidth);l.x===h.x&&l.y===h.y||(o.points.push(h.x,h.y),o.type==="eraser_line_with_pressure"&&a.pressureSensitivity&&o.points.push(n.evt.pressure),await i.bufferRenderer.setBuffer(o))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.debug("Destroying eraser tool preview module"),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Ne.Group({name:`${this.type}:eraser_group`,listening:!1}),cutoutCircle:new Ne.Circle({name:`${this.type}:eraser_cutout_circle`,listening:!1,strokeEnabled:!1,fill:"white",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1}),innerBorder:new Ne.Ring({name:`${this.type}:eraser_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Ne.Ring({listening:!1,name:`${this.type}:eraser_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.cutoutCircle,this.konva.innerBorder,this.konva.outerBorder)}}const A1e={NUDGE_PX:1};class T1e extends $t{constructor(n){super();k(this,"type","move_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"config",A1e);k(this,"nudgeOffsets");k(this,"syncCursorStyle",()=>{const n=this.manager.stateApi.getSelectedEntityAdapter();n?n.transformer.syncCursorStyle():this.manager.stage.setCursor("not-allowed")});k(this,"nudge",n=>{if(x1.get()!=="canvas")return;const s=this.manager.stateApi.getSelectedEntityAdapter();if(!s||s.$isDisabled.get()||s.$isEmpty.get()||s.$isLocked.get()||s.$isEntityTypeHidden.get())return;const i=this.manager.$isBusy.get(),o=this.parent.$tool.get()==="move",a=this.manager.stateApi.$transformingAdapter.get()===s;if(i){if(!a)return}else if(!o)return;const l=this.nudgeOffsets[n];s.transformer.nudgeBy(l)});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.nudgeOffsets={ArrowLeft:{x:-this.config.NUDGE_PX,y:0},ArrowRight:{x:this.config.NUDGE_PX,y:0},ArrowUp:{x:0,y:-this.config.NUDGE_PX},ArrowDown:{x:0,y:this.config.NUDGE_PX}}}isNudgeKey(n){return this.nudgeOffsets[n]!==void 0}}class M1e extends $t{constructor(n){super();k(this,"type","rect_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor("crosshair")});k(this,"onStagePointerDown",async n=>{const s=this.parent.$cursorPos.get(),i=this.parent.$isPrimaryPointerDown.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(!s||!i||!o)return;const a=Wi(s.relative,o.state.position);await o.bufferRenderer.setBuffer({id:_e("rect"),type:"rect",rect:{x:Math.round(a.x),y:Math.round(a.y),width:0,height:0},color:this.manager.stateApi.getCurrentColor()})});k(this,"onStagePointerUp",n=>{var i;const s=this.manager.stateApi.getSelectedEntityAdapter();s&&(((i=s.bufferRenderer.state)==null?void 0:i.type)==="rect"&&s.bufferRenderer.hasBuffer()?s.bufferRenderer.commitBuffer():s.bufferRenderer.clearBuffer())});k(this,"onStagePointerMove",async n=>{const s=this.parent.$cursorPos.get();if(!s||!this.parent.$isPrimaryPointerDown.get())return;const i=this.manager.stateApi.getSelectedEntityAdapter();if(!i)return;const o=i.bufferRenderer.state;if(!o||o.type!=="rect")return;const a=Wi(s.relative,i.state.position),l=eK(a);o.rect.width=Math.round(l.x-o.rect.x),o.rect.height=Math.round(l.y-o.rect.y),await i.bufferRenderer.setBuffer(o)});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}}class P1e extends $t{constructor(n){super();k(this,"type","view_tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"syncCursorStyle",()=>{this.manager.stage.setCursor(this.manager.stage.getIsDragging()?"grabbing":"grab")});this.id=_e(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module")}}Ne.dragButtons=[0];const E1e="Escape",E6=" ",L6="Alt",L1e={BRUSH_SPACING_TARGET_SCALE:.1};class D1e extends $t{constructor(n){super();k(this,"type","tool");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"config",L1e);k(this,"tools");k(this,"$tool",Oe("brush"));k(this,"$toolBuffer",Oe(null));k(this,"$isPrimaryPointerDown",Oe(!1));k(this,"$cursorPos",Oe(null));k(this,"$lastPointerType",Oe(null));k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.syncCursorStyle()});k(this,"syncCursorStyle",()=>{const n=this.manager.stage,s=this.$tool.get(),i=this.manager.stateApi.$segmentingAdapter.get(),o=this.manager.stateApi.$transformingAdapter.get(),a=this.manager.stateApi.getSelectedEntityAdapter();this.manager.stage.getIsDragging()?this.tools.view.syncCursorStyle():s==="view"?this.tools.view.syncCursorStyle():i?i.segmentAnything.syncCursorStyle():o?o.transformer.syncCursorStyle():this.manager.stateApi.$isFiltering.get()||this.manager.stagingArea.$isStaging.get()?n.setCursor("not-allowed"):s==="bbox"?this.tools.bbox.syncCursorStyle():this.manager.stateApi.getRenderedEntityCount()===0||a!=null&&a.$isDisabled.get()||a!=null&&a.$isEntityTypeHidden.get()||a!=null&&a.$isLocked.get()?n.setCursor("not-allowed"):s==="brush"?this.tools.brush.syncCursorStyle():s==="eraser"?this.tools.eraser.syncCursorStyle():s==="colorPicker"?this.tools.colorPicker.syncCursorStyle():s==="move"?this.tools.move.syncCursorStyle():s==="rect"?this.tools.rect.syncCursorStyle():n.setCursor("not-allowed")});k(this,"render",()=>{this.syncCursorStyle(),this.tools.brush.render(),this.tools.eraser.render(),this.tools.colorPicker.render(),this.tools.bbox.render()});k(this,"syncCursorPositions",()=>{const n=this.konva.stage.getRelativePointerPosition(),s=this.konva.stage.getPointerPosition();!n||!s||this.$cursorPos.set({relative:n,absolute:s})});k(this,"getClip",n=>{if(this.manager.stateApi.getSettings().clipToBbox){const{x:i,y:o,width:a,height:l}=this.manager.stateApi.getBbox().rect;return{x:i-n.position.x,y:o-n.position.y,width:a,height:l}}else{const{x:i,y:o}=this.manager.stage.getPosition(),a=this.manager.stage.getScale(),{width:l,height:c}=this.manager.stage.getSize();return{x:-i/a-n.position.x,y:-o/a-n.position.y,width:l/a,height:c/a}}});k(this,"setEventListeners",()=>(this.konva.stage.on("pointerenter",this.onStagePointerEnter),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.konva.stage.on("pointerup",this.onStagePointerUp),this.konva.stage.on("pointermove",this.onStagePointerMove),this.manager.stage.container.addEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.on("wheel",this.onStageMouseWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("pointerup",this.onWindowPointerUp),window.addEventListener("blur",this.onWindowBlur),()=>{this.konva.stage.off("pointerenter",this.onStagePointerEnter),this.konva.stage.off("pointerdown",this.onStagePointerDown),this.konva.stage.off("pointerup",this.onStagePointerUp),this.konva.stage.off("pointermove",this.onStagePointerMove),this.manager.stage.container.removeEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.off("wheel",this.onStageMouseWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("pointerup",this.onWindowPointerUp),window.removeEventListener("blur",this.onWindowBlur)}));k(this,"getCanDraw",()=>{if(this.manager.stateApi.getRenderedEntityCount()===0||this.manager.$isBusy.get()||this.manager.stage.getIsDragging())return!1;const n=this.manager.stateApi.getSelectedEntityAdapter();return!(!n||n.$isDisabled.get()||n.$isEntityTypeHidden.get()||n.$isLocked.get())});k(this,"onStagePointerEnter",async n=>{var s;try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.syncCursorPositions();const i=this.$tool.get(),o=this.manager.stateApi.getSelectedEntityAdapter();if(((s=o==null?void 0:o.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&(o!=null&&o.bufferRenderer.hasBuffer())){o.bufferRenderer.commitBuffer();return}i==="brush"?await this.tools.brush.onStagePointerEnter(n):i==="eraser"&&await this.tools.eraser.onStagePointerEnter(n)}finally{this.render()}});k(this,"onStagePointerDown",async n=>{if(n.target===this.konva.stage)try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.$isPrimaryPointerDown.set(tK(n)),this.syncCursorPositions();const s=this.$tool.get();s==="brush"?await this.tools.brush.onStagePointerDown(n):s==="eraser"?await this.tools.eraser.onStagePointerDown(n):s==="rect"&&await this.tools.rect.onStagePointerDown(n)}finally{this.render()}});k(this,"onStagePointerUp",n=>{if(n.target===this.konva.stage)try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;const s=this.$tool.get();s==="colorPicker"?this.tools.colorPicker.onStagePointerUp(n):s==="brush"?this.tools.brush.onStagePointerUp(n):s==="eraser"?this.tools.eraser.onStagePointerUp(n):s==="rect"&&this.tools.rect.onStagePointerUp(n)}finally{this.render()}});k(this,"onStagePointerMove",async n=>{var s;if(n.target===this.konva.stage)try{if(this.$lastPointerType.set(n.evt.pointerType),this.syncCursorPositions(),!this.getCanDraw())return;const i=this.$tool.get();i==="colorPicker"?this.tools.colorPicker.onStagePointerMove(n):i==="brush"?await this.tools.brush.onStagePointerMove(n):i==="eraser"?await this.tools.eraser.onStagePointerMove(n):i==="rect"?await this.tools.rect.onStagePointerMove(n):(s=this.manager.stateApi.getSelectedEntityAdapter())==null||s.bufferRenderer.clearBuffer()}finally{this.render()}});k(this,"onStagePointerLeave",n=>{var s;if(n.target===this.manager.stage.container)try{if(this.$lastPointerType.set(n.pointerType),this.$cursorPos.set(null),!this.getCanDraw())return;const i=this.manager.stateApi.getSelectedEntityAdapter();i&&((s=i.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&i.bufferRenderer.hasBuffer()&&i.bufferRenderer.commitBuffer()}finally{this.render()}});k(this,"onStageMouseWheel",n=>{if(n.target!==this.konva.stage||!this.getCanDraw()||(n.evt.preventDefault(),!n.evt.ctrlKey&&!n.evt.metaKey))return;const s=this.manager.stateApi.getSettings(),i=this.$tool.get();let o=n.evt.deltaY;s.invertScrollForToolWidth&&(o=-o),i==="brush"?this.manager.stateApi.setBrushWidth(zk(s.brushWidth,o)):i==="eraser"&&this.manager.stateApi.setEraserWidth(zk(s.eraserWidth,o)),this.render()});k(this,"onWindowPointerUp",n=>{try{this.$isPrimaryPointerDown.set(!1);const s=this.manager.stateApi.getSelectedEntityAdapter();s&&s.bufferRenderer.hasBuffer()&&!this.manager.$isBusy.get()&&s.bufferRenderer.commitBuffer()}finally{this.render()}});k(this,"onWindowBlur",()=>{this.revertToolBuffer()});k(this,"onKeyDown",n=>{var s;if(!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)&&(this.tools.move.isNudgeKey(n.key)&&this.tools.move.nudge(n.key),!n.repeat)){if(n.key===E1e){n.preventDefault();const i=this.manager.stateApi.getSelectedEntityAdapter();i&&!((s=i.filterer)!=null&&s.$isFiltering.get())&&!i.transformer.$isTransforming.get()&&i.bufferRenderer.hasBuffer()&&i.bufferRenderer.clearBuffer();return}if(n.key===E6){n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("view"),this.manager.stateApi.$spaceKey.set(!0),this.$cursorPos.set(null);return}n.key===L6&&(n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("colorPicker"))}});k(this,"onKeyUp",n=>{if(!n.repeat&&!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)){if(n.key===E6){n.preventDefault(),this.revertToolBuffer(),this.manager.stateApi.$spaceKey.set(!1);return}if(n.key===L6){n.preventDefault(),this.revertToolBuffer();return}}});k(this,"revertToolBuffer",()=>{const n=this.$toolBuffer.get();n&&(this.$tool.set(n),this.$toolBuffer.set(null))});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$tool:this.$tool.get(),$toolBuffer:this.$toolBuffer.get(),$isPrimaryPointerDown:this.$isPrimaryPointerDown.get(),$cursorPos:this.$cursorPos.get(),$lastPointerType:this.$lastPointerType.get(),tools:{brush:this.tools.brush.repr(),eraser:this.tools.eraser.repr(),colorPicker:this.tools.colorPicker.repr(),rect:this.tools.rect.repr(),bbox:this.tools.bbox.repr(),view:this.tools.view.repr(),move:this.tools.move.repr()}}));k(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=_e(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating tool module"),this.tools={brush:new w1e(this),eraser:new I1e(this),rect:new M1e(this),colorPicker:new k1e(this),bbox:new C1e(this),view:new P1e(this),move:new T1e(this)},this.konva={stage:this.manager.stage.konva.stage,group:new Ne.Group({name:`${this.type}:group`,listening:!0})},this.konva.group.add(this.tools.brush.konva.group),this.konva.group.add(this.tools.eraser.konva.group),this.konva.group.add(this.tools.colorPicker.konva.group),this.konva.group.add(this.tools.bbox.konva.group),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ta,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Je,this.render)),this.subscriptions.add(this.$tool.listen(()=>{this.manager.tool.$isPrimaryPointerDown.set(!1),this.render()}));const s=this.setEventListeners();this.subscriptions.add(s)}}class R1e extends $t{constructor(n){super();k(this,"type","worker");k(this,"id");k(this,"path");k(this,"log");k(this,"parent");k(this,"manager");k(this,"worker",new Worker(new URL(""+new URL("worker-Dywf1EVc.js",import.meta.url).href,import.meta.url),{type:"module",name:"worker"}));k(this,"tasks",new Map);k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,tasks:Array.from(this.tasks.keys())}));k(this,"destroy",()=>{this.log.trace("Destroying worker module"),this.worker.terminate(),this.tasks.clear()});this.id=_e(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.worker.onmessage=s=>{const{type:i,data:o}=s.data;if(i==="log")o.ctx?this.log[o.level](o.ctx,o.message):this.log[o.level](o.message);else if(i==="extents"){const a=this.tasks.get(o.id);if(!a)return;a.onComplete(o.extents),this.tasks.delete(o.id)}},this.worker.onerror=s=>{this.log.error({message:s.message},"Worker error")},this.worker.onmessageerror=()=>{this.log.error("Worker message error")}}requestBbox(n,s){const i=_e("bbox_calculation"),o={type:"get_bbox",data:{...n,id:i}};this.tasks.set(i,{task:o,onComplete:s}),this.worker.postMessage(o,[n.buffer])}}const td="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAFwWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDktMTNUMjA6NTM6MTMrMTAwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyNC0wOS0xM1QyMDo1MzoxMysxMDAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0iR2VuZXJpYyBSR0IgUHJvZmlsZSIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjIwIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjAiCiAgIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI5Ni8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI5Ni8xIj4KICAgPGRjOnRpdGxlPgogICAgPHJkZjpBbHQ+CiAgICAgPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij50cmFuc3BhcmVudF9iZ19kYXJrPC9yZGY6bGk+CiAgICA8L3JkZjpBbHQ+CiAgIDwvZGM6dGl0bGU+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InByb2R1Y2VkIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZmZpbml0eSBQaG90byAyIDIuNS41IgogICAgICBzdEV2dDp3aGVuPSIyMDI0LTA5LTEzVDIxOjE4OjQwKzEwOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5YzHPhAAAETGlDQ1BHZW5lcmljIFJHQiBQcm9maWxlAABIic1VXWgcVRQ+m7m7CSSOUmNTU0kHtTaENExSqRtqo/uXZNu4WTbZtA0Fncze3Zlm9seZ2dSWYiEI/rwYFXxVq4IPBZ8K8T8FMSJKCyVKMIiCYOsfhUpfNKznzp3dnaRZ9dE73JnvnvPdc+8958y5AC3PGWreapIA8gXbTI2EpaPHpqXmVWiCu6EVOqFVUa1SKJkcA2xKqWTALe3m1+Bj3yt7ma1b9f/YWjPUUgF8Ldj7MpaaB2gKAvhfUEumDdD8KXKCJ+0Sw38hbjdxgwAtdzCc4/h+hmc4DjqcyVQEMduzqGpKBvFxxL0zHnnOg/kenNY+QgvU1FWJ+SJpFrO6Qat7bYcRoFDAboIOKkiQQkkYv0mUFCGLUgMo/O/aMsz/1Jd9vufo8J1HfB754u37fWysWjTDxku7+Vg+ew7gCYB3BM5bevjsFJO3uJPzRrnqr13Y26zZicP47cYYPpNRogxjTHznVSU24eLLc/pUwsV/lOxwCvEDGOsd5dl0CHEP4qGsOZzmdpo0rTxaxQuntckjiLchXpwtHmZztyP+ojCTGHftfK9aEYw/3AsgBDQaZ3HtQtxtFlPjfF1hOEOjMcS9iE/odnyS2xdeteYmYlU7p7VIgq8lfHxCOZRE3In4MjVGUq79n0t20l2XtBWMxBi3Qwao5ZzXkdva5Chfl0zbmJB8Lnk6qw/HXf7rmjmacvHnJcP5x3Bv5LpZTqU5338PLaRdm/4hxYyNuDgDUz4Fc60IM/hWMSvXPflY8uRjPWcpjqqcvRs4SUfPcd1Kzpl51c32SNfbUEapBr+iVPPwIjgqoyzXwA7fwTXXTpF0EJnsw36AjJGDJEgGQSKPkEfJEImidJAcqM31/ldsP9dqdp7EFanDm0LeRdTboOD7B2QUwdraFwud5W4unzcf19VLL15fPvPhjjp3hSwev9K2fGbDf27BbAOvjf+b7/0/+q/6V/C96l+rM/zf+tfwWd10uo1er9aYEOoMR5bHrjsay7Of5IYo1nGxocVitrDQyXXMA/TZxM0EzPfW+fI38m/yivyG/Jb8i/CKcEH4SHhPeF/4EiRhSbgofCJ8JrwrfOCJUePcqcXcOUf1FEyzlUcxP8WwuFO8T4yKu8Td4ljdntgh9ouj4h7U7KxFx7ue9+w6HHPqMPfW1mtxnifOvtswznqDfyiNLB1OOkzLybMCnNrEcWeSLtJP4puyOshyvWb7P90igVggGgiBFOgJDAb6A4cYrjIDe1A3iG+sWjZ9ymaFOFIsnTL1nGZLA7L8kBTCq5pK8YLa1ysphiE5KksyqUXNOZrpA3bP8xJ+I+Xc377tl+oy+zGAg7+zuleXTZcBzuP93vFgXdaNtfGu1/Am2a+WzTn3TvD5vgKwsvsG+KgtjPXqu0rlBtat5pcB1l+qVP48V6msv4n21/B2Mf4GjzuDirebG+gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAsSURBVDiNYxSTkGXADdg5OPDIMuGRIwhGNY8MzSz409DPHz9oZfOo5pGhGQABmwOMaHIlKQAAAABJRU5ErkJggg==",O1e={GRID_LINE_COLOR_COARSE:Hk(27),GRID_LINE_COLOR_FINE:Hk(18),CHECKERBOARD_PATTERN_DATAURL:td},O0=class O0 extends $t{constructor(n){super();k(this,"type","background");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"subscriptions",new Set);k(this,"config",O1e);k(this,"checkboardPattern",new Image);k(this,"konva");k(this,"initialize",()=>{this.log.debug("Initializing module"),this.checkboardPattern.onload=()=>{this.konva.patternRect.fillPatternImage(this.checkboardPattern),this.render()},this.checkboardPattern.src=qf.get()?"use-credentials":"anonymous",this.checkboardPattern.src=this.config.CHECKERBOARD_PATTERN_DATAURL,this.render()});k(this,"render",()=>{if(!this.manager.stateApi.runSelector(Lm)){this.konva.linesGroup.visible(!1);const S=this.manager.stage.unscale(1);this.konva.patternRect.setAttrs({visible:!0,...this.manager.stage.getScaledStageRect(),fillPatternScaleX:S,fillPatternScaleY:S});return}this.konva.linesGroup.visible(!0),this.konva.patternRect.visible(!1);const s=this.manager.stage.getScale(),{x:i,y:o}=this.manager.stage.getPosition(),{width:a,height:l}=this.manager.stage.getSize(),c=O0.getGridSpacing(s),d={x1:0,y1:0,x2:a,y2:l},h={x:Math.ceil(i/s/c)*c,y:Math.ceil(o/s/c)*c},f={x1:-h.x,y1:-h.y,x2:a/s-h.x+c,y2:l/s-h.y+c},p={x1:Math.min(d.x1,f.x1),y1:Math.min(d.y1,f.y1),x2:Math.max(d.x2,f.x2),y2:Math.max(d.y2,f.y2)},g=p.x2-p.x1,m=p.y2-p.y1,y=Math.round(g/c)+1,x=Math.round(m/c)+1,C=1/s;let v=0,b=0;this.konva.linesGroup.destroyChildren(),this.konva.lines=[];for(let S=0;S<y;S++){v=p.x1+S*c;const w=new Ne.Line({x:v,y:p.y1,points:[0,0,0,m],stroke:v%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:C,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(w),this.konva.linesGroup.add(w)}for(let S=0;S<x;S++){b=p.y1+S*c;const w=new Ne.Line({x:p.x1,y:b,points:[0,0,g,0],stroke:b%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:C,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(w),this.konva.linesGroup.add(w)}});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));k(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.layer.destroy()});this.id=_e(this.type),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Ne.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1}),linesGroup:new Ne.Group({name:`${this.type}:linesGroup`}),lines:[],patternRect:new Ne.Rect({name:`${this.type}:patternRect`,perfectDrawEnabled:!1})},this.konva.layer.add(this.konva.patternRect),this.konva.layer.add(this.konva.linesGroup),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Lm,this.render))}};k(O0,"getGridSpacing",n=>n>=2?8:n>=1&&n<2?16:n>=.5&&n<1?32:n>=.25&&n<.5?64:n>=.125&&n<.25?128:256);let f2=O0;class Qw extends Error{constructor(n,s,i){super(s);k(this,"type");k(this,"traceback");this.name="QueueError",this.type=n,this.traceback=i,Error.captureStackTrace&&Error.captureStackTrace(this,Qw)}toString(){return`${this.name} [${this.type}]: ${this.message}
Traceback:
${this.traceback}`}}class N1e extends $t{constructor(n,s){super();k(this,"type","state_api");k(this,"id");k(this,"path");k(this,"parent");k(this,"manager");k(this,"log");k(this,"store");k(this,"runSelector",n=>n(this.store.getState()));k(this,"createStoreSubscription",(n,s)=>nK(this.store,n,s));k(this,"addStoreListener",n=>this.store.dispatch(sK(n)));k(this,"getCanvasState",()=>this.runSelector(Je));k(this,"resetEntity",n=>{this.store.dispatch(DM(n))});k(this,"setEntityPosition",n=>{this.store.dispatch(rK(n))});k(this,"moveEntityBy",n=>{this.store.dispatch(iK(n))});k(this,"addBrushLine",n=>{this.store.dispatch(oK(n))});k(this,"addEraserLine",n=>{this.store.dispatch(aK(n))});k(this,"addRect",n=>{this.store.dispatch(lK(n))});k(this,"addRasterLayer",n=>{this.store.dispatch(Nl(n))});k(this,"addControlLayer",n=>{this.store.dispatch(zf(n))});k(this,"addInpaintMask",n=>{this.store.dispatch(G0(n))});k(this,"addRegionalGuidance",n=>{this.store.dispatch(va(n))});k(this,"rasterizeEntity",n=>{this.store.dispatch(uC(n))});k(this,"setGenerationBbox",n=>{this.store.dispatch(Ih(n))});k(this,"setBrushWidth",n=>{this.store.dispatch(RM(n))});k(this,"setEraserWidth",n=>{this.store.dispatch(OM(n))});k(this,"setColor",n=>this.store.dispatch(Yb(n)));k(this,"runGraphAndReturnImageOutput",n=>{const{graph:s,outputNodeId:i,destination:o,prepend:a,timeout:l,signal:c}=n;if(!s.hasNode(i))throw new Error(`Graph does not contain node with id: ${i}`);const d=_e(s.id),h={prepend:a,batch:{graph:s.getGraph(),origin:d,destination:o,runs:1}};let f=!1,p=null;const g=()=>{p!==null&&(window.clearTimeout(p),p=null)};let m=()=>{this.log.warn("cancelGraph called before cancelGraph is set")};return new Promise((x,C)=>{const v=async j=>{if(j.origin!==d||j.invocation_source_id!==i)return;g(),w();const{result:E}=j;if(E.type!=="image_output"){C(new Error(`Graph output node did not return an image output, got: ${E}`));return}const A=await Un(()=>MT(E.image.image_name));if(A.isErr()){C(A.error);return}f=!0,x(A.value)},b=j=>{if(j.origin===d&&!(j.status==="pending"||j.status==="in_progress")){if(j.status==="completed"){this.log.warn("Queue item completed without output node completion event");return}if(g(),w(),j.status==="failed"){const{error_type:E,error_message:A,error_traceback:L}=j;C(E&&A&&L?new Qw(E,A,L):new Error("Queue item failed, but no error details were provided"))}else C(new Error("Graph canceled"))}};this.store.dispatch(Lc.endpoints.enqueueBatch.initiate(h,{...V0,track:!1})).unwrap().then(j=>{const E=j.batch.batch_id;Re(E,"Enqueue result is missing batch_id"),m=()=>{this.store.dispatch(Lc.endpoints.cancelByBatchIds.initiate({batch_ids:[E]},{track:!1}))}}).catch(j=>{C(j)}),this.manager.socket.on("invocation_complete",v),this.manager.socket.on("queue_item_status_changed",b);const w=()=>{this.manager.socket.off("invocation_complete",v),this.manager.socket.off("queue_item_status_changed",b)};l&&(p=window.setTimeout(()=>{f||(this.log.trace("Graph canceled by timeout"),w(),m(),C(new Error("Graph timed out")))},l)),c&&c.addEventListener("abort",()=>{f||(this.log.trace("Graph canceled by signal"),g(),w(),m(),C(new Error("Graph canceled")))})})});k(this,"getBbox",()=>this.runSelector(Ec));k(this,"getSettings",()=>this.runSelector(Ta));k(this,"getGridSize",()=>this.getSettings().snapToGrid?this.$ctrlKey.get()||this.$metaKey.get()?8:64:1);k(this,"getRegionsState",()=>this.getCanvasState().regionalGuidance);k(this,"getRasterLayersState",()=>this.getCanvasState().rasterLayers);k(this,"getControlLayersState",()=>this.getCanvasState().controlLayers);k(this,"getInpaintMasksState",()=>this.getCanvasState().inpaintMasks);k(this,"getStagingArea",()=>this.runSelector(Zb));k(this,"getBboxGridSize",()=>this.runSelector(ep));k(this,"getIsSelected",n=>{var s;return((s=this.getCanvasState().selectedEntityIdentifier)==null?void 0:s.id)===n});k(this,"getRenderedEntityCount",()=>{const n=cK(this.getCanvasState());let s=0;for(const i of n)i.isEnabled&&s++;return s});k(this,"getSelectedEntityAdapter",()=>{const n=this.getCanvasState();return!n.selectedEntityIdentifier||!uK(n.selectedEntityIdentifier)?null:this.manager.getAdapter(n.selectedEntityIdentifier)});k(this,"getCurrentColor",()=>{let n=this.getSettings().color;const s=this.getSelectedEntityAdapter();return s&&(s.state.type==="regional_guidance"||s.state.type==="inpaint_mask")&&(n=LM),n});k(this,"getBrushPreviewColor",()=>{const n=this.getSelectedEntityAdapter();return(n==null?void 0:n.state.type)==="regional_guidance"||(n==null?void 0:n.state.type)==="inpaint_mask"?{...n.state.fill.color,a:.5}:this.getSettings().color});k(this,"$filteringAdapter",Oe(null));k(this,"$isFiltering",gs(this.$filteringAdapter,n=>!!n));k(this,"$transformingAdapter",Oe(null));k(this,"$isTransforming",gs(this.$transformingAdapter,n=>!!n));k(this,"$rasterizingAdapter",Oe(null));k(this,"$isRasterizing",gs(this.$rasterizingAdapter,n=>!!n));k(this,"$segmentingAdapter",Oe(null));k(this,"$isSegmenting",gs(this.$segmentingAdapter,n=>!!n));k(this,"$spaceKey",Oe(!1));k(this,"$altKey",dK);k(this,"$ctrlKey",hK);k(this,"$metaKey",fK);k(this,"$shiftKey",kC);k(this,"repr",()=>{var n,s,i,o;return{id:this.id,type:this.type,path:this.path,$filteringAdapter:((n=this.$filteringAdapter.get())==null?void 0:n.entityIdentifier)??null,$isFiltering:this.$isFiltering.get(),$transformingAdapter:((s=this.$transformingAdapter.get())==null?void 0:s.entityIdentifier)??null,$isTransforming:this.$isTransforming.get(),$rasterizingAdapter:((i=this.$rasterizingAdapter.get())==null?void 0:i.entityIdentifier)??null,$isRasterizing:this.$isRasterizing.get(),$segmentingAdapter:((o=this.$segmentingAdapter.get())==null?void 0:o.entityIdentifier)??null,$isSegmenting:this.$isSegmenting.get()}});this.id=_e(this.type),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating state api module"),this.store=n}}class F1e extends $t{constructor(n,s,i){super();k(this,"type","manager");k(this,"id");k(this,"path");k(this,"manager");k(this,"parent");k(this,"log");k(this,"store");k(this,"socket");k(this,"adapters",{rasterLayers:new Oh,controlLayers:new Oh,regionMasks:new Oh,inpaintMasks:new Oh});k(this,"stateApi");k(this,"background");k(this,"stage");k(this,"worker");k(this,"cache");k(this,"entityRenderer");k(this,"compositor");k(this,"tool");k(this,"stagingArea");k(this,"progressImage");k(this,"konva");k(this,"_isDebugging",!1);k(this,"$isBusy");k(this,"getAdapter",n=>{let s;switch(n.type){case"raster_layer":s=this.adapters.rasterLayers.get(n.id);break;case"control_layer":s=this.adapters.controlLayers.get(n.id);break;case"regional_guidance":s=this.adapters.regionMasks.get(n.id);break;case"inpaint_mask":s=this.adapters.inpaintMasks.get(n.id);break;default:return null}return s||null});k(this,"deleteAdapter",n=>{switch(n.type){case"raster_layer":return this.adapters.rasterLayers.delete(n.id);case"control_layer":return this.adapters.controlLayers.delete(n.id);case"regional_guidance":return this.adapters.regionMasks.delete(n.id);case"inpaint_mask":return this.adapters.inpaintMasks.delete(n.id);default:return!1}});k(this,"getAdapters",n=>{const s=[];for(const i of n){const o=this.getAdapter(i);o&&s.push(o)}return s});k(this,"getAllAdapters",()=>[...this.adapters.rasterLayers.values(),...this.adapters.controlLayers.values(),...this.adapters.regionMasks.values(),...this.adapters.inpaintMasks.values()]);k(this,"createAdapter",n=>{if($T(n)){const s=new u1e(n,this);return this.adapters.rasterLayers.set(s.id,s),s}else if(pK(n)){const s=new l1e(n,this);return this.adapters.controlLayers.set(s.id,s),s}else if(gK(n)){const s=new d1e(n,this);return this.adapters.regionMasks.set(s.id,s),s}else if(mK(n)){const s=new c1e(n,this);return this.adapters.inpaintMasks.set(s.id,s),s}else Re(!1,"Unhandled entity type")});k(this,"getAllModules",()=>[this.stagingArea,this.tool,this.progressImage,this.stateApi,this.background,this.worker,this.entityRenderer,this.compositor,this.stage]);k(this,"initialize",()=>{var n;this.log.debug("Initializing");for(const s of this.getAllModules())(n=s.initialize)==null||n.call(s);of.set(this)});k(this,"destroy",()=>{this.log.debug("Destroying module");for(const n of this.getAllAdapters())n.destroy();for(const n of this.getAllModules())n.destroy();of.set(null)});k(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isBusy:this.$isBusy.get(),rasterLayers:Array.from(this.adapters.rasterLayers.values()).map(n=>n.repr()),controlLayers:Array.from(this.adapters.controlLayers.values()).map(n=>n.repr()),inpaintMasks:Array.from(this.adapters.inpaintMasks.values()).map(n=>n.repr()),regionMasks:Array.from(this.adapters.regionMasks.values()).map(n=>n.repr()),stateApi:this.stateApi.repr(),stagingArea:this.stagingArea.repr(),tool:this.tool.repr(),progressImage:this.progressImage.repr(),background:this.background.repr(),worker:this.worker.repr(),entityRenderer:this.entityRenderer.repr(),compositor:this.compositor.repr(),stage:this.stage.repr()}));k(this,"getLoggingContext",()=>({path:this.path}));k(this,"buildPath",n=>n.parent.path.concat(n.id));k(this,"buildLogger",n=>this.log.child(s=>({...s,context:{...s.context,...n.getLoggingContext()}})));this.id=_e(this.type),this.path=[this.id],this.manager=this,this.parent=this,this.log=nr("canvas").child(o=>({...o,context:{...this.getLoggingContext(),...o.context}})),this.log.debug("Creating canvas manager module"),this.store=s,this.socket=i,this.stateApi=new N1e(this.store,this),this.stage=new m1e(n,this),this.worker=new R1e(this),this.cache=new v0(this),this.entityRenderer=new h1e(this),this.compositor=new z0e(this),this.stagingArea=new y1e(this),this.$isBusy=gs([this.stateApi.$isFiltering,this.stateApi.$isTransforming,this.stateApi.$isRasterizing,this.stateApi.$isSegmenting,this.stagingArea.$isStaging,this.compositor.$isBusy],(o,a,l,c,d,h)=>o||a||l||c||d||h),this.background=new f2(this),this.stage.addLayer(this.background.konva.layer),this.konva={previewLayer:new Ne.Layer({listening:!0,imageSmoothingEnabled:!1})},this.stage.addLayer(this.konva.previewLayer),this.tool=new D1e(this),this.progressImage=new p1e(this),this.konva.previewLayer.add(this.stagingArea.konva.group),this.konva.previewLayer.add(this.progressImage.konva.group),this.konva.previewLayer.add(this.tool.konva.group)}enableDebugging(){this._isDebugging=!0,this.logDebugInfo()}disableDebugging(){this._isDebugging=!1}logDebugInfo(){console.log("Canvas manager",{managerInstance:this,managerInfo:this.repr()})}}function B1e(e){const t=D6(e),[n,s]=u.useState(t),{defaultDpr:i,maxDpr:o,round:a}=e||{};return u.useEffect(()=>{if(!(typeof window<"u"&&"matchMedia"in window))return;const c=()=>s(D6({defaultDpr:i,maxDpr:o,round:a})),d=window.matchMedia(`screen and (resolution: ${n}dppx)`);return d.addEventListener?d.addEventListener("change",c):d.addListener(c),()=>{d.removeEventListener?d.removeEventListener("change",c):d.removeListener(c)}},[n,i,o,a]),n}function D6(e){const{defaultDpr:t=1,maxDpr:n=3,round:s=!0}=e||{},o=typeof window<"u"&&typeof window.devicePixelRatio=="number"?window.devicePixelRatio:t;return Math.min(Math.max(1,s?Math.floor(o):o),n)}const Uv=nr("canvas");Ne.showWarnings=!1;const $1e=()=>{wt("useKonvaPixelRatioWatcher");const e=B1e({round:!1});u.useLayoutEffect(()=>{Ne.pixelRatio=e},[e])},V1e=()=>{wt("useInvokeCanvas"),$1e();const e=sr(),t=ce(NM),[n,s]=u.useState(null);return u.useLayoutEffect(()=>{if(Uv.debug("Initializing renderer"),!n)return Uv.debug("No stage container, skipping initialization"),()=>{};if(!t)return Uv.debug("Socket not connected, skipping initialization"),()=>{};const i=of.get();if(i){i.stage.setContainer(n);return}new F1e(n,e,t).initialize()},[n,t,e]),s},DO=u.memo(()=>{const e=V1e();return r.jsx(ke,{position:"absolute",top:0,right:0,bottom:0,left:0,ref:e,borderRadius:"base",overflow:"hidden","data-testid":"control-layers-canvas"})});DO.displayName="InvokeCanvasComponent";const RO=u.memo(({adapter:e})=>{const{t}=P(),n=ce(e.segmentAnything.$invert),s=u.useCallback(()=>{e.segmentAnything.$invert.set(!e.segmentAnything.$invert.get())},[e.segmentAnything.$invert]);return r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:t("controlLayers.selectObject.invertSelection")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})});RO.displayName="SelectObjectInvert";const OO=u.memo(({adapter:e})=>{const{t}=P(),n=ce(e.segmentAnything.$pointTypeString),s=u.useCallback(i=>{const o=yK.parse(i),a=vK[o];e.segmentAnything.$pointType.set(a)},[e.segmentAnything.$pointType]);return r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:t("controlLayers.selectObject.pointType")}),r.jsx(bK,{value:n,onChange:s,w:"full",size:"md",children:r.jsxs(T,{alignItems:"center",w:"full",gap:4,fontWeight:"semibold",color:"base.300",children:[r.jsx(Wk,{value:"foreground",children:r.jsx(K,{children:t("controlLayers.selectObject.include")})}),r.jsx(Wk,{value:"background",children:r.jsx(K,{children:t("controlLayers.selectObject.exclude")})})]})})]})});OO.displayName="SelectObject";const NO=u.memo(({adapter:e})=>{const{t}=P(),n=u.useRef(null);Go("canvas",n,{focusOnMount:!0});const s=Ds("canvas"),i=ce(e.segmentAnything.$isProcessing),o=ce(e.segmentAnything.$hasPoints),a=ce(e.segmentAnything.$hasImageState),l=I(Jf),c=u.useCallback(()=>{e.segmentAnything.saveAs("inpaint_mask")},[e.segmentAnything]),d=u.useCallback(()=>{e.segmentAnything.saveAs("regional_guidance")},[e.segmentAnything]),h=u.useCallback(()=>{e.segmentAnything.saveAs("raster_layer")},[e.segmentAnything]),f=u.useCallback(()=>{e.segmentAnything.saveAs("control_layer")},[e.segmentAnything]);return Ee({id:"applySegmentAnything",category:"canvas",callback:e.segmentAnything.apply,options:{enabled:!i&&s},dependencies:[e.segmentAnything,i,s]}),Ee({id:"cancelSegmentAnything",category:"canvas",callback:e.segmentAnything.cancel,options:{enabled:!i&&s},dependencies:[e.segmentAnything,i,s]}),r.jsxs(T,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[r.jsxs(T,{w:"full",gap:4,alignItems:"center",children:[r.jsxs(T,{gap:2,children:[r.jsx(Ot,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.selectObject.selectObject")}),r.jsx(Le,{label:r.jsx(BO,{}),children:r.jsx(T,{alignItems:"center",children:r.jsx(pt,{as:Gu,color:"base.500"})})})]}),r.jsx(nt,{}),r.jsx(Zw,{}),r.jsx(ry,{})]}),r.jsxs(T,{w:"full",justifyContent:"space-between",py:2,children:[r.jsx(OO,{adapter:e}),r.jsx(RO,{adapter:e})]}),r.jsxs(as,{isAttached:!1,size:"sm",w:"full",children:[r.jsxs(ye,{onClick:e.segmentAnything.processImmediate,loadingText:t("controlLayers.selectObject.process"),variant:"ghost",isDisabled:i||!o||l&&a,children:[t("controlLayers.selectObject.process"),i&&r.jsx(or,{ms:3,boxSize:5,color:"base.600"})]}),r.jsx(nt,{}),r.jsx(ye,{onClick:e.segmentAnything.reset,isDisabled:i||!o,loadingText:t("controlLayers.selectObject.reset"),variant:"ghost",children:t("controlLayers.selectObject.reset")}),r.jsx(ye,{onClick:e.segmentAnything.apply,loadingText:t("controlLayers.selectObject.apply"),variant:"ghost",isDisabled:i||!a,children:t("controlLayers.selectObject.apply")}),r.jsxs(Qt,{children:[r.jsx(Jt,{as:ye,loadingText:t("controlLayers.selectObject.saveAs"),variant:"ghost",isDisabled:i||!a,rightIcon:r.jsx(Pr,{}),children:t("controlLayers.selectObject.saveAs")}),r.jsxs(kt,{children:[r.jsx(he,{isDisabled:i||!a,onClick:c,children:t("controlLayers.newInpaintMask")}),r.jsx(he,{isDisabled:i||!a,onClick:d,children:t("controlLayers.newRegionalGuidance")}),r.jsx(he,{isDisabled:i||!a,onClick:f,children:t("controlLayers.newControlLayer")}),r.jsx(he,{isDisabled:i||!a,onClick:h,children:t("controlLayers.newRasterLayer")})]})]}),r.jsx(ye,{onClick:e.segmentAnything.cancel,isDisabled:i,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.selectObject.cancel")})]})]})});NO.displayName="SegmentAnythingContent";const FO=u.memo(()=>{const e=Tt(),t=ce(e.stateApi.$segmentingAdapter);return t?r.jsx(NO,{adapter:t}):null});FO.displayName="SelectObject";const R6=e=>r.jsx(K,{as:"span",fontWeight:"semibold",children:e.children}),BO=u.memo(()=>{const{t:e}=P();return r.jsxs(T,{gap:3,flexDir:"column",children:[r.jsx(K,{children:r.jsx(Xt,{i18nKey:"controlLayers.selectObject.help1",components:{Bold:r.jsx(R6,{})}})}),r.jsx(K,{children:r.jsx(Xt,{i18nKey:"controlLayers.selectObject.help2",components:{Bold:r.jsx(R6,{})}})}),r.jsx(K,{children:r.jsx(Xt,{i18nKey:"controlLayers.selectObject.help3"})}),r.jsxs(ki,{children:[r.jsx(Gt,{children:e("controlLayers.selectObject.clickToAdd")}),r.jsx(Gt,{children:e("controlLayers.selectObject.dragToMove")}),r.jsx(Gt,{children:e("controlLayers.selectObject.clickToRemove")})]})]})});BO.displayName="SelectObjectHelpTooltipContent";const G1e={destination:"canvas"},z1e=()=>{xK(G1e)},$O=u.memo(e=>(z1e(),I(Dn)?e.children:null));$O.displayName="StagingAreaIsStagingGate";const VO=u.memo(()=>{const e=z(),t=Tt(),n=I(Hf),s=I(J0),i=I(kn),o=I(tp),a=ce(t.stagingArea.$shouldShowStagedImage),l=Ds("canvas"),{t:c}=P(),d=u.useCallback(()=>{if(!s)return;const{x:h,y:f}=n,{imageDTO:p,offsetX:g,offsetY:m}=s,y=Jr(p),x={position:{x:h+g,y:f+m},objects:[y]};e(Nl({overrides:x,isSelected:(i==null?void 0:i.type)==="raster_layer"})),e(_C())},[n,e,i==null?void 0:i.type,s]);return Si(["enter"],d,{preventDefault:!0,enabled:l&&a&&o>1},[l,a,o]),r.jsx(ae,{tooltip:`${c("common.accept")} (Enter)`,"aria-label":`${c("common.accept")} (Enter)`,icon:r.jsx(mp,{}),onClick:d,colorScheme:"invokeBlue",isDisabled:!s})});VO.displayName="StagingAreaToolbarAcceptButton";const GO=u.memo(()=>{const e=z(),{t}=P(),n=u.useCallback(()=>{e(_C())},[e]);return r.jsx(ae,{tooltip:`${t("controlLayers.stagingArea.discardAll")} (Esc)`,"aria-label":t("controlLayers.stagingArea.discardAll"),icon:r.jsx(Xr,{}),onClick:n,colorScheme:"error",fontSize:16})});GO.displayName="StagingAreaToolbarDiscardAllButton";const zO=u.memo(()=>{const e=z(),t=I(FM),n=I(J0),s=I(tp),{t:i}=P(),o=u.useCallback(()=>{n&&e(s===1?_C():CK({index:t}))},[n,s,e,t]);return r.jsx(ae,{tooltip:i("controlLayers.stagingArea.discard"),"aria-label":i("controlLayers.stagingArea.discard"),icon:r.jsx(Nt,{}),onClick:o,colorScheme:"invokeBlue",fontSize:16,isDisabled:!n})});zO.displayName="StagingAreaToolbarDiscardSelectedButton";const HO=u.memo(()=>{const e=I(FM),t=I(tp),n=u.useMemo(()=>t>0?`${(e??0)+1} of ${t}`:"0 of 0",[t,e]);return r.jsx(ye,{colorScheme:"base",pointerEvents:"none",minW:28,children:n})});HO.displayName="StagingAreaToolbarImageCountButton";const WO=u.memo(()=>{const e=z(),t=Tt(),n=I(tp),s=ce(t.stagingArea.$shouldShowStagedImage),i=Ds("canvas"),{t:o}=P(),a=u.useCallback(()=>{e(SK())},[e]);return Si(["right"],a,{preventDefault:!0,enabled:i&&s&&n>1},[i,s,n]),r.jsx(ae,{tooltip:`${o("controlLayers.stagingArea.next")} (Right)`,"aria-label":`${o("controlLayers.stagingArea.next")} (Right)`,icon:r.jsx(ooe,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});WO.displayName="StagingAreaToolbarNextButton";const UO=u.memo(()=>{const e=z(),t=Tt(),n=I(tp),s=ce(t.stagingArea.$shouldShowStagedImage),i=Ds("canvas"),{t:o}=P(),a=u.useCallback(()=>{e(wK())},[e]);return Si(["left"],a,{preventDefault:!0,enabled:i&&s&&n>1},[i,s,n]),r.jsx(ae,{tooltip:`${o("controlLayers.stagingArea.previous")} (Left)`,"aria-label":`${o("controlLayers.stagingArea.previous")} (Left)`,icon:r.jsx(soe,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});UO.displayName="StagingAreaToolbarPrevButton";const $g={image_category:"general",is_intermediate:!0,silent:!0},qO=u.memo(()=>{const{t:e}=P(),t=I(J0),n=sr(),s=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await Ah(t.imageDTO),h=await ca({file:d,...$g});Vr({imageDTO:h,type:"raster_layer",dispatch:l,getState:c,overrides:{isEnabled:!1}}),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),i=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await Ah(t.imageDTO),h=await ca({file:d,...$g});Vr({imageDTO:h,type:"control_layer",dispatch:l,getState:c,overrides:{isEnabled:!1}}),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),o=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await Ah(t.imageDTO),h=await ca({file:d,...$g});Vr({imageDTO:h,type:"inpaint_mask",dispatch:l,getState:c,overrides:{isEnabled:!1}}),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]),a=u.useCallback(async()=>{if(!t)return;const{dispatch:l,getState:c}=n,d=await Ah(t.imageDTO),h=await ca({file:d,...$g});Vr({imageDTO:h,type:"regional_guidance",dispatch:l,getState:c,overrides:{isEnabled:!1}}),fe({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,e]);return r.jsxs(Qt,{children:[r.jsx(Jt,{as:ae,"aria-label":e("controlLayers.newLayerFromImage"),tooltip:e("controlLayers.newLayerFromImage"),icon:r.jsx(boe,{}),colorScheme:"invokeBlue",isDisabled:!t}),r.jsxs(kt,{children:[r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:o,isDisabled:!t,children:e("controlLayers.inpaintMask")}),r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:a,isDisabled:!t,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:i,isDisabled:!t,children:e("controlLayers.controlLayer")}),r.jsx(he,{icon:r.jsx(ps,{}),onClickCapture:s,isDisabled:!t,children:e("controlLayers.rasterLayer")})]})]})});qO.displayName="StagingAreaToolbarSaveAsMenu";const O6="SAVE_STAGING_AREA_IMAGE_TO_GALLERY",KO=u.memo(()=>{const e=I(Ar),t=I(J0),{t:n}=P(),s=u.useCallback(async()=>{if(!t)return;(await Un(async()=>{const o=await Ah(t.imageDTO);await ca({file:o,image_category:"general",is_intermediate:!1,board_id:e==="none"?void 0:e,silent:!0})})).isOk()?fe({id:O6,title:n("controlLayers.savedToGalleryOk"),status:"success"}):fe({id:O6,title:n("controlLayers.savedToGalleryError"),status:"error"})},[e,t,n]);return r.jsx(ae,{tooltip:n("controlLayers.stagingArea.saveToGallery"),"aria-label":n("controlLayers.stagingArea.saveToGallery"),icon:r.jsx(Ui,{}),onClick:s,colorScheme:"invokeBlue",isDisabled:!t})});KO.displayName="StagingAreaToolbarSaveSelectedToGalleryButton";const ZO=u.memo(()=>{const e=Tt(),t=ce(e.stagingArea.$shouldShowStagedImage),{t:n}=P(),s=u.useCallback(()=>{e.stagingArea.$shouldShowStagedImage.set(!t)},[e.stagingArea.$shouldShowStagedImage,t]);return r.jsx(ae,{tooltip:n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"aria-label":n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"data-alert":!t,icon:t?r.jsx(yp,{}):r.jsx(woe,{}),onClick:s,colorScheme:"invokeBlue"})});ZO.displayName="StagingAreaToolbarToggleShowResultsButton";const YO=u.memo(()=>r.jsxs(r.Fragment,{children:[r.jsxs(as,{borderRadius:"base",shadow:"dark-lg",children:[r.jsx(UO,{}),r.jsx(HO,{}),r.jsx(WO,{})]}),r.jsxs(as,{borderRadius:"base",shadow:"dark-lg",children:[r.jsx(VO,{}),r.jsx(ZO,{}),r.jsx(KO,{}),r.jsx(qO,{}),r.jsx(zO,{}),r.jsx(GO,{})]})]}));YO.displayName="StagingAreaToolbar";const XO=u.memo(()=>{const{t:e}=P(),t=z(),n=I(IM),s=u.useCallback(()=>{t(jK())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.bboxOverlay")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})});XO.displayName="CanvasSettingsBboxOverlaySwitch";const QO=u.memo(()=>{const{t:e}=P(),t=Tt(),n=u.useCallback(()=>{t.cache.clearAll()},[t]);return r.jsx(ye,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.clearCaches")})});QO.displayName="CanvasSettingsClearCachesButton";const JO=u.memo(()=>{const{t:e}=P(),t=z(),n=u.useCallback(()=>{t(kK())},[t]);return r.jsx(ye,{onClick:n,size:"sm",children:e("controlLayers.clearHistory")})});JO.displayName="CanvasSettingsClearHistoryButton";const H1e=ve(Ta,e=>e.clipToBbox),eN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(H1e),s=u.useCallback(i=>t(_K(i.target.checked)),[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.clipToBbox")}),r.jsx(jn,{isChecked:n,onChange:s})]})});eN.displayName="CanvasSettingsClipToBboxCheckbox";const tN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(Lm),s=u.useCallback(()=>{t(IK())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.dynamicGrid")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})});tN.displayName="CanvasSettingsDynamicGridSwitch";const nN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(AK),s=u.useCallback(()=>{t(TK())},[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.settings.snapToGrid.label")}),r.jsx(jn,{isChecked:n,onChange:s})]})});nN.displayName="CanvasSettingsSnapToGrid";const W1e=ve(Ta,e=>e.invertScrollForToolWidth),sN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(W1e),s=u.useCallback(i=>{t(MK(i.target.checked))},[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.settings.invertBrushSizeScrollDirection")}),r.jsx(jn,{isChecked:n,onChange:s})]})});sN.displayName="CanvasSettingsInvertScrollCheckbox";const rN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(Mm),s=u.useCallback(()=>{t(yM())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedLayerPreview")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})});rN.displayName="CanvasSettingsIsolatedLayerPreviewSwitch";const iN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(Gb),s=u.useCallback(()=>{t(PK())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedStagingPreview")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})});iN.displayName="CanvasSettingsIsolatedStagingPreviewSwitch";const oN=u.memo(()=>{const{t:e}=P(),t=Tt(),n=u.useCallback(()=>{t.logDebugInfo()},[t]);return r.jsx(ye,{onClick:n,size:"sm",children:e("controlLayers.logDebugInfo")})});oN.displayName="CanvasSettingsLogDebugInfoButton";const aN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(EK),s=u.useCallback(()=>{t(LK())},[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.outputOnlyMaskedRegions")}),r.jsx(jn,{isChecked:n,onChange:s})]})});aN.displayName="CanvasSettingsOutputOnlyMaskedRegionsCheckbox";const lN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(aM),s=u.useCallback(()=>t(DK()),[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.settings.preserveMask.label")}),r.jsx(jn,{isChecked:n,onChange:s})]})});lN.displayName="CanvasSettingsPreserveMaskCheckbox";const cN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(RK),s=u.useCallback(()=>{t(OK())},[t]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,children:e("controlLayers.settings.pressureSensitivity")}),r.jsx(jn,{isChecked:n,onChange:s})]})});cN.displayName="CanvasSettingsPressureSensitivityCheckbox";const uN=u.memo(()=>{const{t:e}=P(),t=Tt(),n=u.useCallback(()=>{for(const s of t.getAllAdapters())s.transformer.requestRectCalculation()},[t]);return r.jsx(ye,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.recalculateRects")})});uN.displayName="CanvasSettingsRecalculateRectsButton";const U1e=ve(Ta,e=>e.showHUD),dN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(U1e),s=u.useCallback(()=>{t(NK())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.showHUD")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})});dN.displayName="CanvasSettingsShowHUDSwitch";const hN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(Kb),s=u.useCallback(()=>{t(FK())},[t]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,flexGrow:1,children:e("controlLayers.showProgressOnCanvas")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})});hN.displayName="CanvasSettingsShowProgressOnCanvas";const fN=u.memo(()=>{const{t:e}=P();return r.jsxs(Vn,{isLazy:!0,children:[r.jsx(Yn,{children:r.jsx(ae,{"aria-label":e("common.settingsLabel"),icon:r.jsx(zu,{}),variant:"link",alignSelf:"stretch"})}),r.jsxs(Gn,{children:[r.jsx(_i,{}),r.jsx(Xn,{children:r.jsxs(T,{direction:"column",gap:2,children:[r.jsx(sN,{}),r.jsx(lN,{}),r.jsx(eN,{}),r.jsx(aN,{}),r.jsx(nN,{}),r.jsx(cN,{}),r.jsx(hN,{}),r.jsx(iN,{}),r.jsx(rN,{}),r.jsx(tN,{}),r.jsx(XO,{}),r.jsx(dN,{}),r.jsx(q1e,{})]})})]})]})});fN.displayName="CanvasSettingsPopover";const q1e=()=>Ma()?r.jsxs(r.Fragment,{children:[r.jsx(Et,{}),r.jsx(QO,{}),r.jsx(uN,{}),r.jsx(oN,{}),r.jsx(JO,{})]}):null,pN=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1},{r:255,g:90,b:94,a:1},{r:255,g:146,b:75,a:1},{r:255,g:202,b:59,a:1},{r:197,g:202,b:48,a:1},{r:138,g:201,b:38,a:1},{r:83,g:165,b:117,a:1},{r:23,g:130,b:196,a:1},{r:66,g:103,b:172,a:1},{r:107,g:76,b:147,a:1}],K1e=pN,Z1e=pN.map(({r:e,g:t,b:n})=>({r:e,g:t,b:n}));function Ba(){return(Ba=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function $p(e,t){if(e==null)return{};var n,s,i={},o=Object.keys(e);for(s=0;s<o.length;s++)t.indexOf(n=o[s])>=0||(i[n]=e[n]);return i}function If(e){var t=u.useRef(e),n=u.useRef(function(s){t.current&&t.current(s)});return t.current=e,n.current}var ju=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e<t?t:e},Qh=function(e){return"touches"in e},p2=function(e){return e&&e.ownerDocument.defaultView||self},N6=function(e,t,n){var s=e.getBoundingClientRect(),i=Qh(t)?function(o,a){for(var l=0;l<o.length;l++)if(o[l].identifier===a)return o[l];return o[0]}(t.touches,n):t;return{left:ju((i.pageX-(s.left+p2(e).pageXOffset))/s.width),top:ju((i.pageY-(s.top+p2(e).pageYOffset))/s.height)}},F6=function(e){!Qh(e)&&e.preventDefault()},Jw=me.memo(function(e){var t=e.onMove,n=e.onKey,s=$p(e,["onMove","onKey"]),i=u.useRef(null),o=If(t),a=If(n),l=u.useRef(null),c=u.useRef(!1),d=u.useMemo(function(){var g=function(x){F6(x),(Qh(x)?x.touches.length>0:x.buttons>0)&&i.current?o(N6(i.current,x,l.current)):y(!1)},m=function(){return y(!1)};function y(x){var C=c.current,v=p2(i.current),b=x?v.addEventListener:v.removeEventListener;b(C?"touchmove":"mousemove",g),b(C?"touchend":"mouseup",m)}return[function(x){var C=x.nativeEvent,v=i.current;if(v&&(F6(C),!function(S,w){return w&&!Qh(S)}(C,c.current)&&v)){if(Qh(C)){c.current=!0;var b=C.changedTouches||[];b.length&&(l.current=b[0].identifier)}v.focus(),o(N6(v,C,l.current)),y(!0)}},function(x){var C=x.which||x.keyCode;C<37||C>40||(x.preventDefault(),a({left:C===39?.05:C===37?-.05:0,top:C===40?.05:C===38?-.05:0}))},y]},[a,o]),h=d[0],f=d[1],p=d[2];return u.useEffect(function(){return p},[p]),me.createElement("div",Ba({},s,{onTouchStart:h,onMouseDown:h,className:"react-colorful__interactive",ref:i,onKeyDown:f,tabIndex:0,role:"slider"}))}),Vp=function(e){return e.filter(Boolean).join(" ")},ej=function(e){var t=e.color,n=e.left,s=e.top,i=s===void 0?.5:s,o=Vp(["react-colorful__pointer",e.className]);return me.createElement("div",{className:o,style:{top:100*i+"%",left:100*n+"%"}},me.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},Ls=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n},gN=function(e){var t=e.s,n=e.v,s=e.a,i=(200-t)*n/100;return{h:Ls(e.h),s:Ls(i>0&&i<200?t*n/100/(i<=100?i:200-i)*100:0),l:Ls(i/2),a:Ls(s,2)}},g2=function(e){var t=gN(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},qv=function(e){var t=gN(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},mN=function(e){var t=e.h,n=e.s,s=e.v,i=e.a;t=t/360*6,n/=100,s/=100;var o=Math.floor(t),a=s*(1-n),l=s*(1-(t-o)*n),c=s*(1-(1-t+o)*n),d=o%6;return{r:Ls(255*[s,l,a,a,c,s][d]),g:Ls(255*[c,s,s,l,a,a][d]),b:Ls(255*[a,a,c,s,s,l][d]),a:Ls(i,2)}},yN=function(e){var t=e.r,n=e.g,s=e.b,i=e.a,o=Math.max(t,n,s),a=o-Math.min(t,n,s),l=a?o===t?(n-s)/a:o===n?2+(s-t)/a:4+(t-n)/a:0;return{h:Ls(60*(l<0?l+6:l)),s:Ls(o?a/o*100:0),v:Ls(o/255*100),a:i}},vN=me.memo(function(e){var t=e.hue,n=e.onChange,s=Vp(["react-colorful__hue",e.className]);return me.createElement("div",{className:s},me.createElement(Jw,{onMove:function(i){n({h:360*i.left})},onKey:function(i){n({h:ju(t+360*i.left,0,360)})},"aria-label":"Hue","aria-valuenow":Ls(t),"aria-valuemax":"360","aria-valuemin":"0"},me.createElement(ej,{className:"react-colorful__hue-pointer",left:t/360,color:g2({h:t,s:100,v:100,a:1})})))}),bN=me.memo(function(e){var t=e.hsva,n=e.onChange,s={backgroundColor:g2({h:t.h,s:100,v:100,a:1})};return me.createElement("div",{className:"react-colorful__saturation",style:s},me.createElement(Jw,{onMove:function(i){n({s:100*i.left,v:100-100*i.top})},onKey:function(i){n({s:ju(t.s+100*i.left,0,100),v:ju(t.v-100*i.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+Ls(t.s)+"%, Brightness "+Ls(t.v)+"%"},me.createElement(ej,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:g2(t)})))}),tj=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0};function xN(e,t,n){var s=If(n),i=u.useState(function(){return e.toHsva(t)}),o=i[0],a=i[1],l=u.useRef({color:t,hsva:o});u.useEffect(function(){if(!e.equal(t,l.current.color)){var d=e.toHsva(t);l.current={hsva:d,color:t},a(d)}},[t,e]),u.useEffect(function(){var d;tj(o,l.current.hsva)||e.equal(d=e.fromHsva(o),l.current.color)||(l.current={hsva:o,color:d},s(d))},[o,e,s]);var c=u.useCallback(function(d){a(function(h){return Object.assign({},h,d)})},[]);return[o,c]}var Y1e=typeof window<"u"?u.useLayoutEffect:u.useEffect,X1e=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},B6=new Map,CN=function(e){Y1e(function(){var t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!B6.has(t)){var n=t.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,B6.set(t,n);var s=X1e();s&&n.setAttribute("nonce",s),t.head.appendChild(n)}},[])},Q1e=function(e){var t=e.className,n=e.colorModel,s=e.color,i=s===void 0?n.defaultColor:s,o=e.onChange,a=$p(e,["className","colorModel","color","onChange"]),l=u.useRef(null);CN(l);var c=xN(n,i,o),d=c[0],h=c[1],f=Vp(["react-colorful",t]);return me.createElement("div",Ba({},a,{ref:l,className:f}),me.createElement(bN,{hsva:d,onChange:h}),me.createElement(vN,{hue:d.h,onChange:h,className:"react-colorful__last-control"}))},J1e=function(e){var t=e.className,n=e.hsva,s=e.onChange,i={backgroundImage:"linear-gradient(90deg, "+qv(Object.assign({},n,{a:0}))+", "+qv(Object.assign({},n,{a:1}))+")"},o=Vp(["react-colorful__alpha",t]),a=Ls(100*n.a);return me.createElement("div",{className:o},me.createElement("div",{className:"react-colorful__alpha-gradient",style:i}),me.createElement(Jw,{onMove:function(l){s({a:l.left})},onKey:function(l){s({a:ju(n.a+l.left)})},"aria-label":"Alpha","aria-valuetext":a+"%","aria-valuenow":a,"aria-valuemin":"0","aria-valuemax":"100"},me.createElement(ej,{className:"react-colorful__alpha-pointer",left:n.a,color:qv(n)})))},eye=function(e){var t=e.className,n=e.colorModel,s=e.color,i=s===void 0?n.defaultColor:s,o=e.onChange,a=$p(e,["className","colorModel","color","onChange"]),l=u.useRef(null);CN(l);var c=xN(n,i,o),d=c[0],h=c[1],f=Vp(["react-colorful",t]);return me.createElement("div",Ba({},a,{ref:l,className:f}),me.createElement(bN,{hsva:d,onChange:h}),me.createElement(vN,{hue:d.h,onChange:h}),me.createElement(J1e,{hsva:d,onChange:h,className:"react-colorful__last-control"}))},tye={defaultColor:{r:0,g:0,b:0,a:1},toHsva:yN,fromHsva:mN,equal:tj},SN=function(e){return me.createElement(eye,Ba({},e,{colorModel:tye}))},nye={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return yN({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(t=mN(e)).r,g:t.g,b:t.b};var t},equal:tj},sye=function(e){return me.createElement(Q1e,Ba({},e,{colorModel:nye}))},rye=/^#?([0-9A-F]{3,8})$/i,iye=function(e){var t=e.color,n=t===void 0?"":t,s=e.onChange,i=e.onBlur,o=e.escape,a=e.validate,l=e.format,c=e.process,d=$p(e,["color","onChange","onBlur","escape","validate","format","process"]),h=u.useState(function(){return o(n)}),f=h[0],p=h[1],g=If(s),m=If(i),y=u.useCallback(function(C){var v=o(C.target.value);p(v),a(v)&&g(c?c(v):v)},[o,c,a,g]),x=u.useCallback(function(C){a(C.target.value)||p(o(n)),m(C)},[n,o,a,m]);return u.useEffect(function(){p(o(n))},[n,o]),me.createElement("input",Ba({},d,{value:l?l(f):f,spellCheck:"false",onChange:y,onBlur:x}))},$6=function(e){return"#"+e},oye=function(e){var t=e.prefixed,n=e.alpha,s=$p(e,["prefixed","alpha"]),i=u.useCallback(function(a){return a.replace(/([^0-9A-F]+)/gi,"").substring(0,n?8:6)},[n]),o=u.useCallback(function(a){return function(l,c){var d=rye.exec(l),h=d?d[1].length:0;return h===3||h===6||!!c&&h===4||!!c&&h===8}(a,n)},[n]);return me.createElement(iye,Ba({},s,{escape:i,format:t?$6:void 0,process:$6,validate:o}))};const Kv={width:6,height:6,borderColor:"base.100"},aye={".react-colorful__hue-pointer":Kv,".react-colorful__saturation-pointer":Kv,".react-colorful__alpha-pointer":Kv,gap:4,flexDir:"column"},lye={width:"100%"},Vg="3.5rem",cye=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:i=!1}=e,{t:o}=P(),a=u.useCallback(h=>n({...t,r:h}),[t,n]),l=u.useCallback(h=>n({...t,g:h}),[t,n]),c=u.useCallback(h=>n({...t,b:h}),[t,n]),d=u.useCallback(h=>n({...t,a:h}),[t,n]);return r.jsxs(T,{sx:aye,children:[r.jsx(SN,{color:t,onChange:n,style:lye}),s&&r.jsxs(T,{gap:2,children:[r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.red")[0]}),r.jsx(Ae,{value:t.r,onChange:a,min:0,max:255,step:1,w:Vg,defaultValue:90})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.green")[0]}),r.jsx(Ae,{value:t.g,onChange:l,min:0,max:255,step:1,w:Vg,defaultValue:90})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.blue")[0]}),r.jsx(Ae,{value:t.b,onChange:c,min:0,max:255,step:1,w:Vg,defaultValue:255})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.alpha")[0]}),r.jsx(Ae,{value:t.a,onChange:d,step:.1,min:0,max:1,w:Vg,defaultValue:1})]})]}),i&&r.jsx(T,{gap:2,justifyContent:"space-between",children:K1e.map((h,f)=>r.jsx(uye,{color:h,onChange:n},f))})]})},wN=u.memo(cye),uye=({color:e,onChange:t})=>{const n=u.useCallback(()=>{t(e)},[e,t]);return r.jsx(ke,{role:"button",onClick:n,h:8,w:8,bg:Oo(e),borderRadius:"base"})},dye=ve(Ta,e=>e.color),jN=u.memo(()=>{const{t:e}=P(),t=I(dye),n=z(),s=u.useCallback(o=>{n(Yb(o))},[n]),i=Lt();return Ee({id:"setFillToWhite",category:"canvas",callback:()=>n(Yb({r:255,g:255,b:255,a:1})),options:{preventDefault:!0,enabled:!i.isOpen},dependencies:[n,i.isOpen]}),r.jsxs(Vn,{isLazy:!0,children:[r.jsx(Yn,{children:r.jsx(T,{role:"button","aria-label":e("controlLayers.fill.fillColor"),tabIndex:-1,w:8,h:8,children:r.jsx(Le,{label:e("controlLayers.fill.fillColor"),children:r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(ke,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Oo(t)})})})})}),r.jsxs(Gn,{children:[r.jsx(_i,{}),r.jsx(Xn,{minH:64,children:r.jsx(wN,{color:t,onChange:s,withNumberInput:!0,withSwatches:!0})})]})]})});jN.displayName="ToolFillColorPicker";const qo=e=>{const t=Tt();return ce(gs(t.tool.$tool,s=>s===e))},Jl=e=>{const t=Tt();return u.useCallback(()=>{t.tool.$tool.set(e)},[t.tool.$tool,e])},hye=ve(Ta,e=>e.brushWidth),fye=e=>`${e} px`;function kN(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function Hc(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function pye(e){return`${String(kN(e))} px`}const gye=[Hc(1),Hc(50),Hc(200),Hc(600)],mye=Hc(50),_N=u.memo(()=>{const e=z(),{t}=P(),n=Lt(),s=qo("brush"),i=I(hye),[o,a]=u.useState(i),l=u.useCallback(m=>{e(RM(to(Math.round(m),1,600)))},[e]),c=u.useCallback(()=>{let m=Math.round(i*1.15);m===i&&(m+=1),l(m)},[l,i]),d=u.useCallback(()=>{let m=Math.round(i*.85);m===i&&(m-=1),l(m)},[l,i]),h=u.useCallback(m=>{l(kN(m))},[l]),f=u.useCallback(()=>{isNaN(Number(o))?(l(50),a(50)):l(o)},[o,l]),p=u.useCallback((m,y)=>{a(y)},[]),g=u.useCallback(m=>{m.key==="Enter"&&f()},[f]);return u.useEffect(()=>{a(i)},[i]),Ee({id:"decrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),Ee({id:"incrementToolWidth",category:"canvas",callback:c,options:{enabled:s&&!n.isOpen},dependencies:[c,s,n.isOpen]}),r.jsxs(Vn,{children:[r.jsxs(Z,{w:"min-content",gap:2,children:[r.jsx(te,{m:0,children:t("controlLayers.width")}),r.jsx(np,{children:r.jsxs(e1,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:o,onChange:p,onBlur:f,w:"76px",format:fye,defaultValue:50,onKeyDown:g,clampValueOnBlur:!1,children:[r.jsx(t1,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),r.jsx(Yn,{children:r.jsx(ae,{"aria-label":"open-slider",icon:r.jsx(Pr,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),r.jsxs(Gn,{w:200,pt:0,pb:2,px:4,children:[r.jsx(_i,{}),r.jsx(Xn,{children:r.jsx(qe,{min:0,max:100,value:Hc(o),onChange:h,defaultValue:mye,marks:gye,formatValue:pye,alwaysShowMarks:!0})})]})]})});_N.displayName="ToolBrushWidth";const yye=ve(Ta,e=>e.eraserWidth),vye=e=>`${e} px`;function IN(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function Wc(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function bye(e){return`${String(IN(e))} px`}const xye=[Wc(1),Wc(50),Wc(200),Wc(600)],Cye=Wc(50),AN=u.memo(()=>{const e=z(),{t}=P(),n=Lt(),s=qo("eraser"),i=I(yye),[o,a]=u.useState(i),l=u.useCallback(m=>{e(OM(to(Math.round(m),1,600)))},[e]),c=u.useCallback(()=>{let m=Math.round(i*1.15);m===i&&(m+=1),l(m)},[l,i]),d=u.useCallback(()=>{let m=Math.round(i*.85);m===i&&(m-=1),l(m)},[l,i]),h=u.useCallback(m=>{l(IN(m))},[l]),f=u.useCallback(()=>{isNaN(Number(o))?(l(50),a(50)):l(o)},[o,l]),p=u.useCallback((m,y)=>{a(y)},[]),g=u.useCallback(m=>{m.key==="Enter"&&f()},[f]);return u.useEffect(()=>{a(i)},[i]),Ee({id:"decrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),Ee({id:"incrementToolWidth",category:"canvas",callback:c,options:{enabled:s&&!n.isOpen},dependencies:[c,s,n.isOpen]}),r.jsxs(Vn,{children:[r.jsxs(Z,{w:"min-content",gap:2,children:[r.jsx(te,{m:0,children:t("controlLayers.width")}),r.jsx(np,{children:r.jsxs(e1,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:o,onChange:p,onBlur:f,w:"76px",format:vye,defaultValue:50,onKeyDown:g,clampValueOnBlur:!1,children:[r.jsx(t1,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),r.jsx(Yn,{children:r.jsx(ae,{"aria-label":"open-slider",icon:r.jsx(Pr,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),r.jsxs(Gn,{w:200,pt:0,pb:2,px:4,children:[r.jsx(_i,{}),r.jsx(Xn,{children:r.jsx(qe,{min:0,max:100,value:Wc(o),onChange:h,defaultValue:Cye,marks:xye,formatValue:bye,alwaysShowMarks:!0})})]})]})});AN.displayName="ToolEraserWidth";const TN=u.memo(()=>{const e=Tt(),t=ce(e.tool.$tool);return t==="brush"?r.jsx(_N,{}):t==="eraser"?r.jsx(AN,{}):null});TN.displayName="ToolSettings";const MN=u.memo(()=>{const{t:e}=P(),t=Tt(),n=tt(),s=u.useCallback(()=>{t.tool.tools.bbox.fitToLayers()},[t.tool.tools.bbox]);return r.jsx(ae,{onClick:s,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.fitBboxToLayers"),tooltip:e("controlLayers.fitBboxToLayers"),icon:r.jsx(Noe,{}),isDisabled:n})});MN.displayName="CanvasToolbarFitBboxToLayersButton";const nj=u.memo(()=>{const{t:e}=P(),t=z(),{newGallerySessionWithDialog:n}=XE(),{newCanvasSessionWithDialog:s}=QE(),i=u.useCallback(()=>{t(BK())},[t]),o=u.useCallback(()=>{t($K())},[t]);return r.jsxs(r.Fragment,{children:[r.jsx(he,{icon:r.jsx(uf,{}),onClick:n,children:e("controlLayers.newGallerySession")}),r.jsx(he,{icon:r.jsx(uf,{}),onClick:s,children:e("controlLayers.newCanvasSession")}),r.jsx(he,{icon:r.jsx(Bm,{}),onClick:i,children:e("controlLayers.resetCanvasLayers")}),r.jsx(he,{icon:r.jsx(Bm,{}),onClick:o,children:e("controlLayers.resetGenerationSettings")})]})});nj.displayName="SessionMenuItems";const PN=u.memo(()=>{const{t:e}=P();return r.jsxs(Qt,{placement:"bottom-end",children:[r.jsx(Jt,{as:ae,"aria-label":e("controlLayers.newSession"),icon:r.jsx(uf,{}),variant:"link",alignSelf:"stretch"}),r.jsx(kt,{children:r.jsx(nj,{})})]})});PN.displayName="CanvasToolbarNewSessionMenuButton";const EN=u.memo(()=>{const{t:e}=P(),t=z(),n=tt(),s=I(BM),i=u.useCallback(()=>{t($M())},[t]);return r.jsx(ae,{"aria-label":e("hotkeys.canvas.redo.title"),tooltip:e("hotkeys.canvas.redo.title"),onClick:i,icon:r.jsx(toe,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});EN.displayName="CanvasToolbarRedoButton";const LN=u.memo(()=>{const{t:e}=P(),t=Tt(),n=Ds("canvas"),s=Lt();return Ee({id:"fitLayersToCanvas",category:"canvas",callback:t.stage.fitLayersToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ee({id:"fitBboxToCanvas",category:"canvas",callback:t.stage.fitBboxToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ee({id:"setZoomTo100Percent",category:"canvas",callback:()=>t.stage.setScale(1),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ee({id:"setZoomTo200Percent",category:"canvas",callback:()=>t.stage.setScale(2),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ee({id:"setZoomTo400Percent",category:"canvas",callback:()=>t.stage.setScale(4),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ee({id:"setZoomTo800Percent",category:"canvas",callback:()=>t.stage.setScale(8),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),r.jsx(ae,{tooltip:e("hotkeys.canvas.fitLayersToCanvas.title"),"aria-label":e("hotkeys.canvas.fitLayersToCanvas.title"),onClick:t.stage.fitLayersToStage,icon:r.jsx(I1,{}),variant:"link",alignSelf:"stretch"})});LN.displayName="CanvasToolbarResetViewButton";const DN=u.memo(()=>{const{t:e}=P(),t=Ma(),n=tt(),s=I9(),i=A9();return r.jsx(ae,{variant:"link",alignSelf:"stretch",onClick:t?i:s,icon:r.jsx(Ui,{}),"aria-label":e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),tooltip:e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),isDisabled:n})});DN.displayName="CanvasToolbarSaveToGalleryButton";function Sye(e){return isNaN(Number(e))?"":`${sp(Number(e),2).toLocaleString()}%`}function RN(e){return e<=40?10+90*e/40:e<=70?100+400*(e-40)/30:500+1500*(e-70)/30}function sl(e){return e<=100?(e-10)*40/90:e<=500?40+(e-100)*30/400:70+(e-500)*30/1500}function wye(e){return String(RN(e))}const m2=[sl(10),sl(50),sl(100),sl(500),sl(2e3)],jye=sl(100),kye=m2.slice(1,m2.length-1),ON=u.memo(()=>{const e=Tt(),t=ce(gs(e.stage.$stageAttrs,c=>c.scale)),[n,s]=u.useState(t*100),i=u.useCallback(c=>{let d=c;kC.get()||(d=VM(c,kye,2));const h=RN(d);e.stage.setScale(h/100)},[e]),o=u.useCallback(()=>{if(isNaN(Number(n))){e.stage.setScale(1),s(100);return}e.stage.setScale(n/100)},[e,n]),a=u.useCallback((c,d)=>{s(d)},[]),l=u.useCallback(c=>{c.key==="Enter"&&o()},[o]);return u.useEffect(()=>{s(t*100)},[t]),r.jsxs(T,{alignItems:"center",children:[r.jsx(_ye,{}),r.jsxs(Vn,{children:[r.jsx(np,{children:r.jsxs(e1,{variant:"outline",display:"flex",alignItems:"center",min:e.stage.config.MIN_SCALE*100,max:e.stage.config.MAX_SCALE*100,value:n,onChange:a,onBlur:o,w:"76px",format:Sye,defaultValue:100,onKeyDown:l,clampValueOnBlur:!1,children:[r.jsx(t1,{paddingInlineEnd:7,title:"",_focusVisible:{zIndex:0}}),r.jsx(Yn,{children:r.jsx(ae,{"aria-label":"open-slider",icon:r.jsx(Pr,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})}),r.jsxs(Gn,{w:200,pt:0,pb:2,px:4,children:[r.jsx(_i,{}),r.jsx(Xn,{children:r.jsx(qe,{min:0,max:100,value:sl(n),onChange:i,defaultValue:jye,marks:m2,formatValue:wye,alwaysShowMarks:!0})})]})]}),r.jsx(Iye,{})]})});ON.displayName="CanvasToolbarScale";const NN=[.1,.15,.2,.25,.5,.75,1,1.5,2,2.5,5,7.5,10,15,20],_ye=()=>{const e=Tt(),t=ce(gs(e.stage.$stageAttrs,s=>s.scale)),n=u.useCallback(()=>{const s=NN.slice().reverse().find(i=>i<t)??e.stage.config.MIN_SCALE;e.stage.setScale(Math.max(s,e.stage.config.MIN_SCALE))},[e.stage,t]);return r.jsx(ae,{onClick:n,icon:r.jsx(PE,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t<=e.stage.config.MIN_SCALE})},Iye=()=>{const e=Tt(),t=ce(gs(e.stage.$stageAttrs,s=>s.scale)),n=u.useCallback(()=>{const s=NN.find(i=>i>t)??e.stage.config.MAX_SCALE;e.stage.setScale(Math.min(s,e.stage.config.MAX_SCALE))},[e.stage,t]);return r.jsx(ae,{onClick:n,icon:r.jsx(EE,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t>=e.stage.config.MAX_SCALE})},FN=u.memo(()=>{const{t:e}=P(),t=z(),n=tt(),s=I(GM),i=u.useCallback(()=>{t(zM())},[t]);return r.jsx(ae,{"aria-label":e("hotkeys.canvas.undo.title"),tooltip:e("hotkeys.canvas.undo.title"),onClick:i,icon:r.jsx(ho,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});FN.displayName="CanvasToolbarUndoButton";function BN(){wt(BN.name);const e=z(),t=I(kn),n=tt(),s=I(cf),i=I(On),o=Lt(),a=u.useCallback(()=>{t!==null&&e(SC({entityIdentifier:t}))},[e,t]),l=u.useMemo(()=>t!==null&&!n&&s==="layers"&&i==="canvas",[t,n,s,i]);Ee({id:"deleteSelected",category:"canvas",callback:a,options:{enabled:l&&!o.isOpen},dependencies:[l,a,o.isOpen]})}const Aye=()=>{const e=z(),[t,n]=u.useState(null),[s,i]=u.useState(null),o=I(kn),a=I(VK),l=Lt();u.useEffect(()=>{(s==null?void 0:s.id)!==(o==null?void 0:o.id)&&(n(s),i(o))},[s,o]);const c=u.useCallback(()=>{a?(s==null?void 0:s.id)!==a.id?(n(s),i(a),e(Zc({entityIdentifier:a}))):t&&(i(t),e(Zc({entityIdentifier:t}))):t!==null&&s!==null&&(n(s),i(t),e(Zc({entityIdentifier:t})))},[a,s,e,t]);Ee({id:"quickSwitch",category:"canvas",callback:c,options:{enabled:!l.isOpen},dependencies:[c,l.isOpen]})},Tye=()=>{wt("useCanvasFilterHotkey");const e=I(kn),t=sy(e);Ee({id:"filterSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})};function $N(){wt($N.name);const e=z(),t=I(kn),n=tt(),s=po(t),i=Ii(t),o=Lt(),a=u.useCallback(()=>{t===null||s===null||(s.bufferRenderer.clearBuffer(),e(DM({entityIdentifier:t})))},[s,e,t]),l=u.useMemo(()=>t!==null&&Xb(t),[t]);Ee({id:"resetSelected",category:"canvas",callback:a,options:{enabled:l&&!n&&!i&&!o.isOpen},dependencies:[l,n,i,a,o.isOpen]})}const Mye=()=>{wt("useCanvasTransformHotkey");const e=I(kn),t=zw(e);Ee({id:"transformSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})},Pye=()=>{wt("useCanvasUndoRedo");const e=IC(),t=tt(),n=Lt(),s=I(GM),i=u.useCallback(()=>{e(zM())},[e]);Ee({id:"undo",category:"canvas",callback:i,options:{enabled:s&&!t&&!n.isOpen,preventDefault:!0},dependencies:[s,t,i,n.isOpen]});const o=I(BM),a=u.useCallback(()=>{e($M())},[e]);Ee({id:"redo",category:"canvas",callback:a,options:{enabled:o&&!t&&!n.isOpen,preventDefault:!0},dependencies:[o,a,t,n.isOpen]})},Eye=It(Je,e=>{const t=e.selectedEntityIdentifier,n=HM(e);let s=null;if(!t)s=n[0]??null;else{const i=n.findIndex(o=>o.id===t.id);s=n[(i+1)%n.length]??null}return s?qs(s):null}),Lye=It(Je,e=>{const t=e.selectedEntityIdentifier,n=HM(e);let s=null;if(!t)s=n[0]??null;else{const i=n.findIndex(o=>o.id===t.id);s=n[(i-1+n.length)%n.length]??null}return s?qs(s):null}),Dye=()=>{wt("useNextPrevEntityHotkeys");const e=z(),t=I(Eye),n=I(Lye),s=u.useCallback(()=>{t&&e(Zc({entityIdentifier:t}))},[e,t]),i=u.useCallback(()=>{n&&e(Zc({entityIdentifier:n}))},[e,n]);Si(["“"],i,{preventDefault:!0,ignoreModifiers:!0},[i]),Ee({category:"canvas",id:"prevEntity",callback:i,options:{preventDefault:!0},dependencies:[i]}),Si(["‘"],s,{preventDefault:!0,ignoreModifiers:!0},[s]),Ee({category:"canvas",id:"nextEntity",callback:s,options:{preventDefault:!0},dependencies:[s]})},VN=u.memo(()=>($N(),BN(),Pye(),Aye(),Dye(),Mye(),Tye(),r.jsxs(T,{w:"full",gap:2,alignItems:"center",children:[r.jsx(jN,{}),r.jsx(TN,{}),r.jsx(nt,{}),r.jsxs(T,{alignItems:"center",h:"full",children:[r.jsx(ON,{}),r.jsx(LN,{}),r.jsx(MN,{})]}),r.jsx(Et,{orientation:"vertical"}),r.jsxs(T,{alignItems:"center",h:"full",children:[r.jsx(DN,{}),r.jsx(FN,{}),r.jsx(EN,{}),r.jsx(PN,{}),r.jsx(fN,{})]})]})));VN.displayName="CanvasToolbar";const Rye=$e.enum(["fill","contain","cover"]),GN=u.memo(({adapter:e})=>{const{t}=P(),[n,s]=u.useState("contain"),i=ce(e.transformer.$isProcessing),o=u.useCallback(()=>{if(n==="contain"){e.transformer.fitToBboxContain();return}if(n==="cover"){e.transformer.fitToBboxCover();return}if(n==="fill"){e.transformer.fitToBboxFill();return}Re(!1)},[e.transformer,n]),a=u.useMemo(()=>[{value:"contain",label:t("controlLayers.transform.fitModeContain")},{value:"cover",label:t("controlLayers.transform.fitModeCover")},{value:"fill",label:t("controlLayers.transform.fitModeFill")}],[t]),l=u.useMemo(()=>a.find(d=>d.value===n)??null,[a,n]),c=u.useCallback(d=>{d&&s(Rye.parse(d.value))},[]);return r.jsxs(T,{gap:4,w:"full",children:[r.jsxs(Z,{maxW:64,children:[r.jsx(te,{m:0,children:t("controlLayers.transform.fitMode")}),r.jsx(Fe,{options:a,value:l,onChange:c,isSearchable:!1,isClearable:!1})]}),r.jsx(ye,{size:"sm",onClick:o,isDisabled:i,loadingText:t("controlLayers.transform.fitToBbox"),variant:"ghost",children:t("controlLayers.transform.fitToBbox")})]})});GN.displayName="TransformFitToBboxButtons";const zN=u.memo(({adapter:e})=>{const{t}=P(),n=u.useRef(null);Go("canvas",n,{focusOnMount:!0});const s=Ds("canvas"),i=ce(e.transformer.$isProcessing),o=ce(e.transformer.$silentTransform);return Ee({id:"applyTransform",category:"canvas",callback:e.transformer.applyTransform,options:{enabled:!i&&s},dependencies:[e.transformer,i,s]}),Ee({id:"cancelTransform",category:"canvas",callback:e.transformer.stopTransform,options:{enabled:!i&&s},dependencies:[e.transformer,i,s]}),o?null:r.jsxs(T,{ref:n,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[r.jsxs(T,{w:"full",gap:4,children:[r.jsx(Ot,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.transform.transform")}),r.jsx(nt,{}),r.jsx(ry,{})]}),r.jsx(GN,{adapter:e}),r.jsxs(as,{isAttached:!1,size:"sm",w:"full",alignItems:"center",children:[i&&r.jsx(or,{ms:3,boxSize:5,color:"base.600"}),r.jsx(nt,{}),r.jsx(ye,{onClick:e.transformer.resetTransform,isDisabled:i,loadingText:t("controlLayers.transform.reset"),variant:"ghost",children:t("controlLayers.transform.reset")}),r.jsx(ye,{onClick:e.transformer.applyTransform,isDisabled:i,loadingText:t("controlLayers.transform.apply"),variant:"ghost",children:t("controlLayers.transform.apply")}),r.jsx(ye,{onClick:e.transformer.stopTransform,isDisabled:i,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.transform.cancel")})]})]})});zN.displayName="TransformContent";const Oye=()=>{const e=Tt(),t=ce(e.stateApi.$transformingAdapter);return t?r.jsx(zN,{adapter:t}):null},HN=u.memo(()=>{const{t:e}=P(),t=z(),n=I(WM),s=I(AC),i=u.useCallback(()=>{t(Vy("slider"))},[t]),o=u.useCallback(()=>{t(Vy("side-by-side"))},[t]),a=u.useCallback(()=>{t(Vy("hover"))},[t]),l=u.useCallback(()=>{t(GK())},[t]);Ee({id:"swapImages",category:"viewer",callback:l,dependencies:[l]});const c=u.useCallback(()=>{t(zK(s==="contain"?"fill":"contain"))},[t,s]),d=u.useCallback(()=>{t(Pu(null))},[t]);Si("esc",d,[d]);const h=u.useCallback(()=>{t(HK())},[t]);return Ee({id:"nextComparisonMode",category:"viewer",callback:h,dependencies:[h]}),r.jsxs(T,{w:"full",px:2,gap:2,bg:"base.750",borderTopRadius:"base",h:12,children:[r.jsx(T,{flex:1,justifyContent:"center",children:r.jsxs(T,{marginInlineEnd:"auto",alignItems:"center",children:[r.jsx(ae,{icon:r.jsx(coe,{}),"aria-label":`${e("gallery.swapImages")} (C)`,tooltip:`${e("gallery.swapImages")} (C)`,onClick:l,variant:"link",alignSelf:"stretch"}),n!=="side-by-side"&&r.jsx(ae,{"aria-label":e("gallery.stretchToFit"),tooltip:e("gallery.stretchToFit"),onClick:c,colorScheme:s==="fill"?"invokeBlue":"base",variant:"link",alignSelf:"stretch",icon:r.jsx(I1,{})})]})}),r.jsx(T,{flex:1,justifyContent:"center",children:r.jsxs(as,{variant:"outline",alignItems:"center",children:[r.jsx(ye,{flexShrink:0,onClick:i,colorScheme:n==="slider"?"invokeBlue":"base",children:e("gallery.slider")}),r.jsx(ye,{flexShrink:0,onClick:o,colorScheme:n==="side-by-side"?"invokeBlue":"base",children:e("gallery.sideBySide")}),r.jsx(ye,{flexShrink:0,onClick:a,colorScheme:n==="hover"?"invokeBlue":"base",children:e("gallery.hover")})]})}),r.jsx(T,{flex:1,justifyContent:"center",children:r.jsxs(T,{gap:2,marginInlineStart:"auto",alignItems:"center",children:[r.jsx(Le,{label:r.jsx(Nye,{}),children:r.jsx(T,{alignItems:"center",children:r.jsx(pt,{boxSize:6,color:"base.300",as:sae,lineHeight:0})})}),r.jsx(ye,{variant:"link",alignSelf:"stretch",px:2,"aria-label":`${e("gallery.exitCompare")} (Esc)`,tooltip:`${e("gallery.exitCompare")} (Esc)`,onClick:d,children:e("gallery.exitCompare")})]})})]})});HN.displayName="CompareToolbar";const Nye=()=>r.jsxs(ki,{children:[r.jsx(Gt,{children:r.jsx(Xt,{i18nKey:"gallery.compareHelp1",components:{Kbd:r.jsx(Th,{})}})}),r.jsx(Gt,{children:r.jsx(Xt,{i18nKey:"gallery.compareHelp2",components:{Kbd:r.jsx(Th,{})}})}),r.jsx(Gt,{children:r.jsx(Xt,{i18nKey:"gallery.compareHelp3",components:{Kbd:r.jsx(Th,{})}})}),r.jsx(Gt,{children:r.jsx(Xt,{i18nKey:"gallery.compareHelp4",components:{Kbd:r.jsx(Th,{})}})})]}),Fye=()=>{const{t:e}=P(),t=ce(UM),[n,s]=u.useState(null);return u.useEffect(()=>{if(!t){s(null);return}if(t&&!t.startsWith("Loading model")){s(null);return}const i=setTimeout(()=>{s(`${e("common.loadingModel")}...`)},5e3);return()=>clearTimeout(i)},[t,e]),n},WN=u.memo(()=>{const{t:e}=P(),t=ce(UM);return t?r.jsxs(zl,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(Hl,{}),r.jsx(K0,{children:e("common.generating")}),r.jsx(Qf,{children:t})]}):null});WN.displayName="CanvasAlertsInvocationProgressContentLocal";const UN=u.memo(()=>{const e=Fye();return e?r.jsxs(zl,{status:"loading",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",children:[r.jsx(Hl,{}),r.jsx(Qf,{children:e})]}):null});UN.displayName="CanvasAlertsInvocationProgressContentCommercial";const sj=u.memo(()=>{const e=I(qM);return I(KM)?e?r.jsx(WN,{}):null:r.jsx(UN,{})});sj.displayName="CanvasAlertsInvocationProgress";function Bye(){return{x:0,y:0}}function qN(e){var t=e.render,n=e.nativeSetDragImage,s=e.getOffset,i=s===void 0?Bye:s,o=document.createElement("div");Object.assign(o.style,{position:"fixed",top:0,left:0,zIndex:mL,pointerEvents:"none"}),document.body.append(o);var a=t({container:o});queueMicrotask(function(){var d=i({container:o});if(Hu()){var h=o.getBoundingClientRect();if(h.width===0)return;o.style.left="-".concat(h.width-1e-4,"px")}n==null||n(o,d.x,d.y)});function l(){c(),a==null||a(),document.body.removeChild(o)}var c=qi({onDragStart:l,onDrop:l})}const w0=32;function KN({element:e,input:t}){return({container:n})=>{const s=e.getBoundingClientRect(),i=n.getBoundingClientRect();let o=t.clientX-s.x,a=t.clientY-s.y;return(a>i.height||o>i.width)&&(o=i.width/2,a=i.height/2),{x:o,y:a}}}function ZN(e,t){e.animate([{backgroundColor:t},{}],{duration:700,easing:"cubic-bezier(0.25, 0.1, 0.25, 1.0)",iterations:1})}const nd=e=>{if(!navigator.userAgent.includes("Firefox"))return AM;const t=new AbortController;return e.addEventListener("mouseover",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","false")},{signal:t.signal}),e.addEventListener("mouseout",n=>{(n.target instanceof HTMLTextAreaElement||n.target instanceof HTMLInputElement)&&e.setAttribute("draggable","true")},{signal:t.signal}),()=>{e.setAttribute("draggable","true"),t.abort()}},$ye=$o("img"),YN=u.memo(({imageDTO:e})=>r.jsx(T,{w:w0,h:w0,children:r.jsx($ye,{margin:"auto",maxW:"full",maxH:"full",objectFit:"contain",borderRadius:"base",src:e.thumbnail_url})}));YN.displayName="DndDragPreviewSingleImage";const XN=e=>Wl.createPortal(r.jsx(YN,{imageDTO:e.imageDTO}),e.container),QN=({singleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:i,location:o}=t;qN({render({container:a}){return n({type:"single-image",container:a,imageDTO:e.payload.imageDTO}),()=>n(null)},nativeSetDragImage:s,getOffset:KN({element:i.element,input:o.current.input})})},Vye={objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base",cursor:"grab","&[data-is-dragging=true]":{opacity:.3}},$a=u.memo(({imageDTO:e,asThumbnail:t,...n})=>{const s=sr(),[i,o]=u.useState(!1),[a,l]=u.useState(null),[c,d]=u.useState(null);return u.useEffect(()=>{if(a)return Kn(nd(a),Wu({element:a,getInitialData:()=>wn.getData({imageDTO:e},e.image_name),onDragStart:()=>{o(!0)},onDrop:()=>{o(!1)},onGenerateDragPreview:h=>{wn.typeGuard(h.source.data)&&QN({singleImageDndData:h.source.data,onGenerateDragPreviewArgs:h,setDragPreviewState:d})}}))},[e,a,s]),PD(e,a),r.jsxs(r.Fragment,{children:[r.jsx(dn,{role:"button",ref:l,src:t?e.thumbnail_url:e.image_url,fallbackSrc:t?void 0:e.thumbnail_url,w:e.width,sx:Vye,"data-is-dragging":i,...n}),(c==null?void 0:c.type)==="single-image"?XN(c):null]})});$a.displayName="DndImage";const JN=e=>{const t=I(WK),[n]=Zl(e!=null&&e.has_workflow?e.image_name:null,t);return UK(n??ws)};var Zv={},dh={},Yv={},V6;function rj(){return V6||(V6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EolStyle=void 0,function(t){t[t.Crlf=0]="Crlf",t[t.Lf=1]="Lf"}(e.EolStyle||(e.EolStyle={}))}(Yv)),Yv}var Xv={},G6;function ij(){return G6||(G6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CommentPolicy=void 0,function(t){t[t.TreatAsError=0]="TreatAsError",t[t.Remove=1]="Remove",t[t.Preserve=2]="Preserve"}(e.CommentPolicy||(e.CommentPolicy={}))}(Xv)),Xv}var Qv={},z6;function oj(){return z6||(z6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NumberListAlignment=void 0,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Decimal=2]="Decimal",t[t.Normalize=3]="Normalize"}(e.NumberListAlignment||(e.NumberListAlignment={}))}(Qv)),Qv}var H6;function aj(){if(H6)return dh;H6=1,Object.defineProperty(dh,"__esModule",{value:!0}),dh.FracturedJsonOptions=void 0;const e=rj(),t=ij(),n=oj();let s=class{constructor(){this.JsonEolStyle=e.EolStyle.Lf,this.MaxInlineLength=2e9,this.MaxTotalLineLength=120,this.MaxInlineComplexity=2,this.MaxCompactArrayComplexity=1,this.MaxTableRowComplexity=2,this.MinCompactArrayRowItems=3,this.AlwaysExpandDepth=-1,this.NestedBracketPadding=!0,this.SimpleBracketPadding=!1,this.ColonPadding=!0,this.CommaPadding=!0,this.CommentPadding=!0,this.OmitTrailingWhitespace=!1,this.NumberListAlignment=n.NumberListAlignment.Normalize,this.IndentSpaces=4,this.UseTabToIndent=!1,this.PrefixString="",this.CommentPolicy=t.CommentPolicy.TreatAsError,this.PreserveBlankLines=!1,this.AllowTrailingCommas=!1}};return dh.FracturedJsonOptions=s,dh}var hh={},W6;function sd(){if(W6)return hh;W6=1,Object.defineProperty(hh,"__esModule",{value:!0}),hh.FracturedJsonError=void 0;let e=class extends Error{constructor(n,s){const i=s?`${n} at idx=${s.Index}, row=${s.Row}, col=${s.Column}`:n;super(i),this.InputPosition=s}};return hh.FracturedJsonError=e,hh}var fh={},ph={},U6;function Gye(){if(U6)return ph;U6=1,Object.defineProperty(ph,"__esModule",{value:!0}),ph.StringJoinBuffer=void 0;let e=class{constructor(n){this._lineBuff=[],this._docBuff=[],this._trimTrailingWhitespace=n}Add(...n){return this._lineBuff.push(...n),this}EndLine(n){return this.AddLineToWriter(n),this}Flush(){return this.AddLineToWriter(""),this}AsString(){return this._docBuff.join("")}AddLineToWriter(n){if(this._lineBuff.length===0&&n.length===0)return;let s=this._lineBuff.join("");this._trimTrailingWhitespace&&(s=s.trimEnd()),this._docBuff.push(s+n),this._lineBuff=[]}};return ph.StringJoinBuffer=e,ph}var gh={},Jv={},q6;function lj(){return q6||(q6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.BracketPaddingType=void 0,function(t){t[t.Empty=0]="Empty",t[t.Simple=1]="Simple",t[t.Complex=2]="Complex"}(e.BracketPaddingType||(e.BracketPaddingType={}))}(Jv)),Jv}var eb={},K6;function rd(){return K6||(K6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonItemType=void 0,function(t){t[t.Null=0]="Null",t[t.False=1]="False",t[t.True=2]="True",t[t.String=3]="String",t[t.Number=4]="Number",t[t.Object=5]="Object",t[t.Array=6]="Array",t[t.BlankLine=7]="BlankLine",t[t.LineComment=8]="LineComment",t[t.BlockComment=9]="BlockComment"}(e.JsonItemType||(e.JsonItemType={}))}(eb)),eb}var Z6;function zye(){if(Z6)return gh;Z6=1,Object.defineProperty(gh,"__esModule",{value:!0}),gh.PaddedFormattingTokens=void 0;const e=lj(),t=rj(),n=rd();let s=class{constructor(o,a){this._arrStart=[],this._arrStart[e.BracketPaddingType.Empty]="[",this._arrStart[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?"[ ":"[",this._arrStart[e.BracketPaddingType.Complex]=o.NestedBracketPadding?"[ ":"[",this._arrEnd=[],this._arrEnd[e.BracketPaddingType.Empty]="]",this._arrEnd[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?" ]":"]",this._arrEnd[e.BracketPaddingType.Complex]=o.NestedBracketPadding?" ]":"]",this._objStart=[],this._objStart[e.BracketPaddingType.Empty]="{",this._objStart[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?"{ ":"{",this._objStart[e.BracketPaddingType.Complex]=o.NestedBracketPadding?"{ ":"{",this._objEnd=[],this._objEnd[e.BracketPaddingType.Empty]="}",this._objEnd[e.BracketPaddingType.Simple]=o.SimpleBracketPadding?" }":"}",this._objEnd[e.BracketPaddingType.Complex]=o.NestedBracketPadding?" }":"}",this._comma=o.CommaPadding?", ":",",this._colon=o.ColonPadding?": ":":",this._comment=o.CommentPadding?" ":"",this._eol=o.JsonEolStyle===t.EolStyle.Crlf?`\r
`:`
`,this._arrStartLen=this._arrStart.map(a),this._arrEndLen=this._arrEnd.map(a),this._objStartLen=this._objStart.map(a),this._objEndLen=this._objEnd.map(a),this._indentStrings=["",o.UseTabToIndent?"	":" ".repeat(o.IndentSpaces)],this._spaceStrings=[""," "],this._commaLen=a(this._comma),this._colonLen=a(this._colon),this._commentLen=a(this._comment),this._literalNullLen=a("null"),this._literalTrueLen=a("true"),this._literalFalseLen=a("false"),this._prefixStringLen=a(o.PrefixString),this._dummyComma=" ".repeat(this._commaLen)}get Comma(){return this._comma}get Colon(){return this._colon}get Comment(){return this._comment}get EOL(){return this._eol}get CommaLen(){return this._commaLen}get ColonLen(){return this._colonLen}get CommentLen(){return this._commentLen}get LiteralNullLen(){return this._literalNullLen}get LiteralTrueLen(){return this._literalTrueLen}get LiteralFalseLen(){return this._literalFalseLen}get PrefixStringLen(){return this._prefixStringLen}get DummyComma(){return this._dummyComma}ArrStart(o){return this._arrStart[o]}ArrEnd(o){return this._arrEnd[o]}ObjStart(o){return this._objStart[o]}ObjEnd(o){return this._objEnd[o]}Start(o,a){return o===n.JsonItemType.Array?this.ArrStart(a):this.ObjStart(a)}End(o,a){return o===n.JsonItemType.Array?this.ArrEnd(a):this.ObjEnd(a)}ArrStartLen(o){return this._arrStartLen[o]}ArrEndLen(o){return this._arrEndLen[o]}ObjStartLen(o){return this._objStartLen[o]}ObjEndLen(o){return this._objEndLen[o]}StartLen(o,a){return o===n.JsonItemType.Array?this.ArrStartLen(a):this.ObjStartLen(a)}EndLen(o,a){return o===n.JsonItemType.Array?this.ArrEndLen(a):this.ObjEndLen(a)}Indent(o){if(o>=this._indentStrings.length)for(let a=this._indentStrings.length;a<=o;++a)this._indentStrings.push(this._indentStrings[a-1]+this._indentStrings[1]);return this._indentStrings[o]}Spaces(o){if(o>=this._spaceStrings.length)for(let a=this._spaceStrings.length;a<=o;++a)this._spaceStrings.push(" ".repeat(a));return this._spaceStrings[o]}};return gh.PaddedFormattingTokens=s,gh}var mh={},Y6;function Hye(){if(Y6)return mh;Y6=1,Object.defineProperty(mh,"__esModule",{value:!0}),mh.TableTemplate=void 0;const e=rd(),t=lj(),n=oj();let s=class jc{constructor(o,a){this.LocationInParent=void 0,this.Type=e.JsonItemType.Null,this.IsRowDataCompatible=!0,this.RowCount=0,this.NameLength=0,this.SimpleValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.PadType=t.BracketPaddingType.Simple,this.AllowNumberNormalization=!1,this.IsNumberList=!1,this.CompositeValueLength=0,this.TotalLength=0,this.Children=[],this._maxDigBeforeDecRaw=0,this._maxDigAfterDecRaw=0,this._maxDigBeforeDecNorm=0,this._maxDigAfterDecNorm=0,this._pads=o,this._numberListAlignment=a,this.AllowNumberNormalization=a===n.NumberListAlignment.Normalize,this.IsNumberList=!0}MeasureTableRoot(o){for(const a of o.Children)this.MeasureRowSegment(a);this.PruneAndRecompute(Number.MAX_VALUE),this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.RowCount>=2)}TryToFit(o){for(let a=this.GetTemplateComplexity();a>=0;--a){if(this.TotalLength<=o)return!0;this.PruneAndRecompute(a-1)}return!1}FormatNumber(o,a){const l=this._numberListAlignment===n.NumberListAlignment.Normalize&&!this.AllowNumberNormalization?n.NumberListAlignment.Left:this._numberListAlignment;switch(l){case n.NumberListAlignment.Left:o.Add(a.Value,this._pads.Spaces(this.SimpleValueLength-a.ValueLength));return;case n.NumberListAlignment.Right:o.Add(this._pads.Spaces(this.SimpleValueLength-a.ValueLength),a.Value);return}let c,d,h,f;if(l===n.NumberListAlignment.Normalize){if(a.Type===e.JsonItemType.Null){o.Add(this._pads.Spaces(this._maxDigBeforeDecNorm-a.ValueLength),a.Value,this._pads.Spaces(this.CompositeValueLength-this._maxDigBeforeDecNorm));return}c=this._maxDigBeforeDecNorm,d=this._maxDigAfterDecNorm,h=Number(a.Value).toFixed(d),f=h.length}else c=this._maxDigBeforeDecRaw,d=this._maxDigAfterDecRaw,h=a.Value,f=a.ValueLength;let p,g;const m=h.search(jc._dotOrE);m>0?(p=c-m,g=this.CompositeValueLength-p-f):(p=c-f,g=this.CompositeValueLength-c),o.Add(this._pads.Spaces(p),h,this._pads.Spaces(g))}MeasureRowSegment(o){if(!(o.Type===e.JsonItemType.BlankLine||o.Type===e.JsonItemType.BlockComment||o.Type===e.JsonItemType.LineComment)&&(o.Type===e.JsonItemType.False||o.Type===e.JsonItemType.True?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.True||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.True,this.IsNumberList=!1):o.Type===e.JsonItemType.Number?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===e.JsonItemType.Number||this.Type===e.JsonItemType.Null),this.Type=e.JsonItemType.Number):o.Type===e.JsonItemType.Null?(this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,this._pads.LiteralNullLen),this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,this._pads.LiteralNullLen)):(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===o.Type||this.Type===e.JsonItemType.Null),this.Type===e.JsonItemType.Null&&(this.Type=o.Type),this.IsNumberList=!1),this.IsRowDataCompatible&&(this.IsRowDataCompatible=!o.RequiresMultipleLines),this.RowCount+=1,this.NameLength=Math.max(this.NameLength,o.NameLength),this.SimpleValueLength=Math.max(this.SimpleValueLength,o.ValueLength),this.MiddleCommentLength=Math.max(this.MiddleCommentLength,o.MiddleCommentLength),this.PrefixCommentLength=Math.max(this.PrefixCommentLength,o.PrefixCommentLength),this.PostfixCommentLength=Math.max(this.PostfixCommentLength,o.PostfixCommentLength),o.Complexity>=2&&(this.PadType=t.BracketPaddingType.Complex),!!this.IsRowDataCompatible)){if(o.Type===e.JsonItemType.Array)for(let a=0;a<o.Children.length;++a)this.Children.length<=a&&this.Children.push(new jc(this._pads,this._numberListAlignment)),this.Children[a].MeasureRowSegment(o.Children[a]);else if(o.Type===e.JsonItemType.Object){if(this.ContainsDuplicateKeys(o.Children)){this.IsRowDataCompatible=!1;return}for(const a of o.Children){let l=this.Children.find(c=>c.LocationInParent===a.Name);l||(l=new jc(this._pads,this._numberListAlignment),l.LocationInParent=a.Name,this.Children.push(l)),l.MeasureRowSegment(a)}}else if(o.Type===e.JsonItemType.Number&&this.IsNumberList){const l=Number(o.Value),c=l.toString();this.AllowNumberNormalization&&(this.AllowNumberNormalization=!isNaN(l)&&l!==1/0&&l!==-1/0&&c.length<=15&&c.indexOf("e")<0&&(l!==0||jc._trulyZeroValString.test(o.Value)));const d=c.indexOf(".");this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,d>=0?d:c.length),this._maxDigAfterDecNorm=Math.max(this._maxDigAfterDecNorm,d>=0?c.length-d-1:0);const h=o.Value.search(jc._dotOrE);this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,h>=0?h:o.ValueLength),this._maxDigAfterDecRaw=Math.max(this._maxDigAfterDecRaw,h>=0?o.ValueLength-h-1:0)}this.AllowNumberNormalization&&(this.AllowNumberNormalization=this.IsNumberList)}}PruneAndRecompute(o){(o<=0||!this.IsRowDataCompatible)&&(this.Children=[]);for(const a of this.Children)a.PruneAndRecompute(o-1);if(this.IsNumberList)this.CompositeValueLength=this.GetNumberFieldWidth();else if(this.Children.length>0){const a=this.Children.map(l=>l.TotalLength).reduce((l,c)=>l+c);this.CompositeValueLength=a+Math.max(0,this._pads.CommaLen*(this.Children.length-1))+this._pads.ArrStartLen(this.PadType)+this._pads.ArrEndLen(this.PadType)}else this.CompositeValueLength=this.SimpleValueLength;this.TotalLength=(this.PrefixCommentLength>0?this.PrefixCommentLength+this._pads.CommentLen:0)+(this.NameLength>0?this.NameLength+this._pads.ColonLen:0)+(this.MiddleCommentLength>0?this.MiddleCommentLength+this._pads.CommentLen:0)+this.CompositeValueLength+(this.PostfixCommentLength>0?this.PostfixCommentLength+this._pads.CommentLen:0)}GetTemplateComplexity(){if(this.Children.length===0)return 0;const o=this.Children.map(a=>a.GetTemplateComplexity());return 1+Math.max(...o)}ContainsDuplicateKeys(o){const a=o.map(l=>l.Name);return a.some((l,c)=>a.indexOf(l)!==c)}GetNumberFieldWidth(){if(this._numberListAlignment===n.NumberListAlignment.Normalize&&this.AllowNumberNormalization){const o=this._maxDigAfterDecNorm>0?1:0;return this._maxDigBeforeDecNorm+o+this._maxDigAfterDecNorm}else if(this._numberListAlignment===n.NumberListAlignment.Decimal){const o=this._maxDigAfterDecRaw>0?1:0;return this._maxDigBeforeDecRaw+o+this._maxDigAfterDecRaw}return this.SimpleValueLength}};return mh.TableTemplate=s,s._trulyZeroValString=new RegExp("^-?[0.]+([eE].*)?$"),s._dotOrE=new RegExp("[.eE]"),mh}var yh={},vh={},X6;function Wye(){if(X6)return vh;X6=1,Object.defineProperty(vh,"__esModule",{value:!0}),vh.TokenEnumerator=void 0;const e=sd();let t=class{constructor(s){this._generator=s}get Current(){if(!this._current)throw new e.FracturedJsonError("Illegal enumerator usage");return this._current}MoveNext(){const s=this._generator.next();return this._current=s.value,!s.done}};return vh.TokenEnumerator=t,vh}var bh={},Q6;function eF(){if(Q6)return bh;Q6=1,Object.defineProperty(bh,"__esModule",{value:!0}),bh.JsonItem=void 0;const e=rd();let t=class{constructor(){this.Type=e.JsonItemType.Null,this.InputPosition={Index:0,Row:0,Column:0},this.Complexity=0,this.Name="",this.Value="",this.PrefixComment="",this.MiddleComment="",this.PostfixComment="",this.IsPostCommentLineStyle=!1,this.NameLength=0,this.ValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.MinimumTotalLength=0,this.RequiresMultipleLines=!1,this.Children=[]}};return bh.JsonItem=t,bh}var tb={},J6;function tF(){return J6||(J6=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TokenType=void 0,function(t){t[t.Invalid=0]="Invalid",t[t.BeginArray=1]="BeginArray",t[t.EndArray=2]="EndArray",t[t.BeginObject=3]="BeginObject",t[t.EndObject=4]="EndObject",t[t.String=5]="String",t[t.Number=6]="Number",t[t.Null=7]="Null",t[t.True=8]="True",t[t.False=9]="False",t[t.BlockComment=10]="BlockComment",t[t.LineComment=11]="LineComment",t[t.BlankLine=12]="BlankLine",t[t.Comma=13]="Comma",t[t.Colon=14]="Colon"}(e.TokenType||(e.TokenType={}))}(tb)),tb}var xh={},Ch={},e8;function Uye(){if(e8)return Ch;e8=1,Object.defineProperty(Ch,"__esModule",{value:!0}),Ch.ScannerState=void 0;const e=sd();let t=class{constructor(i){this.CurrentPosition={Index:0,Row:0,Column:0},this.TokenPosition={Index:0,Row:0,Column:0},this.NonWhitespaceSinceLastNewline=!1,this._originalText=i}Advance(i){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Column+=1,this.NonWhitespaceSinceLastNewline||(this.NonWhitespaceSinceLastNewline=!i)}NewLine(){if(this.CurrentPosition.Index>=n)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Row+=1,this.CurrentPosition.Column=0,this.NonWhitespaceSinceLastNewline=!1}SetTokenStart(){this.TokenPosition=Object.assign({},this.CurrentPosition)}MakeTokenFromBuffer(i,o=!1){const a=this._originalText.substring(this.TokenPosition.Index,this.CurrentPosition.Index);return{Type:i,Text:o?a.trimEnd():a,InputPosition:Object.assign({},this.TokenPosition)}}MakeToken(i,o){return{Type:i,Text:o,InputPosition:Object.assign({},this.TokenPosition)}}Current(){return this.AtEnd()?NaN:this._originalText.charCodeAt(this.CurrentPosition.Index)}AtEnd(){return this.CurrentPosition.Index>=this._originalText.length}Throw(i){throw new e.FracturedJsonError(i,this.CurrentPosition)}};Ch.ScannerState=t;const n=2e9;return Ch}var t8;function qye(){if(t8)return xh;t8=1,Object.defineProperty(xh,"__esModule",{value:!0}),xh.TokenGenerator=void 0;const e=Uye(),t=tF();function*n(B){const U=new e.ScannerState(B);for(;;){if(U.AtEnd())return;const ie=U.Current();switch(ie){case c:case f:case h:U.Advance(!0);break;case d:U.NonWhitespaceSinceLastNewline||(yield U.MakeToken(t.TokenType.BlankLine,`
`)),U.NewLine(),U.SetTokenStart();break;case x:yield s(U,"{",t.TokenType.BeginObject);break;case C:yield s(U,"}",t.TokenType.EndObject);break;case v:yield s(U,"[",t.TokenType.BeginArray);break;case b:yield s(U,"]",t.TokenType.EndArray);break;case S:yield s(U,":",t.TokenType.Colon);break;case w:yield s(U,",",t.TokenType.Comma);break;case se:yield i(U,"true",t.TokenType.True);break;case $:yield i(U,"false",t.TokenType.False);break;case ee:yield i(U,"null",t.TokenType.Null);break;case p:yield o(U);break;case y:yield a(U);break;case E:yield l(U);break;default:H(ie)||U.Throw("Unexpected character"),yield l(U);break}}}xh.TokenGenerator=n;function s(B,U,ie){B.SetTokenStart();const ue=B.MakeToken(ie,U);return B.Advance(!1),ue}function i(B,U,ie){B.SetTokenStart();for(let be=1;be<U.length;++be)B.AtEnd()&&B.Throw("Unexpected end of input while processing keyword"),B.Advance(!1),B.Current()!==U.charCodeAt(be)&&B.Throw("Unexpected keyword");const ue=B.MakeToken(ie,U);return B.Advance(!1),ue}function o(B){B.SetTokenStart(),B.AtEnd()&&B.Throw("Unexpected end of input while processing comment"),B.Advance(!1);let U=!1;B.Current()===g?U=!0:B.Current()!==p&&B.Throw("Bad character for start of comment"),B.Advance(!1);let ie=!1;for(;;){if(B.AtEnd())if(U)B.Throw("Unexpected end of input while processing comment");else return B.MakeTokenFromBuffer(t.TokenType.LineComment,!0);const ue=B.Current();if(ue===d){if(B.NewLine(),!U)return B.MakeTokenFromBuffer(t.TokenType.LineComment,!0);continue}if(B.Advance(!1),ue===p&&ie)return B.MakeTokenFromBuffer(t.TokenType.BlockComment);ie=ue===g}}function a(B){B.SetTokenStart(),B.Advance(!1);let U=!1,ie=0;for(;;){B.AtEnd()&&B.Throw("Unexpected end of input while processing string");const ue=B.Current();if(ie>0){V(ue)||B.Throw("Bad unicode escape in string"),ie-=1,B.Advance(!1);continue}if(U){Y(ue)||B.Throw("Bad escaped character in string"),ue===ne&&(ie=4),U=!1,B.Advance(!1);continue}if(W(ue)&&B.Throw("Control characters are not allowed in strings"),B.Advance(!1),ue===y)return B.MakeTokenFromBuffer(t.TokenType.String);ue===m&&(U=!0)}}function l(B){B.SetTokenStart();let U=J.Beginning;for(;;){const ie=B.Current();let ue=N.ValidAndConsumed;switch(U){case J.Beginning:ie===E?U=J.PastLeadingSign:ie===L?U=J.PastWhole:H(ie)?U=J.PastFirstDigitOfWhole:ue=N.InvalidatesToken;break;case J.PastLeadingSign:H(ie)?ie===L?U=J.PastWhole:U=J.PastFirstDigitOfWhole:ue=N.InvalidatesToken;break;case J.PastFirstDigitOfWhole:ie===A?U=J.PastDecimalPoint:ie===R||ie===D?U=J.PastE:H(ie)||(ue=N.StartOfNewToken);break;case J.PastWhole:ie===A?U=J.PastDecimalPoint:ie===R||ie===D?U=J.PastE:ue=N.StartOfNewToken;break;case J.PastDecimalPoint:H(ie)?U=J.PastFirstDigitOfFractional:ue=N.InvalidatesToken;break;case J.PastFirstDigitOfFractional:ie===R||ie===D?U=J.PastE:H(ie)||(ue=N.StartOfNewToken);break;case J.PastE:ie===j||ie===E?U=J.PastExpSign:H(ie)?U=J.PastFirstDigitOfExponent:ue=N.InvalidatesToken;break;case J.PastExpSign:H(ie)?U=J.PastFirstDigitOfExponent:ue=N.InvalidatesToken;break;case J.PastFirstDigitOfExponent:H(ie)||(ue=N.StartOfNewToken);break}if(ue===N.InvalidatesToken&&B.Throw("Bad character while processing number"),ue===N.StartOfNewToken)return B.MakeTokenFromBuffer(t.TokenType.Number);if(!B.AtEnd()){B.Advance(!1);continue}switch(U){case J.PastFirstDigitOfWhole:case J.PastWhole:case J.PastFirstDigitOfFractional:case J.PastFirstDigitOfExponent:return B.MakeTokenFromBuffer(t.TokenType.Number);default:B.Throw("Unexpected end of input while processing number");break}}}const c=32,d=10,h=13,f=9,p=47,g=42,m=92,y=34,x=123,C=125,v=91,b=93,S=58,w=44,j=43,E=45,A=46,L=48,M=57,O=97,F=65,_=98,R=101,D=69,$=102,G=70,ee=110,Q=114,se=116,ne=117;function H(B){return B>=L&&B<=M}function V(B){return B>=L&&B<=M||B>=O&&B<=$||B>=F&&B<=G}function Y(B){switch(B){case y:case m:case p:case _:case $:case ee:case Q:case se:case ne:return!0;default:return!1}}function W(B){return B>=0&&B<=31||B===127||B>=128&&B<=159}var J;(function(B){B[B.Beginning=0]="Beginning",B[B.PastLeadingSign=1]="PastLeadingSign",B[B.PastFirstDigitOfWhole=2]="PastFirstDigitOfWhole",B[B.PastWhole=3]="PastWhole",B[B.PastDecimalPoint=4]="PastDecimalPoint",B[B.PastFirstDigitOfFractional=5]="PastFirstDigitOfFractional",B[B.PastE=6]="PastE",B[B.PastExpSign=7]="PastExpSign",B[B.PastFirstDigitOfExponent=8]="PastFirstDigitOfExponent"})(J||(J={}));var N;return function(B){B[B.InvalidatesToken=0]="InvalidatesToken",B[B.ValidAndConsumed=1]="ValidAndConsumed",B[B.StartOfNewToken=2]="StartOfNewToken"}(N||(N={})),xh}var n8;function Kye(){if(n8)return yh;n8=1,Object.defineProperty(yh,"__esModule",{value:!0}),yh.Parser=void 0;const e=aj(),t=Wye(),n=eF(),s=rd(),i=tF(),o=sd(),a=ij(),l=qye();let c=class kc{constructor(){this.Options=new e.FracturedJsonOptions}ParseTopLevel(p,g){const m=new t.TokenEnumerator((0,l.TokenGenerator)(p));return this.ParseTopLevelFromEnum(m,g)}ParseTopLevelFromEnum(p,g){const m=[];let y=!1;for(;;){if(!p.MoveNext())return m;const x=this.ParseItem(p),C=x.Type===s.JsonItemType.BlockComment||x.Type===s.JsonItemType.LineComment;if(x.Type===s.JsonItemType.BlankLine)this.Options.PreserveBlankLines&&m.push(x);else if(C){if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",x.InputPosition);this.Options.CommentPolicy===a.CommentPolicy.Preserve&&m.push(x)}else{if(g&&y)throw new o.FracturedJsonError("Unexpected start of second top level element",x.InputPosition);m.push(x),y=!0}}}ParseItem(p){switch(p.Current.Type){case i.TokenType.BeginArray:return this.ParseArray(p);case i.TokenType.BeginObject:return this.ParseObject(p);default:return this.ParseSimple(p.Current)}}ParseSimple(p){const g=new n.JsonItem;return g.Type=kc.ItemTypeFromTokenType(p),g.Value=p.Text,g.InputPosition=p.InputPosition,g.Complexity=0,g}ParseArray(p){if(p.Current.Type!==i.TokenType.BeginArray)throw new o.FracturedJsonError("Parser logic error",p.Current.InputPosition);const g=p.Current.InputPosition;let m,y=-1,x;const C=[];let v=d.EmptyCollection,b=!1,S=0;for(;!b;){const j=kc.GetNextTokenOrThrow(p,g);switch(x&&((x==null?void 0:x.InputPosition.Row)!==j.InputPosition.Row||j.Type===i.TokenType.EndArray)&&(m?(m.PostfixComment=x.Value,m.IsPostCommentLineStyle=x.Type===s.JsonItemType.LineComment):C.push(x),x=void 0),m&&y!==j.InputPosition.Row&&(m=void 0),j.Type){case i.TokenType.EndArray:if(v===d.CommaSeen&&!this.Options.AllowTrailingCommas)throw new o.FracturedJsonError("Array may not end with a comma with current options",j.InputPosition);b=!0;break;case i.TokenType.Comma:if(v!==d.ElementSeen)throw new o.FracturedJsonError("Unexpected comma in array",j.InputPosition);v=d.CommaSeen;break;case i.TokenType.BlankLine:if(!this.Options.PreserveBlankLines)break;C.push(this.ParseSimple(j));break;case i.TokenType.BlockComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",j.InputPosition);x&&(C.push(x),x=void 0);const A=this.ParseSimple(j);if(kc.IsMultilineComment(A)){C.push(A);break}if(m&&v===d.ElementSeen){m.PostfixComment=A.Value,m.IsPostCommentLineStyle=!1,m=void 0;break}x=A;break;case i.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",j.InputPosition);if(x){C.push(x),C.push(this.ParseSimple(j)),x=void 0;break}if(m){m.PostfixComment=j.Text,m.IsPostCommentLineStyle=!0,m=void 0;break}C.push(this.ParseSimple(j));break;case i.TokenType.False:case i.TokenType.True:case i.TokenType.Null:case i.TokenType.String:case i.TokenType.Number:case i.TokenType.BeginArray:case i.TokenType.BeginObject:if(v===d.ElementSeen)throw new o.FracturedJsonError("Comma missing while processing array",j.InputPosition);const L=this.ParseItem(p);v=d.ElementSeen,S=Math.max(S,L.Complexity+1),x&&(L.PrefixComment=x.Value,x=void 0),C.push(L),m=L,y=p.Current.InputPosition.Row;break;default:throw new o.FracturedJsonError("Unexpected token in array",j.InputPosition)}}const w=new n.JsonItem;return w.Type=s.JsonItemType.Array,w.InputPosition=g,w.Complexity=S,w.Children=C,w}ParseObject(p){if(p.Current.Type!==i.TokenType.BeginObject)throw new o.FracturedJsonError("Parser logic error",p.Current.InputPosition);const g=p.Current.InputPosition,m=[];let y,x,C=-1,v=[],b=[],S,w=!1,j=h.BeforePropName,E=0,A=!1;for(;!A;){const M=kc.GetNextTokenOrThrow(p,g),O=C!==M.InputPosition.Row,F=M.Type===i.TokenType.EndObject,_=M.Type===i.TokenType.String&&j===h.AfterComma,R=S&&(M.Type===i.TokenType.BlockComment||M.Type===i.TokenType.LineComment);if(y&&x&&(O||F||_||R)){let $;_&&w&&!O&&($=S,S=void 0),kc.AttachObjectValuePieces(m,y,x,C,v,b,S),E=Math.max(E,x.Complexity+1),y=void 0,x=void 0,v=[],b=[],S=void 0,$&&v.push($)}switch(M.Type){case i.TokenType.BlankLine:if(!this.Options.PreserveBlankLines||j===h.AfterPropName||j===h.AfterColon)break;m.push(...v),v=[],m.push(this.ParseSimple(M));break;case i.TokenType.BlockComment:case i.TokenType.LineComment:if(this.Options.CommentPolicy===a.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===a.CommentPolicy.TreatAsError)throw new o.FracturedJsonError("Comments not allowed with current options",M.InputPosition);j===h.BeforePropName||!y?v.push(this.ParseSimple(M)):j===h.AfterPropName||j===h.AfterColon?b.push(M):(S=this.ParseSimple(M),w=j===h.AfterComma);break;case i.TokenType.EndObject:if(j===h.AfterPropName||j===h.AfterColon)throw new o.FracturedJsonError("Unexpected end of object",M.InputPosition);A=!0;break;case i.TokenType.String:if(j===h.BeforePropName||j===h.AfterComma)y=M,j=h.AfterPropName;else if(j===h.AfterColon)x=this.ParseItem(p),C=p.Current.InputPosition.Row,j=h.AfterPropValue;else throw new o.FracturedJsonError("Unexpected string found while processing object",M.InputPosition);break;case i.TokenType.False:case i.TokenType.True:case i.TokenType.Null:case i.TokenType.Number:case i.TokenType.BeginArray:case i.TokenType.BeginObject:if(j!==h.AfterColon)throw new o.FracturedJsonError("Unexpected element while processing object",M.InputPosition);x=this.ParseItem(p),C=p.Current.InputPosition.Row,j=h.AfterPropValue;break;case i.TokenType.Colon:if(j!==h.AfterPropName)throw new o.FracturedJsonError("Unexpected colon while processing object",M.InputPosition);j=h.AfterColon;break;case i.TokenType.Comma:if(j!==h.AfterPropValue)throw new o.FracturedJsonError("Unexpected comma while processing object",M.InputPosition);j=h.AfterComma;break;default:throw new o.FracturedJsonError("Unexpected token while processing object",M.InputPosition)}}if(!this.Options.AllowTrailingCommas&&j===h.AfterComma)throw new o.FracturedJsonError("Object may not end with comma with current options",p.Current.InputPosition);const L=new n.JsonItem;return L.Type=s.JsonItemType.Object,L.InputPosition=g,L.Complexity=E,L.Children=m,L}static ItemTypeFromTokenType(p){switch(p.Type){case i.TokenType.False:return s.JsonItemType.False;case i.TokenType.True:return s.JsonItemType.True;case i.TokenType.Null:return s.JsonItemType.Null;case i.TokenType.Number:return s.JsonItemType.Number;case i.TokenType.String:return s.JsonItemType.String;case i.TokenType.BlankLine:return s.JsonItemType.BlankLine;case i.TokenType.BlockComment:return s.JsonItemType.BlockComment;case i.TokenType.LineComment:return s.JsonItemType.LineComment;default:throw new o.FracturedJsonError("Unexpected Token",p.InputPosition)}}static GetNextTokenOrThrow(p,g){if(!p.MoveNext())throw new o.FracturedJsonError("Unexpected end of input while processing array or object starting",g);return p.Current}static IsMultilineComment(p){return p.Type===s.JsonItemType.BlockComment&&p.Value.includes(`
`)}static AttachObjectValuePieces(p,g,m,y,x,C,v){if(m.Name=g.Text,C.length>0){let b="";for(let S=0;S<C.length;++S)b+=C[S].Text,(S<C.length-1||C[S].Type===i.TokenType.LineComment)&&(b+=`
`);m.MiddleComment=b}if(x.length>0){const b=x.pop();b.Type===s.JsonItemType.BlockComment&&b.InputPosition.Row===m.InputPosition.Row?(m.PrefixComment=b.Value,p.push(...x)):(p.push(...x),p.push(b))}p.push(m),v&&(!this.IsMultilineComment(v)&&v.InputPosition.Row===y?(m.PostfixComment=v.Value,m.IsPostCommentLineStyle=v.Type===s.JsonItemType.LineComment):p.push(v))}};yh.Parser=c;var d;(function(f){f[f.EmptyCollection=0]="EmptyCollection",f[f.ElementSeen=1]="ElementSeen",f[f.CommaSeen=2]="CommaSeen"})(d||(d={}));var h;return function(f){f[f.BeforePropName=0]="BeforePropName",f[f.AfterPropName=1]="AfterPropName",f[f.AfterColon=2]="AfterColon",f[f.AfterPropValue=3]="AfterPropValue",f[f.AfterComma=4]="AfterComma"}(h||(h={})),yh}var Sh={},s8;function Zye(){if(s8)return Sh;s8=1,Object.defineProperty(Sh,"__esModule",{value:!0}),Sh.ConvertDataToDom=void 0;const e=eF(),t=rd(),n=sd();function s(i,o,a=100){var l;if(a<=0)throw new n.FracturedJsonError("Depth limit exceeded - possible circular reference");const c=typeof i;switch(c){case"function":case"symbol":case"undefined":return}if(i&&i.toJSON){const h=JSON.parse(JSON.stringify(i));return s(h,o,a-1)}const d=new e.JsonItem;if(d.Name=o?JSON.stringify(o):"",i===null)d.Type=t.JsonItemType.Null,d.Value="null";else if(Array.isArray(i)){d.Type=t.JsonItemType.Array,d.Children=i.map(h=>{var f;return(f=s(h,void 0,a-1))!==null&&f!==void 0?f:s(null,void 0,a-1)}),d.Children=[];for(let h=0;h<i.length;++h)d.Children[h]=(l=s(i[h],void 0,a-1))!==null&&l!==void 0?l:s(null,void 0,a-1)}else if(c==="object"){d.Type=t.JsonItemType.Object;for(const h of Object.entries(i)){const f=s(h[1],h[0],a-1);f&&d.Children.push(f)}}else{switch(c){case"string":d.Type=t.JsonItemType.String;break;case"number":case"bigint":d.Type=t.JsonItemType.Number;break;case"boolean":d.Type=i?t.JsonItemType.True:t.JsonItemType.False;break}d.Value=JSON.stringify(i)}if(d.Children.length>0){const h=d.Children.map(f=>f.Complexity).reduce((f,p)=>Math.max(f,p));d.Complexity=h+1}return d}return Sh.ConvertDataToDom=s,Sh}var r8;function Yye(){if(r8)return fh;r8=1,Object.defineProperty(fh,"__esModule",{value:!0}),fh.Formatter=void 0;const e=aj(),t=Gye(),n=zye(),s=rd(),i=lj(),o=Hye(),a=sd(),l=Kye(),c=Zye();let d=class _s{constructor(){this.Options=new e.FracturedJsonOptions,this.StringLengthFunc=_s.StringLengthByCharCount,this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),this._pads=new n.PaddedFormattingTokens(new e.FracturedJsonOptions,_s.StringLengthByCharCount)}static StringLengthByCharCount(f){return f.length}Reformat(f,p=0){const g=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),m=new l.Parser;m.Options=this.Options;const y=m.ParseTopLevel(f,!0);return this.FormatTopLevel(y,p,g),g.Flush(),g.AsString()}Serialize(f,p=0,g=100){const m=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),y=(0,c.ConvertDataToDom)(f,void 0,g);if(y)return this.FormatTopLevel([y],p,m),m.Flush(),m.AsString()}Minify(f){const p=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace),g=new l.Parser;g.Options=this.Options;const m=g.ParseTopLevel(f,!0);return this.MinifyTopLevel(m,p),p.Flush(),p.AsString()}FormatTopLevel(f,p,g){this._buffer=g,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);for(const m of f)this.ComputeItemLengths(m),this.FormatItem(m,p,!1);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}MinifyTopLevel(f,p){this._buffer=p,this._pads=new n.PaddedFormattingTokens(this.Options,this.StringLengthFunc);let g=!0;for(const m of f)g=this.MinifyItem(m,g);this._buffer=new t.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}ComputeItemLengths(f){const p=`
`;for(const g of f.Children)this.ComputeItemLengths(g);switch(f.Type){case s.JsonItemType.Null:f.ValueLength=this._pads.LiteralNullLen;break;case s.JsonItemType.True:f.ValueLength=this._pads.LiteralTrueLen;break;case s.JsonItemType.False:f.ValueLength=this._pads.LiteralFalseLen;break;default:f.ValueLength=this.StringLengthFunc(f.Value);break}if(f.NameLength=this.StringLengthFunc(f.Name),f.PrefixCommentLength=this.StringLengthFunc(f.PrefixComment),f.MiddleCommentLength=this.StringLengthFunc(f.MiddleComment),f.PostfixCommentLength=this.StringLengthFunc(f.PostfixComment),f.RequiresMultipleLines=_s.IsCommentOrBlankLine(f.Type)||f.Children.some(g=>g.RequiresMultipleLines||g.IsPostCommentLineStyle)||f.PrefixComment.indexOf(p)>=0||f.MiddleComment.indexOf(p)>=0||f.PostfixComment.indexOf(p)>=0||f.Value.indexOf(p)>=0,f.Type===s.JsonItemType.Array||f.Type===s.JsonItemType.Object){const g=_s.GetPaddingType(f);f.ValueLength=this._pads.StartLen(f.Type,g)+this._pads.EndLen(f.Type,g)+f.Children.map(m=>m.MinimumTotalLength).reduce((m,y)=>m+y,0)+Math.max(0,this._pads.CommaLen*(f.Children.length-1))}f.MinimumTotalLength=(f.PrefixCommentLength>0?f.PrefixCommentLength+this._pads.CommentLen:0)+(f.NameLength>0?f.NameLength+this._pads.ColonLen:0)+(f.MiddleCommentLength>0?f.MiddleCommentLength+this._pads.CommentLen:0)+f.ValueLength+(f.PostfixCommentLength>0?f.PostfixCommentLength+this._pads.CommentLen:0)}FormatItem(f,p,g){switch(f.Type){case s.JsonItemType.Array:case s.JsonItemType.Object:this.FormatContainer(f,p,g);break;case s.JsonItemType.BlankLine:this.FormatBlankLine();break;case s.JsonItemType.BlockComment:case s.JsonItemType.LineComment:this.FormatStandaloneComment(f,p);break;default:f.RequiresMultipleLines?this.FormatSplitKeyValue(f,p,g):this.FormatInlineElement(f,p,g);break}}FormatContainer(f,p,g){p>this.Options.AlwaysExpandDepth&&(this.FormatContainerInline(f,p,g)||this.FormatContainerCompactMultiline(f,p,g))||p>=this.Options.AlwaysExpandDepth&&this.FormatContainerTable(f,p,g)||this.FormatContainerExpanded(f,p,g)}FormatContainerInline(f,p,g){if(f.RequiresMultipleLines)return!1;const m=f.MinimumTotalLength+(g?this._pads.CommaLen:0);return f.Complexity>this.Options.MaxInlineComplexity||m>this.AvailableLineSpace(p)?!1:(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),this.InlineElement(f,g),this._buffer.EndLine(this._pads.EOL),!0)}FormatContainerCompactMultiline(f,p,g){if(f.Type!==s.JsonItemType.Array||f.Complexity>this.Options.MaxCompactArrayComplexity||f.RequiresMultipleLines)return!1;const m=new o.TableTemplate(this._pads,this.Options.NumberListAlignment);m.MeasureTableRoot(f);const y=this.AvailableLineSpace(p+1);let x=this._pads.CommaLen;if(m.IsRowDataCompatible?x+=m.TotalLength:x+=f.Children.map(S=>S.MinimumTotalLength).reduce((S,w)=>S+w,0)/f.Children.length,x*this.Options.MinCompactArrayRowItems>y)return!1;const C=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty));const v=this.AvailableLineSpace(C+1);let b=-1;for(let S=0;S<f.Children.length;++S){const w=f.Children[S],j=S<f.Children.length-1,E=(j?this._pads.CommaLen:0)+(m.IsRowDataCompatible?m.TotalLength:w.MinimumTotalLength);b<E&&(this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C+1)),b=v),m.IsRowDataCompatible?this.InlineTableRowSegment(m,w,j,!1):this.InlineElement(w,j),b-=E}return this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g),!0}FormatContainerTable(f,p,g){if(f.Complexity>this.Options.MaxTableRowComplexity+1)return!1;const m=this.AvailableLineSpace(p+1)-this._pads.CommaLen;if(f.Children.filter(b=>!_s.IsCommentOrBlankLine(b.Type)).some(b=>b.MinimumTotalLength>m))return!1;const x=new o.TableTemplate(this._pads,this.Options.NumberListAlignment);if(x.MeasureTableRoot(f),!x.IsRowDataCompatible||!x.TryToFit(m))return!1;const C=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const v=_s.IndexOfLastElement(f.Children);for(let b=0;b<f.Children.length;++b){const S=f.Children[b];if(S.Type===s.JsonItemType.BlankLine){this.FormatBlankLine();continue}if(S.Type===s.JsonItemType.LineComment||S.Type===s.JsonItemType.BlockComment){this.FormatStandaloneComment(S,C+1);continue}this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C+1)),this.InlineTableRowSegment(x,S,b<v,!0),this._buffer.EndLine(this._pads.EOL)}return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(C),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g),!0}FormatContainerExpanded(f,p,g){const m=this.StandardFormatStart(f,p);this._buffer.Add(this._pads.Start(f.Type,i.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const y=_s.IndexOfLastElement(f.Children);for(let x=0;x<f.Children.length;++x)this.FormatItem(f.Children[x],m+1,x<y);this._buffer.Add(this.Options.PrefixString,this._pads.Indent(m),this._pads.End(f.Type,i.BracketPaddingType.Empty)),this.StandardFormatEnd(f,g)}FormatStandaloneComment(f,p){const g=_s.NormalizeMultilineComment(f.Value,f.InputPosition.Column);for(const m of g)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p),m).EndLine(this._pads.EOL)}FormatBlankLine(){this._buffer.Add(this.Options.PrefixString).EndLine(this._pads.EOL)}FormatInlineElement(f,p,g){this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),this.InlineElement(f,g),this._buffer.EndLine(this._pads.EOL)}FormatSplitKeyValue(f,p,g){this.StandardFormatStart(f,p),this._buffer.Add(f.Value),this.StandardFormatEnd(f,g)}StandardFormatStart(f,p){if(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p)),f.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Comment),f.NameLength>0&&this._buffer.Add(f.Name,this._pads.Colon),f.MiddleCommentLength===0)return p;if(f.MiddleComment.indexOf(`
`)<0)return this._buffer.Add(f.MiddleComment,this._pads.Comment),p;const g=_s.NormalizeMultilineComment(f.MiddleComment,Number.MAX_VALUE);this._buffer.EndLine(this._pads.EOL);for(const m of g)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p+1),m).EndLine(this._pads.EOL);return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(p+1)),p+1}StandardFormatEnd(f,p){p&&f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment),p&&!f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),this._buffer.EndLine(this._pads.EOL)}InlineElement(f,p){if(f.RequiresMultipleLines)throw new a.FracturedJsonError("Logic error - trying to inline invalid element");f.PrefixCommentLength>0&&this._buffer.Add(f.PrefixComment,this._pads.Comment),f.NameLength>0&&this._buffer.Add(f.Name,this._pads.Colon),f.MiddleCommentLength>0&&this._buffer.Add(f.MiddleComment,this._pads.Comment),this.InlineElementRaw(f),p&&f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,f.PostfixComment),p&&!f.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma)}InlineElementRaw(f){if(f.Type===s.JsonItemType.Array){const p=_s.GetPaddingType(f);this._buffer.Add(this._pads.ArrStart(p));for(let g=0;g<f.Children.length;++g)this.InlineElement(f.Children[g],g<f.Children.length-1);this._buffer.Add(this._pads.ArrEnd(p))}else if(f.Type===s.JsonItemType.Object){const p=_s.GetPaddingType(f);this._buffer.Add(this._pads.ObjStart(p));for(let g=0;g<f.Children.length;++g)this.InlineElement(f.Children[g],g<f.Children.length-1);this._buffer.Add(this._pads.ObjEnd(p))}else this._buffer.Add(f.Value)}InlineTableRowSegment(f,p,g,m){f.PrefixCommentLength>0&&this._buffer.Add(p.PrefixComment,this._pads.Spaces(f.PrefixCommentLength-p.PrefixCommentLength),this._pads.Comment),f.NameLength>0&&this._buffer.Add(p.Name,this._pads.Spaces(f.NameLength-p.NameLength),this._pads.Colon),f.MiddleCommentLength>0&&this._buffer.Add(p.MiddleComment,this._pads.Spaces(f.MiddleCommentLength-p.MiddleCommentLength),this._pads.Comment),f.Children.length>0&&p.Type!==s.JsonItemType.Null?f.Type===s.JsonItemType.Array?this.InlineTableRawArray(f,p):this.InlineTableRawObject(f,p):f.IsNumberList?f.FormatNumber(this._buffer,p):(this.InlineElementRaw(p),this._buffer.Add(this._pads.Spaces(f.CompositeValueLength-p.ValueLength)));const y=p.IsPostCommentLineStyle||p.PostfixCommentLength===0;y&&(g?this._buffer.Add(this._pads.Comma):m&&this._buffer.Add(this._pads.DummyComma)),f.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,p.PostfixComment,this._pads.Spaces(f.PostfixCommentLength-p.PostfixCommentLength)),y||(g?this._buffer.Add(this._pads.Comma):m&&this._buffer.Add(this._pads.DummyComma))}InlineTableRawArray(f,p){this._buffer.Add(this._pads.ArrStart(f.PadType));for(let g=0;g<f.Children.length;++g){const m=g===f.Children.length-1,y=g===p.Children.length-1,x=g>=p.Children.length,C=f.Children[g];x?(this._buffer.Add(this._pads.Spaces(C.TotalLength)),m||this._buffer.Add(this._pads.DummyComma)):(this.InlineTableRowSegment(C,p.Children[g],!y,!1),y&&!m&&this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ArrEnd(f.PadType))}InlineTableRawObject(f,p){function g(x){return p.Children.find(C=>C.Name===x.LocationInParent)}const m=f.Children.map(x=>({tt:x,ji:g(x)}));let y=m.length-1;for(;y>=0&&!m[y].ji;)y-=1;this._buffer.Add(this._pads.ObjStart(f.PadType));for(let x=0;x<m.length;++x){const C=m[x].tt,v=m[x].ji,b=x===y,S=x===m.length-1;v?(this.InlineTableRowSegment(C,v,!b,!1),b&&!S&&this._buffer.Add(this._pads.DummyComma)):(this._buffer.Add(this._pads.Spaces(C.TotalLength)),S||this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ObjEnd(f.PadType))}AvailableLineSpace(f){return Math.min(this.Options.MaxInlineLength,this.Options.MaxTotalLineLength-this._pads.PrefixStringLen-this.Options.IndentSpaces*f)}MinifyItem(f,p){const g=`
`;if(this._buffer.Add(f.PrefixComment),f.Name.length>0&&this._buffer.Add(f.Name,":"),f.MiddleComment.indexOf(g)>=0){const m=_s.NormalizeMultilineComment(f.MiddleComment,Number.MAX_VALUE);for(const y of m)this._buffer.Add(y,g)}else this._buffer.Add(f.MiddleComment);if(f.Type===s.JsonItemType.Array||f.Type===s.JsonItemType.Object){let m;f.Type===s.JsonItemType.Array?(this._buffer.Add("["),m="]"):(this._buffer.Add("{"),m="}");let y=!1,x=!1;for(const C of f.Children)_s.IsCommentOrBlankLine(C.Type)||(y&&this._buffer.Add(","),y=!0),x=this.MinifyItem(C,x);this._buffer.Add(m)}else{if(f.Type===s.JsonItemType.BlankLine)return p||this._buffer.Add(g),this._buffer.Add(g),!0;if(f.Type===s.JsonItemType.LineComment)return p||this._buffer.Add(g),this._buffer.Add(f.Value,g),!0;if(f.Type===s.JsonItemType.BlockComment){if(p||this._buffer.Add(g),f.Value.indexOf(g)>=0){const m=_s.NormalizeMultilineComment(f.Value,f.InputPosition.Column);for(const y of m)this._buffer.Add(y,g);return!0}return this._buffer.Add(f.Value,g),!0}else this._buffer.Add(f.Value)}return this._buffer.Add(f.PostfixComment),f.PostfixComment.length>0&&f.IsPostCommentLineStyle?(this._buffer.Add(g),!0):!1}static GetPaddingType(f){return f.Children.length===0?i.BracketPaddingType.Empty:f.Complexity>=2?i.BracketPaddingType.Complex:i.BracketPaddingType.Simple}static NormalizeMultilineComment(f,p){const m=f.replace(/\r/g,"").split(`
`).filter(y=>y.length>0);for(let y=1;y<m.length;++y){const x=m[y];let C=0;for(;C<x.length&&C<p&&/\s/.test(x[C]);)C+=1;m[y]=x.substring(C)}return m}static IndexOfLastElement(f){for(let p=f.length-1;p>=0;--p)if(!this.IsCommentOrBlankLine(f[p].Type))return p;return-1}static IsCommentOrBlankLine(f){return f===s.JsonItemType.BlankLine||f===s.JsonItemType.BlockComment||f===s.JsonItemType.LineComment}};return fh.Formatter=d,fh}var i8;function Xye(){return i8||(i8=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Formatter=e.FracturedJsonError=e.NumberListAlignment=e.EolStyle=e.CommentPolicy=e.FracturedJsonOptions=void 0;var t=aj();Object.defineProperty(e,"FracturedJsonOptions",{enumerable:!0,get:function(){return t.FracturedJsonOptions}});var n=ij();Object.defineProperty(e,"CommentPolicy",{enumerable:!0,get:function(){return n.CommentPolicy}});var s=rj();Object.defineProperty(e,"EolStyle",{enumerable:!0,get:function(){return s.EolStyle}});var i=oj();Object.defineProperty(e,"NumberListAlignment",{enumerable:!0,get:function(){return i.NumberListAlignment}});var o=sd();Object.defineProperty(e,"FracturedJsonError",{enumerable:!0,get:function(){return o.FracturedJsonError}});var a=Yye();Object.defineProperty(e,"Formatter",{enumerable:!0,get:function(){return a.Formatter}})}(Zv)),Zv}var Qye=Xye();const Jye=new Qye.Formatter,eve=zo("scroll","scroll").options,tve=e=>{const{label:t,data:n,fileName:s,withDownload:i=!0,withCopy:o=!0,extraCopyActions:a}=e,l=u.useMemo(()=>(Cl(n)?n:Jye.Serialize(n))??"",[n]),c=Ma(),d=Ho(),h=u.useCallback(()=>{d.writeText(l)},[d,l]),f=u.useCallback(()=>{const g=new Blob([l]),m=document.createElement("a");m.href=URL.createObjectURL(g),m.download=`${s||t}.json`,document.body.appendChild(m),m.click(),m.remove()},[l,t,s]),{t:p}=P();return r.jsxs(T,{layerStyle:"second",borderRadius:"base",flexGrow:1,w:"full",h:"full",position:"relative",children:[r.jsx(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"auto",p:4,fontSize:"sm",children:r.jsx(tr,{defer:!0,style:nve,options:eve,children:r.jsx("pre",{children:l})})}),r.jsxs(T,{position:"absolute",top:0,insetInlineEnd:0,p:2,children:[i&&r.jsx(Le,{label:`${p("gallery.download")} ${t} JSON`,children:r.jsx(ae,{"aria-label":`${p("gallery.download")} ${t} JSON`,icon:r.jsx(Vu,{size:16}),variant:"ghost",opacity:.7,onClick:f})}),o&&r.jsx(Le,{label:`${p("gallery.copy")} ${t} JSON`,children:r.jsx(ae,{"aria-label":`${p("gallery.copy")} ${t} JSON`,icon:r.jsx(on,{size:16}),variant:"ghost",opacity:.7,onClick:h})}),c&&(a==null?void 0:a.map(({label:g,getData:m})=>r.jsx(sve,{label:g,getData:m,data:n},g)))]})]})},Bo=u.memo(tve),nve={height:"100%",width:"100%"},sve=({label:e,data:t,getData:n})=>{const{t:s}=P(),i=Ho(),o=u.useCallback(()=>{i.writeText(JSON.stringify(n(t),null,2))},[i,t,n]);return r.jsx(Le,{label:`${s("gallery.copy")} ${e} JSON`,children:r.jsx(ae,{"aria-label":`${s("gallery.copy")} ${e} JSON`,icon:r.jsx(on,{size:16}),variant:"ghost",opacity:.7,onClick:o})})},rve=({image:e})=>{const{t}=P(),{currentData:n}=JN(e),s=u.useMemo(()=>{if(n!=null&&n.graph)try{return JSON.parse(n.graph)}catch{return null}return null},[n]);return s?r.jsx(Bo,{fileName:`${e.image_name.replace(".png","")}_graph`,data:s,label:t("nodes.graph")}):r.jsx(Yt,{label:t("nodes.noGraph")})},ive=u.memo(rve),ove=()=>{const{t:e}=P();return r.jsx(K,{children:e("common.loading")})},ave=()=>{const{t:e}=P();return r.jsx(K,{children:e("metadata.parsingFailed")})},nF=(e,t)=>{const[n,s]=u.useState(uc),[i,o]=u.useState(null);u.useEffect(()=>{(()=>{t.parse(e).then(p=>{s(p)}).catch(()=>{s(Xa)})})()},[t,e]);const a=u.useMemo(()=>n===uc||n===Xa,[n]),l=u.useMemo(()=>t.getLabel(),[t]);u.useEffect(()=>{(()=>{if(n===uc){o(null);return}if(n===Xa){o(null);return}t.renderValue(n).then(p=>{o(p)}).catch(()=>{})})()},[t,n]);const c=u.useMemo(()=>n===uc?r.jsx(ove,{}):n===Xa?r.jsx(ave,{}):r.jsx(K,{children:i}),[i,n]),d=u.useCallback(()=>{if(!t.recall||n===uc||n===Xa)return null;t.recall(n,!0).catch(()=>{})},[t,n]),h=u.useMemo(()=>n===uc||n===Xa?null:n,[n]);return{label:l,isDisabled:a,value:n,renderedValue:c,onRecall:d,valueOrNull:h}},sF=u.memo(({label:e,...t})=>{const{t:n}=P();return r.jsx(Le,{label:n("metadata.recallParameter",{label:e}),children:r.jsx(ae,{"aria-label":n("metadata.recallParameter",{label:e}),icon:r.jsx(vE,{}),size:"xs",variant:"ghost",...t})})});sF.displayName="RecallButton";const cj=u.memo(({label:e,onRecall:t,isDisabled:n,renderedValue:s,direction:i="row"})=>r.jsxs(T,{gap:2,children:[t&&r.jsx(sF,{label:e,onClick:t,isDisabled:n}),r.jsxs(T,{direction:i,fontSize:"sm",children:[r.jsxs(K,{fontWeight:"semibold",whiteSpace:"pre-wrap",pr:2,children:[e,":"]}),s]})]}));cj.displayName="MetadataItemView";const lve=rp(({metadata:e,handlers:t,direction:n="row"})=>{const{label:s,isDisabled:i,value:o,renderedValue:a,onRecall:l}=nF(e,t);return o===Xa||t.getIsVisible&&!qK(o)&&!t.getIsVisible(o)?null:r.jsx(cj,{label:s,onRecall:l,isDisabled:i,renderedValue:a,direction:n})}),Vt=rp(lve);Vt.displayName="MetadataItem";const cve=({metadata:e})=>{const[t,n]=u.useState([]);u.useEffect(()=>{(async()=>{try{const o=await lt.loras.parse(e);n(o)}catch{n([])}})()},[e]);const s=u.useMemo(()=>lt.loras.getLabel(),[]);return r.jsx(r.Fragment,{children:t.map(i=>r.jsx(uve,{label:s,lora:i,handlers:lt.loras},i.model.key))})},uve=({label:e,lora:t,handlers:n})=>{const s=u.useCallback(()=>{n.recallItem&&n.recallItem(t,!0).catch(()=>{})},[n,t]),[i,o]=u.useState(null);return u.useEffect(()=>{(async()=>{if(!n.renderItemValue){o(null);return}const l=await n.renderItemValue(t);o(l)})()},[n,t]),r.jsx(cj,{label:e,isDisabled:!1,onRecall:s,renderedValue:i})},dve=e=>{const t=I(On),{metadata:n}=e;return!n||Object.keys(n).length===0?null:r.jsxs(T,{flexDir:"column",pl:8,children:[r.jsx(Vt,{metadata:n,handlers:lt.generationMode}),r.jsx(Vt,{metadata:n,handlers:lt.positivePrompt,direction:"column"}),r.jsx(Vt,{metadata:n,handlers:lt.negativePrompt,direction:"column"}),r.jsx(Vt,{metadata:n,handlers:lt.sdxlPositiveStylePrompt,direction:"column"}),r.jsx(Vt,{metadata:n,handlers:lt.sdxlNegativeStylePrompt,direction:"column"}),r.jsx(Vt,{metadata:n,handlers:lt.model}),r.jsx(Vt,{metadata:n,handlers:lt.vae}),r.jsx(Vt,{metadata:n,handlers:lt.width}),r.jsx(Vt,{metadata:n,handlers:lt.height}),r.jsx(Vt,{metadata:n,handlers:lt.seed}),r.jsx(Vt,{metadata:n,handlers:lt.steps}),r.jsx(Vt,{metadata:n,handlers:lt.scheduler}),r.jsx(Vt,{metadata:n,handlers:lt.cfgScale}),r.jsx(Vt,{metadata:n,handlers:lt.cfgRescaleMultiplier}),r.jsx(Vt,{metadata:n,handlers:lt.guidance}),t!=="canvas"&&r.jsx(Vt,{metadata:n,handlers:lt.strength}),r.jsx(Vt,{metadata:n,handlers:lt.seamlessX}),r.jsx(Vt,{metadata:n,handlers:lt.seamlessY}),r.jsx(Vt,{metadata:n,handlers:lt.hrfEnabled}),r.jsx(Vt,{metadata:n,handlers:lt.hrfMethod}),r.jsx(Vt,{metadata:n,handlers:lt.hrfStrength}),r.jsx(Vt,{metadata:n,handlers:lt.refinerCFGScale}),r.jsx(Vt,{metadata:n,handlers:lt.refinerModel}),r.jsx(Vt,{metadata:n,handlers:lt.refinerNegativeAestheticScore}),r.jsx(Vt,{metadata:n,handlers:lt.refinerPositiveAestheticScore}),r.jsx(Vt,{metadata:n,handlers:lt.refinerScheduler}),r.jsx(Vt,{metadata:n,handlers:lt.refinerStart}),r.jsx(Vt,{metadata:n,handlers:lt.refinerSteps}),r.jsx(cve,{metadata:n})]})},hve=u.memo(dve),fve=({image:e})=>{const{t}=P(),{currentData:n}=JN(e),s=u.useMemo(()=>{if(n!=null&&n.workflow)try{return JSON.parse(n.workflow)}catch{return null}return null},[n]);return s?r.jsx(Bo,{fileName:`${e.image_name.replace(".png","")}_workflow`,data:s,label:t("metadata.workflow")}):r.jsx(Yt,{label:t("nodes.noWorkflow")})},pve=u.memo(fve),gve=({image:e})=>{const{t}=P(),{metadata:n}=BP(e.image_name),s=nF(n,lt.createdBy);return r.jsxs(T,{layerStyle:"first",padding:4,gap:1,flexDirection:"column",width:"full",height:"full",borderRadius:"base",position:"absolute",overflow:"hidden",children:[r.jsx(Xs,{href:e.image_url,label:e.image_name}),s.valueOrNull&&r.jsxs(K,{children:[t("metadata.createdBy"),": ",s.valueOrNull]}),r.jsxs(Vl,{variant:"line",isLazy:!0,display:"flex",flexDir:"column",w:"full",h:"full",children:[r.jsxs(Gl,{children:[r.jsx(Sn,{children:t("metadata.recallParameters")}),r.jsx(Sn,{children:t("metadata.metadata")}),r.jsx(Sn,{children:t("metadata.imageDetails")}),r.jsx(Sn,{children:t("metadata.workflow")}),r.jsx(Sn,{children:t("nodes.graph")})]}),r.jsxs(Lu,{children:[r.jsx(Pn,{children:n?r.jsx(Nn,{children:r.jsx(hve,{metadata:n})}):r.jsx(Yt,{label:t("metadata.noRecallParameters")})}),r.jsx(Pn,{children:n?r.jsx(Bo,{fileName:`${e.image_name.replace(".png","")}_metadata`,data:n,label:t("metadata.metadata")}):r.jsx(Yt,{label:t("metadata.noMetaData")})}),r.jsx(Pn,{children:e?r.jsx(Bo,{fileName:`${e.image_name.replace(".png","")}_details`,data:e,label:t("metadata.imageDetails")}):r.jsx(Yt,{label:t("metadata.noImageDetails")})}),r.jsx(Pn,{children:r.jsx(pve,{image:e})}),r.jsx(Pn,{children:r.jsx(ive,{image:e})})]})]})]})},mve=u.memo(gve),uj=()=>{const e=I(Du),t=Ul(e);return{imageDTOs:u.useMemo(()=>{var s;return((s=t.data)==null?void 0:s.items)??er},[t.data]),queryResult:t}},y2="gallery-grid",rF=u.memo(({imageDTOs:e})=>{const{t}=P();return r.jsxs(T,{w:w0,h:w0,alignItems:"center",justifyContent:"center",flexDir:"column",bg:"base.900",borderRadius:"base",children:[r.jsx(Ot,{children:e.length}),r.jsx(Ot,{size:"sm",children:t("parameters.images")})]})});rF.displayName="DndDragPreviewMultipleImage";const yve=e=>Wl.createPortal(r.jsx(rF,{imageDTOs:e.imageDTOs}),e.container),vve=({multipleImageDndData:e,onGenerateDragPreviewArgs:t,setDragPreviewState:n})=>{const{nativeSetDragImage:s,source:i,location:o}=t;qN({render({container:a}){return n({type:"multiple-image",container:a,imageDTOs:e.payload.imageDTOs}),()=>n(null)},nativeSetDragImage:s,getOffset:KN({element:i.element,input:o.current.input})})},bve={minW:0,svg:{transitionProperty:"common",transitionDuration:"normal",fill:"base.100",_hover:{fill:"base.50"},filter:`drop-shadow(0px 0px 0.1rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))`}},io=u.memo(e=>{const{onClick:t,tooltip:n,icon:s,...i}=e;return r.jsx(ae,{onClick:t,"aria-label":n,icon:s,variant:"link",sx:bve,"data-testid":n,...i})});io.displayName="DndImageIcon";const iF=u.memo(({imageDTO:e})=>{const t=Ma(),{t:n}=P(),s=z(),i=u.useCallback(o=>{o.stopPropagation(),e&&s($f([e]))},[s,e]);return t?r.jsx(io,{onClick:i,icon:r.jsx(L1,{}),tooltip:n("gallery.deleteImage_one"),position:"absolute",bottom:2,insetInlineEnd:2}):null});iF.displayName="GalleryImageDeleteIconButton";const oF=u.memo(({imageDTO:e})=>{const t=Lt(),{t:n}=P(),s=u.useCallback(()=>{t.openImageInViewer(e)},[e,t]);return r.jsx(io,{onClick:s,icon:r.jsx(I1,{}),tooltip:n("gallery.openInViewer"),position:"absolute",insetBlockStart:2,insetInlineStart:2})});oF.displayName="GalleryImageOpenInViewerIconButton";const aF=u.memo(({imageDTO:e})=>r.jsx(K,{className:"gallery-image-size-badge",position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:1,left:1,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",pointerEvents:"none",children:`${e.width}x${e.height}`}));aF.displayName="GalleryImageSizeBadge";const lF=u.memo(({imageDTO:e})=>{const t=ce(gC),[n]=mC(),[s]=yC(),i=u.useCallback(()=>{e.starred?s({imageDTOs:[e]}):n({imageDTOs:[e]})},[n,s,e]);return t?r.jsx(io,{onClick:i,icon:e.starred?t.on.icon:t.off.icon,tooltip:e.starred?t.on.text:t.off.text,position:"absolute",top:2,insetInlineEnd:2}):r.jsx(io,{onClick:i,icon:e.starred?r.jsx(jS,{}):r.jsx(CS,{}),tooltip:e.starred?"Unstar":"Star",position:"absolute",top:2,insetInlineEnd:2})});lF.displayName="GalleryImageStarIconButton";const cF=u.memo(({imageDTO:e,isHovered:t})=>{const n=I(KK);return r.jsxs(r.Fragment,{children:[(t||n)&&r.jsx(aF,{imageDTO:e}),(t||e.starred)&&r.jsx(lF,{imageDTO:e}),t&&r.jsx(iF,{imageDTO:e}),t&&r.jsx(oF,{imageDTO:e})]})});cF.displayName="GalleryImageHoverIcons";const uF=e=>`gallery-image-${e}`,dF=u.memo(({width:e,height:t})=>r.jsx(pC,{w:`${e}px`,h:"auto",objectFit:"contain",aspectRatio:`${e}/${t}`}));dF.displayName="SizedSkeletonLoader";const dj="gallery-image-container",xve={containerType:"inline-size",w:"full",h:"full",".gallery-image-size-badge":{"@container (max-width: 80px)":{"&":{display:"none"}}},"&[data-is-dragging=true]":{opacity:.3},".gallery-image":{touchAction:"none",userSelect:"none",webkitUserSelect:"none",position:"relative",justifyContent:"center",alignItems:"center",aspectRatio:"1/1","::before":{content:'""',display:"inline-block",position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",borderRadius:"base"},"&[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-500), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-300), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"},"&:hover::before":{boxShadow:"inset 0px 0px 0px 1px var(--invoke-colors-invokeBlue-300), inset 0px 0px 0px 2px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-400), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},"&:hover[data-selected-for-compare=true]::before":{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-200), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"}}},hF=u.memo(({imageDTO:e})=>{const t=sr(),[n,s]=u.useState(!1),[i,o]=u.useState(null),[a,l]=u.useState(null),c=u.useId(),d=u.useMemo(()=>ve(kr,C=>{var v;return((v=C.imageToCompare)==null?void 0:v.image_name)===e.image_name}),[e.image_name]),h=I(d),f=u.useMemo(()=>ve(kr,C=>{for(const v of C.selection)if(v.image_name===e.image_name)return!0;return!1}),[e.image_name]),p=I(f);u.useEffect(()=>{if(a)return Kn(nd(a),Wu({element:a,getInitialData:()=>{const{gallery:C}=t.getState();return C.selection.length>1&&C.selection.find(({image_name:v})=>v===e.image_name)!==void 0?Zr.getData({imageDTOs:C.selection,boardId:C.selectedBoardId}):wn.getData({imageDTO:e},e.image_name)},onDragStart:({source:C})=>{if(wn.typeGuard(C.data)){s(!0);return}},onGenerateDragPreview:C=>{Zr.typeGuard(C.source.data)?vve({multipleImageDndData:C.source.data,onGenerateDragPreviewArgs:C,setDragPreviewState:o}):wn.typeGuard(C.source.data)&&QN({singleImageDndData:C.source.data,onGenerateDragPreviewArgs:C,setDragPreviewState:o})}}),qi({onDragStart:({source:C})=>{Zr.typeGuard(C.data)&&C.data.payload.imageDTOs.includes(e)&&s(!0)},onDrop:()=>{s(!1)}}))},[e,a,t,c]);const g=Xf(!1),m=u.useCallback(C=>{t.dispatch(ZK({imageDTO:e,shiftKey:C.shiftKey,ctrlKey:C.ctrlKey,metaKey:C.metaKey,altKey:C.altKey}))},[e,t]),y=u.useCallback(()=>{Qc.set(!0),t.dispatch(Pu(null))},[t]),x=u.useMemo(()=>uF(e.image_name),[e.image_name]);return PD(e,a),r.jsxs(r.Fragment,{children:[r.jsx(ke,{className:dj,sx:xve,"data-testid":x,"data-is-dragging":n,children:r.jsxs(T,{role:"button",className:"gallery-image",onMouseOver:g.setTrue,onMouseOut:g.setFalse,onClick:m,onDoubleClick:y,"data-selected":p,"data-selected-for-compare":h,children:[r.jsx(dn,{ref:l,src:e.thumbnail_url,fallback:r.jsx(dF,{width:e.width,height:e.height}),w:e.width,objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base"}),r.jsx(cF,{imageDTO:e,isHovered:g.isTrue})]})}),(i==null?void 0:i.type)==="multiple-image"?yve(i):null,(i==null?void 0:i.type)==="single-image"?XN(i):null]})});hF.displayName="GalleryImage";const Cve=Oe({}),Sve=(e,t)=>e.top>=t.top&&e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right,wve=(e,t)=>e>(t.endIndex-t.startIndex)/2+t.startIndex?"end":"start",j0=()=>{const e=document.querySelector(`.${dj}`),t=document.querySelector(`.${y2}`);if(!e||!t)return 0;const n=t.parentElement;if(!n)return 0;const s=e.getBoundingClientRect(),i=n.getBoundingClientRect(),o=window.getComputedStyle(t),a=parseFloat(o.gap);if(!s.width||!s.height||!i.width||!i.height)return 0;let l=0,c=0;for(;c+s.width<=i.width+1;)l++,c+=s.width,c+a<=i.width&&(c+=a);return l},jve=(e,t)=>{var d,h,f;const n=Cve.get(),s=(d=n.virtuosoRangeRef)==null?void 0:d.current,i=(h=n.rootRef)==null?void 0:h.current,o=(f=n.virtuosoRef)==null?void 0:f.current;if(!s||!o||!i)return;const a=document.querySelector(`[data-testid="${uF(e)}"]`),l=a==null?void 0:a.getBoundingClientRect(),c=i.getBoundingClientRect();(!l||!Sve(l,c))&&o.scrollToIndex({index:t,align:wve(t,s)})},kve=(e,t)=>{const n=to(t-1,0,e.length-1),s=e[n];return{index:n,image:s}},_ve=(e,t)=>{const n=to(t+1,0,e.length-1),s=e[n];return{index:n,image:s}},Ive=(e,t)=>{const n=j0(),i=t<n?t:to(t-n,0,e.length-1),o=e[i];return{index:i,image:o}},Ave=(e,t)=>{const n=j0(),i=t<e.length-n?to(t+n,0,e.length-1):t,o=e[i];return{index:i,image:o}},Tve={left:kve,right:_ve,up:Ive,down:Ave},fF=()=>{const e=z(),t=YK(),n=u.useMemo(()=>ve(Vf,XK,(S,w)=>t?w??S:S),[t]),s=I(n),{imageDTOs:i}=uj(),o=u.useMemo(()=>i.length,[i.length]),a=u.useMemo(()=>i.length===0||!s?0:i.findIndex(S=>S.image_name===s.image_name),[i,s]),l=u.useCallback((S,w)=>{const{index:j,image:E}=Tve[S](i,a);!E||j===a||(e(w?Pu(E):J2(E)),jve(E.image_name,j))},[i,a,e]),c=u.useMemo(()=>a===0,[a]),d=u.useMemo(()=>a===o-1,[a,o]),h=u.useMemo(()=>a<j0(),[a]),f=u.useMemo(()=>a>=o-j0(),[a,o]),p=u.useMemo(()=>a===0,[a]),g=u.useMemo(()=>a===o-1,[a,o]),m=u.useCallback(S=>{l("left",S)},[l]),y=u.useCallback(S=>{l("right",S)},[l]),x=u.useCallback(S=>{l("up",S)},[l]),C=u.useCallback(S=>{l("down",S)},[l]),v=u.useCallback(()=>{y()},[y]),b=u.useCallback(()=>{m()},[m]);return{handleLeftImage:m,handleRightImage:y,handleUpImage:x,handleDownImage:C,isOnFirstImage:c,isOnLastImage:d,isOnFirstRow:h,isOnLastRow:f,nextImage:v,prevImage:b,isOnFirstImageOfView:p,isOnLastImageOfView:g}},Fh=(e,t)=>{const n=t-e+1;return Array.from({length:n},(s,i)=>i+e)},Uc="ellipsis",Mve=(e,t,n)=>{const s=Math.min(2*n+5,t),i=1,o=t,a=Math.max(e-n,i),l=Math.min(e+n,o),c=a>i+1,d=l<o-1,h=s-2;if(!c&&d)return[...Fh(1,h),Uc,o];if(c&&!d){const p=Fh(o-h+1,o);return[i,Uc,...p]}if(c&&d){const p=Fh(a,l);return[i,Uc,...p,Uc,o]}return Fh(i,o)},Pve=ve(kr,e=>e.offset),Eve=ve(kr,e=>e.limit),ly=()=>{const e=z(),t=I(Pve),n=I(Eve),s=I(Du),{count:i,total:o}=Ul(s,{selectFromResult:({data:j})=>({count:(j==null?void 0:j.items.length)??0,total:(j==null?void 0:j.total)??0})}),a=u.useMemo(()=>Math.ceil(t/(n||0)),[t,n]),l=u.useMemo(()=>Math.ceil(o/(n||0)),[o,n]),c=u.useMemo(()=>i?a+1<l:!1,[i,a,l]),d=u.useMemo(()=>i?t>0:!1,[i,t]),h=u.useCallback(j=>{e(ZM(j))},[e]),f=u.useMemo(()=>sx(h,500),[h]),p=u.useCallback(j=>{f({offset:t+(n||0),withHotkey:j})},[f,t,n]),g=u.useCallback(j=>{f({offset:Math.max(t-(n||0),0),withHotkey:j})},[f,t,n]),m=u.useCallback(j=>{f({offset:j*(n||0)})},[f,n]),y=u.useCallback(()=>{f({offset:0})},[f]),x=u.useCallback(()=>{f({offset:(l-1)*(n||0)})},[f,l,n]);u.useEffect(()=>{l&&a+1>l&&x()},[a,l,x]);const C=u.useMemo(()=>l>7?Mve(a+1,l,1):Fh(1,l),[a,l]),v=u.useMemo(()=>a>0,[a]),b=u.useMemo(()=>a<l-1,[a,l]),S=u.useMemo(()=>{const j=a*(n||0)+1,E=Math.min((a+1)*(n||0),o);return`${j}-${E} of ${o}`},[o,a,n]),w=u.useMemo(()=>Math.min((a+1)*(n||0),o),[a,n,o]);return{count:i,total:o,currentPage:a,pages:l,isNextEnabled:c,isPrevEnabled:d,goNext:p,goPrev:g,goToPage:m,goToFirst:y,goToLast:x,pageButtons:C,isFirstEnabled:v,isLastEnabled:b,rangeDisplay:S,numberOnPage:w}},Lve=({inset:e=8})=>{const{t}=P(),{prevImage:n,nextImage:s,isOnFirstImageOfView:i,isOnLastImageOfView:o}=fF(),{isFetching:a}=uj().queryResult,{isNextEnabled:l,goNext:c,isPrevEnabled:d,goPrev:h}=ly(),f=u.useMemo(()=>!!(!i||d),[i,d]),p=u.useCallback(()=>{i?d&&!a&&h("arrow"):n()},[h,a,i,d,n]),g=u.useMemo(()=>!!(!o||l),[l,o]),m=u.useCallback(()=>{o?l&&!a&&c("arrow"):s()},[c,a,l,o,s]);return r.jsxs(ke,{pos:"relative",h:"full",w:"full",children:[f&&r.jsx(ae,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.previousImage"),icon:r.jsx(vS,{size:64}),variant:"unstyled",onClick:p,isDisabled:a,color:"base.100",pointerEvents:"auto",insetInlineStart:e}),g&&r.jsx(ae,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.nextImage"),icon:r.jsx(A1,{size:64}),variant:"unstyled",onClick:m,isDisabled:a,color:"base.100",pointerEvents:"auto",insetInlineEnd:e})]})},pF=u.memo(Lve),gF=u.memo(e=>r.jsx(pt,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",...e,children:r.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})}));gF.displayName="InvokeLogoIcon";const mF=Symbol("LOADING"),Dve=()=>{const{data:e,isLoading:t}=Eu({include_archived:!0}),{data:n,isLoading:s}=Ul({board_id:"none",offset:0,limit:0,is_intermediate:!1});return u.useMemo(()=>t||s?mF:e&&e.length>0&&e.filter(a=>a.image_count>0).length>0?!0:n?n.total>0:!0,[e,n,t,s])},yF=u.memo(()=>{const e=Dve(),[t,{data:n}]=U1(),s=I(KM),i=un("starterModels"),{t:o}=P(),a=u.useMemo(()=>i&&n&&t.length===0,[t.length,n,i]);return e===mF?r.jsx(Rve,{}):e?r.jsx(Yt,{icon:mu,label:o("gallery.noImageSelected")}):r.jsxs(T,{flexDir:"column",gap:8,alignItems:"center",textAlign:"center",maxW:"600px",children:[r.jsx(gF,{w:32,h:32}),r.jsxs(T,{flexDir:"column",gap:4,alignItems:"center",textAlign:"center",children:[s?r.jsx(Ove,{}):r.jsx(Nve,{}),a&&r.jsx(Bve,{}),r.jsx(Et,{}),r.jsx(Fve,{}),s&&r.jsx($ve,{})]})]})});yF.displayName="NoContentForViewer";const Rve=()=>r.jsx(T,{position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center",children:r.jsx(or,{label:"Loading",color:"grey",position:"absolute",size:"sm",width:8,height:8,right:4,bottom:4})}),hj=e=>r.jsx(ye,{as:n1,variant:"unstyled",isExternal:!0,display:"inline-flex",alignItems:"center",rightIcon:r.jsx(_1,{}),color:"base.50",mt:-1,...e}),o8=e=>r.jsx(ye,{variant:"link",size:"md",onClick:e.onClick,color:"base.50",children:e.children}),vF=r.jsx(K,{as:"span",color:"base.50",fontSize:"md"}),Ove=()=>r.jsx(K,{fontSize:"md",color:"base.200",children:r.jsx(Xt,{i18nKey:"newUserExperience.toGetStartedLocal",components:{StrongComponent:vF}})}),Nve=()=>r.jsx(K,{fontSize:"md",color:"base.200",children:r.jsx(Xt,{i18nKey:"newUserExperience.toGetStarted",components:{StrongComponent:vF}})}),Fve=()=>r.jsx(K,{fontSize:"md",color:"base.200",children:r.jsx(Xt,{i18nKey:"newUserExperience.gettingStartedSeries",components:{LinkComponent:r.jsx(hj,{href:"https://www.youtube.com/playlist?list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO"})}})}),Bve=()=>{const e=z(),t=u.useCallback(()=>{e(bt("models")),Al.set(3)},[e]),n=u.useCallback(()=>{e(bt("models")),Al.set(0)},[e]);return r.jsx(K,{fontSize:"md",color:"base.200",children:r.jsx(Xt,{i18nKey:"newUserExperience.noModelsInstalled",components:{DownloadStarterModelsButton:r.jsx(o8,{onClick:t}),ImportModelsButton:r.jsx(o8,{onClick:n})}})})},$ve=()=>r.jsxs(zl,{status:"warning",borderRadius:"base",fontSize:"md",shadow:"md",w:"fit-content",children:[r.jsx(Hl,{}),r.jsx(Qf,{children:r.jsx(Xt,{i18nKey:"newUserExperience.lowVRAMMode",components:{LinkComponent:r.jsx(hj,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}})})]}),Vve=ve(W0,e=>e.shouldAntialiasProgressImage),Gve=()=>{const e=ce(QK),t=ce(YM),n=I(Vve),s=u.useMemo(()=>({imageRendering:n?"auto":"pixelated"}),[n]);return!e||t?null:r.jsx(dn,{src:e.dataURL,width:e.width,height:e.height,draggable:!1,"data-testid":"progress-image",objectFit:"contain",maxWidth:"full",maxHeight:"full",position:"absolute",borderRadius:"base",sx:s})},zve=u.memo(Gve),Hve=()=>{const e=I(OP),t=I(JK),{currentData:n}=Pa(t??ws),[s,i]=u.useState(!1),o=u.useRef(0),a=u.useCallback(()=>{i(!0),window.clearTimeout(o.current)},[]),l=u.useCallback(()=>{o.current=window.setTimeout(()=>{i(!1)},500)},[]);return r.jsxs(T,{onMouseOver:a,onMouseOut:l,width:"full",height:"full",alignItems:"center",justifyContent:"center",position:"relative",children:[r.jsx(bF,{imageDTO:n}),r.jsxs(T,{flexDir:"column",gap:2,position:"absolute",top:0,insetInlineStart:0,pointerEvents:"none",alignItems:"flex-start",children:[r.jsx(Qme,{}),r.jsx(sj,{})]}),e&&n&&r.jsx(ke,{position:"absolute",opacity:.8,top:0,width:"full",height:"full",borderRadius:"base",children:r.jsx(mve,{image:n})}),r.jsx(j9,{children:s&&n&&r.jsx(ke,{as:$w.div,initial:Uve,animate:qve,exit:Kve,position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:r.jsx(pF,{})},"nextPrevButtons")})]})},Wve=u.memo(Hve),bF=u.memo(({imageDTO:e})=>{const t=ce(eZ),n=ce(YM),s=I(sS);return t&&!n&&s?r.jsx(zve,{}):e?r.jsx(T,{w:"full",h:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsx($a,{imageDTO:e})}):r.jsx(yF,{})});bF.displayName="ImageContent";const Uve={opacity:0},qve={opacity:1,transition:{duration:.07}},Kve={opacity:0,transition:{duration:.07}},xF=e=>{e.preventDefault()},Ml=u.memo(({type:e,...t})=>{const{t:n}=P();return r.jsx(K,{position:"absolute",bottom:4,insetInlineEnd:e==="first"?void 0:4,insetInlineStart:e==="first"?4:void 0,textOverflow:"clip",whiteSpace:"nowrap",filter:n2,color:"base.50",transitionDuration:"0.2s",transitionProperty:"common",...t,children:n(e==="first"?"gallery.viewerImage":"gallery.compareImage")})});Ml.displayName="ImageComparisonLabel";const CF=u.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=I(AC),i=u.useRef(null),o=Xf(!1),a=u.useMemo(()=>Z9(n,e),[n,e]),l=u.useMemo(()=>Y9(s,a,e,t),[s,a,e,t]);return r.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(T,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(ke,{ref:i,position:"relative",id:"image-comparison-hover-image-container",w:a.width,h:a.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[r.jsx(dn,{id:"image-comparison-hover-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:a.width,h:a.height,maxW:"full",maxH:"full",objectFit:"cover",objectPosition:"top left"}),r.jsx(Ml,{type:"first",opacity:o.isTrue?0:1}),r.jsxs(ke,{id:"image-comparison-hover-second-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",opacity:o.isTrue?1:0,transitionDuration:"0.2s",transitionProperty:"common",children:[r.jsx(ke,{id:"image-comparison-hover-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:td,backgroundRepeat:"repeat"}),r.jsx(dn,{position:"relative",id:"image-comparison-hover-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:l.width,h:l.height,maxW:a.width,maxH:a.height,objectFit:s,objectPosition:"top left"}),r.jsx(Ml,{type:"second",opacity:o.isTrue?1:0})]}),r.jsx(ke,{id:"image-comparison-hover-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseOver:o.setTrue,onMouseOut:o.setFalse,onContextMenu:xF,userSelect:"none"})]})})})});CF.displayName="ImageComparisonHover";const{createElement:ku,createContext:Zve,forwardRef:SF,useCallback:$s,useContext:wF,useEffect:vl,useImperativeHandle:jF,useLayoutEffect:Yve,useMemo:Xve,useRef:Hs,useState:su}=TC,a8=TC[`useId${Math.random()}`.slice(0,5)],Qve=Yve,cy=Zve(null);cy.displayName="PanelGroupContext";const bl=Qve,Jve=typeof a8=="function"?a8:()=>null;let ebe=0;function fj(e=null){const t=Jve(),n=Hs(e||t||null);return n.current===null&&(n.current=""+ebe++),e??n.current}function kF({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:i,forwardedRef:o,id:a,maxSize:l,minSize:c,onCollapse:d,onExpand:h,onResize:f,order:p,style:g,tagName:m="div",...y}){const x=wF(cy);if(x===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:C,expandPanel:v,getPanelSize:b,getPanelStyle:S,groupId:w,isPanelCollapsed:j,reevaluatePanelConstraints:E,registerPanel:A,resizePanel:L,unregisterPanel:M}=x,O=fj(a),F=Hs({callbacks:{onCollapse:d,onExpand:h,onResize:f},constraints:{collapsedSize:n,collapsible:s,defaultSize:i,maxSize:l,minSize:c},id:O,idIsFromProps:a!==void 0,order:p});Hs({didLogMissingDefaultSizeWarning:!1}),bl(()=>{const{callbacks:R,constraints:D}=F.current,$={...D};F.current.id=O,F.current.idIsFromProps=a!==void 0,F.current.order=p,R.onCollapse=d,R.onExpand=h,R.onResize=f,D.collapsedSize=n,D.collapsible=s,D.defaultSize=i,D.maxSize=l,D.minSize=c,($.collapsedSize!==D.collapsedSize||$.collapsible!==D.collapsible||$.maxSize!==D.maxSize||$.minSize!==D.minSize)&&E(F.current,$)}),bl(()=>{const R=F.current;return A(R),()=>{M(R)}},[p,O,A,M]),jF(o,()=>({collapse:()=>{C(F.current)},expand:R=>{v(F.current,R)},getId(){return O},getSize(){return b(F.current)},isCollapsed(){return j(F.current)},isExpanded(){return!j(F.current)},resize:R=>{L(F.current,R)}}),[C,v,b,j,O,L]);const _=S(F.current,i);return ku(m,{...y,children:e,className:t,id:a,style:{..._,...g},"data-panel":"","data-panel-collapsible":s||void 0,"data-panel-group-id":w,"data-panel-id":O,"data-panel-size":parseFloat(""+_.flexGrow).toFixed(1)})}const Xi=SF((e,t)=>ku(kF,{...e,forwardedRef:t}));kF.displayName="Panel";Xi.displayName="forwardRef(Panel)";let v2=null,ul=null;function tbe(e,t){if(t){const n=(t&MF)!==0,s=(t&PF)!==0,i=(t&EF)!==0,o=(t&LF)!==0;if(n)return i?"se-resize":o?"ne-resize":"e-resize";if(s)return i?"sw-resize":o?"nw-resize":"w-resize";if(i)return"s-resize";if(o)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function nbe(){ul!==null&&(document.head.removeChild(ul),v2=null,ul=null)}function nb(e,t){const n=tbe(e,t);v2!==n&&(v2=n,ul===null&&(ul=document.createElement("style"),document.head.appendChild(ul)),ul.innerHTML=`*{cursor: ${n}!important;}`)}function _F(e){return e.type==="keydown"}function IF(e){return e.type.startsWith("pointer")}function AF(e){return e.type.startsWith("mouse")}function uy(e){if(IF(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(AF(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function sbe(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function rbe(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function ibe(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:u8(e),b:u8(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;ht(s,"Stacking order can only be calculated for elements with a common ancestor");const i={a:c8(l8(n.a)),b:c8(l8(n.b))};if(i.a===i.b){const o=s.childNodes,a={a:n.a.at(-1),b:n.b.at(-1)};let l=o.length;for(;l--;){const c=o[l];if(c===a.a)return 1;if(c===a.b)return-1}}return Math.sign(i.a-i.b)}const obe=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function abe(e){var t;const n=getComputedStyle((t=TF(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function lbe(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||abe(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||obe.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function l8(e){let t=e.length;for(;t--;){const n=e[t];if(ht(n,"Missing node"),lbe(n))return n}return null}function c8(e){return e&&Number(getComputedStyle(e).zIndex)||0}function u8(e){const t=[];for(;e;)t.push(e),e=TF(e);return t}function TF(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const MF=1,PF=2,EF=4,LF=8,cbe=sbe()==="coarse";let bi=[],ru=!1,aa=new Map,dy=new Map;const Af=new Set;function ube(e,t,n,s,i){var o;const{ownerDocument:a}=t,l={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:i},c=(o=aa.get(a))!==null&&o!==void 0?o:0;return aa.set(a,c+1),Af.add(l),k0(),function(){var h;dy.delete(e),Af.delete(l);const f=(h=aa.get(a))!==null&&h!==void 0?h:1;if(aa.set(a,f-1),k0(),f===1&&aa.delete(a),bi.includes(l)){const p=bi.indexOf(l);p>=0&&bi.splice(p,1),gj(),i("up",!0,null)}}}function d8(e){const{target:t}=e,{x:n,y:s}=uy(e);ru=!0,pj({target:t,x:n,y:s}),k0(),bi.length>0&&(_0("down",e),e.preventDefault(),e.stopPropagation())}function wh(e){const{x:t,y:n}=uy(e);if(ru&&e.buttons===0&&(ru=!1,_0("up",e)),!ru){const{target:s}=e;pj({target:s,x:t,y:n})}_0("move",e),gj(),bi.length>0&&e.preventDefault()}function fc(e){const{target:t}=e,{x:n,y:s}=uy(e);dy.clear(),ru=!1,bi.length>0&&e.preventDefault(),_0("up",e),pj({target:t,x:n,y:s}),gj(),k0()}function pj({target:e,x:t,y:n}){bi.splice(0);let s=null;e instanceof HTMLElement&&(s=e),Af.forEach(i=>{const{element:o,hitAreaMargins:a}=i,l=o.getBoundingClientRect(),{bottom:c,left:d,right:h,top:f}=l,p=cbe?a.coarse:a.fine;if(t>=d-p&&t<=h+p&&n>=f-p&&n<=c+p){if(s!==null&&document.contains(s)&&o!==s&&!o.contains(s)&&!s.contains(o)&&ibe(s,o)>0){let m=s,y=!1;for(;m&&!m.contains(o);){if(rbe(m.getBoundingClientRect(),l)){y=!0;break}m=m.parentElement}if(y)return}bi.push(i)}})}function sb(e,t){dy.set(e,t)}function gj(){let e=!1,t=!1;bi.forEach(s=>{const{direction:i}=s;i==="horizontal"?e=!0:t=!0});let n=0;dy.forEach(s=>{n|=s}),e&&t?nb("intersection",n):e?nb("horizontal",n):t?nb("vertical",n):nbe()}function k0(){aa.forEach((e,t)=>{const{body:n}=t;n.removeEventListener("contextmenu",fc),n.removeEventListener("pointerdown",d8),n.removeEventListener("pointerleave",wh),n.removeEventListener("pointermove",wh)}),window.removeEventListener("pointerup",fc),window.removeEventListener("pointercancel",fc),Af.size>0&&(ru?(bi.length>0&&aa.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("contextmenu",fc),n.addEventListener("pointerleave",wh),n.addEventListener("pointermove",wh))}),window.addEventListener("pointerup",fc),window.addEventListener("pointercancel",fc)):aa.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("pointerdown",d8,{capture:!0}),n.addEventListener("pointermove",wh))}))}function _0(e,t){Af.forEach(n=>{const{setResizeHandlerState:s}=n,i=bi.includes(n);s(e,i,t)})}function dbe(){const[e,t]=su(0);return $s(()=>t(n=>n+1),[])}function ht(e,t){if(!e)throw console.error(t),Error(t)}const mj=10;function Pl(e,t,n=mj){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function Ao(e,t,n=mj){return Pl(e,t,n)===0}function mr(e,t,n){return Pl(e,t,n)===0}function hbe(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const i=e[s],o=t[s];if(!mr(i,o,n))return!1}return!0}function qc({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];ht(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:i=0,collapsible:o,maxSize:a=100,minSize:l=0}=s;if(Pl(n,l)<0)if(o){const c=(i+l)/2;Pl(n,c)<0?n=i:n=l}else n=l;return n=Math.min(a,n),n=parseFloat(n.toFixed(mj)),n}function Bh({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:i,trigger:o}){if(mr(e,0))return t;const a=[...t],[l,c]=s;ht(l!=null,"Invalid first pivot index"),ht(c!=null,"Invalid second pivot index");let d=0;if(o==="keyboard"){{const f=e<0?c:l,p=n[f];ht(p,`Panel constraints not found for index ${f}`);const{collapsedSize:g=0,collapsible:m,minSize:y=0}=p;if(m){const x=t[f];if(ht(x!=null,`Previous layout not found for panel index ${f}`),mr(x,g)){const C=y-x;Pl(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}{const f=e<0?l:c,p=n[f];ht(p,`No panel constraints found for index ${f}`);const{collapsedSize:g=0,collapsible:m,minSize:y=0}=p;if(m){const x=t[f];if(ht(x!=null,`Previous layout not found for panel index ${f}`),mr(x,y)){const C=x-g;Pl(C,Math.abs(e))>0&&(e=e<0?0-C:C)}}}}{const f=e<0?1:-1;let p=e<0?c:l,g=0;for(;;){const y=t[p];ht(y!=null,`Previous layout not found for panel index ${p}`);const C=qc({panelConstraints:n,panelIndex:p,size:100})-y;if(g+=C,p+=f,p<0||p>=n.length)break}const m=Math.min(Math.abs(e),Math.abs(g));e=e<0?0-m:m}{let p=e<0?l:c;for(;p>=0&&p<n.length;){const g=Math.abs(e)-Math.abs(d),m=t[p];ht(m!=null,`Previous layout not found for panel index ${p}`);const y=m-g,x=qc({panelConstraints:n,panelIndex:p,size:y});if(!mr(m,x)&&(d+=m-x,a[p]=x,d.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?p--:p++}}if(hbe(i,a))return i;{const f=e<0?c:l,p=t[f];ht(p!=null,`Previous layout not found for panel index ${f}`);const g=p+d,m=qc({panelConstraints:n,panelIndex:f,size:g});if(a[f]=m,!mr(m,g)){let y=g-m,C=e<0?c:l;for(;C>=0&&C<n.length;){const v=a[C];ht(v!=null,`Previous layout not found for panel index ${C}`);const b=v+y,S=qc({panelConstraints:n,panelIndex:C,size:b});if(mr(v,S)||(y-=S-v,a[C]=S),mr(y,0))break;e>0?C--:C++}}}const h=a.reduce((f,p)=>p+f,0);return mr(h,100)?a:i}function fbe({layout:e,panelsArray:t,pivotIndices:n}){let s=0,i=100,o=0,a=0;const l=n[0];ht(l!=null,"No pivot index found"),t.forEach((f,p)=>{const{constraints:g}=f,{maxSize:m=100,minSize:y=0}=g;p===l?(s=y,i=m):(o+=y,a+=m)});const c=Math.min(i,100-o),d=Math.max(s,100-a),h=e[l];return{valueMax:c,valueMin:d,valueNow:h}}function El(e,t=document){return Array.from(t.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${e}"]`))}function DF(e,t,n=document){const i=El(e,n).findIndex(o=>o.getAttribute("data-panel-resize-handle-id")===t);return i??null}function RF(e,t,n){const s=DF(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function hy(e,t=document){var n;if(t instanceof HTMLElement&&(t==null||(n=t.dataset)===null||n===void 0?void 0:n.panelGroupId)==e)return t;const s=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return s||null}function fy(e,t=document){const n=t.querySelector(`[data-panel-resize-handle-id="${e}"]`);return n||null}function pbe(e,t,n,s=document){var i,o,a,l;const c=fy(t,s),d=El(e,s),h=c?d.indexOf(c):-1,f=(i=(o=n[h])===null||o===void 0?void 0:o.id)!==null&&i!==void 0?i:null,p=(a=(l=n[h+1])===null||l===void 0?void 0:l.id)!==null&&a!==void 0?a:null;return[f,p]}function gbe({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:i,panelGroupElement:o,setLayout:a}){Hs({didWarnAboutMissingResizeHandle:!1}),bl(()=>{if(!o)return;const l=El(n,o);for(let c=0;c<i.length-1;c++){const{valueMax:d,valueMin:h,valueNow:f}=fbe({layout:s,panelsArray:i,pivotIndices:[c,c+1]}),p=l[c];if(p!=null){const g=i[c];ht(g,`No panel data found for index "${c}"`),p.setAttribute("aria-controls",g.id),p.setAttribute("aria-valuemax",""+Math.round(d)),p.setAttribute("aria-valuemin",""+Math.round(h)),p.setAttribute("aria-valuenow",f!=null?""+Math.round(f):"")}}return()=>{l.forEach((c,d)=>{c.removeAttribute("aria-controls"),c.removeAttribute("aria-valuemax"),c.removeAttribute("aria-valuemin"),c.removeAttribute("aria-valuenow")})}},[n,s,i,o]),vl(()=>{if(!o)return;const l=t.current;ht(l,"Eager values not found");const{panelDataArray:c}=l,d=hy(n,o);ht(d!=null,`No group found for id "${n}"`);const h=El(n,o);ht(h,`No resize handles found for group id "${n}"`);const f=h.map(p=>{const g=p.getAttribute("data-panel-resize-handle-id");ht(g,"Resize handle element has no handle id attribute");const[m,y]=pbe(n,g,c,o);if(m==null||y==null)return()=>{};const x=C=>{if(!C.defaultPrevented)switch(C.key){case"Enter":{C.preventDefault();const v=c.findIndex(b=>b.id===m);if(v>=0){const b=c[v];ht(b,`No panel data found for index ${v}`);const S=s[v],{collapsedSize:w=0,collapsible:j,minSize:E=0}=b.constraints;if(S!=null&&j){const A=Bh({delta:mr(S,w)?E-w:w-S,initialLayout:s,panelConstraints:c.map(L=>L.constraints),pivotIndices:RF(n,g,o),prevLayout:s,trigger:"keyboard"});s!==A&&a(A)}}break}}};return p.addEventListener("keydown",x),()=>{p.removeEventListener("keydown",x)}});return()=>{f.forEach(p=>p())}},[o,e,t,n,s,i,a])}function h8(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function OF(e,t){const n=e==="horizontal",{x:s,y:i}=uy(t);return n?s:i}function mbe(e,t,n,s,i){const o=n==="horizontal",a=fy(t,i);ht(a,`No resize handle element found for id "${t}"`);const l=a.getAttribute("data-panel-group-id");ht(l,"Resize handle element has no group id attribute");let{initialCursorPosition:c}=s;const d=OF(n,e),h=hy(l,i);ht(h,`No group element found for id "${l}"`);const f=h.getBoundingClientRect(),p=o?f.width:f.height;return(d-c)/p*100}function ybe(e,t,n,s,i,o){if(_F(e)){const a=n==="horizontal";let l=0;e.shiftKey?l=100:i!=null?l=i:l=10;let c=0;switch(e.key){case"ArrowDown":c=a?0:l;break;case"ArrowLeft":c=a?-l:0;break;case"ArrowRight":c=a?l:0;break;case"ArrowUp":c=a?0:-l;break;case"End":c=100;break;case"Home":c=-100;break}return c}else return s==null?0:mbe(e,t,n,s,o)}function vbe({panelDataArray:e}){const t=Array(e.length),n=e.map(o=>o.constraints);let s=0,i=100;for(let o=0;o<e.length;o++){const a=n[o];ht(a,`Panel constraints not found for index ${o}`);const{defaultSize:l}=a;l!=null&&(s++,t[o]=l,i-=l)}for(let o=0;o<e.length;o++){const a=n[o];ht(a,`Panel constraints not found for index ${o}`);const{defaultSize:l}=a;if(l!=null)continue;const c=e.length-s,d=i/c;s++,t[o]=d,i-=d}return t}function pc(e,t,n){t.forEach((s,i)=>{const o=e[i];ht(o,`Panel data not found for index ${i}`);const{callbacks:a,constraints:l,id:c}=o,{collapsedSize:d=0,collapsible:h}=l,f=n[c];if(f==null||s!==f){n[c]=s;const{onCollapse:p,onExpand:g,onResize:m}=a;m&&m(s,f),h&&(p||g)&&(g&&(f==null||Ao(f,d))&&!Ao(s,d)&&g(),p&&(f==null||!Ao(f,d))&&Ao(s,d)&&p())}})}function Gg(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function bbe({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:i,precision:o=3}){const a=n[i];let l;return a==null?l=e!=null?e.toPrecision(o):"1":s.length===1?l="1":l=a.toPrecision(o),{flexBasis:0,flexGrow:l,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function xbe(e,t=10){let n=null;return(...i)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...i)},t)}}function f8(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function NF(e){return`react-resizable-panels:${e}`}function FF(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:i,order:o}=t;return i?s:o?`${o}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function BF(e,t){try{const n=NF(e),s=t.getItem(n);if(s){const i=JSON.parse(s);if(typeof i=="object"&&i!=null)return i}}catch{}return null}function Cbe(e,t,n){var s,i;const o=(s=BF(e,n))!==null&&s!==void 0?s:{},a=FF(t);return(i=o[a])!==null&&i!==void 0?i:null}function Sbe(e,t,n,s,i){var o;const a=NF(e),l=FF(t),c=(o=BF(e,i))!==null&&o!==void 0?o:{};c[l]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{i.setItem(a,JSON.stringify(c))}catch(d){console.error(d)}}function p8({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((o,a)=>o+a,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(o=>`${o}%`).join(", ")}`);if(!mr(s,100)&&n.length>0)for(let o=0;o<t.length;o++){const a=n[o];ht(a!=null,`No layout data found for index ${o}`);const l=100/s*a;n[o]=l}let i=0;for(let o=0;o<t.length;o++){const a=n[o];ht(a!=null,`No layout data found for index ${o}`);const l=qc({panelConstraints:t,panelIndex:o,size:a});a!=l&&(i+=a-l,n[o]=l)}if(!mr(i,0))for(let o=0;o<t.length;o++){const a=n[o];ht(a!=null,`No layout data found for index ${o}`);const l=a+i,c=qc({panelConstraints:t,panelIndex:o,size:l});if(a!==c&&(i-=c-a,n[o]=c,mr(i,0)))break}return n}const wbe=100,$h={getItem:e=>(f8($h),$h.getItem(e)),setItem:(e,t)=>{f8($h),$h.setItem(e,t)}},g8={};function $F({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:i,id:o=null,onLayout:a=null,keyboardResizeBy:l=null,storage:c=$h,style:d,tagName:h="div",...f}){const p=fj(o),g=Hs(null),[m,y]=su(null),[x,C]=su([]),v=dbe(),b=Hs({}),S=Hs(new Map),w=Hs(0),j=Hs({autoSaveId:e,direction:s,dragState:m,id:p,keyboardResizeBy:l,onLayout:a,storage:c}),E=Hs({layout:x,panelDataArray:[],panelDataArrayChanged:!1});Hs({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),jF(i,()=>({getId:()=>j.current.id,getLayout:()=>{const{layout:V}=E.current;return V},setLayout:V=>{const{onLayout:Y}=j.current,{layout:W,panelDataArray:J}=E.current,N=p8({layout:V,panelConstraints:J.map(B=>B.constraints)});h8(W,N)||(C(N),E.current.layout=N,Y&&Y(N),pc(J,N,b.current))}}),[]),bl(()=>{j.current.autoSaveId=e,j.current.direction=s,j.current.dragState=m,j.current.id=p,j.current.onLayout=a,j.current.storage=c}),gbe({committedValuesRef:j,eagerValuesRef:E,groupId:p,layout:x,panelDataArray:E.current.panelDataArray,setLayout:C,panelGroupElement:g.current}),vl(()=>{const{panelDataArray:V}=E.current;if(e){if(x.length===0||x.length!==V.length)return;let Y=g8[e];Y==null&&(Y=xbe(Sbe,wbe),g8[e]=Y);const W=[...V],J=new Map(S.current);Y(e,W,J,x,c)}},[e,x,c]),vl(()=>{});const A=$s(V=>{const{onLayout:Y}=j.current,{layout:W,panelDataArray:J}=E.current;if(V.constraints.collapsible){const N=J.map(ue=>ue.constraints),{collapsedSize:B=0,panelSize:U,pivotIndices:ie}=Za(J,V,W);if(ht(U!=null,`Panel size not found for panel "${V.id}"`),!Ao(U,B)){S.current.set(V.id,U);const be=_c(J,V)===J.length-1?U-B:B-U,Te=Bh({delta:be,initialLayout:W,panelConstraints:N,pivotIndices:ie,prevLayout:W,trigger:"imperative-api"});Gg(W,Te)||(C(Te),E.current.layout=Te,Y&&Y(Te),pc(J,Te,b.current))}}},[]),L=$s((V,Y)=>{const{onLayout:W}=j.current,{layout:J,panelDataArray:N}=E.current;if(V.constraints.collapsible){const B=N.map(je=>je.constraints),{collapsedSize:U=0,panelSize:ie=0,minSize:ue=0,pivotIndices:be}=Za(N,V,J),Te=Y??ue;if(Ao(ie,U)){const je=S.current.get(V.id),Be=je!=null&&je>=Te?je:Te,De=_c(N,V)===N.length-1?ie-Be:Be-ie,q=Bh({delta:De,initialLayout:J,panelConstraints:B,pivotIndices:be,prevLayout:J,trigger:"imperative-api"});Gg(J,q)||(C(q),E.current.layout=q,W&&W(q),pc(N,q,b.current))}}},[]),M=$s(V=>{const{layout:Y,panelDataArray:W}=E.current,{panelSize:J}=Za(W,V,Y);return ht(J!=null,`Panel size not found for panel "${V.id}"`),J},[]),O=$s((V,Y)=>{const{panelDataArray:W}=E.current,J=_c(W,V);return bbe({defaultSize:Y,dragState:m,layout:x,panelData:W,panelIndex:J})},[m,x]),F=$s(V=>{const{layout:Y,panelDataArray:W}=E.current,{collapsedSize:J=0,collapsible:N,panelSize:B}=Za(W,V,Y);return ht(B!=null,`Panel size not found for panel "${V.id}"`),N===!0&&Ao(B,J)},[]),_=$s(V=>{const{layout:Y,panelDataArray:W}=E.current,{collapsedSize:J=0,collapsible:N,panelSize:B}=Za(W,V,Y);return ht(B!=null,`Panel size not found for panel "${V.id}"`),!N||Pl(B,J)>0},[]),R=$s(V=>{const{panelDataArray:Y}=E.current;Y.push(V),Y.sort((W,J)=>{const N=W.order,B=J.order;return N==null&&B==null?0:N==null?-1:B==null?1:N-B}),E.current.panelDataArrayChanged=!0,v()},[v]);bl(()=>{if(E.current.panelDataArrayChanged){E.current.panelDataArrayChanged=!1;const{autoSaveId:V,onLayout:Y,storage:W}=j.current,{layout:J,panelDataArray:N}=E.current;let B=null;if(V){const ie=Cbe(V,N,W);ie&&(S.current=new Map(Object.entries(ie.expandToSizes)),B=ie.layout)}B==null&&(B=vbe({panelDataArray:N}));const U=p8({layout:B,panelConstraints:N.map(ie=>ie.constraints)});h8(J,U)||(C(U),E.current.layout=U,Y&&Y(U),pc(N,U,b.current))}}),bl(()=>{const V=E.current;return()=>{V.layout=[]}},[]);const D=$s(V=>function(W){W.preventDefault();const J=g.current;if(!J)return()=>null;const{direction:N,dragState:B,id:U,keyboardResizeBy:ie,onLayout:ue}=j.current,{layout:be,panelDataArray:Te}=E.current,{initialLayout:je}=B??{},Be=RF(U,V,J);let Ze=ybe(W,V,N,B,ie,J);const De=N==="horizontal";document.dir==="rtl"&&De&&(Ze=-Ze);const q=Te.map(xe=>xe.constraints),re=Bh({delta:Ze,initialLayout:je??be,panelConstraints:q,pivotIndices:Be,prevLayout:be,trigger:_F(W)?"keyboard":"mouse-or-touch"}),oe=!Gg(be,re);(IF(W)||AF(W))&&w.current!=Ze&&(w.current=Ze,!oe&&Ze!==0?De?sb(V,Ze<0?MF:PF):sb(V,Ze<0?EF:LF):sb(V,0)),oe&&(C(re),E.current.layout=re,ue&&ue(re),pc(Te,re,b.current))},[]),$=$s((V,Y)=>{const{onLayout:W}=j.current,{layout:J,panelDataArray:N}=E.current,B=N.map(je=>je.constraints),{panelSize:U,pivotIndices:ie}=Za(N,V,J);ht(U!=null,`Panel size not found for panel "${V.id}"`);const be=_c(N,V)===N.length-1?U-Y:Y-U,Te=Bh({delta:be,initialLayout:J,panelConstraints:B,pivotIndices:ie,prevLayout:J,trigger:"imperative-api"});Gg(J,Te)||(C(Te),E.current.layout=Te,W&&W(Te),pc(N,Te,b.current))},[]),G=$s((V,Y)=>{const{layout:W,panelDataArray:J}=E.current,{collapsedSize:N=0,collapsible:B}=Y,{collapsedSize:U=0,collapsible:ie,maxSize:ue=100,minSize:be=0}=V.constraints,{panelSize:Te}=Za(J,V,W);Te!=null&&(B&&ie&&Ao(Te,N)?Ao(N,U)||$(V,U):Te<be?$(V,be):Te>ue&&$(V,ue))},[$]),ee=$s((V,Y)=>{const{direction:W}=j.current,{layout:J}=E.current;if(!g.current)return;const N=fy(V,g.current);ht(N,`Drag handle element not found for id "${V}"`);const B=OF(W,Y);y({dragHandleId:V,dragHandleRect:N.getBoundingClientRect(),initialCursorPosition:B,initialLayout:J})},[]),Q=$s(()=>{y(null)},[]),se=$s(V=>{const{panelDataArray:Y}=E.current,W=_c(Y,V);W>=0&&(Y.splice(W,1),delete b.current[V.id],E.current.panelDataArrayChanged=!0,v())},[v]),ne=Xve(()=>({collapsePanel:A,direction:s,dragState:m,expandPanel:L,getPanelSize:M,getPanelStyle:O,groupId:p,isPanelCollapsed:F,isPanelExpanded:_,reevaluatePanelConstraints:G,registerPanel:R,registerResizeHandle:D,resizePanel:$,startDragging:ee,stopDragging:Q,unregisterPanel:se,panelGroupElement:g.current}),[A,m,s,L,M,O,p,F,_,G,R,D,$,ee,Q,se]),H={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return ku(cy.Provider,{value:ne},ku(h,{...f,children:t,className:n,id:o,ref:g,style:{...H,...d},"data-panel-group":"","data-panel-group-direction":s,"data-panel-group-id":p}))}const Gp=SF((e,t)=>ku($F,{...e,forwardedRef:t}));$F.displayName="PanelGroup";Gp.displayName="forwardRef(PanelGroup)";function _c(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function Za(e,t,n){const s=_c(e,t),o=s===e.length-1?[s-1,s]:[s,s+1],a=n[s];return{...t.constraints,panelSize:a,pivotIndices:o}}function jbe({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){vl(()=>{if(e||n==null||s==null)return;const i=fy(t,s);if(i==null)return;const o=a=>{if(!a.defaultPrevented)switch(a.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{a.preventDefault(),n(a);break}case"F6":{a.preventDefault();const l=i.getAttribute("data-panel-group-id");ht(l,`No group element found for id "${l}"`);const c=El(l,s),d=DF(l,t,s);ht(d!==null,`No resize element found for id "${t}"`);const h=a.shiftKey?d>0?d-1:c.length-1:d+1<c.length?d+1:0;c[h].focus();break}}};return i.addEventListener("keydown",o),()=>{i.removeEventListener("keydown",o)}},[s,e,t,n])}function VF({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:i,onBlur:o,onDragging:a,onFocus:l,style:c={},tabIndex:d=0,tagName:h="div",...f}){var p,g;const m=Hs(null),y=Hs({onDragging:a});vl(()=>{y.current.onDragging=a});const x=wF(cy);if(x===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:C,groupId:v,registerResizeHandle:b,startDragging:S,stopDragging:w,panelGroupElement:j}=x,E=fj(i),[A,L]=su("inactive"),[M,O]=su(!1),[F,_]=su(null),R=Hs({state:A});bl(()=>{R.current.state=A}),vl(()=>{if(n)_(null);else{const ee=b(E);_(()=>ee)}},[n,E,b]);const D=(p=s==null?void 0:s.coarse)!==null&&p!==void 0?p:15,$=(g=s==null?void 0:s.fine)!==null&&g!==void 0?g:5;return vl(()=>{if(n||F==null)return;const ee=m.current;return ht(ee,"Element ref not attached"),ube(E,ee,C,{coarse:D,fine:$},(se,ne,H)=>{if(ne)switch(se){case"down":{L("drag"),ht(H,'Expected event to be defined for "down" action'),S(E,H);const{onDragging:V}=y.current;V&&V(!0);break}case"move":{const{state:V}=R.current;V!=="drag"&&L("hover"),ht(H,'Expected event to be defined for "move" action'),F(H);break}case"up":{L("hover"),w();const{onDragging:V}=y.current;V&&V(!1);break}}else L("inactive")})},[D,C,n,$,b,E,F,S,w]),jbe({disabled:n,handleId:E,resizeHandler:F,panelGroupElement:j}),ku(h,{...f,children:e,className:t,id:i,onBlur:()=>{O(!1),o==null||o()},onFocus:()=>{O(!0),l==null||l()},ref:m,role:"separator",style:{...{touchAction:"none",userSelect:"none"},...c},tabIndex:d,"data-panel-group-direction":C,"data-panel-group-id":v,"data-resize-handle":"","data-resize-handle-active":A==="drag"?"pointer":M?"keyboard":void 0,"data-resize-handle-state":A,"data-panel-resize-handle-enabled":!n,"data-panel-resize-handle-id":E})}VF.displayName="PanelResizeHandle";const kbe=$o(VF),_be=e=>r.jsx(kbe,{...e,sx:Ibe}),Tf=u.memo(_be),Ibe={'&[data-resize-handle-state="hover"]':{_before:{background:"base.600 !important"}},'&[data-resize-handle-state="drag"]':{_before:{background:"base.500 !important"}},'&[data-panel-group-direction="horizontal"]':{w:4,h:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"normal",content:'""',w:"2px",h:"full",background:"base.800",position:"absolute",left:"50%",top:0,transform:"translateX(-50%)"}},'&[data-panel-group-direction="vertical"]':{h:4,w:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"normal",content:'""',w:"full",h:"2px",background:"base.800",position:"absolute",top:"50%",left:0,transform:"translateY(-50%)"}}},GF=u.memo(({firstImage:e,secondImage:t})=>{const n=u.useRef(null),s=u.useCallback(()=>{n.current&&n.current.setLayout([50,50])},[]);return r.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(Gp,{ref:n,direction:"horizontal",id:"image-comparison-side-by-side",autoSaveId:"image-comparison-side-by-side",children:[r.jsx(Xi,{minSize:20,children:r.jsx(T,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsxs(T,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:e.width/e.height,children:[r.jsx(dn,{id:"image-comparison-side-by-side-first-image",w:e.width,h:e.height,maxW:"full",maxH:"full",src:e.image_url,fallbackSrc:e.thumbnail_url,objectFit:"contain",borderRadius:"base"}),r.jsx(Ml,{type:"first"})]})})}),r.jsx(Tf,{id:"image-comparison-side-by-side-handle",onDoubleClick:s}),r.jsx(Xi,{minSize:20,children:r.jsx(T,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsxs(T,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:t.width/t.height,children:[r.jsx(dn,{id:"image-comparison-side-by-side-first-image",w:t.width,h:t.height,maxW:"full",maxH:"full",src:t.image_url,fallbackSrc:t.thumbnail_url,objectFit:"contain",borderRadius:"base"}),r.jsx(Ml,{type:"second"})]})})})]})})})});GF.displayName="ImageComparisonSideBySide";const zF="50%",yj=2,Abe=`${yj}px`,py=20,Tbe=`${py}px`,Mbe=`${py/2-yj/2}px`,Pbe=`calc(${zF} - ${py/2}px)`,HF=u.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=I(AC),[i,o]=u.useState(Pbe),[a,l]=u.useState(zF),c=u.useRef(null),d=u.useRef(null),h=u.useRef(null),f=u.useRef(0),p=u.useMemo(()=>Z9(n,e),[n,e]),g=u.useMemo(()=>Y9(s,p,e,t),[s,p,e,t]),m=u.useCallback(v=>{if(!c.current||!d.current)return;f.current=performance.now();const{x:b,width:S}=d.current.getBoundingClientRect(),w=(v-b)*100/S,j=yj*100/S,E=Math.min(100-j,Math.max(0,w));l(`${E}%`),o(`calc(${E}% - ${py/2}px)`)},[]),y=u.useCallback(v=>{h.current===null&&performance.now()>f.current+1e3/60&&(h.current=window.requestAnimationFrame(()=>{m(v.clientX),h.current=null}))},[m]),x=u.useCallback(()=>{window.removeEventListener("mousemove",y)},[y]),C=u.useCallback(v=>{m(v.clientX),window.addEventListener("mouseup",x,{once:!0}),window.addEventListener("mousemove",y)},[y,x,m]);return u.useEffect(()=>()=>{h.current!==null&&cancelAnimationFrame(h.current)},[]),r.jsx(T,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:r.jsx(T,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:r.jsxs(ke,{ref:d,position:"relative",id:"image-comparison-image-container",w:p.width,h:p.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[r.jsx(ke,{id:"image-comparison-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:td,backgroundRepeat:"repeat"}),r.jsx(dn,{position:"relative",id:"image-comparison-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:g.width,h:g.height,maxW:p.width,maxH:p.height,objectFit:s,objectPosition:"top left"}),r.jsx(Ml,{type:"second"}),r.jsxs(ke,{id:"image-comparison-first-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,w:a,overflow:"hidden",children:[r.jsx(dn,{id:"image-comparison-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:p.width,h:p.height,objectFit:"cover",objectPosition:"top left"}),r.jsx(Ml,{type:"first"})]}),r.jsxs(T,{id:"image-comparison-handle",ref:c,position:"absolute",top:0,bottom:0,left:i,w:Tbe,cursor:"ew-resize",filter:n2,opacity:.8,color:"base.50",children:[r.jsx(ke,{id:"image-comparison-handle-divider",w:Abe,h:"full",bg:"currentColor",shadow:"dark-lg",position:"absolute",top:0,left:Mbe}),r.jsxs(T,{id:"image-comparison-handle-icons",gap:4,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, 0)",filter:n2,children:[r.jsx(pt,{as:vS}),r.jsx(pt,{as:A1})]})]}),r.jsx(ke,{id:"image-comparison-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseDown:C,onContextMenu:xF,userSelect:"none",cursor:"ew-resize"})]})})})});HF.displayName="ImageComparisonSlider";const WF=u.memo(({containerDims:e})=>{const{t}=P(),n=I(WM),{firstImage:s,secondImage:i}=I(X9);if(!s||!i)return r.jsx(Yt,{label:t("gallery.selectAnImageToCompare"),icon:AE});if(n==="slider")return r.jsx(HF,{containerDims:e,firstImage:s,secondImage:i});if(n==="side-by-side")return r.jsx(GF,{containerDims:e,firstImage:s,secondImage:i});if(n==="hover")return r.jsx(CF,{containerDims:e,firstImage:s,secondImage:i})});WF.displayName="ImageComparison";const UF=u.memo(()=>{const{t:e}=P(),t=u.useMemo(()=>o2.getData(),[]);return r.jsx(vs,{dndTarget:o2,dndTargetData:t,label:e("gallery.selectForCompare")})});UF.displayName="ImageComparisonDroppable";const qF=u.memo(()=>{const e=z(),t=I(OP),n=I(Vf),{t:s}=P(),i=u.useCallback(()=>e(tZ(!t)),[e,t]);return Ee({id:"toggleMetadata",category:"viewer",callback:i,options:{enabled:!!n},dependencies:[n,t]}),r.jsx(ae,{icon:r.jsx(Gu,{}),tooltip:`${s("parameters.info")} (I)`,"aria-label":`${s("parameters.info")} (I)`,onClick:i,isDisabled:!n,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-metadata-button"})});qF.displayName="ToggleMetadataViewerButton";const KF=u.memo(()=>{const e=z(),t=I(sS),{t:n}=P(),s=u.useCallback(()=>{e(XM(!t))},[e,t]);return r.jsx(ae,{"aria-label":n("settings.displayInProgress"),tooltip:n("settings.displayInProgress"),icon:r.jsx(Ioe,{}),onClick:s,variant:"link",alignSelf:"stretch",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-progress-button"})});KF.displayName="ToggleProgressButton";const ZF=u.memo(e=>{const{onClick:t,isDisabled:n}=e,{t:s}=P(),i=ce(An),o=I(bC),a=`${s("gallery.deleteImage",{count:o})} (Del)`;return r.jsx(ae,{onClick:t,icon:r.jsx(Xr,{}),tooltip:a,"aria-label":a,isDisabled:n||!i,colorScheme:"error",variant:"link",alignSelf:"stretch"})});ZF.displayName="DeleteImageButton";const Ebe=()=>{const{t:e}=P(),[t,{isLoading:n}]=Ip(),s=I(QM),i=z(),o=u.useMemo(()=>{var p;if(!(!t.length||!s))return(p=t.find(g=>g.key===(s==null?void 0:s.key)))==null?void 0:p.description},[t,s]),a=u.useCallback(p=>{i(nZ(p))},[i]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Fa({modelConfigs:t,onChange:a,selectedModel:s,isLoading:n});return r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:e("upscaling.postProcessingModel")}),r.jsx(Le,{label:o,children:r.jsx(ke,{w:"full",children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})},Lbe=u.memo(Ebe),Dbe=()=>{const[e,{isLoading:t}]=rC(V0),[n,{isLoading:s}]=JM({fixedCacheKey:"resumeProcessor"}),[i,{isLoading:o}]=e3({fixedCacheKey:"pauseProcessor"}),[a,{isLoading:l}]=tC({fixedCacheKey:"cancelQueueItem"}),[c,{isLoading:d}]=DT({fixedCacheKey:"clearQueue"}),[h,{isLoading:f}]=t3({fixedCacheKey:"pruneQueue"});return t||s||o||l||d||f},YF=u.memo(e=>{const{imageDTO:t}=e,n=z(),s=I(QM),i=Dbe(),{t:o}=P(),{isOpen:a,onOpen:l,onClose:c}=ar(),d=u.useCallback(()=>{c(),t&&n(TT({imageDTO:t}))},[n,t,c]);return r.jsxs(Vn,{isOpen:a,onClose:c,isLazy:!0,children:[r.jsx(Yn,{children:r.jsx(ae,{tooltip:o("parameters.postProcessing"),onClick:l,icon:r.jsx(vp,{}),"aria-label":o("parameters.postProcessing"),variant:"link",alignSelf:"stretch"})}),r.jsx(Gn,{children:r.jsx(Xn,{w:96,children:r.jsxs(T,{flexDirection:"column",gap:4,children:[r.jsx(Lbe,{}),!s&&r.jsx(Rbe,{}),r.jsx(ye,{size:"sm",isDisabled:!t||i||!s,onClick:d,children:o("parameters.processImage")})]})})})]})});YF.displayName="PostProcessingPopover";const Rbe=()=>{const e=z(),t=u.useCallback(()=>{e(bt("models")),Al.set(3)},[e]);return r.jsx(T,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:r.jsx(K,{children:r.jsx(Xt,{i18nKey:"upscaling.postProcessingMissingModelWarning",components:{LinkComponent:r.jsx(ye,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:t})}})})})},Obe=()=>{const e=I(Vf),{currentData:t}=Pa((e==null?void 0:e.image_name)??ws);return t?r.jsx(XF,{imageDTO:t}):null},Nbe=u.memo(Obe),XF=u.memo(({imageDTO:e})=>{const{t}=P(),n=ce($0),s=rS(e),i=I(Dn),o=un("upscaling");return r.jsxs(r.Fragment,{children:[r.jsxs(Qt,{isLazy:!0,children:[r.jsx(Jt,{as:ae,"aria-label":t("parameters.imageActions"),tooltip:t("parameters.imageActions"),isDisabled:!e,variant:"link",alignSelf:"stretch",icon:r.jsx(SS,{})}),r.jsx(kt,{children:e&&r.jsx(MD,{imageDTO:e})})]}),r.jsx(Et,{orientation:"vertical",h:8,mx:2}),r.jsx(ae,{icon:r.jsx(T1,{}),tooltip:`${t("nodes.loadWorkflow")} (W)`,"aria-label":`${t("nodes.loadWorkflow")} (W)`,isDisabled:!s.hasWorkflow||!n,variant:"link",alignSelf:"stretch",onClick:s.loadWorkflow}),r.jsx(ae,{icon:r.jsx(Bm,{}),tooltip:`${t("parameters.remixImage")} (R)`,"aria-label":`${t("parameters.remixImage")} (R)`,isDisabled:!s.hasMetadata,variant:"link",alignSelf:"stretch",onClick:s.remix}),r.jsx(ae,{icon:r.jsx(RE,{}),tooltip:`${t("parameters.usePrompt")} (P)`,"aria-label":`${t("parameters.usePrompt")} (P)`,isDisabled:!s.hasPrompts,variant:"link",alignSelf:"stretch",onClick:s.recallPrompts}),r.jsx(ae,{icon:r.jsx(LE,{}),tooltip:`${t("parameters.useSeed")} (S)`,"aria-label":`${t("parameters.useSeed")} (S)`,isDisabled:!s.hasSeed,variant:"link",alignSelf:"stretch",onClick:s.recallSeed}),r.jsx(ae,{icon:r.jsx(Foe,{}),tooltip:`${t("parameters.useSize")} (D)`,"aria-label":`${t("parameters.useSize")} (D)`,variant:"link",alignSelf:"stretch",onClick:s.recallSize,isDisabled:i}),r.jsx(ae,{icon:r.jsx(xE,{}),tooltip:`${t("parameters.useAll")} (A)`,"aria-label":`${t("parameters.useAll")} (A)`,isDisabled:!s.hasMetadata,variant:"link",alignSelf:"stretch",onClick:s.recallAll}),o&&r.jsx(YF,{imageDTO:e}),r.jsx(Et,{orientation:"vertical",h:8,mx:2}),r.jsx(ZF,{onClick:s.delete})]})});XF.displayName="CurrentImageButtonsContent";const QF=u.memo(({closeButton:e})=>r.jsxs(T,{w:"full",px:2,gap:2,bg:"base.750",borderTopRadius:"base",h:12,children:[r.jsx(T,{flex:1,justifyContent:"center",children:r.jsxs(T,{marginInlineEnd:"auto",alignItems:"center",children:[r.jsx(KF,{}),r.jsx(qF,{})]})}),r.jsx(T,{flex:1,justifyContent:"center",alignItems:"center",children:r.jsx(Nbe,{})}),r.jsx(T,{flex:1,justifyContent:"center",children:r.jsx(T,{marginInlineStart:"auto",alignItems:"center",children:e})})]}));QF.displayName="ViewerToolbar";var Fbe=function(){},JF=typeof window<"u",Bbe=JF?u.useLayoutEffect:u.useEffect,eB={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function $be(){var e=u.useState(null),t=e[0],n=e[1],s=u.useState(eB),i=s[0],o=s[1],a=u.useMemo(function(){return new window.ResizeObserver(function(l){if(l[0]){var c=l[0].contentRect,d=c.x,h=c.y,f=c.width,p=c.height,g=c.top,m=c.left,y=c.bottom,x=c.right;o({x:d,y:h,width:f,height:p,top:g,left:m,bottom:y,right:x})}})},[]);return Bbe(function(){if(t)return a.observe(t),function(){a.disconnect()}},[t]),[n,i]}const tB=JF&&typeof window.ResizeObserver<"u"?$be:function(){return[Fbe,eB]},Vbe={focusOnMount:!0},gy=u.memo(({closeButton:e})=>{wt("ImageViewer");const t=I(sZ),[n,s]=tB(),i=u.useRef(null);return Go("viewer",i,Vbe),r.jsxs(T,{ref:i,tabIndex:-1,layerStyle:"first",borderRadius:"base",position:"absolute",flexDirection:"column",top:0,right:0,bottom:0,left:0,alignItems:"center",justifyContent:"center",overflow:"hidden",children:[t&&r.jsx(HN,{}),!t&&r.jsx(QF,{closeButton:e}),r.jsxs(ke,{ref:n,w:"full",h:"full",p:2,children:[!t&&r.jsx(Wve,{}),t&&r.jsx(WF,{containerDims:s})]}),r.jsx(UF,{})]})});gy.displayName="ImageViewer";const nB=u.memo(()=>Lt().isOpen?r.jsx(gy,{closeButton:r.jsx(vj,{})}):null);nB.displayName="GatedImageViewer";const vj=u.memo(()=>{const{t:e}=P(),t=Lt();return wt("ImageViewerCloseButton"),Si("esc",t.close),r.jsx(ae,{tooltip:e("gallery.closeViewer"),"aria-label":e("gallery.closeViewer"),icon:r.jsx(Nt,{}),variant:"link",alignSelf:"stretch",onClick:t.close})});vj.displayName="ImageViewerCloseButton";const Gbe=u.memo(()=>Lt().isOpen?r.jsx(vj,{}):null);Gbe.displayName="GatedImageViewerCloseButton";const m8=()=>r.jsx(zr,{children:r.jsxs(kt,{children:[r.jsx(K9,{}),r.jsx(M9,{})]})}),sB=u.memo(()=>{const e=u.useRef(null),t=I(Lm),n=I(rZ),s=u.useCallback(()=>r.jsx(m8,{}),[]);return Go("canvas",e),r.jsxs(T,{tabIndex:-1,ref:e,borderRadius:"base",position:"relative",flexDirection:"column",height:"full",width:"full",gap:2,alignItems:"center",justifyContent:"center",overflow:"hidden",children:[r.jsx(zr,{children:r.jsx(VN,{})}),r.jsx(s1,{renderMenu:s,withLongPress:!1,children:i=>r.jsxs(T,{ref:i,position:"relative",w:"full",h:"full",bg:t?"base.850":"base.900",borderRadius:"base",overflow:"hidden",children:[r.jsx(DO,{}),r.jsxs(zr,{children:[r.jsxs(T,{position:"absolute",flexDir:"column",top:1,insetInlineStart:1,pointerEvents:"none",gap:2,alignItems:"flex-start",children:[n&&r.jsx(IO,{}),r.jsx(qR,{}),r.jsx(FR,{}),r.jsx(Yme,{}),r.jsx(sj,{})]}),r.jsx(T,{position:"absolute",top:1,insetInlineEnd:1,children:r.jsxs(Qt,{children:[r.jsx(Jt,{as:ae,icon:r.jsx(Yoe,{}),colorScheme:"base"}),r.jsx(m8,{})]})})]})]})}),r.jsx(T,{position:"absolute",bottom:4,gap:2,align:"center",justify:"center",children:r.jsx(zr,{children:r.jsx($O,{children:r.jsx(YO,{})})})}),r.jsx(T,{position:"absolute",bottom:4,children:r.jsxs(zr,{children:[r.jsx(wO,{}),r.jsx(Oye,{}),r.jsx(FO,{})]})}),r.jsx(zr,{children:r.jsx(Q9,{})}),r.jsx(nB,{})]})});sB.displayName="CanvasMainPanelContent";const rB=u.memo(()=>{const{t:e}=P(),t=uS(),n=dS(),s=cS(),i=lS(),o=hS(),a=tE(),l=I(xi),c=I($l);return r.jsx(T,{w:"full",h:"full",justifyContent:"center",gap:4,children:r.jsxs(T,{position:"relative",flexDir:"column",gap:4,top:"20%",children:[r.jsxs(T,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[r.jsx(Ot,{size:"xs",children:e("controlLayers.global")}),r.jsx(Ve,{feature:"globalReferenceImage",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Ht,{}),onClick:o,isDisabled:c,children:e("controlLayers.globalReferenceImage")})})]}),r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(Ot,{size:"xs",children:e("controlLayers.regional")}),r.jsx(Ve,{feature:"inpainting",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Ht,{}),onClick:t,children:e("controlLayers.inpaintMask")})}),r.jsx(Ve,{feature:"regionalGuidance",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Ht,{}),onClick:n,isDisabled:c,children:e("controlLayers.regionalGuidance")})}),r.jsx(Ve,{feature:"regionalReferenceImage",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Ht,{}),onClick:a,isDisabled:l||c,children:e("controlLayers.regionalReferenceImage")})})]}),r.jsxs(T,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[r.jsx(Ot,{size:"xs",children:e("controlLayers.layer_other")}),r.jsx(Ve,{feature:"controlNet",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Ht,{}),onClick:i,isDisabled:c,children:e("controlLayers.controlLayer")})}),r.jsx(Ve,{feature:"rasterLayer",children:r.jsx(ye,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:r.jsx(Ht,{}),onClick:s,children:e("controlLayers.rasterLayer")})})]})]})})});rB.displayName="CanvasAddEntityButtons";function y8(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),n.push.apply(n,s)}return n}function v8(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y8(Object(n),!0).forEach(function(s){yi(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y8(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}var zbe={top:function(t,n){return Math.abs(n.y-t.top)},right:function(t,n){return Math.abs(t.right-n.x)},bottom:function(t,n){return Math.abs(t.bottom-n.y)},left:function(t,n){return Math.abs(n.x-t.left)}},iB=Symbol("closestEdge");function Hbe(e,t){var n,s,i=t.element,o=t.input,a=t.allowedEdges,l={x:o.clientX,y:o.clientY},c=i.getBoundingClientRect(),d=a.map(function(f){return{edge:f,value:zbe[f](c,l)}}),h=(n=(s=d.sort(function(f,p){return f.value-p.value})[0])===null||s===void 0?void 0:s.edge)!==null&&n!==void 0?n:null;return v8(v8({},e),{},yi({},iB,h))}function b2(e){var t;return(t=e[iB])!==null&&t!==void 0?t:null}function Wbe(e){var t=e.list,n=e.startIndex,s=e.finishIndex;if(n===-1||s===-1)return t;var i=Array.from(t),o=i.splice(n,1),a=_S(o,1),l=a[0];return i.splice(s,0,l),i}function Ic(e){var t=e.startIndex,n=e.closestEdgeOfTarget,s=e.indexOfTarget,i=e.axis;if(t===-1||s===-1||t===s)return t;if(n==null)return s;var o=i==="vertical"&&n==="bottom"||i==="horizontal"&&n==="right",a=t<s;return a?o?s:s-1:o?s+1:s}function x2(e){var t=e.list,n=e.startIndex,s=e.closestEdgeOfTarget,i=e.indexOfTarget,o=e.axis;return Wbe({list:t,startIndex:n,finishIndex:Ic({closestEdgeOfTarget:s,startIndex:n,indexOfTarget:i,axis:o})})}const Qi=e=>`var(--invoke-colors-${e.split(".").join("-")})`,my={overflow:"visible"},oB=u.memo(({type:e})=>{const{t}=P(),n=tt(),s=uS(),i=dS(),o=cS(),a=lS(),l=hS(),c=u.useCallback(()=>{switch(e){case"inpaint_mask":s();break;case"regional_guidance":i();break;case"raster_layer":o();break;case"control_layer":a();break;case"reference_image":l();break}},[a,l,s,o,i,e]),d=u.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.addInpaintMask");case"regional_guidance":return t("controlLayers.addRegionalGuidance");case"raster_layer":return t("controlLayers.addRasterLayer");case"control_layer":return t("controlLayers.addControlLayer");case"reference_image":return t("controlLayers.addGlobalReferenceImage")}},[e,t]);return r.jsx(ae,{size:"sm","aria-label":d,tooltip:d,variant:"link",icon:r.jsx(ps,{}),onClick:c,alignSelf:"stretch",isDisabled:n})});oB.displayName="CanvasEntityAddOfTypeButton";const Ube=e=>{const t=u.useMemo(()=>{switch(e){case"control_layer":return ve(CM,s=>s.length);case"raster_layer":return ve(jC,s=>s.length);case"inpaint_mask":return ve(wM,s=>s.length);case"regional_guidance":return ve(SM,s=>s.length);case"reference_image":return ve(iZ,s=>s.length);default:Re(!1,"Invalid entity type")}},[e]);return I(t)},aB=u.memo(({type:e})=>{const{t}=P(),n=Tt(),s=tt(),i=Ube(e),o=u.useCallback(()=>{n.compositor.mergeVisibleOfType(e)},[n.compositor,e]);return r.jsx(ae,{size:"sm","aria-label":t("controlLayers.mergeVisible"),tooltip:t("controlLayers.mergeVisible"),variant:"link",icon:r.jsx(Hoe,{}),onClick:o,alignSelf:"stretch",isDisabled:i<=1||s})});aB.displayName="CanvasEntityMergeVisibleButton";const lB=u.memo(({type:e})=>{const{t}=P(),n=z(),s=aw(e),i=W9(e,!0),o=u.useCallback(a=>{a.stopPropagation(),n(oZ({type:e}))},[n,e]);return r.jsx(ae,{size:"sm","aria-label":t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:i}),tooltip:t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:i}),variant:"link",icon:s?r.jsx(Soe,{}):r.jsx(yp,{}),onClick:o,alignSelf:"stretch"})});lB.displayName="CanvasEntityTypeIsHiddenToggle";const qbe=e=>u.useMemo(()=>{switch(e){case"control_layer":return"controlNet";case"inpaint_mask":return"inpainting";case"raster_layer":return"rasterLayer";case"regional_guidance":return"regionalGuidanceAndReferenceImage";case"reference_image":return"globalReferenceImage";default:return}},[e]),Kbe=e=>{const t=u.useMemo(()=>ve(Je,s=>{switch(e){case"control_layer":return s.controlLayers.entities.length;case"raster_layer":return s.rasterLayers.entities.length;case"inpaint_mask":return s.inpaintMasks.entities.length;case"regional_guidance":return s.regionalGuidance.entities.length;case"reference_image":return s.referenceImages.entities.length;default:return 0}}),[e]);return I(t)},Zbe=e=>{const{t}=P(),n=aw(e),s=Kbe(e);return u.useMemo(()=>{const o=n?"hidden":"visible";switch(e){case"control_layer":return t("controlLayers.controlLayers_withCount",{count:s,context:o});case"raster_layer":return t("controlLayers.rasterLayers_withCount",{count:s,context:o});case"inpaint_mask":return t("controlLayers.inpaintMasks_withCount",{count:s,context:o});case"regional_guidance":return t("controlLayers.regionalGuidance_withCount",{count:s,context:o});case"reference_image":return t("controlLayers.globalReferenceImages_withCount",{count:s,context:o});default:return""}},[e,t,s,n])},id=u.memo(({isSelected:e,type:t,children:n,entityIdentifiers:s})=>{const i=Zbe(t),o=qbe(t),a=Xf(!0),l=z();return u.useEffect(()=>qi({canMonitor({source:c}){return!(!nu.typeGuard(c.data)||c.data.payload.entityIdentifier.type!==t)},onDrop({location:c,source:d}){const h=c.current.dropTargets[0];if(!h)return;const f=d.data,p=h.data;if(!nu.typeGuard(f)||!nu.typeGuard(p))return;const g=s.findIndex(v=>v.id===f.payload.entityIdentifier.id),m=s.findIndex(v=>v.id===p.payload.entityIdentifier.id);if(m<0||g<0||g===m)return;const y=b2(p);let x=0;if(y==="bottom"?x=1:y==="top"&&(x=-1),g===m+x)return;Wl.flushSync(()=>{l(aZ({type:t,entityIdentifiers:x2({list:s,startIndex:g,indexOfTarget:m,closestEdgeOfTarget:y,axis:"vertical"})}))});const C=document.querySelector(`[data-entity-id="${f.payload.entityIdentifier.id}"]`);C instanceof HTMLElement&&ZN(C,Qi("base.700"))}}),[l,s,t]),r.jsxs(T,{flexDir:"column",w:"full",children:[r.jsxs(T,{w:"full",children:[r.jsxs(T,{flexGrow:1,as:ye,onClick:a.toggle,justifyContent:"space-between",alignItems:"center",gap:3,variant:"unstyled",p:0,h:8,children:[r.jsx(pt,{boxSize:4,as:Pr,transform:a.isTrue?void 0:"rotate(-90deg)",fill:e?"base.200":"base.500",transitionProperty:"common",transitionDuration:"fast"}),o?r.jsx(Ve,{feature:o,children:r.jsx(K,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:i})}):r.jsx(K,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:i}),r.jsx(nt,{})]}),Uk(t)&&r.jsx(aB,{type:t}),Uk(t)&&r.jsx(lB,{type:t}),r.jsx(oB,{type:t})]}),r.jsx(ql,{in:a.isTrue,style:my,children:r.jsx(T,{flexDir:"column",gap:2,pt:2,children:n})})]})});id.displayName="CanvasEntityGroupList";const zg={type:"idle"},Ybe=(e,t)=>{const[n,s]=u.useState(zg),[i,o]=u.useState(!1);return u.useEffect(()=>{const a=e.current;if(a)return Kn(nd(a),Wu({element:a,getInitialData(){return nu.getData({entityIdentifier:t})},onDragStart(){s({type:"is-dragging"}),o(!0)},onDrop(){s(zg),o(!1)}}),yu({element:a,canDrop({source:l}){return!(!nu.typeGuard(l.data)||l.data.payload.entityIdentifier.type!==t.type)},getData({input:l}){const c=nu.getData({entityIdentifier:t});return Hbe(c,{element:a,input:l,allowedEdges:["top","bottom"]})},getIsSticky(){return!0},onDragEnter({self:l}){const c=b2(l.data);s({type:"is-dragging-over",closestEdge:c})},onDrag({self:l}){const c=b2(l.data);s(d=>d.type==="is-dragging-over"&&d.closestEdge===c?d:{type:"is-dragging-over",closestEdge:c})},onDragLeave(){s(zg)},onDrop(){s(zg)}}))},[t,e]),[n,i]},cB=e=>{const t=u.useMemo(()=>ve(kn,s=>(s==null?void 0:s.id)===e.id),[e.id]);return I(t)},I0={thickness:2,backgroundColor:"red"},Xbe={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:I0.backgroundColor},Qbe={horizontal:{height:`${I0.thickness}px`,left:2,right:2},vertical:{width:`${I0.thickness}px`,top:2,bottom:2}},Jbe={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},exe={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function txe({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${I0.thickness}px))`,s=Jbe[e];return r.jsx(ke,{sx:{...Xbe,...Qbe[s],...exe[e],"--local-line-offset":n}})}const nxe=({dndState:e,gap:t})=>e.type!=="is-dragging-over"||!e.closestEdge?null:r.jsx(txe,{edge:e.closestEdge,gap:t||"var(--invoke-space-2)"}),sxe={position:"relative",flexDir:"column",w:"full",bg:"base.850",borderRadius:"base","&[data-selected=true]":{bg:"base.800"},"&[data-is-dragging=true]":{opacity:.3},transitionProperty:"common"},od=u.memo(e=>{const t=z(),n=Ke(),s=cB(n),i=u.useCallback(()=>{s||t(Zc({entityIdentifier:n}))},[t,n,s]),o=u.useRef(null),[a,l]=Ybe(o,n);return r.jsxs(ke,{position:"relative",children:[r.jsx(T,{"data-entity-id":n.id,"data-selected":s,"data-is-dragging":l,ref:o,onClick:i,sx:sxe,children:e.children}),r.jsx(nxe,{dndState:a})]})});od.displayName="CanvasEntityContainer";const ad=u.memo(({children:e,...t})=>{const n=Ke(),s=u.useCallback(()=>{if(n.type==="regional_guidance")return r.jsx(kt,{children:r.jsx(Kw,{})});if(n.type==="inpaint_mask")return r.jsx(kt,{children:r.jsx(Ww,{})});if(n.type==="raster_layer")return r.jsx(kt,{children:r.jsx(qw,{})});if(n.type==="control_layer")return r.jsx(kt,{children:r.jsx(Hw,{})});if(n.type==="reference_image")return r.jsx(kt,{children:r.jsx(Uw,{})});Re(!1,"Unhandled entity type")},[n]);return r.jsx(s1,{renderMenu:s,children:i=>r.jsx(T,{ref:i,gap:2,alignItems:"center",p:2,...t,children:e})})});ad.displayName="CanvasEntityHeader";const uB=u.memo(()=>{const{t:e}=P(),t=Ke(),n=z(),s=tt(),i=u.useCallback(()=>{n(SC({entityIdentifier:t}))},[n,t]);return r.jsx(ae,{size:"sm","aria-label":e("common.delete"),tooltip:e("common.delete"),variant:"link",alignSelf:"stretch",icon:r.jsx(L1,{}),onClick:i,colorScheme:"error",isDisabled:s})});uB.displayName="CanvasEntityDeleteButton";const dB=e=>{const t=u.useMemo(()=>ve(Je,s=>{const i=Aa(s,e);return i?i.isEnabled:!1}),[e]);return I(t)},hB=u.memo(()=>{const{t:e}=P(),t=Ke(),n=dB(t),s=tt(),i=z(),o=u.useCallback(()=>{i(lZ({entityIdentifier:t}))},[i,t]);return r.jsx(ae,{size:"sm","aria-label":e(n?"common.enabled":"common.disabled"),tooltip:e(n?"common.enabled":"common.disabled"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(Koe,{}):r.jsx(poe,{}),onClick:o,isDisabled:s})});hB.displayName="CanvasEntityEnabledToggle";const rxe=(e,t)=>ve(Je,ip,(n,s)=>{const i=Mr(n,e,"CanvasEntityHeaderWarnings");let o=[];const a=i.type;return a==="control_layer"?o=cZ(i,s):a==="regional_guidance"?o=uZ(i,s):a==="inpaint_mask"?o=fZ():a==="raster_layer"?o=pZ():a==="reference_image"?o=dZ(i,s):Re(!1,"Unexpected entity type"),o.length===0?er:o.map(l=>t(l)).map(hZ)}),fB=u.memo(()=>{const e=Ke(),{t}=P(),n=dB(e),s=u.useMemo(()=>rxe(e,t),[e,t]),i=I(s);return i.length===0?null:r.jsx(ae,{as:"span",size:"sm",variant:"link",alignSelf:"stretch","aria-label":"warnings",tooltip:r.jsx(pB,{warnings:i}),icon:r.jsx(Cp,{}),colorScheme:"warning",isDisabled:!n})});fB.displayName="CanvasEntityHeaderWarnings";const pB=u.memo(e=>{const{t}=P();return r.jsxs(T,{flexDir:"column",children:[r.jsxs(K,{children:[t("controlLayers.warnings.problemsFound"),":"]}),r.jsx(ki,{children:e.warnings.map((n,s)=>r.jsx(Gt,{children:n},s))})]})});pB.displayName="TooltipContent";const ixe=e=>{const t=u.useMemo(()=>ve(Je,s=>{var i;return((i=s.bookmarkedEntityIdentifier)==null?void 0:i.id)===e.id}),[e]);return I(t)},gB=u.memo(()=>{const{t:e}=P(),t=Ke(),n=ixe(t),s=z(),i=u.useCallback(()=>{s(n?qk({entityIdentifier:null}):qk({entityIdentifier:t}))},[s,t,n]);return r.jsx(ae,{size:"sm","aria-label":e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),tooltip:e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(qoe,{}):r.jsx(uoe,{}),onClick:i})});gB.displayName="CanvasEntityIsBookmarkedForQuickSwitchToggle";const mB=u.memo(()=>{const{t:e}=P(),t=Ke(),n=Ii(t),s=tt(),i=z(),o=u.useCallback(()=>{i(gZ({entityIdentifier:t}))},[i,t]);return r.jsx(ae,{size:"sm","aria-label":e(n?"controlLayers.locked":"controlLayers.unlocked"),tooltip:e(n?"controlLayers.locked":"controlLayers.unlocked"),variant:"link",alignSelf:"stretch",icon:n?r.jsx(VE,{}):r.jsx(TE,{}),onClick:o,isDisabled:s})});mB.displayName="CanvasEntityIsLockedToggle";const ld=u.memo(()=>{const e=Ke();return r.jsxs(T,{alignSelf:"stretch",children:[r.jsx(fB,{}),r.jsx(gB,{}),e.type!=="reference_image"&&r.jsx(mB,{}),r.jsx(hB,{}),r.jsx(uB,{})]})});ld.displayName="CanvasEntityHeaderCommonActions";const yB=$o.canvas,oxe=36,b8=`${oxe}px`,zp=u.memo(()=>{const e=Ke(),t=vhe(e),n=u.useMemo(()=>ve(Je,d=>{const h=Aa(d,e);return h&&(h.type==="inpaint_mask"||h.type==="regional_guidance")?Tl(h.fill.color):null}),[e]),s=mZ(n),i=u.useRef(null),o=ce(t.transformer.$pixelRect),a=ce(t.transformer.$nodeRect),l=ce(t.$canvasCache),c=u.useMemo(()=>Ea(()=>{if(!i.current)return;const d=i.current.getContext("2d");if(!d)return;const h=t.transformer.$pixelRect.get(),f=t.transformer.$nodeRect.get(),p=t.$canvasCache.get();if(!p||p.width===0||p.height===0){d.clearRect(0,0,i.current.width,i.current.height);return}d.clearRect(0,0,i.current.width,i.current.height),i.current.width=h.width,i.current.height=h.height;const g=h.x-f.x,m=h.y-f.y,y=h.width,x=h.height,C=0,v=0,b=h.width,S=h.height;d.drawImage(p,g,m,y,x,C,v,b,S),s&&(d.fillStyle=s,d.globalCompositeOperation="source-in",d.fillRect(0,0,h.width,h.height))},300),[t.$canvasCache,t.transformer.$nodeRect,t.transformer.$pixelRect,s]);return u.useEffect(c,[c,l,a,o]),r.jsx(Le,{label:r.jsx(axe,{canvasRef:i}),p:2,closeOnScroll:!0,children:r.jsxs(T,{position:"relative",alignItems:"center",justifyContent:"center",w:b8,h:b8,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[r.jsx(ke,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:td,bgSize:"5px"}),r.jsx(yB,{position:"relative",ref:i,objectFit:"contain",maxW:"full",maxH:"full"})]})})});zp.displayName="CanvasEntityPreviewImage";const axe=({canvasRef:e})=>{const t=u.useRef(null);return u.useEffect(()=>{if(!t.current||!e.current)return;const n=t.current.getContext("2d");n&&(t.current.width=e.current.width,t.current.height=e.current.height,n.clearRect(0,0,t.current.width,t.current.height),n.drawImage(e.current,0,0))},[e]),r.jsxs(T,{position:"relative",alignItems:"center",justifyContent:"center",w:150,h:150,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[r.jsx(ke,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:td,bgSize:"8px"}),r.jsx(yB,{position:"relative",ref:t,objectFit:"contain",maxW:"full",maxH:"full"})]})},yy=u.memo(({children:e})=>r.jsx(T,{flexDir:"column",gap:2,px:2,pb:2,children:e}));yy.displayName="CanvasEntitySettingsWrapper";const Ko=({value:e,defaultValue:t,onChange:n,onStartEditing:s,inputRef:i})=>{const[o,a]=u.useState(!1),[l,c]=u.useState(e),d=u.useCallback(()=>{var y;const m=l.trim()||t;c(m),m!==e&&n(m),a(!1),(y=i==null?void 0:i.current)==null||y.setSelectionRange(0,0)},[l,t,e,i,n]),h=u.useCallback(g=>{c(g.target.value)},[]),f=u.useCallback(g=>{g.key==="Enter"&&!g.shiftKey?d():g.key==="Escape"&&(c(e),n(e),a(!1))},[n,d,e]),p=u.useCallback(()=>{a(!0),s==null||s()},[s]);return u.useEffect(()=>{c(e)},[e]),u.useEffect(()=>{var g,m;o&&((g=i==null?void 0:i.current)==null||g.focus(),(m=i==null?void 0:i.current)==null||m.select())},[i,o]),{isEditing:o,startEditing:p,value:l,inputProps:{value:l,onChange:h,onKeyDown:f,onBlur:d}}},vB=u.memo(e=>{const t=Ke(),n=cB(t),s=WR(t);return r.jsx(K,{size:"sm",fontWeight:"semibold",userSelect:"none",color:n?"base.100":"base.300",...e,children:s})});vB.displayName="CanvasEntityTitle";const cd=u.memo(()=>{const e=z(),t=Ke(),n=u.useRef(null),s=zR(t),i=HR(t.type),o=u.useCallback(l=>{e(yZ({entityIdentifier:t,name:l}))},[e,t]),a=Ko({value:s||i,defaultValue:i,onChange:o,inputRef:n});return a.isEditing?r.jsx(Ct,{ref:n,...a.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}}):r.jsx(vB,{cursor:"text",onDoubleClick:a.startEditing})});cd.displayName="CanvasEntityTitleEdit";const lxe=e=>ve(Je,t=>Mr(t,e,"ControlLayerBadgesContent").withTransparencyEffect),bB=u.memo(()=>{const e=Ke("control_layer"),{t}=P(),n=u.useMemo(()=>lxe(e),[e]);return I(n)?r.jsx(os,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.transparency")}):null});bB.displayName="ControlLayerBadgesContent";const xB=u.memo(()=>{const e=Ke("control_layer");return r.jsx(Wo,{entityIdentifier:e,children:r.jsx(bB,{})})});xB.displayName="ControlLayerBadges";const rb=nr("gallery"),ec=({onUpload:e,isDisabled:t,allowMultiple:n})=>{const s=I(Ar),[i,o]=GT(),a=I(fC),{t:l}=P(),c=u.useCallback(async g=>{if(n){const m=await UT(g.map((y,x)=>({file:y,image_category:"user",is_intermediate:!1,board_id:s==="none"?void 0:s,silent:!1,isFirstUploadOfBatch:x===0})));e&&e(m)}else{if(g.length>1){rb.warn("Multiple files dropped but only one allowed");return}if(g.length===0){rb.warn("No files dropped");return}const m=g[0];Re(m!==void 0);const y=await i({file:m,image_category:"user",is_intermediate:!1,board_id:s==="none"?void 0:s,silent:!0}).unwrap();e&&e(y)}},[n,s,e,i]),d=u.useCallback(g=>{if(g.length>0){const m=g.map(x=>({errors:x.errors.map(({message:C})=>C),file:x.file.path}));rb.error({errors:m},"Invalid upload");const y=a===void 0?l("toast.uploadFailedInvalidUploadDesc"):l("toast.uploadFailedInvalidUploadDesc_withCount",{count:a});fe({id:"UPLOAD_FAILED",title:l("toast.uploadFailed"),description:y,status:"error"});return}},[a,l]),{getRootProps:h,getInputProps:f,open:p}=Ra({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:c,onDropRejected:d,disabled:t,noDrag:!0,multiple:n&&(a===void 0||a>1),maxFiles:a});return{getUploadButtonProps:h,getUploadInputProps:f,openUploader:p,request:o}},CB={"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid",borderWidth:1}},bj=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const i=ec({isDisabled:e,allowMultiple:!1,onUpload:t});return r.jsxs(r.Fragment,{children:[r.jsx(ae,{"aria-label":"Upload image",variant:"outline",sx:CB,"data-error":n,icon:r.jsx(xp,{}),isLoading:i.request.isLoading,...s,...i.getUploadButtonProps()}),r.jsx("input",{...i.getUploadInputProps()})]})},cxe=({isDisabled:e=!1,onUpload:t,isError:n=!1,...s})=>{const i=ec({isDisabled:e,allowMultiple:!0,onUpload:t});return r.jsxs(r.Fragment,{children:[r.jsx(ae,{"aria-label":"Upload image",variant:"outline",sx:CB,"data-error":n,icon:r.jsx(xp,{}),isLoading:i.request.isLoading,...s,...i.getUploadButtonProps()}),r.jsx("input",{...i.getUploadInputProps()})]})},uxe=e=>`${Math.round(e*100)}%`,dxe=["Begin Step %","End Step %"],vy=u.memo(({beginEndStepPct:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(()=>{t([0,1])},[t]);return r.jsxs(Z,{orientation:"horizontal",pe:2,children:[r.jsx(Ve,{feature:"controlNetBeginEnd",children:r.jsx(te,{m:0,children:n("controlLayers.beginEndStepPercentShort")})}),r.jsx(vZ,{"aria-label":dxe,value:e,onChange:t,onReset:s,min:0,max:1,step:.05,fineStep:.01,minStepsBetweenThumbs:1,formatValue:uxe,marks:!0,withThumbTooltip:!0})]})});vy.displayName="BeginEndStepPct";const hxe=e=>e.toFixed(2),fxe=[0,1,2],pxe=ve(Qr,e=>e.sd.ca.weight),by=u.memo(({weight:e,onChange:t})=>{const{t:n}=P(),s=I(pxe);return r.jsxs(Z,{orientation:"horizontal",children:[r.jsx(Ve,{feature:"controlNetWeight",children:r.jsx(te,{m:0,children:n("controlLayers.weight")})}),r.jsx(qe,{value:e,onChange:t,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,marks:fxe,formatValue:hxe}),r.jsx(Ae,{value:e,onChange:t,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,maxW:20,defaultValue:s.initial})]})});by.displayName="Weight";const SB=u.memo(({controlMode:e,onChange:t})=>{const{t:n}=P(),s=u.useMemo(()=>[{label:n("controlLayers.controlMode.balanced"),value:"balanced"},{label:n("controlLayers.controlMode.prompt"),value:"more_prompt"},{label:n("controlLayers.controlMode.control"),value:"more_control"},{label:n("controlLayers.controlMode.megaControl"),value:"unbalanced"}],[n]),i=u.useCallback(a=>{Re(bZ(a==null?void 0:a.value)),t(a.value)},[t]),o=u.useMemo(()=>s.filter(a=>a.value===e)[0],[s,e]);return e?r.jsxs(Z,{children:[r.jsx(Ve,{feature:"controlNetControlMode",children:r.jsx(te,{m:0,children:n("controlLayers.controlMode.controlMode")})}),r.jsx(Fe,{value:o,options:s,onChange:i,isClearable:!1,isSearchable:!1})]}):null});SB.displayName="ControlLayerControlAdapterControlMode";const gxe=e=>e.base.toUpperCase(),mxe=e=>`${e.base.toUpperCase()} / ${e.type.replaceAll("_"," ").toUpperCase()}`,yxe=ve(r1,e=>{var t;return((t=e.model)==null?void 0:t.base)??"sdxl"}),hn=e=>{const{t}=P(),n=I(yxe),s=I(X0),{modelConfigs:i,selectedModel:o,getIsDisabled:a,onChange:l,isLoading:c,groupByType:d=!1}=e,h=u.useMemo(()=>{if(!i)return[];const y=xZ(i,d?mxe:gxe),x=CZ(y,(C,v,b)=>(C.push({label:b,options:v.map(S=>({label:S.name,value:S.key,description:s&&S.description||void 0,isDisabled:a?a(S):!1}))}),C),[]);return x.sort(C=>{var v,b;return(b=(v=C.label)==null?void 0:v.split("/")[0])!=null&&b.toLowerCase().includes(n)?-1:1}),x},[i,d,a,n,s]),f=u.useMemo(()=>h.flatMap(y=>y.options).find(y=>o?y.value===o.key:!1)??null,[h,o]),p=u.useCallback(y=>{if(!y){l(null);return}const x=i.find(C=>C.key===y.value);if(!x){l(null);return}l(x)},[i,l]),g=u.useMemo(()=>c?t("common.loading"):h.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[c,h,t]),m=u.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:h,value:f,onChange:p,placeholder:g,noOptionsMessage:m}},wB=u.memo(({modelKey:e,onChange:t})=>{const{t:n}=P(),s=I(Fl),[i,{isLoading:o}]=que(),a=u.useMemo(()=>i.find(g=>g.key===e),[i,e]),l=u.useCallback(g=>{g&&t(g)},[t]),c=u.useCallback(g=>{const m=s===g.base;return!!!s||!m},[s]),{options:d,value:h,onChange:f,noOptionsMessage:p}=hn({modelConfigs:i,onChange:l,selectedModel:a,getIsDisabled:c,isLoading:o,groupByType:!0});return r.jsx(Le,{label:a==null?void 0:a.description,children:r.jsx(Z,{isInvalid:!h||s!==(a==null?void 0:a.base),w:"full",children:r.jsx(Fe,{options:d,placeholder:n("common.placeholderSelectAModel"),value:h,onChange:f,noOptionsMessage:p})})})});wB.displayName="ControlLayerControlAdapterModel";const vxe=e=>SZ(Je,t=>Mr(t,e,"ControlLayerControlAdapter").controlAdapter),jB=u.memo(()=>{var C;const{t:e}=P(),{dispatch:t,getState:n}=sr(),s=Ke("control_layer"),i=u.useMemo(()=>vxe(s),[s]),o=I(i),a=sy(s),l=I(xi),c=yhe("control_layer"),d=u.useCallback(v=>{t(wZ({entityIdentifier:s,beginEndStepPct:v}))},[t,s]),h=u.useCallback(v=>{t(jZ({entityIdentifier:s,controlMode:v}))},[t,s]),f=u.useCallback(v=>{t(kZ({entityIdentifier:s,weight:v}))},[t,s]),p=u.useCallback(v=>{t(_Z({entityIdentifier:s,modelConfig:v}));const b=c.filterer.$isFiltering.get(),S=c.filterer.$simple.get();if(b&&!S)return;const w=rO(v);if(!w){b&&c.filterer.cancel();return}const j=w.buildDefaults();b?(c.filterer.$filterConfig.set(j),c.filterer.process()):c.filterer.start(j)},[c.filterer,t,s]),g=i0e(s),m=tt(),y=u.useMemo(()=>({onUpload:v=>{yS({entityIdentifier:s,imageDTO:v,dispatch:t,getState:n})},allowMultiple:!1}),[t,s,n]),x=ec(y);return r.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",children:[r.jsxs(T,{w:"full",gap:2,children:[r.jsx(wB,{modelKey:((C=o.model)==null?void 0:C.key)??null,onChange:p}),r.jsx(ae,{onClick:a.start,isDisabled:a.isDisabled,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:r.jsx(wS,{})}),r.jsx(ae,{onClick:g,isDisabled:m,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.pullBboxIntoLayer"),tooltip:e("controlLayers.pullBboxIntoLayer"),icon:r.jsx(La,{})}),r.jsx(ae,{isDisabled:m,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("accessibility.uploadImage"),tooltip:e("accessibility.uploadImage"),icon:r.jsx(xp,{}),...x.getUploadButtonProps()}),r.jsx("input",{...x.getUploadInputProps()})]}),r.jsx(by,{weight:o.weight,onChange:f}),o.type!=="control_lora"&&r.jsx(vy,{beginEndStepPct:o.beginEndStepPct,onChange:d}),o.type==="controlnet"&&!l&&r.jsx(SB,{controlMode:o.controlMode,onChange:h})]})});jB.displayName="ControlLayerControlAdapter";const kB=u.memo(()=>{const e=Ke("control_layer"),{dispatch:t,getState:n}=sr(),s=tt(),i=u.useCallback(l=>{yS({imageDTO:l,entityIdentifier:e,dispatch:t,getState:n})},[t,e,n]),o=ec({onUpload:i,allowMultiple:!1}),a=u.useCallback(()=>{t(Ys("gallery"))},[t]);return r.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[r.jsx(K,{textAlign:"center",color:"base.300",children:r.jsx(Xt,{i18nKey:"controlLayers.controlLayerEmptyState",components:{UploadButton:r.jsx(ye,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...o.getUploadButtonProps()}),GalleryButton:r.jsx(ye,{onClick:a,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}})}),r.jsx("input",{...o.getUploadInputProps()})]})});kB.displayName="ControlLayerSettingsEmptyState";const _B=u.memo(()=>{const e=Ke();return Rp(e)?r.jsx(kB,{}):r.jsx(jB,{})});_B.displayName="ControlLayerSettings";const IB=u.memo(({id:e})=>{const{t}=P(),n=tt(),s=u.useMemo(()=>({id:e,type:"control_layer"}),[e]),i=u.useMemo(()=>_f.getData({entityIdentifier:s},s.id),[s]);return r.jsx(Ql.Provider,{value:s,children:r.jsx($R,{children:r.jsx(Wo,{entityIdentifier:s,children:r.jsxs(od,{children:[r.jsxs(ad,{children:[r.jsx(zp,{}),r.jsx(cd,{}),r.jsx(nt,{}),r.jsx(xB,{}),r.jsx(ld,{})]}),r.jsx(yy,{children:r.jsx(_B,{})}),r.jsx(vs,{dndTarget:_f,dndTargetData:i,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});IB.displayName="ControlLayer";const bxe=It(Je,e=>e.controlLayers.entities.map(qs).toReversed()),xxe=ve(kn,e=>(e==null?void 0:e.type)==="control_layer"),AB=u.memo(()=>{const e=I(xxe),t=I(bxe);if(t.length===0)return null;if(t.length>0)return r.jsx(id,{type:"control_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(IB,{id:n.id},n.id))})});AB.displayName="ControlLayerEntityList";const TB=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"inpaint_mask"}),[e]);return r.jsx(Ql.Provider,{value:t,children:r.jsx(VR,{children:r.jsx(Wo,{entityIdentifier:t,children:r.jsx(od,{children:r.jsxs(ad,{children:[r.jsx(zp,{}),r.jsx(cd,{}),r.jsx(nt,{}),r.jsx(ld,{})]})})})})})});TB.displayName="InpaintMask";const Cxe=It(Je,e=>e.inpaintMasks.entities.map(qs).toReversed()),Sxe=ve(kn,e=>(e==null?void 0:e.type)==="inpaint_mask"),MB=u.memo(()=>{const e=I(Sxe),t=I(Cxe);if(t.length===0)return null;if(t.length>0)return r.jsx(id,{type:"inpaint_mask",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(TB,{id:n.id},n.id))})});MB.displayName="InpaintMaskList";const xj=u.memo(({method:e,onChange:t})=>{const{t:n}=P(),s=I(X0),i=u.useMemo(()=>[{label:n("controlLayers.ipAdapterMethod.full"),value:"full",description:s?n("controlLayers.ipAdapterMethod.fullDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.style"),value:"style",description:s?n("controlLayers.ipAdapterMethod.styleDesc"):void 0},{label:n("controlLayers.ipAdapterMethod.composition"),value:"composition",description:s?n("controlLayers.ipAdapterMethod.compositionDesc"):void 0}],[n,s]),o=u.useCallback(l=>{Re(IZ(l==null?void 0:l.value)),t(l.value)},[t]),a=u.useMemo(()=>i.find(l=>l.value===e),[i,e]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"ipAdapterMethod",children:r.jsx(te,{children:n("controlLayers.ipAdapterMethod.ipAdapterMethod")})}),r.jsx(Fe,{value:a,options:i,onChange:o})]})});xj.displayName="IPAdapterMethod";const PB=u.memo(()=>{const{t:e}=P(),t=Ke("reference_image"),n=z(),s=tt(),i=u.useCallback(d=>{fE({imageDTO:d,entityIdentifier:t,dispatch:n})},[n,t]),o=ec({onUpload:i,allowMultiple:!1}),a=u.useCallback(()=>{n(Ys("gallery"))},[n]),l=u.useMemo(()=>jf.getData({entityIdentifier:t}),[t]),c=u.useMemo(()=>({UploadButton:r.jsx(ye,{isDisabled:s,size:"sm",variant:"link",color:"base.300",...o.getUploadButtonProps()}),GalleryButton:r.jsx(ye,{onClick:a,isDisabled:s,size:"sm",variant:"link",color:"base.300"})}),[s,a,o]);return r.jsxs(T,{flexDir:"column",gap:3,position:"relative",w:"full",p:4,children:[r.jsx(K,{textAlign:"center",color:"base.300",children:r.jsx(Xt,{i18nKey:"controlLayers.referenceImageEmptyState",components:c})}),r.jsx("input",{...o.getUploadInputProps()}),r.jsx(vs,{dndTarget:jf,dndTargetData:l,label:e("controlLayers.useImage"),isDisabled:s})]})});PB.displayName="IPAdapterSettingsEmptyState";const Cj=u.memo(({image:e,onChangeImage:t,dndTarget:n,dndTargetData:s})=>{const{t:i}=P(),o=ce(An),{currentData:a,isError:l}=Pa((e==null?void 0:e.image_name)??ws),c=u.useCallback(()=>{t(null)},[t]);u.useEffect(()=>{o&&l&&c()},[c,l,o]);const d=u.useCallback(h=>{t(h)},[t]);return r.jsxs(T,{position:"relative",w:"full",h:"full",alignItems:"center","data-error":!a&&!(e!=null&&e.image_name),children:[!a&&r.jsx(bj,{w:"full",h:"full",isError:!a&&!(e!=null&&e.image_name),onUpload:d,fontSize:36}),a&&r.jsxs(r.Fragment,{children:[r.jsx($a,{imageDTO:a}),r.jsx(T,{position:"absolute",flexDir:"column",top:2,insetInlineEnd:2,gap:1,children:r.jsx(io,{onClick:c,icon:r.jsx(ho,{size:16}),tooltip:i("common.reset")})})]}),r.jsx(vs,{dndTarget:n,dndTargetData:s,label:i("gallery.drop")})]})});Cj.displayName="IPAdapterImagePreview";const C2="ViT-L",x8=[{label:"ViT-H",value:"ViT-H"},{label:"ViT-G",value:"ViT-G"},{label:C2,value:C2}],Sj=u.memo(({modelKey:e,onChangeModel:t,clipVisionModel:n,onChangeCLIPVisionModel:s})=>{const{t:i}=P(),o=I(Fl),[a,{isLoading:l}]=nw(),c=u.useMemo(()=>a.find(b=>b.key===e),[a,e]),d=u.useCallback(b=>{b&&t(b)},[t]),h=u.useCallback(b=>{Re(AZ(b==null?void 0:b.value)),s(b.value)},[s]),f=I(xi),p=u.useCallback(b=>{const S=o===b.base;return!!!o||!S},[o]),{options:g,value:m,onChange:y,noOptionsMessage:x}=hn({modelConfigs:a,onChange:d,selectedModel:c,getIsDisabled:p,isLoading:l}),C=u.useMemo(()=>x8.map(b=>({...b,isDisabled:f&&b.value!==C2})),[f]),v=u.useMemo(()=>x8.find(b=>b.value===n),[n]);return r.jsxs(T,{gap:2,children:[r.jsx(Le,{label:c==null?void 0:c.description,children:r.jsx(Z,{isInvalid:!m||o!==(c==null?void 0:c.base),w:"full",children:r.jsx(Fe,{options:g,placeholder:i("common.placeholderSelectAModel"),value:m,onChange:y,noOptionsMessage:x})})}),(c==null?void 0:c.format)==="checkpoint"&&r.jsx(Z,{isInvalid:!m||o!==(c==null?void 0:c.base),width:"max-content",minWidth:28,children:r.jsx(Fe,{options:C,placeholder:i("common.placeholderSelectAModel"),value:v,onChange:h})})]})});Sj.displayName="IPAdapterModel";const wxe=e=>ve(Je,t=>Mr(t,e,"IPAdapterSettings").ipAdapter),EB=u.memo(()=>{var y,x;const{t:e}=P(),t=z(),n=Ke("reference_image"),s=u.useMemo(()=>wxe(n),[n]),i=I(s),o=u.useCallback(C=>{t(TZ({entityIdentifier:n,beginEndStepPct:C}))},[t,n]),a=u.useCallback(C=>{t(MZ({entityIdentifier:n,weight:C}))},[t,n]),l=u.useCallback(C=>{t(PZ({entityIdentifier:n,method:C}))},[t,n]),c=u.useCallback(C=>{t(EZ({entityIdentifier:n,modelConfig:C}))},[t,n]),d=u.useCallback(C=>{t(LZ({entityIdentifier:n,clipVisionModel:C}))},[t,n]),h=u.useCallback(C=>{t(lC({entityIdentifier:n,imageDTO:C}))},[t,n]),f=u.useMemo(()=>{var C;return jf.getData({entityIdentifier:n},(C=i.image)==null?void 0:C.image_name)},[n,(y=i.image)==null?void 0:y.image_name]),p=T9(n),g=tt(),m=I(xi);return r.jsx(yy,{children:r.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(T,{gap:2,alignItems:"center",w:"full",children:[r.jsx(ke,{minW:0,w:"full",transitionProperty:"common",transitionDuration:"0.1s",children:r.jsx(Sj,{modelKey:((x=i.model)==null?void 0:x.key)??null,onChangeModel:c,clipVisionModel:i.clipVisionModel,onChangeCLIPVisionModel:d})}),r.jsx(ae,{onClick:p,isDisabled:g,variant:"ghost","aria-label":e("controlLayers.pullBboxIntoReferenceImage"),tooltip:e("controlLayers.pullBboxIntoReferenceImage"),icon:r.jsx(La,{})})]}),r.jsxs(T,{gap:2,w:"full",alignItems:"center",children:[r.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[!m&&r.jsx(xj,{method:i.method,onChange:l}),r.jsx(by,{weight:i.weight,onChange:a}),r.jsx(vy,{beginEndStepPct:i.beginEndStepPct,onChange:o})]}),r.jsx(T,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",children:r.jsx(Cj,{image:i.image,onChangeImage:h,dndTarget:jf,dndTargetData:f})})]})]})})});EB.displayName="IPAdapterSettingsContent";const jxe=e=>ve(Je,t=>{const n=Aa(t,e);return!!n&&n.ipAdapter.image!==null}),LB=u.memo(()=>{const e=Ke("reference_image"),t=u.useMemo(()=>jxe(e),[e]);return I(t)?r.jsx(EB,{}):r.jsx(PB,{})});LB.displayName="IPAdapterSettings";const DB=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"reference_image"}),[e]);return r.jsx(Ql.Provider,{value:t,children:r.jsx(Wo,{entityIdentifier:t,children:r.jsxs(od,{children:[r.jsxs(ad,{ps:4,py:5,children:[r.jsx(cd,{}),r.jsx(nt,{}),r.jsx(ld,{})]}),r.jsx(LB,{})]})})})});DB.displayName="IPAdapter";const kxe=It(Je,e=>e.referenceImages.entities.map(qs).toReversed()),_xe=ve(kn,e=>(e==null?void 0:e.type)==="reference_image"),RB=u.memo(()=>{const e=I(_xe),t=I(kxe);if(t.length===0)return null;if(t.length>0)return r.jsx(id,{type:"reference_image",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(DB,{id:n.id},n.id))})});RB.displayName="IPAdapterList";const OB=u.memo(({id:e})=>{const{t}=P(),n=tt(),s=u.useMemo(()=>({id:e,type:"raster_layer"}),[e]),i=u.useMemo(()=>_f.getData({entityIdentifier:s},s.id),[s]);return r.jsx(Ql.Provider,{value:s,children:r.jsx(BR,{children:r.jsx(Wo,{entityIdentifier:s,children:r.jsxs(od,{children:[r.jsxs(ad,{children:[r.jsx(zp,{}),r.jsx(cd,{}),r.jsx(nt,{}),r.jsx(ld,{})]}),r.jsx(vs,{dndTarget:_f,dndTargetData:i,label:t("controlLayers.replaceLayer"),isDisabled:n})]})})})})});OB.displayName="RasterLayer";const Ixe=It(Je,e=>e.rasterLayers.entities.map(qs).toReversed()),Axe=ve(kn,e=>(e==null?void 0:e.type)==="raster_layer"),NB=u.memo(()=>{const e=I(Axe),t=I(Ixe);if(t.length===0)return null;if(t.length>0)return r.jsx(id,{type:"raster_layer",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(OB,{id:n.id},n.id))})});NB.displayName="RasterLayerEntityList";const FB=u.memo(()=>{const e=Ke("regional_guidance"),{t}=P(),n=u.useMemo(()=>ve(Je,i=>Mr(i,e,"RegionalGuidanceBadges").autoNegative),[e]),s=I(n);return r.jsx(r.Fragment,{children:s&&r.jsx(os,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.autoNegative")})})});FB.displayName="RegionalGuidanceBadges";const Txe=()=>{const e=Ke("regional_guidance"),{t}=P(),n=nE(e),s=sE(e),i=rE(e),o=u.useMemo(()=>iE(e),[e]),a=I(o);return r.jsxs(T,{w:"full",p:2,justifyContent:"space-between",children:[r.jsx(ye,{size:"sm",variant:"ghost",leftIcon:r.jsx(Ht,{}),onClick:s,isDisabled:!a.canAddPositivePrompt,children:t("controlLayers.prompt")}),r.jsx(ye,{size:"sm",variant:"ghost",leftIcon:r.jsx(Ht,{}),onClick:i,isDisabled:!a.canAddNegativePrompt,children:t("controlLayers.negativePrompt")}),r.jsx(ye,{size:"sm",variant:"ghost",leftIcon:r.jsx(Ht,{}),onClick:n,children:t("controlLayers.referenceImage")})]})},BB=u.memo(({referenceImageId:e})=>{const{t}=P(),n=Ke("regional_guidance"),s=z(),i=tt(),o=u.useCallback(h=>{pE({imageDTO:h,entityIdentifier:n,referenceImageId:e,dispatch:s})},[s,n,e]),a=ec({onUpload:o,allowMultiple:!1}),l=u.useCallback(()=>{s(Ys("gallery"))},[s]),c=u.useCallback(()=>{s(n3({entityIdentifier:n,referenceImageId:e}))},[s,n,e]),d=u.useMemo(()=>kf.getData({entityIdentifier:n,referenceImageId:e}),[n,e]);return r.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(K,{fontWeight:"semibold",color:"base.400",children:t("controlLayers.referenceImage")}),r.jsx(nt,{}),r.jsx(ae,{size:"sm",variant:"link",alignSelf:"stretch",icon:r.jsx(Nt,{}),tooltip:t("controlLayers.deleteReferenceImage"),"aria-label":t("controlLayers.deleteReferenceImage"),onClick:c,colorScheme:"error"})]}),r.jsx(T,{alignItems:"center",gap:2,p:4,children:r.jsx(K,{textAlign:"center",color:"base.300",children:r.jsx(Xt,{i18nKey:"controlLayers.referenceImageEmptyState",components:{UploadButton:r.jsx(ye,{isDisabled:i,size:"sm",variant:"link",color:"base.300",...a.getUploadButtonProps()}),GalleryButton:r.jsx(ye,{onClick:l,isDisabled:i,size:"sm",variant:"link",color:"base.300"})}})})}),r.jsx("input",{...a.getUploadInputProps()}),r.jsx(vs,{dndTarget:kf,dndTargetData:d,label:t("controlLayers.useImage"),isDisabled:i})]})});BB.displayName="RegionalGuidanceIPAdapterSettingsEmptyState";const $B=u.memo(({referenceImageId:e})=>{var x,C;const t=Ke("regional_guidance"),{t:n}=P(),s=z(),i=u.useCallback(()=>{s(n3({entityIdentifier:t,referenceImageId:e}))},[s,t,e]),o=u.useMemo(()=>ve(Je,v=>{const b=s3(v,t,e);return Re(b,`Regional Guidance IP Adapter with id ${e} not found`),b.ipAdapter}),[t,e]),a=I(o),l=u.useCallback(v=>{s(DZ({entityIdentifier:t,referenceImageId:e,beginEndStepPct:v}))},[s,t,e]),c=u.useCallback(v=>{s(RZ({entityIdentifier:t,referenceImageId:e,weight:v}))},[s,t,e]),d=u.useCallback(v=>{s(OZ({entityIdentifier:t,referenceImageId:e,method:v}))},[s,t,e]),h=u.useCallback(v=>{s(NZ({entityIdentifier:t,referenceImageId:e,modelConfig:v}))},[s,t,e]),f=u.useCallback(v=>{s(FZ({entityIdentifier:t,referenceImageId:e,clipVisionModel:v}))},[s,t,e]),p=u.useCallback(v=>{s(cC({entityIdentifier:t,referenceImageId:e,imageDTO:v}))},[s,t,e]),g=u.useMemo(()=>{var v;return kf.getData({entityIdentifier:t,referenceImageId:e},(v=a.image)==null?void 0:v.image_name)},[t,(x=a.image)==null?void 0:x.image_name,e]),m=o0e(t,e),y=tt();return r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(K,{fontWeight:"semibold",color:"base.400",children:n("controlLayers.referenceImage")}),r.jsx(nt,{}),r.jsx(ae,{size:"sm",variant:"link",alignSelf:"stretch",icon:r.jsx(Nt,{}),tooltip:n("controlLayers.deleteReferenceImage"),"aria-label":n("controlLayers.deleteReferenceImage"),onClick:i,colorScheme:"error"})]}),r.jsxs(T,{flexDir:"column",gap:2,position:"relative",w:"full",children:[r.jsxs(T,{gap:2,alignItems:"center",w:"full",children:[r.jsx(ke,{minW:0,w:"full",transitionProperty:"common",transitionDuration:"0.1s",children:r.jsx(Sj,{modelKey:((C=a.model)==null?void 0:C.key)??null,onChangeModel:h,clipVisionModel:a.clipVisionModel,onChangeCLIPVisionModel:f})}),r.jsx(ae,{onClick:m,isDisabled:y,variant:"ghost","aria-label":n("controlLayers.pullBboxIntoReferenceImage"),tooltip:n("controlLayers.pullBboxIntoReferenceImage"),icon:r.jsx(La,{})})]}),r.jsxs(T,{gap:2,w:"full",children:[r.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[r.jsx(xj,{method:a.method,onChange:d}),r.jsx(by,{weight:a.weight,onChange:c}),r.jsx(vy,{beginEndStepPct:a.beginEndStepPct,onChange:l})]}),r.jsx(T,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",children:r.jsx(Cj,{image:a.image,onChangeImage:p,dndTarget:kf,dndTargetData:g})})]})]})]})});$B.displayName="RegionalGuidanceIPAdapterSettingsContent";const Mxe=(e,t)=>ve(Je,n=>{const s=s3(n,e,t);return!!s&&s.ipAdapter.image!==null}),VB=u.memo(({referenceImageId:e})=>{const t=Ke("regional_guidance"),n=u.useMemo(()=>Mxe(t,e),[t,e]);return I(n)?r.jsx($B,{referenceImageId:e}):r.jsx(BB,{referenceImageId:e})});VB.displayName="RegionalGuidanceIPAdapterSettings";const GB=u.memo(()=>{const e=Ke("regional_guidance"),t=u.useMemo(()=>It(Je,s=>{const i=Mr(s,e,"RegionalGuidanceIPAdapters").referenceImages.map(({id:o})=>o);return i.length===0?er:i}),[e]),n=I(t);return n.length===0?null:r.jsx(r.Fragment,{children:n.map((s,i)=>r.jsxs(u.Fragment,{children:[i>0&&r.jsx(Et,{}),r.jsx(VB,{referenceImageId:s})]},s))})});GB.displayName="RegionalGuidanceLayerIPAdapterList";const wj=u.memo(({onDelete:e,...t})=>{const{t:n}=P();return r.jsx(ae,{tooltip:n("common.delete"),variant:"link","aria-label":n("common.delete"),icon:r.jsx(Nt,{}),onClick:e,flexGrow:0,size:"sm",p:0,colorScheme:"error",...t})});wj.displayName="RegionalGuidanceDeletePromptButton";const tc=u.memo(e=>{const{onOpen:t,isOpen:n}=e,{t:s}=P();return r.jsx(Le,{label:s("prompt.addPromptTrigger"),children:r.jsx(ae,{variant:"promptOverlay",isDisabled:n,"aria-label":s("prompt.addPromptTrigger"),icon:r.jsx(moe,{}),onClick:t})})});tc.displayName="AddPromptTriggerButton";const Pxe=()=>Ce("prompt.noMatchingTriggers"),zB=u.memo(({onSelect:e,onClose:t})=>{const{t:n}=P(),s=I(ip),i=I(BZ),{data:o,isLoading:a}=op((s==null?void 0:s.key)??ws),[l,{isLoading:c}]=K1(),[d,{isLoading:h}]=fR(),f=u.useCallback(g=>{if(!g){e("");return}e(g.value)},[e]),p=u.useMemo(()=>{var m;const g=[];if(d){const y=d.filter(x=>x.base===(o==null?void 0:o.base)).map(x=>({label:x.name,value:`<${x.name}>`}));y.length>0&&g.push({label:n("prompt.compatibleEmbeddings"),options:y})}if(l){const y=l.filter(x=>Ci(i,C=>C.model.key).includes(x.key)).map(x=>x.trigger_phrases?x.trigger_phrases.map(C=>({label:C,value:C})):[]).flatMap(x=>x);y.length>0&&g.push({label:n("modelManager.loraTriggerPhrases"),options:$Z(y)})}return o&&sf(o)&&((m=o.trigger_phrases)!=null&&m.length)&&g.push({label:n("modelManager.mainModelTriggerPhrases"),options:o.trigger_phrases.map(y=>({label:y,value:y}))}),g},[d,l,o,n,i]);return r.jsx(Z,{children:r.jsx(Fe,{placeholder:n(c||h||a?"common.loading":"prompt.addPromptTrigger"),defaultMenuIsOpen:!0,autoFocus:!0,value:null,options:p,noOptionsMessage:Pxe,onChange:f,onMenuClose:t,"data-testid":"add-prompt-trigger",sx:Exe})})});zB.displayName="PromptTriggerSelect";const Exe={w:"full"},nc=u.memo(e=>{const{onSelect:t,isOpen:n,onClose:s,width:i,children:o}=e;return r.jsxs(Vn,{isOpen:n,onClose:s,placement:"bottom",openDelay:0,closeDelay:0,closeOnBlur:!0,returnFocusOnClose:!1,isLazy:!0,children:[r.jsx(np,{children:o}),r.jsx(Gn,{p:0,insetBlockStart:-1,shadow:"dark-lg",borderColor:"invokeBlue.300",borderWidth:"2px",borderStyle:"solid",children:r.jsx(Xn,{p:0,width:`calc(${i}px - 0.25rem)`,children:r.jsx(zB,{onClose:s,onSelect:t})})})]})});nc.displayName="PromptPopover";const ud=({prompt:e,textareaRef:t,onChange:n})=>{const{isOpen:s,onClose:i,onOpen:o}=ar(),a=u.useCallback(p=>{n(p.target.value)},[n]),l=u.useCallback(p=>{if(!t.current)return;const g=t.current.selectionStart;if(ze(g))return;let m=e.slice(0,g);m+=`${p}`;const y=m.length;m+=e.slice(g),Wl.flushSync(()=>{n(m)}),t.current.selectionStart=y,t.current.selectionEnd=y},[t,n,e]),c=u.useCallback(()=>{var p;(p=t.current)==null||p.focus()},[t]),d=u.useCallback(()=>{i(),c()},[c,i]),h=u.useCallback(p=>{l(p),d()},[d,l]),f=u.useCallback(p=>{p.key==="<"&&(o(),p.preventDefault())},[o]);return{onChange:a,isOpen:s,onClose:i,onOpen:o,onSelect:h,onKeyDown:f,onFocus:c}},Lxe={outline:"none"},HB=u.memo(()=>{var m;const e=Ke("regional_guidance"),t=u.useMemo(()=>ve(Je,y=>Mr(y,e,"RegionalGuidanceNegativePrompt").negativePrompt??""),[e]),n=I(t),s=z(),i=u.useRef(null),{t:o}=P(),a=u.useCallback(y=>{s(Vb({entityIdentifier:e,prompt:y}))},[s,e]),l=u.useCallback(()=>{s(Vb({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=ud({prompt:n,textareaRef:i,onChange:a});return r.jsx(nc,{isOpen:d,onClose:h,onSelect:p,width:(m=i.current)==null?void 0:m.clientWidth,children:r.jsxs(ke,{pos:"relative",w:"full",children:[r.jsx(Zn,{id:"prompt",name:"prompt",ref:i,value:n,placeholder:o("parameters.negativePromptPlaceholder"),onChange:c,onKeyDown:g,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,fontSize:"sm",zIndex:"0 !important",_focusVisible:Lxe}),r.jsxs(T,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[r.jsx(wj,{onDelete:l}),r.jsx(tc,{isOpen:d,onOpen:f})]})]})})});HB.displayName="RegionalGuidanceNegativePrompt";const Dxe={outline:"none"},WB=u.memo(()=>{var m;const e=Ke("regional_guidance"),t=u.useMemo(()=>ve(Je,y=>Mr(y,e,"RegionalGuidancePositivePrompt").positivePrompt??""),[e]),n=I(t),s=z(),i=u.useRef(null),{t:o}=P(),a=u.useCallback(y=>{s($b({entityIdentifier:e,prompt:y}))},[s,e]),l=u.useCallback(()=>{s($b({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=ud({prompt:n,textareaRef:i,onChange:a});return r.jsx(nc,{isOpen:d,onClose:h,onSelect:p,width:(m=i.current)==null?void 0:m.clientWidth,children:r.jsxs(ke,{pos:"relative",w:"full",children:[r.jsx(Zn,{id:"prompt",name:"prompt",ref:i,value:n,placeholder:o("parameters.positivePromptPlaceholder"),onChange:c,onKeyDown:g,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,minH:28,zIndex:"0 !important",_focusVisible:Dxe}),r.jsxs(T,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[r.jsx(wj,{onDelete:l}),r.jsx(tc,{isOpen:d,onOpen:f})]})]})})});WB.displayName="RegionalGuidancePositivePrompt";const Rxe=e=>It(Je,t=>{const n=Mr(t,e,"RegionalGuidanceSettings");return{hasPositivePrompt:n.positivePrompt!==null,hasNegativePrompt:n.negativePrompt!==null,hasIPAdapters:n.referenceImages.length>0}}),UB=u.memo(()=>{const e=Ke("regional_guidance"),t=u.useMemo(()=>Rxe(e),[e]),n=I(t);return r.jsxs(yy,{children:[!n.hasPositivePrompt&&!n.hasNegativePrompt&&!n.hasIPAdapters&&r.jsx(Txe,{}),n.hasPositivePrompt&&r.jsxs(r.Fragment,{children:[r.jsx(WB,{}),!n.hasNegativePrompt&&n.hasIPAdapters&&r.jsx(Et,{})]}),n.hasNegativePrompt&&r.jsxs(r.Fragment,{children:[r.jsx(HB,{}),n.hasIPAdapters&&r.jsx(Et,{})]}),n.hasIPAdapters&&r.jsx(GB,{})]})});UB.displayName="RegionalGuidanceSettings";const qB=u.memo(({id:e})=>{const t=u.useMemo(()=>({id:e,type:"regional_guidance"}),[e]);return r.jsx(Ql.Provider,{value:t,children:r.jsx(GR,{children:r.jsx(Wo,{entityIdentifier:t,children:r.jsxs(od,{children:[r.jsxs(ad,{children:[r.jsx(zp,{}),r.jsx(cd,{}),r.jsx(nt,{}),r.jsx(FB,{}),r.jsx(ld,{})]}),r.jsx(UB,{})]})})})})});qB.displayName="RegionalGuidance";const Oxe=It(Je,e=>e.regionalGuidance.entities.map(qs).toReversed()),Nxe=ve(kn,e=>(e==null?void 0:e.type)==="regional_guidance"),KB=u.memo(()=>{const e=I(Nxe),t=I(Oxe);if(t.length===0)return null;if(t.length>0)return r.jsx(id,{type:"regional_guidance",isSelected:e,entityIdentifiers:t,children:t.map(n=>r.jsx(qB,{id:n.id},n.id))})});KB.displayName="RegionalGuidanceEntityList";const ZB=u.memo(()=>r.jsx(Nn,{children:r.jsxs(T,{flexDir:"column",gap:2,"data-testid":"control-layers-layer-list",w:"full",h:"full",children:[r.jsx(RB,{}),r.jsx(MB,{}),r.jsx(KB,{}),r.jsx(AB,{}),r.jsx(NB,{})]})}));ZB.displayName="CanvasEntityList";const YB=u.memo(()=>{const{t:e}=P(),t=tt(),n=hS(),s=uS(),i=dS(),o=tE(),a=cS(),l=lS(),c=I(xi),d=I($l);return r.jsxs(Qt,{children:[r.jsx(Jt,{as:ae,minW:8,variant:"link",alignSelf:"stretch",tooltip:e("controlLayers.addLayer"),"aria-label":e("controlLayers.addLayer"),icon:r.jsx(Ht,{}),"data-testid":"control-layers-add-layer-menu-button",isDisabled:t}),r.jsxs(kt,{children:[r.jsx(Cr,{title:e("controlLayers.global"),children:r.jsx(he,{icon:r.jsx(Ht,{}),onClick:n,isDisabled:d,children:e("controlLayers.globalReferenceImage")})}),r.jsxs(Cr,{title:e("controlLayers.regional"),children:[r.jsx(he,{icon:r.jsx(Ht,{}),onClick:s,children:e("controlLayers.inpaintMask")}),r.jsx(he,{icon:r.jsx(Ht,{}),onClick:i,isDisabled:d,children:e("controlLayers.regionalGuidance")}),r.jsx(he,{icon:r.jsx(Ht,{}),onClick:o,isDisabled:c||d,children:e("controlLayers.regionalReferenceImage")})]}),r.jsxs(Cr,{title:e("controlLayers.layer_other"),children:[r.jsx(he,{icon:r.jsx(Ht,{}),onClick:l,isDisabled:d,children:e("controlLayers.controlLayer")}),r.jsx(he,{icon:r.jsx(Ht,{}),onClick:a,children:e("controlLayers.rasterLayer")})]})]})]})});YB.displayName="EntityListGlobalActionBarAddLayerMenu";const XB=u.memo(()=>{const{t:e}=P(),t=z(),n=tt(),s=I(kn),i=u.useCallback(()=>{s&&t(lM({entityIdentifier:s}))},[t,s]);return r.jsx(ae,{onClick:i,isDisabled:!s||n,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),icon:r.jsx($E,{})})});XB.displayName="EntityListSelectedEntityActionBarDuplicateButton";const ib={width:6,height:6,borderColor:"base.100"},Fxe={".react-colorful__hue-pointer":ib,".react-colorful__saturation-pointer":ib,".react-colorful__alpha-pointer":ib,gap:4,flexDir:"column"},Bxe={width:"100%"},ob="3.5rem",$xe=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:i=!1}=e,{t:o}=P(),a=u.useCallback(d=>n({...t,r:d}),[t,n]),l=u.useCallback(d=>n({...t,g:d}),[t,n]),c=u.useCallback(d=>n({...t,b:d}),[t,n]);return r.jsxs(T,{sx:Fxe,children:[r.jsx(sye,{color:t,onChange:n,style:Bxe}),s&&r.jsxs(T,{gap:4,children:[r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.red")[0]}),r.jsx(Ae,{flexGrow:1,value:t.r,onChange:a,min:0,max:255,step:1,w:ob,defaultValue:90})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.green")[0]}),r.jsx(Ae,{flexGrow:1,value:t.g,onChange:l,min:0,max:255,step:1,w:ob,defaultValue:90})]}),r.jsxs(Z,{gap:0,children:[r.jsx(te,{children:o("common.blue")[0]}),r.jsx(Ae,{flexGrow:1,value:t.b,onChange:c,min:0,max:255,step:1,w:ob,defaultValue:255})]})]}),i&&r.jsx(T,{gap:2,justifyContent:"space-between",children:Z1e.map((d,h)=>r.jsx(Gxe,{color:d,onChange:n},h))})]})},Vxe=u.memo($xe),Gxe=({color:e,onChange:t})=>{const n=u.useCallback(()=>{t(e)},[e,t]);return r.jsx(ke,{role:"button",onClick:n,h:8,w:8,bg:Tl(e),borderRadius:"base"})},QB=u.memo(({style:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(a=>{VZ(a==null?void 0:a.value)&&t(a.value)},[t]),i=u.useMemo(()=>[{value:"solid",label:n("controlLayers.fill.solid")},{value:"diagonal",label:n("controlLayers.fill.diagonal")},{value:"crosshatch",label:n("controlLayers.fill.crosshatch")},{value:"grid",label:n("controlLayers.fill.grid")},{value:"horizontal",label:n("controlLayers.fill.horizontal")},{value:"vertical",label:n("controlLayers.fill.vertical")}],[n]),o=u.useMemo(()=>i.find(a=>a.value===e),[i,e]);return r.jsxs(Z,{children:[r.jsx(te,{m:0,children:n("controlLayers.fill.fillStyle")}),r.jsx(Fe,{value:o,options:i,onChange:s,isSearchable:!1})]})});QB.displayName="MaskFillStyle";const JB=u.memo(()=>{const{t:e}=P(),t=z(),n=I(kn),s=I(GZ),i=u.useCallback(a=>{n&&Xb(n)&&t(zZ({entityIdentifier:n,color:a}))},[t,n]),o=u.useCallback(a=>{n&&Xb(n)&&t(HZ({entityIdentifier:n,style:a}))},[t,n]);return!n||!s?null:r.jsxs(Vn,{isLazy:!0,children:[r.jsx(Yn,{children:r.jsx(T,{role:"button","aria-label":e("controlLayers.maskFill"),tabIndex:-1,w:8,h:8,children:r.jsx(Le,{label:e("controlLayers.maskFill"),children:r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(ke,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Tl(s.color)})})})})}),r.jsx(Gn,{children:r.jsx(Xn,{minH:64,children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsx(Vxe,{color:s.color,onChange:i,withNumberInput:!0,withSwatches:!0}),r.jsx(QB,{style:s.style,onChange:o})]})})})]})});JB.displayName="EntityListSelectedEntityActionBarFill";const e$=u.memo(()=>{const{t:e}=P(),t=I(kn),n=sy(t);return!t||!Hb(t)?null:r.jsx(ae,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:r.jsx(wS,{})})});e$.displayName="EntityListSelectedEntityActionBarFilterButton";function zxe(e){return isNaN(Number(e))?"":`${sp(Number(e),2).toLocaleString()}%`}function Hxe(e){return e/100}function Ac(e){return e*100}function Wxe(e){return String(e)}const S2=[Ac(0),Ac(.25),Ac(.5),Ac(.75),Ac(1)],Uxe=Ac(1),qxe=S2.slice(1,S2.length-1),Kxe=ve(Je,e=>{const t=e.selectedEntityIdentifier;if(!t)return 1;const n=Aa(e,t);return!n||!WZ(n)?1:n.opacity}),t$=u.memo(()=>{const{t:e}=P(),t=z(),n=I(kn),s=I(Kxe),[i,o]=u.useState(s*100),a=u.useCallback(h=>{if(!n)return;let f=h;kC.get()||(f=VM(h,qxe,2));const p=Hxe(f);t(Kk({entityIdentifier:n,opacity:p}))},[t,n]),l=u.useCallback(()=>{if(n){if(isNaN(Number(i))){o(100);return}t(Kk({entityIdentifier:n,opacity:to(i/100,0,1)}))}},[t,i,n]),c=u.useCallback((h,f)=>{o(f)},[]),d=u.useCallback(h=>{h.key==="Enter"&&l()},[l]);return u.useEffect(()=>{o((s??1)*100)},[s]),r.jsxs(Vn,{children:[r.jsxs(Z,{w:"min-content",gap:2,isDisabled:n===null||n.type==="reference_image",children:[r.jsx(te,{m:0,children:e("controlLayers.opacity")}),r.jsx(np,{children:r.jsxs(e1,{display:"flex",alignItems:"center",min:0,max:100,step:1,value:i,onChange:c,onBlur:l,w:"76px",format:zxe,defaultValue:1,onKeyDown:d,clampValueOnBlur:!1,variant:"outline",children:[r.jsx(t1,{paddingInlineEnd:7,_focusVisible:{zIndex:0},title:""}),r.jsx(Yn,{children:r.jsx(ae,{"aria-label":"open-slider",icon:r.jsx(Pr,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full",isDisabled:n===null||n.type==="reference_image"})})]})})]}),r.jsxs(Gn,{w:200,pt:0,pb:2,px:4,children:[r.jsx(_i,{}),r.jsx(Xn,{children:r.jsx(qe,{min:0,max:100,value:i,onChange:a,defaultValue:Uxe,marks:S2,formatValue:Wxe,alwaysShowMarks:!0,isDisabled:n===null||n.type==="reference_image"})})]})]})});t$.displayName="EntityListSelectedEntityActionBarOpacity";const n$=u.memo(()=>{const{t:e}=P(),t=I(kn),n=E9(t);return!t||!Wb(t)?null:r.jsx(ae,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.selectObject.selectObject"),tooltip:e("controlLayers.selectObject.selectObject"),icon:r.jsx(HE,{})})});n$.displayName="EntityListSelectedEntityActionBarSelectObjectButton";const s$=u.memo(()=>{const{t:e}=P(),t=I(kn),n=zw(t);return!t||!sm(t)?null:r.jsx(ae,{onClick:n.start,isDisabled:n.isDisabled,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.transform.transform"),tooltip:e("controlLayers.transform.transform"),icon:r.jsx(vp,{})})});s$.displayName="EntityListSelectedEntityActionBarTransformButton";const r$=u.memo(()=>{const{t:e}=P(),t=tt(),n=I(kn),s=po(n),i=P9(),o=u.useCallback(()=>{i(s)},[i,s]);return!n||!UZ(n)?null:r.jsx(ae,{onClick:o,isDisabled:!n||t,minW:8,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.saveLayerToAssets"),tooltip:e("controlLayers.saveLayerToAssets"),icon:r.jsx(Ui,{})})});r$.displayName="EntityListSelectedEntityActionBarSaveToAssetsButton";const i$=u.memo(()=>r.jsxs(T,{w:"full",gap:2,alignItems:"center",ps:1,children:[r.jsx(t$,{}),r.jsx(nt,{}),r.jsx(JB,{}),r.jsxs(T,{h:"full",children:[r.jsx(n$,{}),r.jsx(e$,{}),r.jsx(s$,{}),r.jsx(r$,{}),r.jsx(XB,{}),r.jsx(YB,{})]})]}));i$.displayName="EntityListSelectedEntityActionBar";const Zxe=({amplitude:e,stroke:t,strokeWidth:n,width:s,height:i,segments:o=5})=>{const a=()=>{if(e===0)return`M0,${i/2} L${s},${i/2}`;const l=Math.min(i/2,e),c=s/o;let d=`M0,${i/2}`;for(let h=1;h<=o;h++){const f=h*c,p=i/2+(h%2===0?l:-l);d+=` Q${f-c/2},${p} ${f},${i/2}`}return d};return r.jsx("svg",{width:s,height:i,viewBox:`0 0 ${s} ${i}`,xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:a(),fill:"none",stroke:t,strokeWidth:n})})},Yxe=ve(jC,e=>e.length>0),o$=u.memo(()=>{const e=I(qZ),t=z(),n=I(Yxe),s=u.useCallback(l=>{t(yT(l))},[t]),i=I(KZ),{t:o}=P(),[a]=MC("colors",["invokeBlue.300"]);return r.jsxs(Z,{isDisabled:!n,p:1,justifyContent:"space-between",h:8,children:[r.jsxs(T,{gap:3,alignItems:"center",children:[r.jsx(Ve,{feature:"paramDenoisingStrength",children:r.jsx(te,{mr:0,children:`${o("parameters.denoisingStrength")}`})}),n&&r.jsx(Zxe,{amplitude:e*10,stroke:a,strokeWidth:1,width:40,height:14})]}),n?r.jsxs(r.Fragment,{children:[r.jsx(qe,{step:i.coarseStep,fineStep:i.fineStep,min:i.sliderMin,max:i.sliderMax,defaultValue:i.initial,onChange:s,value:e}),r.jsx(Ae,{step:i.coarseStep,fineStep:i.fineStep,min:i.numberInputMin,max:i.numberInputMax,defaultValue:i.initial,onChange:s,value:e,variant:"outline"})]}):r.jsx(T,{alignItems:"center",children:r.jsx(os,{opacity:"0.6",children:o("parameters.disabledNoRasterContent")})})]})});o$.displayName="ParamDenoisingStrength";const a$=u.memo(()=>{const e=I(ZZ),t=u.useRef(null);return Go("layers",t),r.jsxs(T,{ref:t,flexDir:"column",gap:2,w:"full",h:"full",children:[r.jsx(i$,{}),r.jsx(Et,{py:0}),r.jsx(o$,{}),r.jsx(Et,{py:0}),!e&&r.jsx(rB,{}),e&&r.jsx(ZB,{})]})});a$.displayName="CanvasLayersPanelContent";const l$=u.memo(()=>{const e=ce(YZ),t=ce(CC);return e&&t?r.jsx(n1,{fontSize:"md",fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",href:t,children:e}):null});l$.displayName="GalleryHeader";const iu=Symbol("NO_SIZE"),w2=e=>{const t=u.useRef(null),[n,s]=u.useState(1),[i,o]=u.useState(1),a=u.useCallback(()=>{if(!(t!=null&&t.current))return;const C=ab(e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection),v=ab(e.defaultSizePx??e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection);if(C===iu||v===iu)return;s(C),v>C?o(v):o(C);const b=t.current.getSize();!t.current.isCollapsed()&&b<C&&C>0&&t.current.resize(C)},[e.defaultSizePx,e.imperativePanelGroupRef,e.minSizePx,e.panelGroupDirection]);u.useLayoutEffect(()=>{if(!e.imperativePanelGroupRef.current)return;const C=e.imperativePanelGroupRef.current.getId(),v=hy(C),b=El(C);if(!v)return;const S=new ResizeObserver(a);return S.observe(v),b.forEach(w=>S.observe(w)),a(),()=>{S.disconnect()}},[e.imperativePanelGroupRef,a]);const[l,c]=u.useState(()=>{var C;return!!((C=t.current)!=null&&C.isCollapsed())}),d=u.useCallback(()=>{var C;c(!0),(C=e.onCollapse)==null||C.call(e,!0)},[e]),h=u.useCallback(()=>{var C;c(!1),(C=e.onCollapse)==null||C.call(e,!1)},[e]),f=u.useCallback(()=>{var C,v,b;(C=t.current)!=null&&C.isCollapsed()?(v=t.current)==null||v.expand():(b=t.current)==null||b.collapse()},[]),p=u.useCallback(()=>{var C;(C=t.current)==null||C.expand()},[]),g=u.useCallback(()=>{var C;(C=t.current)==null||C.collapse()},[]),m=u.useCallback(C=>{var b;const v=ab(C,e.imperativePanelGroupRef,e.panelGroupDirection);v!==iu&&((b=t.current)==null||b.resize(v))},[e]),y=u.useCallback(()=>{var C;(C=t.current)==null||C.resize(n)},[n]),x=u.useCallback(()=>{var C,v;if(Math.abs((((C=t.current)==null?void 0:C.getSize())??0)-i)<.01){g();return}(v=t.current)==null||v.resize(i)},[i,g]);return{isCollapsed:l,reset:y,toggle:f,expand:p,collapse:g,resize:m,panelProps:{id:e.id,defaultSize:i,onCollapse:d,onExpand:h,ref:t,minSize:n},resizeHandleProps:{onDoubleClick:x}}},ab=(e,t,n)=>{if(!t.current)return iu;const s=t.current.getId(),i=hy(s);if(!i)return iu;let o=n==="horizontal"?i.offsetWidth:i.offsetHeight;return o?(El(s).forEach(a=>{o-=n==="horizontal"?a.offsetWidth:a.offsetHeight}),Math.max(Math.min(e/o*100,100),1)):iu},jj=ve(Qr,e=>e.allowPrivateBoards),Xxe=({isPrivateBoard:e})=>{const{t}=P(),n=z(),s=I(jj),[i,{isLoading:o}]=XZ(),a=u.useMemo(()=>t(s?e?"boards.addPrivateBoard":"boards.addSharedBoard":"boards.addBoard"),[s,e,t]),l=u.useCallback(async()=>{try{const c=await i({board_name:t("boards.myBoard"),is_private:e}).unwrap();n(af({boardId:c.board_id})),n(Dm(""))}catch{}},[t,i,e,n]);return r.jsx(ae,{icon:r.jsx(Ht,{}),isLoading:o,tooltip:a,"aria-label":a,onClick:l,size:"md","data-testid":"add-board-button",variant:"link",w:8,h:8})},Qxe=u.memo(Xxe),kj=u.memo(()=>{const{t:e}=P();return r.jsx(os,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:e("common.auto")})});kj.displayName="AutoAddBadge";const Jxe=({board:e,children:t})=>{const{t:n}=P(),s=z(),i=I(Ru),o=u.useMemo(()=>ve(Ar,C=>e.board_id===C),[e.board_id]),[a]=r3(),l=I(o),c=Sp(e.board_id),d=un("bulkDownload"),[h]=vC(),f=u.useCallback(()=>{s(ap(e.board_id))},[e.board_id,s]),p=u.useCallback(()=>{h({image_names:[],board_id:e.board_id})},[e.board_id,h]),g=u.useCallback(async()=>{try{await a({board_id:e.board_id,changes:{archived:!0}}).unwrap()}catch{fe({status:"error",title:"Unable to archive board"})}},[e.board_id,a]),m=u.useCallback(()=>{a({board_id:e.board_id,changes:{archived:!1}})},[e.board_id,a]),y=u.useCallback(()=>{Lh.set(e)},[e]),x=u.useCallback(()=>r.jsx(kt,{visibility:"visible",children:r.jsxs(Cr,{title:c,children:[!i&&r.jsx(he,{icon:r.jsx(Ht,{}),isDisabled:l,onClick:f,children:n(l?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),d&&r.jsx(he,{icon:r.jsx(jE,{}),onClickCapture:p,children:n("boards.downloadBoard")}),e.archived&&r.jsx(he,{icon:r.jsx(yE,{}),onClick:m,children:n("boards.unarchiveBoard")}),!e.archived&&r.jsx(he,{icon:r.jsx(Uoe,{}),onClick:g,children:n("boards.archiveBoard")}),r.jsx(he,{color:"error.300",icon:r.jsx(Xr,{}),onClick:y,isDestructive:!0,children:n("boards.deleteBoard")})]})}),[c,i,l,f,n,d,p,e.archived,m,g,y]);return r.jsx(s1,{renderMenu:x,children:t})},e2e=u.memo(Jxe),c$=u.memo(({board:e,isSelected:t})=>{const{t:n}=P(),s=Xf(!1),i=u.useRef(null),[o,a]=r3(),l=u.useCallback(async d=>{(await Un(()=>o({board_id:e.board_id,changes:{board_name:d}}).unwrap())).isErr()&&fe({status:"error",title:n("boards.updateBoardError")})},[e.board_id,n,o]),c=Ko({value:e.board_name,defaultValue:e.board_name,onChange:l,inputRef:i,onStartEditing:s.setTrue});return c.isEditing?r.jsx(Ct,{ref:i,...c.inputProps,variant:"outline",isDisabled:a.isLoading,_focusVisible:{borderWidth:1,borderColor:"invokeBlueAlpha.400",borderRadius:"base"}}):r.jsxs(T,{alignItems:"center",gap:3,onMouseOver:s.setTrue,onMouseOut:s.setFalse,children:[r.jsx(K,{size:"sm",fontWeight:"semibold",userSelect:"none",color:t?"base.100":"base.300",onDoubleClick:c.startEditing,cursor:"text",children:c.value}),s&&r.jsx(ae,{"aria-label":"edit name",icon:r.jsx(bp,{}),size:"sm",variant:"ghost",onClick:c.startEditing})]})});c$.displayName="CanvasEntityTitleEdit";const u$=({board:e})=>{const{t}=P(),{imagesTotal:n}=i3((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:o})=>({imagesTotal:(o==null?void 0:o.total)??0})}),{assetsTotal:s}=QZ((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:o})=>({assetsTotal:(o==null?void 0:o.total)??0})}),{currentData:i}=Pa((e==null?void 0:e.cover_image_name)??ws);return r.jsxs(T,{flexDir:"column",alignItems:"center",gap:1,children:[i&&r.jsx(dn,{src:i.thumbnail_url,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),r.jsxs(T,{flexDir:"column",alignItems:"center",children:[r.jsxs(K,{noOfLines:1,children:[t("boards.imagesWithCount",{count:n}),", ",t("boards.assetsWithCount",{count:s})]}),(e==null?void 0:e.archived)&&r.jsxs(K,{children:["(",t("boards.archived"),")"]})]})]})},t2e={bg:"base.850"},n2e=({board:e,isSelected:t})=>{const n=z(),{t:s}=P(),i=I(Ar),o=I(Ru),a=I(PC),l=u.useCallback(()=>{a!==e.board_id&&n(af({boardId:e.board_id})),o&&i!==e.board_id&&n(ap(e.board_id))},[a,e.board_id,o,i,n]),c=u.useMemo(()=>g0.getData({boardId:e.board_id}),[e.board_id]);return r.jsxs(ke,{position:"relative",w:"full",h:12,children:[r.jsx(e2e,{board:e,children:d=>r.jsx(Le,{label:r.jsx(u$,{board:e}),openDelay:1e3,placement:"left",closeOnScroll:!0,p:2,children:r.jsxs(T,{ref:d,onClick:l,alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:t?"base.850":void 0,_hover:t2e,w:"full",h:"full",children:[r.jsx(r2e,{board:e}),r.jsx(T,{w:"full",children:r.jsx(c$,{board:e,isSelected:t})}),i===e.board_id&&r.jsx(kj,{}),e.archived&&r.jsx(pt,{as:yE,fill:"base.300"}),r.jsx(K,{variant:"subtext",children:e.image_count})]})})}),r.jsx(vs,{dndTarget:g0,dndTargetData:c,label:s("gallery.move")})]})},s2e=u.memo(n2e),r2e=({board:e})=>{const{currentData:t}=Pa(e.cover_image_name??ws);return t?r.jsx(dn,{src:t.thumbnail_url,draggable:!1,objectFit:"cover",w:10,h:10,borderRadius:"base",borderBottomRadius:"lg"}):r.jsx(T,{w:10,h:10,justifyContent:"center",alignItems:"center",children:r.jsx(pt,{boxSize:10,as:nae,opacity:.7,color:"base.500"})})},i2e=ve(Ar,e=>e==="none"),o2e=({children:e})=>{const{t}=P(),n=z(),s=I(Ru),i=I(i2e),o=un("bulkDownload"),[a]=vC(),l=u.useCallback(()=>{n(ap("none"))},[n]),c=u.useCallback(()=>{a({image_names:[],board_id:"none"})},[a]),d=u.useCallback(()=>r.jsx(kt,{visibility:"visible",children:r.jsxs(Cr,{title:t("boards.uncategorized"),children:[!s&&r.jsx(he,{icon:r.jsx(Ht,{}),isDisabled:i,onClick:l,children:t(i?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),o&&r.jsx(he,{icon:r.jsx(jE,{}),onClickCapture:c,children:t("boards.downloadBoard")})]})}),[s,c,l,o,i,t]);return r.jsx(s1,{renderMenu:d,children:e})},a2e=u.memo(o2e),l2e={bg:"base.850"},d$=u.memo(({isSelected:e})=>{const t=z(),{imagesTotal:n}=i3("none",{selectFromResult:({data:h})=>({imagesTotal:(h==null?void 0:h.total)??0})}),s=I(Ar),i=I(Ru),o=I(i1),a=Sp("none"),l=u.useCallback(()=>{t(af({boardId:"none"})),i&&t(ap("none"))},[t,i]),c=u.useMemo(()=>m0.getData(),[]),{t:d}=P();return o.length?null:r.jsxs(ke,{position:"relative",w:"full",h:12,children:[r.jsx(a2e,{children:h=>r.jsx(Le,{label:r.jsx(u$,{board:null}),openDelay:1e3,placement:"left",closeOnScroll:!0,children:r.jsxs(T,{ref:h,onClick:l,w:"full",h:"full",alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:e?"base.850":void 0,_hover:l2e,children:[r.jsx(T,{w:"10",justifyContent:"space-around",children:r.jsx(pt,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",children:r.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})})}),r.jsx(K,{fontSize:"sm",color:e?"base.100":"base.300",fontWeight:"semibold",noOfLines:1,flexGrow:1,children:a}),s==="none"&&r.jsx(kj,{}),r.jsx(K,{variant:"subtext",children:n})]})})}),r.jsx(vs,{dndTarget:m0,dndTargetData:c,label:d("gallery.move")})]})});d$.displayName="HoverableBoard";const C8=u.memo(d$),S8=({isPrivate:e})=>{const{t}=P(),n=I(PC),s=I(i1),i=I(JZ),{data:o}=Eu(i),a=I(jj),{isOpen:l,onToggle:c}=ar({defaultIsOpen:!0}),d=u.useMemo(()=>o?o.filter(p=>s.length?p.is_private===e&&p.board_name.toLowerCase().includes(s.toLowerCase()):p.is_private===e):er,[s,o,e]),h=u.useMemo(()=>{const p=[];return a&&e&&!s.length&&p.push(r.jsx(C8,{isSelected:n==="none"},"none")),!a&&!s.length&&p.push(r.jsx(C8,{isSelected:n==="none"},"none")),d.forEach(g=>{p.push(r.jsx(s2e,{board:g,isSelected:n===g.board_id},g.board_id))}),p},[a,e,s.length,d,n]),f=u.useMemo(()=>t(a?e?"boards.private":"boards.shared":"boards.boards"),[e,a,t]);return r.jsxs(T,{direction:"column",children:[r.jsxs(T,{position:"sticky",w:"full",justifyContent:"space-between",alignItems:"center",ps:2,py:1,zIndex:1,top:0,bg:"base.900",children:[a?r.jsx(ye,{variant:"unstyled",onClick:c,children:r.jsxs(T,{gap:"2",alignItems:"center",children:[r.jsx(pt,{boxSize:4,as:Pr,transform:l?void 0:"rotate(-90deg)",fill:"base.500"}),r.jsx(K,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:f})]})}):r.jsx(K,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:f}),r.jsx(Qxe,{isPrivateBoard:e})]}),r.jsx(ql,{in:l,style:my,children:r.jsx(T,{direction:"column",gap:1,children:h.length?h:r.jsx(K,{variant:"subtext",textAlign:"center",children:t("boards.noBoards",{boardType:s.length?"Matching":""})})})})]})},c2e={height:"100%",width:"100%"},u2e=()=>{const e=I(jj),[t,n]=u.useState(null);return u.useEffect(()=>{const s=t==null?void 0:t.osInstance();if(!s)return;const i=s.elements().viewport,o=i.style.overflowY;i.style.setProperty("overflow-y","scroll","important");const a=Kn(jL({element:i}),kL({element:i}));return i.style.setProperty("overflow-y",o),a},[t]),r.jsx(ke,{position:"relative",w:"full",h:"full",children:r.jsx(ke,{position:"absolute",top:0,right:0,bottom:0,left:0,children:r.jsxs(tr,{ref:n,style:c2e,options:Il.options,children:[e&&r.jsx(S8,{isPrivate:!0}),r.jsx(S8,{isPrivate:!1})]})})})},d2e=u.memo(u2e),h2e=()=>{const e=z(),t=I(i1),{t:n}=P(),s=u.useCallback(l=>{e(Dm(l))},[e]),i=u.useCallback(()=>{e(Dm(""))},[e]),o=u.useCallback(l=>{l.key==="Escape"&&i()},[i]),a=u.useCallback(l=>{s(l.target.value)},[s]);return r.jsxs(Vo,{children:[r.jsx(Ct,{placeholder:n("boards.searchBoard"),value:t,onKeyDown:o,onChange:a,"data-testid":"board-search-input"}),t&&t.length&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:r.jsx(Nt,{})})})]})},f2e=u.memo(h2e),p2e=()=>{const e=z(),{t}=P(),n=I(Ar),s=I(Ru),{options:i,hasBoards:o}=Eu({},{selectFromResult:({data:d})=>{const h=[{label:t("common.none"),value:"none"}].concat((d??[]).map(({board_id:f,board_name:p})=>({label:p,value:f})));return{options:h,hasBoards:h.length>1}}}),a=u.useCallback(d=>{d&&e(ap(d.value))},[e]),l=u.useMemo(()=>i.find(d=>d.value===n),[i,n]),c=u.useCallback(()=>t("boards.noMatching"),[t]);return r.jsxs(Z,{isDisabled:!o||s,children:[r.jsx(te,{children:t("boards.autoAddBoard")}),r.jsx(Fe,{value:l,options:i,onChange:a,placeholder:t("boards.selectBoard"),noOptionsMessage:c})]})},g2e=u.memo(p2e),m2e=()=>{const e=z(),{t}=P(),n=I(Ru),s=u.useCallback(i=>e(eY(i.target.checked)),[e]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,children:t("gallery.autoAssignBoardOnClick")}),r.jsx(jn,{isChecked:n,onChange:s})]})},y2e=u.memo(m2e),v2e=ve(kr,e=>e.shouldShowArchivedBoards),b2e=()=>{const e=z(),{t}=P(),n=I(v2e),s=u.useCallback(i=>{e(tY(i.target.checked))},[e]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,children:t("gallery.showArchivedBoards")}),r.jsx(jn,{isChecked:n,onChange:s})]})},x2e=u.memo(b2e),C2e=$e.enum(["created_at","board_name"]),S2e=e=>C2e.safeParse(e).success,w2e=$e.enum(["ASC","DESC"]),j2e=e=>w2e.safeParse(e).success,k2e=()=>{const{t:e}=P(),t=I(nY),n=I(sY),s=u.useMemo(()=>[{value:"created_at",label:e("workflows.created")},{value:"board_name",label:e("workflows.name")}],[e]),i=u.useMemo(()=>[{value:"ASC",label:e("workflows.ascending")},{value:"DESC",label:e("workflows.descending")}],[e]),o=z(),a=u.useCallback(h=>{!S2e(h==null?void 0:h.value)||h.value===t||o(rY(h.value))},[t,o]),l=u.useMemo(()=>s.find(h=>h.value===t)||s[0],[t,s]),c=u.useCallback(h=>{!j2e(h==null?void 0:h.value)||h.value===n||o(iY(h.value))},[n,o]),d=u.useMemo(()=>i.find(h=>h.value===n),[n,i]);return r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(Z,{orientation:"horizontal",gap:1,children:[r.jsx(te,{children:e("common.orderBy")}),r.jsx(Fe,{isSearchable:!1,value:l,options:s,onChange:a})]}),r.jsxs(Z,{orientation:"horizontal",gap:1,children:[r.jsx(te,{children:e("common.direction")}),r.jsx(Fe,{isSearchable:!1,value:d,options:i,onChange:c})]})]})},_2e=()=>{const{t:e}=P();return r.jsxs(Vn,{isLazy:!0,children:[r.jsx(Yn,{children:r.jsx(ae,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.boardsSettings"),icon:r.jsx(zu,{}),tooltip:e("gallery.boardsSettings")})}),r.jsx(Gn,{children:r.jsx(Xn,{children:r.jsxs(T,{direction:"column",gap:2,children:[r.jsx(y2e,{}),r.jsx(x2e,{}),r.jsx(g2e,{}),r.jsx(ke,{py:2,children:r.jsx(Et,{})}),r.jsx(k2e,{})]})})})]})},I2e=u.memo(_2e),A2e=()=>{wt("gallery-search-state");const e=z(),t=I(oY),[n,s]=u.useState(t),i=u.useMemo(()=>Ea(l=>{e(Zk(l))},1e3),[e]),o=u.useCallback(l=>{s(l),i(l)},[i]),a=u.useCallback(()=>{i.cancel(),s(""),e(Zk(""))},[i,e]);return[n,o,a]},T2e=ve(kr,e=>e.alwaysShowImageSizeBadge),M2e=()=>{const e=z(),{t}=P(),n=I(T2e),s=u.useCallback(i=>e(aY(i.target.checked)),[e]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,children:t("gallery.alwaysShowImageSizeBadge")}),r.jsx(jn,{isChecked:n,onChange:s})]})},P2e=u.memo(M2e),E2e=ve(kr,e=>e.shouldAutoSwitch),L2e=()=>{const e=z(),{t}=P(),n=I(E2e),s=u.useCallback(i=>{e(lY(i.target.checked))},[e]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,children:t("gallery.autoSwitchNewImages")}),r.jsx(jn,{isChecked:n,onChange:s})]})},D2e=u.memo(L2e),R2e=()=>{const e=z(),{t}=P(),n=I(o3),s=u.useCallback(i=>{e(cY(i))},[e]);return r.jsxs(Z,{children:[r.jsx(te,{children:t("gallery.galleryImageSize")}),r.jsx(qe,{value:n,onChange:s,min:45,max:256,defaultValue:90})]})},O2e=u.memo(R2e),N2e=ve(kr,e=>e.starredFirst),F2e=()=>{const e=z(),{t}=P(),n=I(N2e),s=u.useCallback(i=>{e(uY(i.target.checked))},[e]);return r.jsxs(Z,{w:"full",children:[r.jsx(te,{flexGrow:1,m:0,children:t("gallery.showStarredImagesFirst")}),r.jsx(it,{size:"sm",isChecked:n,onChange:s})]})},B2e=u.memo(F2e),$2e=ve(kr,e=>e.orderDir),V2e=()=>{const e=z(),{t}=P(),n=I($2e),s=u.useMemo(()=>[{value:"DESC",label:t("gallery.newestFirst")},{value:"ASC",label:t("gallery.oldestFirst")}],[t]),i=u.useCallback(a=>{Re((a==null?void 0:a.value)==="ASC"||(a==null?void 0:a.value)==="DESC"),e(dY(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===n),[n,s]);return r.jsxs(Z,{children:[r.jsx(te,{flexGrow:1,m:0,children:t("gallery.sortDirection")}),r.jsx(Fe,{isSearchable:!1,value:o,options:s,onChange:i})]})},G2e=u.memo(V2e),z2e=()=>{const{t:e}=P();return r.jsxs(Vn,{isLazy:!0,children:[r.jsx(Yn,{children:r.jsx(ae,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.imagesSettings"),icon:r.jsx(zu,{}),tooltip:e("gallery.imagesSettings")})}),r.jsx(Gn,{children:r.jsx(Xn,{children:r.jsxs(T,{direction:"column",gap:2,children:[r.jsx(O2e,{}),r.jsx(D2e,{}),r.jsx(P2e,{}),r.jsx(Et,{pt:2}),r.jsx(B2e,{}),r.jsx(G2e,{})]})})})]})},H2e=u.memo(z2e),W2e=()=>{const e=I(fC),t=u.useMemo(()=>({allowMultiple:e!==1}),[e]),n=ec(t);return r.jsxs(r.Fragment,{children:[r.jsx(ae,{size:"sm",alignSelf:"stretch",variant:"link","aria-label":e===void 0||e>1?Ce("accessibility.uploadImages"):Ce("accessibility.uploadImage"),tooltip:e===void 0||e>1?Ce("accessibility.uploadImages"):Ce("accessibility.uploadImage"),icon:r.jsx(xp,{}),...n.getUploadButtonProps()}),r.jsx("input",{...n.getUploadInputProps()})]})},h$=u.memo(()=>{const e=z(),t=I(hY),{imageDTOs:n}=uj(),s=Ds("gallery"),i=u.useCallback(()=>{e(H0([...t,...n]))},[e,t,n]);return Ee({id:"selectAllOnPage",category:"gallery",callback:i,options:{preventDefault:!0,enabled:s},dependencies:[i,s]}),t.length<=1?null:r.jsx(f$,{})});h$.displayName="GallerySelectionCountTag";const f$=u.memo(()=>{const{t:e}=P(),t=z(),n=Ds("gallery"),s=I(fY),i=I(bC),o=u.useCallback(()=>{s&&t(H0([s]))},[t,s]);return Ee({id:"clearSelection",category:"gallery",callback:o,options:{enabled:i>0&&n},dependencies:[o,i,n]}),r.jsxs(EC,{position:"absolute",bg:"invokeBlue.800",color:"base.50",py:2,px:4,userSelect:"none",shadow:"dark-lg",fontWeight:"semibold",border:1,borderStyle:"solid",borderColor:"whiteAlpha.300",children:[r.jsxs(a3,{children:[i," ",e("common.selected")]}),r.jsx(LC,{onClick:o})]})});f$.displayName="GallerySelectionCountTagContent";const U2e=()=>{wt("useGalleryHotkeys");const{goNext:e,goPrev:t,isNextEnabled:n,isPrevEnabled:s}=ly(),i=z(),o=I(j=>j.gallery.selection),a=I(Du),l=Ul(a),c=I(cf),d=I(On),h=Ds("workflows"),f=Ds("gallery"),p=Ds("viewer"),g=u.useMemo(()=>d!=="canvas"?!0:c==="gallery",[d,c]),{handleLeftImage:m,handleRightImage:y,handleUpImage:x,handleDownImage:C,isOnFirstRow:v,isOnLastRow:b,isOnFirstImageOfView:S,isOnLastImageOfView:w}=fF();Ee({id:"galleryNavLeft",category:"gallery",callback:()=>{if(S&&s&&!l.isFetching){t("arrow");return}m(!1)},options:{preventDefault:!0,enabled:f||p},dependencies:[m,S,t,s,l.isFetching,f,p]}),Ee({id:"galleryNavRight",category:"gallery",callback:()=>{if(w&&n&&!l.isFetching){e("arrow");return}w||y(!1)},options:{preventDefault:!0,enabled:f||p},dependencies:[w,e,n,l.isFetching,y,f,p]}),Ee({id:"galleryNavUp",category:"gallery",callback:()=>{if(v&&s&&!l.isFetching){t("arrow");return}x(!1)},options:{preventDefault:!0,enabled:f},dependencies:[x,v,t,s,l.isFetching,f]}),Ee({id:"galleryNavDown",category:"gallery",callback:()=>{if(b&&n&&!l.isFetching){e("arrow");return}C(!1)},options:{preventDefault:!0,enabled:f},dependencies:[b,e,n,l.isFetching,C,f]}),Ee({id:"galleryNavLeftAlt",category:"gallery",callback:()=>{if(S&&s&&!l.isFetching){t("alt+arrow");return}m(!0)},options:{preventDefault:!0,enabled:f||p},dependencies:[m,S,t,s,l.isFetching,f,p]}),Ee({id:"galleryNavRightAlt",category:"gallery",callback:()=>{if(w&&n&&!l.isFetching){e("alt+arrow");return}w||y(!0)},options:{preventDefault:!0,enabled:f||p},dependencies:[w,e,n,l.isFetching,y,f,p]}),Ee({id:"galleryNavUpAlt",category:"gallery",callback:()=>{if(v&&s&&!l.isFetching){t("alt+arrow");return}x(!0)},options:{preventDefault:!0,enabled:f},dependencies:[x,v,t,s,l.isFetching,f]}),Ee({id:"galleryNavDownAlt",category:"gallery",callback:()=>{if(b&&n&&!l.isFetching){e("alt+arrow");return}C(!0)},options:{preventDefault:!0,enabled:f},dependencies:[b,e,n,l.isFetching,C,f]}),Ee({id:"deleteSelection",category:"gallery",callback:()=>{o.length&&i($f(o))},options:{enabled:(f||p)&&g&&!h},dependencies:[h,g,o,h]})},q2e=()=>{U2e();const{t:e}=P(),t=I(Du),{hasImages:n,isLoading:s,isError:i}=Ul(t,{selectFromResult:({data:o,isLoading:a,isSuccess:l,isError:c})=>({hasImages:o&&o.items.length>0,isLoading:a,isSuccess:l,isError:c})});return i?r.jsx(ke,{w:"full",h:"full",children:r.jsx(Yt,{label:e("gallery.unableToLoad"),icon:BE})}):s?r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Yt,{label:e("gallery.loading"),icon:mu})}):n?r.jsx(p$,{}):r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Yt,{label:e("gallery.noImagesInGallery"),icon:mu})})},K2e=u.memo(q2e),p$=u.memo(()=>{const e=z(),t=I(o3),n=I(pY),[s,i]=u.useState(null),o=u.useMemo(()=>Ea(()=>{if(!s)return;const a=document.querySelector(`.${dj}`);if(!a)return;const l=document.querySelector(`.${y2}`);if(!l)return;const c=a.getBoundingClientRect(),d=s.getBoundingClientRect(),h=window.getComputedStyle(l),f=parseFloat(h.gap);if(!c.width||!c.height||!d.width||!d.height)return;let p=0,g=0;for(;g+c.height<=d.height+1;)p++,g+=c.height,g+f<=d.height&&(g+=f);let m=0;for(g=0;g+c.width<=d.width+1;)m++,g+=c.width,g+f<=d.width&&(g+=f);const y=Math.max(m,m*p);n===0||n===y||e(gY(y))},300),[s,e,n]);return u.useEffect(()=>{o()},[o,t]),u.useEffect(()=>{if(!s)return;const a=new ResizeObserver(o);return a.observe(s),o(),()=>{a.disconnect()}},[o,s,e]),r.jsxs(ke,{position:"relative",w:"full",h:"full",mt:2,children:[r.jsx(ke,{ref:i,position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",overflow:"hidden",children:r.jsx(Kr,{className:y2,gridTemplateColumns:`repeat(auto-fill, minmax(${t}px, 1fr))`,gap:1,children:r.jsx(g$,{})})}),r.jsx(h$,{})]})});p$.displayName="GalleryImageGridContent";const g$=u.memo(()=>{const e=I(Du),{imageDTOs:t}=Ul(e,{selectFromResult:({data:n})=>({imageDTOs:(n==null?void 0:n.items)??er})});return r.jsx(r.Fragment,{children:t.map(n=>r.jsx(hF,{imageDTO:n},n.image_name))})});g$.displayName="GalleryImageGridImages";const m$=u.memo(()=>{const{t:e}=P(),{goToPage:t,currentPage:n,pages:s}=ly(),[i,o]=u.useState(n),{isOpen:a,onToggle:l,onClose:c}=ar(),d=u.useRef(null),h=u.useCallback(()=>{o(n),setTimeout(()=>{var m;const g=(m=d.current)==null?void 0:m.querySelector("input");g==null||g.focus(),g==null||g.select()},0)},[n]),f=u.useCallback(g=>{o(g-1)},[]),p=u.useCallback(()=>{t(i),c()},[i,t,c]);return Si("enter",()=>{p()},{enabled:a,enableOnFormTags:["input"]},[a,p]),Si("esc",()=>{o(n),c()},{enabled:a,enableOnFormTags:["input"]},[a,c]),u.useEffect(()=>{o(n)},[n]),r.jsxs(Vn,{isOpen:a,onClose:c,onOpen:h,isLazy:!0,lazyBehavior:"unmount",children:[r.jsx(Yn,{children:r.jsx(ye,{"aria-label":e("gallery.jump"),size:"sm",onClick:l,variant:"outline",children:e("gallery.jump")})}),r.jsxs(Gn,{children:[r.jsx(_i,{}),r.jsx(Xn,{children:r.jsxs(T,{gap:2,alignItems:"center",children:[r.jsx(Z,{children:r.jsx(Ae,{ref:d,size:"sm",maxW:"60px",value:i+1,min:1,max:s,step:1,onChange:f})}),r.jsx(ye,{h:"full",size:"sm",onClick:p,children:e("gallery.go")})]})})]})]})});m$.displayName="JumpTo";const y$=u.memo(()=>{const{goPrev:e,goNext:t,isPrevEnabled:n,isNextEnabled:s,pageButtons:i,goToPage:o,currentPage:a,total:l}=ly(),c=u.useCallback(()=>{e()},[e]),d=u.useCallback(()=>{t()},[t]);return l?r.jsxs(T,{justifyContent:"center",alignItems:"center",w:"full",gap:1,pt:2,children:[r.jsx(ae,{size:"sm","aria-label":"prev",icon:r.jsx(vS,{}),onClick:c,isDisabled:!n,variant:"ghost"}),r.jsx(nt,{}),i.map((h,f)=>r.jsx(v$,{page:h,currentPage:a,goToPage:o},`${h}_${f}`)),r.jsx(nt,{}),r.jsx(ae,{size:"sm","aria-label":"next",icon:r.jsx(A1,{}),onClick:d,isDisabled:!s,variant:"ghost"}),r.jsx(m$,{})]}):null});y$.displayName="GalleryPagination";const v$=u.memo(({page:e,currentPage:t,goToPage:n})=>{const s=u.useCallback(()=>{e!==Uc&&n(e-1)},[n,e]);return e===Uc?r.jsx(ye,{size:"sm",variant:"link",isDisabled:!0,children:"..."}):r.jsx(ye,{size:"sm",onClick:s,variant:t===e-1?"solid":"outline",children:e})});v$.displayName="PageButton";const b$=u.memo(({searchTerm:e,onChangeSearchTerm:t,onResetSearchTerm:n})=>{const{t:s}=P(),i=I(Du),{isPending:o}=Ul(i,{selectFromResult:({isLoading:c,isFetching:d})=>({isPending:c||d})}),a=u.useCallback(c=>{t(c.target.value)},[t]),l=u.useCallback(c=>{c.key==="Escape"&&n()},[n]);return r.jsxs(Vo,{children:[r.jsx(Ct,{placeholder:s("gallery.searchImages"),value:e,onChange:a,"data-testid":"image-search-input",onKeyDown:l}),o&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(or,{size:"sm",opacity:.5})}),!o&&e.length&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{onClick:n,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:r.jsx(Nt,{})})})]})});b$.displayName="GallerySearch";const w8={fontWeight:"semibold",fontSize:"sm",color:"base.300"},j8={borderColor:"base.800",borderBottomColor:"base.900",color:"invokeBlue.300"},Z2e={flexShrink:0,minHeight:0,width:"100%"},Y2e=ve(kr,e=>e.galleryView),X2e=ve(kr,e=>e.searchTerm),Q2e=()=>{const{t:e}=P(),t=z(),n=I(Y2e),s=I(X2e),i=ar({defaultIsOpen:s.length>0}),[o,a,l]=A2e(),c=u.useCallback(()=>{t(Qb("images"))},[t]),d=u.useCallback(()=>{t(Qb("assets"))},[t]),h=u.useCallback(()=>{i.onToggle(),l()},[l,i]),f=I(PC),p=Sp(f);return r.jsxs(T,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",h:"full",w:"full",pt:1,minH:0,children:[r.jsx(Vl,{index:n==="images"?0:1,variant:"enclosed",display:"flex",flexDir:"column",w:"full",children:r.jsxs(Gl,{gap:2,fontSize:"sm",borderColor:"base.800",alignItems:"center",w:"full",children:[r.jsx(K,{fontSize:"sm",fontWeight:"semibold",noOfLines:1,px:"2",wordBreak:"break-all",children:p}),r.jsx(nt,{}),r.jsx(Le,{label:e("gallery.imagesTab"),children:r.jsx(Sn,{sx:w8,_selected:j8,onClick:c,"data-testid":"images-tab",children:e("parameters.images")})}),r.jsx(Le,{label:e("gallery.assetsTab"),children:r.jsx(Sn,{sx:w8,_selected:j8,onClick:d,"data-testid":"assets-tab",children:e("gallery.assets")})}),r.jsxs(T,{h:"full",justifyContent:"flex-end",children:[r.jsx(W2e,{}),r.jsx(H2e,{}),r.jsx(ae,{size:"sm",variant:"link",alignSelf:"stretch",onClick:h,tooltip:i.isOpen?`${e("gallery.exitSearch")}`:`${e("gallery.displaySearch")}`,"aria-label":e("gallery.displaySearch"),icon:r.jsx(ME,{})})]})]})}),r.jsx(ql,{in:i.isOpen,style:Z2e,children:r.jsx(ke,{w:"full",pt:2,children:r.jsx(b$,{searchTerm:o,onChangeSearchTerm:a,onResetSearchTerm:l})})}),r.jsx(K2e,{}),r.jsx(y$,{})]})},J2e={flexShrink:0,minHeight:0},eCe=()=>{const{t:e}=P(),t=I(i1),n=z(),s=ar({defaultIsOpen:!!t.length}),i=u.useRef(null),o=u.useRef(null);Go("gallery",o);const a=u.useMemo(()=>({id:"boards-list-panel",minSizePx:128,defaultSizePx:256,imperativePanelGroupRef:i,panelGroupDirection:"vertical"}),[]),l=w2(a),c=u.useCallback(()=>{t.length&&n(Dm("")),s.onToggle(),l.expand()},[t.length,s,l,n]);return r.jsxs(T,{ref:o,position:"relative",flexDirection:"column",h:"full",w:"full",tabIndex:-1,children:[r.jsxs(T,{alignItems:"center",justifyContent:"space-between",w:"full",children:[r.jsx(T,{flexGrow:1,flexBasis:0,children:r.jsx(ye,{size:"sm",variant:"ghost",onClick:l.toggle,rightIcon:l.isCollapsed?r.jsx(Pr,{}):r.jsx(CE,{}),children:l.isCollapsed?e("boards.viewBoards"):e("boards.hideBoards")})}),r.jsx(T,{children:r.jsx(l$,{})}),r.jsxs(T,{flexGrow:1,flexBasis:0,justifyContent:"flex-end",children:[r.jsx(I2e,{}),r.jsx(ae,{size:"sm",variant:"link",alignSelf:"stretch",onClick:c,tooltip:s.isOpen?`${e("gallery.exitBoardSearch")}`:`${e("gallery.displayBoardSearch")}`,"aria-label":e("gallery.displayBoardSearch"),icon:r.jsx(ME,{}),colorScheme:s.isOpen?"invokeBlue":"base"})]})]}),r.jsxs(Gp,{ref:i,direction:"vertical",autoSaveId:"boards-list-panel",children:[r.jsx(Xi,{collapsible:!0,...l.panelProps,children:r.jsxs(T,{flexDir:"column",w:"full",h:"full",children:[r.jsx(ql,{in:s.isOpen,style:J2e,children:r.jsx(ke,{w:"full",pt:2,children:r.jsx(f2e,{})})}),r.jsx(Et,{pt:2}),r.jsx(d2e,{})]})}),r.jsx(Tf,{id:"gallery-panel-handle",...l.resizeHandleProps}),r.jsx(Xi,{id:"gallery-wrapper-panel",minSize:20,children:r.jsx(Q2e,{})})]})]})},x$=u.memo(eCe),C$=u.memo(()=>{const{t:e}=P(),t=I(cf),n=Lt(),s=z(),i=u.useMemo(()=>t==="gallery"?1:0,[t]),o=u.useCallback(()=>{t!=="gallery"&&s(Ys("gallery")),n.toggle()},[n,t,s]),a=u.useCallback(l=>{s(l===0?Ys("layers"):Ys("gallery"))},[s]);return Ee({id:"toggleViewer",category:"viewer",callback:n.toggle,dependencies:[n]}),r.jsxs(Vl,{index:i,onChange:a,w:"full",h:"full",display:"flex",flexDir:"column",children:[r.jsxs(Gl,{alignItems:"center",children:[r.jsx(S$,{}),r.jsx(nt,{}),r.jsx(ye,{size:"sm",variant:"ghost",onClick:o,children:n.isOpen?e("gallery.closeViewer"):e("gallery.openViewer")})]}),r.jsxs(Lu,{w:"full",h:"full",children:[r.jsx(Pn,{w:"full",h:"full",p:0,pt:3,children:r.jsx(zr,{children:r.jsx(a$,{})})}),r.jsx(Pn,{w:"full",h:"full",p:0,pt:3,children:r.jsx(x$,{})})]})]})});C$.displayName="CanvasRightPanel";const S$=u.memo(()=>{const{t:e}=P(),t=_a(),n=I(mY),[s,i]=u.useState("idle"),[o,a]=u.useState("idle"),l=u.useRef(null),c=u.useRef(null),d=u.useRef(null),h=u.useMemo(()=>n===0?e("controlLayers.layer_other"):`${e("controlLayers.layer_other")} (${n})`,[n,e]);return u.useEffect(()=>{if(!l.current)return;const f=()=>cf(t.getState())==="layers",p=()=>{f()||(i("over"),d.current=window.setTimeout(()=>{d.current=null,t.dispatch(Ys("layers")),i("idle"),a("potential")},300))},g=()=>{f()?i("idle"):i("potential"),d.current!==null&&clearTimeout(d.current)},m=()=>{i("potential")};return Kn(yu({element:l.current,onDragEnter:p,onDragLeave:g}),qi({canMonitor:({source:y})=>!wn.typeGuard(y.data)&&!Zr.typeGuard(y.data)?!1:!f(),onDragStart:m}),hx({element:l.current,onDragEnter:p,onDragLeave:g}),zh({canMonitor:()=>!f(),onDragStart:m}))},[t]),u.useEffect(()=>{if(!c.current)return;const f=()=>cf(t.getState())==="gallery",p=()=>{f()||(a("over"),d.current=window.setTimeout(()=>{d.current=null,t.dispatch(Ys("gallery")),a("idle"),i("potential")},300))},g=()=>{f()?a("idle"):a("potential"),d.current!==null&&clearTimeout(d.current)},m=()=>{a("potential")};return Kn(yu({element:c.current,onDragEnter:p,onDragLeave:g}),qi({canMonitor:({source:y})=>!wn.typeGuard(y.data)&&!Zr.typeGuard(y.data)?!1:!f(),onDragStart:m}),hx({element:c.current,onDragEnter:p,onDragLeave:g}),zh({canMonitor:()=>!f(),onDragStart:m}))},[t]),u.useEffect(()=>{const f=()=>{a("idle"),i("idle")},p=Kn(qi({onDrop:f}),zh({onDrop:f}));return()=>{p(),d.current!==null&&clearTimeout(d.current)}},[]),r.jsxs(r.Fragment,{children:[r.jsxs(Sn,{ref:l,position:"relative",w:32,children:[r.jsx(ke,{as:"span",w:"full",children:h}),r.jsx(hf,{dndState:s,withBackdrop:!1})]}),r.jsxs(Sn,{ref:c,position:"relative",w:32,children:[r.jsx(ke,{as:"span",w:"full",children:e("gallery.gallery")}),r.jsx(hf,{dndState:o,withBackdrop:!1})]})]})});S$.displayName="PanelTabs";const lb=nr("dnd"),tCe=()=>{wt("useDropMonitor"),u.useEffect(()=>Kn(qi({canMonitor:({source:e})=>{const t=e.data;return!(!wn.typeGuard(t)&&!Zr.typeGuard(t))},onDrop:({source:e,location:t})=>{const n=t.current.dropTargets[0];if(!n){lb.warn("No dnd target");return}const s=e.data,i=n.data,{dispatch:o,getState:a}=ut();for(const l of d0e){if(!l.typeGuard(i))continue;const c={sourceData:s,targetData:i,dispatch:o,getState:a};if(l.isValid(c)){lb.debug(Em({sourceData:s,targetData:i}),"Handling dnd drop"),l.handler(c);return}}lb.warn(Em({sourceData:s,targetData:i}),"Invalid drop")}})),[])},w$=u.createContext(null),xy=u.memo(e=>r.jsx(w$.Provider,{value:e.view,children:e.children}));xy.displayName="ViewContextProvider";const nCe=()=>{const e=u.useContext(w$);return Re(e!==null,"useViewContext must be used within a ViewContextProvider"),e},sCe=It(ot,e=>o1(e)),rCe=()=>{const{t:e}=P(),t=I(sCe);return t?r.jsx(Bo,{data:t.data,label:"Node Data"}):r.jsx(Yt,{label:e("nodes.noNodeSelected"),icon:null})},iCe=u.memo(rCe),j$=e=>{const t=u.useMemo(()=>ve(ot,s=>DC(s,e).data.notes),[e]);return I(t)},k$=u.memo(({nodeId:e})=>{const t=z(),{t:n}=P(),s=j$(e),i=u.useCallback(o=>{t(yY({nodeId:e,notes:o.target.value}))},[t,e]);return r.jsxs(Z,{orientation:"vertical",h:"full",children:[r.jsx(te,{children:n("nodes.notes")}),r.jsx(Zn,{value:s,onChange:i,rows:10,resize:"none"})]})});k$.displayName="InvocationNodeNotesTextarea";const oCe=e=>{const t=u.useMemo(()=>ve(ot,s=>{const i=l3(s,e);return Yr(i)}),[e]);return I(t)},_$=e=>{const t=u.useMemo(()=>It(ot,s=>a1(s,e)),[e]);return I(t)},go=e=>{const t=ce(xn),n=u.useMemo(()=>ve(ot,o=>vY(o,e)),[e]),s=I(n);return u.useMemo(()=>{const o=t[s];return Re(o,`Template for node type ${s} not found`),o},[s,t])},I$=e=>{const t=_$(e),n=go(e);return u.useMemo(()=>c3(t,n),[t,n])},_j=e=>{const t=u.useMemo(()=>ve(ot,s=>{const i=s.nodes.find(o=>o.id===e);return i==null?void 0:i.data.label}),[e]);return I(t)},A$=e=>{const t=ce(xn),n=u.useMemo(()=>ve(ot,i=>{const o=i.nodes.find(l=>l.id===e);if(!Yr(o))return null;const a=t[o.data.type];return(a==null?void 0:a.title)??null}),[e,t]);return I(n)},aCe=({nodeId:e,title:t})=>{const n=z(),s=_j(e),i=A$(e),{t:o}=P(),a=u.useRef(null),l=u.useCallback(d=>{n(u3({nodeId:e,label:d}))},[n,e]),c=Ko({value:s||t||i||o("nodes.problemSettingTitle"),defaultValue:t||i||o("nodes.problemSettingTitle"),onChange:l,inputRef:a});return r.jsxs(T,{w:"full",alignItems:"center",justifyContent:"center",children:[!c.isEditing&&r.jsx(K,{size:"sm",fontWeight:"semibold",userSelect:"none",onDoubleClick:c.startEditing,children:c.value}),c.isEditing&&r.jsx(Ct,{ref:a,...c.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},lCe=u.memo(aCe),cCe=()=>{const e=ce(xn),t=u.useMemo(()=>It(ot,i=>{const o=o1(i),a=o?e[o.data.type]:void 0;if(!(!Yr(o)||!a))return{nodeId:o.data.id,nodeVersion:o.data.version,templateTitle:a.title}}),[e]),n=I(t),{t:s}=P();return n?r.jsx(T$,{nodeId:n.nodeId,nodeVersion:n.nodeVersion,templateTitle:n.templateTitle}):r.jsx(Yt,{label:s("nodes.noNodeSelected"),icon:null})},uCe=u.memo(cCe),T$=u.memo(e=>{const{t}=P(),n=I$(e.nodeId),s=oCe(e.nodeId);return r.jsx(ke,{position:"relative",w:"full",h:"full",children:r.jsx(Nn,{children:r.jsxs(T,{flexDir:"column",position:"relative",w:"full",h:"full",p:1,gap:2,children:[r.jsx(lCe,{nodeId:e.nodeId}),r.jsxs(bY,{children:[r.jsxs(Z,{children:[r.jsx(te,{children:t("nodes.nodeType")}),r.jsx(K,{fontSize:"sm",fontWeight:"semibold",children:e.templateTitle})]}),r.jsxs(Z,{isInvalid:n,children:[r.jsx(te,{children:t("nodes.nodeVersion")}),r.jsx(K,{fontSize:"sm",fontWeight:"semibold",children:e.nodeVersion})]})]}),s&&r.jsx(k$,{nodeId:e.nodeId})]})})})});T$.displayName="Content";const dCe=({output:e})=>{const{image:t}=e,{currentData:n}=Pa(t.image_name);return n?r.jsx($a,{imageDTO:n}):null},hCe=u.memo(dCe),fCe=()=>{const e=ce(xn),t=u.useMemo(()=>It(ot,o=>{const a=o1(o),l=a?e[a.data.type]:void 0;if(!(!Yr(a)||!l))return{nodeId:a.id,outputType:l.outputType}}),[e]),n=I(t),s=RC(n==null?void 0:n.nodeId),{t:i}=P();return!n||!s?r.jsx(Yt,{label:i("nodes.noNodeSelected"),icon:null}):s.outputs.length===0?r.jsx(Yt,{label:i("nodes.noOutputRecorded"),icon:null}):r.jsx(ke,{position:"relative",w:"full",h:"full",children:r.jsx(Nn,{children:r.jsx(T,{position:"relative",flexDir:"column",alignItems:"flex-start",p:1,gap:2,h:"full",w:"full",children:n.outputType==="image_output"?s.outputs.map((o,a)=>r.jsx(hCe,{output:o},gCe(o,a))):r.jsx(Bo,{data:s.outputs,label:i("nodes.nodeOutputs")})})})})},pCe=u.memo(fCe),gCe=(e,t)=>`${e.type}-${t}`,mCe=()=>{const e=ce(xn),t=u.useMemo(()=>It(ot,i=>{const o=o1(i);return o?e[o.data.type]:void 0}),[e]),n=I(t),{t:s}=P();return n?r.jsx(Bo,{data:n,label:s("nodes.nodeTemplate")}):r.jsx(Yt,{label:s("nodes.noNodeSelected"),icon:null})},yCe=u.memo(mCe),vCe=()=>{const{t:e}=P();return r.jsx(T,{layerStyle:"first",flexDir:"column",w:"full",h:"full",borderRadius:"base",p:2,gap:2,children:r.jsxs(Vl,{variant:"line",display:"flex",flexDir:"column",w:"full",h:"full",children:[r.jsxs(Gl,{children:[r.jsx(Sn,{children:e("common.details")}),r.jsx(Sn,{children:e("common.outputs")}),r.jsx(Sn,{children:e("common.data")}),r.jsx(Sn,{children:e("common.template")})]}),r.jsxs(Lu,{children:[r.jsx(Pn,{children:r.jsx(uCe,{})}),r.jsx(Pn,{children:r.jsx(pCe,{})}),r.jsx(Pn,{children:r.jsx(iCe,{})}),r.jsx(Pn,{children:r.jsx(yCe,{})})]})]})})},bCe=u.memo(vCe),M$=u.createContext(null),Ij=u.memo(({id:e,layout:t,children:n})=>{const s=u.useMemo(()=>({id:e,layout:t}),[e,t]);return r.jsx(M$.Provider,{value:s,children:n})});Ij.displayName="ContainerContextProvider";const Aj=()=>u.useContext(M$),P$=u.createContext(0),Tj=u.memo(({depth:e,children:t})=>r.jsx(P$.Provider,{value:e,children:t}));Tj.displayName="DepthContextProvider";const Mj=()=>u.useContext(P$),xCe={top:(e,t,n)=>{const s=Math.abs(t.y-e.top);if(!n)return s;const i=Math.min(e.height/4,10);return s<=i?0:1/0},right:(e,t,n)=>{const s=Math.abs(e.right-t.x);if(!n)return s;const i=Math.min(e.width/4,10);return s<=i?0:1/0},bottom:(e,t,n)=>{const s=Math.abs(e.bottom-t.y);if(!n)return s;const i=Math.min(e.height/4,10);return s<=i?0:1/0},left:(e,t,n)=>{const s=Math.abs(t.x-e.left);if(!n)return s;const i=Math.min(e.width/4,10);return s<=i?0:1/0},center:(e,t,n)=>{const s=e.left+e.width/2,i=e.top+e.height/2;return Math.sqrt((t.x-s)**2+(t.y-i)**2)}},E$=Symbol("centerWithClosestEdge");function CCe(e,{element:t,input:n,allowedCenterOrEdge:s}){var d;const i={x:n.clientX,y:n.clientY},o=t.getBoundingClientRect(),a=s.includes("center"),c=((d=s.map(h=>({edge:h,value:xCe[h](o,i,a)})).sort((h,f)=>h.value-f.value)[0])==null?void 0:d.edge)??null;return{...e,[E$]:c}}function L$(e){return e[E$]??null}const SCe=_e("edit-mode-wrapper","-"),Pj=e=>`${e}-edit-mode-wrapper`,es=nr("dnd"),D$=Symbol("root"),wCe=()=>({[D$]:!0}),jCe=e=>D$ in e,R$=Symbol("form-element"),dl=e=>({[R$]:!0,element:e}),Jh=e=>R$ in e,kCe=e=>{var t;return((t=ut().getState().workflow.form)==null?void 0:t.elements[e])!==void 0},Vi=(e,t)=>{var s;const n=(s=ut().getState().workflow.form)==null?void 0:s.elements[e];return Re(n),t&&Re(t(n)),n},jh=e=>{if(!l1(e))return;const{nodeId:t,fieldName:n}=e.data.fieldIdentifier,{nodes:s}=ot(ut().getState()),i=s.find(a=>a.id===t);if(!i||!Yr(i))return;const o=i.data.inputs[n];if(o)return o.value},cb=()=>ut().getState().workflow.form.layout,_Ce=e=>{const t=document.querySelector(`#${Pj(e)}`);t instanceof HTMLElement&&ZN(t,Qi("base.700"))},ICe=e=>{const t=[];return ns(e)&&e.data.children.length===0&&t.push("center"),e.parentId!==void 0&&(Vi(e.parentId,ns).data.layout==="row"?t.push("left","right"):t.push("top","bottom")),e.parentId===void 0&&t.push("top","bottom"),t},ACe=()=>{wt("useBuilderDndMonitor");const e=z(),t=u.useCallback((n,s)=>{Wl.flushSync(()=>{e(n)}),_Ce(s)},[e]);u.useEffect(()=>qi({canMonitor:({source:n})=>Jh(n.data),onDrop:({location:n,source:s})=>{const i=n.current.dropTargets[0];if(!i)return;const o=i.data;if(!Jh(s.data))return;const a=s.data.element,l=!kCe(a.id);if(jCe(o)){if(l){es.trace("Adding new element to empty root"),a.parentId=void 0,t(vd({element:a,index:void 0,initialValue:jh(a)}),a.id);return}if(!l&&a.parentId!==void 0){es.trace("Reparenting element from container to empty root"),t(yo({id:a.id,newParentId:void 0,index:void 0}),a.id);return}}if(Jh(o)){const c=o.element;if(a.id===c.id)return;const d=L$(o);if(l&&c.parentId===void 0&&d==="center"){es.trace("Adding new element to empty container"),Re(ns(c),"Expected target to be a container"),a.parentId=c.id,t(vd({element:a,initialValue:jh(a)}),a.id);return}if(l&&c.parentId===void 0&&d!=="center"){es.trace("Inserting new element into root");const f=cb().indexOf(c.id),p=Ic({startIndex:f+1,indexOfTarget:f,closestEdgeOfTarget:d,axis:"vertical"});a.parentId=void 0,t(vd({element:a,index:p,initialValue:jh(a)}),a.id);return}if(l&&c.parentId!==void 0&&d==="center"){es.trace("Adding new element to empty container"),Re(ns(c),"Expected target to be a container"),a.parentId=c.id,t(vd({element:a,index:void 0,initialValue:jh(a)}),a.id);return}if(l&&c.parentId!==void 0&&d!=="center"){es.trace("Inserting new element into container");const h=Vi(c.parentId,ns),f=h.data.children.indexOf(c.id),p=Ic({startIndex:f+1,indexOfTarget:f,closestEdgeOfTarget:d,axis:h.data.layout==="row"?"horizontal":"vertical"});a.parentId=h.id,t(vd({element:a,index:p,initialValue:jh(a)}),a.id);return}if(!l&&c.parentId===void 0&&a.parentId===void 0&&d!=="center"){es.trace("Moving element within root");const h=cb(),f=h.indexOf(a.id),p=h.indexOf(c.id),g=x2({list:h,startIndex:f,indexOfTarget:p,closestEdgeOfTarget:d,axis:"vertical"});t(xY({layout:g}),a.id);return}if(!l&&c.parentId!==void 0&&a.parentId!==void 0&&c.parentId===a.parentId&&d==="center"){es.trace("Reparenting element from a container to an empty container with same parent"),Re(ns(c),"Expected target to be a container"),t(yo({id:a.id,newParentId:c.id,index:void 0}),a.id);return}if(!l&&c.parentId!==void 0&&a.parentId!==void 0&&c.parentId===a.parentId&&d!=="center"){es.trace("Moving element within container");const h=Vi(c.parentId,ns),f=h.data.children.indexOf(a.id),p=h.data.children.indexOf(c.id),g=x2({list:h.data.children,startIndex:f,indexOfTarget:p,closestEdgeOfTarget:d,axis:h.data.layout==="row"?"horizontal":"vertical"});t(CY({id:h.id,children:g}),a.id);return}if(!l&&c.parentId!==void 0&&a.parentId!==void 0&&c.parentId!==a.parentId&&d==="center"){es.trace("Reparenting element from one container to an empty container with different parent"),Re(ns(c),"Expected target to be a container"),t(yo({id:a.id,newParentId:c.id,index:void 0}),a.id);return}if(!l&&c.parentId!==void 0&&a.parentId!==void 0&&c.parentId!==a.parentId&&d!=="center"){es.trace("Moving element from one container to another");const h=Vi(c.parentId,ns),f=h.data.children.indexOf(c.id),p=Ic({startIndex:h.data.children.length+1,indexOfTarget:f,closestEdgeOfTarget:d,axis:h.data.layout==="row"?"horizontal":"vertical"});t(yo({id:a.id,newParentId:h.id,index:p}),a.id);return}if(!l&&c.parentId===void 0&&a.parentId!==void 0&&d==="center"){es.trace("Reparenting element from container to empty container"),Re(ns(c),"Expected target to be a container"),t(yo({id:a.id,newParentId:c.id,index:void 0}),a.id);return}if(!l&&c.parentId===void 0&&a.parentId!==void 0&&d!=="center"){es.trace("Reparenting element from container to root");const h=cb(),f=h.indexOf(c.id),p=Ic({startIndex:h.length+1,indexOfTarget:f,closestEdgeOfTarget:d,axis:"vertical"});t(yo({id:a.id,newParentId:void 0,index:p}),a.id);return}if(!l&&c.parentId===void 0&&a.parentId===void 0&&d==="center"){es.trace("Reparenting element from root to empty container"),Re(ns(c),"Expected target to be a container"),t(yo({id:a.id,newParentId:c.id,index:void 0}),a.id);return}if(!l&&c.parentId!==void 0&&a.parentId===void 0&&d==="center"){es.trace("Reparenting element from root to empty container"),Re(ns(c),"Expected target to be a container"),t(yo({id:a.id,newParentId:c.id,index:void 0}),a.id);return}if(!l&&c.parentId!==void 0&&a.parentId===void 0&&d!=="center"){es.trace("Reparenting element from root to container");const h=Vi(c.parentId,ns),f=h.data.children.indexOf(c.id),p=Ic({startIndex:f+1,indexOfTarget:f,closestEdgeOfTarget:d,axis:h.data.layout==="row"?"horizontal":"vertical"});t(yo({id:a.id,newParentId:c.parentId,index:p}),a.id);return}}es.warn(Em({target:i,source:s}),"Unhandled drop event!")}}),[t])},TCe=e=>{const[t,n]=u.useState(!1),s=I(OC);return u.useEffect(()=>{const i=e.current;if(i)return yu({element:i,canDrop:({source:o})=>Jh(o.data)&&s,getData:()=>wCe(),onDrag:({location:o,source:a})=>{var c;const l=(c=o.current.dropTargets.at(0))==null?void 0:c.element;if(!l||l!==i){n(!1);return}if(a.element===i){n(!1);return}n(!0)},onDragLeave:()=>{n(!1)},onDrop:()=>{n(!1)}})},[s,e]),t},MCe=(e,t,n)=>{const[s,i]=u.useState(!1),[o,a]=u.useState(null);return u.useEffect(()=>{const l=t.current,c=n.current;if(!(!l||!c))return Vi(e),Kn(nd(l),Wu({element:l,dragHandle:c,getInitialData:()=>{const d=Vi(e);return dl(d)},onDragStart:()=>{i(!0)},onDrop:()=>{i(!1)}}),yu({element:l,getIsSticky:()=>Vi(e).parentId===void 0,canDrop:({source:d})=>Jh(d.data)&&d.data.element.id!==Vi(e).parentId,getData:({input:d})=>{const h=Vi(e),f=dl(h),p=ICe(h);return CCe(f,{element:l,input:d,allowedCenterOrEdge:p})},onDrag:({self:d,location:h,source:f})=>{var m;const p=(m=h.current.dropTargets.at(0))==null?void 0:m.element;if(!p||p!==l){a(null);return}const g=L$(d.data);if(g==="center"&&f.element===l){a(null);return}a(g)},onDragLeave:()=>{a(null)},onDrop:()=>{a(null)}}))},[n,t,e]),[o,s]},PCe=(e,t,n,s)=>{const[i,o]=u.useState(!1);return u.useEffect(()=>{const a=n.current,l=s.current;if(!(!a||!l))return Kn(nd(a),Wu({element:a,dragHandle:l,getInitialData:()=>{const{nodeId:c,fieldName:d}=e,{type:h}=t,f=SY(c,d,h);return dl(f)},onDragStart:()=>{o(!0)},onDrop:()=>{o(!1)}}))},[s,n,e,t]),i},A0={thickness:2,backgroundColor:"base.500"},ECe={display:"block",position:"absolute",zIndex:1,borderRadius:"full",pointerEvents:"none",background:A0.backgroundColor},LCe={horizontal:{height:`${A0.thickness}px`,left:2,right:2},vertical:{width:`${A0.thickness}px`,top:2,bottom:2}},DCe={top:"horizontal",bottom:"horizontal",left:"vertical",right:"vertical"},RCe={top:{top:"var(--local-line-offset)"},right:{right:"var(--local-line-offset)"},bottom:{bottom:"var(--local-line-offset)"},left:{left:"var(--local-line-offset)"}};function OCe({edge:e,gap:t="0px"}){const n=`calc(-0.5 * (${t} + ${A0.thickness}px))`,s=DCe[e];return r.jsx(ke,{sx:{...ECe,...LCe[s],...RCe[e],"--local-line-offset":n}})}const NCe=({activeDropRegion:e,gap:t})=>!e||e==="center"?null:r.jsx(OCe,{edge:e,gap:t||"var(--invoke-space-2)"}),O$=u.memo(({element:e})=>{const{id:t,data:n}=e,{layout:s}=n,{t:i}=P(),o=z(),a=u.useCallback(()=>{o(Yk({id:t,changes:{layout:"row"}}))},[o,t]),l=u.useCallback(()=>{o(Yk({id:t,changes:{layout:"column"}}))},[o,t]);return r.jsxs(Vn,{children:[r.jsx(Yn,{children:r.jsx(ae,{"aria-label":"settings",icon:r.jsx(WE,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),r.jsxs(Gn,{children:[r.jsx(_i,{}),r.jsx(Xn,{children:r.jsxs(Z,{children:[r.jsx(te,{m:0,children:i("workflows.builder.layout")}),r.jsxs(as,{variant:"outline",size:"sm",children:[r.jsx(ye,{onClick:a,colorScheme:s==="row"?"invokeBlue":"base",children:i("workflows.builder.row")}),r.jsx(ye,{onClick:l,colorScheme:s==="column"?"invokeBlue":"base",children:i("workflows.builder.column")})]})]})})]})]})});O$.displayName="ContainerElementSettings";const N$=u.memo(({id:e,config:t})=>{const{t:n}=P(),s=z(),i=u.useCallback(o=>{const a={...t,component:d3.parse(o.target.value)};s(c1({id:e,changes:{settings:a}}))},[t,s,e]);return r.jsxs(Z,{children:[r.jsx(te,{flex:1,children:n("workflows.builder.component")}),r.jsxs(Kl,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),r.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),r.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});N$.displayName="NodeFieldElementFloatSettings";const F$=u.memo(({id:e,config:t})=>{const{t:n}=P(),s=z(),i=u.useCallback(o=>{const a={...t,component:d3.parse(o.target.value)};s(c1({id:e,changes:{settings:a}}))},[t,s,e]);return r.jsxs(Z,{children:[r.jsx(te,{flex:1,children:n("workflows.builder.component")}),r.jsxs(Kl,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"number-input",children:n("workflows.builder.numberInput")}),r.jsx("option",{value:"slider",children:n("workflows.builder.slider")}),r.jsx("option",{value:"number-input-and-slider",children:n("workflows.builder.both")})]})]})});F$.displayName="NodeFieldElementIntegerConfig";const B$=u.memo(({id:e,config:t})=>{const{t:n}=P(),s=z(),i=u.useCallback(o=>{const a={...t,component:wY.parse(o.target.value)};s(c1({id:e,changes:{settings:a}}))},[t,s,e]);return r.jsxs(Z,{children:[r.jsx(te,{flex:1,children:n("workflows.builder.component")}),r.jsxs(Kl,{value:t.component,onChange:i,size:"sm",children:[r.jsx("option",{value:"input",children:n("workflows.builder.input")}),r.jsx("option",{value:"textarea",children:n("workflows.builder.textarea")})]})]})});B$.displayName="NodeFieldElementStringSettings";const Zo=(e,t)=>{const n=go(e);return u.useMemo(()=>{const i=n.inputs[t];return Re(i,`Template for input field ${t} not found.`),i},[t,n.inputs])},$$=u.memo(({element:e})=>{const{id:t,data:n}=e,{showDescription:s,fieldIdentifier:i}=n,{nodeId:o,fieldName:a}=i,l=Zo(o,a),{t:c}=P(),d=z(),h=u.useCallback(()=>{d(c1({id:t,changes:{showDescription:!s}}))},[d,t,s]),f=u.useMemo(()=>n.settings?n.settings:h3(l)?jY():f3(l)?kY():p3(l)?_Y():null,[n.settings,l]);return r.jsxs(Vn,{placement:"top",children:[r.jsx(Yn,{children:r.jsx(ae,{"aria-label":"settings",icon:r.jsx(WE,{}),variant:"link",size:"sm",alignSelf:"stretch"})}),r.jsxs(Gn,{children:[r.jsx(_i,{}),r.jsxs(Xn,{minW:48,children:[r.jsxs(Z,{children:[r.jsx(te,{flex:1,children:c("workflows.builder.description")}),r.jsx(it,{size:"sm",isChecked:s,onChange:h})]}),(f==null?void 0:f.type)==="integer-field-config"&&r.jsx(F$,{id:t,config:f}),(f==null?void 0:f.type)==="float-field-config"&&r.jsx(N$,{id:t,config:f}),(f==null?void 0:f.type)==="string-field-config"&&r.jsx(B$,{id:t,config:f})]})]})]})});$$.displayName="NodeFieldElementSettings";const FCe=e=>ns(e)?e.data.layout==="column"?"Container (column layout)":"Container (row layout)":Kc(e.type),BCe={w:"full",ps:2,h:8,minH:8,maxH:8,borderTopRadius:"base",borderColor:"base.800",alignItems:"center",cursor:"grab",color:"base.300",borderBottomWidth:1,bg:"base.700",'&[data-depth="0"]':{bg:"base.800"},'&[data-depth="1"]':{bg:"base.750"},'&[data-depth="2"]':{bg:"base.700"}},V$=u.memo(NC(({element:e},t)=>{const{t:n}=P(),s=Mj(),i=z(),o=u.useCallback(()=>{i(IY({id:e.id}))},[i,e.id]);return r.jsxs(T,{ref:t,sx:BCe,"data-depth":s,children:[r.jsx(K,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",children:FCe(e)}),r.jsx(nt,{}),ns(e)&&r.jsx(O$,{element:e}),l1(e)&&r.jsx($$,{element:e}),r.jsx(ae,{tooltip:n("common.delete"),"aria-label":n("common.delete"),onClick:o,icon:r.jsx(Nt,{}),variant:"link",size:"sm",alignSelf:"stretch",colorScheme:"error"})]})}));V$.displayName="FormElementEditModeHeader";const $Ce={position:"relative",flex:"1 1 0",'&[data-element-type="divider"]&[data-layout="row"]':{flex:"0 1 0"},borderRadius:"base"},VCe={position:"relative",flexDir:"column",alignItems:"center",justifyContent:"flex-start",borderRadius:"base",w:"full",h:"full",'&[data-is-dragging="true"]':{opacity:.3},'&[data-active-drop-region="center"]':{opacity:1,bg:"base.700"},'&[data-element-type="divider"]&[data-layout="row"]':{w:"min-content"},'&[data-element-type="divider"]&[data-layout="column"]':{h:"min-content"}},dd=u.memo(({element:e,children:t})=>{const n=u.useRef(null),s=u.useRef(null),[i,o]=MCe(e.id,n,s),a=Aj();return r.jsxs(T,{id:Pj(e.id),ref:n,className:SCe,sx:$Ce,"data-element-type":e.type,"data-layout":a==null?void 0:a.layout,children:[r.jsxs(T,{sx:VCe,"data-is-dragging":o,"data-active-drop-region":i,"data-element-type":e.type,"data-layout":a==null?void 0:a.layout,children:[r.jsx(V$,{ref:s,element:e}),r.jsx(T,{w:"full",h:"full",p:4,gap:4,borderWidth:1,borderColor:"base.800",borderRadius:"base",borderTopRadius:"unset",borderTop:"unset",children:t})]}),r.jsx(NCe,{activeDropRegion:i,gap:"var(--invoke-space-4)"})]})});dd.displayName="FormElementEditModeWrapper";const G$={bg:"base.700",flexShrink:0,'&[data-layout="column"]':{width:"100%",height:"1px"},'&[data-layout="row"]':{height:"100%",width:"1px",minH:32}},z$=u.memo(({id:e})=>{const t=Ou(e),n=I(uo);if(!(!t||!g3(t)))return n==="view"?r.jsx(H$,{el:t}):r.jsx(W$,{el:t})});z$.displayName="DividerElementComponent";const H$=u.memo(({el:e})=>{const t=Aj(),{id:n}=e;return r.jsx(T,{id:n,className:m3,sx:G$,"data-layout":(t==null?void 0:t.layout)||"column"})});H$.displayName="DividerElementComponentViewMode";const W$=u.memo(({el:e})=>{const t=Aj(),{id:n}=e;return r.jsx(dd,{element:e,children:r.jsx(T,{id:n,className:m3,sx:G$,"data-layout":(t==null?void 0:t.layout)||"column"})})});W$.displayName="DividerElementComponentEditMode";function Ss(){return Ss=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ss.apply(null,arguments)}function GCe(e,t){if(e==null)return{};var n={};for(var s in e)if({}.hasOwnProperty.call(e,s)){if(t.includes(s))continue;n[s]=e[s]}return n}var zCe=u.useLayoutEffect,HCe=function(t){var n=me.useRef(t);return zCe(function(){n.current=t}),n},k8=function(t,n){if(typeof t=="function"){t(n);return}t.current=n},WCe=function(t,n){var s=me.useRef();return me.useCallback(function(i){t.current=i,s.current&&k8(s.current,null),s.current=n,n&&k8(n,i)},[n])},_8={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0",display:"block"},UCe=function(t){Object.keys(_8).forEach(function(n){t.style.setProperty(n,_8[n],"important")})},I8=UCe,ks=null,A8=function(t,n){var s=t.scrollHeight;return n.sizingStyle.boxSizing==="border-box"?s+n.borderSize:s-n.paddingSize};function qCe(e,t,n,s){n===void 0&&(n=1),s===void 0&&(s=1/0),ks||(ks=document.createElement("textarea"),ks.setAttribute("tabindex","-1"),ks.setAttribute("aria-hidden","true"),I8(ks)),ks.parentNode===null&&document.body.appendChild(ks);var i=e.paddingSize,o=e.borderSize,a=e.sizingStyle,l=a.boxSizing;Object.keys(a).forEach(function(p){var g=p;ks.style[g]=a[g]}),I8(ks),ks.value=t;var c=A8(ks,e);ks.value=t,c=A8(ks,e),ks.value="x";var d=ks.scrollHeight-i,h=d*n;l==="border-box"&&(h=h+i+o),c=Math.max(h,c);var f=d*s;return l==="border-box"&&(f=f+i+o),c=Math.min(f,c),[c,d]}var T8=function(){},KCe=function(t,n){return t.reduce(function(s,i){return s[i]=n[i],s},{})},ZCe=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width","wordBreak","wordSpacing","scrollbarGutter"],YCe=!!document.documentElement.currentStyle,XCe=function(t){var n=window.getComputedStyle(t);if(n===null)return null;var s=KCe(ZCe,n),i=s.boxSizing;if(i==="")return null;YCe&&i==="border-box"&&(s.width=parseFloat(s.width)+parseFloat(s.borderRightWidth)+parseFloat(s.borderLeftWidth)+parseFloat(s.paddingRight)+parseFloat(s.paddingLeft)+"px");var o=parseFloat(s.paddingBottom)+parseFloat(s.paddingTop),a=parseFloat(s.borderBottomWidth)+parseFloat(s.borderTopWidth);return{sizingStyle:s,paddingSize:o,borderSize:a}},QCe=XCe;function Ej(e,t,n){var s=HCe(n);u.useLayoutEffect(function(){var i=function(a){return s.current(a)};if(e)return e.addEventListener(t,i),function(){return e.removeEventListener(t,i)}},[])}var JCe=function(t,n){Ej(document.body,"reset",function(s){t.current.form===s.target&&n(s)})},eSe=function(t){Ej(window,"resize",t)},tSe=function(t){Ej(document.fonts,"loadingdone",t)},nSe=["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"],sSe=function(t,n){var s=t.cacheMeasurements,i=t.maxRows,o=t.minRows,a=t.onChange,l=a===void 0?T8:a,c=t.onHeightChange,d=c===void 0?T8:c,h=GCe(t,nSe),f=h.value!==void 0,p=u.useRef(null),g=WCe(p,n),m=u.useRef(0),y=u.useRef(),x=function(){var b=p.current,S=s&&y.current?y.current:QCe(b);if(S){y.current=S;var w=qCe(S,b.value||b.placeholder||"x",o,i),j=w[0],E=w[1];m.current!==j&&(m.current=j,b.style.setProperty("height",j+"px","important"),d(j,{rowHeight:E}))}},C=function(b){f||x(),l(b)};return u.useLayoutEffect(x),JCe(p,function(){if(!f){var v=p.current,b=v.value;requestAnimationFrame(function(){b!==v.value&&x()})}}),eSe(x),tSe(x),u.createElement("textarea",Ss({},h,{onChange:C,ref:g}))},rSe=u.forwardRef(sSe);const iSe=$o(rSe),Lj=rp(NC(({variant:e,...t},n)=>{const s=AY("Textarea",{variant:e});return r.jsx(iSe,{__css:s,ref:n,...t})}));Lj.displayName="AutosizeTextarea";const U$=u.memo(({id:e})=>{const t=Ou(e),n=I(uo);return!t||!y3(t)?null:n==="view"?r.jsx(q$,{el:t}):r.jsx(K$,{el:t})});U$.displayName="HeadingElementComponent";const q$=u.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n;return r.jsx(T,{id:t,className:v3,children:r.jsx(Dj,{content:s})})});q$.displayName="HeadingElementComponentViewMode";const K$=u.memo(({el:e})=>{const{id:t}=e;return r.jsx(dd,{element:e,children:r.jsx(T,{id:t,className:v3,w:"full",children:r.jsx(Z$,{el:e})})})}),oSe={fontWeight:"bold",fontSize:"4xl",'&[data-is-empty="true"]':{opacity:.3}},Dj=u.memo(({content:e,...t})=>{const{t:n}=P();return r.jsx(K,{sx:oSe,"data-is-empty":e==="",...t,children:e||n("workflows.builder.headingPlaceholder")})});Dj.displayName="HeadingContentDisplay";K$.displayName="HeadingElementComponentEditMode";const Z$=u.memo(({el:e})=>{const{t}=P(),n=z(),{id:s,data:i}=e,{content:o}=i,a=u.useRef(null),l=u.useCallback(d=>{n(TY({id:s,changes:{content:d}}))},[n,s]),c=Ko({value:o,defaultValue:"",onChange:l,inputRef:a});return c.isEditing?r.jsx(Lj,{ref:a,placeholder:t("workflows.builder.headingPlaceholder"),...c.inputProps,variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:2,fontWeight:"bold",fontSize:"4xl"}):r.jsx(Dj,{content:c.value,onDoubleClick:c.startEditing})});Z$.displayName="EditableHeading";const aSe={position:"relative",minH:8,py:.5,alignItems:"center",transitionProperty:"opacity",transitionDuration:"0.1s",w:"full",h:"full"},T0=u.memo(({children:e})=>r.jsx(T,{sx:aSe,children:e}));T0.displayName="InputFieldWrapper";const lSe=(e,t)=>{const n=ce(xn),s=u.useMemo(()=>ve(ot,o=>{const a=u1(o,e);if(!a)return t;const l=a.data.inputs[t],c=n[a.data.type],d=c==null?void 0:c.inputs[t];return(l==null?void 0:l.label)||(d==null?void 0:d.title)||t}),[t,e,n]);return I(s)},Y$=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=P(),s=lSe(e,t);return r.jsx(T0,{children:r.jsx(Z,{isInvalid:!0,alignItems:"stretch",justifyContent:"center",gap:2,h:"full",w:"full",children:r.jsx(te,{display:"flex",mb:0,px:1,py:2,gap:2,children:n("nodes.unknownInput",{name:s})})})})});Y$.displayName="InputFieldUnknownPlaceholder";const cSe=(e,t)=>{const n=u.useMemo(()=>ve(ot,i=>{const o=u1(i,e);return o?!!o.data.inputs[t]:!1}),[t,e]);return I(n)},uSe=(e,t)=>{const n=ce(xn),s=u.useMemo(()=>ve(ot,o=>{const a=u1(o,e);if(!a)return!1;const l=n[a.data.type];return!!(l==null?void 0:l.inputs[t])}),[t,e,n]);return I(s)},ou=u.memo(({nodeId:e,fieldName:t,children:n})=>{const s=cSe(e,t);return!uSe(e,t)||!s?r.jsx(Y$,{nodeId:e,fieldName:t}):n});ou.displayName="InputFieldGate";const Rj=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=z(),o=u.useCallback(h=>{i(MY({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),a=u.useMemo(()=>{let h=-4294967295;return ze(s.minimum)||(h=s.minimum),ze(s.exclusiveMinimum)||(h=s.exclusiveMinimum+.01),h},[s.exclusiveMinimum,s.minimum]),l=u.useMemo(()=>{let h=Nu;return ze(s.maximum)||(h=s.maximum),ze(s.exclusiveMaximum)||(h=s.exclusiveMaximum-.01),h},[s.exclusiveMaximum,s.maximum]),c=u.useMemo(()=>ze(s.multipleOf)?.1:s.multipleOf,[s.multipleOf]),d=u.useMemo(()=>ze(s.multipleOf)?.01:s.multipleOf,[s.multipleOf]);return{defaultValue:s.default,onChange:o,value:n.value,min:a,max:l,step:c,fineStep:d}},j2=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=Rj(e);return r.jsx(Ae,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:"nodrag",flex:"1 1 0"})});j2.displayName="FloatFieldInput ";const X$=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=Rj(e);return r.jsxs(r.Fragment,{children:[r.jsx(qe,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:"nodrag",marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),r.jsx(Ae,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:"nodrag",flex:"1 1 0"})]})});X$.displayName="FloatFieldInputAndSlider ";const Q$=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=Rj(e);return r.jsx(qe,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:"nodrag",marks:!0,withThumbTooltip:!0,flex:"1 1 0"})});Q$.displayName="FloatFieldSlider ";const J$=(e,t)=>{const n=u.useMemo(()=>ve(ot,i=>i.edges.find(a=>a.target===e&&a.targetHandle===t)!==void 0),[t,e]);return I(n)},Hp=(e,t)=>{const n=Zo(e,t),s=J$(e,t),i=u.useMemo(()=>ve(ot,a=>{const l=Y0(a,e,t);return l?n.input==="connection"?n.required&&!s:n.input==="any"&&s?!1:l.value===void 0?n.required:!!(wC(l)&&b3(n)&&PY(l.value,n).length>0||x3(l)&&C3(n)&&EY(l.value,n).length>0||S3(l)&&w3(n)&&Xk(l.value,n).length>0||j3(l)&&k3(n)&&Xk(l.value,n).length>0):!0}),[e,t,n,s]);return I(i)},dSe=zo().options,hSe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},eV=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=sr(),{t:o}=P(),a=Hp(t,n.name),l=u.useCallback(y=>{i.dispatch(LY({nodeId:t,fieldName:n.name,value:y}))},[n.name,t,i]),c=u.useCallback(y=>{const x=n.value?[...n.value]:[];x.splice(y,1),l(x)},[n.value,l]),d=u.useCallback((y,x)=>{const C=n.value?[...n.value]:[];C[y]=x,l(C)},[n.value,l]),h=u.useCallback(()=>{const y=n.value?[...n.value,0]:[0];l(y)},[n.value,l]),f=u.useMemo(()=>{let y=-4294967295;return ze(s.minimum)||(y=s.minimum),ze(s.exclusiveMinimum)||(y=s.exclusiveMinimum+.01),y},[s.exclusiveMinimum,s.minimum]),p=u.useMemo(()=>{let y=Nu;return ze(s.maximum)||(y=s.maximum),ze(s.exclusiveMaximum)||(y=s.exclusiveMaximum-.01),y},[s.exclusiveMaximum,s.maximum]),g=u.useMemo(()=>ze(s.multipleOf)?.1:s.multipleOf,[s.multipleOf]),m=u.useMemo(()=>ze(s.multipleOf)?.01:s.multipleOf,[s.multipleOf]);return r.jsxs(T,{className:"nodrag",position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:hSe,"data-error":a,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(ye,{onClick:h,variant:"ghost",children:o("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Et,{}),r.jsx(tr,{className:"nowheel",defer:!0,style:Yl,options:dSe,children:r.jsx(Kr,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((y,x)=>r.jsx(tV,{value:y,index:x,min:f,max:p,step:g,fineStep:m,onRemoveNumber:c,onChangeNumber:d},x))})})]})]})});eV.displayName="FloatFieldCollectionInputComponent";const tV=u.memo(({value:e,index:t,min:n,max:s,step:i,fineStep:o,onRemoveNumber:a,onChangeNumber:l})=>{const{t:c}=P(),d=u.useCallback(()=>{a(t)},[t,a]),h=u.useCallback(f=>{l(t,f)},[t,l]);return r.jsxs(r.Fragment,{children:[r.jsx(Rt,{children:r.jsxs(te,{ps:1,m:0,children:[t+1,"."]})}),r.jsx(Rt,{children:r.jsx(Ae,{onChange:h,value:e,min:n,max:s,step:i,fineStep:o,className:"nodrag",flexGrow:1})}),r.jsx(Rt,{children:r.jsx(ae,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:d,icon:r.jsx(Nt,{}),"aria-label":c("common.delete")})})]})});tV.displayName="FloatListItemContent";const nV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,step:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.start")}),r.jsx(Ae,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.step")}),r.jsx(Ae,{value:e.step,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]})]})});nV.displayName="FloatGeneratorArithmeticSequenceSettings";const sV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,end:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.start")}),r.jsx(Ae,{value:e.start,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.end")}),r.jsx(Ae,{value:e.end,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]})]})});sV.displayName="FloatGeneratorLinearDistributionSettings";const fSe=1024*128,hd=u.memo(({value:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(l=>{const c=l[0];if(!c)return;const d=new FileReader;d.onload=()=>{const h=d.result;Cl(h)&&t(h)},d.onerror=()=>{fe({title:"Failed to load file",status:"error"})},d.readAsText(c)},[t]),{getInputProps:i,getRootProps:o}=Ra({accept:{"text/csv":[".csv"],"text/plain":[".txt"]},maxSize:fSe,onDropAccepted:s,noDrag:!0,multiple:!1}),a=u.useCallback(l=>{t(l.target.value)},[t]);return r.jsxs(Z,{orientation:"vertical",position:"relative",alignItems:"stretch",children:[r.jsxs(te,{m:0,display:"flex",alignItems:"center",children:[n("common.input"),r.jsx(nt,{}),r.jsx(ae,{tooltip:n("nodes.generatorLoadFromFile"),"aria-label":n("nodes.generatorLoadFromFile"),icon:r.jsx(eae,{}),variant:"link",...o()}),r.jsx("input",{...i()})]}),r.jsx(Zn,{className:"nowheel nodrag nopan",value:e,onChange:a,p:2,resize:"none",rows:5,fontSize:"sm"})]})});hd.displayName="GeneratorTextareaWithFileUpload";const rV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("nodes.splitOn")}),r.jsx(Ct,{value:e.splitOn,onChange:s})]}),r.jsx(hd,{value:e.input,onChange:i})]})});rV.displayName="FloatGeneratorParseStringSettings";const iV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(c=>{t({...e,min:c})},[t,e]),i=u.useCallback(c=>{t({...e,max:c})},[t,e]),o=u.useCallback(c=>{t({...e,count:c})},[t,e]),a=u.useCallback(()=>{t({...e,seed:ze(e.seed)?0:null})},[t,e]),l=u.useCallback(c=>{t({...e,seed:c})},[t,e]);return r.jsx(T,{gap:2,flexDir:"column",children:r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.min")}),r.jsx(Ae,{value:e.min,onChange:s,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.max")}),r.jsx(Ae,{value:e.max,onChange:i,min:-1/0,max:1/0,step:.01})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsxs(te,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),r.jsx(jn,{onChange:a,isChecked:!ze(e.seed)})]}),r.jsx(Ae,{isDisabled:ze(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0})]})]})})});iV.displayName="FloatGeneratorUniformRandomDistributionSettings";const pSe=zo().options,oV=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=z(),o=u.useCallback(d=>{i(Qk({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),a=u.useCallback(d=>{const h=DY(d.target.value);h&&i(Qk({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),[l]=Zl(n,300),c=u.useMemo(()=>{if(l.value.type===Gy&&ze(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const d=RY(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.map(h=>sp(h,2)).join(", ")},[l,s]);return r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsxs(Kl,{className:"nowheel nodrag",onChange:a,value:n.value.type,size:"sm",children:[r.jsx("option",{value:Jk,children:s("nodes.arithmeticSequence")}),r.jsx("option",{value:e_,children:s("nodes.linearDistribution")}),r.jsx("option",{value:Gy,children:s("nodes.uniformRandomDistribution")}),r.jsx("option",{value:t_,children:s("nodes.parseString")})]}),n.value.type===Jk&&r.jsx(nV,{state:n.value,onChange:o}),n.value.type===e_&&r.jsx(sV,{state:n.value,onChange:o}),n.value.type===Gy&&r.jsx(iV,{state:n.value,onChange:o}),n.value.type===t_&&r.jsx(rV,{state:n.value,onChange:o}),r.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(T,{w:"full",h:"auto",children:r.jsx(tr,{className:"nodrag nowheel",defer:!0,style:Yl,options:pSe,children:r.jsx(K,{className:"nodrag nowheel",fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});oV.displayName="FloatGeneratorFieldInputComponent";const gSe=zo().options,mSe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},aV=u.memo(e=>{const{t}=P(),{nodeId:n,field:s}=e,i=sr(),o=Hp(n,s.name),a=u.useMemo(()=>i2.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}}),[s,n]),l=u.useCallback(d=>{i.dispatch(Ub({nodeId:n,fieldName:s.name,value:d}))},[i,n,s.name]),c=u.useCallback(d=>{const h=s.value?[...s.value]:[];h.splice(d,1),i.dispatch(Ub({nodeId:n,fieldName:s.name,value:h}))},[s.name,s.value,n,i]);return r.jsxs(T,{className:"nodrag",position:"relative",w:"full",h:"full",minH:16,maxH:64,alignItems:"stretch",justifyContent:"center",children:[(!s.value||s.value.length===0)&&r.jsx(cxe,{w:"full",h:"auto",isError:o,onUpload:l,fontSize:24,variant:"ghost"}),s.value&&s.value.length>0&&r.jsx(ke,{w:"full",h:"auto",p:1,sx:mSe,"data-error":o,borderRadius:"base",children:r.jsx(tr,{className:"nowheel",defer:!0,style:Yl,options:gSe,children:r.jsx(Kr,{w:"full",h:"full",templateColumns:"repeat(4, 1fr)",gap:1,children:s.value.map((d,h)=>r.jsx(Rt,{position:"relative",className:"nodrag",children:r.jsx(lV,{value:d,index:h,onRemoveImage:c})},h))})})}),r.jsx(vs,{dndTarget:i2,dndTargetData:a,label:t("gallery.drop")})]})});aV.displayName="ImageFieldCollectionInputComponent";const lV=u.memo(({value:e,index:t,onRemoveImage:n})=>{const s=Pa(e.image_name),i=u.useCallback(()=>{n(t)},[t,n]);return s.isLoading?r.jsx(R1,{}):s.data?r.jsxs(r.Fragment,{children:[r.jsx($a,{imageDTO:s.data,asThumbnail:!0,objectFit:"contain",w:"full",h:"full",aspectRatio:"1/1",backgroundSize:8,backgroundImage:td}),r.jsx(io,{onClick:i,icon:r.jsx(Nt,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]}):r.jsxs(r.Fragment,{children:[r.jsx(Yt,{icon:kE}),r.jsx(io,{onClick:i,icon:r.jsx(Nt,{}),tooltip:"Remove Image from Collection",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]})});lV.displayName="ImageGridItemContent";const ySe=zo().options,vSe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},cV=u.memo(e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=sr(),{t:o}=P(),a=Hp(t,n.name),l=u.useCallback(y=>{i.dispatch(OY({nodeId:t,fieldName:n.name,value:y}))},[n.name,t,i]),c=u.useCallback(y=>{const x=n.value?[...n.value]:[];x.splice(y,1),l(x)},[n.value,l]),d=u.useCallback((y,x)=>{const C=n.value?[...n.value]:[];C[y]=x,l(C)},[n.value,l]),h=u.useCallback(()=>{const y=n.value?[...n.value,0]:[0];l(y)},[n.value,l]),f=u.useMemo(()=>{let y=-4294967295;return ze(s.minimum)||(y=s.minimum),ze(s.exclusiveMinimum)||(y=s.exclusiveMinimum+.01),y},[s.exclusiveMinimum,s.minimum]),p=u.useMemo(()=>{let y=Nu;return ze(s.maximum)||(y=s.maximum),ze(s.exclusiveMaximum)||(y=s.exclusiveMaximum-.01),y},[s.exclusiveMaximum,s.maximum]),g=u.useMemo(()=>ze(s.multipleOf)?1:s.multipleOf,[s.multipleOf]),m=u.useMemo(()=>ze(s.multipleOf)?1:s.multipleOf,[s.multipleOf]);return r.jsxs(T,{className:"nodrag",position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:vSe,"data-error":a,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(ye,{onClick:h,variant:"ghost",children:o("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Et,{}),r.jsx(tr,{className:"nowheel",defer:!0,style:Yl,options:ySe,children:r.jsx(Kr,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((y,x)=>r.jsx(uV,{value:y,index:x,min:f,max:p,step:g,fineStep:m,onRemoveNumber:c,onChangeNumber:d},x))})})]})]})});cV.displayName="IntegerFieldCollectionInputComponent";const uV=u.memo(({value:e,index:t,min:n,max:s,step:i,fineStep:o,onRemoveNumber:a,onChangeNumber:l})=>{const{t:c}=P(),d=u.useCallback(()=>{a(t)},[t,a]),h=u.useCallback(f=>{l(t,Math.floor(f))},[t,l]);return r.jsxs(r.Fragment,{children:[r.jsx(Rt,{children:r.jsxs(te,{ps:1,m:0,children:[t+1,"."]})}),r.jsx(Rt,{children:r.jsx(Ae,{onChange:h,value:e,min:n,max:s,step:i,fineStep:o,className:"nodrag",flexGrow:1})}),r.jsx(Rt,{children:r.jsx(ae,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:d,icon:r.jsx(Nt,{}),"aria-label":c("common.delete")})})]})});uV.displayName="IntegerListItemContent";const dV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,step:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.start")}),r.jsx(Ae,{value:e.start,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.step")}),r.jsx(Ae,{value:e.step,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]})]})});dV.displayName="IntegerGeneratorArithmeticSequenceSettings";const hV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(a=>{t({...e,start:a})},[t,e]),i=u.useCallback(a=>{t({...e,end:a})},[t,e]),o=u.useCallback(a=>{t({...e,count:a})},[t,e]);return r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.start")}),r.jsx(Ae,{value:e.start,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.end")}),r.jsx(Ae,{value:e.end,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]})]})});hV.displayName="IntegerGeneratorLinearDistributionSettings";const fV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("nodes.splitOn")}),r.jsx(Ct,{value:e.splitOn,onChange:s})]}),r.jsx(hd,{value:e.input,onChange:i})]})});fV.displayName="IntegerGeneratorParseStringSettings";const pV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(c=>{t({...e,min:c})},[t,e]),i=u.useCallback(c=>{t({...e,max:c})},[t,e]),o=u.useCallback(c=>{t({...e,count:c})},[t,e]),a=u.useCallback(()=>{t({...e,seed:ze(e.seed)?0:null})},[t,e]),l=u.useCallback(c=>{t({...e,seed:c})},[t,e]);return r.jsx(T,{gap:2,flexDir:"column",children:r.jsxs(T,{gap:2,alignItems:"flex-end",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.min")}),r.jsx(Ae,{value:e.min,onChange:s,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.max")}),r.jsx(Ae,{value:e.max,onChange:i,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:o,min:1,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsxs(te,{alignItems:"center",justifyContent:"space-between",m:0,display:"flex",w:"full",children:[n("common.seed"),r.jsx(jn,{onChange:a,isChecked:!ze(e.seed)})]}),r.jsx(Ae,{isDisabled:ze(e.seed),value:e.seed??"...",onChange:l,min:-1/0,max:1/0})]})]})})});pV.displayName="IntegerGeneratorUniformRandomDistributionSettings";const bSe=zo().options,gV=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=z(),o=u.useCallback(d=>{i(n_({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),a=u.useCallback(d=>{const h=NY(d.target.value);i(n_({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),[l]=Zl(n,300),c=u.useMemo(()=>{if(l.value.type===zy&&ze(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const d=FY(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.map(h=>sp(h,2)).join(", ")},[l,s]);return r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsxs(Kl,{className:"nowheel nodrag",onChange:a,value:n.value.type,size:"sm",children:[r.jsx("option",{value:s_,children:s("nodes.arithmeticSequence")}),r.jsx("option",{value:r_,children:s("nodes.linearDistribution")}),r.jsx("option",{value:zy,children:s("nodes.uniformRandomDistribution")}),r.jsx("option",{value:i_,children:s("nodes.parseString")})]}),n.value.type===s_&&r.jsx(dV,{state:n.value,onChange:o}),n.value.type===r_&&r.jsx(hV,{state:n.value,onChange:o}),n.value.type===zy&&r.jsx(pV,{state:n.value,onChange:o}),n.value.type===i_&&r.jsx(fV,{state:n.value,onChange:o}),r.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(T,{w:"full",h:"auto",children:r.jsx(tr,{className:"nodrag nowheel",defer:!0,style:Yl,options:bSe,children:r.jsx(K,{className:"nodrag nowheel",fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});gV.displayName="IntegerGeneratorFieldInputComponent";const xSe=e=>{const{nodeId:t,field:n}=e,s=z(),{data:i,isLoading:o}=Zf(),a=u.useCallback(g=>{g&&s(BY({nodeId:t,fieldName:n.name,value:g}))},[s,n.name,t]),l=u.useMemo(()=>i?Ia.selectAll(i):er,[i]),{options:c,value:d,onChange:h,placeholder:f,noOptionsMessage:p}=hn({modelConfigs:l,onChange:a,isLoading:o,selectedModel:n.value,groupByType:!0});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!c.length,isInvalid:!d,children:r.jsx(Fe,{value:d,placeholder:f,options:c,onChange:h,noOptionsMessage:p})})})},CSe=u.memo(xSe),SSe=zo().options,wSe={borderWidth:1,"&[data-error=true]":{borderColor:"error.500",borderStyle:"solid"}},mV=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=sr(),o=Hp(t,n.name),a=u.useCallback(d=>{const h=n.value?[...n.value]:[];h.splice(d,1),i.dispatch(Hy({nodeId:t,fieldName:n.name,value:h}))},[n.name,n.value,t,i]),l=u.useCallback((d,h)=>{const f=n.value?[...n.value]:[];f[d]=h,i.dispatch(Hy({nodeId:t,fieldName:n.name,value:f}))},[n.name,n.value,t,i]),c=u.useCallback(()=>{const d=n.value?[...n.value,""]:[""];i.dispatch(Hy({nodeId:t,fieldName:n.name,value:d}))},[n.name,n.value,t,i]);return r.jsxs(T,{className:"nodrag",position:"relative",w:"full",h:"auto",maxH:64,alignItems:"stretch",justifyContent:"center",p:1,sx:wSe,"data-error":o,borderRadius:"base",flexDir:"column",gap:1,children:[r.jsx(ye,{onClick:c,variant:"ghost",children:s("nodes.addItem")}),n.value&&n.value.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Et,{}),r.jsx(tr,{className:"nowheel",defer:!0,style:Yl,options:SSe,children:r.jsx(Kr,{gap:1,gridTemplateColumns:"auto 1fr auto",alignItems:"center",children:n.value.map((d,h)=>r.jsx(yV,{value:d,index:h,onRemoveString:a,onChangeString:l},h))})})]})]})});mV.displayName="StringFieldCollectionInputComponent";const jSe=u.memo(({value:e,index:t,onRemoveString:n,onChangeString:s})=>{const{t:i}=P(),o=u.useCallback(()=>{n(t)},[t,n]),a=u.useCallback(l=>{s(t,l.target.value)},[t,s]);return r.jsxs(T,{alignItems:"center",gap:1,children:[r.jsx(Ct,{size:"xs",resize:"none",value:e,onChange:a}),r.jsx(ae,{size:"sm",variant:"link",alignSelf:"stretch",onClick:o,icon:r.jsx(Nt,{}),"aria-label":i("common.remove"),tooltip:i("common.remove")})]})});jSe.displayName="StringListItemContent";const yV=u.memo(({value:e,index:t,onRemoveString:n,onChangeString:s})=>{const{t:i}=P(),o=u.useCallback(()=>{n(t)},[t,n]),a=u.useCallback(l=>{s(t,l.target.value)},[t,s]);return r.jsxs(r.Fragment,{children:[r.jsx(Rt,{children:r.jsxs(te,{ps:1,m:0,children:[t+1,"."]})}),r.jsx(Rt,{children:r.jsx(Ct,{size:"sm",resize:"none",value:e,onChange:a})}),r.jsx(Rt,{children:r.jsx(ae,{tabIndex:-1,size:"sm",variant:"link",alignSelf:"stretch",onClick:o,icon:r.jsx(Nt,{}),"aria-label":i("common.delete")})})]})});yV.displayName="ListItemContent";const vV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useMemo(()=>[`<${n("nodes.generatorLoading")}>`],[n]),i=u.useCallback(h=>{t({...e,input:h,values:s})},[t,e,s]),o=u.useCallback(h=>{t({...e,maxPrompts:h,values:s})},[t,e,s]),a=u.useMemo(()=>({prompt:e.input,max_prompts:e.maxPrompts,combinatorial:!0}),[e]),[l]=Zl(a,300),{data:c,isLoading:d}=_3(l);return u.useEffect(()=>{if(!d){if(!c){t({...e,values:[]});return}t({...e,values:c.prompts})}},[c,d,t,e]),r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("dynamicPrompts.maxPrompts")}),r.jsx(Ae,{value:e.maxPrompts,onChange:o,min:1,max:1e3,w:"full"})]}),r.jsx(hd,{value:e.input,onChange:i})]})});vV.displayName="StringGeneratorDynamicPromptsCombinatorialSettings";const bV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=nCe(),i=u.useMemo(()=>[`<${n("nodes.generatorLoading")}>`],[n]),o=u.useCallback(g=>{t({...e,input:g,values:i})},[t,e,i]),a=u.useCallback(g=>{t({...e,count:g,values:i})},[t,e,i]),l=u.useCallback(()=>{t({...e,seed:ze(e.seed)?0:null,values:i})},[t,e,i]),c=u.useCallback(g=>{t({...e,seed:g,values:i})},[t,e,i]),d=u.useMemo(()=>({prompt:e.input,max_prompts:e.count,combinatorial:!1,seed:e.seed??$Y()}),[e.count,e.input,e.seed]),[h]=Zl(d,300),{data:f,isLoading:p}=_3(h);return u.useEffect(()=>{if(!p){if(!f){t({...e,values:[]});return}t({...e,values:f.prompts})}},[f,p,t,e,s]),r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(T,{gap:2,children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsxs(te,{alignItems:"center",justifyContent:"space-between",display:"flex",w:"full",pe:.5,children:[n("common.seed"),r.jsx(jn,{onChange:l,isChecked:!ze(e.seed)})]}),r.jsx(Ae,{isDisabled:ze(e.seed),value:e.seed??"...",onChange:c,min:-1/0,max:1/0})]}),r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("common.count")}),r.jsx(Ae,{value:e.count,onChange:a,min:1,max:1e3})]})]}),r.jsx(hd,{value:e.input,onChange:o})]})});bV.displayName="StringGeneratorDynamicPromptsRandomSettings";const xV=u.memo(({state:e,onChange:t})=>{const{t:n}=P(),s=u.useCallback(o=>{t({...e,splitOn:o.target.value})},[t,e]),i=u.useCallback(o=>{t({...e,input:o})},[t,e]);return r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:n("nodes.splitOn")}),r.jsx(Ct,{value:e.splitOn,onChange:s})]}),r.jsx(hd,{value:e.input,onChange:i})]})});xV.displayName="StringGeneratorParseStringSettings";const kSe=zo().options,CV=u.memo(e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=z(),o=u.useCallback(d=>{i(o_({nodeId:t,fieldName:n.name,value:d}))},[i,n.name,t]),a=u.useCallback(d=>{const h=VY(d.target.value);i(o_({nodeId:t,fieldName:n.name,value:h}))},[i,n.name,t]),[l]=Zl(n,300),c=u.useMemo(()=>{if(l.value.type===a_&&ze(l.value.seed)){const{count:h}=l.value;return`<${s("nodes.generatorNRandomValues",{count:h})}>`}const d=GY(l);return d.length===0?`<${s("nodes.generatorNoValues")}>`:d.join(", ")},[l,s]);return r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(Kl,{className:"nowheel nodrag",onChange:a,value:n.value.type,size:"sm",children:r.jsx("option",{value:l_,children:s("nodes.parseString")})}),n.value.type===l_&&r.jsx(xV,{state:n.value,onChange:o}),n.value.type===a_&&r.jsx(bV,{state:n.value,onChange:o}),n.value.type===zY&&r.jsx(vV,{state:n.value,onChange:o}),r.jsx(T,{w:"full",h:"full",p:2,borderWidth:1,borderRadius:"base",maxH:128,children:r.jsx(T,{w:"full",h:"auto",children:r.jsx(tr,{className:"nodrag nowheel",defer:!0,style:Yl,options:kSe,children:r.jsx(K,{className:"nodrag nowheel",fontFamily:"monospace",userSelect:"text",cursor:"text",children:c})})})})]})});CV.displayName="StringGeneratorFieldInputComponent";const Oj=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=z(),o=u.useCallback(h=>{i(HY({nodeId:t,fieldName:n.name,value:Math.floor(Number(h))}))},[i,n.name,t]),a=u.useMemo(()=>{let h=-4294967295;return ze(s.minimum)||(h=s.minimum),ze(s.exclusiveMinimum)||(h=s.exclusiveMinimum+1),h},[s.exclusiveMinimum,s.minimum]),l=u.useMemo(()=>{let h=Nu;return ze(s.maximum)||(h=s.maximum),ze(s.exclusiveMaximum)||(h=s.exclusiveMaximum-1),h},[s.exclusiveMaximum,s.maximum]),c=u.useMemo(()=>ze(s.multipleOf)?1:s.multipleOf,[s.multipleOf]),d=u.useMemo(()=>ze(s.multipleOf)?1:s.multipleOf,[s.multipleOf]);return{defaultValue:s.default,onChange:o,value:n.value,min:a,max:l,step:c,fineStep:d}},k2=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=Oj(e);return r.jsx(Ae,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:"nodrag",flex:"1 1 0"})});k2.displayName="IntegerFieldInput";const SV=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=Oj(e);return r.jsxs(r.Fragment,{children:[r.jsx(qe,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:"nodrag",marks:!0,withThumbTooltip:!0,flex:"1 1 0"}),r.jsx(Ae,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:"nodrag",flex:"1 1 0"})]})});SV.displayName="IntegerFieldInputAndSlider";const wV=u.memo(e=>{const{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l}=Oj(e);return r.jsx(qe,{defaultValue:t,onChange:n,value:s,min:i,max:o,step:a,fineStep:l,className:"nodrag",marks:!0,withThumbTooltip:!0,flex:"1 1 0"})});wV.displayName="IntegerFieldSlider";const jV=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=z(),o=u.useCallback(a=>{i(WY({nodeId:t,fieldName:n.name,value:a.target.value}))},[i,n.name,t]);return{value:n.value,onChange:o,defaultValue:s.default}},_2=u.memo(e=>{const{value:t,onChange:n}=jV(e);return r.jsx(Ct,{className:"nodrag nowheel nopan",value:t,onChange:n})});_2.displayName="StringFieldInput";const I2=u.memo(e=>{const{value:t,onChange:n}=jV(e);return r.jsx(Zn,{className:"nodrag nowheel nopan",value:t,onChange:n,h:"full",resize:"none",fontSize:"sm",p:2})});I2.displayName="StringFieldTextarea";const kV=(e,t)=>{const n=u.useMemo(()=>It(ot,i=>{const o=Y0(i,e,t);return Re(o,`Instance for input field ${t} not found`),o}),[t,e]);return I(n)},_Se=e=>{const{nodeId:t,field:n}=e,s=z(),{t:i}=P(),{options:o,hasBoards:a}=Eu({include_archived:!0},{selectFromResult:({data:h})=>{const f=[{label:"None",value:"none"}].concat((h??[]).map(({board_id:p,board_name:g})=>({label:g,value:p})));return{options:f,hasBoards:f.length>1}}}),l=u.useCallback(h=>{h&&s(UY({nodeId:t,fieldName:n.name,value:h.value!=="none"?{board_id:h.value}:void 0}))},[s,n.name,t]),c=u.useMemo(()=>o.find(h=>{var f;return h.value===((f=n.value)==null?void 0:f.board_id)}),[o,n.value]),d=u.useCallback(()=>i("boards.noMatching"),[i]);return r.jsx(Fe,{className:"nowheel nodrag",value:c,options:o,onChange:l,placeholder:i("boards.selectBoard"),noOptionsMessage:d,isDisabled:!a})},ISe=u.memo(_Se),ASe=e=>{const{nodeId:t,field:n}=e,s=z(),i=u.useCallback(o=>{s(qY({nodeId:t,fieldName:n.name,value:o.target.checked}))},[s,n.name,t]);return r.jsx(it,{className:"nodrag",onChange:i,isChecked:n.value})},TSe=u.memo(ASe),MSe=e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=I(y=>y.config.disabledTabs),o=z(),[a,{isLoading:l}]=Xl(),c=u.useCallback(y=>{y&&o(KY({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Le,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},PSe=u.memo(MSe),ESe=e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=I(y=>y.config.disabledTabs),o=z(),[a,{isLoading:l}]=Xl(),c=u.useCallback(y=>{y&&o(ZY({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a.filter(y=>I3(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Le,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},LSe=u.memo(ESe),DSe=e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=I(y=>y.config.disabledTabs),o=z(),[a,{isLoading:l}]=Xl(),c=u.useCallback(y=>{y&&o(YY({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a.filter(y=>A3(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Le,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},RSe=u.memo(DSe),OSe={r:0,g:0,b:0,a:255},NSe=e=>{const{nodeId:t,field:n}=e,s=z(),i=u.useMemo(()=>{if(!n.value)return OSe;const{r:a,g:l,b:c,a:d}=n.value;return{r:a,g:l,b:c,a:d/255}},[n.value]),o=u.useCallback(a=>{typeof a=="string"&&(a=W0e(a,1));const{r:l,g:c,b:d,a:h}=a,f=Math.round(h*255);s(XY({nodeId:t,fieldName:n.name,value:{r:l,g:c,b:d,a:f}}))},[s,n.name,t]);return r.jsxs(T,{flexDir:"column",gap:2,w:"full",children:[r.jsx(oye,{style:{background:Qi("base.700"),color:Qi("base.100"),fontSize:12,paddingInlineStart:10,borderRadius:4,paddingBlock:4,outline:"none"},className:"nodrag",color:H0e(i,!0),onChange:o,prefixed:!0,alpha:!0}),r.jsx(SN,{className:"nodrag",color:i,onChange:o,style:{width:"100%"}})]})},FSe=u.memo(NSe),BSe=e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=I(y=>y.config.disabledTabs),o=z(),[a,{isLoading:l}]=dR(),c=u.useCallback(y=>{y&&o(QY({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a.filter(y=>iM(y)),onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Le,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},$Se=u.memo(BSe),VSe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=ew(),a=u.useCallback(p=>{p&&s(JY({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Le,{label:c==null?void 0:c.description,children:r.jsx(Z,{className:"nowheel nodrag",isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},GSe=u.memo(VSe),zSe=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,i=z(),o=u.useCallback(a=>{i(eX({nodeId:t,fieldName:n.name,value:a.target.value}))},[i,n.name,t]);return r.jsx(Kl,{className:"nowheel nodrag",onChange:o,value:n.value,size:"sm",children:s.options.map(a=>r.jsx("option",{value:a,children:s.ui_choice_labels?s.ui_choice_labels[a]:a},a))})},HSe=u.memo(zSe),WSe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Hue(),a=u.useCallback(p=>{p&&s(d1({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!l.length,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},USe=u.memo(WSe),qSe=e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=I(m=>m.config.disabledTabs),o=z(),[a,{isLoading:l}]=pR(),c=u.useCallback(m=>{m&&o(tX({nodeId:t,fieldName:n.name,value:m}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Le,{label:!i.includes("models")&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!d.length,isInvalid:!h,children:r.jsx(Fe,{value:h,placeholder:p,options:d,onChange:f,noOptionsMessage:g})})})})},KSe=u.memo(qSe),ZSe=e=>{var p;const{t}=P(),{nodeId:n,field:s,fieldTemplate:i}=e,o=z(),a=ce(An),{currentData:l,isError:c}=Pa(((p=s.value)==null?void 0:p.image_name)??ws),d=u.useCallback(()=>{o(zb({nodeId:n,fieldName:s.name,value:void 0}))},[o,s.name,n]),h=u.useMemo(()=>{var g;return r2.getData({fieldIdentifier:{nodeId:n,fieldName:s.name}},(g=s.value)==null?void 0:g.image_name)},[s,n]);u.useEffect(()=>{a&&c&&d()},[d,a,c]);const f=u.useCallback(g=>{o(zb({nodeId:n,fieldName:s.name,value:g}))},[o,s.name,n]);return r.jsxs(T,{position:"relative",className:"nodrag",w:"full",h:"full",minH:16,alignItems:"stretch",justifyContent:"center",children:[!l&&r.jsx(bj,{w:"full",h:"auto",isError:i.required&&!s.value,onUpload:f,fontSize:24}),l&&r.jsxs(r.Fragment,{children:[r.jsx($a,{imageDTO:l,minW:8,minH:8}),r.jsx(io,{onClick:d,icon:l?r.jsx(ho,{}):void 0,tooltip:"Reset Image",position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1})]}),r.jsx(vs,{dndTarget:r2,dndTargetData:h,label:t("gallery.drop")})]})},YSe=u.memo(ZSe),XSe=u.memo(()=>{const{t:e}=P();return r.jsx(T,{h:16,w:"full",alignItems:"center",justifyContent:"center",children:r.jsx(K,{fontSize:16,fontWeight:"semibold",children:e("gallery.dropOrUpload")})})});XSe.displayName="UploadElement";const QSe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=nw(),a=u.useCallback(h=>{h&&s(nX({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Le,{label:c==null?void 0:c.description,children:r.jsx(Z,{className:"nowheel nodrag",isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},JSe=u.memo(QSe),ewe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=K1(),a=u.useCallback(p=>{p&&s(sX({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Z,{className:"nowheel nodrag",isInvalid:!c,isDisabled:!l.length,children:r.jsx(Fe,{value:c,placeholder:h,noOptionsMessage:f,options:l,onChange:d})})},twe=u.memo(ewe),nwe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=zue(),a=u.useCallback(p=>{p&&s(d1({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!l.length,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},swe=u.memo(nwe),rwe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=q1(),a=u.useCallback(p=>{p&&s(rX({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!l.length,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},iwe=u.memo(rwe),owe=e=>{const{nodeId:t,field:n}=e,s=z(),i=u.useCallback(a=>{Ol(a==null?void 0:a.value)&&s(iX({nodeId:t,fieldName:n.name,value:a.value}))},[s,n.name,t]),o=u.useMemo(()=>no.find(a=>a.value===(n==null?void 0:n.value)),[n==null?void 0:n.value]);return r.jsx(Z,{className:"nowheel nodrag",children:r.jsx(Fe,{value:o,options:no,onChange:i})})},awe=u.memo(owe),lwe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Wue(),a=u.useCallback(p=>{p&&s(d1({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!l.length,isInvalid:!c&&e.fieldTemplate.required,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},cwe=u.memo(lwe),uwe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Uue(),a=u.useCallback(p=>{p&&s(d1({nodeId:t,fieldName:n.name,value:p}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,isLoading:o,selectedModel:n.value});return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!l.length,isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f})})})},dwe=u.memo(uwe),hwe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Ip(),a=u.useCallback(h=>{h&&s(oX({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Le,{label:c==null?void 0:c.description,children:r.jsx(Z,{className:"nowheel nodrag",isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},fwe=u.memo(hwe),pwe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=hR(),a=u.useCallback(h=>{h&&s(aX({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:l,value:c,onChange:d}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o});return r.jsx(Le,{label:c==null?void 0:c.description,children:r.jsx(Z,{className:"nowheel nodrag",isInvalid:!c,children:r.jsx(Fe,{value:c,placeholder:"Pick one",options:l,onChange:d})})})},gwe=u.memo(pwe),mwe=e=>{const{nodeId:t,field:n}=e,{t:s}=P(),i=I(FC),o=z(),[a,{isLoading:l}]=tw(),c=u.useCallback(y=>{y&&o(lX({nodeId:t,fieldName:n.name,value:y}))},[o,n.name,t]),{options:d,value:h,onChange:f,placeholder:p,noOptionsMessage:g}=hn({modelConfigs:a,onChange:c,isLoading:l,selectedModel:n.value}),m=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Le,{label:!i&&s("modelManager.starterModelsInModelManager"),children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!d.length,isInvalid:!h&&m,children:r.jsx(Fe,{value:h,placeholder:m?p:`(Optional) ${p}`,options:d,onChange:f,noOptionsMessage:g})})})})},ywe=u.memo(mwe),vwe=e=>{const{nodeId:t,field:n}=e,s=z(),[i,{isLoading:o}]=Z1(),a=u.useCallback(g=>{g&&s(cX({nodeId:t,fieldName:n.name,value:g}))},[s,n.name,t]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:a,selectedModel:n.value,isLoading:o}),p=e.fieldTemplate.required;return r.jsx(T,{w:"full",alignItems:"center",gap:2,children:r.jsx(Z,{className:"nowheel nodrag",isDisabled:!l.length,isInvalid:!c&&p,children:r.jsx(Fe,{value:c,placeholder:p?h:`(Optional) ${h}`,options:l,onChange:d,noOptionsMessage:f})})})},bwe=u.memo(vwe),Cy=u.memo(({nodeId:e,fieldName:t,settings:n})=>{const s=kV(e,t),i=Zo(e,t);if(C3(i))return x3(s)?r.jsx(mV,{nodeId:e,field:s,fieldTemplate:i}):null;if(p3(i)){if(!uX(s))return null;if((n==null?void 0:n.type)!=="string-field-config")return i.ui_component==="textarea"?r.jsx(I2,{nodeId:e,field:s,fieldTemplate:i}):r.jsx(_2,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="input")return r.jsx(_2,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="textarea")return r.jsx(I2,{nodeId:e,field:s,fieldTemplate:i})}if(dX(i))return hX(s)?r.jsx(TSe,{nodeId:e,field:s,fieldTemplate:i}):null;if(h3(i)){if(!fX(s))return null;if((n==null?void 0:n.type)!=="integer-field-config")return r.jsx(k2,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input")return r.jsx(k2,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="slider")return r.jsx(wV,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input-and-slider")return r.jsx(SV,{nodeId:e,field:s,fieldTemplate:i})}if(f3(i)){if(!pX(s))return null;if((n==null?void 0:n.type)!=="float-field-config")return r.jsx(j2,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input")return r.jsx(j2,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="slider")return r.jsx(Q$,{nodeId:e,field:s,fieldTemplate:i});if(n.component==="number-input-and-slider")return r.jsx(X$,{nodeId:e,field:s,fieldTemplate:i})}return w3(i)?S3(s)?r.jsx(cV,{nodeId:e,field:s,fieldTemplate:i}):null:k3(i)?j3(s)?r.jsx(eV,{nodeId:e,field:s,fieldTemplate:i}):null:gX(i)?mX(s)?r.jsx(HSe,{nodeId:e,field:s,fieldTemplate:i}):null:b3(i)?wC(s)?r.jsx(aV,{nodeId:e,field:s,fieldTemplate:i}):null:yX(i)?vX(s)?r.jsx(YSe,{nodeId:e,field:s,fieldTemplate:i}):null:bX(i)?xX(s)?r.jsx(ISe,{nodeId:e,field:s,fieldTemplate:i}):null:CX(i)?SX(s)?r.jsx(swe,{nodeId:e,field:s,fieldTemplate:i}):null:wX(i)?jX(s)?r.jsx(CSe,{nodeId:e,field:s,fieldTemplate:i}):null:kX(i)?_X(s)?r.jsx(iwe,{nodeId:e,field:s,fieldTemplate:i}):null:IX(i)?AX(s)?r.jsx(bwe,{nodeId:e,field:s,fieldTemplate:i}):null:TX(i)?MX(s)?r.jsx(ywe,{nodeId:e,field:s,fieldTemplate:i}):null:PX(i)?EX(s)?r.jsx(PSe,{nodeId:e,field:s,fieldTemplate:i}):null:LX(i)?DX(s)?r.jsx(RSe,{nodeId:e,field:s,fieldTemplate:i}):null:RX(i)?OX(s)?r.jsx(LSe,{nodeId:e,field:s,fieldTemplate:i}):null:NX(i)?FX(s)?r.jsx($Se,{nodeId:e,field:s,fieldTemplate:i}):null:BX(i)?$X(s)?r.jsx(KSe,{nodeId:e,field:s,fieldTemplate:i}):null:VX(i)?GX(s)?r.jsx(twe,{nodeId:e,field:s,fieldTemplate:i}):null:zX(i)?HX(s)?r.jsx(GSe,{nodeId:e,field:s,fieldTemplate:i}):null:WX(i)?UX(s)?r.jsx(JSe,{nodeId:e,field:s,fieldTemplate:i}):null:qX(i)?KX(s)?r.jsx(gwe,{nodeId:e,field:s,fieldTemplate:i}):null:ZX(i)?YX(s)?r.jsx(fwe,{nodeId:e,field:s,fieldTemplate:i}):null:XX(i)?QX(s)?r.jsx(FSe,{nodeId:e,field:s,fieldTemplate:i}):null:JX(i)?eQ(s)?r.jsx(USe,{nodeId:e,field:s,fieldTemplate:i}):null:tQ(i)?nQ(s)?r.jsx(cwe,{nodeId:e,field:s,fieldTemplate:i}):null:sQ(i)?rQ(s)?r.jsx(dwe,{nodeId:e,field:s,fieldTemplate:i}):null:iQ(i)?oQ(s)?r.jsx(awe,{nodeId:e,field:s,fieldTemplate:i}):null:aQ(i)?lQ(s)?r.jsx(oV,{nodeId:e,field:s,fieldTemplate:i}):null:cQ(i)?uQ(s)?r.jsx(gV,{nodeId:e,field:s,fieldTemplate:i}):null:dQ(i)&&hQ(s)?r.jsx(CV,{nodeId:e,field:s,fieldTemplate:i}):null});Cy.displayName="InputFieldRenderer";const _V=(e,t)=>{const n=u.useMemo(()=>It(ot,i=>{var a;const o=i.nodes.find(l=>l.id===e);if(Yr(o))return(a=o==null?void 0:o.data.inputs[t])==null?void 0:a.value}),[t,e]);return I(n)},ub=Symbol("uniqueNonexistentValue"),xwe=(e,t,n)=>{const s=z(),i=u.useMemo(()=>ve(Fu,d=>e in d.formFieldInitialValues?d.formFieldInitialValues[e]:ub),[e]),o=I(i),a=_V(t,n),l=u.useMemo(()=>o!==ub&&!ol(a,o),[a,o]),c=u.useCallback(()=>{o!==ub&&s(T3({nodeId:t,fieldName:n,value:o}))},[s,n,t,o]);return{initialValue:o,isValueChanged:l,resetToInitialValue:c}},Nj=u.memo(({element:e})=>{const{t}=P(),{id:n,data:s}=e,{nodeId:i,fieldName:o}=s.fieldIdentifier,{isValueChanged:a,resetToInitialValue:l}=xwe(n,i,o);return r.jsx(ae,{variant:"link",size:"sm",alignSelf:"stretch",tooltip:t("nodes.resetToDefaultValue"),"aria-label":t("nodes.resetToDefaultValue"),icon:r.jsx(ho,{}),onClick:l,isDisabled:!a})});Nj.displayName="NodeFieldElementResetToInitialValueIconButton";const Fj=(e,t)=>{const n=u.useMemo(()=>ve(ot,i=>{var a;const o=i.nodes.find(l=>l.id===e);return Yr(o)?((a=o==null?void 0:o.data.inputs[t])==null?void 0:a.description)??"":""}),[t,e]);return I(n)},Bj=(e,t)=>{const n=u.useMemo(()=>ve(ot,i=>{var o;return((o=Y0(i,e,t))==null?void 0:o.label)??""}),[t,e]);return I(n)},IV=u.memo(({id:e})=>{const t=Ou(e),n=I(uo);return!t||!l1(t)?null:n==="view"?r.jsx(ou,{nodeId:t.data.fieldIdentifier.nodeId,fieldName:t.data.fieldIdentifier.fieldName,children:r.jsx(AV,{el:t})}):r.jsxs(ou,{nodeId:t.data.fieldIdentifier.nodeId,fieldName:t.data.fieldIdentifier.fieldName,children:[r.jsx(TV,{el:t})," "]})});IV.displayName="NodeFieldElementComponent";const AV=u.memo(({el:e})=>{const{id:t,data:n}=e,{fieldIdentifier:s,showDescription:i}=n,o=Bj(s.nodeId,s.fieldName),a=Fj(s.nodeId,s.fieldName),l=Zo(s.nodeId,s.fieldName),c=u.useMemo(()=>o||l.title,[o,l.title]),d=u.useMemo(()=>a||l.description,[a,l.description]);return r.jsx(T,{id:t,className:M3,flex:"1 1 0",children:r.jsxs(Z,{flex:"1 1 0",orientation:"vertical",children:[r.jsxs(T,{w:"full",gap:4,children:[r.jsx(te,{children:c}),r.jsx(nt,{}),r.jsx(Nj,{element:e})]}),r.jsx(T,{w:"full",gap:4,children:r.jsx(Cy,{nodeId:s.nodeId,fieldName:s.fieldName,settings:n.settings})}),i&&d&&r.jsx(Us,{children:d})]})})});AV.displayName="NodeFieldElementComponentViewMode";const TV=u.memo(({el:e})=>{const{id:t,data:n}=e,{fieldIdentifier:s,showDescription:i}=n;return r.jsx(dd,{element:e,children:r.jsx(T,{id:t,className:M3,flex:"1 1 0",children:r.jsxs(Z,{flex:"1 1 0",orientation:"vertical",children:[r.jsx(MV,{el:e}),r.jsx(T,{w:"full",gap:4,children:r.jsx(Cy,{nodeId:s.nodeId,fieldName:s.fieldName,settings:n.settings})}),i&&r.jsx(PV,{el:e})]})})})});TV.displayName="NodeFieldElementComponentEditMode";const MV=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=z(),i=Bj(n.nodeId,n.fieldName),o=Zo(n.nodeId,n.fieldName),a=u.useRef(null),l=u.useCallback(d=>{s(P3({nodeId:n.nodeId,fieldName:n.fieldName,label:d}))},[s,n.fieldName,n.nodeId]),c=Ko({value:i||o.title,defaultValue:o.title,inputRef:a,onChange:l});return c.isEditing?r.jsx(Ct,{ref:a,variant:"outline",...c.inputProps}):r.jsxs(T,{w:"full",gap:4,children:[r.jsx(te,{onDoubleClick:c.startEditing,cursor:"text",children:c.value}),r.jsx(nt,{}),r.jsx(Nj,{element:e})]})});MV.displayName="NodeFieldEditableLabel";const PV=u.memo(({el:e})=>{const{data:t}=e,{fieldIdentifier:n}=t,s=z(),i=Fj(n.nodeId,n.fieldName),o=Zo(n.nodeId,n.fieldName),a=u.useRef(null),l=u.useCallback(d=>{s(E3({nodeId:n.nodeId,fieldName:n.fieldName,val:d}))},[s,n.fieldName,n.nodeId]),c=Ko({value:i||o.description,defaultValue:o.description,inputRef:a,onChange:l});return c.isEditing?r.jsx(Zn,{ref:a,variant:"outline",...c.inputProps}):r.jsx(Us,{onDoubleClick:c.startEditing,children:c.value})});PV.displayName="NodeFieldEditableDescription";const EV=u.memo(({id:e})=>{const t=Ou(e),n=I(uo);return!t||!L3(t)?null:n==="view"?r.jsx(LV,{el:t}):r.jsx(DV,{el:t})});EV.displayName="TextElementComponent";const LV=u.memo(({el:e})=>{const{id:t,data:n}=e,{content:s}=n;return r.jsx(T,{id:t,className:D3,w:"full",children:r.jsx($j,{content:s})})});LV.displayName="TextElementComponentViewMode";const Cwe={fontSize:"md",overflowWrap:"anywhere",'&[data-is-empty="true"]':{opacity:.3}},$j=u.memo(({content:e,...t})=>{const{t:n}=P();return r.jsx(K,{sx:Cwe,"data-is-empty":e==="",...t,children:e||n("workflows.builder.textPlaceholder")})});$j.displayName="TextContentDisplay";const DV=u.memo(({el:e})=>{const{id:t}=e;return r.jsx(dd,{element:e,children:r.jsx(T,{id:t,className:D3,w:"full",children:r.jsx(RV,{el:e})})})});DV.displayName="TextElementComponentEditMode";const RV=u.memo(({el:e})=>{const{t}=P(),n=z(),{id:s,data:i}=e,{content:o}=i,a=u.useRef(null),l=u.useCallback(d=>{n(fQ({id:s,changes:{content:d}}))},[n,s]),c=Ko({value:o,defaultValue:"",onChange:l,inputRef:a});return c.isEditing?r.jsx(Lj,{ref:a,placeholder:t("workflows.builder.textPlaceholder"),...c.inputProps,fontSize:"md",variant:"outline",overflowWrap:"anywhere",w:"full",minRows:1,maxRows:10,resize:"none",p:2}):r.jsx($j,{content:c.value,onDoubleClick:c.startEditing})});RV.displayName="EditableText";const OV={gap:4,flex:"1 1 0",'&[data-container-layout="column"]':{flexDir:"column"},'&[data-container-layout="row"]':{flexDir:"row"}},NV=u.memo(({id:e})=>{const t=Ou(e),n=I(uo);return!t||!ns(t)?null:n==="view"?r.jsx(FV,{el:t}):r.jsx(BV,{el:t})});NV.displayName="ContainerElementComponent";const FV=u.memo(({el:e})=>{const{t}=P(),n=Mj(),{id:s,data:i}=e,{children:o,layout:a}=i;return r.jsx(Tj,{depth:n+1,children:r.jsx(Ij,{id:s,layout:a,children:r.jsxs(T,{id:s,className:R3,sx:OV,"data-container-layout":a,children:[o.map(l=>r.jsx(Sy,{id:l},l)),o.length===0&&r.jsx(T,{p:4,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(K,{variant:"subtext",children:t("workflows.builder.containerPlaceholder")})})]})})})});FV.displayName="ContainerElementComponentViewMode";const BV=u.memo(({el:e})=>{const{t}=P(),n=Mj(),{id:s,data:i}=e,{children:o,layout:a}=i;return r.jsx(dd,{element:e,children:r.jsx(Tj,{depth:n+1,children:r.jsx(Ij,{id:s,layout:a,children:r.jsxs(T,{id:s,className:R3,sx:OV,"data-container-layout":a,children:[o.map(l=>r.jsx(Sy,{id:l},l)),o.length===0&&r.jsx(T,{p:4,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(K,{variant:"subtext",children:t("workflows.builder.containerPlaceholderDesc")})})]})})})})});BV.displayName="ContainerElementComponentEditMode";const Sy=u.memo(({id:e})=>{const t=Ou(e);if(!t)return null;if(ns(t))return r.jsx(NV,{id:e},e);if(l1(t))return r.jsx(IV,{id:e},e);if(g3(t))return r.jsx(z$,{id:e},e);if(y3(t))return r.jsx(U$,{id:e},e);if(L3(t))return r.jsx(EV,{id:e},e);Re(!1,`Unhandled type for element with id ${e}`)});Sy.displayName="FormElementComponent";const $V=u.memo(()=>{const{t:e}=P(),t=z(),n=I(OC);ACe();const s=u.useCallback(()=>{t(gQ())},[t]);return r.jsx(Nn,{children:r.jsx(T,{justifyContent:"center",w:"full",h:"full",children:r.jsxs(T,{flexDir:"column",w:"full",h:"full",maxW:"768px",gap:4,children:[r.jsxs(zl,{status:"warning",variant:"subtle",borderRadius:"base",flexShrink:0,children:[r.jsx(Hl,{}),r.jsx(Qf,{fontSize:"sm",children:e("workflows.builder.workflowBuilderAlphaWarning")})]}),r.jsxs(as,{isAttached:!1,justifyContent:"center",children:[r.jsx(Hg,{type:"container"}),r.jsx(Hg,{type:"divider"}),r.jsx(Hg,{type:"heading"}),r.jsx(Hg,{type:"text"}),r.jsx(nt,{}),r.jsx(ye,{onClick:s,variant:"ghost",leftIcon:r.jsx(ho,{}),children:e("common.reset")})]}),!n&&r.jsx(Vj,{}),n&&r.jsx(VV,{})]})})})});$V.displayName="WorkflowBuilder";const Vj=u.memo(()=>{const e=I(pQ);return r.jsx(T,{flexDir:"column",gap:4,w:"full",borderRadius:"base",children:e.map(t=>r.jsx(Sy,{id:t},t))})});Vj.displayName="FormLayout";const VV=u.memo(()=>{const{t:e}=P(),t=u.useRef(null),n=TCe(t);return r.jsx(T,{id:Pj("root"),ref:t,w:"full",h:"full",bg:n?"base.800":void 0,p:4,borderRadius:"base",alignItems:"center",justifyContent:"center",children:r.jsx(K,{variant:"subtext",fontSize:"md",children:e("workflows.builder.emptyRootPlaceholderEditMode")})})});VV.displayName="EmptyStateEditMode";const Swe=(e,t)=>{const[n,s]=u.useState(!1);return u.useEffect(()=>{const i=t.current;if(i)return Kn(nd(i),Wu({element:i,getInitialData:()=>{if(e==="container"){const o=mQ("row",[]);return dl(o)}if(e==="divider"){const o=yQ();return dl(o)}if(e==="heading"){const o=vQ("");return dl(o)}if(e==="text"){const o=bQ("");return dl(o)}Re(!1)},onDragStart:()=>{s(!0)},onDrop:()=>{s(!1)}}))},[t,e]),n},Hg=({type:e})=>{const t=u.useRef(null),n=Swe(e,t);return r.jsx(ye,{as:"div",ref:t,pointerEvents:"all",variant:"unstyled",borderWidth:2,borderStyle:"dashed",borderRadius:"base",px:4,py:1,cursor:"grab",_hover:{bg:"base.800"},isDisabled:n,children:Kc(e)})},wwe=It(Fu,e=>{const{author:t,name:n,description:s,tags:i,version:o,contact:a,notes:l}=e;return{name:n,author:t,description:s,tags:i,version:o,contact:a,notes:l}}),jwe=()=>{const{author:e,name:t,description:n,tags:s,version:i,contact:o,notes:a}=I(wwe),l=z(),c=u.useCallback(x=>{l(O3(x.target.value))},[l]),d=u.useCallback(x=>{l(xQ(x.target.value))},[l]),h=u.useCallback(x=>{l(CQ(x.target.value))},[l]),f=u.useCallback(x=>{l(SQ(x.target.value))},[l]),p=u.useCallback(x=>{l(wQ(x.target.value))},[l]),g=u.useCallback(x=>{l(jQ(x.target.value))},[l]),m=u.useCallback(x=>{l(kQ(x.target.value))},[l]),{t:y}=P();return r.jsx(Nn,{children:r.jsx(T,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:r.jsxs(ms,{orientation:"vertical",formControlProps:_we,children:[r.jsxs(T,{gap:2,w:"full",children:[r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowName")}),r.jsx(Ct,{value:t,onChange:c})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowVersion")}),r.jsx(Ct,{value:i,onChange:f})]})]}),r.jsxs(T,{gap:2,w:"full",children:[r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowAuthor")}),r.jsx(Ct,{value:e,onChange:d})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowContact")}),r.jsx(Ct,{value:o,onChange:h})]})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowTags")}),r.jsx(Ct,{value:s,onChange:g})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowDescription")}),r.jsx(Zn,{onChange:p,value:n,fontSize:"sm",resize:"none",rows:3})]}),r.jsxs(Z,{children:[r.jsx(te,{children:y("nodes.workflowNotes")}),r.jsx(Zn,{onChange:m,value:a,fontSize:"sm",resize:"none",rows:10})]})]})})})},kwe=u.memo(jwe),_we={flexShrink:0},Va=Oe(null),Iwe=Ea(e=>{Va.set(_Q(e))},300),Awe=ve(ot,Fu,(e,t)=>({nodes:e.nodes,edges:e.edges,workflow:t})),Twe=()=>{const e=I(Awe);u.useEffect(()=>{Iwe(e)},[e])},Mwe=()=>{const e=ce(Va),{t}=P();return r.jsx(T,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:r.jsx(Bo,{data:e??{},label:t("nodes.workflow")})})},Pwe=u.memo(Mwe),Ewe=()=>{const{t:e}=P();return r.jsx(T,{layerStyle:"first",flexDir:"column",w:"full",h:"full",borderRadius:"base",p:2,gap:2,children:r.jsxs(Vl,{variant:"line",display:"flex",w:"full",h:"full",flexDir:"column",children:[r.jsxs(Gl,{children:[r.jsx(Sn,{children:e("workflows.builder.builder")}),r.jsx(Sn,{children:e("common.details")}),r.jsx(Sn,{children:"JSON"})]}),r.jsxs(Lu,{children:[r.jsx(Pn,{children:r.jsx($V,{})}),r.jsx(Pn,{children:r.jsx(kwe,{})}),r.jsx(Pn,{children:r.jsx(Pwe,{})})]})]})})},Lwe=u.memo(Ewe),Dwe={height:"100%",width:"100%"},GV=u.memo(()=>{const e=u.useRef(null),t=u.useCallback(()=>{e.current&&e.current.setLayout([50,50])},[]);return r.jsx(xy,{view:"edit-mode-linear",children:r.jsx(ke,{position:"relative",w:"full",h:"full",children:r.jsx(Nn,{children:r.jsxs(Gp,{ref:e,id:"workflow-panel-group",autoSaveId:"workflow-panel-group",direction:"vertical",style:Dwe,children:[r.jsx(Xi,{id:"workflow",collapsible:!0,minSize:25,children:r.jsx(Lwe,{})}),r.jsx(Tf,{onDoubleClick:t}),r.jsx(Xi,{id:"inspector",collapsible:!0,minSize:25,children:r.jsx(bCe,{})})]})})})})});GV.displayName="EditModeLeftPanelContent";const Rwe=()=>{const e=I(IQ);return r.jsx(T,{w:"full",userSelect:"none",justifyContent:"center",children:r.jsxs(T,{alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:5,maxW:"230px",pt:24,children:[r.jsx(dn,{src:AQ,alt:"invoke-ai-logo",opacity:.2,mixBlendMode:"overlay",w:16,h:16,minW:16,minH:16,userSelect:"none"}),e?r.jsx(Owe,{}):r.jsx(Nwe,{})]})})},Owe=()=>{const{t:e}=P(),t=z(),n=gp(),s=u.useCallback(()=>{t(gu("edit"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{gap:2,children:[r.jsx(ye,{size:"sm",onClick:s,children:e("nodes.newWorkflow")}),r.jsx(ye,{size:"sm",colorScheme:"invokeBlue",onClick:n.open,children:e("nodes.loadWorkflow")})]}),r.jsx(K,{textAlign:"center",fontSize:"md",children:r.jsx(Xt,{i18nKey:"nodes.workflowHelpText",size:"sm",components:Fwe})})]})},Nwe=()=>{const{t:e}=P(),t=z(),n=u.useCallback(()=>{t(gu("edit"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsx(K,{textAlign:"center",fontSize:"md",children:e("nodes.noFieldsViewMode")}),r.jsx(ye,{size:"sm",colorScheme:"invokeBlue",onClick:n,children:e("nodes.edit")})]})},Fwe={LinkComponent:r.jsx(n1,{fontSize:"md",fontWeight:"semibold",href:"https://support.invoke.ai/support/solutions/articles/151000159663-example-workflows",target:"_blank"})},zV=u.memo(()=>r.jsx(xy,{view:"view-mode-linear",children:r.jsx(ke,{position:"relative",w:"full",h:"full",children:r.jsx(Nn,{children:r.jsx(T,{justifyContent:"center",w:"full",h:"full",p:4,children:r.jsx(T,{flexDir:"column",w:"full",h:"full",maxW:"768px",gap:4,children:r.jsx(HV,{})})})})})}));zV.displayName="ViewModeLeftPanelContent";const HV=u.memo(()=>{const{isLoading:e}=BC(),t=I(OC);return e?r.jsx(Yt,{label:Ce("nodes.loadingNodes"),icon:null}):t?r.jsx(Rwe,{}):r.jsx(Vj,{})});HV.displayName=" ViewModeLeftPanelContentInner";const Bwe=ka("workflowLibrary/workflowDownloaded"),$we=ka("workflowLibrary/workflowLoadedFromFile"),Vwe=ka("workflowLibrary/newWorkflowSaved"),Gwe=ka("workflowLibrary/workflowUpdated"),WV=({resetRef:e,onSuccess:t})=>{const n=z(),s=QP("workflows"),{t:i}=P();return u.useCallback(a=>{var c;if(!a)return;const l=new FileReader;l.onload=()=>{const d=l.result;try{n(B0({data:{workflow:String(d),graph:null},asCopy:!0})),n($we()),t&&t()}catch{s.error(i("nodes.unableToLoadWorkflow")),fe({id:"UNABLE_TO_LOAD_WORKFLOW",title:i("nodes.unableToLoadWorkflow"),status:"error"}),l.abort()}},l.readAsText(a),(c=e.current)==null||c.call(e)},[n,s,e,i,t])},zwe=e=>`${e.trim()} (copy)`,db=Oe(!1),Wg=Oe(""),hb=Oe(!1),Hwe=ve(Fu,({name:e,id:t})=>t?e.length?zwe(e):"":e),fd=()=>{const e=I(Hwe),t=ce(db),n=u.useCallback(()=>{Wg.set(e),db.set(!0)},[e]),s=u.useCallback(()=>{db.set(!1),Wg.set(""),hb.set(!1)},[]),i=ce(Wg),o=u.useCallback(c=>Wg.set(c),[]),a=ce(hb),l=u.useCallback(c=>{hb.set(c)},[]);return{workflowName:i,setWorkflowName:o,shouldSaveToProject:a,setShouldSaveToProject:l,isOpen:t,onOpen:n,onClose:s}},Wwe=()=>{const{t:e}=P(),t=u.useRef(null),n=gp(),s=fd(),i=WV({resetRef:t,onSuccess:()=>{n.close(),s.onOpen()}}),o=u.useCallback(c=>{c[0]&&i(c[0])},[i]),{getInputProps:a,getRootProps:l}=Ra({accept:{"application/json":[".json"]},onDropAccepted:o,noDrag:!0,multiple:!1});return r.jsxs(r.Fragment,{children:[r.jsx(ae,{"aria-label":e("workflows.uploadAndSaveWorkflow"),tooltip:e("workflows.uploadAndSaveWorkflow"),icon:r.jsx(M1,{}),...l(),pointerEvents:"auto",variant:"ghost"}),r.jsx("input",{...a()})]})},Uwe=u.memo(Wwe),qwe=e=>{const t=z(),n=u.useMemo(()=>ve(Fu,o=>o.categorySections[e]??!0),[e]),s=I(n),i=u.useCallback(()=>{t(TQ({id:e,isOpen:!s}))},[e,t,s]);return{isOpen:s,onToggle:i}};var Kwe=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,Zwe=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,Ywe=/[^-+\dA-Z]/g;function ef(e,t,n,s){if(arguments.length===1&&typeof e=="string"&&!/\d/.test(e)&&(t=e,e=void 0),e=e||e===0?e:new Date,e instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");t=String(xl[t]||t||xl.default);var i=t.slice(0,4);(i==="UTC:"||i==="GMT:")&&(t=t.slice(4),n=!0,i==="GMT:"&&(s=!0));var o=function(){return n?"getUTC":"get"},a=function(){return e[o()+"Date"]()},l=function(){return e[o()+"Day"]()},c=function(){return e[o()+"Month"]()},d=function(){return e[o()+"FullYear"]()},h=function(){return e[o()+"Hours"]()},f=function(){return e[o()+"Minutes"]()},p=function(){return e[o()+"Seconds"]()},g=function(){return e[o()+"Milliseconds"]()},m=function(){return n?0:e.getTimezoneOffset()},y=function(){return Xwe(e)},x=function(){return Qwe(e)},C={d:function(){return a()},dd:function(){return cr(a())},ddd:function(){return Fs.dayNames[l()]},DDD:function(){return M8({y:d(),m:c(),d:a(),_:o(),dayName:Fs.dayNames[l()],short:!0})},dddd:function(){return Fs.dayNames[l()+7]},DDDD:function(){return M8({y:d(),m:c(),d:a(),_:o(),dayName:Fs.dayNames[l()+7]})},m:function(){return c()+1},mm:function(){return cr(c()+1)},mmm:function(){return Fs.monthNames[c()]},mmmm:function(){return Fs.monthNames[c()+12]},yy:function(){return String(d()).slice(2)},yyyy:function(){return cr(d(),4)},h:function(){return h()%12||12},hh:function(){return cr(h()%12||12)},H:function(){return h()},HH:function(){return cr(h())},M:function(){return f()},MM:function(){return cr(f())},s:function(){return p()},ss:function(){return cr(p())},l:function(){return cr(g(),3)},L:function(){return cr(Math.floor(g()/10))},t:function(){return h()<12?Fs.timeNames[0]:Fs.timeNames[1]},tt:function(){return h()<12?Fs.timeNames[2]:Fs.timeNames[3]},T:function(){return h()<12?Fs.timeNames[4]:Fs.timeNames[5]},TT:function(){return h()<12?Fs.timeNames[6]:Fs.timeNames[7]},Z:function(){return s?"GMT":n?"UTC":Jwe(e)},o:function(){return(m()>0?"-":"+")+cr(Math.floor(Math.abs(m())/60)*100+Math.abs(m())%60,4)},p:function(){return(m()>0?"-":"+")+cr(Math.floor(Math.abs(m())/60),2)+":"+cr(Math.floor(Math.abs(m())%60),2)},S:function(){return["th","st","nd","rd"][a()%10>3?0:(a()%100-a()%10!=10)*a()%10]},W:function(){return y()},WW:function(){return cr(y())},N:function(){return x()}};return t.replace(Kwe,function(v){return v in C?C[v]():v.slice(1,v.length-1)})}var xl={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},Fs={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},cr=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return String(t).padStart(n,"0")},M8=function(t){var n=t.y,s=t.m,i=t.d,o=t._,a=t.dayName,l=t.short,c=l===void 0?!1:l,d=new Date,h=new Date;h.setDate(h[o+"Date"]()-1);var f=new Date;f.setDate(f[o+"Date"]()+1);var p=function(){return d[o+"Date"]()},g=function(){return d[o+"Month"]()},m=function(){return d[o+"FullYear"]()},y=function(){return h[o+"Date"]()},x=function(){return h[o+"Month"]()},C=function(){return h[o+"FullYear"]()},v=function(){return f[o+"Date"]()},b=function(){return f[o+"Month"]()},S=function(){return f[o+"FullYear"]()};return m()===n&&g()===s&&p()===i?c?"Tdy":"Today":C()===n&&x()===s&&y()===i?c?"Ysd":"Yesterday":S()===n&&b()===s&&v()===i?c?"Tmw":"Tomorrow":a},Xwe=function(t){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate());n.setDate(n.getDate()-(n.getDay()+6)%7+3);var s=new Date(n.getFullYear(),0,4);s.setDate(s.getDate()-(s.getDay()+6)%7+3);var i=n.getTimezoneOffset()-s.getTimezoneOffset();n.setHours(n.getHours()-i);var o=(n-s)/(864e5*7);return 1+Math.floor(o)},Qwe=function(t){var n=t.getDay();return n===0&&(n=7),n},Jwe=function(t){return(String(t).match(Zwe)||[""]).pop().replace(Ywe,"").replace(/GMT\+0000/g,"UTC")};const Gj=Oe(null),eje=()=>Gj.set(null),tje=()=>u.useCallback(t=>{Gj.set(t)},[]),nje=()=>{wt("DeleteWorkflowDialog");const{t:e}=P(),t=ce(Gj),[n]=Gre(),s=u.useCallback(async()=>{if(t)try{await n(t.workflow_id).unwrap(),fe({id:"WORKFLOW_DELETED",title:e("toast.workflowDeleted")})}catch{fe({id:`AUTH_ERROR_TOAST_${jl.endpoints.deleteWorkflow.name}`,title:e("toast.problemDeletingWorkflow"),status:"error"})}},[n,e,t]);return r.jsx(ti,{isOpen:t!==null,onClose:eje,title:e("workflows.deleteWorkflow"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:r.jsx(K,{children:e("workflows.deleteWorkflow2")})})},UV=()=>{const e=z();return u.useCallback(()=>{const n=Va.get();if(!n)return;const s=new Blob([JSON.stringify(n,null,2)]),i=document.createElement("a");i.href=URL.createObjectURL(s),i.download=`${n.name||"My Workflow"}.json`,document.body.appendChild(i),i.click(),i.remove(),e(Bwe())},[e])},sje=({workflow:e})=>{const{t}=P();return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(K,{children:e.description}),e.category!=="default"&&r.jsxs(T,{flexDir:"column",children:[r.jsxs(K,{children:[t("workflows.opened"),": ",ef(e.opened_at,xl.shortDate)]}),r.jsxs(K,{children:[t("common.updated"),": ",ef(e.updated_at,xl.shortDate)]}),r.jsxs(K,{children:[t("common.created"),": ",ef(e.created_at,xl.shortDate)]})]})]})},rje=({workflow:e})=>{const{t}=P(),n=z(),s=ce(CC),i=gp(),[o,a]=u.useState(!1),l=u.useCallback(()=>{a(!0)},[]),c=u.useCallback(()=>{a(!1)},[]),d=I(MQ),h=UV(),f=Que(),p=tje(),{getAndLoadWorkflow:g}=XP({onSuccess:i.close}),m=u.useMemo(()=>d===e.workflow_id,[d,e.workflow_id]),y=u.useCallback(S=>{S.stopPropagation(),g(e.workflow_id),i.close()},[g,e.workflow_id,i]),x=u.useCallback(async S=>{S.stopPropagation(),a(!1),await g(e.workflow_id),n(gu("edit")),i.close()},[g,e.workflow_id,n,i]),C=u.useCallback(S=>{S.stopPropagation(),a(!1),p(e)},[p,e]),v=u.useCallback(S=>{S.stopPropagation(),a(!1),f(e)},[f,e]),b=u.useCallback(S=>{S.stopPropagation(),a(!1),h()},[h]);return r.jsxs(T,{gap:4,onClick:y,cursor:"pointer",_hover:{backgroundColor:"base.750"},p:2,ps:3,borderRadius:"base",w:"full",onMouseOver:l,onMouseOut:c,alignItems:"center",children:[r.jsx(Le,{label:r.jsx(sje,{workflow:e}),closeOnScroll:!0,children:r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsx(K,{noOfLines:2,children:e.name}),m&&r.jsx(os,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:t("workflows.opened")})]}),e.category!=="default"&&r.jsxs(K,{fontSize:"xs",variant:"subtext",flexShrink:0,noOfLines:1,children:[t("common.updated"),": ",ef(e.updated_at,xl.shortDate)," ",ef(e.updated_at,xl.shortTime)]})]})}),r.jsx(nt,{}),r.jsxs(T,{alignItems:"center",gap:1,opacity:o?1:0,children:[r.jsx(Le,{label:t("workflows.edit"),isOpen:o?void 0:!1,closeOnScroll:!0,children:r.jsx(ae,{size:"sm",variant:"ghost","aria-label":t("workflows.edit"),onClick:x,icon:r.jsx(bp,{})})}),r.jsx(Le,{label:t("workflows.download"),isOpen:o?void 0:!1,closeOnScroll:!0,children:r.jsx(ae,{size:"sm",variant:"ghost","aria-label":t("workflows.download"),onClick:b,icon:r.jsx(Vu,{})})}),!!s&&e.workflow_id&&e.category!=="user"&&r.jsx(Le,{label:t("workflows.copyShareLink"),isOpen:o?void 0:!1,closeOnScroll:!0,children:r.jsx(ae,{size:"sm",variant:"ghost","aria-label":t("workflows.copyShareLink"),onClick:v,icon:r.jsx(OE,{})})}),e.category!=="default"&&r.jsx(Le,{label:t("workflows.delete"),isOpen:o?void 0:!1,closeOnScroll:!0,children:r.jsx(ae,{size:"sm",variant:"ghost","aria-label":t("workflows.delete"),onClick:C,colorScheme:"error",icon:r.jsx(FE,{})})})]})]})},ije=({category:e})=>{const t=I(N3),n=I(F3),s=I(B3),{t:i}=P(),o=u.useMemo(()=>e!=="default"?{order_by:n,direction:s,category:e}:{order_by:"name",direction:"ASC",category:e},[e,s,n]),{data:a,isLoading:l}=Hre(o,{selectFromResult:({data:h,isLoading:f})=>({data:(h==null?void 0:h.items.filter(g=>g.name.toLowerCase().includes(t.toLowerCase())))||er,isLoading:f})}),{isOpen:c,onToggle:d}=qwe(e);return r.jsxs(T,{flexDir:"column",children:[r.jsx(ye,{variant:"unstyled",onClick:d,children:r.jsxs(T,{gap:2,alignItems:"center",children:[r.jsx(pt,{boxSize:4,as:Pr,transform:c?void 0:"rotate(-90deg)",fill:"base.500"}),r.jsx(K,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:i(`workflows.${e}Workflows`)})]})}),r.jsx(ql,{in:c,style:my,children:l?r.jsx(T,{alignItems:"center",justifyContent:"center",p:20,children:r.jsx(or,{})}):a.length?a.map(h=>r.jsx(rje,{workflow:h},h.workflow_id)):r.jsx(Yt,{fontSize:"sm",py:4,label:i(t?"nodes.noMatchingWorkflows":"nodes.noWorkflows"),icon:null})})]})},oje=()=>{const e=z(),t=I(N3),{t:n}=P(),s=u.useCallback(l=>{e(c_(l))},[e]),i=u.useCallback(()=>{e(c_(""))},[e]),o=u.useCallback(l=>{l.key==="Escape"&&i()},[i]),a=u.useCallback(l=>{s(l.target.value)},[s]);return r.jsxs(Vo,{children:[r.jsx(Ct,{placeholder:n("stylePresets.searchByName"),value:t,onKeyDown:o,onChange:a}),t&&t.length&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:r.jsx(Nt,{})})})]})},aje=u.memo(oje),lje=$e.enum(["opened_at","created_at","updated_at","name"]),cje=e=>lje.safeParse(e).success,uje=$e.enum(["ASC","DESC"]),dje=e=>uje.safeParse(e).success,hje=()=>{const e=ce(PQ),{t}=P(),n=I(F3),s=I(B3),i=u.useMemo(()=>[{value:"opened_at",label:t("workflows.opened")},{value:"created_at",label:t("workflows.created")},{value:"updated_at",label:t("workflows.updated")},{value:"name",label:t("workflows.name")}],[t]),o=u.useMemo(()=>[{value:"ASC",label:t("workflows.ascending")},{value:"DESC",label:t("workflows.descending")}],[t]),a=z(),l=u.useMemo(()=>e?i.filter(p=>p.value!=="opened_at"):i,[e,i]),c=u.useCallback(p=>{!cje(p==null?void 0:p.value)||p.value===n||a(EQ(p.value))},[n,a]),d=u.useMemo(()=>l.find(p=>p.value===n)||l[0],[n,l]),h=u.useCallback(p=>{!dje(p==null?void 0:p.value)||p.value===s||a(LQ(p.value))},[s,a]),f=u.useMemo(()=>o.find(p=>p.value===s),[s,o]);return r.jsxs(Vn,{placement:"bottom",children:[r.jsx(Yn,{children:r.jsx(ae,{tooltip:`Sorting by ${d==null?void 0:d.label} ${f==null?void 0:f.label}`,"aria-label":"Sort Workflow Library",icon:s==="ASC"?r.jsx(Goe,{}):r.jsx(zoe,{}),variant:"ghost"})}),r.jsx(Gn,{children:r.jsx(Xn,{children:r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(Z,{orientation:"horizontal",gap:1,children:[r.jsx(te,{children:t("common.orderBy")}),r.jsx(Fe,{value:d,options:l,onChange:c})]}),r.jsxs(Z,{orientation:"horizontal",gap:1,children:[r.jsx(te,{children:t("common.direction")}),r.jsx(Fe,{value:f,options:o,onChange:h})]})]})})})]})},qV=u.memo(()=>{const e=ce($3);return r.jsxs(T,{w:"full",h:"full",flexDir:"column",gap:2,padding:3,layerStyle:"second",borderRadius:"base",children:[r.jsxs(T,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[r.jsx(aje,{}),r.jsx(hje,{}),r.jsx(Uwe,{})]}),r.jsx(ke,{position:"relative",w:"full",h:"full",children:r.jsx(Nn,{children:e.map(t=>r.jsx(ije,{category:t},t))})})]})});qV.displayName="WorkflowListMenu";const fje=()=>{const e=z(),t=I(uo),{t:n}=P(),s=u.useCallback(o=>{o.stopPropagation(),e(gu("edit"))},[e]),i=u.useCallback(o=>{o.stopPropagation(),e(gu("view"))},[e]);return r.jsxs(T,{justifyContent:"flex-end",children:[t==="view"&&r.jsx(ae,{"aria-label":n("nodes.editMode"),tooltip:n("nodes.editMode"),onClick:s,icon:r.jsx(bp,{}),variant:"outline",size:"sm"}),t==="edit"&&r.jsx(ae,{"aria-label":n("nodes.viewMode"),tooltip:n("nodes.viewMode"),onClick:i,icon:r.jsx(yp,{}),variant:"outline",size:"sm"})]})},[KV]=eC(!1),zj=()=>{const{t:e}=P(),t=z(),n=KV(),s=I(lp),i=u.useCallback(()=>{t(V3()),t(gu("edit")),fe({id:"NEW_WORKFLOW_CREATED",title:e("workflows.newWorkflowCreated"),status:"success"}),n.close()},[n,t,e]),o=u.useCallback(()=>{if(!s){i();return}n.open()},[n,i,s]);return{createImmediate:i,createWithDialog:o}},ZV=u.memo(()=>{wt("NewWorkflowConfirmationAlertDialog");const{t:e}=P(),t=KV(),n=zj();return r.jsx(ti,{isOpen:t.isOpen,onClose:t.close,title:e("nodes.newWorkflow"),acceptCallback:n.createImmediate,useInert:!1,children:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(K,{children:e("nodes.newWorkflowDesc")}),r.jsx(K,{variant:"subtext",children:e("nodes.newWorkflowDesc2")})]})})});ZV.displayName="NewWorkflowConfirmationAlertDialog";const wy=e=>!!e.id,Hj=()=>{const{t:e}=P(),t=z(),[n,s]=zre(),[i,o]=YP(),a=Gf(),l=u.useRef();return{saveWorkflow:u.useCallback(async()=>{const d=Va.get();if(d){l.current=a({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{if(wy(d))await n(d).unwrap(),t(Gwe());else{const h=await i(d).unwrap();t(G3(h.workflow.id))}t(z3()),a.update(l.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{!a.isActive(`auth-error-toast-${jl.endpoints.createWorkflow.name}`)&&!a.isActive(`auth-error-toast-${jl.endpoints.updateWorkflow.name}`)?a.update(l.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0}):a.close(l.current)}}},[n,t,a,e,i]),isLoading:s.isLoading||o.isLoading,isError:s.isError||o.isError}},pje=()=>{const{t:e}=P(),{onOpen:t}=fd(),{saveWorkflow:n}=Hj(),s=u.useCallback(i=>{i.stopPropagation();const o=Va.get();o&&(wy(o)?n():t())},[t,n]);return r.jsx(ae,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:r.jsx(Ui,{}),onClick:s,pointerEvents:"auto",variant:"outline",size:"sm"})},gje=u.memo(pje),mje=()=>{const e=I($C),t=I(DQ),n=I(uo),s=zj(),{t:i}=P(),o=u.useCallback(a=>{a.stopPropagation(),s.createWithDialog()},[s]);return r.jsxs(T,{w:"full",alignItems:"center",gap:2,minW:0,children:[e?r.jsx(Le,{label:t,children:r.jsx(K,{colorScheme:"invokeBlue",fontWeight:"semibold",fontSize:"md",justifySelf:"flex-start",children:e})}):r.jsx(K,{fontSize:"sm",fontWeight:"semibold",color:"base.300",children:i("workflows.chooseWorkflowFromLibrary")}),r.jsx(nt,{}),n==="edit"&&r.jsx(gje,{}),r.jsx(fje,{}),r.jsx(ae,{onClick:o,variant:"outline",size:"sm","aria-label":i("nodes.newWorkflow"),tooltip:i("nodes.newWorkflow"),icon:r.jsx(uf,{})})]})},yje={bg:"base.750"},vje=()=>{const e=gp(),{t}=P();return r.jsxs(T,{onClick:e.toggle,backgroundColor:"base.800",justifyContent:"space-between",alignItems:"center",py:2,px:3,borderRadius:"base",gap:2,role:"button",_hover:yje,transitionProperty:"background-color",transitionDuration:"normal",w:"full",cursor:"pointer",children:[r.jsx(mje,{}),r.jsx(ae,{"aria-label":t("stylePresets.viewList"),variant:"ghost",icon:r.jsx(Pr,{}),size:"sm"})]})},bje=()=>{const e=I(uo),t=gp();return r.jsxs(T,{w:"full",h:"full",gap:2,flexDir:"column",children:[r.jsx(vje,{}),r.jsx(T,{w:"full",h:"full",position:"relative",children:r.jsxs(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[t.isOpen&&r.jsx(qV,{}),e==="view"&&r.jsx(zV,{}),e==="edit"&&r.jsx(GV,{})]})})]})},xje=u.memo(bje),YV=u.memo(e=>{const{t}=P(),n=Ap(),s=w1(),i=Ma();return r.jsx(ae,{size:"lg",isDisabled:i?n.isDisabled:s.isDisabled,isLoading:i?n.isLoading:s.isLoading,"aria-label":t(i?"queue.clear":"queue.cancel"),tooltip:t(i?"queue.clearTooltip":"queue.cancelTooltip"),icon:i?r.jsx(Xr,{}):r.jsx(Nt,{}),colorScheme:"error",onClick:i?n.openDialog:s.cancelQueueItem,"data-testid":t(i?"queue.clear":"queue.cancel")})});YV.displayName="ClearQueueIconButton";const XV=u.memo(({targetRef:e})=>{const[t,n]=u.useState(null),s=ce(Jb),{queueSize:i}=ei(void 0,{selectFromResult:o=>({queueSize:o.data?o.data.queue.pending+o.data.queue.in_progress:0})});return u.useEffect(()=>{if(!e.current)return;const o=e.current,a=o.parentElement;if(!a)return;const l=()=>{if(!Jb.get())return;const{x:d,y:h}=o.getBoundingClientRect();n({x:`${d-7}px`,y:`${h-5}px`})},c=new ResizeObserver(l);return c.observe(a),l(),()=>{c.disconnect()}},[e]),i===0||!t||!s?null:r.jsx(Uf,{children:r.jsx(os,{pos:"absolute",insetInlineStart:t.x,insetBlockStart:t.y,colorScheme:"invokeYellow",zIndex:"docked",shadow:"dark-lg",userSelect:"none",children:i})})});XV.displayName="QueueCountBadge";const QV=()=>{const{t:e}=P(),t=ce(An),{data:n}=ei(),[s,{isLoading:i}]=e3({fixedCacheKey:"pauseProcessor"}),o=u.useMemo(()=>!!(n!=null&&n.processor.is_started),[n==null?void 0:n.processor.is_started]),a=u.useCallback(async()=>{if(o)try{await s().unwrap(),fe({id:"PAUSE_SUCCEEDED",title:e("queue.pauseSucceeded"),status:"success"})}catch{fe({id:"PAUSE_FAILED",title:e("queue.pauseFailed"),status:"error"})}},[o,s,e]),l=u.useMemo(()=>!t||!o,[t,o]);return{pauseProcessor:a,isLoading:i,isStarted:o,isDisabled:l}},JV=()=>{const e=ce(An),{data:t}=ei(),{t:n}=P(),[s,{isLoading:i}]=JM({fixedCacheKey:"resumeProcessor"}),o=u.useMemo(()=>!!(t!=null&&t.processor.is_started),[t==null?void 0:t.processor.is_started]),a=u.useCallback(async()=>{if(!o)try{await s().unwrap(),fe({id:"PROCESSOR_RESUMED",title:n("queue.resumeSucceeded"),status:"success"})}catch{fe({id:"PROCESSOR_RESUME_FAILED",title:n("queue.resumeFailed"),status:"error"})}},[o,s,n]),l=u.useMemo(()=>!e||o,[e,o]);return{resumeProcessor:a,isLoading:i,isStarted:o,isDisabled:l}},eG=u.memo(()=>{const e=u.useRef(null),t=z(),{t:n}=P(),s=un("pauseQueue"),i=un("resumeQueue"),o=gR(),a=w1(),l=Ap(),{resumeProcessor:c,isLoading:d,isDisabled:h}=JV(),{pauseProcessor:f,isLoading:p,isDisabled:g}=QV(),m=u.useCallback(()=>{t(bt("queue"))},[t]);return r.jsxs(r.Fragment,{children:[r.jsxs(Qt,{placement:"bottom-end",children:[r.jsx(Jt,{ref:e,as:ae,size:"lg","aria-label":"Queue Actions Menu",icon:r.jsx(Loe,{})}),r.jsxs(kt,{children:[r.jsx(Cr,{title:n("common.new"),children:r.jsx(nj,{})}),r.jsxs(Cr,{title:n("queue.queue"),children:[r.jsx(he,{isDestructive:!0,icon:r.jsx(Nt,{}),onClick:a.cancelQueueItem,isLoading:a.isLoading,isDisabled:a.isDisabled,children:n("queue.cancelTooltip")}),r.jsx(he,{isDestructive:!0,icon:r.jsx(rae,{}),onClick:o.openDialog,isLoading:o.isLoading,isDisabled:o.isDisabled,children:n("queue.cancelAllExceptCurrentTooltip")}),r.jsx(he,{isDestructive:!0,icon:r.jsx(Xr,{}),onClick:l.openDialog,isLoading:l.isLoading,isDisabled:l.isDisabled,children:n("queue.clearTooltip")}),i&&r.jsx(he,{icon:r.jsx(zE,{}),onClick:c,isLoading:d,isDisabled:h,children:n("queue.resumeTooltip")}),s&&r.jsx(he,{icon:r.jsx(GE,{}),onClick:f,isLoading:p,isDisabled:g,children:n("queue.pauseTooltip")}),r.jsx(he,{icon:r.jsx(DE,{}),onClick:m,children:n("queue.openQueue")})]})]})]}),r.jsx(XV,{targetRef:e})]})});eG.displayName="QueueActionsMenuButton";const Cje=e=>({bg:"base.700",w:"72px",cursor:"pointer","&[data-checked]":{".thumb":{left:`calc(100% - ${e})`,transform:"translateX(-100%)",bg:"invokeGreen.300"},".unchecked-icon":{color:"base.50",opacity:.4},".checked-icon":{color:"base.900",opacity:1}},"&[data-disabled]":{bg:"base.700",".thumb":{bg:"base.500"},".unchecked-icon":{color:"base.800"},".checked-icon":{color:"base.800"}},".thumb":{transition:"left 0.1s ease-in-out, transform 0.1s ease-in-out",left:e,transform:"translateX(0)",bg:"invokeBlue.400",shadow:"md"},".unchecked-icon":{color:"base.900",opacity:1},".checked-icon":{color:"base.50",opacity:.4}}),tG=u.memo(()=>{const{t:e}=P(),t=z(),n=I(VC),s=I(Dn),i=MC("space",1),o=u.useMemo(()=>Cje(i),[i]),a=u.useCallback(h=>{t(nm(h.target.checked))},[t]),{getCheckboxProps:l,getInputProps:c,htmlProps:d}=RQ({onChange:a,isChecked:n,isDisabled:s});return r.jsxs(Vn,{trigger:"hover",children:[r.jsx(Yn,{children:r.jsx($o.label,{...d,children:r.jsxs(T,{position:"relative",borderRadius:"base",alignItems:"center",justifyContent:"space-between",h:"full",p:i,gap:i,sx:o,...l(),children:[r.jsx("input",{...c(),hidden:!0}),r.jsx(ke,{className:"thumb",position:"absolute",borderRadius:"base",w:10,top:i,bottom:i}),r.jsx(T,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:r.jsx(pt,{className:"unchecked-icon",w:6,h:6,as:mu,"aria-label":e("controlLayers.sendToGallery")})}),r.jsx(T,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:r.jsx(pt,{className:"checked-icon",w:6,h:6,as:xS,"aria-label":e("controlLayers.sendToCanvas")})})]})})}),r.jsx(Uf,{children:r.jsxs(Gn,{maxW:296,p:2,bg:"base.200",color:"base.800",children:[r.jsx(_i,{bg:"base.200",left:n?"18px !important":"-18px !important",transitionProperty:"all",transitionDuration:"0.2s"}),r.jsx(Xn,{children:r.jsx(nG,{})})]})})]})});tG.displayName="SendToToggle";const nG=u.memo(()=>{const{t:e}=P(),t=I(VC);return I(Dn)?r.jsxs(T,{flexDir:"column",children:[r.jsx(K,{fontWeight:"semibold",children:e("controlLayers.sendingToCanvas")}),r.jsx(K,{fontWeight:"normal",children:r.jsx(Xt,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:r.jsx(sG,{})}})})]}):r.jsxs(T,{flexDir:"column",children:[r.jsx(K,{fontWeight:"semibold",children:e(t?"controlLayers.sendToCanvas":"controlLayers.sendToGallery")}),r.jsx(K,{fontWeight:"normal",children:e(t?"controlLayers.sendToCanvasDesc":"controlLayers.sendToGalleryDesc")})]})});nG.displayName="TooltipContent";const sG=u.memo(e=>{const t=z(),n=u.useCallback(()=>{t(bt("canvas")),t(Ys("layers")),Qc.set(!1)},[t]);return r.jsx(ye,{onClick:n,size:"sm",variant:"link",color:"base.800",_hover:{color:"base.900",textDecoration:"underline"},children:e.children})});sG.displayName="ActivateCanvasButton";const Sje=()=>{const{t:e}=P(),t=lw(),{data:n}=ei(),s=ce(An),i=ce(Io),o=u.useMemo(()=>i?(i.percentage??0)*100:0,[i]),a=u.useMemo(()=>!s||!(n!=null&&n.queue.in_progress)?!1:!i||i.percentage===null,[s,i,n==null?void 0:n.queue.in_progress]),l=u.useMemo(()=>t==="canvas"?"invokeGreen":t==="gallery"?"invokeBlue":"base",[t]);return r.jsx(rM,{value:o,"aria-label":e("accessibility.invokeProgressBar"),isIndeterminate:a,h:2,w:"full",colorScheme:l})},wje=u.memo(Sje),rG=u.memo(()=>{const e=I(GC),t=I(OQ),n=z(),s=u.useCallback(i=>{n(NQ(i))},[n]);return r.jsx(Ve,{feature:"paramIterations",children:r.jsx(Ae,{step:t.coarseStep,fineStep:t.fineStep,min:1,max:999,onChange:s,value:e,defaultValue:1,pos:"absolute",insetInlineEnd:0,h:"full",ps:0,w:"72px",flexShrink:0,variant:"iterations"})})});rG.displayName="QueueIterationsNumberInput";const iG=({prepend:e,children:t,...n})=>r.jsx(Le,{label:r.jsx(oG,{prepend:e}),maxW:512,...n,children:t}),oG=u.memo(({prepend:e=!1})=>{const t=I(On);return t==="canvas"?r.jsx(aG,{prepend:e}):t==="workflows"?r.jsx(cG,{prepend:e}):t==="upscaling"?r.jsx(lG,{prepend:e}):null});oG.displayName="TooltipContent";const aG=u.memo(({prepend:e=!1})=>{const t=ce(An),n=oS(),s=ce((n==null?void 0:n.stateApi.$isFiltering)??Bi),i=ce((n==null?void 0:n.stateApi.$isTransforming)??Bi),o=ce((n==null?void 0:n.stateApi.$isRasterizing)??Bi),a=ce((n==null?void 0:n.stateApi.$isSegmenting)??Bi),l=ce((n==null?void 0:n.compositor.$isBusy)??Bi),c=u.useMemo(()=>RT({isConnected:t,canvasIsFiltering:s,canvasIsTransforming:i,canvasIsRasterizing:o,canvasIsSelectingObject:a,canvasIsCompositing:l}),[t,l,s,o,a,i]),d=u.useMemo(()=>FQ({isConnected:t,canvasIsFiltering:s,canvasIsTransforming:i,canvasIsRasterizing:o,canvasIsSelectingObject:a,canvasIsCompositing:l}),[t,l,s,o,a,i]),h=I(c),f=I(d);return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(jy,{isReady:h,prepend:e}),r.jsx(Wj,{}),f.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Mf,{}),r.jsx(ky,{reasons:f})]}),r.jsx(Mf,{}),r.jsx(hG,{})]})});aG.displayName="CanvasTabTooltipContent";const lG=u.memo(({prepend:e=!1})=>{const t=ce(An),n=u.useMemo(()=>OT({isConnected:t}),[t]),s=u.useMemo(()=>$Q({isConnected:t}),[t]),i=I(n),o=I(s);return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(jy,{isReady:i,prepend:e}),r.jsx(Wj,{}),o.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Mf,{}),r.jsx(ky,{reasons:o})]})]})});lG.displayName="UpscaleTabTooltipContent";const cG=u.memo(({prepend:e=!1})=>{const t=ce(An),n=ce(xn),s=u.useMemo(()=>NT({isConnected:t,templates:n}),[t,n]),i=u.useMemo(()=>BQ({isConnected:t,templates:n}),[t,n]),o=I(s),a=I(i);return r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(jy,{isReady:o,prepend:e}),r.jsx(uG,{}),a.length>0&&r.jsxs(r.Fragment,{children:[r.jsx(Mf,{}),r.jsx(ky,{reasons:a})]})]})});cG.displayName="WorkflowsTabTooltipContent";const Wj=u.memo(()=>{const{t:e}=P(),t=I(VQ),n=I(GC),s=u.useMemo(()=>{const i=Math.min(t*n,1e4),o=e("queue.prompts",{count:t}),a=e("queue.iterations",{count:n}),l=e("queue.generations",{count:i});return`${t} ${o} × ${n} ${a} -> ${i} ${l}`.toLowerCase()},[n,t,e]);return r.jsx(K,{children:s})});Wj.displayName="QueueCountPredictionCanvasOrUpscaleTab";const uG=u.memo(()=>{const{t:e}=P(),t=I(GQ),n=I(GC),s=u.useMemo(()=>{const i=e("queue.iterations",{count:n});if(t==="NO_BATCHES"){const l=Math.min(1e4,n),c=e("queue.generations",{count:l});return`${n} ${i} -> ${l} ${c}`.toLowerCase()}if(t==="EMPTY_BATCHES")return e("parameters.invoke.invalidBatchConfigurationCannotCalculate");const o=Math.min(t*n,1e4),a=e("queue.generations",{count:o});return`${t} ${e("queue.batchSize")} × ${n} ${i} -> ${o} ${a}`.toLowerCase()},[t,n,e]);return r.jsx(K,{children:s})});uG.displayName="QueueCountPredictionWorkflowsTab";const jy=u.memo(({isReady:e,prepend:t})=>{const{t:n}=P(),s=I(q0),[i,o]=rC(V0),a=u.useMemo(()=>o.isLoading?n("queue.enqueueing"):n(s?"dynamicPrompts.loading":e?t?"queue.queueFront":"queue.queueBack":"queue.notReady"),[o.isLoading,s,e,t,n]);return r.jsx(K,{fontWeight:"semibold",children:a})});jy.displayName="IsReadyText";const ky=u.memo(({reasons:e})=>r.jsx(ki,{children:e.map((t,n)=>r.jsx(dG,{reason:t},`${t.content}.${n}`))}));ky.displayName="ReasonsList";const dG=u.memo(({reason:e})=>r.jsx(Gt,{children:r.jsxs("span",{children:[e.prefix&&r.jsxs(K,{as:"span",fontWeight:"semibold",children:[e.prefix,":"," "]}),r.jsx(K,{as:"span",children:e.content})]})}));dG.displayName="ReasonListItem";const Mf=u.memo(()=>r.jsx(Et,{opacity:.2,borderColor:"base.900"}));Mf.displayName="StyledDivider";const hG=u.memo(()=>{const{t:e}=P(),t=I(VC),n=I(Ar),s=Sp(n),i=u.useMemo(()=>e(t?"controlLayers.stagingOnCanvas":"parameters.invoke.addingImagesTo"),[t,e]),o=u.useMemo(()=>t?e("queue.canvas"):s||e("boards.uncategorized"),[s,t,e]);return r.jsxs(K,{fontStyle:"oblique 10deg",children:[i," ",r.jsx(K,{as:"span",fontWeight:"semibold",children:o})]})});hG.displayName="AddingToText";const P8="Invoke",fG=u.memo(()=>{const e=aS(),t=Ma(),n=I(q0);return r.jsxs(T,{pos:"relative",w:"200px",children:[r.jsx(rG,{}),r.jsx(iG,{prepend:t,children:r.jsxs(ye,{onClick:t?e.queueFront:e.queueBack,isLoading:e.isLoading||n,loadingText:P8,isDisabled:e.isDisabled,rightIcon:t?r.jsx(P1,{}):r.jsx(E1,{}),variant:"solid",colorScheme:"invokeYellow",size:"lg",w:"calc(100% - 60px)",flexShrink:0,justifyContent:"space-between",spinnerPlacement:"end",children:[r.jsx("span",{children:P8}),r.jsx(nt,{})]})})]})});fG.displayName="InvokeQueueBackButton";const jje=()=>{const e=I(On);return r.jsxs(T,{w:"full",position:"relative",borderRadius:"base",gap:2,flexDir:"column",children:[r.jsxs(T,{gap:2,children:[r.jsx(fG,{}),r.jsx(nt,{}),e==="canvas"&&r.jsx(zr,{children:r.jsx(tG,{})}),r.jsx(eG,{}),r.jsx(YV,{})]}),r.jsx(wje,{})]})},kje=u.memo(jje),_je=e=>{const{t}=P();return r.jsx(T,{pos:"absolute",transform:"translate(0, -50%)",minW:8,top:"50%",insetInlineEnd:2,children:r.jsx(Le,{label:t("accessibility.toggleRightPanel"),placement:"start",children:r.jsx(ae,{"aria-label":t("accessibility.toggleRightPanel"),onClick:e.panelApi.toggle,icon:r.jsx(Aoe,{}),h:48})})})},Ije=u.memo(_je),pG=u.memo(()=>{const{t:e}=P(),t=Jl("bbox"),n=qo("bbox"),s=Lt();return Ee({id:"selectBboxTool",category:"canvas",callback:t,options:{enabled:!n&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Le,{label:`${e("controlLayers.tool.bbox")} (C)`,placement:"end",children:r.jsx(ae,{"aria-label":`${e("controlLayers.tool.bbox")} (C)`,icon:r.jsx(La,{}),colorScheme:n?"invokeBlue":"base",variant:"solid",onClick:t})})});pG.displayName="ToolBboxButton";const gG=u.memo(()=>{const{t:e}=P(),t=qo("brush"),n=Jl("brush"),s=Lt();return Ee({id:"selectBrushTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Le,{label:`${e("controlLayers.tool.brush")} (B)`,placement:"end",children:r.jsx(ae,{"aria-label":`${e("controlLayers.tool.brush")} (B)`,icon:r.jsx(xS,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});gG.displayName="ToolBrushButton";const mG=u.memo(()=>{const{t:e}=P(),t=qo("colorPicker"),n=Jl("colorPicker"),s=Lt();return Ee({id:"selectColorPickerTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),r.jsx(Le,{label:`${e("controlLayers.tool.colorPicker")} (I)`,placement:"end",children:r.jsx(ae,{"aria-label":`${e("controlLayers.tool.colorPicker")} (I)`,icon:r.jsx(joe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});mG.displayName="ToolColorPickerButton";const yG=u.memo(()=>{const{t:e}=P(),t=qo("move"),n=Jl("move"),s=Lt();return Ee({id:"selectMoveTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Le,{label:`${e("controlLayers.tool.move")} (V)`,placement:"end",children:r.jsx(ae,{"aria-label":`${e("controlLayers.tool.move")} (V)`,icon:r.jsx(voe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});yG.displayName="ToolMoveButton";const vG=u.memo(()=>{const{t:e}=P(),t=qo("rect"),n=Jl("rect"),s=Lt();return Ee({id:"selectRectTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Le,{label:`${e("controlLayers.tool.rectangle")} (U)`,placement:"end",children:r.jsx(ae,{"aria-label":`${e("controlLayers.tool.rectangle")} (U)`,icon:r.jsx(Ooe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});vG.displayName="ToolRectButton";const bG=u.memo(()=>{const{t:e}=P(),t=qo("eraser"),n=Jl("eraser"),s=Lt();return Ee({id:"selectEraserTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),r.jsx(Le,{label:`${e("controlLayers.tool.eraser")} (E)`,placement:"end",children:r.jsx(ae,{"aria-label":`${e("controlLayers.tool.eraser")} (E)`,icon:r.jsx(Coe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});bG.displayName="ToolEraserButton";const xG=u.memo(()=>{const{t:e}=P(),t=qo("view"),n=Jl("view"),s=Lt();return Ee({id:"selectViewTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),r.jsx(Le,{label:`${e("controlLayers.tool.view")} (H)`,placement:"end",children:r.jsx(ae,{"aria-label":`${e("controlLayers.tool.view")} (H)`,icon:r.jsx(_oe,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});xG.displayName="ToolViewButton";const Aje=()=>r.jsx(r.Fragment,{children:r.jsxs(as,{isAttached:!0,orientation:"vertical",children:[r.jsx(gG,{}),r.jsx(bG,{}),r.jsx(vG,{}),r.jsx(yG,{}),r.jsx(xG,{}),r.jsx(pG,{}),r.jsx(mG,{})]})}),Tje=e=>{const{t}=P(),n=aS(),s=Ma(),i=I(On),o=Lt(),a=Ap(),{data:l}=ei(),c=w1(),d=u.useMemo(()=>{const h=((l==null?void 0:l.queue.in_progress)??0)>0;return!n.isDisabled&&h?r.jsx(pt,{boxSize:6,as:goe,animation:h1}):s?r.jsx(P1,{}):r.jsx(E1,{})},[n.isDisabled,l==null?void 0:l.queue.in_progress,s]);return r.jsxs(T,{pos:"absolute",transform:"translate(0, -50%)",top:"50%",insetInlineStart:2,direction:"column",gap:2,children:[i==="canvas"&&!o.isOpen&&r.jsx(zr,{children:r.jsx(Aje,{})}),r.jsxs(as,{orientation:"vertical",h:48,children:[r.jsx(Le,{label:t("accessibility.toggleLeftPanel"),placement:"end",children:r.jsx(ae,{"aria-label":t("accessibility.toggleLeftPanel"),onClick:e.panelApi.toggle,icon:r.jsx(Voe,{}),flexGrow:1})}),r.jsx(iG,{prepend:s,placement:"end",children:r.jsx(ae,{"aria-label":t("queue.queueBack"),onClick:s?n.queueFront:n.queueBack,isLoading:n.isLoading,isDisabled:n.isDisabled,icon:d,colorScheme:"invokeYellow",flexGrow:1})}),r.jsx(Le,{label:t("queue.cancelTooltip"),placement:"end",children:r.jsx(ae,{isDisabled:c.isDisabled,isLoading:c.isLoading,"aria-label":t("queue.cancelTooltip"),icon:r.jsx(Nt,{}),onClick:c.cancelQueueItem,colorScheme:"error",flexGrow:1})}),r.jsx(Le,{label:t("queue.clearTooltip"),placement:"end",children:r.jsx(ae,{isDisabled:a.isDisabled,isLoading:a.isLoading,"aria-label":t("queue.clearTooltip"),icon:r.jsx(Xr,{}),colorScheme:"error",onClick:a.openDialog,"data-testid":t("queue.clear"),flexGrow:1})})]})]})},Mje=u.memo(Tje),Wp=({label:e})=>r.jsx(K,{variant:"subtext",fontWeight:"semibold",pos:"absolute",top:1,left:2,children:e}),Up=u.memo(e=>r.jsx(T,{pos:"absolute",insetBlockStart:0,insetInlineEnd:0,flexDir:"column",p:2,gap:2,alignItems:"center",justifyContent:"center",children:e.children}));Up.displayName="PromptOverlayButtonWrapper";const Pje=(e,t)=>{if(!t||!t.length)return["",e,""];if(!t.includes(gl))return["",`${e} `,t];const[n,...s]=t.split(gl);return[n||"",e,s.join(gl)||""]},CG=({presetPrompt:e,prompt:t,label:n})=>{const s=z(),{t:i}=P(),o=u.useMemo(()=>Pje(t,e),[e,t]),a=u.useCallback(()=>{s(rm(!1))},[s]);return r.jsx(ke,{position:"absolute",top:0,bottom:0,left:0,right:0,layerStyle:"second",borderRadius:"base",children:r.jsxs(T,{flexDir:"column",onClick:a,justifyContent:"space-between",h:"full",borderWidth:1,borderTopWidth:24,borderColor:"transparent",paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,children:[r.jsx(Wp,{label:n}),r.jsx(T,{overflow:"scroll",children:r.jsx(K,{w:"full",lineHeight:"short",children:o.map((l,c)=>r.jsx(K,{as:"span",color:c===1?"white":"base.200",fontWeight:c===1?"semibold":"normal",children:l},c))})}),r.jsx(Le,{label:i("stylePresets.viewModeTooltip"),children:r.jsx(T,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,alignItems:"center",justifyContent:"center",p:2,bg:"base.900",opacity:.8,backgroundClip:"border-box",borderBottomStartRadius:"base",children:r.jsx(pt,{as:yp,color:"base.500",boxSize:4})})})]})})},SG=u.memo(()=>{var m;const e=z(),t=I(zQ),n=I(zC),s=I(Bf),{activeStylePreset:i}=cp(void 0,{selectFromResult:({data:y})=>{let x=null;return y&&(x=y.find(C=>C.id===s)),{activeStylePreset:x}}}),o=u.useRef(null),{t:a}=P(),l=u.useCallback(y=>{e(Q2(y))},[e]),{onChange:c,isOpen:d,onClose:h,onOpen:f,onSelect:p,onKeyDown:g}=ud({prompt:t,textareaRef:o,onChange:l});return r.jsx(nc,{isOpen:d,onClose:h,onSelect:p,width:(m=o.current)==null?void 0:m.clientWidth,children:r.jsxs(ke,{pos:"relative",w:"full",children:[r.jsx(Zn,{id:"negativePrompt",name:"negativePrompt",ref:o,value:t,onChange:c,onKeyDown:g,fontSize:"sm",variant:"darkFilled",minH:28,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Up,{children:r.jsx(tc,{isOpen:d,onOpen:f})}),r.jsx(Wp,{label:a("parameters.negativePromptPlaceholder")}),n&&r.jsx(CG,{prompt:t,presetPrompt:(i==null?void 0:i.preset_data.negative_prompt)||"",label:`${a("parameters.negativePromptPlaceholder")} (${a("stylePresets.preview")})`})]})})});SG.displayName="ParamNegativePrompt";const Eje={svg:{animation:h1}},wG=u.memo(()=>{const{t:e}=P(),t=I(q0),n=I(YT),{isOpen:s,onOpen:i}=gL();return r.jsx(Le,{label:e(t?"dynamicPrompts.loading":"dynamicPrompts.showDynamicPrompts"),children:r.jsx(ae,{size:"sm",variant:"promptOverlay",isDisabled:s,"aria-label":e("dynamicPrompts.showDynamicPrompts"),icon:r.jsx(doe,{}),onClick:i,sx:t?Eje:void 0,colorScheme:n&&!t?"error":"base"})})});wG.displayName="ShowDynamicPromptsPreviewButton";const jG=u.memo(()=>{const e=I(HQ),t=z(),{t:n}=P(),s=u.useCallback(()=>{t(Bb(!e))},[t,e]),i=u.useMemo(()=>n(e?"sdxl.concatPromptStyle":"sdxl.freePromptStyle"),[e,n]);return r.jsx(Le,{label:i,children:r.jsx(ae,{"aria-label":i,onClick:s,icon:e?r.jsx(Poe,{size:14}):r.jsx(Eoe,{size:14}),variant:"promptOverlay",fontSize:12,px:.5})})});jG.displayName="SDXLConcatButton";const kG=u.memo(()=>{var C;const e=z(),t=I(WQ),n=I(Fl),s=I(zC),i=I(Bf),{activeStylePreset:o}=cp(void 0,{selectFromResult:({data:v})=>{let b=null;return v&&(b=v.find(S=>S.id===i)),{activeStylePreset:b}}}),a=u.useRef(null),{t:l}=P(),c=u.useCallback(v=>{e(X2(v))},[e]),{onChange:d,isOpen:h,onClose:f,onOpen:p,onSelect:g,onKeyDown:m,onFocus:y}=ud({prompt:t,textareaRef:a,onChange:c}),x=u.useCallback(v=>{y(),v.preventDefault()},[y]);return Ee({id:"focusPrompt",category:"app",callback:x,options:{preventDefault:!0,enableOnFormTags:["INPUT","SELECT","TEXTAREA"]},dependencies:[x]}),r.jsx(nc,{isOpen:h,onClose:f,onSelect:g,width:(C=a.current)==null?void 0:C.clientWidth,children:r.jsxs(ke,{pos:"relative",children:[r.jsx(Zn,{id:"prompt",name:"prompt",ref:a,value:t,onChange:d,minH:40,onKeyDown:m,variant:"darkFilled",borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsxs(Up,{children:[r.jsx(tc,{isOpen:h,onOpen:p}),n==="sdxl"&&r.jsx(jG,{}),r.jsx(wG,{})]}),r.jsx(Wp,{label:l("parameters.positivePromptPlaceholder")}),s&&r.jsx(CG,{prompt:t,presetPrompt:(o==null?void 0:o.preset_data.positive_prompt)||"",label:`${l("parameters.positivePromptPlaceholder")} (${l("stylePresets.preview")})`})]})})});kG.displayName="ParamPositivePrompt";const _G=u.memo(()=>{var f;const e=z(),t=I(UQ),n=u.useRef(null),{t:s}=P(),i=u.useCallback(p=>{e(ST(p))},[e]),{onChange:o,isOpen:a,onClose:l,onOpen:c,onSelect:d,onKeyDown:h}=ud({prompt:t,textareaRef:n,onChange:i});return r.jsx(nc,{isOpen:a,onClose:l,onSelect:d,width:(f=n.current)==null?void 0:f.clientWidth,children:r.jsxs(ke,{pos:"relative",children:[r.jsx(Zn,{id:"prompt",name:"prompt",ref:n,value:t,onChange:o,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Up,{children:r.jsx(tc,{isOpen:a,onOpen:c})}),r.jsx(Wp,{label:s("sdxl.negStylePrompt")})]})})});_G.displayName="ParamSDXLNegativeStylePrompt";const IG=u.memo(()=>{var f;const e=z(),t=I(qQ),n=u.useRef(null),{t:s}=P(),i=u.useCallback(p=>{e(CT(p))},[e]),{onChange:o,isOpen:a,onClose:l,onOpen:c,onSelect:d,onKeyDown:h}=ud({prompt:t,textareaRef:n,onChange:i});return r.jsx(nc,{isOpen:a,onClose:l,onSelect:d,width:(f=n.current)==null?void 0:f.clientWidth,children:r.jsxs(ke,{pos:"relative",children:[r.jsx(Zn,{id:"prompt",name:"prompt",ref:n,value:t,onChange:o,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),r.jsx(Up,{children:r.jsx(tc,{isOpen:a,onOpen:c})}),r.jsx(Wp,{label:s("sdxl.posStylePrompt")})]})})});IG.displayName="ParamSDXLPositiveStylePrompt";const Lje=KQ(e=>{var s;const t=((s=e.model)==null?void 0:s.base)==="sdxl",n=e.shouldConcatPrompts;return t&&!n}),Uj=u.memo(()=>{const e=I(Lje),t=I(xi);return r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(kG,{}),e&&r.jsx(IG,{}),!t&&r.jsx(SG,{}),e&&r.jsx(_G,{})]})});Uj.displayName="Prompts";const Dje=()=>{const e=I(H3),t=I(W3),n=z(),{t:s}=P(),i=u.useCallback(o=>n(IT(o)),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramCFGRescaleMultiplier",children:r.jsx(te,{children:s("parameters.cfgRescaleMultiplier")})}),r.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:i,marks:!0}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:i})]})},Rje=u.memo(Dje),Oje=()=>{const e=z(),{t}=P(),n=I(ZQ),[s,{isLoading:i}]=Xl(),o=u.useCallback(h=>{h&&e(YQ(Rs.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Fa({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(te,{m:0,children:t("modelManager.clipEmbed")}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},Nje=u.memo(Oje),Fje=()=>{const e=z(),{t}=P(),n=I(XQ),[s,{isLoading:i}]=Xl(),o=u.useCallback(h=>{h&&e(QQ(Rs.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Fa({modelConfigs:s.filter(h=>I3(h)),onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(te,{m:0,children:t("modelManager.clipGEmbed")}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},Bje=u.memo(Fje),$je=()=>{const e=z(),{t}=P(),n=I(JQ),[s,{isLoading:i}]=Xl(),o=u.useCallback(h=>{h&&e(eJ(Rs.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Fa({modelConfigs:s.filter(h=>A3(h)),onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(te,{m:0,children:t("modelManager.clipLEmbed")}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},Vje=u.memo($je),Gje=()=>{const e=I(tJ),t=I(nJ),n=I(ip),s=z(),{t:i}=P(),o=u.useCallback(c=>{s(sJ(c))},[s]),a=u.useMemo(()=>n?og[n.base].maxClip:og["sd-1"].maxClip,[n]),l=u.useMemo(()=>n?og[n.base].markers:og["sd-1"].markers,[n]);return(n==null?void 0:n.base)==="sdxl"?null:r.jsxs(Z,{children:[r.jsx(Ve,{feature:"clipSkip",children:r.jsx(te,{children:i("parameters.clipSkip")})}),r.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:a,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:l}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:a,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},zje=u.memo(Gje),Hje=()=>{const e=z(),{t}=P(),n=I(rJ),[s,{isLoading:i}]=tw(),o=u.useCallback(h=>{h&&e(iJ(Rs.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=Fa({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(te,{m:0,children:t("modelManager.t5Encoder")}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},E8=u.memo(Hje),Wje=()=>{const{t:e}=P(),t=I(oJ),n=z(),s=u.useCallback(i=>{n(xT(i.target.checked))},[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"seamlessTilingXAxis",children:r.jsx(te,{children:e("parameters.seamlessXAxis")})}),r.jsx(it,{isChecked:t,onChange:s})]})},Uje=u.memo(Wje),qje=()=>{const{t:e}=P(),t=I(aJ),n=z(),s=u.useCallback(i=>{n(bT(i.target.checked))},[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"seamlessTilingYAxis",children:r.jsx(te,{children:e("parameters.seamlessYAxis")})}),r.jsx(it,{isChecked:t,onChange:s})]})},Kje=u.memo(qje),qj=u.memo(()=>{const e=I(lJ),t=I(HC),{t:n}=P(),s=z(),i=u.useCallback(o=>s(Y2(o)),[s]);return r.jsxs(Z,{flexGrow:1,children:[r.jsx(Ve,{feature:"paramSeed",children:r.jsx(te,{children:n("parameters.seed")})}),r.jsx(Ae,{step:1,min:U3,max:Nu,isDisabled:t,onChange:i,value:e,flexGrow:1,defaultValue:0})]})});qj.displayName="ParamSeedNumberInput";const Kj=u.memo(()=>{const e=z(),{t}=P(),n=I(HC),s=u.useCallback(i=>e(cJ(i.target.checked)),[e]);return r.jsxs(Z,{w:"min-content",children:[r.jsx(te,{m:0,children:t("common.random")}),r.jsx(it,{isChecked:n,onChange:s})]})});Kj.displayName="ParamSeedRandomize";const Zje=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),Zj=u.memo(()=>{const e=z(),t=I(HC),{t:n}=P(),s=u.useCallback(()=>e(Y2(Zje(U3,Nu))),[e]);return r.jsx(ye,{size:"sm",isDisabled:t,onClick:s,leftIcon:r.jsx($oe,{}),flexShrink:0,children:n("parameters.shuffle")})});Zj.displayName="ParamSeedShuffle";const Yje=()=>{const e=z(),{t}=P(),n=I(uJ),[s,{isLoading:i}]=pR(),o=u.useCallback(h=>{h&&e(dJ(Rs.parse(h)))},[e]),{options:a,value:l,onChange:c,noOptionsMessage:d}=hn({modelConfigs:s,onChange:o,selectedModel:n,isLoading:i});return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,minW:0,flexGrow:1,children:[r.jsx(Ve,{feature:"paramVAE",children:r.jsx(te,{m:0,children:t("modelManager.vae")})}),r.jsx(Fe,{value:l,options:a,onChange:c,noOptionsMessage:d})]})},Xje=u.memo(Yje),Qje=()=>{const e=z(),{t}=P(),n=I(Fl),s=I(q3),[i,{isLoading:o}]=Z1(),a=u.useCallback(p=>{const g=n===p.base;return!!!n||!g},[n]),l=u.useCallback(p=>{e(Nb(p?Rs.parse(p):null))},[e]),{options:c,value:d,onChange:h,noOptionsMessage:f}=hn({modelConfigs:i,onChange:l,selectedModel:s,isLoading:o,getIsDisabled:a});return r.jsxs(Z,{isDisabled:!c.length,isInvalid:!c.length,minW:0,flexGrow:1,children:[r.jsx(Ve,{feature:"paramVAE",children:r.jsx(te,{m:0,children:t("modelManager.vae")})}),r.jsx(Fe,{isClearable:!0,value:d,placeholder:d?d.value:t("models.defaultVAE"),options:c,onChange:h,noOptionsMessage:f})]})},Jje=u.memo(Qje),L8=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],eke=()=>{const{t:e}=P(),t=z(),n=I(K3),s=u.useCallback(o=>{Z3(o==null?void 0:o.value)&&t(hJ(o.value))},[t]),i=u.useMemo(()=>L8.find(o=>o.value===n),[n]);return r.jsxs(Z,{flexGrow:0,children:[r.jsx(Ve,{feature:"paramVAEPrecision",children:r.jsx(te,{m:0,children:e("modelManager.vaePrecision")})}),r.jsx(Fe,{value:i,options:L8,onChange:s})]})},tke=u.memo(eke),pd=e=>{const t=z(),n=u.useMemo(()=>ve(Mu,o=>o.accordions[e.id]??e.defaultIsOpen),[e]),s=I(n),i=u.useCallback(()=>{t(fJ({id:e.id,isOpen:!s}))},[e.id,t,s]);return{isOpen:s,onToggle:i}},nke={minW:"9.2rem"},ske={flexGrow:1},Yj=u.memo(()=>{const e=I(pJ),{currentData:t}=op(e??ws),n=I(On),s=I(xi),i=I($l),o=u.useMemo(()=>It([r1,xi],(h,f)=>{const p=[];if(f){if(t){let g=t.name;h.vaePrecision==="fp16"&&(g+=` ${h.vaePrecision}`),p.push(g)}}else{if(t){let g=t.name;h.vaePrecision==="fp16"&&(g+=` ${h.vaePrecision}`),p.push(g)}else h.vaePrecision==="fp16"&&p.push(`VAE ${h.vaePrecision}`);h.clipSkip&&p.push(`Skip ${h.clipSkip}`),h.cfgRescaleMultiplier&&p.push(`Rescale ${h.cfgRescaleMultiplier}`),(h.seamlessXAxis||h.seamlessYAxis)&&p.push("seamless"),n==="upscaling"&&!h.shouldRandomizeSeed&&p.push("Manual Seed")}return p}),[t,n]),a=I(o),{t:l}=P(),{isOpen:c,onToggle:d}=pd({id:`'advanced-settings-${n}`,defaultIsOpen:!1});return r.jsx(Bu,{label:l("accordions.advanced.title"),badges:a,isOpen:c,onToggle:d,children:r.jsxs(T,{gap:4,alignItems:"center",p:4,flexDir:"column","data-testid":"advanced-settings-accordion",children:[r.jsxs(T,{gap:4,w:"full",children:[s?r.jsx(Xje,{}):r.jsx(Jje,{}),!s&&!i&&r.jsx(tke,{})]}),n==="upscaling"?r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsx(qj,{}),r.jsx(Zj,{}),r.jsx(Kj,{})]}):r.jsxs(r.Fragment,{children:[!s&&!i&&r.jsxs(r.Fragment,{children:[r.jsxs(ms,{formLabelProps:nke,children:[r.jsx(zje,{}),r.jsx(Rje,{})]}),r.jsx(T,{gap:4,w:"full",children:r.jsxs(ms,{formLabelProps:ske,children:[r.jsx(Uje,{}),r.jsx(Kje,{})]})})]}),s&&r.jsxs(ms,{children:[r.jsx(E8,{}),r.jsx(Nje,{})]}),i&&r.jsxs(ms,{children:[r.jsx(E8,{}),r.jsx(Vje,{}),r.jsx(Bje,{})]})]})]})})});Yj.displayName="AdvancedSettingsAccordion";const rke=()=>{const e=z(),t=I(gJ),n=I(mJ),{t:s}=P(),i=u.useCallback(o=>{e(yJ(o))},[e]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"compositingCoherenceEdgeSize",children:r.jsx(te,{children:s("parameters.coherenceEdgeSize")})}),r.jsx(qe,{min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:i,marks:!0}),r.jsx(Ae,{min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:i})]})},ike=u.memo(rke),oke=()=>{const e=z(),t=I(vJ),{t:n}=P(),s=u.useCallback(i=>{e(bJ(i))},[e]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"compositingCoherenceMinDenoise",children:r.jsx(te,{children:n("parameters.coherenceMinDenoise")})}),r.jsx(qe,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s}),r.jsx(Ae,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s})]})},ake=u.memo(oke),lke=()=>{const e=z(),t=I(xJ),{t:n}=P(),s=u.useMemo(()=>[{label:n("parameters.gaussianBlur"),value:"Gaussian Blur"},{label:n("parameters.boxBlur"),value:"Box Blur"},{label:n("parameters.staged"),value:"Staged"}],[n]),i=u.useCallback(a=>{CJ(a==null?void 0:a.value)&&e(SJ(a.value))},[e]),o=u.useMemo(()=>s.find(a=>a.value===t),[t,s]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"compositingCoherenceMode",children:r.jsx(te,{children:n("parameters.coherenceMode")})}),r.jsx(Fe,{options:s,value:o,onChange:i})]})},cke=u.memo(lke),uke=()=>{const{t:e}=P(),t=z(),n=I(wJ),s=I(jJ),i=u.useCallback(o=>{t(kJ(o))},[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"compositingMaskBlur",children:r.jsx(te,{children:e("parameters.maskBlur")})}),r.jsx(qe,{value:n,onChange:i,min:s.sliderMin,max:s.sliderMax,defaultValue:s.initial,step:s.coarseStep,fineStep:s.fineStep,marks:!0}),r.jsx(Ae,{value:n,onChange:i,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},dke=u.memo(uke),hke=()=>{const{t:e}=P(),t=z(),n=I(up),{data:s}=Y3(),i=u.useMemo(()=>s?s.infill_methods.map(l=>({label:l,value:l})):[],[s]),o=u.useCallback(l=>{!l||!i.find(c=>c.value===l.value)||t(_J(l.value))},[t,i]),a=u.useMemo(()=>i.find(l=>l.value===n),[i,n]);return r.jsxs(Z,{isDisabled:i.length===0,children:[r.jsx(Ve,{feature:"infillMethod",children:r.jsx(te,{children:e("parameters.infillMethod")})}),r.jsx(Fe,{value:a,options:i,onChange:o})]})},fke=u.memo(hke),pke=()=>{const e=z(),t=I(IJ),n=I(up),{t:s}=P(),i=u.useCallback(o=>{e(AJ(o))},[e]);return r.jsx(T,{flexDir:"column",gap:4,children:r.jsxs(Z,{isDisabled:n!=="color",children:[r.jsx(te,{children:s("parameters.infillColorValue")}),r.jsx(ke,{w:"full",pt:2,pb:2,children:r.jsx(wN,{color:t,onChange:i})})]})})},gke=u.memo(pke),mke=()=>{const e=z(),t=I(up),n=I(TJ),s=I(MJ),{t:i}=P(),o=u.useCallback(a=>{e(PJ(a))},[e]);return r.jsxs(Z,{isDisabled:t!=="patchmatch",children:[r.jsx(Ve,{feature:"patchmatchDownScaleSize",children:r.jsx(te,{children:i("parameters.patchmatchDownScaleSize")})}),r.jsx(qe,{value:n,onChange:o,marks:!0,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep}),r.jsx(Ae,{value:n,onChange:o,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},yke=u.memo(mke),vke=()=>{const e=z(),t=I(EJ),n=I(LJ),s=I(up),{t:i}=P(),o=u.useCallback(a=>{e(DJ(a))},[e]);return r.jsxs(Z,{isDisabled:s!=="tile",children:[r.jsx(te,{children:i("parameters.tileSize")}),r.jsx(qe,{value:t,onChange:o,defaultValue:n.initial,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,marks:!0}),r.jsx(Ae,{value:t,onChange:o,defaultValue:n.initial,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep})]})},bke=u.memo(vke),xke=()=>{const e=I(up);return e==="tile"?r.jsx(bke,{}):e==="patchmatch"?r.jsx(yke,{}):e==="color"?r.jsx(gke,{}):null},Cke=u.memo(xke),D8={minW:"4.5rem"},AG=u.memo(()=>{const{t:e}=P(),{isOpen:t,onToggle:n}=pd({id:"compositing-settings",defaultIsOpen:!1});return r.jsx(Bu,{isOpen:t,onToggle:n,label:e("accordions.compositing.title"),children:r.jsxs(Vl,{variant:"collapse",children:[r.jsxs(Gl,{children:[r.jsx(Sn,{children:e("accordions.compositing.coherenceTab")}),r.jsx(Sn,{children:e("accordions.compositing.infillTab")})]}),r.jsxs(Lu,{children:[r.jsx(Pn,{children:r.jsx(T,{gap:4,p:4,flexDir:"column",children:r.jsxs(ms,{formLabelProps:D8,children:[r.jsx(cke,{}),r.jsx(ike,{}),r.jsx(ake,{}),r.jsx(dke,{})]})})}),r.jsx(Pn,{children:r.jsx(T,{gap:4,p:4,flexDir:"column",children:r.jsxs(ms,{formLabelProps:D8,children:[r.jsx(fke,{}),r.jsx(Cke,{})]})})})]})]})})});AG.displayName="CompositingSettingsAccordion";const Ske=[-1,0,1,2],TG=u.memo(e=>{const{lora:t}=e,n=z(),{data:s}=op(t.model.key),i=u.useCallback(l=>{n(RJ({id:t.id,weight:l}))},[n,t.id]),o=u.useCallback(()=>{n(OJ({id:t.id,isEnabled:!t.isEnabled}))},[n,t.id,t.isEnabled]),a=u.useCallback(()=>{n(NJ({id:t.id}))},[n,t.id]);return r.jsxs(FJ,{variant:"lora",children:[r.jsx(BJ,{children:r.jsxs(T,{alignItems:"center",justifyContent:"space-between",width:"100%",gap:2,children:[r.jsx(K,{noOfLines:1,wordBreak:"break-all",color:t.isEnabled?"base.200":"base.500",children:(s==null?void 0:s.name)??t.model.key.substring(0,8)}),r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(it,{size:"sm",onChange:o,isChecked:t.isEnabled}),r.jsx(ae,{"aria-label":"Remove LoRA",variant:"ghost",size:"sm",onClick:a,icon:r.jsx(Xr,{})})]})]})}),r.jsx(Ve,{feature:"loraWeight",children:r.jsxs($J,{children:[r.jsx(qe,{value:t.weight,onChange:i,min:-1,max:2,step:.01,marks:Ske,defaultValue:.75,isDisabled:!t.isEnabled}),r.jsx(Ae,{value:t.weight,onChange:i,min:-10,max:10,step:.01,w:20,flexShrink:0,defaultValue:.75,isDisabled:!t.isEnabled})]})})]})});TG.displayName="LoRACard";const wke=It(WC,e=>e.loras),MG=u.memo(()=>{const e=I(wke);return e.length?r.jsx(T,{flexWrap:"wrap",gap:2,children:e.map(t=>r.jsx(TG,{lora:t},t.id))}):null});MG.displayName="LoRAList";const jke=ve(WC,e=>e.loras),kke=()=>{const e=z(),[t,{isLoading:n}]=K1(),{t:s}=P(),i=I(jke),o=I(Fl),a=p=>{const g=o===p.base,m=!!i.find(x=>x.model.key===p.key);return!!!o||!g||m},l=u.useCallback(p=>{p&&e(VJ({model:p}))},[e]),{options:c,onChange:d}=hn({modelConfigs:t,getIsDisabled:a,onChange:l}),h=u.useMemo(()=>n?s("common.loading"):c.length===0?s("models.noLoRAsInstalled"):s("models.addLora"),[n,c.length,s]),f=u.useCallback(()=>s("models.noMatchingLoRAs"),[s]);return r.jsxs(Z,{isDisabled:!c.length,children:[r.jsx(Ve,{feature:"lora",children:r.jsxs(te,{children:[s("models.concepts")," "]})}),r.jsx(Fe,{placeholder:h,value:null,options:c,noOptionsMessage:f,onChange:d,"data-testid":"add-lora",sx:Ike})]})},_ke=u.memo(kke),Ike={w:"full"},Ake=()=>{const e=I(X3),t=I(f1),n=z(),{t:s}=P(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(_T(a)),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramCFGScale",children:r.jsx(te,{children:s("parameters.cfgScale")})}),r.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},Tke=u.memo(Ake),Mke=()=>{const e=I(Q3),t=I(J3),n=z(),{t:s}=P(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax-(t.sliderMax-t.sliderMin)/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(kT(a)),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramGuidance",children:r.jsx(te,{children:s("parameters.guidance")})}),r.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},Pke=u.memo(Mke),Eke=()=>{const e=z(),{t}=P(),n=I(eP),s=u.useCallback(o=>{Ol(o==null?void 0:o.value)&&e(wT(o.value))},[e]),i=u.useMemo(()=>no.find(o=>o.value===n),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramScheduler",children:r.jsx(te,{children:t("parameters.scheduler")})}),r.jsx(Fe,{value:i,options:no,onChange:s})]})},Lke=u.memo(Eke),Dke=()=>{const e=I(tP),t=I(UC),n=z(),{t:s}=P(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>{n(vT(a))},[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramSteps",children:r.jsx(te,{children:s("parameters.steps")})}),r.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},Rke=u.memo(Dke),PG=u.memo(e=>{const{t}=P(),n=z(),s=I(FC),i=u.useCallback(()=>{n(bt("models"))},[n]);return s?null:r.jsx(ae,{icon:r.jsx(zu,{}),tooltip:`${t("common.goTo")} ${t("ui.tabs.modelsTab")}`,"aria-label":`${t("common.goTo")} ${t("ui.tabs.modelsTab")}`,onClick:i,size:"sm",variant:"ghost",...e})});PG.displayName="NavigateToModelManagerButton";function Oke(e){return pe({attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.53.12-1.03.3-1.48.54l1.47 1.47c.41-.17.91-.27 1.51-.27zM5.33 4.06 4.06 5.33 7.5 8.77c0 2.08 1.56 3.21 3.91 3.91l3.51 3.51c-.34.48-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.82-.55 2.45-1.12l2.22 2.22 1.27-1.27L5.33 4.06z"},child:[]}]})(e)}const Nke=()=>{const e=z(),{t}=P(),n=I(On),s=I(nP),[i,{isLoading:o}]=U1(),a=u.useMemo(()=>{if(!i||s===null)return null;const x=i.find(C=>C.key===s);return x||null},[i,s]),l=u.useMemo(()=>{var x;if(!(!i.length||!a))return(x=i.find(C=>C.key===(a==null?void 0:a.key)))==null?void 0:x.description},[i,a]),c=u.useCallback(x=>{if(x)try{e(cT(Rs.parse(x)))}catch{}},[e]),d=u.useCallback(x=>n==="upscaling"&&x.base==="flux",[n]),{options:h,value:f,onChange:p,placeholder:g,noOptionsMessage:m}=hn({modelConfigs:i,selectedModel:a,onChange:c,isLoading:o,getIsDisabled:d}),y=u.useMemo(()=>a&&GJ(a)&&a.config_path==="flux-dev",[a]);return r.jsxs(Z,{isDisabled:!i.length,isInvalid:!f||!i.length,children:[r.jsxs(T,{alignItems:"center",children:[r.jsx(Ve,{feature:"paramModel",children:r.jsx(te,{children:t("modelManager.model")})}),y?r.jsx(Ve,{feature:"fluxDevLicense",hideDisable:!0,children:r.jsx(T,{justifyContent:"flex-start",children:r.jsx(pt,{as:Oke})})}):r.jsx(nt,{})]}),r.jsx(Le,{label:l,children:r.jsx(ke,{w:"full",minW:0,children:r.jsx(Fe,{value:f,placeholder:g,options:h,onChange:p,noOptionsMessage:m,isInvalid:f==null?void 0:f.isDisabled})})})]})},Fke=u.memo(Nke),Bke=()=>{const e=I(ip),{t}=P(),n=z(),{data:s}=Zf(),i=I(eP),o=I(tP),a=I(q3),l=I(K3),c=I(qC),d=I(KC),h=I(Q3),f=I(X3),p=I(H3),g=u.useMemo(()=>!s||e===null?null:Ia.selectById(s,e.key),[s,e]),m=u.useMemo(()=>{const b=g&&sf(g)&&g.default_settings;return b&&Object.values(b).some(S=>!!S)},[g]),y=u.useMemo(()=>g&&sf(g)&&g.default_settings?g.default_settings:zJ,[g]),x=u.useMemo(()=>{const b=[];if(m){const{vae:S,vae_precision:w,cfg_scale:j,cfg_rescale_multiplier:E,steps:A,scheduler:L,width:M,height:O,guidance:F}=y;!ze(S)&&a&&S!==a.key&&b.push(t("modelManager.vae")),!ze(S)&&!a&&S!=="default"&&b.push(t("modelManager.vae")),!ze(w)&&w!==l&&b.push(t("modelManager.vaePrecision")),!ze(j)&&j!==f&&b.push(t("parameters.cfgScale")),!ze(E)&&E!==p&&b.push(t("parameters.cfgRescaleMultiplier")),!ze(A)&&A!==o&&b.push(t("parameters.steps")),!ze(L)&&L!==i&&b.push(t("parameters.scheduler")),!ze(M)&&M!==c&&b.push(t("parameters.width")),!ze(O)&&O!==d&&b.push(t("parameters.height")),!ze(F)&&F!==h&&b.push(t("parameters.guidance"))}return b},[m,a,l,f,p,o,i,c,d,h,t,y]),C=u.useMemo(()=>e?m?x.length===0?t("modelManager.usingDefaultSettings"):r.jsxs(T,{direction:"column",gap:2,children:[r.jsx(K,{children:t("modelManager.defaultSettingsOutOfSync")}),r.jsx(ki,{children:x.map(b=>r.jsx(Gt,{children:b},b))}),r.jsx(K,{children:t("modelManager.restoreDefaultSettings")})]}):t("modelManager.noDefaultSettings"):t("modelManager.noModelSelected"),[e,m,x,t]),v=u.useCallback(()=>{n(HJ())},[n]);return r.jsx(ae,{icon:r.jsx(E1,{}),tooltip:C,"aria-label":t("modelManager.useDefaultSettings"),isDisabled:!e||!m||x.length===0,onClick:v,size:"sm",variant:"ghost",colorScheme:"warning"})},$ke=()=>{const e=I(WJ),t=I(f1),n=z(),{t:s}=P(),i=u.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),o=u.useCallback(a=>n(UJ(a)),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramCFGScale",children:r.jsx(te,{children:s("parameters.cfgScale")})}),r.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:o})]})},Vke=u.memo($ke),Gke=()=>{const e=z(),{t}=P(),n=I(qJ),s=u.useCallback(o=>{Ol(o==null?void 0:o.value)&&e(KJ(o.value))},[e]),i=u.useMemo(()=>no.find(o=>o.value===n),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"paramScheduler",children:r.jsx(te,{children:t("parameters.scheduler")})}),r.jsx(Fe,{value:i,options:no,onChange:s})]})},zke=u.memo(Gke),Xj=e=>{const t=z(),n=u.useMemo(()=>ve(Mu,o=>o.expanders[e.id]??e.defaultIsOpen),[e]),s=I(n),i=u.useCallback(()=>{t(ZJ({id:e.id,isOpen:!s}))},[t,e.id,s]);return{isOpen:s,onToggle:i}},Hke=()=>{const e=I(nP),{currentData:t}=op(e??ws);return t},Wke={minW:"4rem"},Qj=u.memo(()=>{const{t:e}=P(),t=Hke(),n=I(On),s=I(xi),i=I($l),o=u.useMemo(()=>n==="upscaling",[n]),a=u.useMemo(()=>It(WC,g=>{const m=g.loras.filter(C=>C.isEnabled).length,y=m?[`${m} ${e("models.concepts")}`]:er,x=t?[t.name,t.base]:er;return{loraTabBadges:y,accordionBadges:x}}),[t,e]),{loraTabBadges:l,accordionBadges:c}=I(a),{isOpen:d,onToggle:h}=Xj({id:"generation-settings-advanced",defaultIsOpen:!1}),{isOpen:f,onToggle:p}=pd({id:`generation-settings-${n}`,defaultIsOpen:n!=="upscaling"});return r.jsx(Bu,{label:e("accordions.generation.title"),badges:[...c,...l],isOpen:f,onToggle:p,children:r.jsxs(ke,{px:4,pt:4,"data-testid":"generation-accordion",children:[r.jsxs(T,{gap:4,flexDir:"column",children:[r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsx(Fke,{}),r.jsxs(T,{children:[r.jsx(Bke,{}),r.jsx(PG,{})]})]}),r.jsxs(T,{gap:4,flexDir:"column",children:[r.jsx(_ke,{}),r.jsx(MG,{})]})]}),r.jsx(ZC,{label:e("accordions.advanced.options"),isOpen:d,onToggle:h,children:r.jsx(T,{gap:4,flexDir:"column",pb:4,children:r.jsxs(ms,{formLabelProps:Wke,children:[!s&&!i&&!o&&r.jsx(Lke,{}),o&&r.jsx(zke,{}),r.jsx(Rke,{}),s&&r.jsx(Pke,{}),o&&r.jsx(Vke,{}),!s&&!o&&r.jsx(Tke,{})]})})})]})})});Qj.displayName="GenerationSettingsAccordion";const EG=u.memo(()=>{const e=I(YJ),t=z(),n=u.useCallback(i=>{t(XJ(i.target.checked))},[t]),{t:s}=P();return r.jsxs(Z,{w:"min-content",children:[r.jsx(Ve,{feature:"optimizedDenoising",children:r.jsxs(te,{m:0,children:[s("parameters.optimizedImageToImage")," (",s("settings.beta"),")"]})}),r.jsx(it,{isChecked:e,onChange:n})]})});EG.displayName="ParamOptimizedDenoisingToggle";const Uke=ve(Je,e=>e.bbox.scaleMethod==="manual"),qke=ve(Je,e=>e.bbox.scaledSize.height),Kke=ve(Qr,e=>e.sd.scaledBoundingBoxHeight),Zke=()=>{const{t:e}=P(),t=z(),n=I(Dn),s=I(dp),i=I(Uke),o=I(qke),a=I(Kke),l=I(ep),c=u.useCallback(d=>{t(QJ(d))},[t]);return r.jsxs(Z,{isDisabled:!i||n,children:[r.jsx(te,{children:e("parameters.scaledHeight")}),r.jsx(qe,{min:a.sliderMin,max:a.sliderMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,marks:!0,defaultValue:s}),r.jsx(Ae,{min:a.numberInputMin,max:a.numberInputMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s})]})},Yke=u.memo(Zke),Xke=ve(Je,e=>e.bbox.scaleMethod==="manual"),Qke=ve(Je,e=>e.bbox.scaledSize.width),Jke=ve(Qr,e=>e.sd.scaledBoundingBoxWidth),e_e=()=>{const{t:e}=P(),t=z(),n=I(Dn),s=I(dp),i=I(Xke),o=I(Qke),a=I(Jke),l=I(ep),c=u.useCallback(d=>{t(JJ(d))},[t]);return r.jsxs(Z,{isDisabled:!i||n,children:[r.jsx(te,{children:e("parameters.scaledWidth")}),r.jsx(qe,{min:a.sliderMin,max:a.sliderMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s,marks:!0}),r.jsx(Ae,{min:a.numberInputMin,max:a.numberInputMax,step:a.coarseStep,fineStep:l,value:o,onChange:c,defaultValue:s})]})},t_e=u.memo(e_e),n_e=ve(Je,e=>e.bbox.scaleMethod),s_e=()=>{const e=z(),{t}=P(),n=I(n_e),s=I(Dn),i=u.useMemo(()=>[{label:t("modelManager.none"),value:"none"},{label:t("common.auto"),value:"auto"},{label:t("modelManager.manual"),value:"manual"}],[t]),o=u.useCallback(l=>{eee(l==null?void 0:l.value)&&e(tee(l.value))},[e]),a=u.useMemo(()=>i.find(l=>l.value===n),[n,i]);return r.jsxs(Z,{isDisabled:s,children:[r.jsx(Ve,{feature:"scaleBeforeProcessing",children:r.jsx(te,{children:t("parameters.scaleBeforeProcessing")})}),r.jsx(Fe,{value:a,options:i,onChange:o})]})},r_e=u.memo(s_e),LG=u.memo(()=>{const{t:e}=P(),t=z(),n=I(nee),s=I(Dn),i=u.useCallback(a=>{!a||!see(a.value)||t(ree({id:a.value}))},[t]),o=u.useMemo(()=>u_.filter(a=>a.value===n)[0],[n]);return r.jsxs(Z,{isDisabled:s,children:[r.jsx(Ve,{feature:"paramAspect",children:r.jsx(te,{children:e("parameters.aspect")})}),r.jsx(Fe,{value:o,onChange:i,options:u_,sx:i_e})]})});LG.displayName="BboxAspectRatioSelect";const i_e={minW:24},DG=u.memo(()=>{const{t:e}=P(),t=z(),n=I(dp),s=I(KC),i=I(sP),o=I(Dn),a=I(ep),l=u.useCallback(d=>{t(jT({height:d}))},[t]),c=u.useMemo(()=>[i.sliderMin,n,i.sliderMax],[i.sliderMin,i.sliderMax,n]);return r.jsxs(Z,{isDisabled:o,children:[r.jsx(Ve,{feature:"paramHeight",children:r.jsx(te,{children:e("parameters.height")})}),r.jsx(qe,{value:s,defaultValue:n,onChange:l,min:i.sliderMin,max:i.sliderMax,step:i.coarseStep,fineStep:a,marks:c}),r.jsx(Ae,{value:s,defaultValue:n,onChange:l,min:i.numberInputMin,max:i.numberInputMax,step:i.coarseStep,fineStep:a})]})});DG.displayName="BboxHeight";const o_e=ve(Je,e=>e.bbox.aspectRatio.isLocked),RG=u.memo(()=>{const{t:e}=P(),t=z(),n=I(o_e),s=I(Dn),i=u.useCallback(()=>{t(iee())},[t]);return r.jsx(ae,{tooltip:e("parameters.lockAspectRatio"),"aria-label":e("parameters.lockAspectRatio"),onClick:i,variant:n?"outline":"ghost",size:"sm",icon:n?r.jsx(VE,{}):r.jsx(TE,{}),isDisabled:s})});RG.displayName="BboxLockAspectRatioButton";const OG=u.memo(()=>{const e=I(qC),t=I(KC),n=I(oee),[s,i]=tB(),o=u.useMemo(()=>{if(!i)return{width:0,height:0};let a=e,l=t;return e>t?(a=i.width,l=a/n):(l=i.height,a=l*n),{width:a,height:l}},[i,e,t,n]);return r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",ref:s,children:r.jsx(T,{position:"relative",borderRadius:"base",borderColor:"base.600",borderWidth:"3px",width:`${o.width}px`,height:`${o.height}px`,alignItems:"center",justifyContent:"center",children:r.jsxs(Kr,{borderRadius:"base",position:"absolute",top:0,right:0,bottom:0,left:0,gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"1px",bg:"base.700",children:[r.jsx(Rt,{bg:"base.800"}),r.jsx(Rt,{bg:"base.800"}),r.jsx(Rt,{bg:"base.800"}),r.jsx(Rt,{bg:"base.800"}),r.jsx(Rt,{bg:"base.800"}),r.jsx(Rt,{bg:"base.800"}),r.jsx(Rt,{bg:"base.800"}),r.jsx(Rt,{bg:"base.800"}),r.jsx(Rt,{bg:"base.800"})]})})})});OG.displayName="BboxPreview";const a_e=ve(Je,e=>e.bbox.rect.width),l_e=ve(Je,e=>e.bbox.rect.height),NG=u.memo(()=>{const{t:e}=P(),t=z(),n=I(Dn),s=I(a_e),i=I(l_e),o=I(dp),a=u.useMemo(()=>aee(s,i,o),[i,s,o]),l=u.useMemo(()=>lee(s,i,o),[i,s,o]),c=u.useCallback(()=>{t(cee())},[t]),d=u.useMemo(()=>e(a?"parameters.setToOptimalSizeTooSmall":l?"parameters.setToOptimalSizeTooLarge":"parameters.setToOptimalSize"),[l,a,e]);return r.jsx(ae,{tooltip:d,"aria-label":e("parameters.setToOptimalSize"),onClick:c,variant:"ghost",size:"sm",icon:r.jsx(E1,{}),colorScheme:a||l?"warning":"base",isDisabled:n})});NG.displayName="BboxSetOptimalSizeButton";const FG=u.memo(()=>{const{t:e}=P(),t=z(),n=I(Dn),s=u.useCallback(()=>{t(uee())},[t]);return r.jsx(ae,{tooltip:e("parameters.swapDimensions"),"aria-label":e("parameters.swapDimensions"),onClick:s,variant:"ghost",size:"sm",icon:r.jsx(loe,{}),isDisabled:n})});FG.displayName="BboxSwapDimensionsButton";const BG=u.memo(()=>{const{t:e}=P(),t=z(),n=I(qC),s=I(dp),i=I(rP),o=I(Dn),a=I(ep),l=u.useCallback(d=>{t(mT({width:d}))},[t]),c=u.useMemo(()=>[i.sliderMin,s,i.sliderMax],[i.sliderMax,i.sliderMin,s]);return r.jsxs(Z,{isDisabled:o,children:[r.jsx(Ve,{feature:"paramWidth",children:r.jsx(te,{children:e("parameters.width")})}),r.jsx(qe,{value:n,onChange:l,defaultValue:s,min:i.sliderMin,max:i.sliderMax,step:i.coarseStep,fineStep:a,marks:c}),r.jsx(Ae,{value:n,onChange:l,defaultValue:s,min:i.numberInputMin,max:i.numberInputMax,step:i.coarseStep,fineStep:a})]})});BG.displayName="BboxWidth";const $G=u.memo(()=>r.jsxs(T,{gap:4,alignItems:"center",children:[r.jsx(T,{gap:4,flexDirection:"column",width:"full",children:r.jsxs(ms,{formLabelProps:c_e,children:[r.jsxs(T,{gap:4,children:[r.jsx(LG,{}),r.jsx(FG,{}),r.jsx(RG,{}),r.jsx(NG,{})]}),r.jsx(BG,{}),r.jsx(DG,{})]})}),r.jsx(T,{w:"108px",h:"108px",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"center",children:r.jsx(OG,{})})]}));$G.displayName="BboxSettings";const c_e={minW:10},u_e=It([Je,r1],(e,t)=>{const{shouldRandomizeSeed:n}=t,s=[],{aspectRatio:i}=e.bbox,{width:o,height:a}=e.bbox.rect;if(s.push(`${o}×${a}`),s.push(i.id),i.isLocked&&s.push("locked"),n||s.push("Manual Seed"),s.length===0)return er}),d_e={minW:"4.5rem"},VG=u.memo(()=>{const{t:e}=P(),t=I(u_e),n=I(vM),{isOpen:s,onToggle:i}=pd({id:"image-settings",defaultIsOpen:!0}),{isOpen:o,onToggle:a}=Xj({id:"image-settings-advanced",defaultIsOpen:!1}),l=I(xi),c=I($l);return r.jsx(Bu,{label:e("accordions.image.title"),badges:t,isOpen:s,onToggle:i,children:r.jsxs(T,{px:4,pt:4,w:"full",h:"full",flexDir:"column","data-testid":"image-settings-accordion",children:[r.jsx($G,{}),r.jsxs(T,{py:3,gap:4,alignItems:"center",children:[r.jsx(qj,{}),r.jsx(Zj,{}),r.jsx(Kj,{})]}),r.jsx(ZC,{label:e("accordions.advanced.options"),isOpen:o,onToggle:a,children:r.jsxs(T,{gap:4,pb:4,flexDir:"column",children:[(l||c)&&r.jsx(EG,{}),r.jsx(r_e,{}),n!=="none"&&r.jsxs(ms,{formLabelProps:d_e,children:[r.jsx(t_e,{}),r.jsx(Yke,{})]})]})})]})})});VG.displayName="ImageSettingsAccordion";const h_e=()=>{const{t:e}=P(),t=z(),n=I(dee),s=I(f1),i=u.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),o=u.useCallback(a=>t(gT(a)),[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerCfgScale",children:r.jsx(te,{children:e("sdxl.cfgScale")})}),r.jsx(qe,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o})]})},f_e=u.memo(h_e),p_e=e=>e.base==="sdxl-refiner",g_e=()=>{const e=z(),t=I(hee),{t:n}=P(),[s,{isLoading:i}]=q1(),o=u.useCallback(p=>{if(!p){e(Fb(null));return}e(Fb(Rs.parse(p)))},[e]),{options:a,value:l,onChange:c,placeholder:d,noOptionsMessage:h}=Fa({modelConfigs:s,onChange:o,selectedModel:t,isLoading:i,optionsFilter:p_e}),f=u.useCallback(()=>{o(null)},[o]);return r.jsxs(Z,{isDisabled:!a.length,isInvalid:!a.length,w:"full",children:[r.jsx(Ve,{feature:"refinerModel",children:r.jsx(te,{children:n("sdxl.refinermodel")})}),r.jsxs(T,{w:"full",minW:0,gap:2,alignItems:"center",children:[r.jsx(Fe,{value:l,placeholder:d,options:a,onChange:c,noOptionsMessage:h}),r.jsx(ae,{size:"sm",variant:"ghost",icon:r.jsx(Nt,{}),"aria-label":n("common.reset"),onClick:f,isDisabled:!l})]})]})},m_e=u.memo(g_e),y_e=()=>{const e=I(fee),t=z(),{t:n}=P(),s=u.useCallback(i=>t(pT(i)),[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerNegativeAestheticScore",children:r.jsx(te,{children:n("sdxl.negAestheticScore")})}),r.jsx(qe,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5,marks:!0}),r.jsx(Ae,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5})]})},v_e=u.memo(y_e),b_e=()=>{const e=I(pee),t=z(),{t:n}=P(),s=u.useCallback(i=>t(fT(i)),[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerPositiveAestheticScore",children:r.jsx(te,{children:n("sdxl.posAestheticScore")})}),r.jsx(qe,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6,marks:!0}),r.jsx(Ae,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6})]})},x_e=u.memo(b_e),C_e=()=>{const e=z(),{t}=P(),n=I(gee),s=u.useCallback(o=>{Ol(o==null?void 0:o.value)&&e(hT(o.value))},[e]),i=u.useMemo(()=>no.find(o=>o.value===n),[n]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerScheduler",children:r.jsx(te,{children:t("sdxl.scheduler")})}),r.jsx(Fe,{value:i,options:no,onChange:s})]})},S_e=u.memo(C_e),w_e=()=>{const e=I(mee),t=z(),n=u.useCallback(i=>t(dT(i)),[t]),{t:s}=P();return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerStart",children:r.jsx(te,{children:s("sdxl.refinerStart")})}),r.jsx(qe,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e,marks:!0}),r.jsx(Ae,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e})]})},j_e=u.memo(w_e),k_e=()=>{const{t:e}=P(),t=z(),n=I(yee),s=I(UC),i=u.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),o=u.useCallback(a=>{t(uT(a))},[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"refinerSteps",children:r.jsx(te,{children:e("sdxl.steps")})}),r.jsx(qe,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o,marks:i}),r.jsx(Ae,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:o})]})},__e=u.memo(k_e),I_e=()=>{const[e]=q1();return!!e.length},A_e={minW:"9.2rem"},T_e={minW:"5rem"},M_e=It(r1,e=>e.refinerModel?["Enabled"]:void 0),GG=u.memo(()=>{const{t:e}=P(),t=I_e(),n=I(M_e),{isOpen:s,onToggle:i}=pd({id:"refiner-settings",defaultIsOpen:!1});return r.jsx(Bu,{label:e("sdxl.refiner"),badges:n,isOpen:s,onToggle:i,children:t?r.jsx(HG,{}):r.jsx(zG,{})})});GG.displayName="RefinerSettingsAccordion";const zG=u.memo(()=>{const{t:e}=P();return r.jsx(T,{justifyContent:"center",p:4,children:r.jsx(K,{fontSize:"sm",color:"base.500",children:e("models.noRefinerModelsInstalled")})})});zG.displayName="RefinerSettingsAccordionNoRefiner";const HG=u.memo(()=>{const e=I(vee);return r.jsx(ms,{isDisabled:!e,children:r.jsxs(T,{p:4,gap:4,flexDir:"column",minW:0,children:[r.jsx(m_e,{}),r.jsxs(ms,{formLabelProps:T_e,isDisabled:!e,children:[r.jsx(S_e,{}),r.jsx(__e,{}),r.jsx(f_e,{}),r.jsx(j_e,{})]}),r.jsxs(ms,{formLabelProps:A_e,isDisabled:!e,children:[r.jsx(x_e,{}),r.jsx(v_e,{})]})]})})});HG.displayName="RefinerSettingsAccordionContent";const P_e={svg:{animation:h1}},E_e=()=>{const[e,{isLoading:t}]=bee(),{t:n}=P(),{presetCount:s}=cp(void 0,{selectFromResult:({data:o})=>({presetCount:((o==null?void 0:o.filter(l=>l.type!=="default"))??er).length})}),i=u.useCallback(async()=>{let o;try{const a=await e().unwrap();o=new Blob([a],{type:"text/csv"})}catch{fe({status:"error",title:n("stylePresets.exportFailed")});return}if(o){const a=window.URL.createObjectURL(o),l=document.createElement("a");l.href=a,l.download="data.csv",document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(a),fe({status:"success",title:n("stylePresets.exportDownloaded")})}},[e,n]);return r.jsx(ae,{onClick:i,icon:t?r.jsx(qE,{}):r.jsx(Vu,{}),tooltip:n("stylePresets.exportPromptTemplates"),"aria-label":n("stylePresets.exportPromptTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?P_e:void 0,isDisabled:t||s===0})},L_e={svg:{animation:h1}},D_e=()=>{const[e,{isLoading:t}]=xee(),{t:n}=P(),s=u.useCallback(a=>{const l=a[0];l&&e(l).unwrap().then(()=>{fe({status:"success",title:n("toast.importSuccessful")})}).catch(c=>{fe({status:"error",title:n("toast.importFailed"),description:c?`${c.data.detail}`:void 0})})},[e,n]),{getInputProps:i,getRootProps:o}=Ra({accept:{"text/csv":[".csv"],"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return r.jsxs(r.Fragment,{children:[r.jsx(ae,{icon:t?r.jsx(qE,{}):r.jsx(M1,{}),tooltip:r.jsx(R_e,{}),"aria-label":n("stylePresets.importTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?L_e:void 0,isDisabled:t,...o()}),r.jsx("input",{...i()})]})},R_e=()=>{const{t:e}=P();return r.jsxs(T,{flexDir:"column",children:[r.jsx(K,{pb:1,fontWeight:"semibold",children:e("stylePresets.importTemplates")}),r.jsx(K,{children:e("stylePresets.acceptedColumnsKeys")}),r.jsxs(ki,{children:[r.jsx(Gt,{children:e("stylePresets.nameColumn")}),r.jsx(Gt,{children:e("stylePresets.positivePromptColumn")}),r.jsx(Gt,{children:e("stylePresets.negativePromptColumn")})]})]})},O_e=()=>{const e=u.useCallback(()=>{ba.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!0})},[]),{t}=P();return r.jsx(ae,{icon:r.jsx(Ht,{}),tooltip:t("stylePresets.createPromptTemplate"),"aria-label":t("stylePresets.createPromptTemplate"),onClick:e,size:"md",variant:"ghost",w:8,h:8})},gd=u.memo,gc="40px",N_e="24px",F_e=({presetImageUrl:e,imageWidth:t})=>r.jsx(Le,{closeOnScroll:!0,openDelay:0,label:e&&r.jsx(dn,{src:e,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),p:2,children:r.jsx(dn,{src:e||"",fallbackStrategy:"beforeLoadOrError",fallback:r.jsx(T,{height:t||gc,minWidth:t||gc,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:r.jsx(pt,{color:"base.500",as:UE,boxSize:t?t/2:N_e})}),objectFit:"cover",objectPosition:"50% 50%",height:t||gc,width:t||gc,minHeight:t||gc,minWidth:t||gc,borderRadius:"base"})}),WG=gd(F_e),B_e=({preset:e})=>{const t=z(),n=I(Bf),{t:s}=P(),i=rde(),o=u.useCallback(d=>{d.stopPropagation();const{name:h,preset_data:f}=e,{positive_prompt:p,negative_prompt:g}=f;ba.set({prefilledFormData:{name:h,positivePrompt:p||"",negativePrompt:g||"",imageUrl:e.image,type:e.type},updatingStylePresetId:e.id,isModalOpen:!0})},[e]),a=u.useCallback(()=>{t(rf(e.id)),pu.set(!1)},[t,e.id]),l=u.useCallback(d=>{d.stopPropagation(),i(e)},[i,e]),c=u.useCallback(d=>{d.stopPropagation();const{name:h,preset_data:f}=e,{positive_prompt:p,negative_prompt:g}=f;ba.set({prefilledFormData:{name:`${h} (${s("common.copy")})`,positivePrompt:p||"",negativePrompt:g||"",imageUrl:e.image,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[e,s]);return r.jsxs(T,{gap:4,onClick:a,cursor:"pointer",_hover:{backgroundColor:"base.750"},py:3,px:2,borderRadius:"base",alignItems:"flex-start",w:"full",children:[r.jsx(WG,{presetImageUrl:e.image}),r.jsxs(T,{flexDir:"column",w:"full",children:[r.jsxs(T,{w:"full",justifyContent:"space-between",alignItems:"flex-start",children:[r.jsxs(T,{alignItems:"center",gap:2,children:[r.jsx(K,{fontSize:"md",noOfLines:2,children:e.name}),n===e.id&&r.jsx(os,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:s("stylePresets.active")})]}),r.jsxs(T,{alignItems:"center",gap:1,children:[r.jsx(ae,{size:"sm",variant:"ghost","aria-label":s("stylePresets.copyTemplate"),onClick:c,icon:r.jsx(on,{})}),e.type!=="default"&&r.jsxs(r.Fragment,{children:[r.jsx(ae,{size:"sm",variant:"ghost","aria-label":s("stylePresets.editTemplate"),onClick:o,icon:r.jsx(bp,{})}),r.jsx(ae,{size:"sm",variant:"ghost","aria-label":s("stylePresets.deleteTemplate"),onClick:l,colorScheme:"error",icon:r.jsx(FE,{})})]})]})]}),r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsxs(K,{fontSize:"xs",children:[r.jsxs(K,{as:"span",fontWeight:"semibold",children:[s("stylePresets.positivePrompt"),":"]})," ",e.preset_data.positive_prompt]}),r.jsxs(K,{fontSize:"xs",children:[r.jsxs(K,{as:"span",fontWeight:"semibold",children:[s("stylePresets.negativePrompt"),":"]})," ",e.preset_data.negative_prompt]})]})]})]})},fb=({title:e,data:t})=>{const{t:n}=P(),{onToggle:s,isOpen:i}=ar({defaultIsOpen:!0}),o=I(YC);return r.jsxs(T,{flexDir:"column",children:[r.jsx(ye,{variant:"unstyled",onClick:s,children:r.jsxs(T,{gap:2,alignItems:"center",children:[r.jsx(pt,{boxSize:4,as:Pr,transform:i?void 0:"rotate(-90deg)",fill:"base.500"}),r.jsx(K,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:e})]})}),r.jsx(ql,{in:i,style:my,children:t.length?t.map(a=>r.jsx(B_e,{preset:a},a.id)):r.jsx(Yt,{fontSize:"sm",py:4,label:n(o?"stylePresets.noMatchingTemplates":"stylePresets.noTemplates"),icon:null})})]})},$_e=()=>{const e=z(),t=I(YC),{t:n}=P(),s=u.useCallback(l=>{e(d_(l))},[e]),i=u.useCallback(()=>{e(d_(""))},[e]),o=u.useCallback(l=>{l.key==="Escape"&&i()},[i]),a=u.useCallback(l=>{s(l.target.value)},[s]);return r.jsxs(Vo,{children:[r.jsx(Ct,{placeholder:n("stylePresets.searchByName"),value:t,onKeyDown:o,onChange:a}),t&&t.length&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{onClick:i,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:r.jsx(Nt,{})})})]})},V_e=u.memo($_e),UG=()=>{const e=I(YC),t=I(oM),{data:n}=cp(void 0,{selectFromResult:({data:i})=>({data:((i==null?void 0:i.filter(l=>l.name.toLowerCase().includes(e.toLowerCase())))||er).reduce((l,c)=>(c.type==="default"?l.defaultPresets.push(c):c.type==="project"?l.sharedPresets.push(c):l.presets.push(c),l),{defaultPresets:[],sharedPresets:[],presets:[]})})}),{t:s}=P();return r.jsxs(T,{flexDir:"column",gap:2,padding:3,layerStyle:"second",borderRadius:"base",children:[r.jsxs(T,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[r.jsx(V_e,{}),r.jsx(O_e,{}),r.jsx(D_e,{}),r.jsx(E_e,{})]}),r.jsx(fb,{title:s("stylePresets.myTemplates"),data:n.presets}),t&&r.jsx(fb,{title:s("stylePresets.sharedTemplates"),data:n.sharedPresets}),r.jsx(fb,{title:s("stylePresets.defaultTemplates"),data:n.defaultPresets})]})},G_e=()=>{const e=I(zC),t=I(Bf),{activeStylePreset:n}=cp(void 0,{selectFromResult:({data:h})=>{let f=null;return h&&(f=h.find(p=>p.id===t)),{activeStylePreset:f}}}),s=z(),{t:i}=P(),{presetModifiedPositivePrompt:o,presetModifiedNegativePrompt:a}=Cee(),l=u.useCallback(h=>{h.stopPropagation(),s(rm(!1)),s(rf(null))},[s]),c=u.useCallback(h=>{h.stopPropagation(),s(X2(o)),s(Q2(a)),s(rm(!1)),s(rf(null))},[s,o,a]),d=u.useCallback(h=>{h.stopPropagation(),s(rm(!e))},[s,e]);return n?r.jsxs(T,{w:"full",alignItems:"center",gap:2,minW:0,children:[r.jsx(WG,{imageWidth:25,presetImageUrl:n.image}),r.jsx(os,{colorScheme:"invokeBlue",variant:"subtle",justifySelf:"flex-start",children:n.name}),r.jsx(nt,{}),r.jsx(Le,{label:i("stylePresets.toggleViewMode"),children:r.jsx(ae,{onClick:d,variant:"outline",size:"sm","aria-label":i("stylePresets.toggleViewMode"),colorScheme:e?"invokeBlue":"base",icon:r.jsx(yp,{})})}),r.jsx(Le,{label:i("stylePresets.flatten"),children:r.jsx(ae,{onClick:c,variant:"outline",size:"sm","aria-label":i("stylePresets.flatten"),icon:r.jsx(NE,{})})}),r.jsx(Le,{label:i("stylePresets.clearTemplateSelection"),children:r.jsx(ae,{onClick:l,variant:"outline",size:"sm","aria-label":i("stylePresets.clearTemplateSelection"),icon:r.jsx(Nt,{})})})]}):r.jsx(T,{h:25,alignItems:"center",children:r.jsx(K,{fontSize:"sm",fontWeight:"semibold",color:"base.300",children:i("stylePresets.choosePromptTemplate")})})},z_e={bg:"base.750"},qG=()=>{const e=ce(pu),{t}=P(),n=u.useCallback(()=>{pu.set(!e)},[e]);return r.jsxs(T,{onClick:n,backgroundColor:"base.800",justifyContent:"space-between",alignItems:"center",py:2,px:3,borderRadius:"base",gap:2,role:"button",_hover:z_e,transitionProperty:"background-color",transitionDuration:"normal",w:"full",children:[r.jsx(G_e,{}),r.jsx(ae,{"aria-label":t("stylePresets.viewList"),variant:"ghost",icon:r.jsx(Pr,{}),size:"sm"})]})},R8={height:"100%",width:"100%"},H_e=()=>{const e=I(See),t=ce(pu);return r.jsxs(T,{w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsx(qG,{}),r.jsx(T,{w:"full",h:"full",position:"relative",children:r.jsxs(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[t&&r.jsx(tr,{defer:!0,style:R8,options:Il.options,children:r.jsx(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:r.jsx(UG,{})})}),r.jsx(tr,{defer:!0,style:R8,options:Il.options,children:r.jsxs(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:[r.jsx(Uj,{}),r.jsx(VG,{}),r.jsx(Qj,{}),r.jsx(AG,{}),e&&r.jsx(GG,{}),r.jsx(Yj,{})]})})]})})]})},W_e=u.memo(H_e),U_e={diffusers:"diffusers",lycoris:"lycoris",checkpoint:"checkpoint",invokeai:"internal",embedding_file:"embedding",embedding_folder:"embedding",t5_encoder:"t5_encoder",bnb_quantized_int8b:"bnb_quantized_int8b",bnb_quantized_nf4b:"quantized",gguf_quantized:"gguf"},q_e={diffusers:"base",lycoris:"base",checkpoint:"orange",invokeai:"base",embedding_file:"base",embedding_folder:"base",t5_encoder:"base",bnb_quantized_int8b:"base",bnb_quantized_nf4b:"base",gguf_quantized:"base"},K_e=({format:e})=>r.jsx(os,{flexGrow:0,colorScheme:q_e[e],variant:"subtle",children:U_e[e]}),Z_e=u.memo(K_e),jo="40px",Y_e="24px",X_e=({image_url:e})=>e?r.jsx(dn,{src:e,objectFit:"cover",objectPosition:"50% 50%",height:jo,width:jo,minHeight:jo,minWidth:jo,borderRadius:"base"}):r.jsx(T,{height:jo,minWidth:jo,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:r.jsx(pt,{color:"base.500",as:UE,boxSize:Y_e})}),Q_e=gd(X_e),J_e={_hover:{bg:"base.700"},"&[aria-selected='true']":{bg:"base.700"}},e4e=({model:e})=>{const{t}=P(),n=z(),s=u.useMemo(()=>ve(wee,p=>p.selectedModelKey===e.key),[e.key]),i=I(s),[o]=jee(),{isOpen:a,onOpen:l,onClose:c}=ar(),d=u.useCallback(()=>{n(ex(e.key))},[e.key,n]),h=u.useCallback(p=>{p.stopPropagation(),l()},[l]),f=u.useCallback(()=>{o({key:e.key}).unwrap().then(p=>{fe({id:"MODEL_DELETED",title:`${t("modelManager.modelDeleted")}: ${e.name}`,status:"success"})}).catch(p=>{p&&fe({id:"MODEL_DELETE_FAILED",title:`${t("modelManager.modelDeleteFailed")}: ${e.name}`,status:"error"})}),n(ex(null))},[o,e,n,t]);return r.jsxs(T,{sx:J_e,"aria-selected":i,justifyContent:"flex-start",p:2,borderRadius:"base",w:"full",alignItems:"center",gap:2,cursor:"pointer",onClick:d,children:[r.jsxs(T,{gap:2,w:"full",h:"full",minW:0,children:[r.jsx(Q_e,{image_url:e.cover_image}),r.jsxs(T,{gap:1,alignItems:"flex-start",flexDir:"column",w:"full",minW:0,children:[r.jsxs(T,{gap:2,w:"full",alignItems:"flex-start",children:[r.jsx(K,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",children:e.name}),r.jsx(nt,{})]}),r.jsx(K,{variant:"subtext",noOfLines:1,children:e.description||"No Description"})]}),r.jsxs(T,{h:jo,flexDir:"column",alignItems:"flex-end",justifyContent:"space-between",gap:2,children:[r.jsx(OD,{base:e.base}),r.jsx(Z_e,{format:e.format})]})]}),r.jsx(ae,{onClick:h,icon:r.jsx(Xr,{size:16}),"aria-label":t("modelManager.deleteConfig"),colorScheme:"error",h:jo,w:jo}),r.jsx(ti,{isOpen:a,onClose:c,title:t("modelManager.deleteModel"),acceptCallback:f,acceptButtonText:t("modelManager.delete"),useInert:!1,children:r.jsxs(T,{rowGap:4,flexDirection:"column",children:[r.jsx(K,{fontWeight:"bold",children:t("modelManager.deleteMsg1")}),r.jsx(K,{children:t("modelManager.deleteMsg2")})]})})]})},t4e=u.memo(e4e),Vs=u.memo(e=>{const{title:t,modelList:n}=e;return r.jsx(Ri,{title:t,contentSx:{gap:1,p:2},children:n.map(s=>r.jsx(t4e,{model:s},s.key))})});Vs.displayName="ModelListWrapper";const n4e=()=>{const e=I(iP),t=I(oP),{t:n}=P(),[s,{isLoading:i}]=U1(),o=u.useMemo(()=>ur(s,t,e),[s,t,e]),[a,{isLoading:l}]=q1(),c=u.useMemo(()=>ur(a,t,e),[a,t,e]),[d,{isLoading:h}]=K1(),f=u.useMemo(()=>ur(d,t,e),[d,t,e]),[p,{isLoading:g}]=fR(),m=u.useMemo(()=>ur(p,t,e),[p,t,e]),[y,{isLoading:x}]=ew(),C=u.useMemo(()=>ur(y,t,e),[y,t,e]),[v,{isLoading:b}]=hR(),S=u.useMemo(()=>ur(v,t,e),[v,t,e]),[w,{isLoading:j}]=nw(),E=u.useMemo(()=>ur(w,t,e),[w,t,e]),[A,{isLoading:L}]=Kue(),M=u.useMemo(()=>ur(A,t,e),[A,t,e]),[O,{isLoading:F}]=Z1({excludeSubmodels:!0}),_=u.useMemo(()=>ur(O,t,e),[O,t,e]),[R,{isLoading:D}]=tw({excludeSubmodels:!0}),$=u.useMemo(()=>ur(R,t,e),[R,t,e]),[G,{isLoading:ee}]=dR(),Q=u.useMemo(()=>ur(G,t,e),[G,t,e]),[se,{isLoading:ne}]=Xl({excludeSubmodels:!0}),H=u.useMemo(()=>ur(se,t,e),[se,t,e]),[V,{isLoading:Y}]=Ip(),W=u.useMemo(()=>ur(V,t,e),[V,t,e]),J=u.useMemo(()=>o.length+c.length+f.length+m.length+C.length+S.length+E.length+M.length+_.length+W.length+R.length+se.length+G.length,[C.length,m.length,E.length,M.length,f.length,o.length,c.length,S.length,_.length,W.length,R.length,se.length,G.length]);return r.jsx(Nn,{children:r.jsxs(T,{flexDirection:"column",w:"full",h:"full",gap:4,children:[i&&r.jsx(Is,{loadingMessage:"Loading Main Models..."}),!i&&o.length>0&&r.jsx(Vs,{title:n("modelManager.main"),modelList:o},"main"),l&&r.jsx(Is,{loadingMessage:"Loading Refiner Models..."}),!l&&c.length>0&&r.jsx(Vs,{title:n("sdxl.refiner"),modelList:c},"refiner"),h&&r.jsx(Is,{loadingMessage:"Loading LoRAs..."}),!h&&f.length>0&&r.jsx(Vs,{title:n("modelManager.loraModels"),modelList:f},"loras"),g&&r.jsx(Is,{loadingMessage:"Loading Textual Inversions..."}),!g&&m.length>0&&r.jsx(Vs,{title:n("modelManager.textualInversions"),modelList:m},"textual-inversions"),F&&r.jsx(Is,{loadingMessage:"Loading VAEs..."}),!F&&_.length>0&&r.jsx(Vs,{title:"VAE",modelList:_},"vae"),x&&r.jsx(Is,{loadingMessage:"Loading ControlNets..."}),!x&&C.length>0&&r.jsx(Vs,{title:"ControlNet",modelList:C},"controlnets"),j&&r.jsx(Is,{loadingMessage:"Loading IP Adapters..."}),!j&&E.length>0&&r.jsx(Vs,{title:n("common.ipAdapter"),modelList:E},"ip-adapters"),L&&r.jsx(Is,{loadingMessage:"Loading CLIP Vision Models..."}),!L&&M.length>0&&r.jsx(Vs,{title:"CLIP Vision",modelList:M},"clip-vision"),b&&r.jsx(Is,{loadingMessage:"Loading T2I Adapters..."}),!b&&S.length>0&&r.jsx(Vs,{title:n("common.t2iAdapter"),modelList:S},"t2i-adapters"),D&&r.jsx(Is,{loadingMessage:"Loading T5 Encoder Models..."}),!D&&$.length>0&&r.jsx(Vs,{title:n("modelManager.t5Encoder"),modelList:$},"t5-encoder"),ee&&r.jsx(Is,{loadingMessage:"Loading Control Loras..."}),!ee&&Q.length>0&&r.jsx(Vs,{title:n("modelManager.controlLora"),modelList:Q},"control-lora"),ne&&r.jsx(Is,{loadingMessage:"Loading Clip Embed Models..."}),!ne&&H.length>0&&r.jsx(Vs,{title:n("modelManager.clipEmbed"),modelList:H},"clip-embed"),Y&&r.jsx(Is,{loadingMessage:"Loading Image-to-Image Models..."}),!Y&&W.length>0&&r.jsx(Vs,{title:n("modelManager.spandrelImageToImage"),modelList:W},"spandrel-image-to-image"),J===0&&r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(K,{children:n("modelManager.noMatchingModels")})})]})})},s4e=u.memo(n4e),ur=(e,t,n)=>e.filter(s=>{const i=s.name.toLowerCase().includes(t.toLowerCase()),o=r4e(s,n);return i&&o}),r4e=(e,t)=>t==="refiner"?e.base==="sdxl-refiner":t==="main"&&e.base==="sdxl-refiner"?!1:t?e.type===t:!0,KG=u.memo(()=>{const{t:e}=P(),t=z(),n=u.useMemo(()=>({main:e("modelManager.main"),refiner:e("sdxl.refiner"),lora:"LoRA",embedding:e("modelManager.textualInversions"),controlnet:"ControlNet",vae:"VAE",t2i_adapter:e("common.t2iAdapter"),t5_encoder:e("modelManager.t5Encoder"),clip_embed:e("modelManager.clipEmbed"),ip_adapter:e("common.ipAdapter"),clip_vision:"CLIP Vision",spandrel_image_to_image:e("modelManager.spandrelImageToImage"),control_lora:e("modelManager.controlLora")}),[e]),s=I(iP),i=u.useCallback(a=>{t(h_(a))},[t]),o=u.useCallback(()=>{t(h_(null))},[t]);return r.jsxs(Qt,{children:[r.jsx(Jt,{as:ye,size:"sm",leftIcon:r.jsx(koe,{}),children:s?n[s]:e("modelManager.allModels")}),r.jsxs(kt,{children:[r.jsx(he,{onClick:o,children:e("modelManager.allModels")}),tS(n).map(a=>r.jsx(he,{bg:s===a?"base.700":"transparent",onClick:i.bind(null,a),children:n[a]},a))]})]})});KG.displayName="ModelTypeFilter";const ZG=u.memo(()=>{const e=z(),t=I(oP),n=u.useCallback(i=>{e(f_(i.target.value))},[e]),s=u.useCallback(()=>{e(f_(""))},[e]);return r.jsxs(T,{gap:2,alignItems:"center",justifyContent:"space-between",children:[r.jsx(KG,{}),r.jsx(nt,{}),r.jsxs(Vo,{maxW:"400px",children:[r.jsx(Ct,{placeholder:Ce("modelManager.search"),value:t||"","data-testid":"board-search-input",onChange:n}),!!(t!=null&&t.length)&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{size:"sm",variant:"link","aria-label":Ce("boards.clearSearch"),icon:r.jsx(Nt,{}),onClick:s})})]})]})});ZG.displayName="ModelListNavigation";const YG=u.memo(()=>{const{t:e}=P(),t=z(),n=u.useCallback(()=>{t(ex(null))},[t]),s=I(hp);return r.jsxs(T,{flexDir:"column",layerStyle:"first",p:4,gap:4,borderRadius:"base",w:"50%",h:"full",children:[r.jsxs(T,{w:"full",gap:4,justifyContent:"space-between",alignItems:"center",children:[r.jsx(Ot,{fontSize:"xl",py:1,children:e("common.modelManager")}),!!s&&r.jsx(ye,{size:"sm",colorScheme:"invokeYellow",leftIcon:r.jsx(Ht,{}),onClick:n,children:e("modelManager.addModels")})]}),r.jsxs(T,{flexDir:"column",layerStyle:"second",p:4,gap:4,borderRadius:"base",w:"full",h:"full",children:[r.jsx(ZG,{}),r.jsx(s4e,{})]})]})});YG.displayName="ModelManager";const i4e=({model_key:e,model_image:t})=>{const[n,s]=u.useState(t||null),{t:i}=P(),[o,a]=kee(),[l]=_ee(),c=u.useCallback(p=>{const g=p[0];!g||!e||o({key:e,image:g}).unwrap().then(()=>{s(URL.createObjectURL(g)),fe({id:"MODEL_IMAGE_UPDATED",title:i("modelManager.modelImageUpdated"),status:"success"})}).catch(()=>{fe({id:"MODEL_IMAGE_UPDATE_FAILED",title:i("modelManager.modelImageUpdateFailed"),status:"error"})})},[e,i,o]),d=u.useCallback(()=>{e&&(s(null),l(e).unwrap().then(()=>{fe({id:"MODEL_IMAGE_DELETED",title:i("modelManager.modelImageDeleted"),status:"success"})}).catch(()=>{fe({id:"MODEL_IMAGE_DELETE_FAILED",title:i("modelManager.modelImageDeleteFailed"),status:"error"})}))},[e,i,l]),{getInputProps:h,getRootProps:f}=Ra({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:c,noDrag:!0,multiple:!1});return n?r.jsxs(ke,{position:"relative",flexShrink:0,children:[r.jsx(dn,{src:n,objectFit:"cover",objectPosition:"50% 50%",height:108,width:108,minWidth:108,borderRadius:"base"}),r.jsx(ae,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:d,"aria-label":i("modelManager.deleteModelImage"),tooltip:i("modelManager.deleteModelImage"),icon:r.jsx(ho,{}),size:"md",variant:"ghost"})]}):r.jsxs(r.Fragment,{children:[r.jsx(ae,{variant:"ghost","aria-label":i("modelManager.uploadImage"),tooltip:i("modelManager.uploadImage"),w:108,h:108,fontSize:36,icon:r.jsx(xp,{}),isLoading:a.isLoading,...f()}),r.jsx("input",{...h()})]})},o4e=gd(i4e),Jj=u.memo(({modelConfig:e,children:t})=>{const{t:n}=P();return r.jsxs(T,{alignItems:"flex-start",gap:4,children:[r.jsx(o4e,{model_key:e.key,model_image:e.cover_image}),r.jsxs(T,{flexDir:"column",gap:1,flexGrow:1,minW:0,children:[r.jsxs(T,{gap:2,children:[r.jsx(Ot,{as:"h2",fontSize:"lg",noOfLines:1,wordBreak:"break-all",children:e.name}),r.jsx(nt,{}),t]}),e.source&&r.jsxs(K,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:[n("modelManager.source"),": ",e.source]}),r.jsx(K,{noOfLines:3,children:e.description})]})]})});Jj.displayName="ModelHeader";const O8=[{value:"sd-1",label:cc["sd-1"]},{value:"sd-2",label:cc["sd-2"]},{value:"sd-3",label:cc["sd-3"]},{value:"flux",label:cc.flux},{value:"sdxl",label:cc.sdxl},{value:"sdxl-refiner",label:cc["sdxl-refiner"]}],a4e=({control:e})=>{const{field:t}=ls({control:e,name:"base"}),n=u.useMemo(()=>O8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Fe,{value:n,options:O8,onChange:s})},l4e=gd(a4e),N8=[{value:"normal",label:"Normal"},{value:"inpaint",label:"Inpaint"},{value:"depth",label:"Depth"}],c4e=({control:e})=>{const{field:t}=ls({control:e,name:"variant"}),n=u.useMemo(()=>N8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Fe,{value:n,options:N8,onChange:s})},u4e=gd(c4e),F8=[{value:"none",label:"-"},{value:"epsilon",label:"epsilon"},{value:"v_prediction",label:"v_prediction"},{value:"sample",label:"sample"}],d4e=({control:e})=>{const{field:t}=ls({control:e,name:"prediction_type"}),n=u.useMemo(()=>F8.find(i=>i.value===t.value),[t.value]),s=u.useCallback(i=>{(i==null?void 0:i.value)==="none"?t.onChange(void 0):t.onChange(i==null?void 0:i.value)},[t]);return r.jsx(Fe,{value:n,options:F8,onChange:s})},h4e=gd(d4e),B8={validate:e=>e&&e.trim().length>3||"Must be at least 3 characters"},XG=u.memo(({modelConfig:e})=>{var c,d;const{t}=P(),[n,{isLoading:s}]=p1(),i=z(),o=_p({defaultValues:e,mode:"onChange"}),a=u.useCallback(h=>{const f={key:e.key,body:h};n(f).unwrap().then(p=>{o.reset(p,{keepDefaultValues:!0}),i(tx("view")),fe({id:"MODEL_UPDATED",title:t("modelManager.modelUpdated"),status:"success"})}).catch(p=>{o.reset(),fe({id:"MODEL_UPDATE_FAILED",title:t("modelManager.modelUpdateFailed"),status:"error"})})},[i,e.key,o,t,n]),l=u.useCallback(()=>{i(tx("view"))},[i]);return r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(Jj,{modelConfig:e,children:[r.jsx(ye,{flexShrink:0,size:"sm",onClick:l,leftIcon:r.jsx(Nt,{}),children:t("common.cancel")}),r.jsx(ye,{flexShrink:0,size:"sm",colorScheme:"invokeYellow",leftIcon:r.jsx(mp,{}),onClick:o.handleSubmit(a),isLoading:s,isDisabled:!!Object.keys(o.formState.errors).length,children:t("common.save")})]}),r.jsx(T,{flexDir:"column",h:"full",children:r.jsxs("form",{children:[r.jsx(T,{w:"full",justifyContent:"space-between",gap:4,alignItems:"center",children:r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,isInvalid:!!o.formState.errors.name,children:[r.jsx(te,{children:t("modelManager.modelName")}),r.jsx(Ct,{...o.register("name",B8),size:"md"}),((c=o.formState.errors.name)==null?void 0:c.message)&&r.jsx(Yf,{children:(d=o.formState.errors.name)==null?void 0:d.message})]})}),r.jsxs(T,{flexDir:"column",gap:3,mt:"4",children:[r.jsx(T,{gap:"4",alignItems:"center",children:r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.description")}),r.jsx(Zn,{...o.register("description"),minH:32})]})}),e.type!=="clip_vision"&&r.jsx(Ot,{as:"h3",fontSize:"md",mt:"4",children:t("modelManager.modelSettings")}),r.jsxs(g1,{columns:2,gap:4,children:[e.type!=="clip_vision"&&r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.baseModel")}),r.jsx(l4e,{control:o.control})]}),e.type==="main"&&r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.variant")}),r.jsx(u4e,{control:o.control})]}),e.type==="main"&&e.format==="checkpoint"&&r.jsxs(r.Fragment,{children:[r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.pathToConfig")}),r.jsx(Ct,{...o.register("config_path",B8)})]}),r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.predictionType")}),r.jsx(h4e,{control:o.control})]}),r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:1,children:[r.jsx(te,{children:t("modelManager.upcastAttention")}),r.jsx(jn,{...o.register("upcast_attention")})]})]})]})]})]})})]})});XG.displayName="ModelEdit";const f4e=e=>u.useMemo(()=>{var n,s;return{preprocessor:{isEnabled:!ze((n=e==null?void 0:e.default_settings)==null?void 0:n.preprocessor),value:((s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor)||"none"}}},[e==null?void 0:e.default_settings]),Ai=rp(e=>{const{field:t}=ls(e),n=u.useMemo(()=>!!t.value.isEnabled,[t.value]),s=u.useCallback(i=>{const o={...t.value,isEnabled:i.target.checked};t.onChange(o)},[t]);return r.jsx(it,{size:"sm",isChecked:n,onChange:s})});Ai.displayName="SettingToggle";const $8=[{label:"Canny",value:"canny_image_processor"},{label:"MLSD",value:"mlsd_image_processor"},{label:"Depth Anything",value:"depth_anything_image_processor"},{label:"Normal BAE",value:"normalbae_image_processor"},{label:"Pidi",value:"pidi_image_processor"},{label:"Lineart",value:"lineart_image_processor"},{label:"Lineart Anime",value:"lineart_anime_image_processor"},{label:"HED",value:"hed_image_processor"},{label:"Content Shuffle",value:"content_shuffle_image_processor"},{label:"DW OpenPose",value:"dw_openpose_image_processor"},{label:"MediaPipe Face",value:"mediapipe_face_processor"},{label:"ZoeDepth",value:"zoe_depth_image_processor"},{label:"Color Map",value:"color_map_image_processor"},{label:"None",value:"none"}],QG=u.memo(e=>{const{t}=P(),{field:n}=ls(e),s=u.useCallback(a=>{if(!a)return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>$8.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"controlNetProcessor",children:r.jsx(te,{children:t("controlLayers.filter.filter")})}),r.jsx(Ai,{control:e.control,name:"preprocessor"})]}),r.jsx(Fe,{isDisabled:o,value:i,options:$8,onChange:s})]})});QG.displayName="DefaultPreprocessor";const JG=u.memo(({modelConfig:e})=>{const{t}=P(),n=f4e(e),[s,{isLoading:i}]=p1(),{handleSubmit:o,control:a,formState:l,reset:c}=_p({defaultValues:n}),d=u.useCallback(h=>{const f={preprocessor:h.preprocessor.isEnabled?h.preprocessor.value:null};s({key:e.key,body:{default_settings:f}}).unwrap().then(p=>{fe({id:"DEFAULT_SETTINGS_SAVED",title:t("modelManager.defaultSettingsSaved"),status:"success"}),c(h)}).catch(p=>{p&&fe({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${p.data.detail} `,status:"error"})})},[s,e.key,t,c]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[r.jsx(Ot,{fontSize:"md",children:t("modelManager.defaultSettings")}),r.jsx(ye,{size:"sm",leftIcon:r.jsx(mp,{}),colorScheme:"invokeYellow",isDisabled:!l.isDirty,onClick:o(d),isLoading:i,children:t("common.save")})]}),r.jsx(g1,{columns:2,gap:8,children:r.jsx(QG,{control:a,name:"preprocessor"})})]})});JG.displayName="ControlAdapterModelDefaultSettings";const ez=u.memo(({modelConfig:e})=>{const{t}=P(),[n,{isLoading:s}]=Iee(),{isOpen:i,onOpen:o,onClose:a}=ar(),l=u.useCallback(()=>{if(!e||s)return;const c=`CONVERTING_MODEL_${e.key}`;fe({id:c,title:`${t("modelManager.convertingModelBegin")}: ${e.name}`,status:"info"}),n(e.key).unwrap().then(()=>{fe({id:c,title:`${t("modelManager.modelConverted")}: ${e.name}`,status:"success"})}).catch(()=>{fe({id:c,title:`${t("modelManager.modelConversionFailed")}: ${e.name}`,status:"error"})})},[e,s,t,n]);return r.jsxs(r.Fragment,{children:[r.jsxs(ye,{onClick:o,size:"sm","aria-label":t("modelManager.convertToDiffusers"),className:" modal-close-btn",isLoading:s,flexShrink:0,children:["🧨 ",t("modelManager.convert")]}),r.jsx(ti,{title:`${t("modelManager.convert")} ${e.name}`,acceptCallback:l,acceptButtonText:`${t("modelManager.convert")}`,isOpen:i,onClose:a,useInert:!1,children:r.jsxs(T,{flexDirection:"column",rowGap:4,children:[r.jsx(K,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText1")}),r.jsxs(ki,{children:[r.jsx(Gt,{children:r.jsx(K,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText2")})}),r.jsx(Gt,{children:r.jsx(K,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText3")})}),r.jsx(Gt,{children:r.jsx(K,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText4")})}),r.jsx(Gt,{children:r.jsx(K,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText5")})})]}),r.jsx(Et,{}),r.jsx(K,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText6")})]})})]})});ez.displayName="ModelConvertButton";const tz=u.memo(()=>{const{t:e}=P(),t=z(),n=u.useCallback(()=>{t(tx("edit"))},[t]);return r.jsx(ye,{size:"sm",leftIcon:r.jsx(bp,{}),colorScheme:"invokeYellow",onClick:n,flexShrink:0,children:e("modelManager.edit")})});tz.displayName="ModelEditButton";const nz=u.memo(({modelConfig:e})=>{const{t}=P(),[n,s]=u.useState(""),[i,{isLoading:o}]=p1(),a=u.useCallback(p=>{s(p.target.value)},[]),l=u.useMemo(()=>(e==null?void 0:e.trigger_phrases)||[],[e]),c=u.useMemo(()=>{const p=[];return n.length&&l.includes(n)&&p.push("Phrase is already in list"),p},[n,l]),d=u.useCallback(async()=>{!n.length||l.includes(n)||(s(""),await i({key:e.key,body:{trigger_phrases:[...l,n]}}).unwrap())},[n,l,i,e.key]),h=u.useCallback(async p=>{const g=l.filter(m=>m!==p);await i({key:e.key,body:{trigger_phrases:g}}).unwrap()},[l,i,e]),f=u.useCallback(p=>{p.preventDefault(),d()},[d]);return r.jsxs(T,{flexDir:"column",w:"full",gap:"5",children:[r.jsx("form",{onSubmit:f,children:r.jsxs(Z,{w:"full",isInvalid:!!c.length,orientation:"vertical",children:[r.jsx(te,{children:t("modelManager.triggerPhrases")}),r.jsxs(T,{flexDir:"column",w:"full",children:[r.jsxs(T,{gap:"3",alignItems:"center",w:"full",children:[r.jsx(Ct,{value:n,onChange:a,placeholder:t("modelManager.typePhraseHere")}),r.jsx(ye,{leftIcon:r.jsx(Ht,{}),size:"sm",onClick:d,isDisabled:!n||!!c.length,isLoading:o,children:t("common.add")})]}),c.map(p=>r.jsx(Yf,{children:p},p))]})]})}),r.jsx(T,{gap:"4",flexWrap:"wrap",children:l.map((p,g)=>r.jsxs(EC,{size:"md",py:2,px:4,bg:"base.700",children:[r.jsx(a3,{children:p}),r.jsx(LC,{onClick:h.bind(null,p),isDisabled:o})]},g))})]})});nz.displayName="TriggerPhrases";const p4e=It(Qr,e=>{const{steps:t,guidance:n,scheduler:s,cfgRescaleMultiplier:i,vaePrecision:o,width:a,height:l}=e.sd,{guidance:c}=e.flux;return{initialSteps:t.initial,initialCfg:n.initial,initialScheduler:s,initialCfgRescaleMultiplier:i.initial,initialVaePrecision:o,initialWidth:a.initial,initialHeight:l.initial,initialGuidance:c.initial}}),g4e=e=>{const{initialSteps:t,initialCfg:n,initialScheduler:s,initialCfgRescaleMultiplier:i,initialVaePrecision:o,initialWidth:a,initialHeight:l,initialGuidance:c}=I(p4e);return u.useMemo(()=>{var h,f,p,g,m,y,x,C,v,b,S,w,j,E,A,L,M,O;return{vae:{isEnabled:!ze((h=e==null?void 0:e.default_settings)==null?void 0:h.vae),value:((f=e==null?void 0:e.default_settings)==null?void 0:f.vae)||"default"},vaePrecision:{isEnabled:!ze((p=e==null?void 0:e.default_settings)==null?void 0:p.vae_precision),value:((g=e==null?void 0:e.default_settings)==null?void 0:g.vae_precision)||o||"fp32"},scheduler:{isEnabled:!ze((m=e==null?void 0:e.default_settings)==null?void 0:m.scheduler),value:((y=e==null?void 0:e.default_settings)==null?void 0:y.scheduler)||s||"dpmpp_3m_k"},steps:{isEnabled:!ze((x=e==null?void 0:e.default_settings)==null?void 0:x.steps),value:((C=e==null?void 0:e.default_settings)==null?void 0:C.steps)||t},cfgScale:{isEnabled:!ze((v=e==null?void 0:e.default_settings)==null?void 0:v.cfg_scale),value:((b=e==null?void 0:e.default_settings)==null?void 0:b.cfg_scale)||n},cfgRescaleMultiplier:{isEnabled:!ze((S=e==null?void 0:e.default_settings)==null?void 0:S.cfg_rescale_multiplier),value:((w=e==null?void 0:e.default_settings)==null?void 0:w.cfg_rescale_multiplier)||i},width:{isEnabled:!ze((j=e==null?void 0:e.default_settings)==null?void 0:j.width),value:((E=e==null?void 0:e.default_settings)==null?void 0:E.width)||a},height:{isEnabled:!ze((A=e==null?void 0:e.default_settings)==null?void 0:A.height),value:((L=e==null?void 0:e.default_settings)==null?void 0:L.height)||l},guidance:{isEnabled:!ze((M=e==null?void 0:e.default_settings)==null?void 0:M.guidance),value:((O=e==null?void 0:e.default_settings)==null?void 0:O.guidance)||c}}},[e,o,s,t,n,i,a,l,c])},sz=u.memo(({control:e,optimalDimension:t})=>{const{field:n}=ls({control:e,name:"height"}),s=I(sP),{t:i}=P(),o=u.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),a=u.useCallback(d=>{const h={...n.value,value:d};n.onChange(h)},[n]),l=u.useMemo(()=>n.value.value,[n.value]),c=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramHeight",children:r.jsx(te,{children:i("parameters.height")})}),r.jsx(Ai,{control:e,name:"height"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(qe,{value:l,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:o,isDisabled:c}),r.jsx(Ae,{value:l,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,isDisabled:c})]})]})});sz.displayName="DefaultHeight";const rz=u.memo(({control:e,optimalDimension:t})=>{const{field:n}=ls({control:e,name:"width"}),s=I(rP),{t:i}=P(),o=u.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),a=u.useCallback(d=>{const h={...n.value,value:d};n.onChange(h)},[n]),l=u.useMemo(()=>n.value.value,[n.value]),c=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramWidth",children:r.jsx(te,{children:i("parameters.width")})}),r.jsx(Ai,{control:e,name:"width"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(qe,{value:l,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:o,isDisabled:c}),r.jsx(Ae,{value:l,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,isDisabled:c})]})]})});rz.displayName="DefaultWidth";const iz=u.memo(e=>{const{field:t}=ls(e),n=I(W3),{t:s}=P(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramCFGRescaleMultiplier",children:r.jsx(te,{children:s("parameters.cfgRescaleMultiplier")})}),r.jsx(Ai,{control:e.control,name:"cfgRescaleMultiplier"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(qe,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ae,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});iz.displayName="DefaultCfgRescaleMultiplier";const oz=u.memo(e=>{const{field:t}=ls(e),n=I(f1),{t:s}=P(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramCFGScale",children:r.jsx(te,{children:s("parameters.cfgScale")})}),r.jsx(Ai,{control:e.control,name:"cfgScale"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(qe,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ae,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});oz.displayName="DefaultCfgScale";const az=u.memo(e=>{const{field:t}=ls(e),n=I(J3),{t:s}=P(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax-(n.sliderMax-n.sliderMin)/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramGuidance",children:r.jsx(te,{children:s("parameters.guidance")})}),r.jsx(Ai,{control:e.control,name:"guidance"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(qe,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ae,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});az.displayName="DefaultGuidance";const lz=u.memo(e=>{const{t}=P(),{field:n}=ls(e),s=u.useCallback(a=>{if(!Ol(a==null?void 0:a.value))return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>no.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramScheduler",children:r.jsx(te,{children:t("parameters.scheduler")})}),r.jsx(Ai,{control:e.control,name:"scheduler"})]}),r.jsx(Fe,{isDisabled:o,value:i,options:no,onChange:s})]})});lz.displayName="DefaultScheduler";const cz=u.memo(e=>{const{field:t}=ls(e),n=I(UC),{t:s}=P(),i=u.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),o=u.useCallback(c=>{const d={...t.value,value:c};t.onChange(d)},[t]),a=u.useMemo(()=>t.value.value,[t.value]),l=u.useMemo(()=>!t.value.isEnabled,[t.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramSteps",children:r.jsx(te,{children:s("parameters.steps")})}),r.jsx(Ai,{control:e.control,name:"steps"})]}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(qe,{value:a,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,marks:i,isDisabled:l}),r.jsx(Ae,{value:a,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:o,isDisabled:l})]})]})});cz.displayName="DefaultSteps";const uz=u.memo(e=>{const{t}=P(),{field:n}=ls(e),s=I(hp),{data:i}=op(s??ws),[o]=Z1(),a=u.useMemo(()=>{const h=o.filter(p=>p.base===(i==null?void 0:i.base)).map(p=>({label:p.name,value:p.key}));return[{label:"Default VAE",value:"default"},...h]},[i==null?void 0:i.base,o]),l=u.useCallback(h=>{const f=h!=null&&h.value?h.value:"default",p={...n.value,value:f};n.onChange(p)},[n]),c=u.useMemo(()=>a.find(h=>h.value===n.value.value),[a,n.value]),d=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:2,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramVAE",children:r.jsx(te,{children:t("modelManager.vae")})}),r.jsx(Ai,{control:e.control,name:"vae"})]}),r.jsx(Fe,{isDisabled:d,value:c,options:a,onChange:l})]})});uz.displayName="DefaultVae";const V8=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],dz=u.memo(e=>{const{t}=P(),{field:n}=ls(e),s=u.useCallback(a=>{if(!Z3(a==null?void 0:a.value))return;const l={...n.value,value:a.value};n.onChange(l)},[n]),i=u.useMemo(()=>V8.find(a=>a.value===n.value.value),[n]),o=u.useMemo(()=>!n.value.isEnabled,[n.value]);return r.jsxs(Z,{flexDir:"column",gap:1,alignItems:"flex-start",children:[r.jsxs(T,{justifyContent:"space-between",w:"full",children:[r.jsx(Ve,{feature:"paramVAEPrecision",children:r.jsx(te,{children:t("modelManager.vaePrecision")})}),r.jsx(Ai,{control:e.control,name:"vaePrecision"})]}),r.jsx(Fe,{isDisabled:o,value:i,options:V8,onChange:s})]})});dz.displayName="DefaultVaePrecision";const hz=u.memo(({modelConfig:e})=>{const t=I(hp),{t:n}=P(),s=u.useMemo(()=>e.base==="flux",[e]),i=g4e(e),o=u.useMemo(()=>{const g=e==null?void 0:e.base;return VT(g??null)},[e]),[a,{isLoading:l}]=p1(),{handleSubmit:c,control:d,formState:h,reset:f}=_p({defaultValues:i}),p=u.useCallback(g=>{if(!t)return;const m={vae:g.vae.isEnabled?g.vae.value:null,vae_precision:g.vaePrecision.isEnabled?g.vaePrecision.value:null,cfg_scale:g.cfgScale.isEnabled?g.cfgScale.value:null,cfg_rescale_multiplier:g.cfgRescaleMultiplier.isEnabled?g.cfgRescaleMultiplier.value:null,steps:g.steps.isEnabled?g.steps.value:null,scheduler:g.scheduler.isEnabled?g.scheduler.value:null,width:g.width.isEnabled?g.width.value:null,height:g.height.isEnabled?g.height.value:null,guidance:g.guidance.isEnabled?g.guidance.value:null};a({key:t,body:{default_settings:m}}).unwrap().then(y=>{fe({id:"DEFAULT_SETTINGS_SAVED",title:n("modelManager.defaultSettingsSaved"),status:"success"}),f(g)}).catch(y=>{y&&fe({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${y.data.detail} `,status:"error"})})},[t,f,a,n]);return r.jsxs(r.Fragment,{children:[r.jsxs(T,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[r.jsx(Ot,{fontSize:"md",children:n("modelManager.defaultSettings")}),r.jsx(ye,{size:"sm",leftIcon:r.jsx(mp,{}),colorScheme:"invokeYellow",isDisabled:!h.isDirty,onClick:c(p),isLoading:l,children:n("common.save")})]}),r.jsxs(g1,{columns:2,gap:8,children:[r.jsx(uz,{control:d,name:"vae"}),!s&&r.jsx(dz,{control:d,name:"vaePrecision"}),!s&&r.jsx(lz,{control:d,name:"scheduler"}),r.jsx(cz,{control:d,name:"steps"}),s&&r.jsx(az,{control:d,name:"guidance"}),!s&&r.jsx(oz,{control:d,name:"cfgScale"}),!s&&r.jsx(iz,{control:d,name:"cfgRescaleMultiplier"}),r.jsx(rz,{control:d,optimalDimension:o}),r.jsx(sz,{control:d,optimalDimension:o})]})]})});hz.displayName="MainModelDefaultSettings";const oi=u.memo(({label:e,value:t})=>r.jsxs(Z,{flexDir:"column",alignItems:"flex-start",gap:0,children:[r.jsx(te,{children:e}),r.jsx(K,{fontSize:"md",noOfLines:1,wordBreak:"break-all",children:t||"-"})]}));oi.displayName="ModelAttrView";const fz=u.memo(({modelConfig:e})=>{const{t}=P(),n=u.useMemo(()=>e.type==="main"&&e.base!=="sdxl-refiner"||e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora"||e.type==="main"||e.type==="lora",[e.base,e.type]);return r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(Jj,{modelConfig:e,children:[e.format==="checkpoint"&&e.type==="main"&&r.jsx(ez,{modelConfig:e}),r.jsx(tz,{})]}),r.jsxs(T,{flexDir:"column",h:"full",gap:4,children:[r.jsx(ke,{layerStyle:"second",borderRadius:"base",p:4,children:r.jsxs(g1,{columns:2,gap:4,children:[r.jsx(oi,{label:t("modelManager.baseModel"),value:e.base}),r.jsx(oi,{label:t("modelManager.modelType"),value:e.type}),r.jsx(oi,{label:t("common.format"),value:e.format}),r.jsx(oi,{label:t("modelManager.path"),value:e.path}),e.type==="main"&&r.jsx(oi,{label:t("modelManager.variant"),value:e.variant}),e.type==="main"&&e.format==="diffusers"&&e.repo_variant&&r.jsx(oi,{label:t("modelManager.repoVariant"),value:e.repo_variant}),e.type==="main"&&e.format==="checkpoint"&&r.jsxs(r.Fragment,{children:[r.jsx(oi,{label:t("modelManager.pathToConfig"),value:e.config_path}),r.jsx(oi,{label:t("modelManager.predictionType"),value:e.prediction_type}),r.jsx(oi,{label:t("modelManager.upcastAttention"),value:`${e.upcast_attention}`})]}),e.type==="ip_adapter"&&e.format==="invokeai"&&r.jsx(oi,{label:t("modelManager.imageEncoderModelId"),value:e.image_encoder_model_id})]})}),n&&r.jsxs(ke,{layerStyle:"second",borderRadius:"base",p:4,children:[e.type==="main"&&e.base!=="sdxl-refiner"&&r.jsx(hz,{modelConfig:e}),(e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="control_lora")&&r.jsx(JG,{modelConfig:e}),(e.type==="main"||e.type==="lora")&&r.jsx(nz,{modelConfig:e})]})]})]})});fz.displayName="ModelView";const pz=u.memo(()=>{const{t:e}=P(),t=I(Aee),n=I(hp),{data:s,isLoading:i}=Zf(),o=u.useMemo(()=>{if(!s||n===null)return null;const a=Ia.selectById(s,n);return a||null},[s,n]);return i?r.jsx(R1,{label:e("common.loading")}):o?t==="view"?r.jsx(fz,{modelConfig:o}):r.jsx(XG,{modelConfig:o}):r.jsx(Yt,{label:e("common.somethingWentWrong"),icon:kE})});pz.displayName="Model";const gz=u.memo(()=>{const e=I(hp);return r.jsx(ke,{layerStyle:"first",p:4,borderRadius:"base",w:"50%",h:"full",children:e?r.jsx(pz,{},e):r.jsx(uR,{})})});gz.displayName="ModelPane";const m4e=()=>r.jsxs(T,{layerStyle:"body",w:"full",h:"full",gap:"2",children:[r.jsx(YG,{}),r.jsx(gz,{})]}),y4e=u.memo(m4e),v4e=()=>{const{t:e}=P(),{data:t}=fp(),n=ce(An),[s,{isLoading:i}]=Tee({fixedCacheKey:"clearInvocationCache"}),o=u.useMemo(()=>!(t!=null&&t.size)||!n,[t==null?void 0:t.size,n]);return{clearInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),fe({id:"INVOCATION_CACHE_CLEAR_SUCCEEDED",title:e("invocationCache.clearSucceeded"),status:"success"})}catch{fe({id:"INVOCATION_CACHE_CLEAR_FAILED",title:e("invocationCache.clearFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},b4e=()=>{const{t:e}=P(),{clearInvocationCache:t,isDisabled:n,isLoading:s}=v4e();return r.jsx(ye,{isDisabled:n,isLoading:s,onClick:t,children:e("invocationCache.clear")})},x4e=u.memo(b4e),C4e=({children:e,...t})=>r.jsx(Mee,{alignItems:"center",justifyContent:"center",w:"full",h:"full",layerStyle:"first",borderRadius:"base",py:2,px:3,gap:6,flexWrap:"nowrap",...t,children:e}),mz=u.memo(C4e),S4e={'&[aria-disabled="true"]':{color:"base.500"}},w4e=({label:e,value:t,isDisabled:n=!1,...s})=>r.jsxs(Pee,{flexGrow:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","aria-disabled":n,sx:S4e,...s,children:[r.jsx(Eee,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:e}),r.jsx(Lee,{children:t})]}),Oi=u.memo(w4e),j4e=()=>{const{t:e}=P(),{data:t}=fp(),n=ce(An),[s,{isLoading:i}]=Dee({fixedCacheKey:"disableInvocationCache"}),o=u.useMemo(()=>!(t!=null&&t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{disableInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),fe({id:"INVOCATION_CACHE_DISABLE_SUCCEEDED",title:e("invocationCache.disableSucceeded"),status:"success"})}catch{fe({id:"INVOCATION_CACHE_DISABLE_FAILED",title:e("invocationCache.disableFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},k4e=()=>{const{t:e}=P(),{data:t}=fp(),n=ce(An),[s,{isLoading:i}]=Ree({fixedCacheKey:"enableInvocationCache"}),o=u.useMemo(()=>(t==null?void 0:t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{enableInvocationCache:u.useCallback(async()=>{if(!o)try{await s().unwrap(),fe({id:"INVOCATION_CACHE_ENABLE_SUCCEEDED",title:e("invocationCache.enableSucceeded"),status:"success"})}catch{fe({id:"INVOCATION_CACHE_ENABLE_FAILED",title:e("invocationCache.enableFailed"),status:"error"})}},[o,s,e]),isLoading:i,cacheStatus:t,isDisabled:o}},_4e=()=>{const{t:e}=P(),{data:t}=fp(),{enableInvocationCache:n,isDisabled:s,isLoading:i}=k4e(),{disableInvocationCache:o,isDisabled:a,isLoading:l}=j4e();return t!=null&&t.enabled?r.jsx(ye,{isDisabled:a,isLoading:l,onClick:o,children:e("invocationCache.disable")}):r.jsx(ye,{isDisabled:s,isLoading:i,onClick:n,children:e("invocationCache.enable")})},I4e=u.memo(_4e),A4e=()=>{const{t:e}=P(),{data:t}=fp(void 0);return r.jsxs(mz,{children:[r.jsx(Oi,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.cacheSize"),value:(t==null?void 0:t.size)??0}),r.jsx(Oi,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.hits"),value:(t==null?void 0:t.hits)??0}),r.jsx(Oi,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.misses"),value:(t==null?void 0:t.misses)??0}),r.jsx(Oi,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.maxCacheSize"),value:(t==null?void 0:t.max_size)??0}),r.jsxs(as,{w:24,orientation:"vertical",size:"sm",children:[r.jsx(x4e,{}),r.jsx(I4e,{})]})]})},T4e=u.memo(A4e),_y=0,Ga=1,md=2,yz=4;function vz(e,t){return n=>e(t(n))}function M4e(e,t){return t(e)}function bz(e,t){return n=>e(t,n)}function G8(e,t){return()=>e(t)}function Iy(e,t){return t(e),e}function an(...e){return e}function P4e(e){e()}function z8(e){return()=>e}function E4e(...e){return()=>{e.map(P4e)}}function ek(e){return e!==void 0}function sc(){}function zt(e,t){return e(Ga,t)}function gt(e,t){e(_y,t)}function tk(e){e(md)}function bs(e){return e(yz)}function Ue(e,t){return zt(e,bz(t,_y))}function oo(e,t){const n=e(Ga,s=>{n(),t(s)});return n}function jt(){const e=[];return(t,n)=>{switch(t){case md:e.splice(0,e.length);return;case Ga:return e.push(n),()=>{const s=e.indexOf(n);s>-1&&e.splice(s,1)};case _y:e.slice().forEach(s=>{s(n)});return;default:throw new Error(`unrecognized action ${t}`)}}}function Ie(e){let t=e;const n=jt();return(s,i)=>{switch(s){case Ga:i(t);break;case _y:t=i;break;case yz:return t}return n(s,i)}}function L4e(e){let t,n;const s=()=>t&&t();return function(i,o){switch(i){case Ga:return o?n===o?void 0:(s(),n=o,t=zt(e,o),t):(s(),sc);case md:s(),n=null;return;default:throw new Error(`unrecognized action ${i}`)}}}function wr(e){return Iy(jt(),t=>Ue(e,t))}function xs(e,t){return Iy(Ie(t),n=>Ue(e,n))}function D4e(...e){return t=>e.reduceRight(M4e,t)}function we(e,...t){const n=D4e(...t);return(s,i)=>{switch(s){case Ga:return zt(e,n(i));case md:tk(e);return}}}function xz(e,t){return e===t}function rn(e=xz){let t;return n=>s=>{e(t,s)||(t=s,n(s))}}function rt(e){return t=>n=>{e(n)&&t(n)}}function We(e){return t=>vz(t,e)}function Ni(e){return t=>()=>t(e)}function Hi(e,t){return n=>s=>n(t=e(t,s))}function _u(e){return t=>n=>{e>0?e--:t(n)}}function ha(e){let t=null,n;return s=>i=>{t=i,!n&&(n=setTimeout(()=>{n=void 0,s(t)},e))}}function H8(e){let t,n;return s=>i=>{t=i,n&&clearTimeout(n),n=setTimeout(()=>{s(t)},e)}}function mt(...e){const t=new Array(e.length);let n=0,s=null;const i=Math.pow(2,e.length)-1;return e.forEach((o,a)=>{const l=Math.pow(2,a);zt(o,c=>{const d=n;n=n|l,t[a]=c,d!==i&&n===i&&s&&(s(),s=null)})}),o=>a=>{const l=()=>o([a].concat(t));n===i?l():s=l}}function W8(...e){return function(t,n){switch(t){case Ga:return E4e(...e.map(s=>zt(s,n)));case md:return;default:throw new Error(`unrecognized action ${t}`)}}}function st(e,t=xz){return we(e,rn(t))}function qn(...e){const t=jt(),n=new Array(e.length);let s=0;const i=Math.pow(2,e.length)-1;return e.forEach((o,a)=>{const l=Math.pow(2,a);zt(o,c=>{n[a]=c,s=s|l,s===i&&gt(t,n)})}),function(o,a){switch(o){case Ga:return s===i&&a(n),zt(t,a);case md:return tk(t);default:throw new Error(`unrecognized action ${o}`)}}}function Ft(e,t=[],{singleton:n}={singleton:!0}){return{id:R4e(),constructor:e,dependencies:t,singleton:n}}const R4e=()=>Symbol();function O4e(e){const t=new Map,n=({id:s,constructor:i,dependencies:o,singleton:a})=>{if(a&&t.has(s))return t.get(s);const l=i(o.map(c=>n(c)));return a&&t.set(s,l),l};return n(e)}function N4e(e,t){const n={},s={};let i=0;const o=e.length;for(;i<o;)s[e[i]]=1,i+=1;for(const a in t)s.hasOwnProperty(a)||(n[a]=t[a]);return n}const Ug=typeof document<"u"?me.useLayoutEffect:me.useEffect;function Cz(e,t,n){const s=Object.keys(t.required||{}),i=Object.keys(t.optional||{}),o=Object.keys(t.methods||{}),a=Object.keys(t.events||{}),l=me.createContext({});function c(C,v){C.propsReady&&gt(C.propsReady,!1);for(const b of s){const S=C[t.required[b]];gt(S,v[b])}for(const b of i)if(b in v){const S=C[t.optional[b]];gt(S,v[b])}C.propsReady&&gt(C.propsReady,!0)}function d(C){return o.reduce((v,b)=>(v[b]=S=>{const w=C[t.methods[b]];gt(w,S)},v),{})}function h(C){return a.reduce((v,b)=>(v[b]=L4e(C[t.events[b]]),v),{})}const f=me.forwardRef((C,v)=>{const{children:b,...S}=C,[w]=me.useState(()=>Iy(O4e(e),A=>c(A,S))),[j]=me.useState(G8(h,w));Ug(()=>{for(const A of a)A in S&&zt(j[A],S[A]);return()=>{Object.values(j).map(tk)}},[S,j,w]),Ug(()=>{c(w,S)}),me.useImperativeHandle(v,z8(d(w)));const E=n;return r.jsx(l.Provider,{value:w,children:n?r.jsx(E,{...N4e([...s,...i,...a],S),children:b}):b})}),p=C=>me.useCallback(bz(gt,me.useContext(l)[C]),[C]),g=C=>{const b=me.useContext(l)[C],S=me.useCallback(w=>zt(b,w),[b]);return me.useSyncExternalStore(S,()=>bs(b),()=>bs(b))},m=C=>{const b=me.useContext(l)[C],[S,w]=me.useState(G8(bs,b));return Ug(()=>zt(b,j=>{j!==S&&w(z8(j))}),[b,S]),S},y=me.version.startsWith("18")?g:m;return{Component:f,usePublisher:p,useEmitterValue:y,useEmitter:(C,v)=>{const S=me.useContext(l)[C];Ug(()=>zt(S,v),[v,S])}}}const Sz=typeof document<"u"?me.useLayoutEffect:me.useEffect;var jr=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(jr||{});const F4e={0:"debug",1:"log",2:"warn",3:"error"},B4e=()=>typeof globalThis>"u"?window:globalThis,za=Ft(()=>{const e=Ie(3);return{log:Ie((n,s,i=1)=>{var o;const a=(o=B4e().VIRTUOSO_LOG_LEVEL)!=null?o:bs(e);i>=a&&console[F4e[i]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",n,s)}),logLevel:e}},[],{singleton:!0});function nk(e,t,n){const s=me.useRef(null);let i=o=>{};if(typeof ResizeObserver<"u"){const o=me.useMemo(()=>new ResizeObserver(a=>{const l=()=>{const c=a[0].target;c.offsetParent!==null&&e(c)};n?l():requestAnimationFrame(l)}),[e]);i=a=>{a&&t?(o.observe(a),s.current=a):(s.current&&o.unobserve(s.current),s.current=null)}}return{ref:s,callbackRef:i}}function rc(e,t,n){return nk(e,t,n).callbackRef}function $4e(e,t,n,s,i,o,a,l,c){const d=me.useCallback(h=>{const f=V4e(h.children,t,l?"offsetWidth":"offsetHeight",i);let p=h.parentElement;for(;!p.dataset.virtuosoScroller;)p=p.parentElement;const g=p.lastElementChild.dataset.viewportType==="window",m=a?l?a.scrollLeft:a.scrollTop:g?l?window.pageXOffset||document.documentElement.scrollLeft:window.pageYOffset||document.documentElement.scrollTop:l?p.scrollLeft:p.scrollTop,y=a?l?a.scrollWidth:a.scrollHeight:g?l?document.documentElement.scrollWidth:document.documentElement.scrollHeight:l?p.scrollWidth:p.scrollHeight,x=a?l?a.offsetWidth:a.offsetHeight:g?l?window.innerWidth:window.innerHeight:l?p.offsetWidth:p.offsetHeight;s({scrollTop:Math.max(m,0),scrollHeight:y,viewportHeight:x}),o==null||o(l?U8("column-gap",getComputedStyle(h).columnGap,i):U8("row-gap",getComputedStyle(h).rowGap,i)),f!==null&&e(f)},[e,t,i,o,a,s]);return nk(d,n,c)}function V4e(e,t,n,s){const i=e.length;if(i===0)return null;const o=[];for(let a=0;a<i;a++){const l=e.item(a);if(!l||l.dataset.index===void 0)continue;const c=parseInt(l.dataset.index),d=parseFloat(l.dataset.knownSize),h=t(l,n);if(h===0&&s("Zero-sized element, this should not happen",{child:l},jr.ERROR),h===d)continue;const f=o[o.length-1];o.length===0||f.size!==h||f.endIndex!==c-1?o.push({startIndex:c,endIndex:c,size:h}):o[o.length-1].endIndex++}return o}function U8(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,jr.WARN),t==="normal"?0:parseInt(t??"0",10)}function wa(e,t){return Math.round(e.getBoundingClientRect()[t])}function wz(e,t){return Math.abs(e-t)<1.01}function jz(e,t,n,s=sc,i,o){const a=me.useRef(null),l=me.useRef(null),c=me.useRef(null),d=me.useCallback(p=>{const g=p.target,m=g===window||g===document,y=o?m?window.pageXOffset||document.documentElement.scrollLeft:g.scrollLeft:m?window.pageYOffset||document.documentElement.scrollTop:g.scrollTop,x=o?m?document.documentElement.scrollWidth:g.scrollWidth:m?document.documentElement.scrollHeight:g.scrollHeight,C=o?m?window.innerWidth:g.offsetWidth:m?window.innerHeight:g.offsetHeight,v=()=>{e({scrollTop:Math.max(y,0),scrollHeight:x,viewportHeight:C})};p.suppressFlushSync?v():aP.flushSync(v),l.current!==null&&(y===l.current||y<=0||y===x-C)&&(l.current=null,t(!0),c.current&&(clearTimeout(c.current),c.current=null))},[e,t]);me.useEffect(()=>{const p=i||a.current;return s(i||a.current),d({target:p,suppressFlushSync:!0}),p.addEventListener("scroll",d,{passive:!0}),()=>{s(null),p.removeEventListener("scroll",d)}},[a,d,n,s,i]);function h(p){const g=a.current;if(!g||(o?"offsetWidth"in g&&g.offsetWidth===0:"offsetHeight"in g&&g.offsetHeight===0))return;const m=p.behavior==="smooth";let y,x,C;g===window?(x=Math.max(wa(document.documentElement,o?"width":"height"),o?document.documentElement.scrollWidth:document.documentElement.scrollHeight),y=o?window.innerWidth:window.innerHeight,C=o?document.documentElement.scrollLeft:document.documentElement.scrollTop):(x=g[o?"scrollWidth":"scrollHeight"],y=wa(g,o?"width":"height"),C=g[o?"scrollLeft":"scrollTop"]);const v=x-y;if(p.top=Math.ceil(Math.max(Math.min(v,p.top),0)),wz(y,x)||p.top===C){e({scrollTop:C,scrollHeight:x,viewportHeight:y}),m&&t(!0);return}m?(l.current=p.top,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{c.current=null,l.current=null,t(!0)},1e3)):l.current=null,o&&(p={left:p.top,behavior:p.behavior}),g.scrollTo(p)}function f(p){o&&(p={left:p.top,behavior:p.behavior}),a.current.scrollBy(p)}return{scrollerRef:a,scrollByCallback:f,scrollToCallback:h}}const Os=Ft(()=>{const e=jt(),t=jt(),n=Ie(0),s=jt(),i=Ie(0),o=jt(),a=jt(),l=Ie(0),c=Ie(0),d=Ie(0),h=Ie(0),f=jt(),p=jt(),g=Ie(!1),m=Ie(!1),y=Ie(!1);return Ue(we(e,We(({scrollTop:x})=>x)),t),Ue(we(e,We(({scrollHeight:x})=>x)),a),Ue(t,i),{scrollContainerState:e,scrollTop:t,viewportHeight:o,headerHeight:l,fixedHeaderHeight:c,fixedFooterHeight:d,footerHeight:h,scrollHeight:a,smoothScrollTargetReached:s,horizontalDirection:m,skipAnimationFrameInResizeObserver:y,scrollTo:f,scrollBy:p,statefulScrollTop:i,deviation:n,scrollingInProgress:g}},[],{singleton:!0}),Pf={lvl:0};function kz(e,t,n,s=Pf,i=Pf){return{k:e,v:t,lvl:n,l:s,r:i}}function Zt(e){return e===Pf}function au(){return Pf}function A2(e,t){if(Zt(e))return Pf;const{k:n,l:s,r:i}=e;if(t===n){if(Zt(s))return i;if(Zt(i))return s;{const[o,a]=_z(s);return xm($n(e,{k:o,v:a,l:Iz(s)}))}}else return t<n?xm($n(e,{l:A2(s,t)})):xm($n(e,{r:A2(i,t)}))}function Ef(e,t){if(!Zt(e))return t===e.k?e.v:t<e.k?Ef(e.l,t):Ef(e.r,t)}function ji(e,t,n="k"){if(Zt(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const s=ji(e.r,t,n);return s[0]===-1/0?[e.k,e.v]:s}return ji(e.l,t,n)}function xr(e,t,n){return Zt(e)?kz(t,n,1):t===e.k?$n(e,{k:t,v:n}):t<e.k?q8($n(e,{l:xr(e.l,t,n)})):q8($n(e,{r:xr(e.r,t,n)}))}function T2(e,t,n){if(Zt(e))return[];const{k:s,v:i,l:o,r:a}=e;let l=[];return s>t&&(l=l.concat(T2(o,t,n))),s>=t&&s<=n&&l.push({k:s,v:i}),s<=n&&(l=l.concat(T2(a,t,n))),l}function hl(e){return Zt(e)?[]:[...hl(e.l),{k:e.k,v:e.v},...hl(e.r)]}function _z(e){return Zt(e.r)?[e.k,e.v]:_z(e.r)}function Iz(e){return Zt(e.r)?e.l:xm($n(e,{r:Iz(e.r)}))}function $n(e,t){return kz(t.k!==void 0?t.k:e.k,t.v!==void 0?t.v:e.v,t.lvl!==void 0?t.lvl:e.lvl,t.l!==void 0?t.l:e.l,t.r!==void 0?t.r:e.r)}function pb(e){return Zt(e)||e.lvl>e.r.lvl}function q8(e){return M2(Tz(e))}function xm(e){const{l:t,r:n,lvl:s}=e;if(n.lvl>=s-1&&t.lvl>=s-1)return e;if(s>n.lvl+1){if(pb(t))return Tz($n(e,{lvl:s-1}));if(!Zt(t)&&!Zt(t.r))return $n(t.r,{l:$n(t,{r:t.r.l}),r:$n(e,{l:t.r.r,lvl:s-1}),lvl:s});throw new Error("Unexpected empty nodes")}else{if(pb(e))return M2($n(e,{lvl:s-1}));if(!Zt(n)&&!Zt(n.l)){const i=n.l,o=pb(i)?n.lvl-1:n.lvl;return $n(i,{l:$n(e,{r:i.l,lvl:s-1}),r:M2($n(n,{l:i.r,lvl:o})),lvl:i.lvl+1})}else throw new Error("Unexpected empty nodes")}}function Ay(e,t,n){if(Zt(e))return[];const s=ji(e,t)[0];return G4e(T2(e,s,n))}function Az(e,t){const n=e.length;if(n===0)return[];let{index:s,value:i}=t(e[0]);const o=[];for(let a=1;a<n;a++){const{index:l,value:c}=t(e[a]);o.push({start:s,end:l-1,value:i}),s=l,i=c}return o.push({start:s,end:1/0,value:i}),o}function G4e(e){return Az(e,({k:t,v:n})=>({index:t,value:n}))}function M2(e){const{r:t,lvl:n}=e;return!Zt(t)&&!Zt(t.r)&&t.lvl===n&&t.r.lvl===n?$n(t,{l:$n(e,{r:t.l}),lvl:n+1}):e}function Tz(e){const{l:t}=e;return!Zt(t)&&t.lvl===e.lvl?$n(t,{r:$n(e,{l:t.r})}):e}function M0(e,t,n,s=0){let i=e.length-1;for(;s<=i;){const o=Math.floor((s+i)/2),a=e[o],l=n(a,t);if(l===0)return o;if(l===-1){if(i-s<2)return o-1;i=o-1}else{if(i===s)return o;s=o+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function Mz(e,t,n){return e[M0(e,t,n)]}function z4e(e,t,n,s){const i=M0(e,t,s),o=M0(e,n,s,i);return e.slice(i,o+1)}const sk=Ft(()=>({recalcInProgress:Ie(!1)}),[],{singleton:!0});function H4e(e){const{size:t,startIndex:n,endIndex:s}=e;return i=>i.start===n&&(i.end===s||i.end===1/0)&&i.value===t}function K8(e,t){let n=0,s=0;for(;n<e;)n+=t[s+1]-t[s]-1,s++;return s-(n===e?0:1)}function W4e(e,t){let n=Zt(e)?0:1/0;for(const s of t){const{size:i,startIndex:o,endIndex:a}=s;if(n=Math.min(n,o),Zt(e)){e=xr(e,0,i);continue}const l=Ay(e,o-1,a+1);if(l.some(H4e(s)))continue;let c=!1,d=!1;for(const{start:h,end:f,value:p}of l)c?(a>=h||i===p)&&(e=A2(e,h)):(d=p!==i,c=!0),f>a&&a>=h&&p!==i&&(e=xr(e,a+1,p));d&&(e=xr(e,o,i))}return[e,n]}function U4e(){return{offsetTree:[],sizeTree:au(),groupOffsetTree:au(),lastIndex:0,lastOffset:0,lastSize:0,groupIndices:[]}}function rk({index:e},t){return t===e?0:t<e?-1:1}function q4e({offset:e},t){return t===e?0:t<e?-1:1}function K4e(e){return{index:e.index,value:e}}function Z4e(e,t,n,s=0){return s>0&&(t=Math.max(t,Mz(e,s,rk).offset)),Az(z4e(e,t,n,q4e),K4e)}function P2(e,t,n,s){let i=e,o=0,a=0,l=0,c=0;if(t!==0){c=M0(i,t-1,rk),l=i[c].offset;const h=ji(n,t-1);o=h[0],a=h[1],i.length&&i[c].size===ji(n,t)[1]&&(c-=1),i=i.slice(0,c+1)}else i=[];for(const{start:d,value:h}of Ay(n,t,1/0)){const f=d-o,p=f*a+l+f*s;i.push({offset:p,size:h,index:d}),o=d,l=p,a=h}return{offsetTree:i,lastIndex:o,lastOffset:l,lastSize:a}}function Y4e(e,[t,n,s,i]){t.length>0&&s("received item sizes",t,jr.DEBUG);const o=e.sizeTree;let a=o,l=0;if(n.length>0&&Zt(o)&&t.length===2){const p=t[0].size,g=t[1].size;a=n.reduce((m,y)=>xr(xr(m,y,p),y+1,g),a)}else[a,l]=W4e(a,t);if(a===o)return e;const{offsetTree:c,lastIndex:d,lastSize:h,lastOffset:f}=P2(e.offsetTree,l,a,i);return{sizeTree:a,offsetTree:c,lastIndex:d,lastOffset:f,lastSize:h,groupOffsetTree:n.reduce((p,g)=>xr(p,g,Lf(g,c,i)),au()),groupIndices:n}}function Lf(e,t,n){if(t.length===0)return 0;const{offset:s,index:i,size:o}=Mz(t,e,rk),a=e-i,l=o*a+(a-1)*n+s;return l>0?l+n:l}function X4e(e){return typeof e.groupIndex<"u"}function Pz(e,t,n){if(X4e(e))return t.groupIndices[e.groupIndex]+1;{const s=e.index==="LAST"?n:e.index;let i=Ez(s,t);return i=Math.max(0,i,Math.min(n,i)),i}}function Ez(e,t){if(!Ty(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function Ty(e){return!Zt(e.groupOffsetTree)}function Q4e(e){return hl(e).map(({k:t,v:n},s,i)=>{const o=i[s+1],a=o?o.k-1:1/0;return{startIndex:t,endIndex:a,size:n}})}const J4e={offsetHeight:"height",offsetWidth:"width"},mo=Ft(([{log:e},{recalcInProgress:t}])=>{const n=jt(),s=jt(),i=xs(s,0),o=jt(),a=jt(),l=Ie(0),c=Ie([]),d=Ie(void 0),h=Ie(void 0),f=Ie((w,j)=>wa(w,J4e[j])),p=Ie(void 0),g=Ie(0),m=U4e(),y=xs(we(n,mt(c,e,g),Hi(Y4e,m),rn()),m),x=xs(we(c,rn(),Hi((w,j)=>({prev:w.current,current:j}),{prev:[],current:[]}),We(({prev:w})=>w)),[]);Ue(we(c,rt(w=>w.length>0),mt(y,g),We(([w,j,E])=>{const A=w.reduce((L,M,O)=>xr(L,M,Lf(M,j.offsetTree,E)||O),au());return{...j,groupIndices:w,groupOffsetTree:A}})),y),Ue(we(s,mt(y),rt(([w,{lastIndex:j}])=>w<j),We(([w,{lastIndex:j,lastSize:E}])=>[{startIndex:w,endIndex:j,size:E}])),n),Ue(d,h);const C=xs(we(d,We(w=>w===void 0)),!0);Ue(we(h,rt(w=>w!==void 0&&Zt(bs(y).sizeTree)),We(w=>[{startIndex:0,endIndex:0,size:w}])),n);const v=wr(we(n,mt(y),Hi(({sizes:w},[j,E])=>({changed:E!==w,sizes:E}),{changed:!1,sizes:m}),We(w=>w.changed)));zt(we(l,Hi((w,j)=>({diff:w.prev-j,prev:j}),{diff:0,prev:0}),We(w=>w.diff)),w=>{const{groupIndices:j}=bs(y);if(w>0)gt(t,!0),gt(o,w+K8(w,j));else if(w<0){const E=bs(x);E.length>0&&(w-=K8(-w,E)),gt(a,w)}}),zt(we(l,mt(e)),([w,j])=>{w<0&&j("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:l},jr.ERROR)});const b=wr(o);Ue(we(o,mt(y),We(([w,j])=>{const E=j.groupIndices.length>0,A=[],L=j.lastSize;if(E){const M=Ef(j.sizeTree,0);let O=0,F=0;for(;O<w;){const D=j.groupIndices[F],$=j.groupIndices.length===F+1?1/0:j.groupIndices[F+1]-D-1;A.push({startIndex:D,endIndex:D,size:M}),A.push({startIndex:D+1,endIndex:D+1+$-1,size:L}),F++,O+=$+1}const _=hl(j.sizeTree);return O!==w&&_.shift(),_.reduce((D,{k:$,v:G})=>{let ee=D.ranges;return D.prevSize!==0&&(ee=[...D.ranges,{startIndex:D.prevIndex,endIndex:$+w-1,size:D.prevSize}]),{ranges:ee,prevIndex:$+w,prevSize:G}},{ranges:A,prevIndex:w,prevSize:0}).ranges}return hl(j.sizeTree).reduce((M,{k:O,v:F})=>({ranges:[...M.ranges,{startIndex:M.prevIndex,endIndex:O+w-1,size:M.prevSize}],prevIndex:O+w,prevSize:F}),{ranges:[],prevIndex:0,prevSize:L}).ranges})),n);const S=wr(we(a,mt(y,g),We(([w,{offsetTree:j},E])=>{const A=-w;return Lf(A,j,E)})));return Ue(we(a,mt(y,g),We(([w,j,E])=>{if(j.groupIndices.length>0){if(Zt(j.sizeTree))return j;let L=au();const M=bs(x);let O=0,F=0,_=0;for(;O<-w;){_=M[F];const D=M[F+1]-_-1;F++,O+=D+1}if(L=hl(j.sizeTree).reduce((D,{k:$,v:G})=>xr(D,Math.max(0,$+w),G),L),O!==-w){const D=Ef(j.sizeTree,_);L=xr(L,0,D);const $=ji(j.sizeTree,-w+1)[1];L=xr(L,1,$)}return{...j,sizeTree:L,...P2(j.offsetTree,0,L,E)}}else{const L=hl(j.sizeTree).reduce((M,{k:O,v:F})=>xr(M,Math.max(0,O+w),F),au());return{...j,sizeTree:L,...P2(j.offsetTree,0,L,E)}}})),y),{data:p,totalCount:s,sizeRanges:n,groupIndices:c,defaultItemSize:h,fixedItemSize:d,unshiftWith:o,shiftWith:a,shiftWithOffset:S,beforeUnshiftWith:b,firstItemIndex:l,gap:g,sizes:y,listRefresh:v,statefulTotalCount:i,trackItemSizes:C,itemSize:f}},an(za,sk),{singleton:!0}),e5e=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function Lz(e){const t=typeof e=="number"?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!e5e)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const qp=Ft(([{sizes:e,totalCount:t,listRefresh:n,gap:s},{scrollingInProgress:i,viewportHeight:o,scrollTo:a,smoothScrollTargetReached:l,headerHeight:c,footerHeight:d,fixedHeaderHeight:h,fixedFooterHeight:f},{log:p}])=>{const g=jt(),m=jt(),y=Ie(0);let x=null,C=null,v=null;function b(){x&&(x(),x=null),v&&(v(),v=null),C&&(clearTimeout(C),C=null),gt(i,!1)}return Ue(we(g,mt(e,o,t,y,c,d,p),mt(s,h,f),We(([[S,w,j,E,A,L,M,O],F,_,R])=>{const D=Lz(S),{align:$,behavior:G,offset:ee}=D,Q=E-1,se=Pz(D,w,Q);let ne=Lf(se,w.offsetTree,F)+L;$==="end"?(ne+=_+ji(w.sizeTree,se)[1]-j+R,se===Q&&(ne+=M)):$==="center"?ne+=(_+ji(w.sizeTree,se)[1]-j+R)/2:ne-=A,ee&&(ne+=ee);const H=V=>{b(),V?(O("retrying to scroll to",{location:S},jr.DEBUG),gt(g,S)):(gt(m,!0),O("list did not change, scroll successful",{},jr.DEBUG))};if(b(),G==="smooth"){let V=!1;v=zt(n,Y=>{V=V||Y}),x=oo(l,()=>{H(V)})}else x=oo(we(n,t5e(150)),H);return C=setTimeout(()=>{b()},1200),gt(i,!0),O("scrolling from index to",{index:se,top:ne,behavior:G},jr.DEBUG),{top:ne,behavior:G}})),a),{scrollToIndex:g,scrollTargetReached:m,topListHeight:y}},an(mo,Os,za),{singleton:!0});function t5e(e){return t=>{const n=setTimeout(()=>{t(!1)},e);return s=>{s&&(t(!0),clearTimeout(n))}}}const Df="up",tf="down",n5e="none",s5e={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollTop:0,viewportHeight:0,scrollHeight:0}},r5e=0,Kp=Ft(([{scrollContainerState:e,scrollTop:t,viewportHeight:n,headerHeight:s,footerHeight:i,scrollBy:o}])=>{const a=Ie(!1),l=Ie(!0),c=jt(),d=jt(),h=Ie(4),f=Ie(r5e),p=xs(we(W8(we(st(t),_u(1),Ni(!0)),we(st(t),_u(1),Ni(!1),H8(100))),rn()),!1),g=xs(we(W8(we(o,Ni(!0)),we(o,Ni(!1),H8(200))),rn()),!1);Ue(we(qn(st(t),st(f)),We(([v,b])=>v<=b),rn()),l),Ue(we(l,ha(50)),d);const m=wr(we(qn(e,st(n),st(s),st(i),st(h)),Hi((v,[{scrollTop:b,scrollHeight:S},w,j,E,A])=>{const L=b+w-S>-A,M={viewportHeight:w,scrollTop:b,scrollHeight:S};if(L){let F,_;return b>v.state.scrollTop?(F="SCROLLED_DOWN",_=v.state.scrollTop-b):(F="SIZE_DECREASED",_=v.state.scrollTop-b||v.scrollTopDelta),{atBottom:!0,state:M,atBottomBecause:F,scrollTopDelta:_}}let O;return M.scrollHeight>v.state.scrollHeight?O="SIZE_INCREASED":w<v.state.viewportHeight?O="VIEWPORT_HEIGHT_DECREASING":b<v.state.scrollTop?O="SCROLLING_UPWARDS":O="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:O,state:M}},s5e),rn((v,b)=>v&&v.atBottom===b.atBottom))),y=xs(we(e,Hi((v,{scrollTop:b,scrollHeight:S,viewportHeight:w})=>{if(wz(v.scrollHeight,S))return{scrollTop:b,scrollHeight:S,jump:0,changed:!1};{const j=S-(b+w)<1;return v.scrollTop!==b&&j?{scrollHeight:S,scrollTop:b,jump:v.scrollTop-b,changed:!0}:{scrollHeight:S,scrollTop:b,jump:0,changed:!0}}},{scrollHeight:0,jump:0,scrollTop:0,changed:!1}),rt(v=>v.changed),We(v=>v.jump)),0);Ue(we(m,We(v=>v.atBottom)),a),Ue(we(a,ha(50)),c);const x=Ie(tf);Ue(we(e,We(({scrollTop:v})=>v),rn(),Hi((v,b)=>bs(g)?{direction:v.direction,prevScrollTop:b}:{direction:b<v.prevScrollTop?Df:tf,prevScrollTop:b},{direction:tf,prevScrollTop:0}),We(v=>v.direction)),x),Ue(we(e,ha(50),Ni(n5e)),x);const C=Ie(0);return Ue(we(p,rt(v=>!v),Ni(0)),C),Ue(we(t,ha(100),mt(p),rt(([v,b])=>!!b),Hi(([v,b],[S])=>[b,S],[0,0]),We(([v,b])=>b-v)),C),{isScrolling:p,isAtTop:l,isAtBottom:a,atBottomState:m,atTopStateChange:d,atBottomStateChange:c,scrollDirection:x,atBottomThreshold:h,atTopThreshold:f,scrollVelocity:C,lastJumpDueToItemResize:y}},an(Os)),Ha=Ft(([{log:e}])=>{const t=Ie(!1),n=wr(we(t,rt(s=>s),rn()));return zt(t,s=>{s&&bs(e)("props updated",{},jr.DEBUG)}),{propsReady:t,didMount:n}},an(za),{singleton:!0});function ik(e,t){e==0?t():requestAnimationFrame(()=>ik(e-1,t))}function ok(e,t){const n=t-1;return typeof e=="number"?e:e.index==="LAST"?n:e.index}const Zp=Ft(([{sizes:e,listRefresh:t,defaultItemSize:n},{scrollTop:s},{scrollToIndex:i,scrollTargetReached:o},{didMount:a}])=>{const l=Ie(!0),c=Ie(0),d=Ie(!0);return Ue(we(a,mt(c),rt(([h,f])=>!!f),Ni(!1)),l),Ue(we(a,mt(c),rt(([h,f])=>!!f),Ni(!1)),d),zt(we(qn(t,a),mt(l,e,n,d),rt(([[,h],f,{sizeTree:p},g,m])=>h&&(!Zt(p)||ek(g))&&!f&&!m),mt(c)),([,h])=>{oo(o,()=>{gt(d,!0)}),ik(4,()=>{oo(s,()=>{gt(l,!0)}),gt(i,h)})}),{scrolledToInitialItem:l,initialTopMostItemIndex:c,initialItemFinalLocationReached:d}},an(mo,Os,qp,Ha),{singleton:!0});function Z8(e){return e?e==="smooth"?"smooth":"auto":!1}const i5e=(e,t)=>typeof e=="function"?Z8(e(t)):t&&Z8(e),o5e=Ft(([{totalCount:e,listRefresh:t},{isAtBottom:n,atBottomState:s},{scrollToIndex:i},{scrolledToInitialItem:o},{propsReady:a,didMount:l},{log:c},{scrollingInProgress:d}])=>{const h=Ie(!1),f=jt();let p=null;function g(y){gt(i,{index:"LAST",align:"end",behavior:y})}zt(we(qn(we(st(e),_u(1)),l),mt(st(h),n,o,d),We(([[y,x],C,v,b,S])=>{let w=x&&b,j="auto";return w&&(j=i5e(C,v||S),w=w&&!!j),{totalCount:y,shouldFollow:w,followOutputBehavior:j}}),rt(({shouldFollow:y})=>y)),({totalCount:y,followOutputBehavior:x})=>{p&&(p(),p=null),p=oo(t,()=>{bs(c)("following output to ",{totalCount:y},jr.DEBUG),g(x),p=null})});function m(y){const x=oo(s,C=>{y&&!C.atBottom&&C.notAtBottomBecause==="SIZE_INCREASED"&&!p&&(bs(c)("scrolling to bottom due to increased size",{},jr.DEBUG),g("auto"))});setTimeout(x,100)}return zt(we(qn(st(h),e,a),rt(([y,,x])=>y&&x),Hi(({value:y},[,x])=>({refreshed:y===x,value:x}),{refreshed:!1,value:0}),rt(({refreshed:y})=>y),mt(h,e)),([,y])=>{bs(o)&&m(y!==!1)}),zt(f,()=>{m(bs(h)!==!1)}),zt(qn(st(h),s),([y,x])=>{y&&!x.atBottom&&x.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&g("auto")}),{followOutput:h,autoscrollToBottom:f}},an(mo,Kp,qp,Zp,Ha,za,Os));function a5e(e){return e.reduce((t,n)=>(t.groupIndices.push(t.totalCount),t.totalCount+=n+1,t),{totalCount:0,groupIndices:[]})}const Dz=Ft(([{totalCount:e,groupIndices:t,sizes:n},{scrollTop:s,headerHeight:i}])=>{const o=jt(),a=jt(),l=wr(we(o,We(a5e)));return Ue(we(l,We(c=>c.totalCount)),e),Ue(we(l,We(c=>c.groupIndices)),t),Ue(we(qn(s,n,i),rt(([c,d])=>Ty(d)),We(([c,d,h])=>ji(d.groupOffsetTree,Math.max(c-h,0),"v")[0]),rn(),We(c=>[c])),a),{groupCounts:o,topItemsIndexes:a}},an(mo,Os));function Rf(e,t){return!!(e&&e[0]===t[0]&&e[1]===t[1])}function Rz(e,t){return!!(e&&e.startIndex===t.startIndex&&e.endIndex===t.endIndex)}const P0="top",E0="bottom",Y8="none";function X8(e,t,n){return typeof e=="number"?n===Df&&t===P0||n===tf&&t===E0?e:0:n===Df?t===P0?e.main:e.reverse:t===E0?e.main:e.reverse}function Q8(e,t){return typeof e=="number"?e:e[t]||0}const ak=Ft(([{scrollTop:e,viewportHeight:t,deviation:n,headerHeight:s,fixedHeaderHeight:i}])=>{const o=jt(),a=Ie(0),l=Ie(0),c=Ie(0),d=xs(we(qn(st(e),st(t),st(s),st(o,Rf),st(c),st(a),st(i),st(n),st(l)),We(([h,f,p,[g,m],y,x,C,v,b])=>{const S=h-v,w=x+C,j=Math.max(p-S,0);let E=Y8;const A=Q8(b,P0),L=Q8(b,E0);return g-=v,g+=p+C,m+=p+C,m-=v,g>h+w-A&&(E=Df),m<h-j+f+L&&(E=tf),E!==Y8?[Math.max(S-p-X8(y,P0,E)-A,0),S-j-C+f+X8(y,E0,E)+L]:null}),rt(h=>h!=null),rn(Rf)),[0,0]);return{listBoundary:o,overscan:c,topListHeight:a,increaseViewportBy:l,visibleRange:d}},an(Os),{singleton:!0});function l5e(e,t,n){if(Ty(t)){const s=Ez(e,t);return[{index:ji(t.groupOffsetTree,s)[0],size:0,offset:0},{index:s,size:0,offset:0,data:n&&n[0]}]}return[{index:e,size:0,offset:0,data:n&&n[0]}]}const gb={items:[],topItems:[],offsetTop:0,offsetBottom:0,top:0,bottom:0,topListHeight:0,totalCount:0,firstItemIndex:0};function J8(e,t,n){if(e.length===0)return[];if(!Ty(t))return e.map(d=>({...d,index:d.index+n,originalIndex:d.index}));const s=e[0].index,i=e[e.length-1].index,o=[],a=Ay(t.groupOffsetTree,s,i);let l,c=0;for(const d of e){(!l||l.end<d.index)&&(l=a.shift(),c=t.groupIndices.indexOf(l.start));let h;d.index===l.start?h={type:"group",index:c}:h={index:d.index-(c+1)+n,groupIndex:c},o.push({...h,size:d.size,offset:d.offset,originalIndex:d.index,data:d.data})}return o}function Cm(e,t,n,s,i,o){const{lastSize:a,lastOffset:l,lastIndex:c}=i;let d=0,h=0;if(e.length>0){d=e[0].offset;const y=e[e.length-1];h=y.offset+y.size}const f=n-c,p=l+f*a+(f-1)*s,g=d,m=p-h;return{items:J8(e,i,o),topItems:J8(t,i,o),topListHeight:t.reduce((y,x)=>x.size+y,0),offsetTop:d,offsetBottom:m,top:g,bottom:h,totalCount:n,firstItemIndex:o}}function Oz(e,t,n,s,i,o){let a=0;if(n.groupIndices.length>0)for(const h of n.groupIndices){if(h-a>=e)break;a++}const l=e+a,c=ok(t,l),d=Array.from({length:l}).map((h,f)=>({index:f+c,size:0,offset:0,data:o[f+c]}));return Cm(d,[],l,i,n,s)}const ic=Ft(([{sizes:e,totalCount:t,data:n,firstItemIndex:s,gap:i},o,{visibleRange:a,listBoundary:l,topListHeight:c},{scrolledToInitialItem:d,initialTopMostItemIndex:h},{topListHeight:f},p,{didMount:g},{recalcInProgress:m}])=>{const y=Ie([]),x=Ie(0),C=jt();Ue(o.topItemsIndexes,y);const v=xs(we(qn(g,m,st(a,Rf),st(t),st(e),st(h),d,st(y),st(s),st(i),n),rt(([j,E,,A,,,,,,,L])=>{const M=L&&L.length!==A;return j&&!E&&!M}),We(([,,[j,E],A,L,M,O,F,_,R,D])=>{const $=L,{sizeTree:G,offsetTree:ee}=$,Q=bs(x);if(A===0)return{...gb,totalCount:A};if(j===0&&E===0)return Q===0?{...gb,totalCount:A}:Oz(Q,M,L,_,R,D||[]);if(Zt(G))return Q>0?null:Cm(l5e(ok(M,A),$,D),[],A,R,$,_);const se=[];if(F.length>0){const W=F[0],J=F[F.length-1];let N=0;for(const B of Ay(G,W,J)){const U=B.value,ie=Math.max(B.start,W),ue=Math.min(B.end,J);for(let be=ie;be<=ue;be++)se.push({index:be,size:U,offset:N,data:D&&D[be]}),N+=U}}if(!O)return Cm([],se,A,R,$,_);const ne=F.length>0?F[F.length-1]+1:0,H=Z4e(ee,j,E,ne);if(H.length===0)return null;const V=A-1,Y=Iy([],W=>{for(const J of H){const N=J.value;let B=N.offset,U=J.start;const ie=N.size;if(N.offset<j){U+=Math.floor((j-N.offset+R)/(ie+R));const be=U-J.start;B+=be*ie+be*R}U<ne&&(B+=(ne-U)*ie,U=ne);const ue=Math.min(J.end,V);for(let be=U;be<=ue&&!(B>=E);be++)W.push({index:be,size:ie,offset:B,data:D&&D[be]}),B+=ie+R}});return Cm(Y,se,A,R,$,_)}),rt(j=>j!==null),rn()),gb);Ue(we(n,rt(ek),We(j=>j==null?void 0:j.length)),t),Ue(we(v,We(j=>j.topListHeight)),f),Ue(f,c),Ue(we(v,We(j=>[j.top,j.bottom])),l),Ue(we(v,We(j=>j.items)),C);const b=wr(we(v,rt(({items:j})=>j.length>0),mt(t,n),rt(([{items:j},E])=>j[j.length-1].originalIndex===E-1),We(([,j,E])=>[j-1,E]),rn(Rf),We(([j])=>j))),S=wr(we(v,ha(200),rt(({items:j,topItems:E})=>j.length>0&&j[0].originalIndex===E.length),We(({items:j})=>j[0].index),rn())),w=wr(we(v,rt(({items:j})=>j.length>0),We(({items:j})=>{let E=0,A=j.length-1;for(;j[E].type==="group"&&E<A;)E++;for(;j[A].type==="group"&&A>E;)A--;return{startIndex:j[E].index,endIndex:j[A].index}}),rn(Rz)));return{listState:v,topItemsIndexes:y,endReached:b,startReached:S,rangeChanged:w,itemsRendered:C,initialItemCount:x,...p}},an(mo,Dz,ak,Zp,qp,Kp,Ha,sk),{singleton:!0}),c5e=Ft(([{sizes:e,firstItemIndex:t,data:n,gap:s},{initialTopMostItemIndex:i},{initialItemCount:o,listState:a},{didMount:l}])=>(Ue(we(l,mt(o),rt(([,c])=>c!==0),mt(i,e,t,s,n),We(([[,c],d,h,f,p,g=[]])=>Oz(c,d,h,f,p,g))),a),{}),an(mo,Zp,ic,Ha),{singleton:!0}),Nz=Ft(([{scrollVelocity:e}])=>{const t=Ie(!1),n=jt(),s=Ie(!1);return Ue(we(e,mt(s,t,n),rt(([i,o])=>!!o),We(([i,o,a,l])=>{const{exit:c,enter:d}=o;if(a){if(c(i,l))return!1}else if(d(i,l))return!0;return a}),rn()),t),zt(we(qn(t,e,n),mt(s)),([[i,o,a],l])=>i&&l&&l.change&&l.change(o,a)),{isSeeking:t,scrollSeekConfiguration:s,scrollVelocity:e,scrollSeekRangeChanged:n}},an(Kp),{singleton:!0}),u5e=Ft(([{topItemsIndexes:e}])=>{const t=Ie(0);return Ue(we(t,rt(n=>n>0),We(n=>Array.from({length:n}).map((s,i)=>i))),e),{topItemCount:t}},an(ic)),Fz=Ft(([{footerHeight:e,headerHeight:t,fixedHeaderHeight:n,fixedFooterHeight:s},{listState:i}])=>{const o=jt(),a=xs(we(qn(e,s,t,n,i),We(([l,c,d,h,f])=>l+c+d+h+f.offsetBottom+f.bottom)),0);return Ue(st(a),o),{totalListHeight:a,totalListHeightChanged:o}},an(Os,ic),{singleton:!0});function Bz(e){let t=!1,n;return()=>(t||(t=!0,n=e()),n)}const d5e=Bz(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),h5e=Ft(([{scrollBy:e,scrollTop:t,deviation:n,scrollingInProgress:s},{isScrolling:i,isAtBottom:o,scrollDirection:a,lastJumpDueToItemResize:l},{listState:c},{beforeUnshiftWith:d,shiftWithOffset:h,sizes:f,gap:p},{log:g},{recalcInProgress:m}])=>{const y=wr(we(c,mt(l),Hi(([,C,v,b],[{items:S,totalCount:w,bottom:j,offsetBottom:E},A])=>{const L=j+E;let M=0;return v===w&&C.length>0&&S.length>0&&(S[0].originalIndex===0&&C[0].originalIndex===0||(M=L-b,M!==0&&(M+=A))),[M,S,w,L]},[0,[],0,0]),rt(([C])=>C!==0),mt(t,a,s,o,g,m),rt(([,C,v,b,,,S])=>!S&&!b&&C!==0&&v===Df),We(([[C],,,,,v])=>(v("Upward scrolling compensation",{amount:C},jr.DEBUG),C))));function x(C){C>0?(gt(e,{top:-C,behavior:"auto"}),gt(n,0)):(gt(n,0),gt(e,{top:-C,behavior:"auto"}))}return zt(we(y,mt(n,i)),([C,v,b])=>{b&&d5e()?gt(n,v-C):x(-C)}),zt(we(qn(xs(i,!1),n,m),rt(([C,v,b])=>!C&&!b&&v!==0),We(([C,v])=>v),ha(1)),x),Ue(we(h,We(C=>({top:-C}))),e),zt(we(d,mt(f,p),We(([C,{lastSize:v,groupIndices:b,sizeTree:S},w])=>{function j(E){return E*(v+w)}if(b.length===0)return j(C);{let E=0;const A=Ef(S,0);let L=0,M=0;for(;L<C;){L++,E+=A;let O=b.length===M+1?1/0:b[M+1]-b[M]-1;L+O>C&&(E-=A,O=C-L+1),L+=O,E+=j(O),M++}return E}})),C=>{gt(n,C),requestAnimationFrame(()=>{gt(e,{top:C}),requestAnimationFrame(()=>{gt(n,0),gt(m,!1)})})}),{deviation:n}},an(Os,Kp,ic,mo,za,sk)),f5e=Ft(([{didMount:e},{scrollTo:t},{listState:n}])=>{const s=Ie(0);return zt(we(e,mt(s),rt(([,i])=>i!==0),We(([,i])=>({top:i}))),i=>{oo(we(n,_u(1),rt(o=>o.items.length>1)),()=>{requestAnimationFrame(()=>{gt(t,i)})})}),{initialScrollTop:s}},an(Ha,Os,ic),{singleton:!0}),p5e=Ft(([{viewportHeight:e},{totalListHeight:t}])=>{const n=Ie(!1),s=xs(we(qn(n,e,t),rt(([i])=>i),We(([,i,o])=>Math.max(0,i-o)),ha(0),rn()),0);return{alignToBottom:n,paddingTopAddition:s}},an(Os,Fz),{singleton:!0}),lk=Ft(([{scrollTo:e,scrollContainerState:t}])=>{const n=jt(),s=jt(),i=jt(),o=Ie(!1),a=Ie(void 0);return Ue(we(qn(n,s),We(([{viewportHeight:l,scrollTop:c,scrollHeight:d},{offsetTop:h}])=>({scrollTop:Math.max(0,c-h),scrollHeight:d,viewportHeight:l}))),t),Ue(we(e,mt(s),We(([l,{offsetTop:c}])=>({...l,top:l.top+c}))),i),{useWindowScroll:o,customScrollParent:a,windowScrollContainerState:n,windowViewportRect:s,windowScrollTo:i}},an(Os)),g5e=({itemTop:e,itemBottom:t,viewportTop:n,viewportBottom:s,locationParams:{behavior:i,align:o,...a}})=>e<n?{...a,behavior:i,align:o??"start"}:t>s?{...a,behavior:i,align:o??"end"}:null,m5e=Ft(([{sizes:e,totalCount:t,gap:n},{scrollTop:s,viewportHeight:i,headerHeight:o,fixedHeaderHeight:a,fixedFooterHeight:l,scrollingInProgress:c},{scrollToIndex:d}])=>{const h=jt();return Ue(we(h,mt(e,i,t,o,a,l,s),mt(n),We(([[f,p,g,m,y,x,C,v],b])=>{const{done:S,behavior:w,align:j,calculateViewLocation:E=g5e,...A}=f,L=Pz(f,p,m-1),M=Lf(L,p.offsetTree,b)+y+x,O=M+ji(p.sizeTree,L)[1],F=v+x,_=v+g-C,R=E({itemTop:M,itemBottom:O,viewportTop:F,viewportBottom:_,locationParams:{behavior:w,align:j,...A}});return R?S&&oo(we(c,rt(D=>D===!1),_u(bs(c)?1:2)),S):S&&S(),R}),rt(f=>f!==null)),d),{scrollIntoView:h}},an(mo,Os,qp,ic,za),{singleton:!0}),y5e=Ft(([{sizes:e,sizeRanges:t},{scrollTop:n,headerHeight:s},{initialTopMostItemIndex:i},{didMount:o},{useWindowScroll:a,windowScrollContainerState:l,windowViewportRect:c}])=>{const d=jt(),h=Ie(void 0),f=Ie(null),p=Ie(null);return Ue(l,f),Ue(c,p),zt(we(d,mt(e,n,a,f,p,s)),([g,m,y,x,C,v,b])=>{const S=Q4e(m.sizeTree);x&&C!==null&&v!==null&&(y=C.scrollTop-v.offsetTop),y-=b,g({ranges:S,scrollTop:y})}),Ue(we(h,rt(ek),We(v5e)),i),Ue(we(o,mt(h),rt(([,g])=>g!==void 0),rn(),We(([,g])=>g.ranges)),t),{getState:d,restoreStateFrom:h}},an(mo,Os,Zp,Ha,lk));function v5e(e){return{offset:e.scrollTop,index:0,align:"start"}}const b5e=Ft(([e,t,n,s,i,o,a,l,c,d])=>({...e,...t,...n,...s,...i,...o,...a,...l,...c,...d}),an(ak,c5e,Ha,Nz,Fz,f5e,p5e,lk,m5e,za)),$z=Ft(([{totalCount:e,sizeRanges:t,fixedItemSize:n,defaultItemSize:s,trackItemSizes:i,itemSize:o,data:a,firstItemIndex:l,groupIndices:c,statefulTotalCount:d,gap:h,sizes:f},{initialTopMostItemIndex:p,scrolledToInitialItem:g,initialItemFinalLocationReached:m},y,x,C,{listState:v,topItemsIndexes:b,...S},{scrollToIndex:w},j,{topItemCount:E},{groupCounts:A},L])=>(Ue(S.rangeChanged,L.scrollSeekRangeChanged),Ue(we(L.windowViewportRect,We(M=>M.visibleHeight)),y.viewportHeight),{totalCount:e,data:a,firstItemIndex:l,sizeRanges:t,initialTopMostItemIndex:p,scrolledToInitialItem:g,initialItemFinalLocationReached:m,topItemsIndexes:b,topItemCount:E,groupCounts:A,fixedItemHeight:n,defaultItemHeight:s,gap:h,...C,statefulTotalCount:d,listState:v,scrollToIndex:w,trackItemSizes:i,itemSize:o,groupIndices:c,...S,...L,...y,sizes:f,...x}),an(mo,Zp,Os,y5e,o5e,ic,qp,h5e,u5e,Dz,b5e)),mb="-webkit-sticky",eA="sticky",Vz=Bz(()=>{if(typeof document>"u")return eA;const e=document.createElement("div");return e.style.position=mb,e.style.position===mb?mb:eA});function Gz(e,t,n){const s=me.useRef(null),i=me.useCallback(c=>{if(c===null||!c.offsetParent)return;const d=c.getBoundingClientRect(),h=d.width;let f,p;if(t){const g=t.getBoundingClientRect(),m=d.top-g.top;f=g.height-Math.max(0,m),p=m+t.scrollTop}else f=window.innerHeight-Math.max(0,d.top),p=d.top+window.pageYOffset;s.current={offsetTop:p,visibleHeight:f,visibleWidth:h},e(s.current)},[e,t]),{callbackRef:o,ref:a}=nk(i,!0,n),l=me.useCallback(()=>{i(a.current)},[i,a]);return me.useEffect(()=>{if(t){t.addEventListener("scroll",l);const c=new ResizeObserver(()=>{requestAnimationFrame(l)});return c.observe(t),()=>{t.removeEventListener("scroll",l),c.unobserve(t)}}else return window.addEventListener("scroll",l),window.addEventListener("resize",l),()=>{window.removeEventListener("scroll",l),window.removeEventListener("resize",l)}},[l,t]),o}const zz=me.createContext(void 0),Hz=me.createContext(void 0);function ck(e){return e}const x5e=Ft(()=>{const e=Ie(c=>`Item ${c}`),t=Ie(null),n=Ie(c=>`Group ${c}`),s=Ie({}),i=Ie(ck),o=Ie("div"),a=Ie(sc),l=(c,d=null)=>xs(we(s,We(h=>h[c]),rn()),d);return{context:t,itemContent:e,groupContent:n,components:s,computeItemKey:i,HeaderFooterTag:o,scrollerRef:a,FooterComponent:l("Footer"),HeaderComponent:l("Header"),TopItemListComponent:l("TopItemList"),ListComponent:l("List","div"),ItemComponent:l("Item","div"),GroupComponent:l("Group","div"),ScrollerComponent:l("Scroller","div"),EmptyPlaceholder:l("EmptyPlaceholder"),ScrollSeekPlaceholder:l("ScrollSeekPlaceholder")}}),C5e=Ft(([e,t])=>({...e,...t}),an($z,x5e)),S5e=({height:e})=>r.jsx("div",{style:{height:e}}),w5e={position:Vz(),zIndex:1,overflowAnchor:"none"},Wz={overflowAnchor:"none"},j5e={...Wz,display:"inline-block",height:"100%"},tA=me.memo(function({showTopList:t=!1}){const n=ct("listState"),s=Ur("sizeRanges"),i=ct("useWindowScroll"),o=ct("customScrollParent"),a=Ur("windowScrollContainerState"),l=Ur("scrollContainerState"),c=o||i?a:l,d=ct("itemContent"),h=ct("context"),f=ct("groupContent"),p=ct("trackItemSizes"),g=ct("itemSize"),m=ct("log"),y=Ur("gap"),x=ct("horizontalDirection"),{callbackRef:C}=$4e(s,g,p,t?sc:c,m,y,o,x,ct("skipAnimationFrameInResizeObserver")),[v,b]=me.useState(0);uk("deviation",D=>{v!==D&&b(D)});const S=ct("EmptyPlaceholder"),w=ct("ScrollSeekPlaceholder")||S5e,j=ct("ListComponent"),E=ct("ItemComponent"),A=ct("GroupComponent"),L=ct("computeItemKey"),M=ct("isSeeking"),O=ct("groupIndices").length>0,F=ct("alignToBottom"),_=ct("initialItemFinalLocationReached"),R=t?{}:{boxSizing:"border-box",...x?{whiteSpace:"nowrap",display:"inline-block",height:"100%",paddingLeft:n.offsetTop,paddingRight:n.offsetBottom,marginLeft:v!==0?v:F?"auto":0}:{marginTop:v!==0?v:F?"auto":0,paddingTop:n.offsetTop,paddingBottom:n.offsetBottom},..._?{}:{visibility:"hidden"}};return!t&&n.totalCount===0&&S?r.jsx(S,{...Ps(S,h)}):r.jsx(j,{...Ps(j,h),ref:C,style:R,"data-testid":t?"virtuoso-top-item-list":"virtuoso-item-list",children:(t?n.topItems:n.items).map(D=>{const $=D.originalIndex,G=L($+n.firstItemIndex,D.data,h);return M?u.createElement(w,{...Ps(w,h),key:G,index:D.index,height:D.size,type:D.type||"item",...D.type==="group"?{}:{groupIndex:D.groupIndex}}):D.type==="group"?u.createElement(A,{...Ps(A,h),key:G,"data-index":$,"data-known-size":D.size,"data-item-index":D.index,style:w5e},f(D.index,h)):u.createElement(E,{...Ps(E,h),...A5e(E,D.data),key:G,"data-index":$,"data-known-size":D.size,"data-item-index":D.index,"data-item-group-index":D.groupIndex,style:x?j5e:Wz},O?d(D.index,D.groupIndex,D.data,h):d(D.index,D.data,h))})})}),k5e={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},_5e={outline:"none",overflowX:"auto",position:"relative"},My=e=>({width:"100%",height:"100%",position:"absolute",top:0,...e?{display:"flex",flexDirection:"column"}:{}}),I5e={width:"100%",position:Vz(),top:0,zIndex:1};function Ps(e,t){if(typeof e!="string")return{context:t}}function A5e(e,t){return{item:typeof e=="string"?void 0:t}}const T5e=me.memo(function(){const t=ct("HeaderComponent"),n=Ur("headerHeight"),s=ct("HeaderFooterTag"),i=rc(me.useMemo(()=>a=>n(wa(a,"height")),[n]),!0,ct("skipAnimationFrameInResizeObserver")),o=ct("context");return t?r.jsx(s,{ref:i,children:r.jsx(t,{...Ps(t,o)})}):null}),M5e=me.memo(function(){const t=ct("FooterComponent"),n=Ur("footerHeight"),s=ct("HeaderFooterTag"),i=rc(me.useMemo(()=>a=>n(wa(a,"height")),[n]),!0,ct("skipAnimationFrameInResizeObserver")),o=ct("context");return t?r.jsx(s,{ref:i,children:r.jsx(t,{...Ps(t,o)})}):null});function Uz({usePublisher:e,useEmitter:t,useEmitterValue:n}){return me.memo(function({style:o,children:a,...l}){const c=e("scrollContainerState"),d=n("ScrollerComponent"),h=e("smoothScrollTargetReached"),f=n("scrollerRef"),p=n("context"),g=n("horizontalDirection")||!1,{scrollerRef:m,scrollByCallback:y,scrollToCallback:x}=jz(c,h,d,f,void 0,g);t("scrollTo",x),t("scrollBy",y);const C=g?_5e:k5e;return r.jsx(d,{ref:m,style:{...C,...o},"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,tabIndex:0,...l,...Ps(d,p),children:a})})}function qz({usePublisher:e,useEmitter:t,useEmitterValue:n}){return me.memo(function({style:o,children:a,...l}){const c=e("windowScrollContainerState"),d=n("ScrollerComponent"),h=e("smoothScrollTargetReached"),f=n("totalListHeight"),p=n("deviation"),g=n("customScrollParent"),m=n("context"),{scrollerRef:y,scrollByCallback:x,scrollToCallback:C}=jz(c,h,d,sc,g);return Sz(()=>(y.current=g||window,()=>{y.current=null}),[y,g]),t("windowScrollTo",C),t("scrollBy",x),r.jsx(d,{style:{position:"relative",...o,...f!==0?{height:f+p}:{}},"data-virtuoso-scroller":!0,...l,...Ps(d,m),children:a})})}const P5e=({children:e})=>{const t=me.useContext(zz),n=Ur("viewportHeight"),s=Ur("fixedItemHeight"),i=ct("alignToBottom"),o=ct("horizontalDirection"),a=me.useMemo(()=>vz(n,c=>wa(c,o?"width":"height")),[n,o]),l=rc(a,!0,ct("skipAnimationFrameInResizeObserver"));return me.useEffect(()=>{t&&(n(t.viewportHeight),s(t.itemHeight))},[t,n,s]),r.jsx("div",{style:My(i),ref:l,"data-viewport-type":"element",children:e})},E5e=({children:e})=>{const t=me.useContext(zz),n=Ur("windowViewportRect"),s=Ur("fixedItemHeight"),i=ct("customScrollParent"),o=Gz(n,i,ct("skipAnimationFrameInResizeObserver")),a=ct("alignToBottom");return me.useEffect(()=>{t&&(s(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))},[t,n,s]),r.jsx("div",{ref:o,style:My(a),"data-viewport-type":"window",children:e})},L5e=({children:e})=>{const t=ct("TopItemListComponent")||"div",n=ct("headerHeight"),s={...I5e,marginTop:`${n}px`},i=ct("context");return r.jsx(t,{style:s,...Ps(t,i),children:e})},D5e=me.memo(function(t){const n=ct("useWindowScroll"),s=ct("topItemsIndexes").length>0,i=ct("customScrollParent"),o=i||n?N5e:O5e,a=i||n?E5e:P5e;return r.jsxs(o,{...t,children:[s&&r.jsx(L5e,{children:r.jsx(tA,{showTopList:!0})}),r.jsxs(a,{children:[r.jsx(T5e,{}),r.jsx(tA,{}),r.jsx(M5e,{})]})]})}),{Component:R5e,usePublisher:Ur,useEmitterValue:ct,useEmitter:uk}=Cz(C5e,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedItemHeight:"fixedItemHeight",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},D5e),O5e=Uz({usePublisher:Ur,useEmitterValue:ct,useEmitter:uk}),N5e=qz({usePublisher:Ur,useEmitterValue:ct,useEmitter:uk}),F5e=R5e,nA={items:[],offsetBottom:0,offsetTop:0,top:0,bottom:0,itemHeight:0,itemWidth:0},B5e={items:[{index:0}],offsetBottom:0,offsetTop:0,top:0,bottom:0,itemHeight:0,itemWidth:0},{round:sA,ceil:rA,floor:L0,min:yb,max:nf}=Math;function $5e(e){return{...B5e,items:e}}function iA(e,t,n){return Array.from({length:t-e+1}).map((s,i)=>{const o=n===null?null:n[i+e];return{index:i+e,data:o}})}function V5e(e,t){return e&&e.column===t.column&&e.row===t.row}function qg(e,t){return e&&e.width===t.width&&e.height===t.height}const G5e=Ft(([{overscan:e,visibleRange:t,listBoundary:n},{scrollTop:s,viewportHeight:i,scrollBy:o,scrollTo:a,smoothScrollTargetReached:l,scrollContainerState:c,footerHeight:d,headerHeight:h},f,p,{propsReady:g,didMount:m},{windowViewportRect:y,useWindowScroll:x,customScrollParent:C,windowScrollContainerState:v,windowScrollTo:b},S])=>{const w=Ie(0),j=Ie(0),E=Ie(nA),A=Ie({height:0,width:0}),L=Ie({height:0,width:0}),M=jt(),O=jt(),F=Ie(0),_=Ie(null),R=Ie({row:0,column:0}),D=jt(),$=jt(),G=Ie(!1),ee=Ie(0),Q=Ie(!0),se=Ie(!1),ne=Ie(!1);zt(we(m,mt(ee),rt(([N,B])=>!!B)),()=>{gt(Q,!1)}),zt(we(qn(m,Q,L,A,ee,se),rt(([N,B,U,ie,,ue])=>N&&!B&&U.height!==0&&ie.height!==0&&!ue)),([,,,,N])=>{gt(se,!0),ik(1,()=>{gt(M,N)}),oo(we(s),()=>{gt(n,[0,0]),gt(Q,!0)})}),Ue(we($,rt(N=>N!=null&&N.scrollTop>0),Ni(0)),j),zt(we(m,mt($),rt(([,N])=>N!=null)),([,N])=>{N&&(gt(A,N.viewport),gt(L,N==null?void 0:N.item),gt(R,N.gap),N.scrollTop>0&&(gt(G,!0),oo(we(s,_u(1)),B=>{gt(G,!1)}),gt(a,{top:N.scrollTop})))}),Ue(we(A,We(({height:N})=>N)),i),Ue(we(qn(st(A,qg),st(L,qg),st(R,(N,B)=>N&&N.column===B.column&&N.row===B.row),st(s)),We(([N,B,U,ie])=>({viewport:N,item:B,gap:U,scrollTop:ie}))),D),Ue(we(qn(st(w),t,st(R,V5e),st(L,qg),st(A,qg),st(_),st(j),st(G),st(Q),st(ee)),rt(([,,,,,,,N])=>!N),We(([N,[B,U],ie,ue,be,Te,je,,Be,Ze])=>{const{row:De,column:q}=ie,{height:re,width:oe}=ue,{width:xe}=be;if(je===0&&(N===0||xe===0))return nA;if(oe===0){const pn=ok(Ze,N),Jn=Math.max(pn+je-1,0);return $5e(iA(pn,Jn,Te))}const ge=Kz(xe,oe,q);let de,le;Be?B===0&&U===0&&je>0?(de=0,le=je-1):(de=ge*L0((B+De)/(re+De)),le=ge*rA((U+De)/(re+De))-1,le=yb(N-1,nf(le,ge-1)),de=yb(le,nf(0,de))):(de=0,le=-1);const Se=iA(de,le,Te),{top:Ge,bottom:Ye}=oA(be,ie,ue,Se),dt=rA(N/ge),ln=dt*re+(dt-1)*De-Ye;return{items:Se,offsetTop:Ge,offsetBottom:ln,top:Ge,bottom:Ye,itemHeight:re,itemWidth:oe}})),E),Ue(we(_,rt(N=>N!==null),We(N=>N.length)),w),Ue(we(qn(A,L,E,R),rt(([N,B,{items:U}])=>U.length>0&&B.height!==0&&N.height!==0),We(([N,B,{items:U},ie])=>{const{top:ue,bottom:be}=oA(N,ie,B,U);return[ue,be]}),rn(Rf)),n);const H=Ie(!1);Ue(we(s,mt(H),We(([N,B])=>B||N!==0)),H);const V=wr(we(st(E),rt(({items:N})=>N.length>0),mt(w,H),rt(([{items:N},B,U])=>U&&N[N.length-1].index===B-1),We(([,N])=>N-1),rn())),Y=wr(we(st(E),rt(({items:N})=>N.length>0&&N[0].index===0),Ni(0),rn())),W=wr(we(st(E),mt(G),rt(([{items:N},B])=>N.length>0&&!B),We(([{items:N}])=>({startIndex:N[0].index,endIndex:N[N.length-1].index})),rn(Rz),ha(0)));Ue(W,p.scrollSeekRangeChanged),Ue(we(M,mt(A,L,w,R),We(([N,B,U,ie,ue])=>{const be=Lz(N),{align:Te,behavior:je,offset:Be}=be;let Ze=be.index;Ze==="LAST"&&(Ze=ie-1),Ze=nf(0,Ze,yb(ie-1,Ze));let De=E2(B,ue,U,Ze);return Te==="end"?De=sA(De-B.height+U.height):Te==="center"&&(De=sA(De-B.height/2+U.height/2)),Be&&(De+=Be),{top:De,behavior:je}})),a);const J=xs(we(E,We(N=>N.offsetBottom+N.bottom)),0);return Ue(we(y,We(N=>({width:N.visibleWidth,height:N.visibleHeight}))),A),{data:_,totalCount:w,viewportDimensions:A,itemDimensions:L,scrollTop:s,scrollHeight:O,overscan:e,scrollBy:o,scrollTo:a,scrollToIndex:M,smoothScrollTargetReached:l,windowViewportRect:y,windowScrollTo:b,useWindowScroll:x,customScrollParent:C,windowScrollContainerState:v,deviation:F,scrollContainerState:c,footerHeight:d,headerHeight:h,initialItemCount:j,gap:R,restoreStateFrom:$,...p,initialTopMostItemIndex:ee,horizontalDirection:ne,gridState:E,totalListHeight:J,...f,startReached:Y,endReached:V,rangeChanged:W,stateChanged:D,propsReady:g,stateRestoreInProgress:G,...S}},an(ak,Os,Kp,Nz,Ha,lk,za));function oA(e,t,n,s){const{height:i}=n;if(i===void 0||s.length===0)return{top:0,bottom:0};const o=E2(e,t,n,s[0].index),a=E2(e,t,n,s[s.length-1].index)+i;return{top:o,bottom:a}}function E2(e,t,n,s){const i=Kz(e.width,n.width,t.column),o=L0(s/i),a=o*n.height+nf(0,o-1)*t.row;return a>0?a+t.row:a}function Kz(e,t,n){return nf(1,L0((e+n)/(L0(t)+n)))}const z5e=Ft(()=>{const e=Ie(f=>`Item ${f}`),t=Ie({}),n=Ie(null),s=Ie("virtuoso-grid-item"),i=Ie("virtuoso-grid-list"),o=Ie(ck),a=Ie("div"),l=Ie(sc),c=(f,p=null)=>xs(we(t,We(g=>g[f]),rn()),p),d=Ie(!1),h=Ie(!1);return Ue(st(h),d),{readyStateChanged:d,reportReadyState:h,context:n,itemContent:e,components:t,computeItemKey:o,itemClassName:s,listClassName:i,headerFooterTag:a,scrollerRef:l,FooterComponent:c("Footer"),HeaderComponent:c("Header"),ListComponent:c("List","div"),ItemComponent:c("Item","div"),ScrollerComponent:c("Scroller","div"),ScrollSeekPlaceholder:c("ScrollSeekPlaceholder","div")}}),H5e=Ft(([e,t])=>({...e,...t}),an(G5e,z5e)),W5e=me.memo(function(){const t=yn("gridState"),n=yn("listClassName"),s=yn("itemClassName"),i=yn("itemContent"),o=yn("computeItemKey"),a=yn("isSeeking"),l=qr("scrollHeight"),c=yn("ItemComponent"),d=yn("ListComponent"),h=yn("ScrollSeekPlaceholder"),f=yn("context"),p=qr("itemDimensions"),g=qr("gap"),m=yn("log"),y=yn("stateRestoreInProgress"),x=qr("reportReadyState"),C=rc(me.useMemo(()=>v=>{const b=v.parentElement.parentElement.scrollHeight;l(b);const S=v.firstChild;if(S){const{width:w,height:j}=S.getBoundingClientRect();p({width:w,height:j})}g({row:aA("row-gap",getComputedStyle(v).rowGap,m),column:aA("column-gap",getComputedStyle(v).columnGap,m)})},[l,p,g,m]),!0,!1);return Sz(()=>{t.itemHeight>0&&t.itemWidth>0&&x(!0)},[t]),y?null:r.jsx(d,{ref:C,className:n,...Ps(d,f),style:{paddingTop:t.offsetTop,paddingBottom:t.offsetBottom},"data-testid":"virtuoso-item-list",children:t.items.map(v=>{const b=o(v.index,v.data,f);return a?r.jsx(h,{...Ps(h,f),index:v.index,height:t.itemHeight,width:t.itemWidth},b):u.createElement(c,{...Ps(c,f),className:s,"data-index":v.index,key:b},i(v.index,v.data,f))})})}),U5e=me.memo(function(){const t=yn("HeaderComponent"),n=qr("headerHeight"),s=yn("headerFooterTag"),i=rc(me.useMemo(()=>a=>n(wa(a,"height")),[n]),!0,!1),o=yn("context");return t?r.jsx(s,{ref:i,children:r.jsx(t,{...Ps(t,o)})}):null}),q5e=me.memo(function(){const t=yn("FooterComponent"),n=qr("footerHeight"),s=yn("headerFooterTag"),i=rc(me.useMemo(()=>a=>n(wa(a,"height")),[n]),!0,!1),o=yn("context");return t?r.jsx(s,{ref:i,children:r.jsx(t,{...Ps(t,o)})}):null}),K5e=({children:e})=>{const t=me.useContext(Hz),n=qr("itemDimensions"),s=qr("viewportDimensions"),i=rc(me.useMemo(()=>o=>{s(o.getBoundingClientRect())},[s]),!0,!1);return me.useEffect(()=>{t&&(s({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))},[t,s,n]),r.jsx("div",{style:My(!1),ref:i,children:e})},Z5e=({children:e})=>{const t=me.useContext(Hz),n=qr("windowViewportRect"),s=qr("itemDimensions"),i=yn("customScrollParent"),o=Gz(n,i,!1);return me.useEffect(()=>{t&&(s({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))},[t,n,s]),r.jsx("div",{ref:o,style:My(!1),children:e})},Y5e=me.memo(function({...t}){const n=yn("useWindowScroll"),s=yn("customScrollParent"),i=s||n?Q5e:X5e,o=s||n?Z5e:K5e;return r.jsx(i,{...t,children:r.jsxs(o,{children:[r.jsx(U5e,{}),r.jsx(W5e,{}),r.jsx(q5e,{})]})})}),{usePublisher:qr,useEmitterValue:yn,useEmitter:Zz}=Cz(H5e,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},Y5e),X5e=Uz({usePublisher:qr,useEmitterValue:yn,useEmitter:Zz}),Q5e=qz({usePublisher:qr,useEmitterValue:yn,useEmitter:Zz});function aA(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,jr.WARN),t==="normal"?0:parseInt(t??"0",10)}const J5e=Ft(()=>{const e=Ie(c=>r.jsxs("td",{children:["Item $",c]})),t=Ie(null),n=Ie(null),s=Ie(null),i=Ie({}),o=Ie(ck),a=Ie(sc),l=(c,d=null)=>xs(we(i,We(h=>h[c]),rn()),d);return{context:t,itemContent:e,fixedHeaderContent:n,fixedFooterContent:s,components:i,computeItemKey:o,scrollerRef:a,TableComponent:l("Table","table"),TableHeadComponent:l("TableHead","thead"),TableFooterComponent:l("TableFoot","tfoot"),TableBodyComponent:l("TableBody","tbody"),TableRowComponent:l("TableRow","tr"),ScrollerComponent:l("Scroller","div"),EmptyPlaceholder:l("EmptyPlaceholder"),ScrollSeekPlaceholder:l("ScrollSeekPlaceholder"),FillerRow:l("FillerRow")}});an($z,J5e);const lA={pending:{colorScheme:"cyan",translationKey:"queue.pending"},in_progress:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},failed:{colorScheme:"red",translationKey:"queue.failed"},canceled:{colorScheme:"orange",translationKey:"queue.canceled"}},eIe=({status:e})=>{const{t}=P();return r.jsx(os,{colorScheme:lA[e].colorScheme,children:t(lA[e].translationKey)})},tIe=u.memo(eIe),Yz=e=>{const{t}=P();return t(e==="canvas"?"queue.canvas":e==="gallery"?"queue.gallery":"queue.other")},Xz=e=>{const{t}=P();return t(e==="generation"?"queue.generation":e==="workflows"?"queue.workflows":e==="upscaling"?"queue.upscaling":"queue.other")},Qz=e=>{const t=ce(An),[n,{isLoading:s}]=tC(),{t:i}=P();return{cancelQueueItem:u.useCallback(async()=>{try{await n(e).unwrap(),fe({id:"QUEUE_CANCEL_SUCCEEDED",title:i("queue.cancelSucceeded"),status:"success"})}catch{fe({id:"QUEUE_CANCEL_FAILED",title:i("queue.cancelFailed"),status:"error"})}},[e,i,n]),isLoading:s,isDisabled:!t}},Jz=(e,t)=>Number(((Date.parse(t)-Date.parse(e))/1e3).toFixed(2)),Ws={number:"3rem",statusBadge:"5.7rem",time:"4rem",origin:"5rem",destination:"6rem",batchId:"5rem",fieldValues:"auto",actions:"auto"},nIe=e=>{const t=ce(An),{isCanceled:n}=Oee({batch_id:e},{selectFromResult:({data:l})=>l?{isCanceled:(l==null?void 0:l.in_progress)===0&&(l==null?void 0:l.pending)===0}:{isCanceled:!0}}),[s,{isLoading:i}]=Nee({fixedCacheKey:"cancelByBatchIds"}),{t:o}=P();return{cancelBatch:u.useCallback(async()=>{if(!n)try{await s({batch_ids:[e]}).unwrap(),fe({id:"CANCEL_BATCH_SUCCEEDED",title:o("queue.cancelBatchSucceeded"),status:"success"})}catch{fe({id:"CANCEL_BATCH_FAILED",title:o("queue.cancelBatchFailed"),status:"error"})}},[e,n,o,s]),isLoading:i,isCanceled:n,isDisabled:!t}},sIe=({queueItemDTO:e})=>{const{session_id:t,batch_id:n,item_id:s,origin:i,destination:o}=e,{t:a}=P(),{cancelBatch:l,isLoading:c,isCanceled:d}=nIe(n),{cancelQueueItem:h,isLoading:f}=Qz(s),{data:p}=Fee(s),g=Xz(i),m=Yz(o),y=u.useMemo(()=>{if(!p)return a("common.loading");if(!p.completed_at||!p.started_at)return a(`queue.${p.status}`);const x=Jz(p.started_at,p.completed_at);return p.status==="completed"?`${a("queue.completedIn")} ${x}${x===1?"":"s"}`:`${x}s`},[p,a]);return r.jsxs(T,{layerStyle:"third",flexDir:"column",p:2,pt:0,borderRadius:"base",gap:2,children:[r.jsxs(T,{layerStyle:"second",p:2,gap:2,justifyContent:"space-between",alignItems:"center",borderRadius:"base",h:20,children:[r.jsx(mc,{label:a("queue.status"),data:y}),r.jsx(mc,{label:a("queue.origin"),data:g}),r.jsx(mc,{label:a("queue.destination"),data:m}),r.jsx(mc,{label:a("queue.item"),data:s}),r.jsx(mc,{label:a("queue.batch"),data:n}),r.jsx(mc,{label:a("queue.session"),data:t}),r.jsxs(as,{size:"xs",orientation:"vertical",children:[r.jsx(ye,{onClick:h,isLoading:f,isDisabled:p?["canceled","completed","failed"].includes(p.status):!0,"aria-label":a("queue.cancelItem"),leftIcon:r.jsx(Nt,{}),colorScheme:"error",children:a("queue.cancelItem")}),r.jsx(ye,{onClick:l,isLoading:c,isDisabled:d,"aria-label":a("queue.cancelBatch"),leftIcon:r.jsx(Nt,{}),colorScheme:"error",children:a("queue.cancelBatch")})]})]}),((p==null?void 0:p.error_traceback)||(p==null?void 0:p.error_message))&&r.jsxs(T,{layerStyle:"second",p:3,gap:1,justifyContent:"space-between",alignItems:"flex-start",borderRadius:"base",flexDir:"column",children:[r.jsx(Ot,{size:"sm",color:"error.400",children:a("common.error")}),r.jsx("pre",{children:(p==null?void 0:p.error_traceback)||(p==null?void 0:p.error_message)})]}),r.jsx(T,{layerStyle:"second",h:512,w:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:p?r.jsx(Bo,{label:"Queue Item",data:p,extraCopyActions:[{label:"Graph",getData:x=>Z2(x,"session.graph")}]}):r.jsx(or,{opacity:.5})})]})},rIe=u.memo(sIe),mc=({label:e,data:t})=>r.jsxs(T,{flexDir:"column",justifyContent:"flex-start",p:1,gap:1,overflow:"hidden",h:"full",w:"full",children:[r.jsx(Ot,{size:"md",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:e}),r.jsx(K,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t})]}),cA={bg:"base.700"},iIe={_hover:cA,"&[aria-selected='true']":cA},oIe=({index:e,item:t,context:n})=>{const{t:s}=P(),i=u.useCallback(()=>{n.toggleQueueItem(t.item_id)},[n,t.item_id]),{cancelQueueItem:o,isLoading:a}=Qz(t.item_id),l=u.useCallback(m=>{m.stopPropagation(),o()},[o]),c=u.useMemo(()=>n.openQueueItems.includes(t.item_id),[n.openQueueItems,t.item_id]),d=u.useMemo(()=>!t.completed_at||!t.started_at?void 0:`${Jz(t.started_at,t.completed_at)}s`,[t]),h=u.useMemo(()=>["canceled","completed","failed"].includes(t.status),[t.status]),f=Xz(t.origin),p=Yz(t.destination),g=u.useMemo(()=>r.jsx(Nt,{}),[]);return r.jsxs(T,{flexDir:"column","aria-selected":c,fontSize:"sm",borderRadius:"base",justifyContent:"center",sx:iIe,"data-testid":"queue-item",children:[r.jsxs(T,{minH:9,alignItems:"center",gap:4,p:1.5,cursor:"pointer",onClick:i,children:[r.jsx(T,{w:Ws.number,justifyContent:"flex-end",alignItems:"center",flexShrink:0,children:r.jsx(K,{variant:"subtext",children:e+1})}),r.jsx(T,{w:Ws.statusBadge,alignItems:"center",flexShrink:0,children:r.jsx(tIe,{status:t.status})}),r.jsx(T,{w:Ws.origin,flexShrink:0,children:r.jsx(K,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:f})}),r.jsx(T,{w:Ws.destination,flexShrink:0,children:r.jsx(K,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:p})}),r.jsx(T,{w:Ws.time,alignItems:"center",flexShrink:0,children:d||"-"}),r.jsx(T,{w:Ws.batchId,flexShrink:0,children:r.jsx(K,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:t.batch_id})}),r.jsx(T,{alignItems:"center",overflow:"hidden",flexGrow:1,children:t.field_values&&r.jsx(T,{gap:2,w:"full",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:t.field_values.filter(m=>m.node_path!=="metadata_accumulator").map(({node_path:m,field_name:y,value:x})=>r.jsxs(K,{as:"span",children:[r.jsxs(K,{as:"span",fontWeight:"semibold",children:[m,".",y]}),": ",JSON.stringify(x)]},`${t.item_id}.${m}.${y}.${x}`))})}),r.jsx(T,{alignItems:"center",w:Ws.actions,pe:3,children:r.jsx(as,{size:"xs",variant:"ghost",children:r.jsx(ae,{onClick:l,isDisabled:h,isLoading:a,"aria-label":s("queue.cancelItem"),icon:g})})})]}),r.jsx(ql,{in:c,transition:aIe,unmountOnExit:!0,children:r.jsx(rIe,{queueItemDTO:t})})]})},aIe={enter:{duration:.1},exit:{duration:.1}},lIe=u.memo(oIe),eH=rp(NC((e,t)=>r.jsx(T,{...e,ref:t,flexDirection:"column",gap:.5,children:e.children})));eH.displayName="QueueListComponent";const cIe=()=>{const{t:e}=P();return r.jsxs(T,{alignItems:"center",gap:4,p:1,pb:2,textTransform:"uppercase",fontWeight:"bold",fontSize:"sm",letterSpacing:1,children:[r.jsx(T,{w:Ws.number,justifyContent:"flex-end",alignItems:"center",children:r.jsx(K,{variant:"subtext",children:"#"})}),r.jsx(T,{ps:.5,w:Ws.statusBadge,alignItems:"center",children:r.jsx(K,{variant:"subtext",children:e("queue.status")})}),r.jsx(T,{ps:.5,w:Ws.origin,alignItems:"center",children:r.jsx(K,{variant:"subtext",children:e("queue.origin")})}),r.jsx(T,{ps:.5,w:Ws.destination,alignItems:"center",children:r.jsx(K,{variant:"subtext",children:e("queue.destination")})}),r.jsx(T,{ps:.5,w:Ws.time,alignItems:"center",children:r.jsx(K,{variant:"subtext",children:e("queue.time")})}),r.jsx(T,{ps:.5,w:Ws.batchId,alignItems:"center",children:r.jsx(K,{variant:"subtext",children:e("queue.batch")})}),r.jsx(T,{ps:.5,w:Ws.fieldValues,alignItems:"center",children:r.jsx(K,{variant:"subtext",children:e("queue.batchFieldValues")})})]})},uIe=u.memo(cIe),dIe=(e,t)=>t.item_id,hIe={List:eH},fIe=(e,t,n)=>r.jsx(lIe,{index:e,item:t,context:n}),pIe=()=>{const e=I(Bee),t=I($ee),n=z(),s=u.useRef(null),[i,o]=u.useState(null),[a,l]=fD(Il),{t:c}=P();u.useEffect(()=>{const{current:C}=s;return i&&C&&a({target:C,elements:{viewport:i}}),()=>{var v;return(v=l())==null?void 0:v.destroy()}},[i,a,l]);const{data:d,isLoading:h}=Vee({cursor:e,priority:t}),f=u.useMemo(()=>d?Gee.selectAll(d):[],[d]),p=u.useCallback(()=>{if(!(d!=null&&d.has_more))return;const C=f[f.length-1];C&&(n(nC(C.item_id)),n(sC(C.priority)))},[n,d==null?void 0:d.has_more,f]),[g,m]=u.useState([]),y=u.useCallback(C=>{m(v=>v.includes(C)?v.filter(b=>b!==C):[...v,C])},[]),x=u.useMemo(()=>({openQueueItems:g,toggleQueueItem:y}),[g,y]);return h?r.jsx(R1,{}):f.length?r.jsxs(T,{w:"full",h:"full",flexDir:"column",children:[r.jsx(uIe,{}),r.jsx(T,{ref:s,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(F5e,{data:f,endReached:p,scrollerRef:o,itemContent:fIe,computeItemKey:dIe,components:hIe,context:x})})]}):r.jsx(T,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:r.jsx(Ot,{color:"base.500",children:c("queue.queueEmpty")})})},gIe=u.memo(pIe),mIe=()=>{const{data:e}=ei(),{t}=P();return r.jsxs(mz,{"data-testid":"queue-status",children:[r.jsx(Oi,{label:t("queue.in_progress"),value:(e==null?void 0:e.queue.in_progress)??0}),r.jsx(Oi,{label:t("queue.pending"),value:(e==null?void 0:e.queue.pending)??0}),r.jsx(Oi,{label:t("queue.completed"),value:(e==null?void 0:e.queue.completed)??0}),r.jsx(Oi,{label:t("queue.failed"),value:(e==null?void 0:e.queue.failed)??0}),r.jsx(Oi,{label:t("queue.canceled"),value:(e==null?void 0:e.queue.canceled)??0}),r.jsx(Oi,{label:t("queue.total"),value:(e==null?void 0:e.queue.total)??0})]})},yIe=u.memo(mIe),vIe=()=>{const e=un("modelCache"),[t,{isLoading:n}]=zee(),{t:s}=P(),i=u.useCallback(async()=>{try{await t().unwrap(),fe({status:"success",title:s("modelCache.clearSucceeded")})}catch{fe({status:"error",title:s("modelCache.clearFailed")})}},[t,s]);return e?r.jsx(ye,{size:"sm",colorScheme:"red",onClick:i,isLoading:n,children:s("modelCache.clear")}):r.jsx(r.Fragment,{})},bIe=u.memo(vIe),xIe=e=>{const{t}=P(),n=Ap();return r.jsx(r.Fragment,{children:r.jsx(ye,{isDisabled:n.isDisabled,isLoading:n.isLoading,tooltip:t("queue.clearTooltip"),leftIcon:r.jsx(L1,{}),colorScheme:"error",onClick:n.openDialog,"data-testid":t("queue.clear"),...e,children:t("queue.clear")})})},CIe=u.memo(xIe),SIe=({label:e,tooltip:t,icon:n,onClick:s,isDisabled:i,colorScheme:o,asIconButton:a,isLoading:l,loadingText:c,sx:d})=>a?r.jsx(ae,{"aria-label":e,tooltip:t,icon:n,onClick:s,isDisabled:i,colorScheme:o,isLoading:l,sx:d,"data-testid":e}):r.jsx(ye,{"aria-label":e,tooltip:t,leftIcon:n,onClick:s,isDisabled:i,colorScheme:o,isLoading:l,loadingText:c??e,flexGrow:1,sx:d,"data-testid":e,children:e}),dk=u.memo(SIe),wIe=({asIconButton:e})=>{const{t}=P(),{pauseProcessor:n,isLoading:s,isDisabled:i}=QV();return r.jsx(dk,{asIconButton:e,label:t("queue.pause"),tooltip:t("queue.pauseTooltip"),isDisabled:i,isLoading:s,icon:r.jsx(GE,{}),onClick:n,colorScheme:"gold"})},jIe=u.memo(wIe),kIe=()=>{const e=z(),{t}=P(),n=ce(An),[s,{isLoading:i}]=t3({fixedCacheKey:"pruneQueue"}),{finishedCount:o}=ei(void 0,{selectFromResult:({data:c})=>c?{finishedCount:c.queue.completed+c.queue.canceled+c.queue.failed}:{finishedCount:0}}),a=u.useCallback(async()=>{if(o)try{const c=await s().unwrap();fe({id:"PRUNE_SUCCEEDED",title:t("queue.pruneSucceeded",{item_count:c.deleted}),status:"success"}),e(nC(void 0)),e(sC(void 0))}catch{fe({id:"PRUNE_FAILED",title:t("queue.pruneFailed"),status:"error"})}},[o,s,e,t]),l=u.useMemo(()=>!n||!o,[o,n]);return{pruneQueue:a,isLoading:i,finishedCount:o,isDisabled:l}},_Ie=({asIconButton:e})=>{const{t}=P(),{pruneQueue:n,isLoading:s,finishedCount:i,isDisabled:o}=kIe();return r.jsx(dk,{isDisabled:o,isLoading:s,asIconButton:e,label:t("queue.prune"),tooltip:t("queue.pruneTooltip",{item_count:i}),icon:r.jsx(hoe,{}),onClick:n,colorScheme:"invokeBlue"})},IIe=u.memo(_Ie),AIe=({asIconButton:e})=>{const{t}=P(),{resumeProcessor:n,isLoading:s,isDisabled:i}=JV();return r.jsx(dk,{asIconButton:e,label:t("queue.resume"),tooltip:t("queue.resumeTooltip"),isDisabled:i,isLoading:s,icon:r.jsx(zE,{}),onClick:n,colorScheme:"green"})},TIe=u.memo(AIe),MIe=()=>{const e=un("pauseQueue"),t=un("resumeQueue");return r.jsxs(T,{flexDir:"column",layerStyle:"first",borderRadius:"base",p:2,gap:2,children:[r.jsxs(T,{gap:2,children:[e||t?r.jsxs(as,{w:28,orientation:"vertical",size:"sm",children:[t?r.jsx(TIe,{}):r.jsx(r.Fragment,{}),e?r.jsx(jIe,{}):r.jsx(r.Fragment,{})]}):r.jsx(r.Fragment,{}),r.jsxs(as,{w:28,orientation:"vertical",size:"sm",children:[r.jsx(IIe,{}),r.jsx(CIe,{})]})]}),r.jsx(bIe,{})]})},PIe=u.memo(MIe),EIe=()=>{const e=un("invocationCache"),t=I(On);return r.jsxs(T,{display:t==="queue"?void 0:"none",hidden:t!=="queue",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsxs(T,{gap:2,w:"full",children:[r.jsx(PIe,{}),r.jsx(yIe,{}),e&&r.jsx(T4e,{})]}),r.jsx(ke,{layerStyle:"first",p:2,borderRadius:"base",w:"full",h:"full",children:r.jsx(gIe,{})})]})},LIe=u.memo(EIe),DIe=()=>r.jsx(T,{layerStyle:"body",w:"full",h:"full",children:r.jsx(LIe,{})}),RIe=u.memo(DIe);var uA=1,OIe=.9,NIe=.8,FIe=.17,vb=.1,bb=.999,BIe=.9999,$Ie=.99,VIe=/[\\\/_+.#"@\[\(\{&]/,GIe=/[\\\/_+.#"@\[\(\{&]/g,zIe=/[\s-]/,tH=/[\s-]/g;function L2(e,t,n,s,i,o,a){if(o===t.length)return i===e.length?uA:$Ie;var l=`${i},${o}`;if(a[l]!==void 0)return a[l];for(var c=s.charAt(o),d=n.indexOf(c,i),h=0,f,p,g,m;d>=0;)f=L2(e,t,n,s,d+1,o+1,a),f>h&&(d===i?f*=uA:VIe.test(e.charAt(d-1))?(f*=NIe,g=e.slice(i,d-1).match(GIe),g&&i>0&&(f*=Math.pow(bb,g.length))):zIe.test(e.charAt(d-1))?(f*=OIe,m=e.slice(i,d-1).match(tH),m&&i>0&&(f*=Math.pow(bb,m.length))):(f*=FIe,i>0&&(f*=Math.pow(bb,d-i))),e.charAt(d)!==t.charAt(o)&&(f*=BIe)),(f<vb&&n.charAt(d-1)===s.charAt(o+1)||s.charAt(o+1)===s.charAt(o)&&n.charAt(d-1)!==s.charAt(o))&&(p=L2(e,t,n,s,d+1,o+2,a),p*vb>f&&(f=p*vb)),f>h&&(h=f),d=n.indexOf(c,d+1);return a[l]=h,h}function dA(e){return e.toLowerCase().replace(tH," ")}function HIe(e,t,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,L2(e,t,dA(e),dA(t),0,0,{})}function lu(e,t,{checkForDefaultPrevented:n=!0}={}){return function(i){if(e==null||e(i),n===!1||!i.defaultPrevented)return t==null?void 0:t(i)}}function WIe(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function nH(...e){return t=>e.forEach(n=>WIe(n,t))}function Yp(...e){return u.useCallback(nH(...e),e)}function UIe(e,t){const n=u.createContext(t);function s(o){const{children:a,...l}=o,c=u.useMemo(()=>l,Object.values(l));return u.createElement(n.Provider,{value:c},a)}function i(o){const a=u.useContext(n);if(a)return a;if(t!==void 0)return t;throw new Error(`\`${o}\` must be used within \`${e}\``)}return s.displayName=e+"Provider",[s,i]}function qIe(e,t=[]){let n=[];function s(o,a){const l=u.createContext(a),c=n.length;n=[...n,a];function d(f){const{scope:p,children:g,...m}=f,y=(p==null?void 0:p[e][c])||l,x=u.useMemo(()=>m,Object.values(m));return u.createElement(y.Provider,{value:x},g)}function h(f,p){const g=(p==null?void 0:p[e][c])||l,m=u.useContext(g);if(m)return m;if(a!==void 0)return a;throw new Error(`\`${f}\` must be used within \`${o}\``)}return d.displayName=o+"Provider",[d,h]}const i=()=>{const o=n.map(a=>u.createContext(a));return function(l){const c=(l==null?void 0:l[e])||o;return u.useMemo(()=>({[`__scope${e}`]:{...l,[e]:c}}),[l,c])}};return i.scopeName=e,[s,KIe(i,...t)]}function KIe(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const s=e.map(i=>({useScope:i(),scopeName:i.scopeName}));return function(o){const a=s.reduce((l,{useScope:c,scopeName:d})=>{const f=c(o)[`__scope${d}`];return{...l,...f}},{});return u.useMemo(()=>({[`__scope${t.scopeName}`]:a}),[a])}};return n.scopeName=t.scopeName,n}const D2=globalThis!=null&&globalThis.document?u.useLayoutEffect:()=>{},ZIe=TC.useId||(()=>{});let YIe=0;function xb(e){const[t,n]=u.useState(ZIe());return D2(()=>{n(s=>s??String(YIe++))},[e]),e||(t?`radix-${t}`:"")}function Ll(e){const t=u.useRef(e);return u.useEffect(()=>{t.current=e}),u.useMemo(()=>(...n)=>{var s;return(s=t.current)===null||s===void 0?void 0:s.call(t,...n)},[])}function XIe({prop:e,defaultProp:t,onChange:n=()=>{}}){const[s,i]=QIe({defaultProp:t,onChange:n}),o=e!==void 0,a=o?e:s,l=Ll(n),c=u.useCallback(d=>{if(o){const f=typeof d=="function"?d(e):d;f!==e&&l(f)}else i(d)},[o,e,i,l]);return[a,c]}function QIe({defaultProp:e,onChange:t}){const n=u.useState(e),[s]=n,i=u.useRef(s),o=Ll(t);return u.useEffect(()=>{i.current!==s&&(o(s),i.current=s)},[s,i,o]),n}const hk=u.forwardRef((e,t)=>{const{children:n,...s}=e,i=u.Children.toArray(n),o=i.find(e6e);if(o){const a=o.props.children,l=i.map(c=>c===o?u.Children.count(a)>1?u.Children.only(null):u.isValidElement(a)?a.props.children:null:c);return u.createElement(R2,Ss({},s,{ref:t}),u.isValidElement(a)?u.cloneElement(a,void 0,l):null)}return u.createElement(R2,Ss({},s,{ref:t}),n)});hk.displayName="Slot";const R2=u.forwardRef((e,t)=>{const{children:n,...s}=e;return u.isValidElement(n)?u.cloneElement(n,{...t6e(s,n.props),ref:t?nH(t,n.ref):n.ref}):u.Children.count(n)>1?u.Children.only(null):null});R2.displayName="SlotClone";const JIe=({children:e})=>u.createElement(u.Fragment,null,e);function e6e(e){return u.isValidElement(e)&&e.type===JIe}function t6e(e,t){const n={...t};for(const s in t){const i=e[s],o=t[s];/^on[A-Z]/.test(s)?i&&o?n[s]=(...l)=>{o(...l),i(...l)}:i&&(n[s]=i):s==="style"?n[s]={...i,...o}:s==="className"&&(n[s]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}const n6e=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ri=n6e.reduce((e,t)=>{const n=u.forwardRef((s,i)=>{const{asChild:o,...a}=s,l=o?hk:t;return u.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),u.createElement(l,Ss({},a,{ref:i}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function s6e(e,t){e&&Wl.flushSync(()=>e.dispatchEvent(t))}function r6e(e,t=globalThis==null?void 0:globalThis.document){const n=Ll(e);u.useEffect(()=>{const s=i=>{i.key==="Escape"&&n(i)};return t.addEventListener("keydown",s),()=>t.removeEventListener("keydown",s)},[n,t])}const O2="dismissableLayer.update",i6e="dismissableLayer.pointerDownOutside",o6e="dismissableLayer.focusOutside";let hA;const a6e=u.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),l6e=u.forwardRef((e,t)=>{var n;const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:i,onPointerDownOutside:o,onFocusOutside:a,onInteractOutside:l,onDismiss:c,...d}=e,h=u.useContext(a6e),[f,p]=u.useState(null),g=(n=f==null?void 0:f.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,m]=u.useState({}),y=Yp(t,A=>p(A)),x=Array.from(h.layers),[C]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),v=x.indexOf(C),b=f?x.indexOf(f):-1,S=h.layersWithOutsidePointerEventsDisabled.size>0,w=b>=v,j=c6e(A=>{const L=A.target,M=[...h.branches].some(O=>O.contains(L));!w||M||(o==null||o(A),l==null||l(A),A.defaultPrevented||c==null||c())},g),E=u6e(A=>{const L=A.target;[...h.branches].some(O=>O.contains(L))||(a==null||a(A),l==null||l(A),A.defaultPrevented||c==null||c())},g);return r6e(A=>{b===h.layers.size-1&&(i==null||i(A),!A.defaultPrevented&&c&&(A.preventDefault(),c()))},g),u.useEffect(()=>{if(f)return s&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(hA=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(f)),h.layers.add(f),fA(),()=>{s&&h.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=hA)}},[f,g,s,h]),u.useEffect(()=>()=>{f&&(h.layers.delete(f),h.layersWithOutsidePointerEventsDisabled.delete(f),fA())},[f,h]),u.useEffect(()=>{const A=()=>m({});return document.addEventListener(O2,A),()=>document.removeEventListener(O2,A)},[]),u.createElement(ri.div,Ss({},d,{ref:y,style:{pointerEvents:S?w?"auto":"none":void 0,...e.style},onFocusCapture:lu(e.onFocusCapture,E.onFocusCapture),onBlurCapture:lu(e.onBlurCapture,E.onBlurCapture),onPointerDownCapture:lu(e.onPointerDownCapture,j.onPointerDownCapture)}))});function c6e(e,t=globalThis==null?void 0:globalThis.document){const n=Ll(e),s=u.useRef(!1),i=u.useRef(()=>{});return u.useEffect(()=>{const o=l=>{if(l.target&&!s.current){let d=function(){sH(i6e,n,c,{discrete:!0})};const c={originalEvent:l};l.pointerType==="touch"?(t.removeEventListener("click",i.current),i.current=d,t.addEventListener("click",i.current,{once:!0})):d()}else t.removeEventListener("click",i.current);s.current=!1},a=window.setTimeout(()=>{t.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(a),t.removeEventListener("pointerdown",o),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>s.current=!0}}function u6e(e,t=globalThis==null?void 0:globalThis.document){const n=Ll(e),s=u.useRef(!1);return u.useEffect(()=>{const i=o=>{o.target&&!s.current&&sH(o6e,n,{originalEvent:o},{discrete:!1})};return t.addEventListener("focusin",i),()=>t.removeEventListener("focusin",i)},[t,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function fA(){const e=new CustomEvent(O2);document.dispatchEvent(e)}function sH(e,t,n,{discrete:s}){const i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),s?s6e(i,o):i.dispatchEvent(o)}const Cb="focusScope.autoFocusOnMount",Sb="focusScope.autoFocusOnUnmount",pA={bubbles:!1,cancelable:!0},d6e=u.forwardRef((e,t)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:i,onUnmountAutoFocus:o,...a}=e,[l,c]=u.useState(null),d=Ll(i),h=Ll(o),f=u.useRef(null),p=Yp(t,y=>c(y)),g=u.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;u.useEffect(()=>{if(s){let y=function(b){if(g.paused||!l)return;const S=b.target;l.contains(S)?f.current=S:sa(f.current,{select:!0})},x=function(b){if(g.paused||!l)return;const S=b.relatedTarget;S!==null&&(l.contains(S)||sa(f.current,{select:!0}))},C=function(b){if(document.activeElement===document.body)for(const w of b)w.removedNodes.length>0&&sa(l)};document.addEventListener("focusin",y),document.addEventListener("focusout",x);const v=new MutationObserver(C);return l&&v.observe(l,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",y),document.removeEventListener("focusout",x),v.disconnect()}}},[s,l,g.paused]),u.useEffect(()=>{if(l){mA.add(g);const y=document.activeElement;if(!l.contains(y)){const C=new CustomEvent(Cb,pA);l.addEventListener(Cb,d),l.dispatchEvent(C),C.defaultPrevented||(h6e(y6e(rH(l)),{select:!0}),document.activeElement===y&&sa(l))}return()=>{l.removeEventListener(Cb,d),setTimeout(()=>{const C=new CustomEvent(Sb,pA);l.addEventListener(Sb,h),l.dispatchEvent(C),C.defaultPrevented||sa(y??document.body,{select:!0}),l.removeEventListener(Sb,h),mA.remove(g)},0)}}},[l,d,h,g]);const m=u.useCallback(y=>{if(!n&&!s||g.paused)return;const x=y.key==="Tab"&&!y.altKey&&!y.ctrlKey&&!y.metaKey,C=document.activeElement;if(x&&C){const v=y.currentTarget,[b,S]=f6e(v);b&&S?!y.shiftKey&&C===S?(y.preventDefault(),n&&sa(b,{select:!0})):y.shiftKey&&C===b&&(y.preventDefault(),n&&sa(S,{select:!0})):C===v&&y.preventDefault()}},[n,s,g.paused]);return u.createElement(ri.div,Ss({tabIndex:-1},a,{ref:p,onKeyDown:m}))});function h6e(e,{select:t=!1}={}){const n=document.activeElement;for(const s of e)if(sa(s,{select:t}),document.activeElement!==n)return}function f6e(e){const t=rH(e),n=gA(t,e),s=gA(t.reverse(),e);return[n,s]}function rH(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const i=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||i?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function gA(e,t){for(const n of e)if(!p6e(n,{upTo:t}))return n}function p6e(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function g6e(e){return e instanceof HTMLInputElement&&"select"in e}function sa(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&g6e(e)&&t&&e.select()}}const mA=m6e();function m6e(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=yA(e,t),e.unshift(t)},remove(t){var n;e=yA(e,t),(n=e[0])===null||n===void 0||n.resume()}}}function yA(e,t){const n=[...e],s=n.indexOf(t);return s!==-1&&n.splice(s,1),n}function y6e(e){return e.filter(t=>t.tagName!=="A")}const v6e=u.forwardRef((e,t)=>{var n;const{container:s=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...i}=e;return s?aP.createPortal(u.createElement(ri.div,Ss({},i,{ref:t})),s):null});function b6e(e,t){return u.useReducer((n,s)=>{const i=t[n][s];return i??n},e)}const Py=e=>{const{present:t,children:n}=e,s=x6e(t),i=typeof n=="function"?n({present:s.isPresent}):u.Children.only(n),o=Yp(s.ref,i.ref);return typeof n=="function"||s.isPresent?u.cloneElement(i,{ref:o}):null};Py.displayName="Presence";function x6e(e){const[t,n]=u.useState(),s=u.useRef({}),i=u.useRef(e),o=u.useRef("none"),a=e?"mounted":"unmounted",[l,c]=b6e(a,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return u.useEffect(()=>{const d=Kg(s.current);o.current=l==="mounted"?d:"none"},[l]),D2(()=>{const d=s.current,h=i.current;if(h!==e){const p=o.current,g=Kg(d);e?c("MOUNT"):g==="none"||(d==null?void 0:d.display)==="none"?c("UNMOUNT"):c(h&&p!==g?"ANIMATION_OUT":"UNMOUNT"),i.current=e}},[e,c]),D2(()=>{if(t){const d=f=>{const g=Kg(s.current).includes(f.animationName);f.target===t&&g&&Wl.flushSync(()=>c("ANIMATION_END"))},h=f=>{f.target===t&&(o.current=Kg(s.current))};return t.addEventListener("animationstart",h),t.addEventListener("animationcancel",d),t.addEventListener("animationend",d),()=>{t.removeEventListener("animationstart",h),t.removeEventListener("animationcancel",d),t.removeEventListener("animationend",d)}}else c("ANIMATION_END")},[t,c]),{isPresent:["mounted","unmountSuspended"].includes(l),ref:u.useCallback(d=>{d&&(s.current=getComputedStyle(d)),n(d)},[])}}function Kg(e){return(e==null?void 0:e.animationName)||"none"}let wb=0;function C6e(){u.useEffect(()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(e=n[0])!==null&&e!==void 0?e:vA()),document.body.insertAdjacentElement("beforeend",(t=n[1])!==null&&t!==void 0?t:vA()),wb++,()=>{wb===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),wb--}},[])}function vA(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var Sm="right-scroll-bar-position",wm="width-before-scroll-bar",S6e="with-scroll-bars-hidden",w6e="--removed-body-scroll-bar-size";function jb(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function j6e(e,t){var n=u.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(s){var i=n.value;i!==s&&(n.value=s,n.callback(s,i))}}}})[0];return n.callback=t,n.facade}var k6e=typeof window<"u"?u.useLayoutEffect:u.useEffect,bA=new WeakMap;function _6e(e,t){var n=j6e(null,function(s){return e.forEach(function(i){return jb(i,s)})});return k6e(function(){var s=bA.get(n);if(s){var i=new Set(s),o=new Set(e),a=n.current;i.forEach(function(l){o.has(l)||jb(l,null)}),o.forEach(function(l){i.has(l)||jb(l,a)})}bA.set(n,e)},[e]),n}function I6e(e){return e}function A6e(e,t){t===void 0&&(t=I6e);var n=[],s=!1,i={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(o){var a=t(o,s);return n.push(a),function(){n=n.filter(function(l){return l!==a})}},assignSyncMedium:function(o){for(s=!0;n.length;){var a=n;n=[],a.forEach(o)}n={push:function(l){return o(l)},filter:function(){return n}}},assignMedium:function(o){s=!0;var a=[];if(n.length){var l=n;n=[],l.forEach(o),a=n}var c=function(){var h=a;a=[],h.forEach(o)},d=function(){return Promise.resolve().then(c)};d(),n={push:function(h){a.push(h),d()},filter:function(h){return a=a.filter(h),n}}}};return i}function T6e(e){e===void 0&&(e={});var t=A6e(null);return t.options=$i({async:!0,ssr:!1},e),t}var iH=function(e){var t=e.sideCar,n=bR(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return u.createElement(s,$i({},n))};iH.isSideCarExport=!0;function M6e(e,t){return e.useMedium(t),iH}var oH=T6e(),kb=function(){},Ey=u.forwardRef(function(e,t){var n=u.useRef(null),s=u.useState({onScrollCapture:kb,onWheelCapture:kb,onTouchMoveCapture:kb}),i=s[0],o=s[1],a=e.forwardProps,l=e.children,c=e.className,d=e.removeScrollBar,h=e.enabled,f=e.shards,p=e.sideCar,g=e.noIsolation,m=e.inert,y=e.allowPinchZoom,x=e.as,C=x===void 0?"div":x,v=bR(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),b=p,S=_6e([n,t]),w=$i($i({},v),i);return u.createElement(u.Fragment,null,h&&u.createElement(b,{sideCar:oH,removeScrollBar:d,shards:f,noIsolation:g,inert:m,setCallbacks:o,allowPinchZoom:!!y,lockRef:n}),a?u.cloneElement(u.Children.only(l),$i($i({},w),{ref:S})):u.createElement(C,$i({},w,{className:c,ref:S}),l))});Ey.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};Ey.classNames={fullWidth:wm,zeroRight:Sm};var P6e=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function E6e(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=P6e();return t&&e.setAttribute("nonce",t),e}function L6e(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function D6e(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var R6e=function(){var e=0,t=null;return{add:function(n){e==0&&(t=E6e())&&(L6e(t,n),D6e(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},O6e=function(){var e=R6e();return function(t,n){u.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},aH=function(){var e=O6e(),t=function(n){var s=n.styles,i=n.dynamic;return e(s,i),null};return t},N6e={left:0,top:0,right:0,gap:0},_b=function(e){return parseInt(e||"",10)||0},F6e=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],i=t[e==="padding"?"paddingRight":"marginRight"];return[_b(n),_b(s),_b(i)]},B6e=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return N6e;var t=F6e(e),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-n+t[2]-t[0])}},$6e=aH(),cu="data-scroll-locked",V6e=function(e,t,n,s){var i=e.left,o=e.top,a=e.right,l=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(S6e,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(l,"px ").concat(s,`;
  }
  body[`).concat(cu,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(i,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(a,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(l,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(l,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(Sm,` {
    right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(wm,` {
    margin-right: `).concat(l,"px ").concat(s,`;
  }
  
  .`).concat(Sm," .").concat(Sm,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(wm," .").concat(wm,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(cu,`] {
    `).concat(w6e,": ").concat(l,`px;
  }
`)},xA=function(){var e=parseInt(document.body.getAttribute(cu)||"0",10);return isFinite(e)?e:0},G6e=function(){u.useEffect(function(){return document.body.setAttribute(cu,(xA()+1).toString()),function(){var e=xA()-1;e<=0?document.body.removeAttribute(cu):document.body.setAttribute(cu,e.toString())}},[])},z6e=function(e){var t=e.noRelative,n=e.noImportant,s=e.gapMode,i=s===void 0?"margin":s;G6e();var o=u.useMemo(function(){return B6e(i)},[i]);return u.createElement($6e,{styles:V6e(o,!t,i,n?"":"!important")})},N2=!1;if(typeof window<"u")try{var Zg=Object.defineProperty({},"passive",{get:function(){return N2=!0,!0}});window.addEventListener("test",Zg,Zg),window.removeEventListener("test",Zg,Zg)}catch{N2=!1}var yc=N2?{passive:!1}:!1,H6e=function(e){return e.tagName==="TEXTAREA"},lH=function(e,t){var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!H6e(e)&&n[t]==="visible")},W6e=function(e){return lH(e,"overflowY")},U6e=function(e){return lH(e,"overflowX")},CA=function(e,t){var n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=cH(e,n);if(s){var i=uH(e,n),o=i[1],a=i[2];if(o>a)return!0}n=n.parentNode}while(n&&n!==document.body);return!1},q6e=function(e){var t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[t,n,s]},K6e=function(e){var t=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[t,n,s]},cH=function(e,t){return e==="v"?W6e(t):U6e(t)},uH=function(e,t){return e==="v"?q6e(t):K6e(t)},Z6e=function(e,t){return e==="h"&&t==="rtl"?-1:1},Y6e=function(e,t,n,s,i){var o=Z6e(e,window.getComputedStyle(t).direction),a=o*s,l=n.target,c=t.contains(l),d=!1,h=a>0,f=0,p=0;do{var g=uH(e,l),m=g[0],y=g[1],x=g[2],C=y-x-o*m;(m||C)&&cH(e,l)&&(f+=C,p+=m),l=l.parentNode}while(!c&&l!==document.body||c&&(t.contains(l)||t===l));return(h&&f===0||!h&&p===0)&&(d=!0),d},Yg=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},SA=function(e){return[e.deltaX,e.deltaY]},wA=function(e){return e&&"current"in e?e.current:e},X6e=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Q6e=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},J6e=0,vc=[];function e8e(e){var t=u.useRef([]),n=u.useRef([0,0]),s=u.useRef(),i=u.useState(J6e++)[0],o=u.useState(function(){return aH()})[0],a=u.useRef(e);u.useEffect(function(){a.current=e},[e]),u.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var y=Lx([e.lockRef.current],(e.shards||[]).map(wA),!0).filter(Boolean);return y.forEach(function(x){return x.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),y.forEach(function(x){return x.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var l=u.useCallback(function(y,x){if("touches"in y&&y.touches.length===2)return!a.current.allowPinchZoom;var C=Yg(y),v=n.current,b="deltaX"in y?y.deltaX:v[0]-C[0],S="deltaY"in y?y.deltaY:v[1]-C[1],w,j=y.target,E=Math.abs(b)>Math.abs(S)?"h":"v";if("touches"in y&&E==="h"&&j.type==="range")return!1;var A=CA(E,j);if(!A)return!0;if(A?w=E:(w=E==="v"?"h":"v",A=CA(E,j)),!A)return!1;if(!s.current&&"changedTouches"in y&&(b||S)&&(s.current=w),!w)return!0;var L=s.current||w;return Y6e(L,x,y,L==="h"?b:S)},[]),c=u.useCallback(function(y){var x=y;if(!(!vc.length||vc[vc.length-1]!==o)){var C="deltaY"in x?SA(x):Yg(x),v=t.current.filter(function(w){return w.name===x.type&&w.target===x.target&&X6e(w.delta,C)})[0];if(v&&v.should){x.cancelable&&x.preventDefault();return}if(!v){var b=(a.current.shards||[]).map(wA).filter(Boolean).filter(function(w){return w.contains(x.target)}),S=b.length>0?l(x,b[0]):!a.current.noIsolation;S&&x.cancelable&&x.preventDefault()}}},[]),d=u.useCallback(function(y,x,C,v){var b={name:y,delta:x,target:C,should:v};t.current.push(b),setTimeout(function(){t.current=t.current.filter(function(S){return S!==b})},1)},[]),h=u.useCallback(function(y){n.current=Yg(y),s.current=void 0},[]),f=u.useCallback(function(y){d(y.type,SA(y),y.target,l(y,e.lockRef.current))},[]),p=u.useCallback(function(y){d(y.type,Yg(y),y.target,l(y,e.lockRef.current))},[]);u.useEffect(function(){return vc.push(o),e.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:p}),document.addEventListener("wheel",c,yc),document.addEventListener("touchmove",c,yc),document.addEventListener("touchstart",h,yc),function(){vc=vc.filter(function(y){return y!==o}),document.removeEventListener("wheel",c,yc),document.removeEventListener("touchmove",c,yc),document.removeEventListener("touchstart",h,yc)}},[]);var g=e.removeScrollBar,m=e.inert;return u.createElement(u.Fragment,null,m?u.createElement(o,{styles:Q6e(i)}):null,g?u.createElement(z6e,{gapMode:"margin"}):null)}const t8e=M6e(oH,e8e);var dH=u.forwardRef(function(e,t){return u.createElement(Ey,$i({},e,{ref:t,sideCar:t8e}))});dH.classNames=Ey.classNames;var n8e=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},bc=new WeakMap,Xg=new WeakMap,Qg={},Ib=0,hH=function(e){return e&&(e.host||hH(e.parentNode))},s8e=function(e,t){return t.map(function(n){if(e.contains(n))return n;var s=hH(n);return s&&e.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},r8e=function(e,t,n,s){var i=s8e(t,Array.isArray(e)?e:[e]);Qg[n]||(Qg[n]=new WeakMap);var o=Qg[n],a=[],l=new Set,c=new Set(i),d=function(f){!f||l.has(f)||(l.add(f),d(f.parentNode))};i.forEach(d);var h=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(p){if(l.has(p))h(p);else try{var g=p.getAttribute(s),m=g!==null&&g!=="false",y=(bc.get(p)||0)+1,x=(o.get(p)||0)+1;bc.set(p,y),o.set(p,x),a.push(p),y===1&&m&&Xg.set(p,!0),x===1&&p.setAttribute(n,"true"),m||p.setAttribute(s,"true")}catch(C){console.error("aria-hidden: cannot operate on ",p,C)}})};return h(t),l.clear(),Ib++,function(){a.forEach(function(f){var p=bc.get(f)-1,g=o.get(f)-1;bc.set(f,p),o.set(f,g),p||(Xg.has(f)||f.removeAttribute(s),Xg.delete(f)),g||f.removeAttribute(n)}),Ib--,Ib||(bc=new WeakMap,bc=new WeakMap,Xg=new WeakMap,Qg={})}},i8e=function(e,t,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),i=n8e(e);return i?(s.push.apply(s,Array.from(i.querySelectorAll("[aria-live]"))),r8e(s,i,n,"aria-hidden")):function(){return null}};const fH="Dialog",[pH,CEe]=qIe(fH),[o8e,oc]=pH(fH),a8e=e=>{const{__scopeDialog:t,children:n,open:s,defaultOpen:i,onOpenChange:o,modal:a=!0}=e,l=u.useRef(null),c=u.useRef(null),[d=!1,h]=XIe({prop:s,defaultProp:i,onChange:o});return u.createElement(o8e,{scope:t,triggerRef:l,contentRef:c,contentId:xb(),titleId:xb(),descriptionId:xb(),open:d,onOpenChange:h,onOpenToggle:u.useCallback(()=>h(f=>!f),[h]),modal:a},n)},gH="DialogPortal",[l8e,mH]=pH(gH,{forceMount:void 0}),c8e=e=>{const{__scopeDialog:t,forceMount:n,children:s,container:i}=e,o=oc(gH,t);return u.createElement(l8e,{scope:t,forceMount:n},u.Children.map(s,a=>u.createElement(Py,{present:n||o.open},u.createElement(v6e,{asChild:!0,container:i},a))))},F2="DialogOverlay",u8e=u.forwardRef((e,t)=>{const n=mH(F2,e.__scopeDialog),{forceMount:s=n.forceMount,...i}=e,o=oc(F2,e.__scopeDialog);return o.modal?u.createElement(Py,{present:s||o.open},u.createElement(d8e,Ss({},i,{ref:t}))):null}),d8e=u.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,i=oc(F2,n);return u.createElement(dH,{as:hk,allowPinchZoom:!0,shards:[i.contentRef]},u.createElement(ri.div,Ss({"data-state":vH(i.open)},s,{ref:t,style:{pointerEvents:"auto",...s.style}})))}),Iu="DialogContent",h8e=u.forwardRef((e,t)=>{const n=mH(Iu,e.__scopeDialog),{forceMount:s=n.forceMount,...i}=e,o=oc(Iu,e.__scopeDialog);return u.createElement(Py,{present:s||o.open},o.modal?u.createElement(f8e,Ss({},i,{ref:t})):u.createElement(p8e,Ss({},i,{ref:t})))}),f8e=u.forwardRef((e,t)=>{const n=oc(Iu,e.__scopeDialog),s=u.useRef(null),i=Yp(t,n.contentRef,s);return u.useEffect(()=>{const o=s.current;if(o)return i8e(o)},[]),u.createElement(yH,Ss({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:lu(e.onCloseAutoFocus,o=>{var a;o.preventDefault(),(a=n.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:lu(e.onPointerDownOutside,o=>{const a=o.detail.originalEvent,l=a.button===0&&a.ctrlKey===!0;(a.button===2||l)&&o.preventDefault()}),onFocusOutside:lu(e.onFocusOutside,o=>o.preventDefault())}))}),p8e=u.forwardRef((e,t)=>{const n=oc(Iu,e.__scopeDialog),s=u.useRef(!1),i=u.useRef(!1);return u.createElement(yH,Ss({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var a;if((a=e.onCloseAutoFocus)===null||a===void 0||a.call(e,o),!o.defaultPrevented){var l;s.current||(l=n.triggerRef.current)===null||l===void 0||l.focus(),o.preventDefault()}s.current=!1,i.current=!1},onInteractOutside:o=>{var a,l;(a=e.onInteractOutside)===null||a===void 0||a.call(e,o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(i.current=!0));const c=o.target;((l=n.triggerRef.current)===null||l===void 0?void 0:l.contains(c))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&i.current&&o.preventDefault()}}))}),yH=u.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:i,onCloseAutoFocus:o,...a}=e,l=oc(Iu,n),c=u.useRef(null),d=Yp(t,c);return C6e(),u.createElement(u.Fragment,null,u.createElement(d6e,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:i,onUnmountAutoFocus:o},u.createElement(l6e,Ss({role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":vH(l.open)},a,{ref:d,onDismiss:()=>l.onOpenChange(!1)}))),!1)}),g8e="DialogTitle";function vH(e){return e?"open":"closed"}const m8e="DialogTitleWarning";UIe(m8e,{contentName:Iu,titleName:g8e,docsSlug:"dialog"});const y8e=a8e,v8e=c8e,b8e=u8e,x8e=h8e;var kh='[cmdk-group=""]',Ab='[cmdk-group-items=""]',C8e='[cmdk-group-heading=""]',fk='[cmdk-item=""]',jA=`${fk}:not([aria-disabled="true"])`,B2="cmdk-item-select",rl="data-value",S8e=(e,t,n)=>HIe(e,t,n),bH=u.createContext(void 0),Xp=()=>u.useContext(bH),xH=u.createContext(void 0),pk=()=>u.useContext(xH),CH=u.createContext(void 0),gk=u.forwardRef((e,t)=>{let n=Tc(()=>{var H,V;return{search:"",value:(V=(H=e.value)!=null?H:e.defaultValue)!=null?V:"",filtered:{count:0,items:new Map,groups:new Set}}}),s=Tc(()=>new Set),i=Tc(()=>new Map),o=Tc(()=>new Map),a=Tc(()=>new Set),l=kH(e),{label:c,children:d,value:h,onValueChange:f,filter:p,shouldFilter:g,loop:m,disablePointerSelection:y=!1,vimBindings:x=!0,...C}=e,v=u.useId(),b=u.useId(),S=u.useId(),w=u.useRef(null),j=M8e();Dl(()=>{if(h!==void 0){let H=h.trim();n.current.value=H,E.emit()}},[h]),Dl(()=>{j(6,_)},[]);let E=u.useMemo(()=>({subscribe:H=>(a.current.add(H),()=>a.current.delete(H)),snapshot:()=>n.current,setState:(H,V,Y)=>{var W,J,N;if(!Object.is(n.current[H],V)){if(n.current[H]=V,H==="search")F(),M(),j(1,O);else if(H==="value"&&(Y||j(5,_),((W=l.current)==null?void 0:W.value)!==void 0)){let B=V??"";(N=(J=l.current).onValueChange)==null||N.call(J,B);return}E.emit()}},emit:()=>{a.current.forEach(H=>H())}}),[]),A=u.useMemo(()=>({value:(H,V,Y)=>{var W;V!==((W=o.current.get(H))==null?void 0:W.value)&&(o.current.set(H,{value:V,keywords:Y}),n.current.filtered.items.set(H,L(V,Y)),j(2,()=>{M(),E.emit()}))},item:(H,V)=>(s.current.add(H),V&&(i.current.has(V)?i.current.get(V).add(H):i.current.set(V,new Set([H]))),j(3,()=>{F(),M(),n.current.value||O(),E.emit()}),()=>{o.current.delete(H),s.current.delete(H),n.current.filtered.items.delete(H);let Y=R();j(4,()=>{F(),(Y==null?void 0:Y.getAttribute("id"))===H&&O(),E.emit()})}),group:H=>(i.current.has(H)||i.current.set(H,new Set),()=>{o.current.delete(H),i.current.delete(H)}),filter:()=>l.current.shouldFilter,label:c||e["aria-label"],disablePointerSelection:y,listId:v,inputId:S,labelId:b,listInnerRef:w}),[]);function L(H,V){var Y,W;let J=(W=(Y=l.current)==null?void 0:Y.filter)!=null?W:S8e;return H?J(H,n.current.search,V):0}function M(){if(!n.current.search||l.current.shouldFilter===!1)return;let H=n.current.filtered.items,V=[];n.current.filtered.groups.forEach(W=>{let J=i.current.get(W),N=0;J.forEach(B=>{let U=H.get(B);N=Math.max(U,N)}),V.push([W,N])});let Y=w.current;D().sort((W,J)=>{var N,B;let U=W.getAttribute("id"),ie=J.getAttribute("id");return((N=H.get(ie))!=null?N:0)-((B=H.get(U))!=null?B:0)}).forEach(W=>{let J=W.closest(Ab);J?J.appendChild(W.parentElement===J?W:W.closest(`${Ab} > *`)):Y.appendChild(W.parentElement===Y?W:W.closest(`${Ab} > *`))}),V.sort((W,J)=>J[1]-W[1]).forEach(W=>{let J=w.current.querySelector(`${kh}[${rl}="${encodeURIComponent(W[0])}"]`);J==null||J.parentElement.appendChild(J)})}function O(){let H=D().find(Y=>Y.getAttribute("aria-disabled")!=="true"),V=H==null?void 0:H.getAttribute(rl);E.setState("value",V||void 0)}function F(){var H,V,Y,W;if(!n.current.search||l.current.shouldFilter===!1){n.current.filtered.count=s.current.size;return}n.current.filtered.groups=new Set;let J=0;for(let N of s.current){let B=(V=(H=o.current.get(N))==null?void 0:H.value)!=null?V:"",U=(W=(Y=o.current.get(N))==null?void 0:Y.keywords)!=null?W:[],ie=L(B,U);n.current.filtered.items.set(N,ie),ie>0&&J++}for(let[N,B]of i.current)for(let U of B)if(n.current.filtered.items.get(U)>0){n.current.filtered.groups.add(N);break}n.current.filtered.count=J}function _(){var H,V,Y;let W=R();W&&(((H=W.parentElement)==null?void 0:H.firstChild)===W&&((Y=(V=W.closest(kh))==null?void 0:V.querySelector(C8e))==null||Y.scrollIntoView({block:"nearest"})),W.scrollIntoView({block:"nearest"}))}function R(){var H;return(H=w.current)==null?void 0:H.querySelector(`${fk}[aria-selected="true"]`)}function D(){var H;return Array.from((H=w.current)==null?void 0:H.querySelectorAll(jA))}function $(H){let V=D()[H];V&&E.setState("value",V.getAttribute(rl))}function G(H){var V;let Y=R(),W=D(),J=W.findIndex(B=>B===Y),N=W[J+H];(V=l.current)!=null&&V.loop&&(N=J+H<0?W[W.length-1]:J+H===W.length?W[0]:W[J+H]),N&&E.setState("value",N.getAttribute(rl))}function ee(H){let V=R(),Y=V==null?void 0:V.closest(kh),W;for(;Y&&!W;)Y=H>0?A8e(Y,kh):T8e(Y,kh),W=Y==null?void 0:Y.querySelector(jA);W?E.setState("value",W.getAttribute(rl)):G(H)}let Q=()=>$(D().length-1),se=H=>{H.preventDefault(),H.metaKey?Q():H.altKey?ee(1):G(1)},ne=H=>{H.preventDefault(),H.metaKey?$(0):H.altKey?ee(-1):G(-1)};return u.createElement(ri.div,{ref:t,tabIndex:-1,...C,"cmdk-root":"",onKeyDown:H=>{var V;if((V=C.onKeyDown)==null||V.call(C,H),!H.defaultPrevented)switch(H.key){case"n":case"j":{x&&H.ctrlKey&&se(H);break}case"ArrowDown":{se(H);break}case"p":case"k":{x&&H.ctrlKey&&ne(H);break}case"ArrowUp":{ne(H);break}case"Home":{H.preventDefault(),$(0);break}case"End":{H.preventDefault(),Q();break}case"Enter":if(!H.nativeEvent.isComposing&&H.keyCode!==229){H.preventDefault();let Y=R();if(Y){let W=new Event(B2);Y.dispatchEvent(W)}}}}},u.createElement("label",{"cmdk-label":"",htmlFor:A.inputId,id:A.labelId,style:E8e},c),Ly(e,H=>u.createElement(xH.Provider,{value:E},u.createElement(bH.Provider,{value:A},H))))}),SH=u.forwardRef((e,t)=>{var n,s;let i=u.useId(),o=u.useRef(null),a=u.useContext(CH),l=Xp(),c=kH(e),d=(s=(n=c.current)==null?void 0:n.forceMount)!=null?s:a==null?void 0:a.forceMount;Dl(()=>{if(!d)return l.item(i,a==null?void 0:a.id)},[d]);let h=_H(i,o,[e.value,e.children,o],e.keywords),f=pk(),p=Rl(j=>j.value&&j.value===h.current),g=Rl(j=>d||l.filter()===!1?!0:j.search?j.filtered.items.get(i)>0:!0);u.useEffect(()=>{let j=o.current;if(!(!j||e.disabled))return j.addEventListener(B2,m),()=>j.removeEventListener(B2,m)},[g,e.onSelect,e.disabled]);function m(){var j,E;y(),(E=(j=c.current).onSelect)==null||E.call(j,h.current)}function y(){f.setState("value",h.current,!0)}if(!g)return null;let{disabled:x,value:C,onSelect:v,forceMount:b,keywords:S,...w}=e;return u.createElement(ri.div,{ref:Of([o,t]),...w,id:i,"cmdk-item":"",role:"option","aria-disabled":!!x,"aria-selected":!!p,"data-disabled":!!x,"data-selected":!!p,onPointerMove:x||l.disablePointerSelection?void 0:y,onClick:x?void 0:m},e.children)}),w8e=u.forwardRef((e,t)=>{let{heading:n,children:s,forceMount:i,...o}=e,a=u.useId(),l=u.useRef(null),c=u.useRef(null),d=u.useId(),h=Xp(),f=Rl(g=>i||h.filter()===!1?!0:g.search?g.filtered.groups.has(a):!0);Dl(()=>h.group(a),[]),_H(a,l,[e.value,e.heading,c]);let p=u.useMemo(()=>({id:a,forceMount:i}),[i]);return u.createElement(ri.div,{ref:Of([l,t]),...o,"cmdk-group":"",role:"presentation",hidden:f?void 0:!0},n&&u.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:d},n),Ly(e,g=>u.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?d:void 0},u.createElement(CH.Provider,{value:p},g))))}),j8e=u.forwardRef((e,t)=>{let{alwaysRender:n,...s}=e,i=u.useRef(null),o=Rl(a=>!a.search);return!n&&!o?null:u.createElement(ri.div,{ref:Of([i,t]),...s,"cmdk-separator":"",role:"separator"})}),k8e=u.forwardRef((e,t)=>{let{onValueChange:n,...s}=e,i=e.value!=null,o=pk(),a=Rl(h=>h.search),l=Rl(h=>h.value),c=Xp(),d=u.useMemo(()=>{var h;let f=(h=c.listInnerRef.current)==null?void 0:h.querySelector(`${fk}[${rl}="${encodeURIComponent(l)}"]`);return f==null?void 0:f.getAttribute("id")},[]);return u.useEffect(()=>{e.value!=null&&o.setState("search",e.value)},[e.value]),u.createElement(ri.input,{ref:t,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":d,id:c.inputId,type:"text",value:i?e.value:a,onChange:h=>{i||o.setState("search",h.target.value),n==null||n(h.target.value)}})}),wH=u.forwardRef((e,t)=>{let{children:n,label:s="Suggestions",...i}=e,o=u.useRef(null),a=u.useRef(null),l=Xp();return u.useEffect(()=>{if(a.current&&o.current){let c=a.current,d=o.current,h,f=new ResizeObserver(()=>{h=requestAnimationFrame(()=>{let p=c.offsetHeight;d.style.setProperty("--cmdk-list-height",p.toFixed(1)+"px")})});return f.observe(c),()=>{cancelAnimationFrame(h),f.unobserve(c)}}},[]),u.createElement(ri.div,{ref:Of([o,t]),...i,"cmdk-list":"",role:"listbox","aria-label":s,id:l.listId},Ly(e,c=>u.createElement("div",{ref:Of([a,l.listInnerRef]),"cmdk-list-sizer":""},c)))}),_8e=u.forwardRef((e,t)=>{let{open:n,onOpenChange:s,overlayClassName:i,contentClassName:o,container:a,...l}=e;return u.createElement(y8e,{open:n,onOpenChange:s},u.createElement(v8e,{container:a},u.createElement(b8e,{"cmdk-overlay":"",className:i}),u.createElement(x8e,{"aria-label":e.label,"cmdk-dialog":"",className:o},u.createElement(gk,{ref:t,...l}))))}),jH=u.forwardRef((e,t)=>Rl(n=>n.filtered.count===0)?u.createElement(ri.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),I8e=u.forwardRef((e,t)=>{let{progress:n,children:s,label:i="Loading...",...o}=e;return u.createElement(ri.div,{ref:t,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},Ly(e,a=>u.createElement("div",{"aria-hidden":!0},a)))});Object.assign(gk,{List:wH,Item:SH,Input:k8e,Group:w8e,Separator:j8e,Dialog:_8e,Empty:jH,Loading:I8e});function A8e(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function T8e(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function kH(e){let t=u.useRef(e);return Dl(()=>{t.current=e}),t}var Dl=typeof window>"u"?u.useEffect:u.useLayoutEffect;function Tc(e){let t=u.useRef();return t.current===void 0&&(t.current=e()),t}function Of(e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}function Rl(e){let t=pk(),n=()=>e(t.snapshot());return u.useSyncExternalStore(t.subscribe,n,n)}function _H(e,t,n,s=[]){let i=u.useRef(),o=Xp();return Dl(()=>{var a;let l=(()=>{var d;for(let h of n){if(typeof h=="string")return h.trim();if(typeof h=="object"&&"current"in h)return h.current?(d=h.current.textContent)==null?void 0:d.trim():i.current}})(),c=s.map(d=>d.trim());o.value(e,l,c),(a=t.current)==null||a.setAttribute(rl,l),i.current=l}),i}var M8e=()=>{let[e,t]=u.useState(),n=Tc(()=>new Map);return Dl(()=>{n.current.forEach(s=>s()),n.current=new Map},[e]),(s,i)=>{n.current.set(s,i),t({})}};function P8e(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function Ly({asChild:e,children:t},n){return e&&u.isValidElement(t)?u.cloneElement(P8e(t),{ref:t.ref},n(t.props.children)):n(t)}var E8e={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const L8e=e=>{const t=Rm();return{...lP,id:t,type:"current_image",position:e,data:{id:t,type:"current_image",isOpen:!0,label:"Current Image"}}},D8e=e=>{const t=Rm();return{...lP,id:t,type:"notes",position:e,data:{id:t,isOpen:!0,label:"Notes",notes:"",type:"notes"}}},R8e=()=>{const e=ce(xn),t=cP();return u.useCallback(n=>{var c;let s=window.innerWidth/2,i=window.innerHeight/2;const o=(c=document.querySelector("#workflow-editor"))==null?void 0:c.getBoundingClientRect();o&&(s=o.width/2-nx/2+o.left,i=o.height/2-nx/2+o.top);const a=t.screenToFlowPosition({x:s,y:i});if(n==="current_image")return L8e(a);if(n==="notes")return D8e(a);const l=e[n];return Hee(a,l)},[e,t])},IH=(e,t,n)=>{let s=t,i=n;for(;e.find(o=>o.position.x===s&&o.position.y===i);)s=Math.floor(s+50),i=Math.floor(i+50);return{x:s,y:i}},AH=(e,t)=>{const n="originalType"in e?wl(e,"originalType"):e,s="originalType"in t?wl(t,"originalType"):t,i="originalType"in e?e.originalType:null,o="originalType"in t?t.originalType:null;return!!(ol(n,s)||o&&ol(n,o)||i&&ol(i,s)||i&&o&&ol(i,o))},O8e=(e,t,n,s)=>{const i=n.find(c=>c.target===s&&c.targetHandle==="item");if(!(i!=null&&i.sourceHandle))return null;const o=t.find(c=>c.id===i.source);if(!o)return null;const a=e[o.data.type];if(!a)return null;const l=a.outputs[i.sourceHandle];return l?l.type:null};var N8e=Wee();const kA=Au(N8e),F8e=(e,t,n,s)=>{const i=new kA.Graph;return n.forEach(o=>{i.setNode(o.id)}),s.forEach(o=>{i.setEdge(o.source,o.target)}),i.setEdge(e,t),!kA.alg.isAcyclic(i)},TH=(e,t)=>{if(AH(e,t))return!0;if(e.batch!==t.batch)return!1;const n=e.name==="CollectionItemField"&&!Cc(t),s=ag(e)&&t.name==="CollectionItemField",i=ra(t)&&e.name===t.name,o=e.name==="CollectionField"&&!ag(t),a=t.name==="CollectionField"&&Cc(e),l=ag(e),c=ag(t),d=l&&c,h=l&&ra(t),f=Cc(e)&&Cc(t),p=Cc(e)&&ra(t),g=ra(e)&&ra(t),m=d||f||p||g||h,y=e.name==="IntegerField"&&t.name==="FloatField",x=e.name==="IntegerField"&&t.name==="StringField",C=e.name==="FloatField"&&t.name==="StringField",v=m&&(y||x||C),b=t.name==="AnyField";return n||s||i||o||a||v||b},B8e=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle&&t.source===e.source&&t.sourceHandle===e.sourceHandle,$8e=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle,V8e=()=>({isValid:!0}),us=e=>({isValid:!1,messageTKey:e}),Qp=(e,t,n,s,i,o=!0)=>{if(e.source===e.target)return us("nodes.cannotConnectToSelf");if(o){const a=n.filter(g=>g.id!==(i==null?void 0:i.id));if(a.some(B8e(e)))return us("nodes.cannotDuplicateConnection");const l=t.find(g=>g.id===e.source);if(!l)return us("nodes.missingNode");const c=t.find(g=>g.id===e.target);if(!c)return us("nodes.missingNode");const d=s[l.data.type];if(!d)return us("nodes.missingInvocationTemplate");const h=s[c.data.type];if(!h)return us("nodes.missingInvocationTemplate");const f=d.outputs[e.sourceHandle];if(!f)return us("nodes.missingFieldTemplate");const p=h.inputs[e.targetHandle];if(!p)return us("nodes.missingFieldTemplate");if(p.input==="direct")return us("nodes.cannotConnectToDirectInput");if(c.data.type==="collect"&&e.targetHandle==="item"){const g=O8e(s,t,n,c.id);if(g&&!AH(f.type,g))return us("nodes.cannotMixAndMatchCollectionItemTypes")}if(a.find($8e(e))&&p.type.name!=="CollectionItemField")return us("nodes.inputMayOnlyHaveOneConnection");if(!TH(f.type,p.type))return us("nodes.fieldTypesMustMatch")}return F8e(e.source,e.target,t,n)?us("nodes.connectionWouldCreateCycle"):V8e()},MH=(e,t,n,s,i,o,a,l)=>{if(e===n)return null;if(t&&s)return{source:e,sourceHandle:t,target:n,targetHandle:s};if(t&&!s){const d=G8e(e,t,n,i,o,a,l)[0];return d?{source:e,sourceHandle:t,target:n,targetHandle:d.name}:null}if(!t&&s){const d=z8e(n,s,e,i,o,a,l)[0];return d?{source:e,sourceHandle:d.name,target:n,targetHandle:s}:null}return null},G8e=(e,t,n,s,i,o,a)=>{const l=s.find(g=>g.id===e),c=s.find(g=>g.id===n);if(!l||!c)return[];const d=o[l.data.type],h=o[c.data.type];return!d||!h?[]:d.outputs[t]?Ci(h.inputs).filter(g=>{const m={source:e,sourceHandle:t,target:n,targetHandle:g.name};return Qp(m,s,i,o,a,!0).isValid}):[]},z8e=(e,t,n,s,i,o,a)=>{const l=s.find(g=>g.id===e),c=s.find(g=>g.id===n);if(!c||!l)return[];const d=o[c.data.type],h=o[l.data.type];return!d||!h?[]:h.inputs[t]?Ci(d.outputs).filter(g=>{const m={source:n,sourceHandle:g.name,target:e,targetHandle:t};return Qp(m,s,i,o,a,!0).isValid}):[]},H8e=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:i}=e;return`reactflow__edge-${t}${n||""}-${s}${i||""}`},D0=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:i}=e;return Re(t&&n&&s&&i,"Invalid connection"),{source:t,sourceHandle:n,target:s,targetHandle:i,id:H8e({source:t,sourceHandle:n,target:s,targetHandle:i})}},W8e=(e,t)=>{const[n,s]=u.useState(e),i=u.useRef(Date.now());return u.useEffect(()=>{const o=setTimeout(function(){Date.now()-i.current>=t&&(s(e),i.current=Date.now())},t-(Date.now()-i.current));return()=>{clearTimeout(o)}},[e,t]),n},U8e=()=>{const{t:e}=P(),t=_a(),n=R8e(),s=ce(xn),i=ce(yr);return u.useCallback(a=>{const l=n(a);if(!l){const g=e("nodes.unknownNode",{nodeType:a});fe({status:"error",title:g});return}const c=QC.get(),{nodes:d,edges:h}=ot(t.getState());l.position=IH(d,(c==null?void 0:c.x)??l.position.x,(c==null?void 0:c.y)??l.position.y),l.selected=!0;const f=[{type:"add",item:l}],p=[];if(d.forEach(({id:g,selected:m})=>{m&&f.push({type:"select",id:g,selected:!1})}),h.forEach(({id:g,selected:m})=>{m&&p.push({type:"select",id:g,selected:!1})}),f.length>0&&t.dispatch(Yc(f)),p.length>0&&t.dispatch(Fi(p)),i&&Yr(l)){const g=fa.get(),{handleType:m}=i,y=m==="source"?i.nodeId:l.id,x=m==="source"?i.handleId:null,C=m==="target"?i.nodeId:l.id,v=m==="target"?i.handleId:null,{nodes:b,edges:S}=ot(t.getState()),w=MH(y,x,C,v,b,S,s,g);if(w){const j=D0(w);t.dispatch(Fi([{type:"add",item:j}]))}}},[n,i,t,e,s])},q8e={"[cmdk-root]":{w:"full",h:"full"},"[cmdk-list]":{w:"full",h:"full"}},PH=u.memo(()=>{const{t:e}=P(),t=XC(),n=u.useRef(null),[s,i]=u.useState(""),o=U8e(),a=I(On),l=W8e(s,100);Ee({id:"addNode",category:"workflows",callback:t.setTrue,options:{enabled:a==="workflows",preventDefault:!0},dependencies:[t.setTrue,a]});const c=u.useCallback(f=>{i(f.target.value)},[]),d=u.useCallback(()=>{t.setFalse(),i(""),yr.set(null)},[t]),h=u.useCallback(f=>{o(f),d()},[o,d]);return r.jsxs(ni,{isOpen:t.isTrue,onClose:d,useInert:!1,initialFocusRef:n,size:"xl",isCentered:!0,children:[r.jsx(rr,{}),r.jsx(si,{h:"512",maxH:"70%",children:r.jsx(ir,{p:2,h:"full",sx:q8e,children:r.jsx(gk,{loop:!0,shouldFilter:!1,children:r.jsxs(T,{flexDir:"column",h:"full",gap:2,children:[r.jsx(Ct,{ref:n,value:s,onChange:c,placeholder:e("nodes.nodeSearch")}),r.jsx(ke,{w:"full",h:"full",children:r.jsxs(Nn,{children:[r.jsx(jH,{children:r.jsx(Yt,{position:"absolute",top:0,right:0,bottom:0,left:0,icon:null,label:"No matching items"})}),r.jsx(wH,{children:r.jsx(EH,{searchTerm:l,onSelect:h})})]})})]})})})})]})});PH.displayName="AddNodeCmdk";const K8e={'&[data-selected="true"]':{bg:"base.700"}},Z8e=gs(xn,e=>Object.values(e).filter(t=>t.classification!=="deprecated")),Y8e=uP(e=>new RegExp(e.trim().replace(/[-[\]{}()*+!<=:?./\\^$|#,]/g,"").split(" ").join(".*"),"gi")),Tb=uP((e,t)=>{const n=Y8e(t);if(!t||e.title.includes(t)||n.test(e.title)||e.type.includes(t)||n.test(e.type)||e.description.includes(t)||n.test(e.description)||e.nodePack.includes(t)||n.test(e.nodePack)||e.classification.includes(t)||n.test(e.classification))return!0;for(const s of e.tags)if(s.includes(t)||n.test(s))return!0;return!1},(e,t)=>`${e.type}-${t}`),EH=u.memo(({searchTerm:e,onSelect:t})=>{const{t:n}=P(),s=ce(Z8e),i=ce(yr),o=u.useMemo(()=>({type:"current_image",title:n("nodes.currentImage"),description:n("nodes.currentImageDescription"),tags:["progress","image","current"],classification:"stable",nodePack:"invokeai"}),[n]),a=u.useMemo(()=>({type:"notes",title:n("nodes.notes"),description:n("nodes.notesDescription"),tags:["notes"],classification:"stable",nodePack:"invokeai"}),[n]),l=u.useMemo(()=>{const c=[];if(i){for(const d of s)if(Tb(d,e)){const h=i.handleType==="source"?d.inputs:d.outputs;for(const[f,p]of Zne(h)){const g=i.handleType==="source"?i.fieldTemplate.type:p.type,m=i.handleType==="target"?i.fieldTemplate.type:p.type;if(TH(g,m)){c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack});break}}}}else{for(const d of s)Tb(d,e)&&c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack});for(const d of[o,a])Tb(d,e)&&c.push({label:d.title,value:d.type,description:d.description,classification:d.classification,nodePack:d.nodePack})}return c},[i,s,e,o,a]);return r.jsx(r.Fragment,{children:l.map(c=>r.jsx(SH,{value:c.value,onSelect:t,asChild:!0,children:r.jsxs(T,{role:"button",flexDir:"column",sx:K8e,py:1,px:2,borderRadius:"base",children:[r.jsxs(T,{alignItems:"center",gap:2,children:[c.classification==="beta"&&r.jsx(pt,{boxSize:4,color:"invokeYellow.300",as:IE}),c.classification==="prototype"&&r.jsx(pt,{boxSize:4,color:"invokeRed.300",as:bS}),c.classification==="internal"&&r.jsx(pt,{boxSize:4,color:"invokePurple.300",as:SE}),c.classification==="special"&&r.jsx(pt,{boxSize:4,color:"invokeGreen.300",as:P1}),r.jsx(K,{fontWeight:"semibold",children:c.label}),r.jsx(nt,{}),r.jsx(K,{variant:"subtext",fontWeight:"semibold",children:c.nodePack})]}),c.description&&r.jsx(K,{color:"base.200",children:c.description})]})},c.value))})});EH.displayName="CommandListItems";const X8e=()=>{const e=XC(),{t}=P();return r.jsx(ae,{tooltip:t("nodes.addNodeToolTip"),"aria-label":t("nodes.addNode"),icon:r.jsx(Ht,{}),onClick:e.setTrue,pointerEvents:"auto"})},Q8e=u.memo(X8e),J8e=()=>{const e=z(),{t}=P(),{isOpen:n,onOpen:s,onClose:i}=ar(),o=I(lp),a=u.useCallback(()=>{e(V3()),fe({id:"WORKFLOW_CLEARED",title:t("workflows.workflowCleared"),status:"success"}),i()},[e,i,t]),l=u.useCallback(()=>{if(!o){a();return}s()},[a,o,s]);return r.jsxs(r.Fragment,{children:[r.jsx(ae,{tooltip:t("nodes.clearWorkflow"),"aria-label":t("nodes.clearWorkflow"),icon:r.jsx(L1,{}),onClick:l,pointerEvents:"auto"}),r.jsx(ti,{isOpen:n,onClose:i,title:t("nodes.clearWorkflow"),acceptCallback:a,useInert:!1,children:r.jsxs(T,{flexDir:"column",gap:2,children:[r.jsx(K,{children:t("nodes.clearWorkflowDesc")}),r.jsx(K,{variant:"subtext",children:t("nodes.clearWorkflowDesc2")})]})})]})},eAe=u.memo(J8e),tAe=()=>{const{t:e}=P(),t=I(lp),{onOpen:n}=fd(),{saveWorkflow:s}=Hj(),i=u.useCallback(()=>{const o=Va.get();o&&(wy(o)?s():n())},[n,s]);return r.jsx(ae,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:r.jsx(Ui,{}),isDisabled:!t,onClick:i,pointerEvents:"auto"})},nAe=u.memo(tAe),LH=()=>{const e=ce(xn),t=u.useMemo(()=>ve(ot,s=>s.nodes.filter(Yr).some(i=>{const o=e[i.data.type];return o?c3(i.data,o):!1})),[e]);return I(t)},sAe=()=>{const e=z(),{t}=P(),n=LH(),s=u.useCallback(()=>{e(Uee())},[e]);return n?r.jsx(ae,{tooltip:t("nodes.updateAllNodes"),"aria-label":t("nodes.updateAllNodes"),icon:r.jsx(Cp,{}),onClick:s,pointerEvents:"auto",colorScheme:"warning"}):null},rAe=u.memo(sAe),iAe=It(Fu,e=>({name:e.name,description:e.description,notes:e.notes,author:e.author,tags:e.tags})),oAe=()=>{const{name:e,description:t,notes:n,author:s,tags:i}=I(iAe),{t:o}=P();return r.jsxs(T,{flexDir:"column",gap:"2",children:[!!e.length&&r.jsxs(ke,{children:[r.jsx(K,{fontWeight:"semibold",children:o("nodes.workflowName")}),r.jsx(K,{opacity:.7,fontStyle:"oblique 5deg",children:e})]}),!!s.length&&r.jsxs(ke,{children:[r.jsx(K,{fontWeight:"semibold",children:o("nodes.workflowAuthor")}),r.jsx(K,{opacity:.7,fontStyle:"oblique 5deg",children:s})]}),!!i.length&&r.jsxs(ke,{children:[r.jsx(K,{fontWeight:"semibold",children:o("nodes.workflowTags")}),r.jsx(K,{opacity:.7,fontStyle:"oblique 5deg",children:i})]}),!!t.length&&r.jsxs(ke,{children:[r.jsx(K,{fontWeight:"semibold",children:o("nodes.workflowDescription")}),r.jsx(K,{opacity:.7,fontStyle:"oblique 5deg",children:t})]}),!!n.length&&r.jsxs(ke,{children:[r.jsx(K,{fontWeight:"semibold",children:o("nodes.workflowNotes")}),r.jsx(K,{opacity:.7,fontStyle:"oblique 5deg",children:n})]})]})},aAe=u.memo(oAe),lAe=()=>{const{t:e}=P();return r.jsx(T,{flexDir:"column",gap:"2",children:r.jsxs(T,{flexDir:"column",gap:"2",children:[r.jsx(K,{fontWeight:"semibold",children:e("toast.loadedWithWarnings")}),r.jsxs(T,{flexDir:"column",children:[r.jsxs(K,{children:[e("common.toResolve"),":"]}),r.jsxs(K,{children:[e("nodes.editMode")," >> ",e("nodes.updateAllNodes")," >> ",e("common.save")]})]})]})})},cAe=()=>LH()?r.jsx(Le,{label:r.jsx(lAe,{}),children:r.jsx(T,{h:"full",alignItems:"center",gap:"2",children:r.jsx(pt,{color:"warning.400",as:Cp})})}):r.jsx(r.Fragment,{}),uAe=()=>{const{t:e}=P(),t=I($C),n=I(lp),s=I(uo);return r.jsxs(T,{gap:"1",alignItems:"center",children:[t.length?r.jsx(Le,{label:r.jsx(aAe,{}),placement:"top",children:r.jsx(K,{fontSize:"lg",userSelect:"none",noOfLines:1,wordBreak:"break-all",fontWeight:"semibold",children:t})}):r.jsx(K,{fontSize:"lg",fontStyle:"italic",fontWeight:"semibold",children:e("workflows.unnamedWorkflow")}),n&&s==="edit"&&r.jsx(Le,{label:e("nodes.newWorkflowDesc2"),children:r.jsx(T,{children:r.jsx(pt,{as:Zoe,boxSize:"20px",sx:{color:"invokeYellow.500"}})})}),r.jsx(cAe,{})]})},dAe=()=>{const{t:e}=P(),t=UV();return r.jsx(he,{as:"button",icon:r.jsx(Vu,{}),onClick:t,children:e("workflows.downloadWorkflow")})},hAe=u.memo(dAe),Mb=Oe(!1),DH=()=>{const e=ce(Mb),t=u.useCallback(()=>{Mb.set(!0)},[]),n=u.useCallback(()=>{Mb.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},fAe=()=>{const{t:e}=P(),t=z(),{isOpen:n,onClose:s}=DH(),[i,o]=u.useState(""),[a,l]=u.useState(""),[c,d]=u.useState(!0),h=u.useCallback(y=>{o(y.target.value)},[]),f=u.useCallback(y=>{l(y.target.value)},[]),p=u.useCallback(y=>{d(y.target.checked)},[]),g=u.useCallback(()=>{const y=JSON.parse(i),x=qee(y,c);l(JSON.stringify(x,null,2))},[i,c]),m=u.useCallback(()=>{t(B0({data:{workflow:a,graph:null},asCopy:!0})),s()},[t,s,a]);return r.jsxs(ni,{isOpen:n,onClose:s,isCentered:!0,useInert:!1,children:[r.jsx(rr,{}),r.jsxs(si,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[r.jsx(Tr,{children:e("workflows.loadFromGraph")}),r.jsx(lo,{}),r.jsxs(ir,{as:T,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[r.jsxs(T,{gap:4,children:[r.jsx(ye,{onClick:g,size:"sm",flexShrink:0,children:e("workflows.convertGraph")}),r.jsxs(Z,{children:[r.jsx(te,{children:e("workflows.autoLayout")}),r.jsx(jn,{isChecked:c,onChange:p})]}),r.jsx(nt,{}),r.jsx(ye,{onClick:m,size:"sm",flexShrink:0,children:e("workflows.loadWorkflow")})]}),r.jsxs(Z,{orientation:"vertical",h:"50%",children:[r.jsx(te,{children:e("nodes.graph")}),r.jsx(Zn,{h:"full",value:i,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:h})]}),r.jsxs(Z,{orientation:"vertical",h:"50%",children:[r.jsx(te,{children:e("nodes.workflow")}),r.jsx(Zn,{h:"full",value:a,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:f})]})]})]})]})},pAe=()=>{const{t:e}=P(),t=ce(xn),{onOpen:n}=DH();return r.jsx(he,{as:"button",icon:r.jsx(bS,{}),onClick:n,isDisabled:!Tu(t),children:e("workflows.loadFromGraph")})},gAe=u.memo(pAe),RH=u.memo(()=>{const{t:e}=P(),t=zj();return r.jsx(he,{as:"button",icon:r.jsx(uf,{}),onClick:t.createWithDialog,children:e("nodes.newWorkflow")})});RH.displayName="NewWorkflowMenuItem";const mAe=()=>{const{t:e}=P(),{onOpen:t}=fd();return r.jsx(he,{as:"button",icon:r.jsx(on,{}),onClick:t,children:e("workflows.saveWorkflowAs")})},yAe=u.memo(mAe),vAe=()=>{const{t:e}=P(),{saveWorkflow:t}=Hj(),{onOpen:n}=fd(),s=I(lp),i=u.useCallback(()=>{const o=Va.get();o&&(wy(o)?t():n())},[n,t]);return r.jsx(he,{as:"button",isDisabled:!s,icon:r.jsx(Ui,{}),onClick:i,children:e("workflows.saveWorkflow")})},bAe=u.memo(vAe),xAe=()=>{const{t:e}=P(),[t]=Kee(),n=u.useCallback(()=>{t()},[t]);return r.jsx(ye,{leftIcon:r.jsx(aoe,{}),tooltip:e("nodes.reloadNodeTemplates"),"aria-label":e("nodes.reloadNodeTemplates"),onClick:n,children:e("nodes.reloadNodeTemplates")})},CAe=u.memo(xAe),SAe={flexGrow:1},[OH]=ja(!1),wAe=()=>{const e=z(),t=OH(),n=I(dP),s=I(hP),i=I(fP),o=I(m1),a=I(pP),l=I(gP),c=u.useCallback(y=>{e(Zee(y.target.checked))},[e]),d=u.useCallback(y=>{e(Yee(y.target.checked))},[e]),h=u.useCallback(y=>{e(Xee(y.target.checked))},[e]),f=u.useCallback(y=>{e(Qee(y.target.checked))},[e]),p=u.useCallback(y=>{e(Jee(y.target.checked))},[e]),g=u.useCallback(y=>{e(ete(y.target.checked))},[e]),{t:m}=P();return r.jsxs(ni,{isOpen:t.isTrue,onClose:t.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(rr,{}),r.jsxs(si,{children:[r.jsx(Tr,{children:m("nodes.workflowSettings")}),r.jsx(lo,{}),r.jsx(ir,{children:r.jsxs(T,{flexDirection:"column",gap:4,py:4,children:[r.jsx(Ot,{size:"sm",children:m("parameters.general")}),r.jsxs(ms,{orientation:"vertical",formLabelProps:SAe,children:[r.jsxs(Z,{children:[r.jsxs(T,{w:"full",children:[r.jsx(te,{children:m("nodes.animatedEdges")}),r.jsx(it,{onChange:d,isChecked:o})]}),r.jsx(Us,{children:m("nodes.animatedEdgesHelp")})]}),r.jsx(Et,{}),r.jsxs(Z,{children:[r.jsxs(T,{w:"full",children:[r.jsx(te,{children:m("nodes.snapToGrid")}),r.jsx(it,{isChecked:n,onChange:h})]}),r.jsx(Us,{children:m("nodes.snapToGridHelp")})]}),r.jsx(Et,{}),r.jsxs(Z,{children:[r.jsxs(T,{w:"full",children:[r.jsx(te,{children:m("nodes.colorCodeEdges")}),r.jsx(it,{isChecked:i,onChange:f})]}),r.jsx(Us,{children:m("nodes.colorCodeEdgesHelp")})]}),r.jsx(Et,{}),r.jsxs(Z,{children:[r.jsxs(T,{w:"full",children:[r.jsx(te,{children:m("nodes.fullyContainNodes")}),r.jsx(it,{isChecked:s===tte.Full,onChange:p})]}),r.jsx(Us,{children:m("nodes.fullyContainNodesHelp")})]}),r.jsx(Et,{}),r.jsxs(Z,{children:[r.jsxs(T,{w:"full",children:[r.jsx(te,{children:m("nodes.showEdgeLabels")}),r.jsx(it,{isChecked:a,onChange:g})]}),r.jsx(Us,{children:m("nodes.showEdgeLabelsHelp")})]}),r.jsx(Et,{}),r.jsx(Ot,{size:"sm",pt:4,children:m("common.advanced")}),r.jsxs(Z,{children:[r.jsxs(T,{w:"full",children:[r.jsx(te,{children:m("nodes.validateConnections")}),r.jsx(it,{isChecked:l,onChange:c})]}),r.jsx(Us,{children:m("nodes.validateConnectionsHelp")})]}),r.jsx(Et,{})]}),r.jsx(CAe,{})]})})]})]})},jAe=u.memo(wAe),kAe=()=>{const{t:e}=P(),t=OH();return r.jsx(he,{as:"button",icon:r.jsx(zu,{}),onClick:t.setTrue,children:e("nodes.workflowSettings")})},_Ae=u.memo(kAe),IAe=()=>{const{t:e}=P(),t=u.useRef(null),n=WV({resetRef:t}),s=u.useCallback(a=>{a[0]&&n(a[0])},[n]),{getRootProps:i,getInputProps:o}=Ra({accept:{"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return r.jsxs(he,{as:"button",icon:r.jsx(M1,{}),...i(),children:[e("workflows.uploadWorkflow"),r.jsx("input",{...o()})]})},AAe=u.memo(IAe),TAe=()=>{const{t:e}=P(),{isOpen:t,onOpen:n,onClose:s}=ar(),i=Ma();return Kf(s),r.jsxs(Qt,{isOpen:t,onOpen:n,onClose:s,children:[r.jsx(Jt,{as:ae,"aria-label":e("workflows.workflowEditorMenu"),icon:r.jsx(SS,{}),pointerEvents:"auto"}),r.jsxs(kt,{pointerEvents:"auto",children:[r.jsx(RH,{}),r.jsx(AAe,{}),r.jsx(is,{}),r.jsx(bAe,{}),r.jsx(yAe,{}),r.jsx(hAe,{}),r.jsx(is,{}),r.jsx(_Ae,{}),i&&r.jsx(is,{}),i&&r.jsx(gAe,{})]})]})},MAe=u.memo(TAe),PAe=()=>{const e=I($C);return r.jsxs(T,{gap:2,top:2,left:2,right:2,position:"absolute",alignItems:"flex-start",pointerEvents:"none",children:[r.jsxs(T,{gap:"2",children:[r.jsx(Q8e,{}),r.jsx(rAe,{})]}),r.jsx(nt,{}),!!e.length&&r.jsx(uAe,{}),r.jsx(nt,{}),r.jsx(eAe,{}),r.jsx(nAe,{}),r.jsx(MAe,{})]})},EAe=u.memo(PAe),LAe=()=>{const{t:e}=P(),t=z(),[n,s]=YP(),i=Gf(),o=u.useRef();return{saveWorkflowAs:u.useCallback(async({name:l,category:c,onSuccess:d,onError:h})=>{const f=Va.get();if(f){o.current=i({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{f.id=void 0,f.name=l,f.meta.category=c;const p=await n(f).unwrap();t(G3(p.workflow.id)),t(O3(p.workflow.name)),t(nte(p.workflow.meta.category)),t(z3()),t(Vwe({category:c})),d&&d(),i.update(o.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{h&&h(),i.isActive(`auth-error-toast-${jl.endpoints.createWorkflow.name}`)?i.close(o.current):i.update(o.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}}},[i,n,t,e]),isLoading:s.isLoading,isError:s.isError}},DAe=()=>{const{isOpen:e,onClose:t,workflowName:n,setWorkflowName:s,shouldSaveToProject:i,setShouldSaveToProject:o}=fd(),a=ce($3),{saveWorkflowAs:l}=LAe(),c=u.useRef(null),d=u.useRef(null),h=u.useCallback(m=>{s(m.target.value)},[s]),f=u.useCallback(m=>{o(m.target.checked)},[o]),p=u.useCallback(()=>{t()},[t]),g=u.useCallback(async()=>{await l({name:n,category:i?"project":"user",onSuccess:p,onError:p})},[n,l,i,p]);return r.jsx(XT,{isOpen:e,onClose:t,leastDestructiveRef:c,isCentered:!0,children:r.jsx(rr,{children:r.jsxs(QT,{children:[r.jsx(Tr,{fontSize:"lg",fontWeight:"bold",children:Ce("workflows.saveWorkflowAs")}),r.jsx(ir,{children:r.jsxs(Z,{alignItems:"flex-start",children:[r.jsx(te,{mt:"2",children:Ce("workflows.workflowName")}),r.jsxs(T,{flexDir:"column",width:"full",gap:"2",children:[r.jsx(Ct,{ref:d,value:n,onChange:h,placeholder:Ce("workflows.workflowName")}),a.includes("project")&&r.jsx(jn,{isChecked:i,onChange:f,children:r.jsx(te,{children:Ce("workflows.saveWorkflowToProject")})})]})]})}),r.jsxs(co,{children:[r.jsx(ye,{ref:c,onClick:p,children:Ce("common.cancel")}),r.jsx(ye,{colorScheme:"invokeBlue",onClick:g,ml:3,isDisabled:!n||!n.length,children:Ce("common.saveAs")})]})]})})})},jm=Oe(null),RAe=e=>{const[t,n]=u.useState(!1);u.useEffect(()=>jm.subscribe(a=>{n(a===e)}),[t,e]);const s=u.useCallback(()=>{jm.set(e)},[e]),i=u.useCallback(()=>{jm.set(null)},[]);return{isMouseOverNode:t,handleMouseOver:s,handleMouseOut:i}},OAe=()=>{const e=_a(),t=ce(xn),n=JC(),s=XC(),i=u.useCallback((c,{nodeId:d,handleId:h,handleType:f})=>{Re(d&&h&&f,"Invalid connection start event");const g=y1(e.getState()).find(C=>C.id===d);if(!g)return;const m=t[g.data.type];if(!m)return;const x=m[f==="source"?"outputs":"inputs"][h];x&&yr.set({nodeId:d,handleId:h,handleType:f,fieldTemplate:x})},[e,t]),o=u.useCallback(c=>{const{dispatch:d}=e,h=D0(c);d(Fi([{type:"add",item:h}])),n([h.source,h.target]),yr.set(null)},[e,n]),a=u.useCallback(()=>{const{dispatch:c}=e,d=yr.get(),h=fa.get(),f=jm.get();if(h&&!f){yr.set(null);return}if(!d)return;const{nodes:p,edges:g}=ot(e.getState());if(f){const{handleType:m}=d,y=m==="source"?d.nodeId:f,x=m==="source"?d.handleId:null,C=m==="target"?d.nodeId:f,v=m==="target"?d.handleId:null,b=MH(y,x,C,v,p,g,t,h);if(b){const S=D0(b),w=[{type:"add",item:S}],j=[S.source,S.target];h&&(Mh.set(!0),w.push({type:"remove",id:h.id}),j.push(h.source,h.target)),c(Fi(w)),n(j)}yr.set(null)}else s.setTrue()},[s,e,t,n]);return u.useMemo(()=>({onConnectStart:i,onConnect:o,onConnectEnd:a}),[i,o,a])},NAe=()=>{const e=_a(),t=ce(xn),n=I(gP);return u.useCallback(({source:i,sourceHandle:o,target:a,targetHandle:l})=>{if(!(i&&o&&a&&l))return!1;const c=fa.get(),{nodes:d,edges:h}=ot(e.getState());return Qp({source:i,sourceHandle:o,target:a,targetHandle:l},d,h,t,c,n).isValid},[t,n,e])},FAe=nr("workflows"),BAe=()=>{const{getState:e}=ut(),{nodes:t,edges:n}=ot(e()),s=t.filter(a=>a.selected),i=n.filter(a=>a.selected),o=n.filter(a=>s.some(l=>l.id===a.target));mP.set(s),yP.set(i),vP.set(o)},NH=e=>{const{getState:t,dispatch:n}=ut(),{nodes:s,edges:i}=ot(t()),o=xn.get(),a=QC.get(),l=ft(mP.get());let c=ft(yP.get());if(e){const b=ft(vP.get());c=EP([...c,...b],ol)}const d=l.map(b=>b.position.x),h=l.map(b=>b.position.y),f=Math.min(...d),p=Math.min(...h),g=a?a.x-f:50,m=a?a.y-p:50;l.forEach(b=>{const{x:S,y:w}=IH(s,b.position.x+g,b.position.y+m);b.position.x=S,b.position.y=w,b.selected=!0;const j=Rm();for(const E of c)E.source===b.id?E.source=j:E.target===b.id&&(E.target=j);b.id=j,b.data.id=j}),c.forEach(b=>{b.id=Rm()});const y=[],x=[];s.forEach(({id:b,selected:S})=>{S&&y.push({type:"select",id:b,selected:!1})}),l.forEach(b=>{y.push({type:"add",item:b})}),i.forEach(({id:b,selected:S})=>{S&&x.push({type:"select",id:b,selected:!1})});const C=[...s,...l],v=[...i];c.forEach(b=>{const{source:S,sourceHandle:w,target:j,targetHandle:E}=b;Re(!ze(w)),Re(!ze(E));const A=Qp({source:S,sourceHandle:w,target:j,targetHandle:E},C,v,o,null,!0);if(!A.isValid){FAe.warn({edge:{source:S,sourceHandle:w,target:j,targetHandle:E}},`Invalid edge, cannot paste: ${Ce(A.messageTKey)}`);return}x.push({type:"add",item:b}),v.push(b)}),y.length>0&&n(Yc(y)),x.length>0&&n(Fi(x))},$Ae=()=>{NH(!1)},VAe=()=>{NH(!0)},GAe={copySelection:BAe,pasteSelection:$Ae,pasteSelectionWithEdges:VAe},zAe=()=>GAe,Dy=e=>{if(!e)return Qi("base.500");const t=ste[e.name];return Qi(t||"base.500")},HAe={opacity:.8},WAe=({fromX:e,fromY:t,fromPosition:n,toX:s,toY:i,toPosition:o})=>{const a=ce(yr),l=I(fP),c=I(m1),d=u.useMemo(()=>l&&a?Dy(a.fieldTemplate.type):Qi("base.500"),[a,l]),h=u.useMemo(()=>c?"react-flow__custom_connection-path animated":"react-flow__custom_connection-path",[c]),f={sourceX:e,sourceY:t,sourcePosition:n,targetX:s,targetY:i,targetPosition:o},[p]=eS(f);return r.jsx("g",{children:r.jsx("path",{fill:"none",stroke:d,strokeWidth:2,className:h,d:p,style:HAe})})},UAe=u.memo(WAe),FH=(e,t)=>ve(ot,n=>{const s=n.nodes.find(o=>o.id===e),i=n.nodes.find(o=>o.id===t);return!!(s!=null&&s.selected||i!=null&&i.selected)}),qAe=(e,t,n,s,i)=>ve(ot,rte,(o,a)=>{const{shouldColorEdges:l}=a,c=o.nodes.find(m=>m.id===t),d=o.nodes.find(m=>m.id===s);if(!c||!n||!d||!i)return Qi("base.500");const h=e[c.data.type],f=Yr(c)&&Yr(d),p=h==null?void 0:h.outputs[n],g=f?p==null?void 0:p.type:void 0;return g&&l?Dy(g):Qi("base.500")}),KAe=(e,t,n,s,i)=>ve(ot,o=>{var h,f;const a=o.nodes.find(p=>p.id===t),l=o.nodes.find(p=>p.id===s);if(!a||!n||!l||!i)return null;const c=e[a.data.type],d=e[l.data.type];return`${(c==null?void 0:c.title)||((h=a.data)==null?void 0:h.label)} -> ${(d==null?void 0:d.title)||((f=l.data)==null?void 0:f.label)}`}),ZAe=$o(xP),YAe={strokeWidth:"3px !important",stroke:"base.500 !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important"}},XAe={bg:"base.500",opacity:.5,shadow:"base",'&[data-selected="true"]':{opacity:1}},QAe=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:i,targetPosition:o,markerEnd:a,data:l,selected:c=!1,source:d,target:h})=>{const f=I(m1),p=u.useMemo(()=>FH(d,h),[d,h]),g=I(p),[m,y,x]=eS({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:s,targetPosition:o});return r.jsxs(r.Fragment,{children:[r.jsx(ZAe,{path:m,markerEnd:a,sx:YAe,"data-selected":c,"data-are-connected-nodes-selected":g,"data-should-animate-edges":f}),(l==null?void 0:l.count)!==void 0&&r.jsx(bP,{children:r.jsx(ke,{position:"absolute",transform:`translate(-50%, -50%) translate(${y}px,${x}px)`,className:"edge-label-renderer__custom-edge nodrag nopan",zIndex:1001,children:r.jsx(os,{variant:"solid",sx:XAe,"data-selected":c,children:l.count})})})]})},JAe=u.memo(QAe),eTe=$o(xP),tTe={strokeWidth:"3px !important",opacity:"0.5 !important",strokeDasharray:"none",'&[data-selected="true"]':{opacity:"1 !important"},'&[data-should-animate-edges="true"]':{animation:"dashdraw 0.5s linear infinite !important",'&[data-selected="true"], &[data-are-connected-nodes-selected="true"]':{strokeDasharray:"5 !important"}}},nTe={pointerEvents:"all",position:"absolute",bg:"base.800",borderRadius:"base",borderWidth:1,opacity:.5,borderColor:"transparent",py:1,px:3,shadow:"md",'&[data-selected="true"]':{opacity:1,borderColor:void 0}},sTe={fontWeight:"semibold",color:"base.300",'&[data-selected="true"]':{color:"base.100"}},rTe=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:i,targetPosition:o,markerEnd:a,selected:l=!1,source:c,target:d,sourceHandleId:h,targetHandleId:f})=>{const p=ce(xn),g=I(m1),m=I(pP),y=u.useMemo(()=>FH(c,d),[c,d]),x=u.useMemo(()=>qAe(p,c,h,d,f),[p,c,h,d,f]),C=u.useMemo(()=>KAe(p,c,h,d,f),[p,c,h,d,f]),v=I(y),b=I(x),S=I(C),[w,j,E]=eS({sourceX:e,sourceY:t,sourcePosition:i,targetX:n,targetY:s,targetPosition:o});return r.jsxs(r.Fragment,{children:[r.jsx(eTe,{path:w,markerEnd:a,sx:tTe,stroke:`${b} !important`,"data-selected":l,"data-are-connected-nodes-selected":v,"data-should-animate-edges":g}),S&&m&&r.jsx(bP,{children:r.jsx(T,{className:"nodrag nopan",transform:`translate(-50%, -50%) translate(${j}px,${E}px)`,"data-selected":l,sx:nTe,children:r.jsx(K,{size:"sm",sx:sTe,"data-selected":l,children:S})})})]})},iTe=u.memo(rTe),oTe={h:"full",position:"relative",borderRadius:"base",transitionProperty:"common",transitionDuration:"0.1s",cursor:"grab"},aTe={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",pointerEvents:"none",zIndex:-1,shadow:"var(--invoke-shadows-xl), var(--invoke-shadows-base), var(--invoke-shadows-base)"},lTe={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"md",pointerEvents:"none",transitionProperty:"common",transitionDuration:"0.1s",opacity:.7,zIndex:-1,visibility:"hidden",shadow:"0 0 0 2px var(--invoke-colors-yellow-400), 0 0 20px 2px var(--invoke-colors-orange-700)",'&[data-is-in-progress="true"]':{visibility:"visible"}},cTe={position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",transitionProperty:"common",transitionDuration:"0.1s",pointerEvents:"none",visibility:"hidden",opacity:.5,'&[data-is-selected="true"], &[data-is-hovered="true"]':{visibility:"visible"},'&[data-is-selected="true"]':{shadow:"0 0 0 3px var(--invoke-colors-blue-300)"},'&[data-is-hovered="true"]':{shadow:"0 0 0 2px var(--invoke-colors-blue-300)"},'&[data-is-selected="true"][data-is-hovered="true"]':{opacity:1,shadow:"0 0 0 3px var(--invoke-colors-blue-300)"}},uTe=e=>{const{nodeId:t,width:n,children:s,selected:i}=e,o=_a(),{isMouseOverNode:a,handleMouseOut:l,handleMouseOver:c}=RAe(t),d=RC(t),h=(d==null?void 0:d.status)===Ks.enum.IN_PROGRESS,f=z(),p=I(CP),{onCloseGlobal:g}=Kf(),m=u.useCallback(y=>{if(!y.ctrlKey&&!y.altKey&&!y.metaKey&&!y.shiftKey){const x=y1(o.getState()),C=[];x.forEach(({id:v,selected:b})=>{b!==(v===t)&&C.push({type:"select",id:v,selected:v===t})}),C.length>0&&f(Yc(C))}g()},[g,o,f,t]);return r.jsxs(ke,{onClick:m,onMouseEnter:c,onMouseLeave:l,className:pp,sx:oTe,width:n||nx,opacity:p,children:[r.jsx(ke,{sx:aTe}),r.jsx(ke,{sx:lTe,"data-is-in-progress":h}),s,r.jsx(ke,{sx:cTe,"data-is-selected":i,"data-is-hovered":a})]})},Ry=u.memo(uTe),dTe=e=>{const t=I(Vf),n=ce(Io);return n!=null&&n.image?r.jsx(Pb,{nodeProps:e,children:r.jsx(dn,{src:n==null?void 0:n.image.dataURL,w:"full",h:"full",objectFit:"contain",borderRadius:"base"})}):t?r.jsx(Pb,{nodeProps:e,children:r.jsx($a,{imageDTO:t})}):r.jsx(Pb,{nodeProps:e,children:r.jsx(Yt,{})})},hTe=u.memo(dTe),Pb=e=>{const[t,n]=u.useState(!1),s=u.useCallback(()=>{n(!0)},[]),i=u.useCallback(()=>{n(!1)},[]),{t:o}=P();return r.jsx(Ry,{nodeId:e.nodeProps.id,selected:e.nodeProps.selected,width:384,children:r.jsxs(T,{onMouseEnter:s,onMouseLeave:i,className:pp,position:"relative",flexDirection:"column",children:[r.jsx(T,{layerStyle:"nodeHeader",borderTopRadius:"base",alignItems:"center",justifyContent:"center",h:8,children:r.jsx(K,{fontSize:"sm",fontWeight:"semibold",color:"base.200",children:o("nodes.currentImage")})}),r.jsxs(T,{layerStyle:"nodeBody",w:"full",h:"full",borderBottomRadius:"base",p:2,children:[e.children,t&&r.jsx($w.div,{initial:fTe,animate:pTe,exit:gTe,style:mTe,children:r.jsx(pF,{inset:2})},"nextPrevButtons")]})]})})},fTe={opacity:0},pTe={opacity:1,transition:{duration:.1}},gTe={opacity:0,transition:{duration:.1}},mTe={position:"absolute",top:40,left:-2,right:-2,bottom:0,pointerEvents:"none"},yTe={position:"relative",minH:8,py:.5,alignItems:"center",transitionProperty:"opacity",transitionDuration:"0.1s",justifyContent:"flex-end"},mk=u.memo(({children:e})=>r.jsx(T,{sx:yTe,children:e}));mk.displayName="OutputFieldWrapper";const vTe=(e,t)=>{const n=ce(xn),s=u.useMemo(()=>ve(ot,o=>{const a=DC(o,e),l=n[a.data.type],c=l==null?void 0:l.outputs[t];return(c==null?void 0:c.title)||t}),[t,e,n]);return I(s)},BH=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=P(),s=vTe(e,t);return r.jsx(mk,{children:r.jsx(Z,{isInvalid:!0,alignItems:"stretch",justifyContent:"space-between",gap:2,h:"full",w:"full",children:r.jsx(te,{display:"flex",alignItems:"center",h:"full",color:"error.300",mb:0,px:1,gap:2,children:n("nodes.unknownOutput",{name:s})})})})});BH.displayName="OutputFieldUnknownPlaceholder";const bTe=(e,t)=>{const n=ce(xn),s=u.useMemo(()=>ve(ot,o=>{const a=u1(o,e);if(!a)return!1;const l=n[a.data.type];return!!(l==null?void 0:l.outputs[t])}),[t,e,n]);return I(s)},$H=u.memo(({nodeId:e,fieldName:t,children:n})=>bTe(e,t)?n:r.jsx(BH,{nodeId:e,fieldName:t}));$H.displayName="OutputFieldGate";const Oy=e=>{const{t}=P();return u.useMemo(()=>{const{name:s}=e;return Cc(e)?t("nodes.collectionFieldType",{name:s}):ra(e)?t("nodes.collectionOrScalarFieldType",{name:s}):t("nodes.singleFieldType",{name:s})},[e,t])},xTe={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},CTe={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineEnd:"-0.5rem"},VH=u.memo(e=>{const{fieldTemplate:t,isConnectionInProgress:n,isConnectionStartField:s,validationResult:i}=e,{t:o}=P(),a=Oy(t.type),l=u.useMemo(()=>Dy(t.type),[t.type]),c=u.useMemo(()=>SP.some(h=>h===t.type.name),[t.type]),d=u.useMemo(()=>n&&i.messageTKey?o(i.messageTKey):a,[a,n,o,i.messageTKey]);return r.jsx(Le,{label:d,placement:"end",openDelay:v1,children:r.jsx(Dc,{type:"source",id:t.name,position:Rc.Right,style:CTe,children:r.jsx(ke,{sx:xTe,"data-cardinality":t.type.cardinality,"data-is-batch-field":t.type.batch,"data-is-model-field":c,"data-is-connection-in-progress":n,"data-is-connection-start-field":s,"data-is-connection-valid":i.isValid,backgroundColor:t.type.cardinality==="SINGLE"?l:"base.900",borderColor:l})})})});VH.displayName="OutputFieldHandle";const yk=(e,t)=>{const n=go(e);return u.useMemo(()=>{const i=n.outputs[t];return Re(i,`Template for output field ${t} not found`),i},[t,n.outputs])},GH=u.memo(({nodeId:e,fieldName:t})=>{const n=yk(e,t),s=Oy(n.type),{t:i}=P();return r.jsxs(T,{flexDir:"column",children:[r.jsx(K,{fontWeight:"semibold",children:n.title}),r.jsx(K,{opacity:.7,fontStyle:"oblique 5deg",children:n.description}),r.jsxs(K,{children:[i("parameters.type"),": ",s]})]})});GH.displayName="OutputFieldTooltipContent";const STe={fontSize:"sm",color:"base.300",fontWeight:"semibold",pe:2,'&[data-is-disabled="true"]':{opacity:.5}},zH=u.memo(({nodeId:e,fieldName:t,isDisabled:n})=>{const s=yk(e,t);return r.jsx(Le,{label:r.jsx(GH,{nodeId:e,fieldName:t}),openDelay:v1,placement:"top",children:r.jsx(K,{"data-is-disabled":n,sx:STe,children:s.title})})});zH.displayName="OutputFieldTitle";const HH=(e,t,n,s)=>It(ot,(i,o)=>o,(i,o,a)=>a,(i,o,a)=>{const{nodes:l,edges:c}=i;if(!o)return us("nodes.noConnectionInProgress");if(s===o.handleType)return us(s==="source"?"nodes.cannotConnectOutputToOutput":"nodes.cannotConnectInputToInput");const d=s==="source"?t:o.nodeId,h=s==="source"?n:o.handleId,f=s==="target"?t:o.nodeId,p=s==="target"?n:o.handleId;return Qp({source:d,sourceHandle:h,target:f,targetHandle:p},l,c,e,a)}),wTe=(e,t)=>{const n=ce(yr),s=ce(xn),i=ce(fa),o=u.useMemo(()=>HH(s,e,t,"source"),[s,e,t]),a=u.useMemo(()=>!!n,[n]),l=u.useMemo(()=>n?n.nodeId===e&&n.handleId===t&&n.fieldTemplate.fieldKind==="output":!1,[t,e,n]),c=I(d=>o(d,n,i));return{isConnectionInProgress:a,isConnectionStartField:l,validationResult:c}},jTe=(e,t)=>{const n=u.useMemo(()=>ve(ot,i=>i.edges.find(a=>a.source===e&&a.sourceHandle===t)!==void 0),[t,e]);return I(n)},WH=u.memo(({nodeId:e,fieldName:t})=>{const n=yk(e,t),s=jTe(e,t),{isConnectionInProgress:i,isConnectionStartField:o,validationResult:a}=wTe(e,t);return r.jsxs(mk,{children:[r.jsx(zH,{nodeId:e,fieldName:t,isDisabled:i&&!a.isValid&&!o||s}),r.jsx(VH,{fieldTemplate:n,isConnectionInProgress:i,isConnectionStartField:o,validationResult:a})]})});WH.displayName="OutputFieldNodesEditorView";const kTe=e=>e.input==="connection"&&!ra(e.type)||!Om(wP).includes(e.type.name),_Te=e=>(["any","direct"].includes(e.input)||ra(e.type))&&Om(wP).includes(e.type.name),ITe=e=>{const t=go(e),n=_$(e);return u.useMemo(()=>{const i=Om(n.inputs),o=Om(t.inputs),a=MP(i,o),l=__(t.inputs,kTe).map(d=>d.name),c=__(t.inputs,_Te).map(d=>d.name);return{missingFields:a,connectionFields:l,anyOrDirectFields:c}},[n.inputs,t.inputs])},ATe=e=>{const t=e.filter(i=>!i.ui_hidden),n=t.filter(i=>!ze(i.ui_order)).sort((i,o)=>(i.ui_order??0)-(o.ui_order??0)),s=t.filter(i=>ze(i.ui_order));return n.concat(s).map(i=>i.name).filter(i=>i!=="is_intermediate")},TTe=e=>{const t=go(e);return u.useMemo(()=>ATe(Ci(t.outputs)),[t.outputs])},vk=e=>{const t=go(e);return u.useMemo(()=>fs(t==null?void 0:t.outputs,s=>s.type.name==="ImageField"&&(t==null?void 0:t.type)!=="image"),[t])},MTe=e=>{const t=vk(e),n=un("invocationCache");return u.useMemo(()=>t||n,[t,n])},UH=u.memo(({nodeId:e,fieldName:t})=>{const n=z(),{t:s}=P(),i=Fj(e,t),o=u.useCallback(a=>{n(E3({nodeId:e,fieldName:t,val:a.target.value}))},[n,t,e]);return r.jsxs(Vn,{children:[r.jsx(Yn,{children:r.jsx(ae,{variant:"ghost",tooltip:s("nodes.description"),"aria-label":s("nodes.description"),icon:r.jsx(Roe,{}),pointerEvents:"auto",size:"xs"})}),r.jsx(Gn,{p:2,w:256,children:r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:s("nodes.description")}),r.jsx(Zn,{className:"nodrag nopan nowheel",fontSize:"sm",value:i??"",onChange:o,p:2,resize:"none",rows:5})]})})]})});UH.displayName="InputFieldDescriptionPopover";const PTe={position:"relative",width:"full",height:"full",borderStyle:"solid",borderWidth:4,pointerEvents:"none",'&[data-cardinality="SINGLE"]':{borderWidth:0},borderRadius:"100%",'&[data-is-model-field="true"], &[data-is-batch-field="true"]':{borderRadius:4},'&[data-is-batch-field="true"]':{transform:"rotate(45deg)"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="false"][data-is-connection-valid="false"]':{filter:"opacity(0.4) grayscale(0.7)",cursor:"not-allowed"},'&[data-is-connection-in-progress="true"][data-is-connection-start-field="true"][data-is-connection-valid="false"]':{cursor:"grab"},'&[data-is-connection-in-progress="false"] &[data-is-connection-valid="true"]':{cursor:"crosshair"}},ETe={position:"absolute",width:"1rem",height:"1rem",zIndex:1,background:"none",border:"none",insetInlineStart:"-0.5rem"},$2=u.memo(e=>{const{fieldTemplate:t,isConnectionInProgress:n,isConnectionStartField:s,validationResult:i}=e,{t:o}=P(),a=Oy(t.type),l=u.useMemo(()=>Dy(t.type),[t.type]),c=u.useMemo(()=>SP.some(h=>h===t.type.name),[t.type]),d=u.useMemo(()=>n&&i.messageTKey?o(i.messageTKey):a,[a,n,o,i.messageTKey]);return r.jsx(Le,{label:d,placement:"start",openDelay:v1,children:r.jsx(Dc,{type:"target",id:t.name,position:Rc.Left,style:ETe,children:r.jsx(ke,{sx:PTe,"data-cardinality":t.type.cardinality,"data-is-batch-field":t.type.batch,"data-is-model-field":c,"data-is-connection-in-progress":n,"data-is-connection-start-field":s,"data-is-connection-valid":i.isValid,backgroundColor:t.type.cardinality==="SINGLE"?l:"base.900",borderColor:l})})})});$2.displayName="InputFieldHandle";const LTe=(e,t)=>{const n=z(),s=_V(e,t),i=Zo(e,t),o=u.useMemo(()=>!ol(s,i.default),[s,i.default]),a=u.useCallback(()=>{n(T3({nodeId:e,fieldName:t,value:i.default}))},[n,t,i.default,e]);return{defaultValue:i.default,isValueChanged:o,resetToDefaultValue:a}},qH=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=P(),{isValueChanged:s,resetToDefaultValue:i}=LTe(e,t);return r.jsx(ae,{variant:"ghost",tooltip:n("nodes.resetToDefaultValue"),"aria-label":n("nodes.resetToDefaultValue"),icon:r.jsx(ho,{}),pointerEvents:"auto",size:"xs",onClick:i,isDisabled:!s})});qH.displayName="InputFieldResetToDefaultValueIconButton";const DTe=(e,t)=>{const n=ce(yr),s=ce(xn),i=ce(fa),o=u.useMemo(()=>HH(s,e,t,"target"),[s,e,t]),a=u.useMemo(()=>!!n,[n]),l=u.useMemo(()=>n?n.nodeId===e&&n.handleId===t&&n.fieldTemplate.fieldKind==="input":!1,[t,e,n]),c=I(d=>o(d,n,i));return{isConnectionInProgress:a,isConnectionStartField:l,validationResult:c}},KH=u.memo(({nodeId:e,fieldName:t})=>{const{t:n}=P(),s=kV(e,t),i=Zo(e,t),o=Oy(i.type),a=u.useMemo(()=>s.label&&i.title?`${s.label} (${i.title})`:s.label&&!i.title?s.label:i.title,[s,i]);return r.jsxs(T,{flexDir:"column",children:[r.jsx(K,{fontWeight:"semibold",children:a}),r.jsx(K,{opacity:.7,fontStyle:"oblique 5deg",children:i.description}),r.jsxs(K,{children:[n("parameters.type"),": ",o]}),r.jsxs(K,{children:[n("common.input"),": ",Kc(i.input)]})]})});KH.displayName="InputFieldTooltipContent";const RTe=(e,t)=>{const n=go(e);return u.useMemo(()=>{const i=n.inputs[t];return Re(i,`Template for input field ${t} not found.`),i.title},[t,n.inputs])},OTe={p:0,fontWeight:"semibold",textAlign:"left",color:"base.300",_hover:{fontWeight:"semibold !important"},'&[data-is-invalid="true"]':{color:"error.300"},'&[data-is-disabled="true"]':{opacity:.5}},V2=u.memo(e=>{const{nodeId:t,fieldName:n,isInvalid:s,isDisabled:i}=e,o=u.useRef(null),a=Bj(t,n),l=RTe(t,n),{t:c}=P(),d=z(),h=u.useMemo(()=>l||c("nodes.unknownField"),[l,c]),f=u.useCallback(g=>{d(P3({nodeId:t,fieldName:n,label:g}))},[d,t,n]),p=Ko({value:a||h,defaultValue:h,onChange:f,inputRef:o});return p.isEditing?r.jsx(Ct,{ref:o,variant:"outline",...p.inputProps}):r.jsx(Le,{label:r.jsx(KH,{nodeId:t,fieldName:n}),openDelay:v1,placement:"top",children:r.jsx(K,{sx:OTe,noOfLines:1,"data-is-invalid":s,"data-is-disabled":i,onDoubleClick:p.startEditing,children:p.value})})});V2.displayName="InputFieldTitle";const km=u.memo(({nodeId:e,fieldName:t})=>{const n=Zo(e,t),s=u.useRef(null),i=u.useRef(null),[o,a]=u.useState(!1),l=Hp(e,t),c=J$(e,t),{isConnectionInProgress:d,isConnectionStartField:h,validationResult:f}=DTe(e,t),p=u.useCallback(()=>{a(!0)},[]),g=u.useCallback(()=>{a(!1)},[]),m=PCe({nodeId:e,fieldName:t},n,s,i);return n.input==="connection"||c?r.jsxs(T0,{children:[r.jsx(Z,{isInvalid:l,isDisabled:c,px:2,children:r.jsx(V2,{nodeId:e,fieldName:t,isInvalid:l,isDisabled:d&&!f.isValid&&!h||c})}),r.jsx($2,{fieldTemplate:n,isConnectionInProgress:d,isConnectionStartField:h,validationResult:f})]}):r.jsxs(T0,{children:[r.jsx(Z,{ref:s,isInvalid:l,isDisabled:c,pointerEvents:c?"none":"auto",orientation:"vertical",px:2,opacity:m?.3:1,children:r.jsxs(T,{flexDir:"column",w:"full",gap:1,onMouseEnter:p,onMouseLeave:g,children:[r.jsxs(T,{className:"nodrag",ref:i,gap:1,children:[r.jsx(V2,{nodeId:e,fieldName:t,isInvalid:l}),r.jsx(nt,{}),o&&r.jsxs(r.Fragment,{children:[r.jsx(UH,{nodeId:e,fieldName:t}),r.jsx(qH,{nodeId:e,fieldName:t})]})]}),r.jsx(Cy,{nodeId:e,fieldName:t})]})}),n.input!=="direct"&&r.jsx($2,{fieldTemplate:n,isConnectionInProgress:d,isConnectionStartField:h,validationResult:f})]})});km.displayName="InputFieldEditModeNodes";const NTe=e=>{const t=u.useMemo(()=>ve(ot,s=>{var i;return((i=a1(s,e))==null?void 0:i.isIntermediate)??!1}),[e]);return I(t)},FTe=({nodeId:e})=>{const{t}=P(),n=z(),s=vk(e),i=NTe(e),o=u.useCallback(a=>{n(ite({nodeId:e,isIntermediate:!a.target.checked}))},[n,e]);return s?r.jsxs(Z,{className:"nopan",children:[r.jsxs(te,{m:0,children:[t("nodes.saveToGallery")," "]}),r.jsx(jn,{onChange:o,isChecked:!i})]}):null},BTe=u.memo(FTe),$Te=e=>{const t=u.useMemo(()=>ve(ot,s=>{var i;return((i=a1(s,e))==null?void 0:i.useCache)??!1}),[e]);return I(t)},VTe=({nodeId:e})=>{const t=z(),n=$Te(e),s=u.useCallback(o=>{t(ote({nodeId:e,useCache:o.target.checked}))},[t,e]),{t:i}=P();return r.jsxs(Z,{children:[r.jsx(te,{m:0,children:i("invocationCache.useCache")}),r.jsx(jn,{className:"nopan",onChange:s,isChecked:n})]})},GTe=u.memo(VTe),_A={w:"unset"},zTe=({nodeId:e})=>{const t=vk(e),n=un("invocationCache");return r.jsx(T,{className:pp,layerStyle:"nodeFooter",w:"full",borderBottomRadius:"base",gap:4,px:2,py:0,h:8,justifyContent:"space-between",children:r.jsxs(ms,{formControlProps:_A,formLabelProps:_A,children:[n&&r.jsx(GTe,{nodeId:e}),t&&r.jsx(BTe,{nodeId:e})]})})},HTe=u.memo(zTe),WTe=({nodeId:e,isOpen:t})=>{const n=z(),s=JC(),i=u.useCallback(()=>{n(ate({nodeId:e,isOpen:!t})),s(e)},[n,t,e,s]);return r.jsx(ae,{className:"nodrag",onClick:i,"aria-label":"Minimize",minW:8,w:8,h:8,variant:"link",icon:r.jsx(pt,{as:CE,transform:t?"rotate(0deg)":"rotate(180deg)",transitionProperty:"common",transitionDuration:"normal"})})},bk=u.memo(WTe),UTe=e=>u.useMemo(()=>{switch(e){case"Group 1":return"invokeGreen.300";case"Group 2":return"invokeBlue.300";case"Group 3":return"invokePurple.200";case"Group 4":return"invokeRed.300";case"Group 5":return"invokeYellow.300";default:return}},[e]),qTe=e=>{const t=u.useMemo(()=>ve(ot,s=>{var o;const i=l3(s,e);if(Yr(i)&&lte(i))return(o=i.data.inputs.batch_group_id)==null?void 0:o.value}),[e]);return I(t)},KTe=({nodeId:e,title:t})=>{const n=z(),s=_j(e),i=qTe(e),o=UTe(i),a=A$(e),{t:l}=P(),c=u.useRef(null),d=u.useCallback(p=>{n(u3({nodeId:e,label:p}))},[n,e]),h=Ko({value:s||t||a||l("nodes.problemSettingTitle"),defaultValue:t||a||l("nodes.problemSettingTitle"),onChange:d,inputRef:c}),f=u.useMemo(()=>i?i==="None"?`${h.value} (${l("nodes.noBatchGroup")})`:`${h.value} (${i})`:h.value,[i,h.value,l]);return r.jsxs(T,{overflow:"hidden",w:"full",h:"full",alignItems:"center",justifyContent:"center",cursor:"text",children:[!h.isEditing&&r.jsx(K,{fontWeight:"semibold",color:o,onDoubleClick:h.startEditing,children:f}),h.isEditing&&r.jsx(Ct,{ref:c,...h.inputProps,variant:"outline",_focusVisible:{borderRadius:"base",h:"unset"}})]})},ZH=u.memo(KTe),ZTe=e=>{const t=go(e);return u.useMemo(()=>t.classification,[t])},YTe=({nodeId:e})=>{const t=ZTe(e);return!t||t==="stable"?null:r.jsx(Le,{label:r.jsx(YH,{classification:t}),placement:"top",shouldWrapChildren:!0,children:r.jsx(QTe,{classification:t})})},XTe=u.memo(YTe),YH=u.memo(({classification:e})=>{const{t}=P();return e==="beta"?t("nodes.betaDesc"):e==="prototype"?t("nodes.prototypeDesc"):e==="internal"?t("nodes.internalDesc"):e==="special"?t("nodes.specialDesc"):null});YH.displayName="ClassificationTooltipContent";const QTe=({classification:e})=>e==="beta"?r.jsx(pt,{as:IE,display:"block",boxSize:4,color:"invokeYellow.300"}):e==="prototype"?r.jsx(pt,{as:bS,display:"block",boxSize:4,color:"invokeRed.300"}):e==="internal"?r.jsx(pt,{as:SE,display:"block",boxSize:4,color:"invokePurple.300"}):e==="special"?r.jsx(pt,{as:P1,display:"block",boxSize:4,color:"invokeGreen.300"}):null,IA={visibility:"hidden"},AA={borderWidth:0,borderRadius:"3px",width:"1rem",height:"1rem",backgroundColor:"var(--invoke-colors-base-600)",zIndex:-1},JTe=({nodeId:e})=>{const t=go(e);return t?r.jsxs(r.Fragment,{children:[r.jsx(Dc,{type:"target",id:`${e}-collapsed-target`,isConnectable:!1,position:Rc.Left,style:AA}),Ci(t.inputs,n=>r.jsx(Dc,{type:"target",id:n.name,isConnectable:!1,position:Rc.Left,style:IA},`${e}-${n.name}-collapsed-input-handle`)),r.jsx(Dc,{type:"source",id:`${e}-collapsed-source`,isConnectable:!1,position:Rc.Right,style:AA}),Ci(t.outputs,n=>r.jsx(Dc,{type:"source",id:n.name,isConnectable:!1,position:Rc.Right,style:IA},`${e}-${n.name}-collapsed-output-handle`))]}):null},eMe=u.memo(JTe),tMe=e=>{const t=u.useMemo(()=>ve(ot,s=>DC(s,e).data.version),[e]);return I(t)},XH=u.memo(({nodeId:e})=>{const t=I$(e);return r.jsx(Le,{label:r.jsx(QH,{nodeId:e}),placement:"top",shouldWrapChildren:!0,children:r.jsx(pt,{as:Gu,display:"block",boxSize:4,w:8,color:t?"error.400":"base.400"})})});XH.displayName="InvocationNodeInfoIcon";const QH=u.memo(({nodeId:e})=>{const t=j$(e),n=_j(e),s=tMe(e),i=go(e),{t:o}=P(),a=u.useMemo(()=>n?`${n} (${i.title})`:i.title,[n,i.title]);return r.jsxs(T,{flexDir:"column",children:[r.jsx(K,{as:"span",fontWeight:"semibold",children:a}),r.jsxs(K,{opacity:.7,children:[o("nodes.nodePack"),": ",i.nodePack]}),r.jsx(K,{opacity:.7,fontStyle:"oblique 5deg",children:i.description}),r.jsx(nMe,{nodeVersion:s,templateVersion:i.version}),t&&r.jsx(K,{children:t})]})});QH.displayName="TooltipContent";const nMe=({nodeVersion:e,templateVersion:t})=>{const{t:n}=P();return p_(e,t,"<")?r.jsxs(K,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateNode"),")"]}):p_(e,t,">")?r.jsxs(K,{as:"span",color:"error.500",children:[n("nodes.version")," ",e," (",n("nodes.updateApp"),")"]}):r.jsxs(K,{as:"span",children:[n("nodes.version")," ",e]})},Eb=3,TA={circle:{transitionProperty:"none",transitionDuration:"0s"},".chakra-progress__track":{stroke:"transparent"}},sMe=({nodeId:e})=>{const t=RC(e);return t?r.jsx(Le,{label:r.jsx(JH,{nodeExecutionState:t}),placement:"top",children:r.jsx(T,{className:pp,w:5,h:"full",alignItems:"center",justifyContent:"flex-end",children:r.jsx(eW,{nodeExecutionState:t})})}):null},rMe=u.memo(sMe),JH=u.memo(({nodeExecutionState:e})=>{const{status:t,progress:n,progressImage:s}=e,{t:i}=P();return t===Ks.enum.PENDING?r.jsx(K,{children:i("queue.pending")}):t===Ks.enum.IN_PROGRESS?s?r.jsxs(T,{pos:"relative",pt:1.5,pb:.5,children:[r.jsx(dn,{src:s.dataURL,w:32,h:32,borderRadius:"base",objectFit:"contain"}),n!==null&&r.jsxs(os,{variant:"solid",pos:"absolute",top:2.5,insetInlineEnd:1,children:[Math.round(n*100),"%"]})]}):n!==null?r.jsxs(K,{children:[i("nodes.executionStateInProgress")," (",Math.round(n*100),"%)"]}):r.jsx(K,{children:i("nodes.executionStateInProgress")}):t===Ks.enum.COMPLETED?r.jsx(K,{children:i("nodes.executionStateCompleted")}):t===Ks.enum.FAILED?r.jsx(K,{children:i("nodes.executionStateError")}):null});JH.displayName="TooltipLabel";const eW=u.memo(e=>{const{progress:t,status:n}=e.nodeExecutionState;return n===Ks.enum.PENDING?r.jsx(pt,{as:SS,boxSize:Eb,color:"base.300"}):n===Ks.enum.IN_PROGRESS?t===null?r.jsx(g_,{isIndeterminate:!0,size:"14px",color:"base.500",thickness:14,sx:TA}):r.jsx(g_,{value:Math.round(t*100),size:"14px",color:"base.500",thickness:14,sx:TA}):n===Ks.enum.COMPLETED?r.jsx(pt,{as:mp,boxSize:Eb,color:"ok.300"}):n===Ks.enum.FAILED?r.jsx(pt,{as:Cp,boxSize:Eb,color:"error.300"}):null});eW.displayName="StatusIcon";const iMe=({nodeId:e,isOpen:t})=>r.jsxs(T,{layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:t?0:"base",alignItems:"center",justifyContent:"space-between",h:8,textAlign:"center",color:"base.200",children:[r.jsx(bk,{nodeId:e,isOpen:t}),r.jsx(XTe,{nodeId:e}),r.jsx(ZH,{nodeId:e}),r.jsxs(T,{alignItems:"center",children:[r.jsx(rMe,{nodeId:e}),r.jsx(XH,{nodeId:e})]}),!t&&r.jsx(eMe,{nodeId:e})]}),oMe=u.memo(iMe),aMe=({nodeId:e,isOpen:t,label:n,type:s,selected:i})=>{const o=ITe(e),a=MTe(e),l=TTe(e);return r.jsxs(Ry,{nodeId:e,selected:i,children:[r.jsx(oMe,{nodeId:e,isOpen:t,label:n,selected:i,type:s}),t&&r.jsxs(r.Fragment,{children:[r.jsx(T,{layerStyle:"nodeBody",flexDirection:"column",w:"full",h:"full",py:2,gap:1,borderBottomRadius:a?0:"base",children:r.jsxs(T,{flexDir:"column",px:2,w:"full",h:"full",children:[r.jsxs(Kr,{gridTemplateColumns:"1fr auto",gridAutoRows:"1fr",children:[o.connectionFields.map((c,d)=>r.jsx(Rt,{gridColumnStart:1,gridRowStart:d+1,children:r.jsx(ou,{nodeId:e,fieldName:c,children:r.jsx(km,{nodeId:e,fieldName:c})})},`${e}.${c}.input-field`)),l.map((c,d)=>r.jsx(Rt,{gridColumnStart:2,gridRowStart:d+1,children:r.jsx($H,{nodeId:e,fieldName:c,children:r.jsx(WH,{nodeId:e,fieldName:c})})},`${e}.${c}.output-field`))]}),o.anyOrDirectFields.map(c=>r.jsx(ou,{nodeId:e,fieldName:c,children:r.jsx(km,{nodeId:e,fieldName:c})},`${e}.${c}.input-field`)),o.missingFields.map(c=>r.jsx(ou,{nodeId:e,fieldName:c,children:r.jsx(km,{nodeId:e,fieldName:c})},`${e}.${c}.input-field`))]})}),a&&r.jsx(HTe,{nodeId:e})]})]})},lMe=u.memo(aMe),cMe=e=>{const t=u.useMemo(()=>ve(ot,s=>{var i;return((i=a1(s,e))==null?void 0:i.nodePack)??null}),[e]);return I(t)},uMe=({nodeId:e,isOpen:t,label:n,type:s,selected:i})=>{const{t:o}=P(),a=cMe(e);return r.jsxs(Ry,{nodeId:e,selected:i,children:[r.jsxs(T,{className:pp,layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:t?0:"base",alignItems:"center",h:8,fontWeight:"semibold",fontSize:"sm",children:[r.jsx(bk,{nodeId:e,isOpen:t}),r.jsx(K,{w:"full",textAlign:"center",pe:8,color:"error.300",children:n?`${n} (${s})`:s})]}),t&&r.jsx(T,{layerStyle:"nodeBody",userSelect:"auto",flexDirection:"column",w:"full",h:"full",p:4,gap:1,borderBottomRadius:"base",fontSize:"sm",children:r.jsxs(T,{gap:2,flexDir:"column",children:[r.jsxs(K,{as:"span",children:[o("nodes.unknownNodeType"),":"," ",r.jsx(K,{as:"span",fontWeight:"semibold",children:s})]}),a&&r.jsxs(K,{as:"span",children:[o("nodes.nodePack"),":"," ",r.jsx(K,{as:"span",fontWeight:"semibold",children:a})]})]})})]})},dMe=u.memo(uMe),hMe=e=>{const{data:t,selected:n}=e,{id:s,type:i,isOpen:o,label:a}=t,l=ce(xn),c=u.useMemo(()=>!!l[i],[l,i]),d=u.useMemo(()=>ve(y1,f=>!!f.find(p=>p.id===s)),[s]);return I(d)?c?r.jsx(lMe,{nodeId:s,isOpen:o,label:a,type:i,selected:n}):r.jsx(dMe,{nodeId:s,isOpen:o,label:a,type:i,selected:n}):null},fMe=u.memo(hMe),pMe=e=>{const{id:t,data:n,selected:s}=e,{notes:i,isOpen:o}=n,a=z(),l=u.useCallback(c=>{a(cte({nodeId:t,value:c.target.value}))},[a,t]);return r.jsxs(Ry,{nodeId:t,selected:s,children:[r.jsxs(T,{layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:o?0:"base",alignItems:"center",justifyContent:"space-between",h:8,children:[r.jsx(bk,{nodeId:t,isOpen:o}),r.jsx(ZH,{nodeId:t,title:"Notes"}),r.jsx(ke,{minW:8})]}),o&&r.jsx(r.Fragment,{children:r.jsx(T,{layerStyle:"nodeBody",className:"nopan",cursor:"auto",flexDirection:"column",borderBottomRadius:"base",w:"full",h:"full",p:2,gap:1,children:r.jsx(T,{className:"nopan",w:"full",h:"full",flexDir:"column",children:r.jsx(Zn,{className:"nodrag",value:i,onChange:l,rows:8,resize:"none",fontSize:"sm"})})})})]})},gMe=u.memo(pMe),mMe={collapsed:JAe,default:iTe},yMe={invocation:fMe,current_image:hTe,notes:gMe},vMe={hideAttribution:!0},bMe=[25,25],xMe=e=>e.cancelConnection,tW=u.memo(()=>{const e=z(),t=I(y1),n=I(ute),s=ce(m_),i=ce(y_),o=I(dte),a=I(hte),l=I(dP),c=I(hP),{onConnectStart:d,onConnect:h,onConnectEnd:f}=OAe(),p=u.useRef(null),g=NAe(),m=fte(xMe),y=JC(),x=_a(),C=Ds("workflows");Go("workflows",p),Twe(),pte();const[v]=MC("radii",["base"]),b=u.useMemo(()=>({borderRadius:v}),[v]),S=u.useCallback(se=>{e(Yc(se));const ne=Wy.get();ne&&i&&(y_.set(!1),ne.fitView())},[e,i]),w=u.useCallback(se=>{se.length>0&&e(Fi(se))},[e]),j=u.useCallback((se,ne)=>{m_.set(ne)},[]),{onCloseGlobal:E}=Kf(),A=u.useCallback(()=>{E()},[E]),L=u.useCallback(se=>{Wy.set(se),se.fitView()},[]),M=u.useCallback(se=>{var ne,H;(ne=p.current)!=null&&ne.getBoundingClientRect()&&QC.set(((H=Wy.get())==null?void 0:H.screenToFlowPosition({x:se.clientX,y:se.clientY}))??null)},[]),O=u.useCallback((se,ne,H)=>{fa.set(ne),Mh.set(!1),Uy.set(se)},[]),F=u.useCallback((se,ne)=>{Mh.set(!0);const H=D0(ne);e(Fi([{type:"remove",id:se.id},{type:"add",item:H}])),y([se.source,se.target,H.source,H.target])},[e,y]),_=u.useCallback((se,ne,H)=>{const V=Mh.get(),Y=Uy.get()??{clientX:0,clientY:0},W=!("touches"in se)&&Math.hypot(se.clientX-Y.clientX,se.clientY-Y.clientY)>5;!V&&W&&e(Fi([{type:"remove",id:ne.id}])),fa.set(null),Mh.set(!1),yr.set(null),Uy.set(null)},[e]),{copySelection:R,pasteSelection:D,pasteSelectionWithEdges:$}=zAe();Ee({id:"copySelection",category:"workflows",callback:R,options:{preventDefault:!0},dependencies:[R]});const G=u.useCallback(()=>{const{nodes:se,edges:ne}=ot(x.getState()),H=[],V=[];se.forEach(({id:Y,selected:W})=>{W||H.push({type:"select",id:Y,selected:!0})}),ne.forEach(({id:Y,selected:W})=>{W||V.push({type:"select",id:Y,selected:!0})}),H.length>0&&e(Yc(H)),V.length>0&&e(Fi(V))},[e,x]);Ee({id:"selectAll",category:"workflows",callback:G,options:{enabled:C,preventDefault:!0},dependencies:[G,C]}),Ee({id:"pasteSelection",category:"workflows",callback:D,options:{preventDefault:!0},dependencies:[D]}),Ee({id:"pasteSelectionWithEdges",category:"workflows",callback:$,options:{preventDefault:!0},dependencies:[$]}),Ee({id:"undo",category:"workflows",callback:()=>{e(gte())},options:{enabled:o,preventDefault:!0},dependencies:[o]}),Ee({id:"redo",category:"workflows",callback:()=>{e(mte())},options:{enabled:a,preventDefault:!0},dependencies:[a]});const ee=u.useCallback(()=>{fa.get()||(yr.set(null),yte.set(!1),m())},[m]);Si("esc",ee);const Q=u.useCallback(()=>{const{nodes:se,edges:ne}=ot(x.getState()),H=[],V=[];se.filter(Y=>Y.selected).forEach(({id:Y})=>{H.push({type:"remove",id:Y})}),ne.filter(Y=>Y.selected).forEach(({id:Y})=>{V.push({type:"remove",id:Y})}),H.length>0&&e(Yc(H)),V.length>0&&e(Fi(V))},[e,x]);return Ee({id:"deleteSelection",category:"workflows",callback:Q,options:{preventDefault:!0,enabled:C},dependencies:[Q,C]}),r.jsx(vte,{id:"workflow-editor",ref:p,defaultViewport:s,nodeTypes:yMe,edgeTypes:mMe,nodes:t,edges:n,onInit:L,onMouseMove:M,onNodesChange:S,onEdgesChange:w,onReconnect:F,onReconnectStart:O,onReconnectEnd:_,onConnectStart:d,onConnect:h,onConnectEnd:f,onMoveEnd:j,connectionLineComponent:UAe,isValidConnection:g,minZoom:.1,snapToGrid:l,snapGrid:bMe,connectionRadius:30,proOptions:vMe,style:b,onPaneClick:A,deleteKeyCode:null,selectionMode:c,elevateEdgesOnSelect:!0,nodeDragThreshold:1,children:r.jsx(bte,{})})});tW.displayName="Flow";const CMe=()=>{const e=z(),t=I(CP),{t:n}=P(),s=u.useCallback(i=>{e(xte(i))},[e]);return r.jsx(T,{alignItems:"center",children:r.jsx(qe,{"aria-label":n("nodes.nodeOpacity"),value:t,defaultValue:1,min:.5,max:1,step:.01,onChange:s,orientation:"vertical",h:"calc(100% - 0.5rem)"})})},SMe=u.memo(CMe),wMe=()=>{const{t:e}=P(),{zoomIn:t,zoomOut:n,fitView:s}=cP(),i=z(),o=I(jP),a=u.useCallback(()=>{t({duration:300})},[t]),l=u.useCallback(()=>{n({duration:300})},[n]),c=u.useCallback(()=>{s({duration:300})},[s]),d=u.useCallback(()=>{i(Cte(!o))},[o,i]);return r.jsxs(as,{orientation:"vertical",children:[r.jsx(ae,{tooltip:e("nodes.zoomInNodes"),"aria-label":e("nodes.zoomInNodes"),onClick:a,icon:r.jsx(EE,{})}),r.jsx(ae,{tooltip:e("nodes.zoomOutNodes"),"aria-label":e("nodes.zoomOutNodes"),onClick:l,icon:r.jsx(PE,{})}),r.jsx(ae,{tooltip:e("nodes.fitViewportNodes"),"aria-label":e("nodes.fitViewportNodes"),onClick:c,icon:r.jsx(vp,{})}),r.jsx(ae,{tooltip:e(o?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),"aria-label":e(o?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),isChecked:o,onClick:d,icon:r.jsx(Doe,{})})]})},jMe=u.memo(wMe),kMe=()=>r.jsxs(T,{gap:2,position:"absolute",bottom:2,insetInlineStart:2,children:[r.jsx(jMe,{}),r.jsx(SMe,{})]}),_Me=u.memo(kMe),IMe=$o(Ste),AMe={m:"0 !important",borderRadius:"base",backgroundColor:"base.500 !important",svg:{borderRadius:"inherit"}},TMe=()=>{const e=I(jP);return r.jsx(T,{gap:2,position:"absolute",bottom:2,insetInlineEnd:2,children:e&&r.jsx(IMe,{pannable:!0,zoomable:!0,nodeBorderRadius:15,sx:AMe,nodeColor:"var(--invoke-colors-base-600)",maskColor:"var(--invoke-colors-blackAlpha-600)"})})},MMe=u.memo(TMe),PMe=()=>{const{data:e,isLoading:t}=BC(),{t:n}=P(),s=u.useRef(null);return Go("workflows",s),r.jsxs(T,{tabIndex:-1,ref:s,layerStyle:"first",position:"relative",width:"full",height:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:[e&&r.jsxs(r.Fragment,{children:[r.jsx(tW,{}),r.jsx(PH,{}),r.jsx(EAe,{}),r.jsx(_Me,{}),r.jsx(MMe,{}),r.jsx(DAe,{}),r.jsx(fAe,{})]}),r.jsx(jAe,{}),t&&r.jsx(Yt,{label:n("nodes.loadingNodes"),icon:T1})]})},EMe=u.memo(PMe),nW=u.memo(()=>I(uo)==="edit"?r.jsx(xy,{view:"edit-mode-nodes",children:r.jsx(wte,{children:r.jsx(EMe,{})})}):r.jsx(gy,{}));nW.displayName="WorkflowsMainPanel";const sW="data:image/svg+xml,%3csvg%20width='44'%20height='44'%20viewBox='0%200%2044%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.1951%2010.6667H42V2H2V10.6667H14.8049L29.1951%2033.3333H42V42H2V33.3333H14.8049'%20stroke='%23E6FD13'%20stroke-width='2.8'/%3e%3c/svg%3e",LMe=()=>{const{data:e}=b1(),t=u.useRef(null),n=ce(jte),s=u.useMemo(()=>e?r.jsxs(K,{fontWeight:"semibold",children:["v",e.version]}):null,[e]);return n||r.jsx(Le,{placement:"right",label:s,p:1,px:2,gutter:16,children:r.jsx(dn,{ref:t,src:sW,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"})})},DMe=u.memo(LMe),RMe="data:image/svg+xml,%3csvg%20width='231'%20height='100'%20viewBox='0%200%20231%20100'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_659_3578)'%3e%3crect%20width='100'%20height='100'%20fill='%23E6FD13'/%3e%3cpath%20d='M57.1951%2038.6667H70V30H30V38.6667H42.8049L57.1951%2061.3333H70V70H30V61.3333H42.8049'%20stroke='%23181818'%20stroke-width='2.8'/%3e%3crect%20width='131'%20height='100'%20transform='translate(100)'%20fill='%23E6FD13'/%3e%3cpath%20d='M111.37%2043.34H107.89V39.65H111.37V43.34ZM116.38%2060.5H102.76V58.16H108.22V47.84H103.36V45.5H111.07V58.16H116.38V60.5ZM120.538%2060.5V45.5H123.388V47.6C124.288%2046.25%20125.788%2045.2%20128.188%2045.2C131.638%2045.2%20133.588%2047.3%20133.588%2050.45V60.5H130.738V51.05C130.738%2048.95%20129.838%2047.6%20127.708%2047.6H127.468C125.338%2047.6%20123.388%2049.25%20123.388%2052.1V60.5H120.538ZM141.786%2060.5L136.236%2045.5H139.176L143.526%2057.71L147.876%2045.5H150.786L145.236%2060.5H141.786ZM159.723%2060.8C155.673%2060.8%20152.523%2057.65%20152.523%2053C152.523%2048.35%20155.673%2045.2%20159.723%2045.2C163.773%2045.2%20166.923%2048.35%20166.923%2053C166.923%2057.65%20163.773%2060.8%20159.723%2060.8ZM155.373%2053C155.373%2056.45%20157.173%2058.4%20159.603%2058.4H159.843C162.273%2058.4%20164.073%2056.45%20164.073%2053C164.073%2049.55%20162.273%2047.6%20159.843%2047.6H159.603C157.173%2047.6%20155.373%2049.55%20155.373%2053ZM170.804%2060.5V39.5H173.654V51.98L180.254%2045.5H184.004L177.764%2051.47L184.304%2060.5H180.794L175.724%2053.42L173.654%2055.43V60.5H170.804ZM192.459%2060.8C188.739%2060.8%20185.379%2058.22%20185.379%2052.97C185.379%2047.78%20188.829%2045.2%20192.369%2045.2C196.269%2045.2%20198.729%2047.9%20198.729%2051.8V53.45H188.229C188.409%2056.87%20190.599%2058.4%20192.429%2058.4H192.669C194.139%2058.4%20195.549%2057.65%20195.849%2056.06H198.699C198.159%2059.09%20195.549%2060.8%20192.459%2060.8ZM188.409%2051.2H195.879C195.759%2048.59%20194.199%2047.6%20192.489%2047.6H192.249C190.689%2047.6%20188.949%2048.53%20188.409%2051.2Z'%20fill='%23181818'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_659_3578'%3e%3crect%20width='231'%20height='100'%20rx='5'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",OMe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=ar(),{t:i}=P(),o=Ho(),{depsArray:a,depsObject:l}=kte(void 0,{selectFromResult:({data:h})=>({depsObject:h,depsArray:h?Ci(h,(f,p)=>({name:p,version:f})):[]})}),{data:c}=b1(),d=u.useCallback(()=>{o.writeText(JSON.stringify(l,null,2))},[o,l]);return r.jsxs(r.Fragment,{children:[u.cloneElement(e,{onClick:n}),r.jsxs(ni,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,children:[r.jsx(rr,{}),r.jsxs(si,{maxH:"80vh",h:"34rem",children:[r.jsx(Tr,{children:i("accessibility.about")}),r.jsx(lo,{}),r.jsx(ir,{display:"flex",flexDir:"column",gap:4,children:r.jsxs(Kr,{templateColumns:"repeat(2, 1fr)",h:"full",children:[r.jsx(Rt,{backgroundColor:"base.750",borderRadius:"base",p:"4",h:"full",children:r.jsxs(Nn,{children:[r.jsxs(T,{position:"sticky",top:"0",backgroundColor:"base.750",p:1,alignItems:"center",children:[r.jsx(Ot,{size:"md",children:i("common.localSystem")}),r.jsx(nt,{}),r.jsx(Le,{label:i("common.copy"),children:r.jsx(ae,{onClick:d,isDisabled:!l,"aria-label":i("common.copy"),icon:r.jsx(on,{}),variant:"ghost"})})]}),a.map(({name:h,version:f},p)=>r.jsxs(Kr,{py:"2",px:"1",w:"full",templateColumns:"repeat(2, 1fr)",children:[r.jsx(K,{children:h}),r.jsx(K,{children:f||i("common.notInstalled")})]},p))]})}),r.jsx(Rt,{children:r.jsxs(T,{flexDir:"column",gap:3,justifyContent:"center",alignItems:"center",h:"full",children:[r.jsx(dn,{src:RMe,alt:"invoke-logo",w:"120px"}),c&&r.jsx(K,{children:`v${c==null?void 0:c.version}`}),r.jsxs(Kr,{templateColumns:"repeat(2, 1fr)",gap:"3",children:[r.jsx(Rt,{children:r.jsx(Xs,{href:$x,label:i("common.githubLabel")})}),r.jsx(Rt,{children:r.jsx(Xs,{href:ow,label:i("common.discordLabel")})})]}),r.jsx(Ot,{fontSize:"large",children:i("common.aboutHeading")}),r.jsx(K,{fontSize:"sm",children:i("common.aboutDesc")}),r.jsx(Xs,{href:lI,label:lI})]})})]})}),r.jsx(co,{})]})]})]})},NMe=u.memo(OMe),FMe=({hotkey:e})=>{const{t}=P(),{id:n,platformKeys:s,title:i,desc:o}=e;return r.jsxs(T,{flexDir:"column",gap:2,px:2,children:[r.jsxs(T,{lineHeight:1,gap:1,alignItems:"center",children:[r.jsx(K,{fontWeight:"semibold",children:i}),r.jsx(nt,{}),s.map((a,l)=>r.jsxs(u.Fragment,{children:[a.map((c,d)=>r.jsxs(u.Fragment,{children:[r.jsx(Th,{textTransform:"lowercase",children:c}),d!==a.length-1&&r.jsx(K,{as:"span",fontWeight:"semibold",children:"+"})]},`${n}-${c}-${l}-${d}`)),l!==s.length-1&&r.jsx(K,{as:"span",px:2,variant:"subtext",fontWeight:"semibold",children:t("common.or")})]},`${n}-${l}`))]}),r.jsx(K,{variant:"subtext",children:o})]})},BMe=u.memo(FMe),$Me=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=ar(),{t:i}=P(),[o,a]=u.useState(""),l=u.useRef(null),c=u.useCallback(()=>a(""),[]),d=u.useCallback(p=>a(p.target.value),[]),h=WP(),f=u.useMemo(()=>{const p=o.trim().toLowerCase(),g=[];return Object.values(h).forEach(m=>{const y={title:m.title,hotkeys:[]};Object.values(m.hotkeys).forEach(x=>{p.length?(x.title.toLowerCase().includes(p)||x.desc.toLowerCase().includes(p)||x.category.toLowerCase().includes(p)||x.platformKeys.some(C=>C.some(v=>v.toLowerCase().includes(p))))&&y.hotkeys.push(x):y.hotkeys.push(x)}),y.hotkeys.length&&g.push(y)}),g},[h,o]);return r.jsxs(r.Fragment,{children:[u.cloneElement(e,{onClick:n}),r.jsxs(ni,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,initialFocusRef:l,children:[r.jsx(rr,{}),r.jsxs(si,{maxH:"80vh",h:"80vh",children:[r.jsx(Tr,{children:i("hotkeys.hotkeys")}),r.jsx(lo,{}),r.jsxs(ir,{display:"flex",flexDir:"column",gap:4,children:[r.jsxs(Vo,{children:[r.jsx(Ct,{ref:l,placeholder:i("hotkeys.searchHotkeys"),value:o,onChange:d}),o.length&&r.jsx(eo,{h:"full",pe:2,children:r.jsx(ae,{onClick:c,size:"sm",variant:"ghost","aria-label":i("hotkeys.clearSearch"),boxSize:4,icon:r.jsx(Nt,{})})})]}),r.jsx(Nn,{children:r.jsxs(T,{flexDir:"column",gap:4,children:[f.map(p=>r.jsx(Ri,{title:p.title,children:p.hotkeys.map((g,m)=>r.jsxs(u.Fragment,{children:[r.jsx(BMe,{hotkey:g}),m<p.hotkeys.length-1&&r.jsx(Et,{})]},g.id))},p.title)),!f.length&&r.jsx(Yt,{label:i("hotkeys.noHotkeysFound"),icon:null})]})})]}),r.jsx(co,{})]})]})]})},VMe=u.memo($Me);function GMe(e){return pe({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M19.3034 5.33716C17.9344 4.71103 16.4805 4.2547 14.9629 4C14.7719 4.32899 14.5596 4.77471 14.411 5.12492C12.7969 4.89144 11.1944 4.89144 9.60255 5.12492C9.45397 4.77471 9.2311 4.32899 9.05068 4C7.52251 4.2547 6.06861 4.71103 4.70915 5.33716C1.96053 9.39111 1.21766 13.3495 1.5891 17.2549C3.41443 18.5815 5.17612 19.388 6.90701 19.9187C7.33151 19.3456 7.71356 18.73 8.04255 18.0827C7.41641 17.8492 6.82211 17.5627 6.24904 17.2231C6.39762 17.117 6.5462 17.0003 6.68416 16.8835C10.1438 18.4648 13.8911 18.4648 17.3082 16.8835C17.4568 17.0003 17.5948 17.117 17.7434 17.2231C17.1703 17.5627 16.576 17.8492 15.9499 18.0827C16.2789 18.73 16.6609 19.3456 17.0854 19.9187C18.8152 19.388 20.5875 18.5815 22.4033 17.2549C22.8596 12.7341 21.6806 8.80747 19.3034 5.33716ZM8.5201 14.8459C7.48007 14.8459 6.63107 13.9014 6.63107 12.7447C6.63107 11.5879 7.45884 10.6434 8.5201 10.6434C9.57071 10.6434 10.4303 11.5879 10.4091 12.7447C10.4091 13.9014 9.57071 14.8459 8.5201 14.8459ZM15.4936 14.8459C14.4535 14.8459 13.6034 13.9014 13.6034 12.7447C13.6034 11.5879 14.4323 10.6434 15.4936 10.6434C16.5442 10.6434 17.4038 11.5879 17.3825 12.7447C17.3825 13.9014 16.5548 14.8459 15.4936 14.8459Z"},child:[]}]})(e)}function zMe(e){return pe({attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.001 2C6.47598 2 2.00098 6.475 2.00098 12C2.00098 16.425 4.86348 20.1625 8.83848 21.4875C9.33848 21.575 9.52598 21.275 9.52598 21.0125C9.52598 20.775 9.51348 19.9875 9.51348 19.15C7.00098 19.6125 6.35098 18.5375 6.15098 17.975C6.03848 17.6875 5.55098 16.8 5.12598 16.5625C4.77598 16.375 4.27598 15.9125 5.11348 15.9C5.90098 15.8875 6.46348 16.625 6.65098 16.925C7.55098 18.4375 8.98848 18.0125 9.56348 17.75C9.65098 17.1 9.91348 16.6625 10.201 16.4125C7.97598 16.1625 5.65098 15.3 5.65098 11.475C5.65098 10.3875 6.03848 9.4875 6.67598 8.7875C6.57598 8.5375 6.22598 7.5125 6.77598 6.1375C6.77598 6.1375 7.61348 5.875 9.52598 7.1625C10.326 6.9375 11.176 6.825 12.026 6.825C12.876 6.825 13.726 6.9375 14.526 7.1625C16.4385 5.8625 17.276 6.1375 17.276 6.1375C17.826 7.5125 17.476 8.5375 17.376 8.7875C18.0135 9.4875 18.401 10.375 18.401 11.475C18.401 15.3125 16.0635 16.1625 13.8385 16.4125C14.201 16.725 14.5135 17.325 14.5135 18.2625C14.5135 19.6 14.501 20.675 14.501 21.0125C14.501 21.275 14.6885 21.5875 15.1885 21.4875C19.259 20.1133 21.9999 16.2963 22.001 12C22.001 6.475 17.526 2 12.001 2Z"},child:[]}]})(e)}const rW=u.memo(()=>{const{t:e}=P(),t=IC(),n=I(LT),s=u.useCallback(i=>{t(_te(i.target.checked))},[t]);return r.jsxs(Z,{children:[r.jsx(te,{children:e("system.enableLogging")}),r.jsx(it,{isChecked:n,onChange:s})]})});rW.displayName="SettingsDeveloperLogIsEnabled";const iW=u.memo(()=>{const{t:e}=P(),t=z(),n=I(PT),s=u.useMemo(()=>Ite.options.map(a=>({label:e(`system.logLevel.${a}`),value:a})),[e]),i=u.useMemo(()=>s.find(a=>a.value===n),[n,s]),o=u.useCallback(a=>{Ate(a==null?void 0:a.value)&&t(Tte(a.value))},[t]);return r.jsxs(Z,{children:[r.jsx(te,{children:e("system.logLevel.logLevel")}),r.jsx(Fe,{value:i,options:s,onChange:o,isSearchable:!1})]})});iW.displayName="SettingsDeveloperLogLevel";const oW=u.memo(()=>{const{t:e}=P(),t=I(ET),n=u.useMemo(()=>MP(Mte.options,t),[t]);return r.jsxs(Z,{orientation:"vertical",children:[r.jsx(te,{children:e("system.logNamespaces.logNamespaces")}),r.jsx(T,{w:"full",gap:2,flexWrap:"wrap",minH:"32px",borderRadius:"base",borderWidth:1,p:2,alignItems:"center",children:t.map(s=>r.jsx(MA,{namespace:s,isEnabled:!0},`enabled-${s}`))}),r.jsx(T,{gap:2,flexWrap:"wrap",children:n.map(s=>r.jsx(MA,{namespace:s,isEnabled:!1},`disabled-${s}`))})]})});oW.displayName="SettingsDeveloperLogNamespaces";const MA=({namespace:e,isEnabled:t})=>{const{t:n}=P(),s=IC(),i=u.useCallback(()=>{s(Pte(e))},[s,e]);return r.jsxs(EC,{h:"min-content",borderRadius:"base",onClick:i,colorScheme:t?"invokeBlue":"base",userSelect:"none",role:"button",size:"md",color:"base.900",bg:t?"invokeBlue.300":"base.300",children:[r.jsx(K,{fontSize:"sm",fontWeight:"semibold",children:n(`system.logNamespaces.${e}`)}),t&&r.jsx(LC,{})]})},HMe=e=>{const{t}=P(),{data:n,refetch:s}=Ete(void 0,{refetchOnMountOrArgChange:!0,skip:!e}),[i,{isLoading:o}]=Lte(),{data:a}=ei(),l=u.useMemo(()=>!!(a&&(a.queue.in_progress>0||a.queue.pending>0)),[a]),c=u.useCallback(()=>{l||i().unwrap().then(d=>{fe({id:"INTERMEDIATES_CLEARED",title:t("settings.intermediatesCleared",{count:d}),status:"info"})}).catch(()=>{fe({id:"INTERMEDIATES_CLEAR_FAILED",title:t("settings.intermediatesClearedFailed"),status:"error"})})},[t,i,l]);return{intermediatesCount:n,clearIntermediates:c,isLoading:o,hasPendingItems:l,refetchIntermediatesCount:s}},WMe=$e.enum(["ar","az","de","en","es","fi","fr","he","hu","it","ja","ko","nl","pl","pt","pt_BR","ru","sv","tr","ua","vi","zh_CN","zh_Hant"]),UMe=e=>WMe.safeParse(e).success,qMe={ar:"العربية",az:"Azərbaycan dili",de:"Deutsch",en:"English",es:"Español",fi:"Suomi",fr:"Français",he:"עִבְֿרִית",hu:"Magyar Nyelv",it:"Italiano",ja:"日本語",ko:"한국어",nl:"Nederlands",pl:"Polski",pt:"Português",pt_BR:"Português do Brasil",ru:"Русский",sv:"Svenska",tr:"Türkçe",ua:"Украї́нська",vi:"Tiếng Việt",zh_CN:"简体中文",zh_Hant:"漢語"},PA=Ci(qMe,(e,t)=>({label:e,value:t})),aW=u.memo(()=>{const{t:e}=P(),t=z(),n=I(NR),s=un("localization"),i=u.useMemo(()=>PA.find(a=>a.value===n),[n]),o=u.useCallback(a=>{UMe(a==null?void 0:a.value)&&t(Dte(a.value))},[t]);return r.jsxs(Z,{isDisabled:!s,children:[r.jsx(te,{children:e("common.languagePickerLabel")}),r.jsx(Fe,{value:i,options:PA,onChange:o})]})});aW.displayName="SettingsLanguageSelect";const KMe={shouldShowDeveloperSettings:!0,shouldShowResetWebUiText:!0,shouldShowClearIntermediates:!0,shouldShowLocalizationToggle:!0,shouldShowInvocationProgressDetailSetting:!0},[ZMe]=ja(!1),YMe=({config:e=KMe,children:t})=>{const n=z(),{t:s}=P(),{isNSFWCheckerAvailable:i,isWatermarkerAvailable:o}=Y3(void 0,{selectFromResult:({data:Q})=>({isNSFWCheckerAvailable:(Q==null?void 0:Q.nsfw_methods.includes("nsfw_checker"))??!1,isWatermarkerAvailable:(Q==null?void 0:Q.watermarking_methods.includes("invisible_watermark"))??!1})}),{clearIntermediates:a,hasPendingItems:l,intermediatesCount:c,isLoading:d,refetchIntermediatesCount:h}=HMe(!!(e!=null&&e.shouldShowClearIntermediates)),f=ZMe(),p=MR(),g=I(Rte),m=I(Ote),y=I(sS),x=I(Nte),C=I(Fte),v=I(Bte),b=I($te),S=I(X0),w=I(Wf),j=I(qM),E=u.useCallback(()=>{n(hC())},[n]),A=JP();u.useEffect(()=>{f.isTrue&&(e!=null&&e.shouldShowClearIntermediates)&&h()},[e==null?void 0:e.shouldShowClearIntermediates,h,f.isTrue]);const L=u.useCallback(()=>{A(),f.setFalse(),p.setTrue()},[A,f,p]),M=u.useCallback(Q=>{n(zT(Q.target.checked))},[n]),O=u.useCallback(Q=>{n(Vte(Q.target.checked))},[n]),F=u.useCallback(Q=>{n(Gte(Q.target.checked))},[n]),_=u.useCallback(Q=>{n(XM(Q.target.checked))},[n]),R=u.useCallback(Q=>{n(zte(Q.target.checked))},[n]),D=u.useCallback(Q=>{n(KT(Q.target.checked))},[n]),$=u.useCallback(Q=>{n(Hte(Q.target.checked))},[n]),G=u.useCallback(Q=>{n(Wte(Q.target.checked))},[n]),ee=u.useCallback(Q=>{n(Ute(Q.target.checked))},[n]);return r.jsxs(r.Fragment,{children:[u.cloneElement(t,{onClick:f.setTrue}),r.jsxs(ni,{isOpen:f.isTrue,onClose:f.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[r.jsx(rr,{}),r.jsxs(si,{maxH:"80vh",h:"68rem",children:[r.jsx(Tr,{bg:"none",children:s("common.settingsLabel")}),r.jsx(lo,{}),r.jsx(ir,{display:"flex",flexDir:"column",gap:4,children:r.jsx(Nn,{children:r.jsx(T,{flexDir:"column",gap:4,children:r.jsxs(ms,{formLabelProps:{flexGrow:1},children:[r.jsxs(Ri,{title:s("settings.general"),children:[r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.confirmOnDelete")}),r.jsx(it,{isChecked:m,onChange:M})]}),r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.confirmOnNewSession")}),r.jsx(it,{isChecked:w,onChange:E})]})]}),r.jsxs(Ri,{title:s("settings.generation"),children:[r.jsxs(Z,{isDisabled:!i,children:[r.jsx(te,{children:s("settings.enableNSFWChecker")}),r.jsx(it,{isChecked:C,onChange:O})]}),r.jsxs(Z,{isDisabled:!o,children:[r.jsx(te,{children:s("settings.enableInvisibleWatermark")}),r.jsx(it,{isChecked:v,onChange:F})]})]}),r.jsxs(Ri,{title:s("settings.ui"),children:[r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.showProgressInViewer")}),r.jsx(it,{isChecked:y,onChange:_})]}),r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.antialiasProgressImages")}),r.jsx(it,{isChecked:x,onChange:R})]}),!!(e!=null&&e.shouldShowInvocationProgressDetailSetting)&&r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.showDetailedInvocationProgress")}),r.jsx(it,{isChecked:j,onChange:ee})]}),r.jsxs(Z,{children:[r.jsx(Ve,{feature:"noiseUseCPU",inPortal:!1,children:r.jsx(te,{children:s("parameters.useCpuNoise")})}),r.jsx(it,{isChecked:g,onChange:G})]}),!!(e!=null&&e.shouldShowLocalizationToggle)&&r.jsx(aW,{}),r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.enableInformationalPopovers")}),r.jsx(it,{isChecked:b,onChange:D})]}),r.jsxs(Z,{children:[r.jsx(te,{children:s("settings.enableModelDescriptions")}),r.jsx(it,{isChecked:S,onChange:$})]})]}),!!(e!=null&&e.shouldShowDeveloperSettings)&&r.jsxs(Ri,{title:s("settings.developer"),children:[r.jsx(rW,{}),r.jsx(iW,{}),r.jsx(oW,{})]}),!!(e!=null&&e.shouldShowClearIntermediates)&&r.jsxs(Ri,{title:s("settings.clearIntermediates"),children:[r.jsx(ye,{tooltip:l?s("settings.clearIntermediatesDisabled"):void 0,colorScheme:"warning",onClick:a,isLoading:d,isDisabled:!c||l,children:s("settings.clearIntermediatesWithCount",{count:c??0})}),r.jsx(K,{fontWeight:"bold",children:s("settings.clearIntermediatesDesc1")}),r.jsx(K,{variant:"subtext",children:s("settings.clearIntermediatesDesc2")}),r.jsx(K,{variant:"subtext",children:s("settings.clearIntermediatesDesc3")})]}),r.jsxs(Ri,{title:s("settings.resetWebUI"),children:[r.jsx(ye,{colorScheme:"error",onClick:L,children:s("settings.resetWebUI")}),!!(e!=null&&e.shouldShowResetWebUiText)&&r.jsxs(r.Fragment,{children:[r.jsx(K,{variant:"subtext",children:s("settings.resetWebUIDesc1")}),r.jsx(K,{variant:"subtext",children:s("settings.resetWebUIDesc2")})]})]})]})})})}),r.jsx(co,{})]})]})]})},XMe=u.memo(YMe),EA=({menuText:e,menuIcon:t})=>{const{t:n}=P();return r.jsx(Le,{label:n("upsell.professionalUpsell"),placement:"right",gutter:16,children:r.jsx(he,{as:"a",href:"http://invoke.com/pricing",target:"_blank",icon:t({}),children:r.jsxs(T,{gap:"1",alignItems:"center",justifyContent:"space-between",children:[r.jsx(K,{children:e}),r.jsx(pt,{as:bE,color:"invokeYellow.500"})]})})})},QMe=()=>{const{t:e}=P(),{isOpen:t,onOpen:n,onClose:s}=ar();Kf(s);const i=un("bugLink"),o=un("discordLink"),a=un("githubLink");return r.jsxs(Qt,{isOpen:t,onOpen:n,onClose:s,autoSelect:!1,children:[r.jsx(Jt,{as:ae,variant:"link","aria-label":e("accessibility.menu"),icon:r.jsx(zu,{fontSize:20}),boxSize:8}),r.jsx(Uf,{children:r.jsxs(kt,{children:[r.jsxs(Cr,{title:e("upsell.professional"),children:[r.jsx(EA,{menuText:e("upsell.inviteTeammates"),menuIcon:Woe}),r.jsx(EA,{menuText:e("upsell.shareAccess"),menuIcon:Qoe})]}),r.jsxs(Cr,{title:e("common.communityLabel"),children:[a&&r.jsx(he,{as:"a",href:$x,target:"_blank",icon:r.jsx(zMe,{}),children:e("common.githubLabel")}),i&&r.jsx(he,{as:"a",href:`${$x}/issues`,target:"_blank",icon:r.jsx(foe,{}),children:e("common.reportBugLabel")}),o&&r.jsx(he,{as:"a",href:ow,target:"_blank",icon:r.jsx(GMe,{}),children:e("common.discordLabel")})]}),r.jsxs(Cr,{title:e("common.settingsLabel"),children:[r.jsx(VMe,{children:r.jsx(he,{as:"button",icon:r.jsx(Toe,{}),children:e("common.hotkeysLabel")})}),r.jsx(XMe,{children:r.jsx(he,{as:"button",icon:r.jsx(Joe,{}),children:e("common.settingsLabel")})})]}),r.jsx(Cr,{title:e("accessibility.about"),children:r.jsx(NMe,{children:r.jsx(he,{as:"button",icon:r.jsx(Gu,{}),children:e("accessibility.about")})})})]})})]})},JMe=u.memo(QMe),e3e=()=>{const e=ce(An),{t}=P();return e?null:r.jsx(Le,{label:t("common.statusDisconnected"),placement:"end",shouldWrapChildren:!0,gutter:10,children:r.jsx(pt,{as:Cp,color:"error.300"})})},t3e=u.memo(e3e),lW=u.memo(()=>{const{t:e}=P(),t=z(),n=RR(),s=u.useCallback(()=>{t(fhe()),n.open()},[n,t]);return r.jsx(ae,{"aria-label":e("supportVideos.supportVideos"),variant:"link",icon:r.jsx(tae,{fontSize:20}),boxSize:8,onClick:s})});lW.displayName="VideosModalButton";const Mc=u.memo(({tab:e,children:t})=>{const n=u.useMemo(()=>ve(Qr,i=>!i.disabledTabs.includes(e)),[e]);return I(n)?t:null});Mc.displayName="TabMountGate";const n3e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANISURBVHgB7ZvBSxRRHMe/763rmolu1CEjcaWjB4WgyEuuEHRTQroGgtcyvLdud1O7Ch46RoHegqDyIhQE+w+EE0J2KBhNMl13Xu83pc6sovMcZ97gmw8s7Lx97PL77e/7e7/3ezMMdayKS/3CwSAghuRlAWcAwVgFQlQ4z5bb2XfL+xnbfbMsCvkc1ktw2BjOMpxNb6Gl3MUsmy5dB5DxjWLjPROiFwZAEbHNWorkBE4D9M+bYjxBtuawUXLfr4rLBeFUl2EgzGFFDqdagqHUuBjiAsyY0K9H6n+QfatdFDAYDsNJHQDDMd4BDVDkSuYnkoxM6krzUwnAcNIcgJCoau60CZuTUgnAcEJLYGlxJ9C8tjaG7t4MgrJiOVj56iBqQjtgeGAt0LzWPMPbz3l0FIIF3csXW5gs/0bUxCaBdVvg8cgGkkasOWBpsYo3C9tIEsoS6OvPKs13tWzV9q7HZBR8+nLBlcRRXO3kyr91EiJviJAD7lxfkxLYT2ijD5tQnjqPJBC5BCjpjT7K+cZmn/8JvHpETWwtsZvXbJ8UyDG0KhwnhaiJLQlOzflDnqRBkaCb2BzQdzsrpdDkG6N1nhyhk1iXwfEnzTL0/dWg7togVgeQ3svPmn1jVBvMzuiTgpZzgeGBddfwXVTL5NNEy25waq5FGr3/0zrLZC0OoH96vHTON6arTNZ6NFYvBR21gdaGCEnBCy2JcWyBvWh1wGFSiLtM1n46TAmQNkv1ZfJHuWOMA+09QdL7YWXy5NNNxEEimqKHlcmzM5uxlMnKEqDMrcr9Bzn3dRQkhRtyx+jtG5AUOjqDN1KJV+9aleYrd4S8y1ZQbgXo7JAUpqUURu792hv7102KNgoSdS5wd7DRlUOcJO5gpL5MjprQ5wJBNKeiY9L9a/mda3aw0D9JTvIS2gFRhGx3DzlMLfmdlPRwFIYTWgJJv2foOFIJwHDSHABFdN8TdNqkEoDhpA6A4ZADLJgKYxUu91wLMBRBT5NmHDYPQ+G8Vubt2R8fHAczMAyyuZ3ZlpsEqw21CTBRgSHQo7Ouzfi/CnQx295iTtGESCAbt9lOkWym6wOnkKsiXxC1zAQ468HZeZ7YkoYvZMDmSfLeD/4CAK41g1vx5woAAAAASUVORK5CYII=",s3e=ve(Qr,e=>e.isLocal),r3e={StrongComponent:r.jsx(K,{as:"span",color:"white",fontSize:"sm",fontWeight:"semibold"})},i3e=()=>{const{t:e}=P(),{data:t}=b1(),n=I(s3e),s=u.useMemo(()=>{var o;return(o=t==null?void 0:t.highlights)!=null&&o.length?t.highlights.map((a,l)=>r.jsx(Gt,{children:a},`${a}-${l}`)):e("whatsNew.items",{returnObjects:!0}).map((a,l)=>r.jsx(Gt,{children:r.jsx(Xt,{i18nKey:a,components:r3e})},`${a}-${l}`))},[t==null?void 0:t.highlights,e]);return r.jsxs(T,{gap:4,flexDir:"column",children:[r.jsx(ki,{fontSize:"sm",children:s}),r.jsxs(T,{flexDir:"column",gap:1,children:[r.jsx(Xs,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.readReleaseNotes"),href:n?`https://github.com/invoke-ai/InvokeAI/releases/tag/v${t==null?void 0:t.version}`:"https://support.invoke.ai/support/solutions/articles/151000178246"}),r.jsx(Xs,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.watchRecentReleaseVideos"),href:"https://www.youtube.com/@invokeai/videos"})]})]})},o3e=ve(Qr,e=>e.isLocal),a3e=()=>{const{t:e}=P(),t=z(),n=I(a=>a.ui.shouldShowNotificationV2),s=u.useCallback(()=>{t(qte(!1))},[t]),{data:i}=b1(),o=I(o3e);return i?r.jsxs(Vn,{onClose:s,placement:"top-start",autoFocus:!1,defaultIsOpen:n,children:[r.jsx(Yn,{children:r.jsx(T,{pos:"relative",children:r.jsx(ae,{"aria-label":"Notifications",variant:"link",icon:r.jsx(Moe,{fontSize:20}),boxSize:8})})}),r.jsxs(Gn,{p:2,children:[r.jsx(_i,{}),r.jsx(ZT,{}),r.jsx(Kte,{fontSize:"md",fontWeight:"semibold",pt:5,children:r.jsxs(T,{alignItems:"center",gap:3,children:[r.jsx(dn,{src:n3e,boxSize:6}),e("whatsNew.whatsNewInInvoke"),!!i.version.length&&(o?r.jsx(K,{variant:"subtext",children:`v${i.version}`}):r.jsx(K,{variant:"subtext",children:i.version}))]})}),r.jsx(Xn,{p:2,maxW:300,children:r.jsx(i3e,{})})]})]}):null},Pc=u.memo(u.forwardRef(({tab:e,icon:t,label:n},s)=>{const i=z(),o=I(On),a=u.useCallback(()=>{i(bt(e))},[i,e]);return r.jsx(Le,{label:n,placement:"end",children:r.jsx(ae,{ref:s,p:0,onClick:a,icon:t,size:"md",fontSize:"24px",variant:"appTab","data-selected":o===e,"aria-label":n,"data-testid":n})})}));Pc.displayName="TabButton";const cW=u.memo(()=>{const{t:e}=P(),t=ce(Zte);return r.jsxs(T,{flexDir:"column",alignItems:"center",py:2,gap:4,minW:0,children:[r.jsx(DMe,{}),r.jsxs(T,{gap:4,pt:6,h:"full",flexDir:"column",children:[r.jsx(Mc,{tab:"canvas",children:r.jsx(Pc,{tab:"canvas",icon:r.jsx(La,{}),label:e("ui.tabs.canvas")})}),r.jsx(Mc,{tab:"upscaling",children:r.jsx(Pc,{tab:"upscaling",icon:r.jsx(vp,{}),label:e("ui.tabs.upscaling")})}),r.jsx(Mc,{tab:"workflows",children:r.jsx(Pc,{tab:"workflows",icon:r.jsx(T1,{}),label:e("ui.tabs.workflows")})}),r.jsx(Mc,{tab:"models",children:r.jsx(Pc,{tab:"models",icon:r.jsx(yoe,{}),label:e("ui.tabs.models")})}),r.jsx(Mc,{tab:"queue",children:r.jsx(Pc,{tab:"queue",icon:r.jsx(DE,{}),label:e("ui.tabs.queue")})})]}),r.jsx(nt,{}),r.jsx(t3e,{}),r.jsx(a3e,{}),r.jsx(lW,{}),t||r.jsx(JMe,{})]})});cW.displayName="VerticalNavBar";const LA=0,uW=-10,dW=10,l3e=-10,c3e=10,DA=1,RA=1,u3e=[uW,0,dW],d3e=()=>{const e=I(Yte),t=z(),{t:n}=P(),s=u.useCallback(i=>{t(Xte(i))},[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"creativity",children:r.jsx(te,{children:n("upscaling.creativity")})}),r.jsx(qe,{value:e,defaultValue:LA,min:uW,max:dW,step:DA,fineStep:RA,onChange:s,marks:u3e}),r.jsx(Ae,{value:e,defaultValue:LA,min:l3e,max:c3e,step:DA,fineStep:RA,onChange:s})]})},h3e=u.memo(d3e),f3e=()=>{const{t:e}=P(),[t,{isLoading:n}]=Ip(),s=I(kP),i=z(),o=u.useMemo(()=>{var p;if(!(!t.length||!s))return(p=t.find(g=>g.key===(s==null?void 0:s.key)))==null?void 0:p.description},[t,s]),a=u.useCallback(p=>{i(Qte(p))},[i]),{options:l,value:c,onChange:d,placeholder:h,noOptionsMessage:f}=Fa({modelConfigs:t,onChange:a,selectedModel:s,isLoading:n});return r.jsxs(Z,{orientation:"vertical",children:[r.jsx(Ve,{feature:"upscaleModel",children:r.jsx(te,{children:e("upscaling.upscaleModel")})}),r.jsx(Le,{label:o,children:r.jsx(ke,{w:"full",children:r.jsx(Fe,{value:c,placeholder:h,options:l,onChange:d,noOptionsMessage:f,isDisabled:l.length===0})})})]})},p3e=u.memo(f3e),OA=0,hW=-10,fW=10,g3e=-10,m3e=10,NA=1,FA=1,y3e=[hW,0,fW],v3e=()=>{const e=I(Jte),t=z(),{t:n}=P(),s=u.useCallback(i=>{t(ene(i))},[t]);return r.jsxs(Z,{children:[r.jsx(Ve,{feature:"structure",children:r.jsx(te,{children:n("upscaling.structure")})}),r.jsx(qe,{value:e,defaultValue:OA,min:hW,max:fW,step:NA,fineStep:FA,onChange:s,marks:y3e}),r.jsx(Ae,{value:e,defaultValue:OA,min:g3e,max:m3e,step:NA,fineStep:FA,onChange:s})]})},b3e=u.memo(v3e),x3e=[2,4,8],BA=e=>`${e}x`,pW=u.memo(()=>{const e=z(),{t}=P(),n=I(tne),s=u.useCallback(i=>{e(nne(i))},[e]);return r.jsxs(Z,{orientation:"vertical",gap:0,children:[r.jsx(Ve,{feature:"scale",children:r.jsx(te,{m:0,children:t("upscaling.scale")})}),r.jsxs(T,{w:"full",gap:4,children:[r.jsx(qe,{min:2,max:8,value:n,onChange:s,marks:x3e,formatValue:BA,defaultValue:4}),r.jsx(Ae,{maxW:20,value:n,onChange:s,defaultValue:4,min:2,max:16,format:BA})]})]})});pW.displayName="UpscaleScaleSlider";const C3e=()=>{const e=z(),t=I(_P),n=u.useMemo(()=>s2.getData(),[]),s=u.useCallback(()=>{e(Pm(null))},[e]),i=u.useCallback(o=>{e(Pm(o))},[e]);return r.jsx(T,{justifyContent:"flex-start",children:r.jsxs(T,{position:"relative",w:36,h:36,alignItems:"center",justifyContent:"center",children:[!t&&r.jsx(bj,{w:"full",h:"full",isError:!t,onUpload:i,fontSize:36}),t&&r.jsxs(r.Fragment,{children:[r.jsx($a,{imageDTO:t}),r.jsx(T,{position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1,children:r.jsx(io,{onClick:s,icon:r.jsx(ho,{size:16}),tooltip:Ce("common.reset")})}),r.jsx(K,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:0,left:0,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",borderBottomStartRadius:"base",pointerEvents:"none",children:`${t.width}x${t.height}`})]}),r.jsx(vs,{dndTarget:s2,dndTargetData:n,label:Ce("gallery.drop")})]})})},S3e=e=>It(U0,Qr,(t,n)=>{const{upscaleModel:s,scale:i}=t,{maxUpscaleDimension:o}=n;if(!o||!s||!e)return!1;const{width:a,height:l}=e,c=o**2;return a*i*l*i>c}),w3e=e=>{const t=u.useMemo(()=>S3e(e),[e]);return I(t)},j3e=()=>{const{t:e}=P(),t=I(ip),n=I(kP),s=I(sne),i=I(_P),o=z(),[a,{isLoading:l}]=ew(),c=I(FC),d=I(rne),h=w3e(i);u.useEffect(()=>{const x=a.find(C=>C.base===(t==null?void 0:t.base)&&C.name.toLowerCase().includes("tile"));o(ine(x||null))},[t==null?void 0:t.base,a,o]);const f=u.useMemo(()=>t&&["sd-1","sdxl"].includes(t.base),[t]),p=u.useMemo(()=>{const x=[];return f&&(t||x.push(e("upscaling.mainModelDesc")),s||x.push(e("upscaling.tileControlNetModelDesc")),n||x.push(e("upscaling.upscaleModelDesc"))),x},[f,t,s,n,e]),g=u.useMemo(()=>{const x=[];return h&&d&&x.push(e("upscaling.exceedsMaxSizeDetails",{maxUpscaleDimension:d.toLocaleString()})),x},[h,e,d]),m=u.useMemo(()=>[...p,...g],[p,g]),y=u.useCallback(()=>{o(bt("models")),Al.set(3)},[o]);return f&&p.length>0&&c||f&&m.length===0||l?null:r.jsxs(T,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:[!f&&r.jsx(K,{children:e("upscaling.incompatibleBaseModelDesc")}),p.length>0&&r.jsx(K,{children:r.jsx(Xt,{i18nKey:"upscaling.missingModelsWarning",components:{LinkComponent:r.jsx(ye,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:y})}})}),m.length>0&&r.jsx(ki,{children:m.map(x=>r.jsx(Gt,{children:x},x))})]})},k3e=It([U0],e=>{const{upscaleModel:t,upscaleInitialImage:n,scale:s}=e,i=[];if(t&&i.push(t.name),n){const o=t?v_(t.base):v_(null),a=b_(n.width*s,o),l=b_(n.height*s,o);i.push(`${a}×${l}`)}return{badges:i}}),gW=u.memo(()=>{const{t:e}=P(),{badges:t}=I(k3e),{isOpen:n,onToggle:s}=pd({id:"upscale-settings",defaultIsOpen:!0}),{isOpen:i,onToggle:o}=Xj({id:"upscale-settings-advanced",defaultIsOpen:!1});return r.jsx(Bu,{label:e("upscaling.upscale"),badges:t,isOpen:n,onToggle:s,children:r.jsxs(T,{pt:4,px:4,w:"full",h:"full",flexDir:"column","data-testid":"upscale-settings-accordion",children:[r.jsxs(T,{flexDir:"column",gap:4,children:[r.jsxs(T,{gap:4,children:[r.jsx(C3e,{}),r.jsxs(T,{direction:"column",w:"full",alignItems:"center",gap:2,minW:0,children:[r.jsx(p3e,{}),r.jsx(pW,{})]})]}),r.jsx(j3e,{})]}),r.jsx(ZC,{label:e("accordions.advanced.options"),isOpen:i,onToggle:o,children:r.jsxs(T,{gap:4,pb:4,flexDir:"column",children:[r.jsx(h3e,{}),r.jsx(b3e,{})]})})]})})});gW.displayName="UpscaleSettingsAccordion";const $A={height:"100%",width:"100%"},_3e=()=>{const e=ce(pu);return r.jsxs(T,{w:"full",h:"full",flexDir:"column",gap:2,children:[r.jsx(qG,{}),r.jsx(T,{w:"full",h:"full",position:"relative",children:r.jsxs(ke,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[e&&r.jsx(tr,{defer:!0,style:$A,options:Il.options,children:r.jsx(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:r.jsx(UG,{})})}),r.jsx(tr,{defer:!0,style:$A,options:Il.options,children:r.jsxs(T,{gap:2,flexDirection:"column",h:"full",w:"full",children:[r.jsx(Uj,{}),r.jsx(gW,{}),r.jsx(Qj,{}),r.jsx(Yj,{})]})})]})})]})},I3e=u.memo(_3e),Jg={position:"relative",height:"100%",width:"100%",minWidth:0},A3e=e=>Jb.set(!e),T3e=e=>lne.set(!e),mW=u.memo(()=>{const e=u.useRef(null);tCe();const t=I(one),n=u.useMemo(()=>({id:"left-panel",minSizePx:x_,defaultSizePx:x_,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:A3e}),[]),s=w2(n);Ee({id:"toggleLeftPanel",category:"app",callback:s.toggle,options:{enabled:t},dependencies:[s.toggle,t]});const i=I(ane),o=u.useMemo(()=>({id:"right-panel",minSizePx:C_,defaultSizePx:C_,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:T3e}),[]),a=w2(o);return Ee({id:"toggleRightPanel",category:"app",callback:a.toggle,options:{enabled:i},dependencies:[a.toggle,i]}),Ee({id:"resetPanelLayout",category:"app",callback:()=>{s.reset(),a.reset()},dependencies:[s.reset,a.reset]}),Ee({id:"togglePanels",category:"app",callback:()=>{s.isCollapsed||a.isCollapsed?(s.expand(),a.expand()):(s.collapse(),a.collapse())},dependencies:[s.isCollapsed,a.isCollapsed,s.expand,a.expand,s.collapse,a.collapse]}),r.jsxs(T,{id:"invoke-app-tabs",w:"full",h:"full",gap:4,p:4,overflow:"hidden",children:[r.jsx(cW,{}),r.jsxs(Gp,{ref:e,id:"app-panel-group",autoSaveId:"app-panel-group",direction:"horizontal",style:Jg,children:[t&&r.jsxs(r.Fragment,{children:[r.jsx(Xi,{order:0,collapsible:!0,style:Jg,...s.panelProps,children:r.jsxs(T,{flexDir:"column",w:"full",h:"full",gap:2,children:[r.jsx(kje,{}),r.jsx(ke,{position:"relative",w:"full",h:"full",children:r.jsx(vW,{})})]})}),r.jsx(Tf,{id:"left-main-handle",...s.resizeHandleProps})]}),r.jsxs(Xi,{id:"main-panel",order:1,minSize:20,style:Jg,children:[r.jsx(bW,{}),t&&r.jsx(Mje,{panelApi:s}),i&&r.jsx(Ije,{panelApi:a})]}),i&&r.jsxs(r.Fragment,{children:[r.jsx(Tf,{id:"main-right-handle",...a.resizeHandleProps}),r.jsx(Xi,{order:2,style:Jg,collapsible:!0,...a.panelProps,children:r.jsx(yW,{})})]})]})]})});mW.displayName="AppContent";const yW=u.memo(()=>{const e=I(On);return e==="canvas"?r.jsx(C$,{}):e==="upscaling"||e==="workflows"?r.jsx(x$,{}):null});yW.displayName="RightPanelContent";const vW=u.memo(()=>{const e=I(On);return e==="canvas"?r.jsx(W_e,{}):e==="upscaling"?r.jsx(I3e,{}):e==="workflows"?r.jsx(xje,{}):null});vW.displayName="LeftPanelContent";const bW=u.memo(()=>{const e=I(On);return e==="canvas"?r.jsx(sB,{}):e==="upscaling"?r.jsx(gy,{}):e==="workflows"?r.jsx(nW,{}):e==="models"?r.jsx(y4e,{}):e==="queue"?r.jsx(RIe,{}):null});bW.displayName="MainPanelContent";const M3e=u.createContext(null),Lb={didCatch:!1,error:null};class P3e extends u.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Lb}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var n,s,i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];(n=(s=this.props).onReset)===null||n===void 0||n.call(s,{args:o,reason:"imperative-api"}),this.setState(Lb)}}componentDidCatch(t,n){var s,i;(s=(i=this.props).onError)===null||s===void 0||s.call(i,t,n)}componentDidUpdate(t,n){const{didCatch:s}=this.state,{resetKeys:i}=this.props;if(s&&n.error!==null&&E3e(t.resetKeys,i)){var o,a;(o=(a=this.props).onReset)===null||o===void 0||o.call(a,{next:i,prev:t.resetKeys,reason:"keys"}),this.setState(Lb)}}render(){const{children:t,fallbackRender:n,FallbackComponent:s,fallback:i}=this.props,{didCatch:o,error:a}=this.state;let l=t;if(o){const c={error:a,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")l=n(c);else if(s)l=u.createElement(s,c);else if(i===null||u.isValidElement(i))l=i;else throw a}return u.createElement(M3e.Provider,{value:{didCatch:o,error:a,resetErrorBoundary:this.resetErrorBoundary}},l)}}function E3e(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.length!==t.length||e.some((n,s)=>!Object.is(n,t[s]))}const L3e="default",D3e=Oe(L3e),R3e=e=>e==="OutOfMemoryError"?Ce("toast.outOfMemoryError"):Ce("toast.serverError");function O3e({errorType:e,isLocal:t,sessionId:n,errorMessage:s}){const{t:i}=P(),o=Ho(),a=u.useMemo(()=>{if(e==="OutOfMemoryError")return t?r.jsx(Xt,{i18nKey:"toast.outOfMemoryErrorDescLocal",components:{LinkComponent:r.jsx(hj,{href:"https://invoke-ai.github.io/InvokeAI/features/low-vram/"})}}):i("toast.outOfMemoryErrorDesc");if(s)return`${e}: ${s}`},[s,e,t,i]),l=u.useCallback(()=>o.writeText(n),[n,o]);return r.jsxs(T,{flexDir:"column",children:[a&&r.jsx(K,{noOfLines:4,fontSize:"md",children:a}),!t&&r.jsxs(T,{gap:"2",alignItems:"center",children:[r.jsx(K,{fontSize:"sm",fontStyle:"italic",children:i("toast.sessionRef",{sessionId:n})}),r.jsx(ae,{size:"sm","aria-label":"Copy",icon:r.jsx(on,{}),onClick:l,variant:"ghost",sx:{svg:{fill:"base.50"}}})]})]})}const VA=nr("events"),N3e=e=>e.invocation_source_id.split(":")[0]===fne,F3e=["load_image","image"],B3e=(e,t)=>{const n=(l,c)=>{if(F3e.includes(l.invocation.type)){VA.trace("Skipping node type denylisted");return}if(c.is_intermediate)return;t(une.util.updateQueryData("getBoardImagesTotal",c.board_id??"none",g=>{g.total+=1})),t(dC.util.invalidateTags([{type:"Board",id:c.board_id??"none"},{type:"ImageList",id:dne({board_id:c.board_id??"none",categories:hne(c)})}]));const{shouldAutoSwitch:d,selectedBoardId:h,galleryView:f,offset:p}=e().gallery;d&&(c.board_id&&c.board_id!==h?t(af({boardId:c.board_id,selectedImageName:c.image_name})):!c.board_id&&h!=="none"?t(af({boardId:"none",selectedImageName:c.image_name})):(t(J2(c)),f!=="images"?t(Qb("images")):p>0&&t(ZM({offset:0}))))},s=l=>{const{result:c}=l;return c.type==="image_output"?Q0(c.image.image_name):null},i=async l=>{const{result:c,invocation_source_id:d}=l,h=ft(Sc.get()[d]);h&&(h.status=Ks.enum.COMPLETED,h.progress!==null&&(h.progress=1),h.outputs.push(c),im(h.nodeId,h));const f=await s(l);f&&!f.is_intermediate&&n(l,f)},o=async l=>{const c=await s(l);c&&(l.destination==="canvas"?N3e(l)&&(l.result.type==="image_output"&&t(cne({stagingAreaImage:{imageDTO:c,offsetX:0,offsetY:0}})),n(l,c)):c.is_intermediate||n(l,c))},a=async l=>{const c=await s(l);c&&!c.is_intermediate&&n(l,c)};return async l=>{VA.debug({data:l},`Invocation complete (${l.invocation.type}, ${l.invocation_source_id})`),l.origin==="workflows"?await i(l):l.origin==="canvas"?await o(l):await a(l),Io.set(null)}},tn=nr("events"),xc=Di.endpoints.listModelInstalls.select(),$3e=({socket:e,store:t,setIsConnected:n})=>{const{dispatch:s,getState:i}=t;e.on("connect",()=>{tn.debug("Connected"),n(!0),s(pne());const l=gne.get();if(e.emit("subscribe_queue",{queue_id:l}),!IP.get()){const c=D3e.get();e.emit("subscribe_bulk_download",{bulk_download_id:c})}Io.set(null)}),e.on("connect_error",l=>{tn.debug("Connect error"),n(!1),Io.set(null),l&&l.message&&l.data==="ERR_UNAUTHENTICATED"&&fe({id:`connect-error-${l.message}`,title:l.message,status:"error",duration:1e4})}),e.on("disconnect",()=>{tn.debug("Disconnected"),Io.set(null),n(!1)}),e.on("invocation_started",l=>{const{invocation_source_id:c,invocation:d}=l;tn.debug({data:l},`Invocation started (${d.type}, ${c})`);const h=ft(Sc.get()[c]);h&&(h.status=Ks.enum.IN_PROGRESS,im(h.nodeId,h))}),e.on("invocation_progress",l=>{const{invocation_source_id:c,invocation:d,image:h,origin:f,percentage:p,message:g}=l;let m="Invocation progress";if(g&&(m+=`: ${g}`),ze(p)||(m+=` ${sp(p*100,2)}%`),m+=` (${d.type}, ${c})`,tn.trace({data:l},m),Io.set(l),f==="workflows"){const y=ft(Sc.get()[c]);y&&(y.status=Ks.enum.IN_PROGRESS,y.progress=p,y.progressImage=h??null,im(y.nodeId,y))}}),e.on("invocation_error",l=>{const{invocation_source_id:c,invocation:d,error_type:h,error_message:f,error_traceback:p}=l;tn.error({data:l},`Invocation error (${d.type}, ${c})`);const g=ft(Sc.get()[c]);g&&(g.status=Ks.enum.FAILED,g.progress=null,g.progressImage=null,g.error={error_type:h,error_message:f,error_traceback:p},im(g.nodeId,g))});const o=B3e(i,s);e.on("invocation_complete",o),e.on("model_load_started",l=>{const{config:c,submodel_type:d}=l,{name:h,base:f,type:p}=c,g=[f,p];d&&g.push(d);const m=`Model load started: ${h} (${g.join(", ")})`;tn.debug({data:l},m)}),e.on("model_load_complete",l=>{const{config:c,submodel_type:d}=l,{name:h,base:f,type:p}=c,g=[f,p];d&&g.push(d);const m=`Model load complete: ${h} (${g.join(", ")})`;tn.debug({data:l},m)}),e.on("download_started",l=>{tn.debug({data:l},"Download started")}),e.on("download_progress",l=>{tn.trace({data:l},"Download progress")}),e.on("download_complete",l=>{tn.debug({data:l},"Download complete")}),e.on("download_cancelled",l=>{tn.warn({data:l},"Download cancelled")}),e.on("download_error",l=>{tn.error({data:l},"Download error")}),e.on("model_install_started",l=>{tn.debug({data:l},"Model install started");const{id:c}=l,d=xc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Di.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="running"),h})):s(Ei.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_started",l=>{tn.debug({data:l},"Model install download started");const{id:c}=l,d=xc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Di.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="downloading"),h})):s(Ei.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_progress",l=>{tn.trace({data:l},"Model install download progress");const{bytes:c,total_bytes:d,id:h}=l,f=xc(i()).data;f!=null&&f.find(p=>p.id===h)?s(Di.util.updateQueryData("listModelInstalls",void 0,p=>{const g=p.find(m=>m.id===h);return g&&(g.bytes=c,g.total_bytes=d,g.status="downloading"),p})):s(Ei.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_downloads_complete",l=>{tn.debug({data:l},"Model install downloads complete");const{id:c}=l,d=xc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Di.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="downloads_done"),h})):s(Ei.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_complete",l=>{tn.debug({data:l},"Model install complete");const{id:c}=l,d=xc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Di.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="completed"),h})):s(Ei.util.invalidateTags([{type:"ModelInstalls"}])),s(Ei.util.invalidateTags([{type:"ModelConfig",id:Li}])),s(Ei.util.invalidateTags([{type:"ModelScanFolderResults",id:Li}]))});const a=xue(i,s);e.on("model_install_error",a),e.on("model_install_cancelled",l=>{tn.warn({data:l},"Model install cancelled");const{id:c}=l,d=xc(i()).data;d!=null&&d.find(h=>h.id===c)?s(Di.util.updateQueryData("listModelInstalls",void 0,h=>{const f=h.find(p=>p.id===c);return f&&(f.status="cancelled"),h})):s(Ei.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("queue_item_status_changed",l=>{const{item_id:c,session_id:d,status:h,started_at:f,updated_at:p,completed_at:g,batch_status:m,queue_status:y,error_type:x,error_message:C,error_traceback:v,destination:b}=l;tn.debug({data:l},`Queue item ${c} status updated: ${h}`),s(Lc.util.updateQueryData("listQueueItems",void 0,w=>{mne.updateOne(w,{id:String(c),changes:{status:h,started_at:f,updated_at:p??void 0,completed_at:g??void 0,error_type:x,error_message:C,error_traceback:v}})})),s(Lc.util.updateQueryData("getQueueStatus",void 0,w=>{w&&Object.assign(w.queue,y)})),s(Lc.util.updateQueryData("getBatchStatus",{batch_id:m.batch_id},()=>m));const S=["CurrentSessionQueueItem","NextSessionQueueItem","InvocationCacheStatus",{type:"SessionQueueItem",id:c}];if(b&&S.push({type:"QueueCountsByDestination",id:b}),s(Lc.util.invalidateTags(S)),h==="in_progress")yne(Sc.get(),w=>{if(!w)return;const j=ft(w);j.status=Ks.enum.PENDING,j.error=null,j.progress=null,j.progressImage=null,j.outputs=[],Sc.setKey(j.nodeId,j)});else if(h==="failed"&&x){const w=i().config.isLocal??!0,j=d;fe({id:`INVOCATION_ERROR_${x}`,title:R3e(x),status:"error",duration:null,updateDescription:w,description:r.jsx(O3e,{errorType:x,errorMessage:C,sessionId:j,isLocal:w})})}else(h==="completed"||h==="failed"||h==="canceled")&&Io.set(null)}),e.on("queue_cleared",l=>{tn.debug({data:l},"Queue cleared")}),e.on("batch_enqueued",l=>{tn.debug({data:l},"Batch enqueued")}),e.on("bulk_download_started",l=>{tn.debug({data:l},"Bulk gallery download preparation started")}),e.on("bulk_download_complete",l=>{tn.debug({data:l},"Bulk gallery download ready");const{bulk_download_item_name:c}=l,d=`/api/v1/images/download/${c}`;fe({id:c,title:Ce("gallery.bulkDownloadReady","Download ready"),status:"success",description:r.jsx(Xs,{label:Ce("gallery.clickToDownload","Click here to download"),href:d,download:c}),duration:null})}),e.on("bulk_download_error",l=>{tn.error({data:l},"Bulk gallery download error");const{bulk_download_item_name:c,error:d}=l;fe({id:c,title:Ce("gallery.bulkDownloadFailed"),status:"error",description:d,duration:null})})},ao=Object.create(null);ao.open="0";ao.close="1";ao.ping="2";ao.pong="3";ao.message="4";ao.upgrade="5";ao.noop="6";const _m=Object.create(null);Object.keys(ao).forEach(e=>{_m[ao[e]]=e});const G2={type:"error",data:"parser error"},xW=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",CW=typeof ArrayBuffer=="function",SW=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,xk=({type:e,data:t},n,s)=>xW&&t instanceof Blob?n?s(t):GA(t,s):CW&&(t instanceof ArrayBuffer||SW(t))?n?s(t):GA(new Blob([t]),s):s(ao[e]+(t||"")),GA=(e,t)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];t("b"+(s||""))},n.readAsDataURL(e)};function zA(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Db;function V3e(e,t){if(xW&&e.data instanceof Blob)return e.data.arrayBuffer().then(zA).then(t);if(CW&&(e.data instanceof ArrayBuffer||SW(e.data)))return t(zA(e.data));xk(e,!1,n=>{Db||(Db=new TextEncoder),t(Db.encode(n))})}const HA="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Vh=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<HA.length;e++)Vh[HA.charCodeAt(e)]=e;const G3e=e=>{let t=e.length*.75,n=e.length,s,i=0,o,a,l,c;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const d=new ArrayBuffer(t),h=new Uint8Array(d);for(s=0;s<n;s+=4)o=Vh[e.charCodeAt(s)],a=Vh[e.charCodeAt(s+1)],l=Vh[e.charCodeAt(s+2)],c=Vh[e.charCodeAt(s+3)],h[i++]=o<<2|a>>4,h[i++]=(a&15)<<4|l>>2,h[i++]=(l&3)<<6|c&63;return d},z3e=typeof ArrayBuffer=="function",Ck=(e,t)=>{if(typeof e!="string")return{type:"message",data:wW(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:H3e(e.substring(1),t)}:_m[n]?e.length>1?{type:_m[n],data:e.substring(1)}:{type:_m[n]}:G2},H3e=(e,t)=>{if(z3e){const n=G3e(e);return wW(n,t)}else return{base64:!0,data:e}},wW=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},jW="",W3e=(e,t)=>{const n=e.length,s=new Array(n);let i=0;e.forEach((o,a)=>{xk(o,!1,l=>{s[a]=l,++i===n&&t(s.join(jW))})})},U3e=(e,t)=>{const n=e.split(jW),s=[];for(let i=0;i<n.length;i++){const o=Ck(n[i],t);if(s.push(o),o.type==="error")break}return s};function q3e(){return new TransformStream({transform(e,t){V3e(e,n=>{const s=n.length;let i;if(s<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,s);else if(s<65536){i=new Uint8Array(3);const o=new DataView(i.buffer);o.setUint8(0,126),o.setUint16(1,s)}else{i=new Uint8Array(9);const o=new DataView(i.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(i[0]|=128),t.enqueue(i),t.enqueue(n)})}})}let Rb;function em(e){return e.reduce((t,n)=>t+n.length,0)}function tm(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let i=0;i<t;i++)n[i]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function K3e(e,t){Rb||(Rb=new TextDecoder);const n=[];let s=0,i=-1,o=!1;return new TransformStream({transform(a,l){for(n.push(a);;){if(s===0){if(em(n)<1)break;const c=tm(n,1);o=(c[0]&128)===128,i=c[0]&127,i<126?s=3:i===126?s=1:s=2}else if(s===1){if(em(n)<2)break;const c=tm(n,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),s=3}else if(s===2){if(em(n)<8)break;const c=tm(n,8),d=new DataView(c.buffer,c.byteOffset,c.length),h=d.getUint32(0);if(h>Math.pow(2,21)-1){l.enqueue(G2);break}i=h*Math.pow(2,32)+d.getUint32(4),s=3}else{if(em(n)<i)break;const c=tm(n,i);l.enqueue(Ck(o?c:Rb.decode(c),t)),s=0}if(i===0||i>e){l.enqueue(G2);break}}}})}const kW=4;function Ln(e){if(e)return Z3e(e)}function Z3e(e){for(var t in Ln.prototype)e[t]=Ln.prototype[t];return e}Ln.prototype.on=Ln.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};Ln.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};Ln.prototype.off=Ln.prototype.removeListener=Ln.prototype.removeAllListeners=Ln.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,i=0;i<n.length;i++)if(s=n[i],s===t||s.fn===t){n.splice(i,1);break}return n.length===0&&delete this._callbacks["$"+e],this};Ln.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,i=n.length;s<i;++s)n[s].apply(this,t)}return this};Ln.prototype.emitReserved=Ln.prototype.emit;Ln.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};Ln.prototype.hasListeners=function(e){return!!this.listeners(e).length};const Ny=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),Gr=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),Y3e="arraybuffer";function _W(e,...t){return t.reduce((n,s)=>(e.hasOwnProperty(s)&&(n[s]=e[s]),n),{})}const X3e=Gr.setTimeout,Q3e=Gr.clearTimeout;function Fy(e,t){t.useNativeTimers?(e.setTimeoutFn=X3e.bind(Gr),e.clearTimeoutFn=Q3e.bind(Gr)):(e.setTimeoutFn=Gr.setTimeout.bind(Gr),e.clearTimeoutFn=Gr.clearTimeout.bind(Gr))}const J3e=1.33;function ePe(e){return typeof e=="string"?tPe(e):Math.ceil((e.byteLength||e.size)*J3e)}function tPe(e){let t=0,n=0;for(let s=0,i=e.length;s<i;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}function IW(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function nPe(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function sPe(e){let t={},n=e.split("&");for(let s=0,i=n.length;s<i;s++){let o=n[s].split("=");t[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return t}class rPe extends Error{constructor(t,n,s){super(t),this.description=n,this.context=s,this.type="TransportError"}}class Sk extends Ln{constructor(t){super(),this.writable=!1,Fy(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,s){return super.emitReserved("error",new rPe(t,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=Ck(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=nPe(t);return n.length?"?"+n:""}}class iPe extends Sk{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};U3e(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,W3e(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=IW()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let AW=!1;try{AW=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const oPe=AW;function aPe(){}class lPe extends iPe{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,n){const s=this.request({method:"POST",data:t});s.on("success",n),s.on("error",(i,o)=>{this.onError("xhr post error",i,o)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=t}}class Ji extends Ln{constructor(t,n,s){super(),this.createRequest=t,Fy(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const n=_W(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&s.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var i;s.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Ji.requestsCount++,Ji.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=aPe,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Ji.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}Ji.requestsCount=0;Ji.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",WA);else if(typeof addEventListener=="function"){const e="onpagehide"in Gr?"pagehide":"unload";addEventListener(e,WA,!1)}}function WA(){for(let e in Ji.requests)Ji.requests.hasOwnProperty(e)&&Ji.requests[e].abort()}const cPe=function(){const e=TW({xdomain:!1});return e&&e.responseType!==null}();class uPe extends lPe{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=cPe&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new Ji(TW,this.uri(),t)}}function TW(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||oPe))return new XMLHttpRequest}catch{}if(!t)try{return new Gr[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const MW=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class dPe extends Sk{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,s=MW?{}:_W(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,s)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],i=n===t.length-1;xk(s,this.supportsBinary,o=>{try{this.doWrite(s,o)}catch{}i&&Ny(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=IW()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const Ob=Gr.WebSocket||Gr.MozWebSocket;class hPe extends dPe{createSocket(t,n,s){return MW?new Ob(t,n,s):n?new Ob(t,n):new Ob(t)}doWrite(t,n){this.ws.send(n)}}class fPe extends Sk{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=K3e(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(n).getReader(),i=q3e();i.readable.pipeTo(t.writable),this._writer=i.writable.getWriter();const o=()=>{s.read().then(({done:l,value:c})=>{l||(this.onPacket(c),o())}).catch(l=>{})};o();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this._writer.write(a).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],i=n===t.length-1;this._writer.write(s).then(()=>{i&&Ny(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const pPe={websocket:hPe,webtransport:fPe,polling:uPe},gPe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,mPe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function z2(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");n!=-1&&s!=-1&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let i=gPe.exec(e||""),o={},a=14;for(;a--;)o[mPe[a]]=i[a]||"";return n!=-1&&s!=-1&&(o.source=t,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=yPe(o,o.path),o.queryKey=vPe(o,o.query),o}function yPe(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function vPe(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,i,o){i&&(n[i]=o)}),n}const H2=typeof addEventListener=="function"&&typeof removeEventListener=="function",Im=[];H2&&addEventListener("offline",()=>{Im.forEach(e=>e())},!1);class ya extends Ln{constructor(t,n){if(super(),this.binaryType=Y3e,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const s=z2(t);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=z2(n.host).host);Fy(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const i=s.prototype.name;this.transports.push(i),this._transportsByName[i]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=sPe(this.opts.query)),H2&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Im.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=kW,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&ya.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",ya.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const i=this.writeBuffer[s].data;if(i&&(n+=ePe(i)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,Ny(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,s){return this._sendPacket("message",t,n,s),this}send(t,n,s){return this._sendPacket("message",t,n,s),this}_sendPacket(t,n,s,i){if(typeof n=="function"&&(i=n,n=void 0),typeof s=="function"&&(i=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const o={type:t,data:n,options:s};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),i&&this.once("flush",i),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(ya.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),H2&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=Im.indexOf(this._offlineEventListener);s!==-1&&Im.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}ya.protocol=kW;class bPe extends ya{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),s=!1;ya.priorWebsocketSuccess=!1;const i=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",f=>{if(!s)if(f.type==="pong"&&f.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;ya.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=n.name,this.emitReserved("upgradeError",p)}}))};function o(){s||(s=!0,h(),n.close(),n=null)}const a=f=>{const p=new Error("probe error: "+f);p.transport=n.name,o(),this.emitReserved("upgradeError",p)};function l(){a("transport closed")}function c(){a("socket closed")}function d(f){n&&f.name!==n.name&&o()}const h=()=>{n.removeListener("open",i),n.removeListener("error",a),n.removeListener("close",l),this.off("close",c),this.off("upgrading",d)};n.once("open",i),n.once("error",a),n.once("close",l),this.once("close",c),this.once("upgrading",d),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}let xPe=class extends bPe{constructor(t,n={}){const s=typeof t=="object"?t:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(i=>pPe[i]).filter(i=>!!i)),super(t,s)}};function CPe(e,t="",n){let s=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),s=z2(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const o=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+o+":"+s.port+t,s.href=s.protocol+"://"+o+(n&&n.port===s.port?"":":"+s.port),s}const SPe=typeof ArrayBuffer=="function",wPe=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,PW=Object.prototype.toString,jPe=typeof Blob=="function"||typeof Blob<"u"&&PW.call(Blob)==="[object BlobConstructor]",kPe=typeof File=="function"||typeof File<"u"&&PW.call(File)==="[object FileConstructor]";function wk(e){return SPe&&(e instanceof ArrayBuffer||wPe(e))||jPe&&e instanceof Blob||kPe&&e instanceof File}function Am(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,s=e.length;n<s;n++)if(Am(e[n]))return!0;return!1}if(wk(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Am(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Am(e[n]))return!0;return!1}function _Pe(e){const t=[],n=e.data,s=e;return s.data=W2(n,t),s.attachments=t.length,{packet:s,buffers:t}}function W2(e,t){if(!e)return e;if(wk(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=W2(e[s],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=W2(e[s],t));return n}return e}function IPe(e,t){return e.data=U2(e.data,t),delete e.attachments,e}function U2(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=U2(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=U2(e[n],t));return e}const APe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],TPe=5;var St;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(St||(St={}));class MPe{constructor(t){this.replacer=t}encode(t){return(t.type===St.EVENT||t.type===St.ACK)&&Am(t)?this.encodeAsBinary({type:t.type===St.EVENT?St.BINARY_EVENT:St.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===St.BINARY_EVENT||t.type===St.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=_Pe(t),s=this.encodeAsString(n.packet),i=n.buffers;return i.unshift(s),i}}function UA(e){return Object.prototype.toString.call(e)==="[object Object]"}class jk extends Ln{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const s=n.type===St.BINARY_EVENT;s||n.type===St.BINARY_ACK?(n.type=s?St.EVENT:St.ACK,this.reconstructor=new PPe(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(wk(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const s={type:Number(t.charAt(0))};if(St[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===St.BINARY_EVENT||s.type===St.BINARY_ACK){const o=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const a=t.substring(o,n);if(a!=Number(a)||t.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(a)}if(t.charAt(n+1)==="/"){const o=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););s.nsp=t.substring(o,n)}else s.nsp="/";const i=t.charAt(n+1);if(i!==""&&Number(i)==i){const o=n+1;for(;++n;){const a=t.charAt(n);if(a==null||Number(a)!=a){--n;break}if(n===t.length)break}s.id=Number(t.substring(o,n+1))}if(t.charAt(++n)){const o=this.tryParse(t.substr(n));if(jk.isPayloadValid(s.type,o))s.data=o;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case St.CONNECT:return UA(n);case St.DISCONNECT:return n===void 0;case St.CONNECT_ERROR:return typeof n=="string"||UA(n);case St.EVENT:case St.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&APe.indexOf(n[0])===-1);case St.ACK:case St.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class PPe{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=IPe(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const EPe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:jk,Encoder:MPe,get PacketType(){return St},protocol:TPe},Symbol.toStringTag,{value:"Module"}));function gi(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const LPe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class EW extends Ln{constructor(t,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[gi(t,"open",this.onopen.bind(this)),gi(t,"packet",this.onpacket.bind(this)),gi(t,"error",this.onerror.bind(this)),gi(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var s,i,o;if(LPe.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const a={type:St.EVENT,data:n};if(a.options={},a.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const h=this.ids++,f=n.pop();this._registerAckCallback(h,f),a.id=h}const l=(i=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((o=this.io.engine)===null||o===void 0)&&o._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(a),this.packet(a)):this.sendBuffer.push(a)),this.flags={},this}_registerAckCallback(t,n){var s;const i=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(i===void 0){this.acks[t]=n;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===t&&this.sendBuffer.splice(l,1);n.call(this,new Error("operation has timed out"))},i),a=(...l)=>{this.io.clearTimeoutFn(o),n.apply(this,l)};a.withError=!0,this.acks[t]=a}emitWithAck(t,...n){return new Promise((s,i)=>{const o=(a,l)=>a?i(a):s(l);o.withError=!0,n.push(o),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((i,...o)=>s!==this._queue[0]?void 0:(i!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(i)):(this._queue.shift(),n&&n(null,...o)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:St.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case St.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case St.EVENT:case St.BINARY_EVENT:this.onevent(t);break;case St.ACK:case St.BINARY_ACK:this.onack(t);break;case St.DISCONNECT:this.ondisconnect();break;case St.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let s=!1;return function(...i){s||(s=!0,n.packet({type:St.ACK,id:t,data:i}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:St.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,t.data)}}}function yd(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}yd.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};yd.prototype.reset=function(){this.attempts=0};yd.prototype.setMin=function(e){this.ms=e};yd.prototype.setMax=function(e){this.max=e};yd.prototype.setJitter=function(e){this.jitter=e};class q2 extends Ln{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,Fy(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new yd({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const i=n.parser||EPe;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new xPe(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const i=gi(n,"open",function(){s.onopen(),t&&t()}),o=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),t?t(l):this.maybeReconnectOnOpen()},a=gi(n,"error",o);if(this._timeout!==!1){const l=this._timeout,c=this.setTimeoutFn(()=>{i(),o(new Error("timeout")),n.close()},l);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(a),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(gi(t,"ping",this.onping.bind(this)),gi(t,"data",this.ondata.bind(this)),gi(t,"error",this.onerror.bind(this)),gi(t,"close",this.onclose.bind(this)),gi(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){Ny(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new EW(this,t,n),this.nsps[t]=s),s}_destroy(t){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let s=0;s<n.length;s++)this.engine.write(n[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(i=>{i?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",i)):t.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const _h={};function Tm(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=CPe(e,t.path||"/socket.io"),s=n.source,i=n.id,o=n.path,a=_h[i]&&o in _h[i].nsps,l=t.forceNew||t["force new connection"]||t.multiplex===!1||a;let c;return l?c=new q2(s,t):(_h[i]||(_h[i]=new q2(s,t)),c=_h[i]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(Tm,{Manager:q2,Socket:EW,io:Tm,connect:Tm});const DPe=()=>{wt("useSocketIO");const e=sr(),t=ce(IP),n=ce(qf),s=ce(w_),i=u.useMemo(()=>{const a=window.location.protocol==="https:"?"wss":"ws";return t?t.replace(/^https?:\/\//i,""):`${a}://${window.location.host}`},[t]),o=u.useMemo(()=>{const a={timeout:6e4,path:t?"/ws/socket.io":`${window.location.pathname}ws/socket.io`,autoConnect:!1,forceNew:!0};return n&&(a.auth={token:n},a.transports=["websocket","polling"]),{...a,...s}},[n,s,t]);u.useEffect(()=>{const a=Tm(i,o);NM.set(a),$3e({socket:a,store:e,setIsConnected:An.set}),a.connect(),S_.get()&&(window.$socketOptions=w_,console.log("Socket initialized",a));const l=e.subscribe(()=>{const c=vne(e.getState()).data;(!c||c.queue.in_progress===0)&&Io.set(null)});return()=>{S_.get()&&(window.$socketOptions=void 0,console.log("Socket teardown",a)),l(),a.disconnect()}},[o,i,e])};function RPe(e={}){let t;if(e.repoUrl)t=e.repoUrl;else if(e.user&&e.repo)t=`https://github.com/${e.user}/${e.repo}`;else throw new Error("You need to specify either the `repoUrl` option or both the `user` and `repo` options");const n=new URL(`${t}/issues/new`),s=["body","title","labels","template","milestone","assignee","projects"];for(const i of s){let o=e[i];if(o!==void 0){if(i==="labels"||i==="projects"){if(!Array.isArray(o))throw new TypeError(`The \`${i}\` option should be an array`);o=o.join(",")}n.searchParams.set(i,o)}}return n.toString()}const OPe=ve(Qr,e=>e.isLocal),NPe=({error:e,resetErrorBoundary:t})=>{const{t:n}=P(),s=I(OPe),i=Ho(),o=u.useCallback(()=>{const l=JSON.stringify(Es(e),null,2);i.writeText(`\`\`\`
${l}
\`\`\``,()=>{fe({id:"ERROR_COPIED",title:n("toast.errorCopied")})})},[i,e,n]),a=u.useMemo(()=>s?RPe({user:"invoke-ai",repo:"InvokeAI",template:"BUG_REPORT.yml",title:`[bug]: ${e.name}: ${e.message}`}):"https://support.invoke.ai/support/tickets/new",[e.message,e.name,s]);return r.jsx(T,{layerStyle:"body",w:"100dvw",h:"100dvh",alignItems:"center",justifyContent:"center",p:4,children:r.jsxs(T,{layerStyle:"first",flexDir:"column",borderRadius:"base",justifyContent:"center",gap:8,p:16,children:[r.jsxs(T,{alignItems:"center",gap:"2",children:[r.jsx(dn,{src:sW,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"}),r.jsx(Ot,{fontSize:"2xl",children:n("common.somethingWentWrong")})]}),r.jsx(T,{layerStyle:"second",px:8,py:4,gap:4,borderRadius:"base",justifyContent:"space-between",alignItems:"center",children:r.jsxs(K,{fontWeight:"semibold",color:"error.400",children:[e.name,": ",e.message]})}),r.jsxs(T,{gap:4,children:[r.jsx(ye,{leftIcon:r.jsx(ho,{}),onClick:t,children:n("accessibility.resetUI")}),r.jsx(ye,{leftIcon:r.jsx(on,{}),onClick:o,children:n("common.copyError")}),r.jsx(n1,{href:a,isExternal:!0,children:r.jsx(ye,{leftIcon:r.jsx(_1,{}),children:n(s?"accessibility.createIssue":"accessibility.submitSupportTicket")})})]})]})})},FPe=u.memo(NPe),BPe={},$Pe=({config:e=BPe,studioInitAction:t})=>{const n=I(NR),s=QP("system"),i=z(),o=JP();DPe(),bne(),Yre(),BC(),Zre();const a=u.useCallback(()=>(o(),location.reload(),!1),[o]);return u.useEffect(()=>{xne.changeLanguage(n)},[n]),u.useEffect(()=>{Tu(e)&&(s.info({config:e},"Received config"),i(Cne(e)))},[i,e,s]),u.useEffect(()=>{i(Sne())},[i]),Wre(t),Yue(),Kre(),Xne(),r.jsxs(P3e,{onReset:a,FallbackComponent:FPe,children:[r.jsx(ke,{id:"invoke-app-wrapper",w:"100dvw",h:"100dvh",position:"relative",overflow:"hidden",children:r.jsx(mW,{})}),r.jsx(dae,{}),r.jsx(eie,{}),r.jsx(pD,{}),r.jsx(lhe,{}),r.jsx(mR,{}),r.jsx(yR,{}),r.jsx(ZV,{}),r.jsx(vR,{}),r.jsx(nje,{}),r.jsx(Jue,{}),r.jsx(uhe,{}),r.jsx(Jce,{}),r.jsx(UP,{}),r.jsx(JE,{}),r.jsx(eL,{}),r.jsx(ED,{}),r.jsx(fL,{}),r.jsx(OR,{}),r.jsx(zr,{children:r.jsx(KE,{})})]})},wEe=u.memo($Pe);export{wEe as default};
